[
  {
    "owner": "nginx",
    "repo": "documentation",
    "content": "TITLE: Combined Upstream and Proxy Configuration\nDESCRIPTION: Combines the upstream group definition and the proxy configuration. This complete configuration sets up load balancing for HTTP traffic to a group of backend servers.  The default Round Robin algorithm is used as no other method is specified.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    upstream backend {\n        server backend1.example.com;\n        server backend2.example.com;\n        server 192.0.0.1 backup;\n    }\n\n    server {\n        location / {\n            proxy_pass http://backend;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling NGINX App Protect WAF in a location context\nDESCRIPTION: This snippet enables NGINX App Protect WAF on an `http/server/location` context. The `app_protect_enable on;` directive activates the WAF for the specified location. It is recommended to only enable WAF with `proxy_pass` or `grpc_pass` locations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_36\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enable on;\n```\n\n----------------------------------------\n\nTITLE: Generate Client Certificate with OpenSSL\nDESCRIPTION: This snippet generates a client certificate and key for NGINX (client) using OpenSSL.  The certificate is signed by the client's root CA. The certificate and key are stored in `/etc/ssl/certs/` directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nopenssl genpkey -algorithm RSA -out /etc/ssl/certs/app_protect_client.key\nopenssl req -new -key /etc/ssl/certs/app_protect_client.key -out /etc/ssl/certs/app_protect_client_csr.crt -subj \"/O=F5/OU=app-protect/CN=mTLS\"\nopenssl x509 -req -in /etc/ssl/certs/app_protect_client_csr.crt -CA /etc/ssl/certs/app_protect_client_ca.crt -CAkey /etc/ssl/certs/app_protect_client_ca.key -out /etc/ssl/certs/app_protect_client.crt -CAcreateserial\n```\n\n----------------------------------------\n\nTITLE: Adding User to Existing Password File with htpasswd\nDESCRIPTION: This snippet demonstrates how to add a new user to an existing password file using the `htpasswd` utility. The `-c` flag is omitted since the file already exists. This will prompt for the new user's password.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-http-basic-authentication.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo htpasswd /etc/apache2/.htpasswd user2\n```\n\n----------------------------------------\n\nTITLE: Shared SSL Certificate Configuration - Nginx\nDESCRIPTION: This configuration shows how to use a certificate with multiple names to share a single IP address among several HTTPS servers. The ssl_certificate and ssl_certificate_key directives are placed at the http level to allow them inherit single memory copy across all servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nssl_certificate     common.crt;\nssl_certificate_key common.key;\n\nserver {\n    listen          443 ssl;\n    server_name     www.example.com;\n    #...\n}\n\nserver {\n    listen          443 ssl;\n    server_name     www.example.org;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Arbitrary JWT Claims Validation - Nginx Configuration\nDESCRIPTION: This snippet demonstrates how to validate custom JWT claims using the `map` and `auth_jwt_require` directives. It defines mappings to check the audience, issuer, and scope of the JWT, and then uses `auth_jwt_require` to ensure that all conditions are met before granting access. The upstream block defines the backend servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nupstream api_server {\n    server 10.0.0.1;\n    server 10.0.0.2;\n}\n\nmap $jwt_claim_aud $valid_app_id {    #map rule 1:\n    \"~api\\d.example.com\" 1;           #token issued only for target apps\n}\n\nmap $jwt_claim_iss $valid_issuer {    #map rule 2:\n    \"https://idp.example.com/sts\" 1;  #token issued by trusted CA\n}\n\nmap $jwt_claim_scope $valid_scope {   #map rule 3:\n    \"access_as_admin\" 1;              #access as admin only\n}\n\nserver {\n    listen 80;\n\n    location /products/ {\n        auth_jwt          \"API\";\n        auth_jwt_key_file conf/api_secret.jwk;\n        auth_jwt_require  $valid_app_id $valid_issuer $valid_scope;\n        proxy_pass        http://api_server;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure OIDC Provider Details\nDESCRIPTION: This snippet configures specific details for the OIDC provider, including the issuer URL, client ID, client secret, and SSL trusted certificate. These values are essential for NGINX Plus to communicate with and trust the IdP. Ensure the paths to the certificate file is correct and accessible by NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-oidc.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider my_idp {\n        issuer        https://your-idp-domain/idp;\n        client_id     <client_id>;\n        client_secret <client_secret>;\n\n        ssl_trusted_certificate /etc/ssl/certs/ca-certificates.crt;\n    }\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Including Feature-Specific Configuration Files\nDESCRIPTION: This snippet shows how to include feature-specific configuration files in the main nginx.conf file using the `include` directive. This approach promotes modularity and makes the configuration easier to maintain. The included files are typically stored in the /etc/nginx/conf.d directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/basic-functionality/managing-configuration-files.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\ninclude conf.d/http;\ninclude conf.d/stream;\ninclude conf.d/exchange-enhanced;\n```\n\n----------------------------------------\n\nTITLE: Full NGINX Configuration for Basic Exchange Load Balancing\nDESCRIPTION: This comprehensive Nginx configuration snippet provides a full example setup for basic load balancing of Microsoft Exchange. It encompasses the `http` and `stream` blocks to handle both HTTP/HTTPS and other protocols (IMAPS, SMTP). It includes upstream definitions for Exchange CAS servers, HTTP to HTTPS redirection, SSL configuration, HTTP/2 enabling, and specific location blocks for handling different requests including RPC Over HTTP.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_41\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nworker_processes auto;\nerror_log /var/log/nginx/error.log info;\npid /var/run/nginx.pid;\n\nevents {\n    worker_connections 1024;\n}\n\n# If placing all directives in the main nginx.conf file, copy the following\n# 'http' block into it, including the initial and final lines which open\n# and close the 'http' context.\n\n# If creating a separate conf.d/exchange-http.conf file, either exclude the\n# initial and final lines from the copied region, or copy them but comment\n# them out in the exchange-http.conf file.\n\nhttp {\n    log_format main '$remote_addr - $remote_user [$time_local] '\n                    '\"$request\" $status $body_bytes_sent '\n                    '\"$http_user_agent\" \"$upstream_addr\"';\n    access_log /var/log/nginx/access.log main;\n    keepalive_timeout 3h;\n    proxy_read_timeout 3h;\n    tcp_nodelay on;\n\n    upstream exchange {\n        zone exchange-general 64k;\n        ntlm;\n\n        server 10.0.0.237:443; # Replace with IP address of a CAS\n        server 10.0.0.238:443; # Replace with IP address of a CAS\n        sticky learn create=$remote_addr lookup=$remote_addr\n                     zone=client_sessions:10m timeout=3h;\n    }\n\n    server {\n        listen 80;\n\n        location / {\n            return 301 https://$host$request_uri;\n        }\n    }\n\n    server {\n        listen 443 ssl;\n        http2  on;\n        client_max_body_size 2G;\n        ssl_certificate /etc/nginx/ssl/company.com.crt;\n        ssl_certificate_key /etc/nginx/ssl/company.com.key;\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        status_zone exchange-combined;\n\n        location = / {\n            return 301 \"/owa/\";\n        }\n\n        location = /favicon.ico {\n            empty_gif;\n            access_log off;\n        }\n\n        location / {\n            proxy_pass https://exchange;\n            proxy_buffering off;\n            proxy_http_version 1.1;\n            proxy_request_buffering off;\n            proxy_set_header Connection \"Keep-Alive\";\n        }\n    }\n}\n\n# If placing all directives in the main nginx.conf file, copy the following\n# 'stream' block into it, including the initial and final lines which open\n# and close the 'stream' context.\n\n# If using a separate conf.d/exchange-stream.conf file, either exclude\n# the initial and final lines from the copied region, or copy them but\n# comment them out in the exchange-stream.conf file.\n\nstream {\n    upstream exchange-imaps {\n        zone exchange-imaps 64k;\n\n        server 10.0.0.237:993; # Replace with IP address of a CAS\n        server 10.0.0.238:993; # Replace with IP address of a CAS\n    }\n\n    upstream exchange-smtp {\n        zone exchange-smtp 64k;\n\n        server 10.0.0.237:25; # Replace with IP address of a CAS\n        server 10.0.0.238:25; # Replace with IP address of a CAS\n    }\n\n    server {\n        listen 993;\n        status_zone exchange-imaps;\n        proxy_pass exchange-imaps;\n    }\n\n    server {\n        listen 25; # SMTP port can be changed here (to 587, for example)\n        status_zone exchange-smtp;\n        proxy_pass exchange-smtp;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Check NGINX Plus Version\nDESCRIPTION: This command checks the version of NGINX Plus installed. It's crucial to use NGINX Plus Release 34 or later for OIDC functionality.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-oidc.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nnginx -v\n```\n\n----------------------------------------\n\nTITLE: Configuring Access Log with App Protect Variables in Nginx\nDESCRIPTION: This example demonstrates how to configure Nginx to include App Protect WAF variables in access logs. It defines a custom log format 'security_waf' with various security-related variables and then configures the access_log directive to use this format within a specific location block. This allows correlating the access log with the security log.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/logging-overview/access-log.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    log_format security_waf 'request_time=$request_time client_ip=$remote_addr,'\n                             'request=\"$request\", status=$status,'\n                             'waf_policy=$app_protect_policy_name, waf_request_id=$app_protect_support_id'\n                             'waf_action=$app_protect_outcome, waf_action_reason=$app_protect_outcome_reason';\n\n    server {\n\n        location / {\n            access_log /etc/app_protect/logs/nginx-access.log security_waf;\n            ...\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Server Names for a Virtual Host\nDESCRIPTION: This snippet demonstrates how to configure the `server_name` directive to specify the domain names that the virtual host will respond to. It includes both `example.org` and `www.example.org`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen      80;\n    server_name example.org www.example.org;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Load NGINX App Protect WAF Module in NGINX\nDESCRIPTION: This snippet demonstrates how to load the NGINX App Protect WAF v5 module within the main context of the NGINX configuration file. This is a required step to enable the WAF functionality within NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n```\n\n----------------------------------------\n\nTITLE: Configuring Reverse Proxy with Upstream Group in NGINX\nDESCRIPTION: This code configures Nginx as a reverse proxy. It defines two location blocks within a server block configured for HTTPS traffic. The first location block proxies requests with a '/webapp/' prefix to the 'jboss' upstream group. The second location block redirects root requests to '/webapp/'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /webapp/ {\n    proxy_pass http://jboss;\n}\n\nlocation = / {\n    return 302 /webapp/;\n}\n```\n\n----------------------------------------\n\nTITLE: Setting a Default Server\nDESCRIPTION: This snippet shows how to configure a server as the default server using the `default_server` parameter in the `listen` directive. This ensures that if no other virtual host matches the request, this server will handle it.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80 default_server;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Access Log with App Protect WAF Variables\nDESCRIPTION: This snippet shows how to configure NGINX to include App Protect WAF variables in the access log. It defines a custom `log_format` named `security_waf` and uses it in the `access_log` directive within a `location` block.  This configuration enables the inclusion of App Protect specific information, like the request ID and WAF action, in the access logs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/access-log.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    log_format security_waf 'request_time=$request_time client_ip=$remote_addr,'\n                             'request=\"$request\", status=$status,'\n                             'waf_policy=$app_protect_policy_name, waf_request_id=$app_protect_support_id'\n                             'waf_action=$app_protect_outcome, waf_action_reason=$app_protect_outcome_reason';\n\n    server {\n\n        location / {\n            access_log /etc/app_protect/logs/nginx-access.log security_waf;\n            ...\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Restarting Kubernetes Deployment\nDESCRIPTION: This command restarts a Kubernetes deployment using `kubectl rollout restart`. This is often done to apply configuration changes or to recover from issues with the deployment.  It triggers a rolling update of the pods in the deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_28\n\nLANGUAGE: shell\nCODE:\n```\nkubectl rollout restart deployment.apps/nap5-deployment\n```\n\n----------------------------------------\n\nTITLE: Test Nginx Configuration\nDESCRIPTION: This shell command tests the Nginx configuration file for syntax errors. It uses the `nginx -t` command, which parses the configuration file and reports any errors.  The configuration file path is usually /etc/nginx/nginx.conf.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/headers-more.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration\nDESCRIPTION: This command reloads the NGINX configuration without interrupting existing connections. This is required after making changes to the NGINX configuration file to apply the new settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-oidc.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Enabling Basic Caching in Nginx\nDESCRIPTION: This snippet demonstrates enabling basic caching by defining a cache path and shared memory zone. It then configures a server block to use the cache for all requests. This allows Nginx to store and serve responses from the cache, reducing the load on the backend server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    proxy_cache_path /data/nginx/cache keys_zone=mycache:10m;\n    server {\n        proxy_cache mycache;\n        location / {\n            proxy_pass http://localhost:8000;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Set App Protect Enforcer Address in NGINX\nDESCRIPTION: This snippet sets the `app_protect_enforcer_address` directive in the NGINX configuration.  This tells NGINX where to send traffic for App Protect analysis.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enforcer_address 127.0.0.1:5000;\n```\n\n----------------------------------------\n\nTITLE: Load ModSecurity Module in Nginx Configuration\nDESCRIPTION: This line is added to the top-level (\"main\") context of /etc/nginx/nginx.conf to load the NGINX ModSecurity module. It specifies the path to the module's shared object file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_4\n\nLANGUAGE: none\nCODE:\n```\nload_module modules/ngx_http_modsecurity_module.so;\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Deployment for NGINX App Protect\nDESCRIPTION: This YAML defines a Kubernetes deployment for NGINX App Protect, including the NGINX container, WAF Enforcer, and WAF Config Manager. It specifies the image to use, image pull secrets, volume mounts, and environment variables.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_6\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nap5-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nap5\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: nap5\n    spec:\n      imagePullSecrets:\n        - name: regcred\n      containers:\n        - name: nginx\n          image: <your-private-registry>/nginx-app-protect-5:<your-tag>\n          imagePullPolicy: IfNotPresent\n          volumeMounts:\n            - name: app-protect-bd-config\n              mountPath: /opt/app_protect/bd_config\n            - name: app-protect-config\n              mountPath: /opt/app_protect/config\n        - name: waf-enforcer\n          image: private-registry.nginx.com/nap/waf-enforcer:<version-tag>\n          imagePullPolicy: IfNotPresent\n          env:\n            - name: ENFORCER_PORT\n              value: \"50000\"\n          volumeMounts:\n            - name: app-protect-bd-config\n              mountPath: /opt/app_protect/bd_config\n        - name: waf-config-mgr\n          image: private-registry.nginx.com/nap/waf-config-mgr:<version-tag>\n          imagePullPolicy: IfNotPresent\n          securityContext:\n            allowPrivilegeEscalation: false\n            capabilities:\n              drop:\n                - all\n          volumeMounts:\n            - name: app-protect-bd-config\n              mountPath: /opt/app_protect/bd_config\n            - name: app-protect-config\n              mountPath: /opt/app_protect/config\n            - name: app-protect-bundles\n              mountPath: /etc/app_protect/bundles\n      volumes:\n        - name: app-protect-bd-config\n          emptyDir: {}\n        - name: app-protect-config\n          emptyDir: {}\n        - name: app-protect-bundles\n          persistentVolumeClaim:\n            claimName: nap5-bundles-pvc\n```\n\n----------------------------------------\n\nTITLE: Creating Password File with htpasswd (apache2-utils)\nDESCRIPTION: This snippet shows how to create a password file and add a user using the `htpasswd` utility. The `-c` flag creates a new file and subsequent calls omit it to add more users. This creates a file containing username/hashed password pairs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-http-basic-authentication.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo htpasswd -c /etc/apache2/.htpasswd user1\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Plus Repo to Amazon Linux 2\nDESCRIPTION: Downloads the Nginx Plus repository file for Amazon Linux 2 and places it in the /etc/yum.repos.d directory. This configures the system to use the NGINX Plus repository when installing packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-amazon2.repo\n```\n\n----------------------------------------\n\nTITLE: Define Server and Listen Directive NGINX\nDESCRIPTION: This code snippet defines a `server {}` block within the `stream {}` context and includes the `listen` directive to specify the IP address and port on which the server listens. It shows examples for both TCP and UDP traffic configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n\n    server {\n        listen 12345;\n        # ...\n    }\n\n    server {\n        listen 53 udp;\n        # ...\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Sample NGINX Config with App Protect\nDESCRIPTION: A complete Nginx configuration example showcasing the integration of NGINX App Protect WAF. This includes loading the module, setting the enforcer address, enabling the protection within a location block, and specifying the policy file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/configure-waf.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nworker_processes auto;\nworker_rlimit_nofile 8192;\npid /run/nginx/nginx.pid;\n\nload_module modules/ngx_http_app_protect_module.so;\n\nevents {\n    worker_connections 4000;\n}\n\nerror_log /var/log/nginx/error.log debug;\n\nhttp {\n    access_log off;\n    server_tokens \"\";\n\n    app_protect_enforcer_address 127.0.0.1:50000;\n\n    server {\n        listen 80 default_server;\n\n        location / {\n            app_protect_enable on;\n            app_protect_policy_file /etc/app_protect/conf/NginxDefaultPolicy.json;\n            proxy_pass http://127.0.0.1:80/proxy/$request_uri;\n        }\n\n        location /proxy {\n            default_type text/html;\n            return 200 \"Hello World\\n\";\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Round Robin Load Balancing\nDESCRIPTION: Configures Round Robin load balancing for the 'backend' upstream group. Round Robin distributes requests evenly across the available servers.  No specific directive is required to enable Round Robin, as it is the default method.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n   # no load balancing method is specified for Round Robin\n   server backend1.example.com;\n   server backend2.example.com;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring a Server to Listen on a Specific IP and Port\nDESCRIPTION: This snippet configures an Nginx server to listen on a specific IP address and port. The `listen` directive specifies the IP address (127.0.0.1) and port (8080) on which the server will listen for incoming requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 127.0.0.1:8080;\n    # Additional server configuration\n}\n```\n\n----------------------------------------\n\nTITLE: Combined Nginx Caching Configuration Example\nDESCRIPTION: This snippet showcases a combined caching configuration with different settings for two locations. It uses the same cache defined by `proxy_cache_path`, but configures distinct caching behaviors through `proxy_cache_valid`, `proxy_cache_min_uses`, and `proxy_cache_bypass` directives for different routes. It also defines `loader_threshold` and `loader_files` within the `proxy_cache_path` for optimized cache loading.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    proxy_cache_path /data/nginx/cache keys_zone=mycache:10m loader_threshold=300\n                     loader_files=200 max_size=200m;\n\n    server {\n        listen 8080;\n        proxy_cache mycache;\n\n        location / {\n            proxy_pass http://backend1;\n        }\n\n        location /some/path {\n            proxy_pass http://backend2;\n            proxy_cache_valid any 1m;\n            proxy_cache_min_uses 3;\n            proxy_cache_bypass $cookie_nocache $arg_nocache$arg_comment;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Server Block for OIDC\nDESCRIPTION: This snippet configures a server block in NGINX for the application being protected by OIDC. It listens on port 443 with SSL enabled, specifies the server name, and sets the SSL certificate and key. The `location /` block defines how requests to the root path are handled, including proxying them to the backend application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/onelogin.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n\n    server {\n        listen      443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate     /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n            # ...\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Enable Nginx App Protect\nDESCRIPTION: Enables NGINX App Protect WAF on a specific HTTP, server, or location context within the NGINX configuration. This directive activates the WAF protection for the specified context. It's recommended to enable WAF only on locations that use proxy_pass or grpc_pass.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enable on;\n```\n\n----------------------------------------\n\nTITLE: Configuring auth_request for /private/ location\nDESCRIPTION: This configuration snippet sets up the `auth_request` directive for the `/private/` location.  Any request to this location will trigger a subrequest to the `/auth` location for authentication.  If the subrequest returns a 2xx status code, the original request is allowed; otherwise, it's denied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-subrequest-authentication.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /private/ {\n    auth_request /auth;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS Resolver for Dynamic Load Balancing in NGINX\nDESCRIPTION: This configuration snippet demonstrates how to configure DNS resolution for dynamic load balancing in NGINX. It uses the `resolver` directive to specify the DNS server and the `resolve` parameter in the `server` directive to enable periodic re-resolution of domain names to IP addresses. The `zone` directive enables sharing of the upstream configuration across worker processes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_17\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 valid=300s ipv6=off;\n    resolver_timeout 10s;\n    server {\n        location / {\n            proxy_pass http://backend;\n        }\n    }\n    upstream backend {\n        zone backend 32k;\n        least_conn;\n        # ...\n        server backend1.example.com resolve;\n        server backend2.example.com resolve;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Complete NGINX Configuration for JWT Authentication with Subrequest and Key Caching\nDESCRIPTION: This complete NGINX configuration enables JWT authentication for a backend service. It configures a location block for authentication, specifies a local JWK file, configures a subrequest to fetch keys from Microsoft Entra, enables key caching, and proxies requests to the backend. The subrequest is marked as `internal` to prevent external access and the output buffer size is increased.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/jwt.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n   upstream my_backend {\n      server 10.0.0.1;\n      server 10.0.0.2;\n   }\n\n   server {\n      listen 80;\n\n      location / {\n         auth_jwt \"API\";\n         auth_jwt_key_file conf/key.jwk;\n         auth_jwt_key_request /_jwks_uri;\n         auth_jwt_key_cache 1h;\n         proxy_pass http://my_backend;\n      }\n\n      location = /_jwks_uri {\n         internal;\n         proxy_method GET;\n         proxy_pass https://login.microsoftonline.com/common/discovery/keys;\n         subrequest_output_buffer_size 12k;\n      }\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration for OIDC Authentication with Okta\nDESCRIPTION: This NGINX configuration sets up OIDC authentication with Okta. It defines the OIDC provider, configures SSL, and proxies requests to an internal server. Replace `<your_client_id>` and `<your_client_secret>` with your actual Okta credentials.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/okta.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # Use a public DNS resolver for Issuer discovery, etc.\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    # Define the OIDC provider block for Okta\n    oidc_provider okta {\n        # The 'issuer' is your Okta issuer URL\n        # For okta dev it looks like: https://dev-123456.okta.com/oauth2/default\n        issuer https://dev-123456.okta.com/oauth2/default;\n\n        # Your Okta “Client ID” from the application settings\n        client_id <your_client_id>;\n\n        # Your Okta “Client Secret” from the application settings\n        client_secret <your_client_secret>;\n    }\n\n    server {\n        listen 443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n            # Enforce OIDC authentication with Okta\n            auth_oidc okta;\n\n            # Pass OIDC claims as HTTP headers to the backend\n            proxy_set_header sub $oidc_claim_sub;\n            proxy_set_header email $oidc_claim_email;\n            proxy_set_header name $oidc_claim_name;\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n\n    server {\n        # Simple backend listening on 8080\n        listen 8080;\n\n        location / {\n            return 200 \"Hello, $http_name!\\nEmail: $http_email\\nSub: $http_sub\\n\";\n            default_type text/plain;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx configuration\nDESCRIPTION: This snippet shows how to reload the Nginx configuration using the `nginx -s reload` command. This command applies the new configuration without restarting the Nginx server, ensuring minimal downtime.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginscript.md#_snippet_9\n\nLANGUAGE: Shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Complete Example Configuration\nDESCRIPTION: This is a complete example that combines all previous steps into a single Nginx configuration.  It configures authentication for the `/private/` location by using an internal `/auth` location that proxies requests to `http://auth-server`. It sets the necessary headers and disables the request body for the subrequest.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-subrequest-authentication.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n    server {\n    #...\n        location /private/ {\n            auth_request     /auth;\n            auth_request_set $auth_status $upstream_status;\n        }\n\n        location = /auth {\n            internal;\n            proxy_pass              http://auth-server;\n            proxy_pass_request_body off;\n            proxy_set_header        Content-Length \"\";\n            proxy_set_header        X-Original-URI $request_uri;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: TCP/UDP Load Balancing Example NGINX\nDESCRIPTION: This snippet provides a comprehensive configuration example for TCP and UDP load balancing with NGINX.  It includes upstream definitions, server configurations for TCP and UDP, and proxy settings.  It demonstrates the use of the `stream` block for non-HTTP traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_24\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    upstream stream_backend {\n        least_conn;\n        server backend1.example.com:12345 weight=5;\n        server backend2.example.com:12345 max_fails=2 fail_timeout=30s;\n        server backend3.example.com:12345 max_conns=3;\n    }\n\n    upstream dns_servers {\n        least_conn;\n        server 192.168.136.130:53;\n        server 192.168.136.131:53;\n        server 192.168.136.132:53;\n    }\n\n    server {\n        listen        12345;\n        proxy_pass    stream_backend;\n        proxy_timeout 3s;\n        proxy_connect_timeout 1s;\n    }\n\n    server {\n        listen     53 udp;\n        proxy_pass dns_servers;\n    }\n\n    server {\n        listen     12346;\n        proxy_pass backend4.example.com:12346;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling SSL for TCP Proxy in Nginx Stream Block\nDESCRIPTION: This configuration snippet enables SSL/TLS encryption for TCP traffic proxied to an upstream server. The `proxy_ssl on;` directive is essential for initiating a secure connection to the backend.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-tcp-traffic-upstream.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    server {\n        ...\n        proxy_pass backend;\n        proxy_ssl  on;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Implementing HTTP Basic Authentication NGINX\nDESCRIPTION: This snippet implements HTTP basic authentication to protect the `/api` location, requiring users to authenticate before accessing it. This is a crucial security measure when write access to the API is enabled. It limits modification access to particular users.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_18\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    server {\n        location /api {\n            limit_except GET {\n                auth_basic \"NGINX Plus API\";\n                auth_basic_user_file /path/to/passwd/file;\n            }\n            api   write=on;\n            allow 127.0.0.1;\n            deny  all;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Test NGINX Configuration\nDESCRIPTION: Tests the NGINX configuration file (`nginx.conf`) for syntax errors.  This command checks the configuration before reloading the server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/spnego.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx Configuration\nDESCRIPTION: This shell command gracefully reloads the Nginx configuration without interrupting existing connections. It sends the reload signal to the Nginx master process, which then restarts the worker processes with the new configuration. This requires Nginx to be installed and the nginx executable to be in the system's PATH.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/use-cases/monitoring/enable-nginx-oss-stub-status.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Testing NGINX Configuration Syntax\nDESCRIPTION: This command checks the NGINX configuration file for syntactic errors before reloading. It ensures that the configuration is valid and prevents errors during reload.  The command returns whether the syntax is ok or if there are errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_21\n\nLANGUAGE: none\nCODE:\n```\nroot# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n```\n\n----------------------------------------\n\nTITLE: Protect Location with Entra ID OIDC in NGINX\nDESCRIPTION: This configuration snippet demonstrates how to protect a specific location in Nginx with Entra ID OIDC. It uses the `auth_oidc` directive to specify the OIDC provider and passes user claims as headers to the upstream application. It assumes an OIDC provider named 'entra' is already defined.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/entra-id.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n\n     auth_oidc entra;\n\n     # ...\n\n     proxy_pass http://127.0.0.1:8080;\n\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Docker Compose Configuration\nDESCRIPTION: This `docker-compose.yml` file defines the services for deploying NGINX with App Protect WAF. It includes services for Nginx, the WAF enforcer, and the configuration manager. It configures networks, volumes, dependencies, and ports.  The <version-tag> should be replaced with an actual tag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_8\n\nLANGUAGE: yaml\nCODE:\n```\nservices:\n  nginx:\n    container_name: nginx\n    image: nginx-app-protect-5\n    volumes:\n      - app_protect_bd_config:/opt/app_protect/bd_config\n      - app_protect_config:/opt/app_protect/config\n      - app_protect_etc_config:/etc/app_protect/conf\n      - /conf/nginx.conf:/etc/nginx/nginx.conf # based on the provided example\n      - /conf/default.conf:/etc/nginx/conf.d/default.conf # based on the provided example\n    networks:\n      - waf_network\n    ports:\n      - \"80:80\"\n\n  waf-enforcer:\n    container_name: waf-enforcer\n    image: \"private-registry.nginx.com/nap/waf-enforcer:<version-tag>\"\n    environment:\n      - ENFORCER_PORT=50000\n    volumes:\n      - app_protect_bd_config:/opt/app_protect/bd_config\n    networks:\n      - waf_network\n    restart: always\n\n  waf-config-mgr:\n    container_name: waf-config-mgr\n    image: \"private-registry.nginx.com/nap/waf-config-mgr:<version-tag>\"\n    volumes:\n      - app_protect_bd_config:/opt/app_protect/bd_config\n      - app_protect_config:/opt/app_protect/config\n      - app_protect_etc_config:/etc/app_protect/conf\n    restart: always\n    network_mode: none\n    depends_on:\n      waf-enforcer:\n        condition: service_started\n\nnetworks:\n  waf_network:\n    driver: bridge\n\nvolumes:\n  app_protect_bd_config:\n  app_protect_config:\n  app_protect_etc_config:\n```\n\n----------------------------------------\n\nTITLE: Setting Cache Validity for Status Codes in Nginx\nDESCRIPTION: This snippet shows how to limit how long cached responses with specific status codes are considered valid.  It defines different validity times for different HTTP status codes. It configures how long different responses should be kept in cache.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_valid 200 302 10m;\nproxy_cache_valid 404      1m;\n```\n\n----------------------------------------\n\nTITLE: Setting up a basic HTTPS Server with Nginx\nDESCRIPTION: This snippet demonstrates the basic configuration for an HTTPS server in Nginx. It includes the `listen` directive with the `ssl` parameter, the server name, and the paths to the SSL certificate and private key files. It also sets the supported SSL/TLS protocols and cipher suites.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen              443 ssl;\n    server_name         www.example.com;\n    ssl_certificate     www.example.com.crt;\n    ssl_certificate_key www.example.com.key;\n    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers         HIGH:!aNULL:!MD5;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Enable Nginx API Endpoint - Nginx\nDESCRIPTION: This Nginx configuration snippet defines a location block `/api` that enables the Nginx Plus API in read-write mode. It restricts access to `PATCH`, `POST`, and `DELETE` methods using HTTP basic authentication and allows access only from localhost. The `api write=on` directive is crucial for enabling dynamic configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/dynamic-configuration-api.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    location /api {\n        limit_except GET {\n            auth_basic \"NGINX Plus API\";\n            auth_basic_user_file /path/to/passwd/file;\n        }\n        api write=on;\n        allow 127.0.0.1;\n        deny  all;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Setting Error Log Severity Level in Nginx\nDESCRIPTION: This code snippet demonstrates how to change the minimal severity level of error messages to log from `error` to `warn` using the `error_log` directive. This will log messages of `warn`, `error`, `crit`, `alert`, and `emerg` levels.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/logging.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nerror_log logs/error.log warn;\n```\n\n----------------------------------------\n\nTITLE: Test Nginx Configuration\nDESCRIPTION: This shell command tests the Nginx configuration file for syntax errors. It helps ensure that the configuration is valid before reloading or restarting Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/ndk.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTPS listener and certificates on upstream server\nDESCRIPTION: This snippet configures an upstream server to listen for HTTPS connections on port 443, specifying the server's SSL certificate and private key.  The `ssl_certificate` and `ssl_certificate_key` directives define the paths to these files. A location block is also present which proxies requests to another application via HTTPS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-http-traffic-upstream.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen              443 ssl;\n    server_name         backend1.example.com;\n\n    ssl_certificate     /etc/ssl/certs/server.crt;\n    ssl_certificate_key /etc/ssl/certs/server.key;\n    #...\n    location /yourapp {\n        proxy_pass https://url_to_app.com;\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Generating Admin Password Hash with OpenSSL\nDESCRIPTION: This command generates a hashed password using OpenSSL. It is used to set the `nms-hybrid.adminPasswordHash` parameter in the NGINX Instance Manager Helm chart, providing a secure way to configure the administrator password. The output of this command should be used as the value for the Helm parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/helm-config-settings.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\nopenssl passwd -1 \"YourPassword123#\"\n```\n\n----------------------------------------\n\nTITLE: Sending Pre-compressed Files with gzip_static in NGINX\nDESCRIPTION: This snippet enables serving pre-compressed files (e.g., file.gz) using the gzip_static module. If the compressed file exists and the client supports gzip, NGINX sends the compressed version; otherwise, it sends the uncompressed version. Note that the gzip_static directive does not enable on-the-fly compression, requires the ngx_http_gzip_static_module, which might not be included in an NGINX Open Source build by default.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/compression.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    gzip_static on;\n}\n```\n\n----------------------------------------\n\nTITLE: Binding to the server address in Nginx proxy\nDESCRIPTION: This snippet demonstrates binding the outgoing connection to the IP address that accepted the client's request. The `$server_addr` variable contains the IP address of the network interface that received the request.  Using `proxy_bind $server_addr;` ensures that NGINX uses this IP address when connecting to the proxied server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/reverse-proxy.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /app3/ {\n    proxy_bind $server_addr;\n    proxy_pass http://example.com/app3/;\n}\n```\n\n----------------------------------------\n\nTITLE: Updating and Installing Packages on Amazon Linux 2023, AlmaLinux, CentOS, Oracle Linux, RHEL, and Rocky Linux (Shell)\nDESCRIPTION: This command updates the package repositories and installs the `ca-certificates` package on Amazon Linux 2023, AlmaLinux, CentOS, Oracle Linux, RHEL, and Rocky Linux.  It ensures that the system has the necessary certificates to securely access the NGINX Plus repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install ca-certificates\n```\n\n----------------------------------------\n\nTITLE: Restricting API Access in Nginx\nDESCRIPTION: This configuration restricts access to the NGINX Plus API location, allowing access only from localhost (127.0.0.1) and requiring HTTP basic authentication for `PATCH`, `POST`, and `DELETE` methods. This enhances the security of the API endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\n server {\n  listen 80;\n  server_name www.example.com;\n\n  location /api {\n   api   write=on;\n\n   allow 127.0.0.1;\n   deny  all;\n\n   limit_except GET {\n    auth_basic \"NGINX Plus API\";\n    auth_basic_user_file /path/to/passwd/file;\n   }\n  }\n }\n```\n\n----------------------------------------\n\nTITLE: Downloading GeoLite2 Country Database with wget\nDESCRIPTION: Downloads and unpacks the GeoLite2 Country database using wget and gunzip. This database is used to determine the country associated with an IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nwget http://geolite.maxmind.com/download/geoip/database/GeoLite2-Country.mmdb.gz\ngunzip GeoLite2-Country.mmdb.gz\n```\n\n----------------------------------------\n\nTITLE: Define Proxy Buffer Size Directive Nginx\nDESCRIPTION: This code snippet demonstrates tuning the in-memory buffer size using the `proxy_buffer_size` directive.  Adjusting the buffer size can help optimize memory usage and reduce socket read/write operations depending on the volume of data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    # ...\n    server {\n        listen            127.0.0.1:12345;\n        proxy_pass        backend.example.com:12345;\n        proxy_buffer_size 16k;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Protect Location with Auth0 OIDC in NGINX\nDESCRIPTION: This code snippet protects a specific location (`/`) with Auth0 OIDC by using the `auth_oidc` directive and referencing the `auth0` provider configuration.  All requests to this location will be authenticated against Auth0.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/auth0.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc auth0;\n\n     # ...\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Testing and Reloading NGINX Configuration\nDESCRIPTION: This snippet demonstrates how to test the NGINX configuration for syntax errors and then reload NGINX to apply the changes.  This command ensures that the updated configuration is valid before being applied, preventing service disruptions.  Requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx -t && sudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: User-Defined Signature Definition Structure JSON\nDESCRIPTION: Defines the basic structure of a user-defined signature definition file. This file contains metadata such as the tag and revision date, along with an array of signatures.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/user-defined-signatures.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"tag\": \"tag_name\",\n    \"revisionDatetime\": \"2020-01-21T18:32:02Z\",\n    \"signatures\": []\n}\n```\n\n----------------------------------------\n\nTITLE: Complete Nginx Cache Purge Configuration Example\nDESCRIPTION: This configuration shows a complete example of cache purging, using a map to enable purging based on request method. The `proxy_cache_purge` directive in the location block enables the purge, using the `$purge_method` variable determined by the map. It also defines a geo block to restrict access to the PURGE command based on IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    proxy_cache_path /data/nginx/cache levels=1:2 keys_zone=mycache:10m purger=on;\n\n    map $request_method $purge_method {\n        PURGE 1;\n        default 0;\n    }\n\n    server {\n        listen      80;\n        server_name www.example.com;\n\n        location / {\n            proxy_pass        https://localhost:8002;\n            proxy_cache       mycache;\n            proxy_cache_purge $purge_method;\n        }\n    }\n\n    geo $purge_allowed {\n       default         0;\n       10.0.0.1        1;\n       192.168.0.0/24  1;\n    }\n\n    map $request_method $purge_method {\n       PURGE   $purge_allowed;\n       default 0;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Define Auth0 OIDC Provider in NGINX\nDESCRIPTION: This code defines the Auth0 OIDC provider within the `http` context using the `oidc_provider` directive. It references settings for the issuer, client ID, and client secret which are obtained from the Auth0 configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/auth0.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider auth0 {\n\n        # ...\n\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTPS Virtual Server Nginx\nDESCRIPTION: This snippet configures a virtual server listening on port 443 for HTTPS traffic. It requires specifying the SSL certificate and key, and enables session caching for improved performance. It should be placed within the 'http' block of the nginx configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nserver {\n    listen 443 ssl;\n    server_name example.com;\n\n    ssl_certificate           /etc/nginx/ssl/server.crt;\n    ssl_certificate_key       /etc/nginx/ssl/server.key;\n    ssl_session_cache         shared:SSL:1m;\n    ssl_prefer_server_ciphers on;\n}\n```\n\n----------------------------------------\n\nTITLE: Remove Server from Upstream - Shell\nDESCRIPTION: This `curl` command removes a server from the `appservers` upstream group using the Nginx Plus API. It sends a DELETE request to the API endpoint, specifying the server to remove by its ID (in this case, server `0`).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/dynamic-configuration-api.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X DELETE -s 'http://127.0.0.1/api/9/http/upstreams/appservers/servers/0'\n```\n\n----------------------------------------\n\nTITLE: Checking for RealIP Module in NGINX\nDESCRIPTION: This snippet uses the `nginx -V` command to check if the HTTP and Stream RealIP modules are included in the NGINX installation. The RealIP modules are used to replace the load balancer's IP address with the client's IP address. This step verifies the presence of the module before configuring it.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/using-proxy-protocol.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nnginx -V 2>&1 | grep -- 'http_realip_module'\nnginx -V 2>&1 | grep -- 'stream_realip_module'\n```\n\n----------------------------------------\n\nTITLE: Setting Up Stable NGINX Repository on Ubuntu\nDESCRIPTION: This command adds the official NGINX stable repository to the apt sources list, enabling the system to install and update NGINX packages from the official source. It uses echo to create a deb line with the repository URL and then uses tee to append it to the nginx.list file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_24\n\nLANGUAGE: shell\nCODE:\n```\necho \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n    http://nginx.org/packages/ubuntu `lsb_release -cs` nginx\" \\\n        | sudo tee /etc/apt/sources.list.d/nginx.list\n```\n\n----------------------------------------\n\nTITLE: Configure Security Event Log Backup for Security Monitoring Only - NGINX\nDESCRIPTION: This configuration enables backup logging for NGINX App Protect security events when using Security Monitoring only. It configures the policy file, enables security logging, and specifies two log destinations: syslog and a local file.  The path to the local log file needs to be configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/troubleshooting.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_policy_file \"/etc/app_protect/conf/NginxDefaultPolicy.json\";\napp_protect_security_log_enable on;\napp_protect_security_log \"/etc/app_protect/conf/log_sm.json\" syslog:server=127.0.0.1:514;\napp_protect_security_log \"/etc/app_protect/conf/log_sm.json\" <Path to store log file>;\n# Example: app_protect_security_log \"/etc/app_protect/conf/log_sm.json\" /var/log/app_protect/security.log;\n```\n\n----------------------------------------\n\nTITLE: Add NGINX App Protect WAF v5 Repository (Ubuntu)\nDESCRIPTION: This command adds the NGINX App Protect WAF v5 repository to the APT sources. It constructs the repository entry string using `printf`, incorporating the signed-by option for key verification, the repository URL for App Protect X Plus, the Ubuntu release codename obtained using `lsb_release -cs`, and the repository name 'nginx-plus'. The output is piped to `sudo tee` to write the entry into the `/etc/apt/sources.list.d/nginx-app-protect.list` file with administrative privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-ubuntu.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\nhttps://pkgs.nginx.com/app-protect-x-plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | \\\nsudo tee /etc/apt/sources.list.d/nginx-app-protect.list\n```\n\n----------------------------------------\n\nTITLE: Configuring Security Logs with app_protect_security_log in Nginx\nDESCRIPTION: These examples demonstrate how to configure security logs using the `app_protect_security_log` directive. The directive specifies the logging profile (either a file path or a built-in name) and the destination for the logs (stderr, a file, or syslog). Multiple examples are given showcasing various destination options.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/logging-overview/security-log.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log log_default stderr;\n```\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log /mounted_host_dir/logging_profile_01.tgz /mounted_host_dir/security.log;\n```\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log log_all syslog:server=localhost:514;\n```\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log log_grpc_all syslog:server=my-specific-machine-name:514;\n```\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log log_illegal syslog:server=192.168.12.34:51400;\n```\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log /shared_volume/logging_profile_02.tgz syslog:server=my.domain.com:514;\n```\n\n----------------------------------------\n\nTITLE: Installing NJS Dynamic Modules - Shell\nDESCRIPTION: This command is used to install the NGINX JavaScript (njs) dynamic module on Debian and Ubuntu systems using the apt package manager. This allows you to extend Nginx's functionality with Javascript scripting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/dynamic-modules.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\napt-get install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Configuring client certificate verification on upstream server\nDESCRIPTION: This snippet configures an upstream server to request and optionally verify client certificates.  The `ssl_client_certificate` directive specifies the path to the trusted CA certificate used to verify client certificates. The `ssl_verify_client` directive is set to `optional`, meaning the server requests a client certificate but doesn't require it for all connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-http-traffic-upstream.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    #...\n    ssl_client_certificate /etc/ssl/certs/ca.crt;\n    ssl_verify_client      optional;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Cookie-Based Session Persistence - Nginx\nDESCRIPTION: This configures cookie-based session persistence in Nginx using the sticky module. It defines an upstream block 'myapp' with three backend servers and then uses the 'sticky cookie' directive to enable cookie-based persistence. The 'mysession' argument specifies the cookie name, and 'expires=1h' sets the cookie's expiration time to 1 hour, ensuring session persistence for that duration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nupstream myapp {\n    server 10.0.0.100:80;\n    server 10.0.0.101:80;\n    server 10.0.0.102:80;\n    sticky cookie mysession expires=1h;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Security Logging Destination in NGINX\nDESCRIPTION: This snippet demonstrates how to configure the security log destination using the `app_protect_dos_security_log` directive. This directive specifies the configuration file path and the destination for security events. Destinations can be syslog, stderr, or an absolute file path.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_dos_security_log \"/etc/app_protect_dos/log-default.json\" syslog:server=1.2.3.4:5000;\n```\n\n----------------------------------------\n\nTITLE: Verifying and Reloading NGINX Configuration\nDESCRIPTION: These shell commands verify the validity of the Nginx configuration using 'nginx -t' and then reload the Nginx service to apply the new configuration using 'nginx -s reload'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/route-53-global-server-load-balancing.md#_snippet_8\n\nLANGUAGE: Shell\nCODE:\n```\nnginx -t\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Random Load Balancing in NGINX Stream\nDESCRIPTION: This configures Random load balancing, where each connection is passed to a randomly selected server. The `two` parameter and `least_time` options can be used to select from two random servers based on connection time.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nupstream stream_backend {\n    random two least_time=last_byte;\n    server backend1.example.com:12345;\n    server backend2.example.com:12345;\n    server backend3.example.com:12346;\n    server backend4.example.com:12346;\n}\n```\n\n----------------------------------------\n\nTITLE: Example nginx-agent.conf file\nDESCRIPTION: This is an example configuration file (`nginx-agent.conf`) for the NGINX Agent. It defines settings for the server, TLS, logging, dataplane status reporting, metrics collection, NGINX configuration directories, and NGINX App Protect integration.  Key settings include the host and gRPC port for NGINX Management Suite, TLS configuration, log level and path, dataplane status polling and reporting intervals, metrics collection intervals, and paths to NGINX configuration directories.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\n#\n# /etc/nginx-agent/nginx-agent.conf\n#\n# Configuration file for NGINX Agent.\n#\n# This file tracks agent configuration values that are meant to be statically set. There\n# are additional agent configuration values that are set via the API and agent install script\n# which can be found in /var/lib/nginx-agent/agent-dynamic.conf.\n\n# specify the server grpc port to connect to\nserver:\n  # host of the control plane\n  host: <NMS_FQDN>\n  grpcPort: 443\n# tls options\ntls:\n  # enable tls in the nginx-agent setup for grpcs\n  # default to enable to connect with secure connection but without client cert for mtls\n  enable: true\n  # controls whether the server certificate chain and host name are verified.\n  # for production use, see instructions for configuring TLS\n  skip_verify: false\nlog:\n  # set log level (panic, fatal, error, info, debug, trace; default \"info\")\n  level: info\n  # set log path. if empty, don't log to file.\n  path: /var/log/nginx-agent/\nnginx:\n  # path of NGINX logs to exclude\n  exclude_logs: \"\"\n# data plane status message / 'heartbeat'\ndataplane:\n  status:\n    # poll interval for dataplane status - the frequency the agent will query the dataplane for changes\n    poll_interval: 30s\n    # report interval for dataplane status - the maximum duration to wait before syncing dataplane information if no updates have been observed\n    report_interval: 24h\nmetrics:\n  # specify the size of a buffer to build before sending metrics\n  bulk_size: 20\n  # specify metrics poll interval\n  report_interval: 1m\n  collection_interval: 15s\n  mode: aggregated\n\n# OSS NGINX default config path\n# path to aux file dirs can also be added\nconfig_dirs: \"/etc/nginx:/usr/local/etc/nginx:/usr/share/nginx/modules:/etc/nms:/etc/app_protect\"\n\nextensions:\n  - nginx-app-protect\n\n# Enable reporting NGINX App Protect details to the control plane.\nnginx_app_protect:\n  # Report interval for NGINX App Protect details - the frequency NGINX Agent checks NGINX App Protect for changes.\n  report_interval: 15s\n  # Enable precompiled publication from the NGINX Management Suite (true) or perform compilation on the data plane host (false).\n  precompiled_publication: true\n```\n\n----------------------------------------\n\nTITLE: Defining Upstream Groups in NGINX Stream\nDESCRIPTION: This code snippet demonstrates how to define upstream groups for TCP and UDP servers within the `stream` context. The `upstream` blocks define a group of servers to which traffic will be load balanced.  The `proxy_pass` directive is used to reference these upstream groups.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n\n    upstream stream_backend {\n        # ...\n    }\n\n    upstream dns_servers {\n        # ...\n    }\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: JSON Request example for creating security policy\nDESCRIPTION: This is an example of the JSON payload used to create a security policy via the NGINX Instance Manager REST API. The `content` field contains the base64 encoded security policy definition. The 'name' field identifies the policy\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"metadata\": {\n    \"name\": \"ignore-cross-site-scripting\",\n    \"displayName\": \"Ignore cross-site scripting\",\n    \"description\": \"Ignore cross-site scripting is a security policy that intentionally ignores cross site scripting.\"\n  },\n  \"content\": \"ewoJInBvbGljeSI6IHsKCQkibmFtZSI6ICJzaW1wbGUtYmxvY2tpbmctcG9saWN5IiwKCQkic2lnbmF0dXJlcyI6IFsKCQkJewoJCQkJInNpZ25hdHVyZUlkIjogMjAwMDAxODM0LAoJCQkJImVuYWJsZWQiOiBmYWxzZQoJCQl9CgkJXSwKCQkidGVtcGxhdGUiOiB7CgkJCSJuYW1lIjogIlBPTElDWV9URU1QTEFURV9OR0lOWF9CQVNFIgoJCX0sCgkJImFwcGxpY2F0aW9uTGFuZ3VhZ2UiOiAidXRmLTgiLAoJCSJlbmZvcmNlbWVudE1vZGUiOiAiYmxvY2tpbmciCgl9Cn0=\"\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP Block for API Access NGINX\nDESCRIPTION: This snippet creates or ensures the presence of the top-level `http` block in the Nginx configuration file.  It is a prerequisite for subsequent configuration steps to enable the API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Defining a Custom Log Format in Nginx\nDESCRIPTION: This snippet defines a custom log format named `compression` which extends the predefined `combined` format with the value indicating the ratio of gzip compression of the response.  It also configures a virtual server to use this format.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/logging.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    log_format compression '$remote_addr - $remote_user [$time_local] '\n                           '\"$request\" $status $body_bytes_sent '\n                           '\"$http_referer\" \"$http_user_agent\" \"$gzip_ratio\"';\n\n    server {\n        gzip on;\n        access_log /spool/logs/nginx-access.log compression;\n        ...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Pass OIDC Claims as Headers to Application\nDESCRIPTION: This snippet passes OIDC claims from the ID token as HTTP headers to the backend application. The `proxy_set_header` directive is used to set the `sub`, `email`, and `name` headers with corresponding OIDC claim values.  The application receives these headers and can use them to identify the user.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/active-directory-federation-services.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n\n     auth_oidc adfs;\n\n     proxy_set_header sub   $oidc_claim_sub;\n     proxy_set_header email $oidc_claim_email;\n     proxy_set_header name  $oidc_claim_name;\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: NGINX Include Directive\nDESCRIPTION: This snippet demonstrates how to include other configuration files and JavaScript modules within an NGINX configuration using the `include` and `js_import` directives.  This is important for modularizing the Nginx configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configuration-portal.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n   include nginx/servers/server1.conf;\n   js_import nginx/njs.js;\n   # ...\n}\n```\n\n----------------------------------------\n\nTITLE: HTTPS Servers with Separate IP Addresses - Nginx\nDESCRIPTION: This configuration demonstrates the solution of assigning separate IP addresses to each HTTPS server to avoid the certificate issue.  Each server block listens on a unique IP address and port 443 with SSL enabled, ensuring that the correct certificate is served for each domain.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen          192.168.1.1:443 ssl;\n    server_name     www.example.com;\n    ssl_certificate www.example.com.crt;\n    #...\n}\n\nserver {\n    listen          192.168.1.2:443 ssl;\n    server_name     www.example.org;\n    ssl_certificate www.example.org.crt;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Limiting Connections to Upstream Servers in NGINX Plus\nDESCRIPTION: This snippet configures a limit on the number of active connections to an upstream server using the `max_conns` parameter in NGINX Plus. If the limit is reached, requests are placed in a queue with a maximum size of 100 and a timeout of 70 seconds. Clients receive an error if the queue is full or the timeout expires.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    server backend1.example.com max_conns=3;\n    server backend2.example.com;\n    queue 100 timeout=70;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Group with Sticky Cookie - Nginx\nDESCRIPTION: This snippet configures an upstream group named 'nodejs' with sticky cookie session persistence. It defines a shared memory zone and sets parameters for the cookie, including name, expiration, domain, and path. It assumes that the `ip_hash` directive has been removed or commented out.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_24\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream nodejs {\n    zone nodejs 64k;\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n    sticky cookie srv_id expires=1h domain=.example.com path=/;\n}\n```\n\n----------------------------------------\n\nTITLE: Optimizing HTTPS with Session Cache\nDESCRIPTION: This snippet demonstrates optimizing HTTPS performance by enabling session caching. It configures a shared SSL session cache using `ssl_session_cache` and sets a session timeout using `ssl_session_timeout`.  This minimizes the number of full SSL handshakes, improving performance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nworker_processes auto;\n\nhttp {\n    ssl_session_cache   shared:SSL:10m;\n    ssl_session_timeout 10m;\n\n    server {\n        listen              443 ssl;\n        server_name         www.example.com;\n        keepalive_timeout   70;\n\n        ssl_certificate     www.example.com.crt;\n        ssl_certificate_key www.example.com.key;\n        ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\n        ssl_ciphers         HIGH:!aNULL:!MD5;\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Index File Configuration in Nginx\nDESCRIPTION: This snippet shows how to define multiple index files for a location. NGINX searches for the files in the specified order and returns the first one it finds. It also demonstrates usage of custom variables.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    index index.$geo.html index.htm index.html;\n}\n```\n\n----------------------------------------\n\nTITLE: Accessing WAF Enforcer Container Logs with Kubectl\nDESCRIPTION: This command allows you to view the logs from the `waf-enforcer` container in a Kubernetes environment.  It assumes that the deployment is named `nap5-deployment`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/logging-overview/logs-overview.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nkubectl logs deployment.apps/nap5-deployment -c waf-enforcer\n```\n\n----------------------------------------\n\nTITLE: Brute Force Protection Policy - Universal in JSON\nDESCRIPTION: This JSON snippet defines a brute force protection policy that applies universally to all login pages. It configures thresholds for login attempts from the same IP and the same user, with the action set to 'alarm'. It also sets a re-enable login time and a source-based protection detection period.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_19\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"BruteForcePolicy\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"brute-force-attack-preventions\" : [\n            {\n               \"bruteForceProtectionForAllLoginPages\" : true,\n               \"loginAttemptsFromTheSameIp\" : {\n                  \"action\" : \"alarm\",\n                  \"enabled\" : true,\n                  \"threshold\" : 20\n               },\n               \"loginAttemptsFromTheSameUser\" : {\n                  \"action\" : \"alarm\",\n                  \"enabled\" : true,\n                  \"threshold\" : 3\n               },\n               \"reEnableLoginAfter\" : 3600,\n               \"sourceBasedProtectionDetectionPeriod\" : 3600\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling NGINX App Protect WAF\nDESCRIPTION: This snippet enables NGINX App Protect WAF on an `http/server/location` context. The `app_protect_enable on;` directive activates the WAF for the specified location, ensuring traffic passing through that location is inspected and protected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enable on;\n```\n\n----------------------------------------\n\nTITLE: Enabling NGINX App Protect WAF (Nginx)\nDESCRIPTION: Enables NGINX App Protect WAF in a specific `http/server/location` context. It uses the `app_protect_enable on;` directive, ensuring it's only enabled in locations using `proxy_pass` or `grpc_pass`. This activates the WAF for incoming requests to that location.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_18\n\nLANGUAGE: Nginx\nCODE:\n```\napp_protect_enable on;\n```\n\n----------------------------------------\n\nTITLE: Restricting Access by IP Address - Nginx\nDESCRIPTION: This snippet demonstrates how to use the `allow` and `deny` directives in the `stream` context to restrict access to proxied TCP resources based on client IP addresses.  The rules are evaluated sequentially.  The example allows a specific subnet, an IPv6 range, and denies all other IP addresses.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-tcp.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    server {\n        listen 12345;\n        deny   192.168.1.2;\n        allow  192.168.1.1/24;\n        allow  2001:0db8::/32;\n        deny   all;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Tuning the Operating System (Linux)\nDESCRIPTION: This snippet shows how to increase the value of the `net.core.somaxconn` kernel parameter on Linux to allow for a larger burst of traffic. It also demonstrates adding the parameter to `/etc/sysctl.conf` to make the change permanent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_12\n\nLANGUAGE: none\nCODE:\n```\nsudo sysctl -w net.core.somaxconn=4096\n```\n\nLANGUAGE: none\nCODE:\n```\nnet.core.somaxconn = 4096\n```\n\n----------------------------------------\n\nTITLE: Complete SSL Termination Example\nDESCRIPTION: This snippet presents a complete configuration example of SSL termination for a TCP stream in NGINX Plus.  It includes upstream definition, SSL enabling, certificate configuration, protocol/cipher settings, and session caching/timeout optimization. This configuration decrypts the SSL traffic from clients and forwards the data unencrypted to the backend servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-tcp.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    upstream stream_backend {\n         server backend1.example.com:12345;\n         server backend2.example.com:12345;\n         server backend3.example.com:12345;\n    }\n\n    server {\n        listen                12345 ssl;\n        proxy_pass            stream_backend;\n\n        ssl_certificate       /etc/ssl/certs/server.crt;\n        ssl_certificate_key   /etc/ssl/certs/server.key;\n        ssl_protocols         SSLv3 TLSv1 TLSv1.1 TLSv1.2;\n        ssl_ciphers           HIGH:!aNULL:!MD5;\n        ssl_session_cache     shared:SSL:20m;\n        ssl_session_timeout   4h;\n        ssl_handshake_timeout 30s;\n        #...\n     }\n}\n```\n\n----------------------------------------\n\nTITLE: Full Nginx Configuration for Basic Load Balancing\nDESCRIPTION: This is a complete Nginx configuration example for basic load balancing across multiple Tomcat application servers. It configures caching, HTTP/2 support, redirects HTTP to HTTPS, sets up upstream servers, and handles WebSocket connections, demonstrating a comprehensive setup for a Tomcat application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_25\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /tmp/NGINX_cache/ keys_zone=backcache:10m;\n\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n\nupstream tomcat {\n    # Use IP Hash for session persistence\n    ip_hash;\n    # List of Tomcat application servers\n    server 10.100.100.11:8080;\n    server 10.100.100.12:8080;\n}\n\nserver {\n    listen 80;\n    server_name example.com;\n    # Redirect all HTTP requests to HTTPS\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n\nserver {\n    listen 443 ssl;\n    http2  on;\n\n    server_name example.com;\n    ssl_certificate     /etc/nginx/ssl/example.com.crt;\n    ssl_certificate_key /etc/nginx/ssl/example.com.key;\n    ssl_session_cache   shared:SSL:1m;\n    ssl_prefer_server_ciphers on;\n\n    # Load balance requests for '/tomcat-app/' across Tomcat application\n    # servers\n    location /tomcat-app/ {\n        proxy_pass http://tomcat;\n        proxy_cache backcache;\n    }\n\n    # Return a temporary redirect to '/tomcat-app/' when user requests '/'\n    location = / {\n        return 302 /tomcat-app/;\n    }\n\n    # WebSocket configuration\n    location /wstunnel/ {\n        proxy_pass https://tomcat;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Health Checks for Exchange Applications Nginx\nDESCRIPTION: These `location` blocks configure Nginx Plus health checks for Exchange applications (ecp, mapi, owa). The `health_check` directive specifies the URI to check, the interval, and the match block defined earlier. These blocks also include proxy pass configuration to route traffic to the backend servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_50\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic location\nlocation /ecp {\n    #allow 172.16.0.0/16; # Replace with your admin network\n    #deny all;\n    proxy_pass https://exchange-ecp;\n    proxy_http_version 1.1;\n    proxy_set_header Connection \"\";\n    health_check uri=/ecp/healthcheck.htm interval=3s\n                 match=exchange-health;\n}\n\nlocation /mapi {\n    proxy_pass https://exchange-mapi;\n    proxy_http_version 1.1;\n    proxy_set_header Connection \"\";\n    health_check uri=/mapi/healthcheck.htm interval=3s\n                 match=exchange-health;\n}\n\nlocation /owa {\n    proxy_pass https://exchange-owa;\n    proxy_http_version 1.1;\n    proxy_set_header Connection \"\";\n    health_check uri=/owa/healthcheck.htm interval=3s\n                 match=exchange-health;\n}\n```\n\n----------------------------------------\n\nTITLE: Defining Key-Value Zone with State in Nginx\nDESCRIPTION: This configuration defines a key-value zone named 'one' with a size of 1MB and specifies that it will store IP addresses. The `state` parameter specifies a file where the key-value database is stored to persist data across reloads and restarts of Nginx Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nkeyval_zone zone=one:1m state=one.keyval;\n```\n\n----------------------------------------\n\nTITLE: Enabling Nginx App Protect WAF\nDESCRIPTION: This Nginx configuration snippet enables Nginx App Protect WAF on an `http/server/location` context.  It activates the security policies for the specified location. The comment indicates the need to only enable Nginx App Protect WAF with `proxy_pass`/`grpc_pass` locations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_20\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enable on;\n```\n\n----------------------------------------\n\nTITLE: Define OIDC Provider in NGINX\nDESCRIPTION: This snippet defines the OIDC provider named `my_idp` within the `http` context of the NGINX configuration. This allows specifying the issuer, client ID, client secret, and SSL certificate for validating the IdP's TLS certificates. Replace placeholders with actual values obtained from the IdP.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-oidc.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider my_idp {\n\n        # ...\n\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect WAF Access Profile Configuration\nDESCRIPTION: This JSON snippet demonstrates a sample Nginx App Protect WAF policy configuration that includes an access profile named 'access_profile_jwt' to enforce JWT settings. It defines enforcement settings, key files, location, maximum length, and verification for the token, which is located in the authorization header. It also includes URL settings associating the access profile with the '/jwt' path.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_9\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"jwt_policy\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"access-profiles\": [\n         {\n            \"description\": \"\",\n            \"enforceMaximumLength\": true,\n            \"enforceValidityPeriod\": false,\n            \"keyFiles\": [\n               {\n                  \"contents\": \"{\\r\\n  \\\"keys\\\": [\\r\\n    {\\r\\n      \\\"alg\\\": \\\"RS256\\\",\\r\\n      \\\"e\\\": \\\"AQAB\\\",\\r\\n      \\\"kid\\\": \\\"1234\\\",\\r\\n      \\\"kty\\\": \\\"RSA\\\",\\r\\n      \\\"n\\\": \\\"tSbi8WYTScbuM4fe5qe4l60A2SG5oo3u5JDBtH_dPJTeQICRkrgLD6oyyHJc9BCe9abX4FEq_Qd1SYHBdl838g48FWblISBpn9--B4D9O5TPh90zAYP65VnViKun__XHGrfGT65S9HFykvo2KxhtxOFAFw0rE6s5nnKPwhYbV7omVS71KeT3B_u7wHsfyBXujr_cxzFYmyg165Yx9Z5vI1D-pg4EJLXIo5qZDxr82jlIB6EdLCL2s5vtmDhHzwQSdSOMWEp706UgjPl_NFMideiPXsEzdcx2y1cS97gyElhmWcODl4q3RgcGTlWIPFhrnobhoRtiCZzvlphu8Nqn6Q\\\",\\r\\n      \\\"use\\\": \\\"sig\\\",\\r\\n      \\\"x5c\\\": [\\r\\n        \\\"MIID1zCCAr+gAwIBAgIJAJ/bOlwBpErqMA0GCSqGSIb3DQEBCwUAMIGAMQswCQYDVQQGEwJpbDEPMA0GA1UECAwGaXNyYWVsMRAwDgYDVQQHDAd0ZWxhdml2MRMwEQYDVQQKDApmNW5ldHdvcmtzMQwwCgYDVQQLDANkZXYxDDAKBgNVBAMMA21heDEdMBsGCSqGSIb3DQEJARYOaG93ZHlAbWF0ZS5jb20wIBcNMjIxMTA3MTM0ODQzWhgPMjA1MDAzMjUxMzQ4NDNaMIGAMQswCQYDVQQGEwJpbDEPMA0GA1UECAwGaXNyYWVsMRAwDgYDVQQHDAd0ZWxhdml2MRMwEQYDVQQKDApmNW5ldHdvcmtzMQwwCgYDVQQLDANkZXYxDDAKBgNVBAMMA21heDEdMBsGCSqGSIb3DQEJARYOaG93ZHlAbWF0ZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC1JuLxZhNJxu4zh97mp7iXrQDZIbmije7kkMG0f908lN5AgJGSuAsPqjLIclz0EJ71ptfgUSr9B3VJgcF2XzfyDjwVZuUhIGmf374HgP07lM+H3TMBg/rlWdWIq6f/9ccat8ZPrlL0cXKS+jYrGG3E4UAXDSsTqzmeco/CFhtXuiZVLvUp5PcH+7vAex/IFe6Ov9zHMVibKDXrljH1nm8jUP6mDgQktcijmpkPGvzaOUgHoR0sIvazm+2YOEfPBBJ1I4xYSnvTpSCM+X80UyJ16I9ewTN1zHbLVxL3uDISWGZZw4OXirdGBwZOVYg8WGuehuGhG2IJnO+WmG7w2qfpAgMBAAGjUDBOMB0GA1UdDgQWBBSHykVOY3Q1bWmwFmJbzBkQdyGtkTAfBgNVHSMEGDAWgBSHykVOY3Q1bWmwFmJbzBkQdyGtkTAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQCgcgp72Xw6qzbGLHyNMaCm9A6smtquKTdFCXLWVSOBix6WAJGPv1iKOvvMNF8ZV2RU44vS4Qa+o1ViBN8DXuddmRbShtvxcJzRKy1I73szZBMlZL6euRB1KN4m8tBtDj+rfKtPpheMtwIPbiukRjJrzRzSz3LXAAlxEIEgYSifKpL/okYZYRY6JF5PwSR0cvrfe/qa/G2iYF6Ps7knxy424RK6gpMbnhxb2gdhLPqDE50uxkr6dVHXbc85AuwAi983tOMhTyzDh3XTBEt2hr26F7jSeniC7TTIxmMgDdtYzRMwdb1XbubdtzUPnB/SW7jemK9I45kpKlUBDZD/QwER\\\"\\r\\n      ]\\r\\n    }\\r\\n  ]\\r\\n}\",  # there can be more only one JWKs file (contents) in the policy JSON schema, however, the total amount of JWK in the JWKs is limited to 10.\n                  \"fileName\": \"JWKSFile.json\"\n               }\n            ],\n            \"location\": {\n               \"in\": \"header\",  # the other option is: \"query\"\n               \"name\": \"authorization\"  # the name of the header or parameter (according to \"part\")\n            },\n            \"maximumLength\": 2000,\n            \"name\": \"access_profile_jwt\",\n            \"type\": \"jwt\",\n            \"usernameExtraction\": {\n               \"claimPropertyName\": \"sub\",\n               \"enabled\": true,\n               \"isMandatory\": false\n            },\n            \"verifyDigitalSignature\": true\n        }\n      ],\n      \"urls\": [\n         {\n            \"name\": \"/jwt\",\n            \"accessProfile\": {\n               \"name\": \"access_profile_jwt\"\n            },\n            \"attackSignaturesCheck\": true,\n            \"isAllowed\": true,\n            \"mandatoryBody\": false,\n            \"method\": \"*\",\n            \"methodsOverrideOnUrlCheck\": false,\n            \"name\": \"/jwt\",\n            \"performStaging\": false,\n            \"protocol\": \"http\",\n            \"type\": \"explicit\"\n         }\n      ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Dynamic Bandwidth Control based on TLS version in NGINX\nDESCRIPTION: This configuration demonstrates how to dynamically control bandwidth based on the TLS version using the `map` directive and a variable with `limit_rate`. Bandwidth is adjusted according to the TLS protocol used, with higher bandwidths for newer versions. A rate limit is applied after the headers have been sent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nmap $ssl_protocol $response_rate {\n    \"TLSv1.1\" 10k;\n    \"TLSv1.2\" 100k;\n    \"TLSv1.3\" 1000k;\n}\n\nserver {\n    listen 443 ssl;\n    ssl_protocols       TLSv1.1 TLSv1.2 TLSv1.3;\n    ssl_certificate     www.example.com.crt;\n    ssl_certificate_key www.example.com.key;\n\n    location / {\n        limit_rate       $response_rate; # Limit bandwidth based on TLS version\n        limit_rate_after 512;      # Apply limit after headers have been sent\n        proxy_pass       http://my_backend;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS Resolver and Upstream with Resolve - Nginx\nDESCRIPTION: This configuration snippet configures the DNS resolver and enables dynamic resolution of the upstream server's domain name. The 'resolver' directive specifies the IP address of the DNS server. The 'resolve' parameter in the 'server' directive instructs NGINX Plus to periodically re-resolve the domain name using DNS. The zone directive creates shared memory for upstream configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_42\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nresolver <IP-address-of-DNS-server>;\n\nupstream tomcat {\n    zone tomcat 64k;\n    server example.com resolve;\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling NGINX Plus API in Nginx\nDESCRIPTION: This configuration enables the NGINX Plus API in read-write mode for managing the key-value store.  It exposes the API at the `/api` location, listening on port 80 for the domain `www.example.com`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\n server {\n  listen 80;\n  server_name www.example.com;\n\n  location /api {\n   api write=on;\n  }\n }\n```\n\n----------------------------------------\n\nTITLE: Enabling Mandatory Health Checks in Nginx\nDESCRIPTION: This code configures mandatory and persistent health checks for an upstream server. The `mandatory` parameter ensures that newly added servers pass all health checks before receiving traffic. The `persistent` parameter ensures the health check state is remembered across configuration reloads.  `slow_start` gives the server time to warm up.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-health-check.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nupstream my_upstream {\n    zone   my_upstream 64k;\n    server backend1.example.com slow_start=30s;\n}\n\nserver {\n    location / {\n        proxy_pass   http://my_upstream;\n        health_check mandatory persistent;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Testing and Reloading NGINX Configuration\nDESCRIPTION: This command checks the NGINX configuration file for syntactic validity using `nginx -t` and then reloads NGINX if the configuration is valid using `nginx -s reload`. This ensures that the new configuration is applied without interrupting service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_40\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t && nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration with Strict Policy\nDESCRIPTION: This snippet showcases a minimal Nginx configuration enabling App Protect with the strict policy. It enables App Protect, specifies the `app_protect_strict_policy`, enables security logging, and configures a proxy pass.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n\n        # NGINX App Protect WAF\n        app_protect_enable on;\n        app_protect_policy_file app_protect_strict_policy;\n        app_protect_security_log_enable on;\n        app_protect_security_log log_all stderr;\n\n        proxy_pass http://127.0.0.1:8080/;\n    }\n```\n\n----------------------------------------\n\nTITLE: Enabling Gunzip Decompression in NGINX\nDESCRIPTION: This snippet enables runtime decompression for clients that do not support gzip encoding, useful for serving both clients that do and do not accept compressed data.  Requires the ngx_http_gunzip_module, which might not be included in an NGINX Open Source build by default.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/compression.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /storage/ {\n    gunzip on;\n    ...\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling HTTP/2 Support\nDESCRIPTION: This configuration snippet enables HTTP/2 support in NGINX for a specific server block. It requires the 'listen' directive to be configured for HTTPS traffic with SSL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_24\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlisten 443 ssl;\nhttp2  on;\n```\n\n----------------------------------------\n\nTITLE: Multiple auth_jwt_require Directives - Nginx Configuration\nDESCRIPTION: This snippet shows how to use multiple `auth_jwt_require` directives for different purposes, such as authentication and authorization.  A custom error code (403) is assigned to the second `auth_jwt_require` directive to differentiate authentication and authorization failures.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\n    location /products/ {\n        auth_jwt          \"API\";\n        auth_jwt_key_file conf/api_secret.jwk;\n        auth_jwt_require  $valid_app_id $valid_issuer $valid_scope;\n        auth_jwt_require  $valid_scope error=403;\n        proxy_pass        http://api_server;\n    }\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Agent with App Protect Mode\nDESCRIPTION: This bash snippet shows how to use the NGINX Agent installation script and specify the `--nginx-app-protect-mode` flag to set up management of NGINX App Protect. The example sets the `precompiled_publication` configuration field to `true`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\n# Download install script via API\ncurl https://<NMS_FQDN>/install/nginx-agent > install.sh\n\n# Specify the -m | --nginx-app-protect-mode flag to set up management of NGINX App Protect on\n# the instance. In the example below we specify 'precompiled-publication' for the flag value\n# which will make the config field 'precompiled_publication' set to 'true', if you would like to\n# set the config field 'precompiled_publication' to 'false' you can specify 'none' as the flag value.\nsudo sh ./install.sh --nginx-app-protect-mode precompiled-publication\n```\n\n----------------------------------------\n\nTITLE: Upstream gRPC server group configuration in Nginx\nDESCRIPTION: Configures an upstream group of servers that handles gRPC network traffic and specifies a shared memory zone. This allows Nginx to keep track of the servers' states. It defines two servers as part of the grpc_backend group listening on port 50051.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/grpc-health-check.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    upstream grpc_backend {\n        zone   grpc_backend 64k;\n        server 10.0.0.1:50051;\n        server 10.0.0.2:50051;\n    }\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream and Server blocks Nginx\nDESCRIPTION: This Nginx configuration defines upstream blocks for two applications (app1 and app2) and a server block to handle incoming requests.  It sets up load balancing for the applications using proxy_pass and configures locations for different resources, including an API and status dashboard.  The upstream directives require replacing the placeholder IP addresses with the actual IP addresses of your application servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/setting-up-nginx-demo-environment.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\n# in the 'http' context\n   upstream app1 {\n       server <internal IP address of NGINX Open Source instance serving App 1>;\n       # 'server' directives for additional App 1 servers, if using\n       zone app1 64k;\n   }\n\n   upstream app2 {\n       server <internal IP address of NGINX Open Source instance serving App 2>;\n       # 'server' directives for additional App 2 servers, if using\n       zone app2 64k;\n   }\n\n   server {\n       listen 80;\n       status_zone backend;\n       root /usr/share/nginx/html;\n\n       location / {\n           # directives for serving the site's HTML landing page\n       }\n\n       location /application1 {\n           proxy_set_header Host $host;\n           proxy_set_header X-Forwarded-For $remote_addr;\n           proxy_pass http://app1/;\n       }\n\n       location /application2 {\n           proxy_set_header Host $host;\n           proxy_set_header X-Forwarded-For $remote_addr;\n           proxy_pass http://app2/;\n       }\n\n       location /api {\n           api write=on;\n           # directives to control access, such as 'allow' and 'deny'\n       }\n\n       location = /dashboard.html {\n           root /usr/share/nginx/html;\n       }\n\n       location = /status.html {  # redirect requests that are made to pre-R14 dashboard\n           return 301 /dashboard.html;\n       }\n   }\n```\n\n----------------------------------------\n\nTITLE: Configuring Virtual Server for SMTP Traffic (Nginx)\nDESCRIPTION: This snippet configures a virtual server to proxy SMTP traffic on port 25 to the 'exchange-smtp' upstream group. The `status_zone` directive enables monitoring for this virtual server. The SMTP port can be changed here. This configuration goes inside the 'stream' block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_28\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'stream' block\nserver {\n    listen 25; # SMTP port can be changed here (to 587, for example)\n    status_zone exchange-smtp;\n    proxy_pass exchange-smtp;\n}\n```\n\n----------------------------------------\n\nTITLE: Proxying Microsoft Exchange Traffic in NGINX\nDESCRIPTION: This snippet shows how to configure NGINX to proxy Microsoft Exchange traffic to an upstream group of servers. It sets the `proxy_pass` directive to point to the upstream group, configures HTTP version and connection headers, and includes the `ntlm` directive in the upstream block to allow NTLM authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_18\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    proxy_pass https://exchange;\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Consistent Hash Load Balancing in NGINX Stream\nDESCRIPTION: This snippet shows how to configure consistent hashing for session persistence using the `hash` directive with the `consistent` parameter. This ensures that connections from a given client are always passed to the same server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nhash $remote_addr consistent;\n```\n\n----------------------------------------\n\nTITLE: Combining IP Restriction and Authentication with 'satisfy all' in Nginx\nDESCRIPTION: This snippet combines IP address-based access control with HTTP Basic authentication using the `satisfy all` directive. This requires clients to both pass the IP address restrictions and provide valid credentials for access to be granted.  `auth_basic_user_file` should point to a valid htpasswd file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-http-basic-authentication.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /api {\n    #...\n    satisfy all;\n\n    deny  192.168.1.2;\n    allow 192.168.1.1/24;\n    allow 127.0.0.1;\n    deny  all;\n\n    auth_basic           \"Administrator’s Area\";\n    auth_basic_user_file conf/htpasswd;\n}\n```\n\n----------------------------------------\n\nTITLE: Fetching JWKs from Subrequest - Nginx Configuration\nDESCRIPTION: This configuration snippet demonstrates how to configure Nginx Plus to fetch JSON Web Keys (JWKs) from a remote location using a subrequest. The `auth_jwt_key_request` directive specifies the URI for the subrequest, while `proxy_cache` and `proxy_cache_path` are used for caching the JWKs to avoid validation overhead. The URI may refer to an internal location to utilize caching mechanisms.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n\n    server {\n        listen 80;\n            #...\n\n        location / {\n            auth_jwt \"closed site\";\n            auth_jwt_key_request /_jwks_uri; # Keys will be fetched by subrequest\n\n            proxy_pass http://my_backend;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Protecting a Location with Okta OIDC\nDESCRIPTION: This snippet protects a specific location (`/`) with Okta OIDC by using the `auth_oidc okta` directive. This directive tells NGINX to authenticate requests to this location using the `okta` OIDC provider defined earlier.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/okta.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc okta;\n\n     # ...\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Enabling Active Health Checks in Nginx Plus\nDESCRIPTION: This snippet enables active health checks for the `backend` upstream group. The `health_check` directive in the `location /` block tells NGINX Plus to send health check requests to the servers in the `backend` group. By default, it sends a request for \"/\" every five seconds.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-health-check.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    location / {\n        proxy_pass http://backend;\n        health_check;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Basic Rate Limiting Nginx\nDESCRIPTION: This snippet demonstrates configuring basic rate limiting in Nginx. It defines a limit_req_zone and applies it to the /login/ location. It uses the $binary_remote_addr variable as the key for limiting and sets a rate of 1 request per second, storing state in a shared memory zone named mylimit with a size of 10MB.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/rate-limiting.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n\n    limit_req_zone $binary_remote_addr zone=mylimit:10m rate=1r/s;\n\n    server {\n        #...\n\n        location /login/ {\n            limit_req zone=mylimit;\n\n        }\n}\n```\n\n----------------------------------------\n\nTITLE: Rewriting URIs in Nginx with Break Flag\nDESCRIPTION: This snippet rewrites a URI using the `rewrite` directive.  When a request is made to a URI starting with `/users/`, it's rewritten to `/show?user=$1`, where `$1` is the captured group from the regular expression. The `break` flag stops further rewrite processing in the current context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /users/ {\n    rewrite ^/users/(.*)$ /show?user=$1 break;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring SSL Protocols and Ciphers for Nginx TCP Proxy\nDESCRIPTION: This snippet configures the SSL protocols and ciphers used for the secure connection. The `proxy_ssl_protocols` and `proxy_ssl_ciphers` directives control which protocols and ciphers are allowed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-tcp-traffic-upstream.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n        ...\n        proxy_ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        proxy_ssl_ciphers   HIGH:!aNULL:!MD5;\n}\n```\n\n----------------------------------------\n\nTITLE: Copy Content and Config Files in Dockerfile (Dockerfile)\nDESCRIPTION: This Dockerfile copies content and configuration files from the Docker host to the Nginx container. It first removes the default Nginx configuration file, then copies the content directory to /usr/share/nginx/html and the conf directory to /etc/nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_20\n\nLANGUAGE: dockerfile\nCODE:\n```\nFROM nginx\nRUN rm /etc/nginx/conf.d/default.conf\nCOPY content /usr/share/nginx/html\nCOPY conf /etc/nginx\n```\n\n----------------------------------------\n\nTITLE: Setting request headers in Nginx proxy\nDESCRIPTION: This snippet demonstrates how to set custom request headers when proxying requests to a backend server. The `proxy_set_header` directive allows modifying the 'Host' and 'X-Real-IP' headers, and these modified requests are sent to the proxied server. The `$host` variable represents the original host requested by the client, and `$remote_addr` is the client's IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/reverse-proxy.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /some/path/ {\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_pass http://localhost:8000;\n}\n```\n\n----------------------------------------\n\nTITLE: Specifying an OCSP Responder\nDESCRIPTION: This snippet demonstrates configuring the OCSP responder URI. Nginx sends OCSP requests to this URI instead of the one embedded in the client certificate. Only HTTP OCSP responders are supported.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\n#...\nssl_ocsp_responder http://ocsp.example.com/;\n#...\n```\n\n----------------------------------------\n\nTITLE: Verify and Reload Nginx\nDESCRIPTION: Verifies the validity of the Nginx configuration file and reloads Nginx to apply the changes.  The `nginx -t` command tests the configuration syntax. The `nginx -s reload` command gracefully restarts Nginx without downtime.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/route-53-global-server-load-balancing.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Returning 404 Status Code in Nginx\nDESCRIPTION: This snippet configures NGINX to return a 404 Not Found status code when a request is made to the `/wrong/url` location. This is done using the `return` directive within a `location` block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /wrong/url {\n    return 404;\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration for Django Project\nDESCRIPTION: This NGINX configuration defines an upstream called `django` that points to the uWSGI server. It configures NGINX to listen on port 80, serve static content directly, and proxy requests to the `/main` location to the uWSGI server using the uwsgi protocol. The configuration also sets necessary uwsgi parameters to pass information from NGINX to the uWSGI application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/app-gateway-uwsgi-django.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    upstream django {\n        server 127.0.0.1:29000;\n    }\n\n    server {\n        listen 80;\n        server_name myapp.example.com;\n        root /var/www/myapp/html;\n\n        location / {\n            index index.html;\n        }\n\n        location /static/  {\n            alias /var/django/projects/myapp/static/;\n        }\n\n        location /main {\n            include /etc/nginx/uwsgi_params;\n            uwsgi_pass django;\n            uwsgi_param Host $host;\n            uwsgi_param X-Real-IP $remote_addr;\n            uwsgi_param X-Forwarded-For $proxy_add_x_forwarded_for;\n            uwsgi_param X-Forwarded-Proto $http_x_forwarded_proto;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Creating Allowed HTTP Methods Policy via API (JSON)\nDESCRIPTION: This JSON payload defines an Allowed HTTP Methods policy.  It configures the allowed HTTP methods and the return code for disallowed methods. The `allowedMethods` array specifies the HTTP methods to allow, and `returnCode` sets the HTTP status code returned when a disallowed method is used.  A POST request to the Proxies endpoint is used to apply this policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/allowed-http-methods.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n    \"allowed-http-methods\": [\n      {\n        \"action\": {\n          \"allowedMethods\": [\n            \"GET\",\n            \"PUT\",\n            \"POST\",\n            \"PATCH\",\n            \"DELETE\",\n            \"CONNECT\",\n            \"OPTIONS\",\n            \"TRACE\"\n          ],\n          \"returnCode\": 405\n        }\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Security Logging with app_protect_security_log_enable in Nginx\nDESCRIPTION: This example demonstrates how to enable security logging using the `app_protect_security_log_enable` directive. It specifies that security logging should be turned on in the current context (http, server, or location).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/logging-overview/security-log.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log_enable on\n```\n\n----------------------------------------\n\nTITLE: Nested JWT Configuration - Nginx Configuration\nDESCRIPTION: This snippet configures Nginx Plus to handle nested JWTs (JWE containing a JWS). The `auth_jwt_type nested` directive enables nested JWT support. The `$jwt_payload` variable, representing the decrypted JWS payload, is passed to the backend application in the Authorization header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\nauth_jwt_type nested;\n```\n\n----------------------------------------\n\nTITLE: Complete Nginx Configuration for GeoIP2 Redirection\nDESCRIPTION: This example demonstrates a complete Nginx configuration using GeoIP2 and upstream server groups for continent-based redirection. It includes the `geoip2`, `map`, `server`, and `upstream` blocks required to implement this functionality within either the `http {}` or `stream {}` contexts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_17\n\nLANGUAGE: nginx\nCODE:\n```\n# can be either \"http {}\" or \"stream {}\"\n#...\ngeoip2 GeoIP2/GeoLite2-Country.mmdb {\n    $geoip2_data_continent_code continent code;\n}\n\nmap $geoip2_data_continent_code $nearest_server {\n    default all;\n    EU      eu;\n    NA      na;\n    AS      as;\n    AF      af;\n}\n\nserver {\n    listen 12346;\n    proxy_pass http://$nearest_server;\n    }\n\nupstream all {\n    server all1.example.com:12345;\n    server all2.example.com:12345;\n}\n\nupstream eu {\n    server eu1.example.com:12345;\n    server eu2.example.com:12345;\n}\n\nupstream na {\n    server na1.example.com:12345;\n    server na2.example.com:12345;\n}\n```\n\n----------------------------------------\n\nTITLE: Brute Force Protection Policy - Specific Login Page in JSON\nDESCRIPTION: This JSON snippet defines a brute force protection policy for a specific login page, identified by its URL.  It configures thresholds for login attempts from the same IP and the same user, with the action set to 'alarm'. It also sets a re-enable login time, a source-based protection detection period, and specifies the target URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_20\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"BruteForcePolicySpec\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"brute-force-attack-preventions\" : [\n            {\n               \"bruteForceProtectionForAllLoginPages\" : false,\n               \"loginAttemptsFromTheSameIp\" : {\n                  \"action\" : \"alarm\",\n                  \"enabled\" : true,\n                  \"threshold\" : 20\n               },\n               \"loginAttemptsFromTheSameUser\" : {\n                  \"action\" : \"alarm\",\n                  \"enabled\" : true,\n                  \"threshold\" : 3\n               },\n               \"reEnableLoginAfter\" : 3600,\n               \"sourceBasedProtectionDetectionPeriod\" : 3600,\n               \"url\": {\n                 \"method\": \"*\",\n                 \"name\": \"/html_login\",\n                 \"protocol\": \"http\"\n\t\t       }\n            }\n        ],\n\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Creating an SSL Certificate Chain\nDESCRIPTION: This snippet shows how to create a chained SSL certificate file by concatenating the server certificate and the intermediate certificate bundle. The server certificate must appear before the chained certificates in the combined file.  This ensures that browsers can properly validate the certificate.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ncat www.example.com.crt bundle.crt > www.example.com.chained.crt\n```\n\n----------------------------------------\n\nTITLE: Configuring Gzip for Proxied Requests in NGINX\nDESCRIPTION: This snippet configures compression of responses to proxied requests, specifically those that should not be cached.  It checks the Cache-Control header for 'no-cache', 'no-store', or 'private', the Expires header, and the presence of the Authorization header. Requires the gzip module to be enabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/compression.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\ngzip_proxied no-cache no-store private expired auth;\n```\n\n----------------------------------------\n\nTITLE: Populating Key-Value Database with API using curl\nDESCRIPTION: This shell command uses the `curl` command to send a `POST` request to the NGINX Plus API endpoint, populating the key-value database (zone 'one') with IP addresses and their corresponding values (1 for denylisted, 0 for allowlisted) in JSON format.  Requires curl to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\n$ curl -X POST -d '{\n  \"10.0.0.1\": \"1\",\n  \"10.0.0.2\": \"1\",\n  \"10.0.0.3\": \"0\",\n  \"10.0.0.4\": \"0\"\n }' -s http://www.example.com/api/6/http/keyvals/one\n```\n\n----------------------------------------\n\nTITLE: Brute Force Policy Example 1 JSON\nDESCRIPTION: This JSON shows a brute force policy configuration applied to all login pages. It defines thresholds for login attempts from the same IP address and user, along with the action to take (alarm). The 'reEnableLoginAfter' and 'sourceBasedProtectionDetectionPeriod' parameters specify the duration for re-enabling login and the detection period, respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_7\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"BruteForcePolicy\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"brute-force-attack-preventions\" : [\n            {\n               \"bruteForceProtectionForAllLoginPages\" : true,\n               \"loginAttemptsFromTheSameIp\" : {\n                  \"action\" : \"alarm\",\n                  \"enabled\" : true,\n                  \"threshold\" : 20\n               },\n               \"loginAttemptsFromTheSameUser\" : {\n                  \"action\" : \"alarm\",\n                  \"enabled\" : true,\n                  \"threshold\" : 3\n               },\n               \"reEnableLoginAfter\" : 3600,\n               \"sourceBasedProtectionDetectionPeriod\" : 3600\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Tuning the Operating System (FreeBSD)\nDESCRIPTION: This snippet shows how to increase the value of the `kern.ipc.somaxconn` kernel parameter on FreeBSD to allow for a larger burst of traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_11\n\nLANGUAGE: none\nCODE:\n```\nsudo sysctl kern.ipc.somaxconn=4096\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP Server Blocks for Exchange (nginx)\nDESCRIPTION: This snippet configures server blocks for handling HTTP and HTTPS traffic for Microsoft Exchange. It includes configurations for redirecting HTTP to HTTPS, setting up SSL certificates, configuring proxy passes for various Exchange applications, and setting up health checks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_58\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n        listen 80;\n\n        location / {\n            return 301 https://$host$request_uri;\n        }\n    }\n\n    server {\n        listen 443 ssl;\n        http2  on;\n\n        client_max_body_size 2G;\n        ssl_certificate /etc/nginx/ssl/company.com.crt;\n        ssl_certificate_key /etc/nginx/ssl/company.com.key;\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        status_zone exchange-combined;\n\n        location = / {\n            return 301 \"/owa/\";\n        }\n\n        location = /favicon.ico {\n            empty_gif;\n            access_log off;\n        }\n\n        location / {\n            proxy_pass https://exchange;\n            proxy_http_version 1.1;\n            proxy_set_header Connection \"\";\n        }\n\n        location /ecp {\n            # Grant access to admin users only, by uncommenting the 'allow'\n            # and 'deny' directives and substituting the IP address and\n            # prefix of your admin network. Or configure more sophisticated\n            # access control.\n\n            #allow 172.16.0.0/16; # Replace with your admin network\n            #deny all;\n\n            proxy_pass https://exchange-ecp;\n            proxy_http_version 1.1;\n            proxy_set_header Connection \"\";\n            health_check uri=/ecp/healthcheck.htm interval=3s\n                         match=exchange-health;\n        }\n\n        location /mapi {\n            proxy_pass https://exchange-mapi;\n            proxy_http_version 1.1;\n            proxy_set_header Connection \"\";\n            health_check uri=/mapi/healthcheck.htm interval=3s\n                         match=exchange-health;\n        }\n\n        location /Microsoft-Server-ActiveSync {\n            proxy_pass https://exchange-active-sync;\n            proxy_http_version 1.1;\n            proxy_set_header Connection \"\";\n        }\n\n        location /owa {\n            proxy_pass https://exchange-owa;\n            proxy_http_version 1.1;\n            proxy_set_header Connection \"\";\n            health_check uri=/owa/healthcheck.htm interval=3s\n                         match=exchange-health;\n        }\n\n        location /rpc/rpcproxy.dll {\n            proxy_pass https://exchange-rpc;\n            proxy_buffering off;\n            proxy_http_version 1.1;\n            proxy_request_buffering off;\n            proxy_set_header Connection \"Keep-Alive\";\n            health_check uri=/rpc/rpcproxy.dll interval=3s\n                         match=exchange-auth;\n        }\n    }\n```\n\n----------------------------------------\n\nTITLE: Defining GeoIP2 Variables in NGINX\nDESCRIPTION: Defines custom variables based on data from the GeoIP2 City and Country databases. These variables can then be used in map or split_clients directives to control access or forward traffic based on geographical location.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\ngeoip2 GeoIP2/GeoLite2-City.mmdb {\n    $geoip2_data_city_name   city names en;\n    $geoip2_data_postal_code postal code;\n    $geoip2_data_latitude    location latitude;\n    $geoip2_data_longitude   location longitude;\n    $geoip2_data_state_name  subdivisions 0 names en;\n    $geoip2_data_state_code  subdivisions 0 iso_code;\n}\n\ngeoip2 GeoIP2/GeoLite2-Country.mmdb {\n    $geoip2_data_continent_code   continent code;\n    $geoip2_data_country_iso_code country iso_code;\n}\n\n#...\n```\n\n----------------------------------------\n\nTITLE: Disable Base64 Decoding in NGINX App Protect Policy (JSON)\nDESCRIPTION: This JSON snippet configures an NGINX App Protect policy to disable Base64 decoding for specific cookies, parameters, and headers. The `decodeValueAsBase64` property is set to `disabled` for the specified entities, preventing the WAF from attempting to decode their values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/detect-base64.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"detect_base64\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"cookies\": [\n            {\n                \"name\": \"username\",\n                \"type\": \"explicit\",\n                \"decodeValueAsBase64\": \"disabled\"\n            }\n        ],\n        \"parameters\": [\n            {\n                \"name\": \"catchPhrase\",\n                \"type\": \"explicit\",\n                \"decodeValueAsBase64\": \"disabled\"\n            }\n        ],\n        \"headers\": [\n            {\n                \"name\": \"Catch-Phrase\",\n                \"type\": \"explicit\",\n                \"decodeValueAsBase64\": \"disabled\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create Cluster Zone Sync Policy - Secure TLS between nodes - JSON\nDESCRIPTION: This JSON payload sets up secure TLS communication between nodes in a cluster for the Zone Sync policy. It enables TLS for the TCP server, configures a DNS resolver, enables TLS for Zone Sync itself (`enableZoneSyncTLS: true`), and specifies certificates for both the server and zone sync.  This adds mutual TLS for secure node communication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/cluster-zone-sync.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"cluster-zone-sync\": [\n    {\n      \"action\": {\n        \"tcpServer\": {\n          \"listeners\": [\n            {\n              \"port\": 12345,\n              \"tlsEnabled\": true\n            }\n          ],\n        },\n        \"resolver\": {\n          \"enableIPv6\": false,\n          \"valid\": \"30s\",\n          \"timeout\": \"5s\",\n          \"servers\": [\n            {\n              \"hostname\": \"192.0.2.0\"\n            }\n          ]\n        },\n        \"enableZoneSyncTLS\": true,\n        \"zoneSyncServers\": [\n          {\n            \"name\": \"nginx-cluster.com\",\n            \"port\": 12345\n          }\n        ]\n      },\n      \"data\": {\n        \"serverCerts\": [\n          {\n            \"key\": \"<server-key>\",\n            \"cert\": \"<server-cert>\"\n          }\n        ],\n        \"zoneSyncCerts\": [\n          {\n            \"key\": \"<server-key>\",\n            \"cert\": \"<server-cert>\"\n          }\n        ],\n        \"zoneSyncTrustedCACert\": \"<ca-cert>\"\n      }\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Disabling response buffering in Nginx proxy\nDESCRIPTION: This example demonstrates how to disable buffering of responses from proxied servers. By setting `proxy_buffering off;`, NGINX will send the response to the client as it receives it from the backend server, without storing the complete response in its buffers first. This is useful for real-time applications where low latency is more important than optimizing for slow clients.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/reverse-proxy.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /some/path/ {\n    proxy_buffering off;\n    proxy_pass http://localhost:8000;\n}\n```\n\n----------------------------------------\n\nTITLE: Install Headers-More Module on SLES\nDESCRIPTION: This shell script refreshes the package repositories and installs the `nginx-plus-module-headers-more` package using zypper. It is specific to SLES operating systems. It assumes that the user has sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/headers-more.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-headers-more\n```\n\n----------------------------------------\n\nTITLE: Binding to specific IP address in Nginx proxy\nDESCRIPTION: This configuration shows how to bind the outgoing connection to a specific IP address when proxying requests. The `proxy_bind` directive is used to specify the IP address of the network interface that NGINX will use to connect to the proxied server. This can be useful when the proxied server expects connections from a particular network or IP range.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/reverse-proxy.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /app1/ {\n    proxy_bind 127.0.0.1;\n    proxy_pass http://example.com/app1/;\n}\n\nlocation /app2/ {\n    proxy_bind 127.0.0.2;\n    proxy_pass http://example.com/app2/;\n}\n```\n\n----------------------------------------\n\nTITLE: Upstream TCP Server Group Configuration\nDESCRIPTION: Configures an upstream group of TCP servers to be monitored. This example shows three servers, `backend1.example.com`, `backend2.example.com`, and `backend3.example.com`, all listening on port 12345.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    upstream stream_backend {\n        server backend1.example.com:12345;\n        server backend2.example.com:12345;\n        server backend3.example.com:12345;\n   }\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Define Upstream Group\nDESCRIPTION: Defines an upstream group named 'backend' with three servers. The `upstream` directive is placed within the `http` context.  The 'backend1.example.com' server has a weight of 5, 'backend2.example.com' has the default weight, and '192.0.0.1' is designated as a backup server. This configuration is used to load balance traffic across multiple backend servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    upstream backend {\n        server backend1.example.com weight=5;\n        server backend2.example.com;\n        server 192.0.0.1 backup;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: JWT Claims Example\nDESCRIPTION: This JSON snippet showcases a sample JWT claims structure, outlining the arrangement of claims within a JSON Web Token. The example illustrates both top-level claims (e.g., 'scope', 'roles', 'sub') and nested claims (e.g., within the 'address' object), to demonstrate how claims can be accessed using dot notation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_11\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"scope\": \"top-level:read\",\n    \"roles\": [\n        \"inventory-manager\",\n        \"price-editor\"\n    ],\n    \"sub\": \"joe@doe.com\"\n    \"address\": {\n        \"country\": \"US\",\n        \"state\": \"NY\",\n        \"city\": \"New York\",\n        \"street\": \"888 38th W\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Load Balancing via API with JSON\nDESCRIPTION: This JSON payload is used in a POST request to configure load balancing for an API Proxy. It defines the load balancing algorithm and related parameters, such as `leastTimeMeasurement` for the `LEAST_TIME` algorithm, `hashKey` and `consistentHashing` for the `HASH` algorithm, and `randomTwo` and `randomMethod` for the `RANDOM` algorithm. The endpoint is `/services/workspaces/<SERVICE_WORKSPACE_NAME>/proxies`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/http-backend-configuration.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n   \"policies\": {\n      \"backend-config\": [\n         {\n            \"action\": {\n               \"loadBalancing\": {\n                  \"algorithm\": \"ROUND_ROBIN\",\n                  \"leastTimeMeasurement\": \"HEADER\",\n                  \"hashKey\": \"$request_uri\",\n                  \"consistentHashing\": true,\n                  \"randomTwo\": true,\n                  \"randomMethod\": \"LEAST_CONN\"\n               }\n            }\n         }\n      ]\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Populating Upstream Groups with Servers in NGINX Stream\nDESCRIPTION: This example shows how to populate upstream groups with individual servers using the `server` directive within the `upstream` block. Each `server` directive specifies the IP address or hostname and port number of an upstream server. The protocol is defined by the `listen` directive in the `server` block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n\n    upstream stream_backend {\n        server backend1.example.com:12345;\n        server backend2.example.com:12345;\n        server backend3.example.com:12346;\n        # ...\n    }\n\n    upstream dns_servers {\n        server 192.168.136.130:53;\n        server 192.168.136.131:53;\n        # ...\n    }\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Specifying JWK File Paths in Nginx\nDESCRIPTION: This snippet shows how to specify the paths to the JSON Web Key (JWK) files used to verify the JWT signature or decrypt the JWT content. It uses `auth_jwt_key_file` to define the paths to `key.jwk` and `keys.json`.  NGINX will use these keys to validate the JWT.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80;\n\n    location /products/ {\n        proxy_pass        http://api_server;\n        auth_jwt          \"API\";\n        auth_jwt_type     encrypted;\n        auth_jwt_key_file conf/key.jwk;\n        auth_jwt_key_file conf/keys.json;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX OIDC Configuration with OneLogin\nDESCRIPTION: This NGINX configuration sets up OIDC authentication with OneLogin. It defines the resolver, OIDC provider details, SSL certificates, and proxy settings to forward requests to an internal server after successful authentication. Replace placeholders with actual OneLogin credentials and server details.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/onelogin.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # Use a public DNS resolver for Issuer discovery, etc.\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider onelogin {\n        # The 'issuer' is typically your OneLogin OIDC base URL\n        # e.g. https://<subdomain>.onelogin.com/oidc/2\n        issuer https://<subdomain>.onelogin.com/oidc/2;\n\n        # Replace with your actual OneLogin Client ID and Secret\n        client_id <client_id>;\n        client_secret <client_secret>;\n    }\n\n    server {\n        listen 443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n            # Protect this path with OneLogin OIDC\n            auth_oidc onelogin;\n\n            # Forward OIDC claims to the upstream as headers if desired\n            proxy_set_header sub $oidc_claim_sub;\n            proxy_set_header email $oidc_claim_email;\n            proxy_set_header name $oidc_claim_name;\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n\n    server {\n        listen 8080;\n\n        location / {\n            return 200 \"Hello, $http_name!\\nYour email is $http_email\\nSub: $http_sub\\n\";\n            default_type text/plain;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Map Continent Code to Nearest Server in Nginx\nDESCRIPTION: This snippet uses the `map` directive in Nginx to map the continent code obtained from the GeoIP2 module to a variable `$nearest_server`. This variable will hold the name of the upstream server group corresponding to the client's continent. The `default` keyword specifies the upstream to be used when the continent can't be determined.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\nmap $geoip2_data_continent_code $nearest_server {\n    default all;\n    EU      eu;\n    NA      na;\n    AS      as;\n    AF      af;\n}\n```\n\n----------------------------------------\n\nTITLE: Applying Bookinfo example using kubectl\nDESCRIPTION: This bash command deploys the `bookinfo` application using `kubectl apply` and the `bookinfo.yaml` configuration file. This command is used as part of the verification process to test mTLS encryption by deploying a sample application within the service mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/secure-traffic-mtls.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f bookinfo.yaml\n```\n\n----------------------------------------\n\nTITLE: Configuring Application Health Check - Nginx\nDESCRIPTION: This snippet configures an application health check for a specific location block. It uses the `health_check` directive to send out-of-band requests to the servers in the upstream group. The `match` parameter references a defined set of health-check tests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_25\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /webapp/ {\n    proxy_pass http://nodejs;\n    proxy_cache backcache;\n    health_check match=health_check;\n}\n```\n\n----------------------------------------\n\nTITLE: Complete NTLM Authentication Example with SSL in NGINX\nDESCRIPTION: This is a complete example configuration showing how to configure NGINX for NTLM authentication with Microsoft Exchange servers over SSL. It includes the `upstream` block with the `ntlm` directive, `server` definitions, and a `location` block to proxy traffic to the upstream group. SSL configuration directives such as `ssl_certificate` and `ssl_certificate_key` are also shown.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_22\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    upstream exchange {\n        zone exchange 64k;\n        ntlm;\n        server exchange1.example.com;\n        server exchange2.example.com;\n    }\n\n    server {\n        listen              443 ssl;\n        ssl_certificate     /etc/nginx/ssl/company.com.crt;\n        ssl_certificate_key /etc/nginx/ssl/company.com.key;\n        ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\n\n        location / {\n            proxy_pass         https://exchange;\n            proxy_http_version 1.1;\n            proxy_set_header   Connection \"\";\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Excluding a Specific Signature by ID - JSON\nDESCRIPTION: This snippet demonstrates how to exclude a specific signature from enforcement by setting its `enabled` property to `false` within the `signatures` array. This prevents the signature with ID 200001834 from being enforced, even if it's included in an enabled signature set.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/signature-sets.md#_snippet_3\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"signature_exclude\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"signature-sets\": [\n            {\n                 \"name\": \"All Signatures\",\n                 \"block\": true,\n                 \"alarm\": true\n            }\n        ],\n        \"signatures\": [\n            {\n                 \"signatureId\": 200001834,\n                 \"enabled\": false\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Removing Accept-Encoding header in Nginx proxy\nDESCRIPTION: This example shows how to prevent a specific header from being passed to the proxied server by setting it to an empty string. By setting `proxy_set_header Accept-Encoding \"\";`, the 'Accept-Encoding' header is removed before the request is forwarded to the backend. This is useful in cases where the backend server does not handle compressed content correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/reverse-proxy.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /some/path/ {\n    proxy_set_header Accept-Encoding \"\";\n    proxy_pass http://localhost:8000;\n}\n```\n\n----------------------------------------\n\nTITLE: Displaying Node State using cat\nDESCRIPTION: This command displays the current state (MASTER or BACKUP) of the node by reading the contents of the `/var/run/nginx-ha-keepalived.state` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ncentos7-1 $ cat /var/run/nginx-ha-keepalived.state\n```\n\n----------------------------------------\n\nTITLE: Complete Gzip Configuration in NGINX Server Block\nDESCRIPTION: This snippet shows a complete gzip configuration within a server block, including enabling gzip, setting MIME types, configuring proxied requests, and setting the minimum compression length.  This configuration should be placed within the http, server, or location context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/compression.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    gzip on;\n    gzip_types      text/plain application/xml;\n    gzip_proxied    no-cache no-store private expired auth;\n    gzip_min_length 1000;\n    ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring trusted certificate and verification in Nginx\nDESCRIPTION: This snippet demonstrates how to configure Nginx to trust a self-signed certificate or a custom Certificate Authority (CA) for upstream servers. It also enables certificate verification. The `proxy_ssl_trusted_certificate` directive specifies the path to the trusted CA certificate. The `proxy_ssl_verify` and `proxy_ssl_verify_depth` directives enable and configure certificate validation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-http-traffic-upstream.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /upstream {\n    #...\n    proxy_ssl_trusted_certificate /etc/nginx/trusted_ca_cert.crt;\n    proxy_ssl_verify       on;\n    proxy_ssl_verify_depth 2;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Name-Based HTTPS Servers Configuration - Nginx\nDESCRIPTION: This configuration demonstrates the common issue of configuring two HTTPS servers on the same IP address, where the browser receives the default server's certificate.  The SSL connection is established before the browser sends an HTTP request, so NGINX doesn't know the requested server name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen          443 ssl;\n    server_name     www.example.com;\n    ssl_certificate www.example.com.crt;\n    #...\n}\n\nserver {\n    listen          443 ssl;\n    server_name     www.example.org;\n    ssl_certificate www.example.org.crt;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Global Settings JSON Example for WAF Compiler\nDESCRIPTION: This JSON example shows a global settings file used by the NGINX App Protect WAF compiler.  It configures the cookie protection seed, and a user-defined signatures using a reference. The seed value should be a random alphanumeric string of at least 20 characters.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_6\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"waf-settings\": {\n        \"cookie-protection\": {\n            \"seed\": \"<seed value>\"\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Sample NGINX Configuration File with Multiple Contexts\nDESCRIPTION: This example demonstrates the use of contexts (main, events, http, and stream) in an NGINX configuration file.  Contexts group related directives and apply to different types of traffic. The `http` context contains `server` blocks for defining virtual HTTP servers, which in turn contain `location` blocks for handling specific URIs.  The `stream` context configures TCP/UDP traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/basic-functionality/managing-configuration-files.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nuser nobody; # a directive in the 'main' context\n\nevents {\n    # configuration of connection processing\n}\n\nhttp {\n    # Configuration specific to HTTP and affecting all virtual servers\n\n    server {\n        # configuration of HTTP virtual server 1\n        location /one {\n            # configuration for processing URIs starting with '/one'\n        }\n        location /two {\n            # configuration for processing URIs starting with '/two'\n        }\n    }\n\n    server {\n        # configuration of HTTP virtual server 2\n    }\n}\n\nstream {\n    # Configuration specific to TCP/UDP and affecting all virtual servers\n    server {\n        # configuration of TCP virtual server 1\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: HTTPS Server with Certificate and Key in One File\nDESCRIPTION: This snippet shows how to configure an HTTPS server where the SSL certificate and private key are stored in the same file.  It's crucial to restrict access to this file due to the presence of the private key. Only the certificate is sent to clients, even if the key resides in the same file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nssl_certificate     www.example.com.cert;\nssl_certificate_key www.example.com.cert;\n```\n\n----------------------------------------\n\nTITLE: NGINX Plus Sticky Route Session Persistence\nDESCRIPTION: This snippet demonstrates the `sticky route` method for session persistence in NGINX Plus.  Each server is assigned a route (`a` or `b`), and the route information is extracted from either a cookie (`$route_cookie`) or the request URI (`$route_uri`) to determine which server to route the request to.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    server backend1.example.com route=a;\n    server backend2.example.com route=b;\n    sticky route $route_cookie $route_uri;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring client certificate authentication in Nginx\nDESCRIPTION: This snippet shows how to configure Nginx to use a client certificate and key for authentication with upstream servers.  The `proxy_ssl_certificate` and `proxy_ssl_certificate_key` directives specify the paths to the client certificate and its corresponding private key. This enables Nginx to identify itself to the upstream servers via SSL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-http-traffic-upstream.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /upstream {\n    proxy_pass                https://backend.example.com;\n    proxy_ssl_certificate     /etc/nginx/client.pem;\n    proxy_ssl_certificate_key /etc/nginx/client.key;\n}\n```\n\n----------------------------------------\n\nTITLE: Handling Excessive Requests with Burst in Nginx\nDESCRIPTION: This configuration buffers up to 5 excessive requests beyond the defined rate limit in the `/search/` location.  Requests are delayed to comply with the configured rate.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n\n    limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;\n\n    server {\n        #...\n\n        location /search/ {\n            limit_req zone=one burst=5;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Downloading GeoLite2 City Database with wget\nDESCRIPTION: Downloads and unpacks the GeoLite2 City database using wget and gunzip. This database is used to determine the city associated with an IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nwget http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.mmdb.gz\ngunzip GeoLite2-City.mmdb.gz\n```\n\n----------------------------------------\n\nTITLE: HTTP to HTTPS Redirect\nDESCRIPTION: This snippet configures an HTTP server block that listens on port 80 and redirects all requests to the HTTPS version of the site.  It uses a 301 redirect to ensure search engines update their links.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_27\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80;\n    server_name example.com;\n\n    # Redirect all HTTP requests to HTTPS\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTPS Server Block Nginx\nDESCRIPTION: This snippet configures an HTTPS server block, listening on port 443 for 'example.com'. It sets up SSL certificate paths, configures the SSL session cache, and prefers server ciphers.  The SSL certificate and key directives are required for secure HTTPS connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nserver {\n    listen 443 ssl;\n    server_name example.com;\n\n    ssl_certificate           /etc/nginx/ssl/<certificate-name>;\n    ssl_certificate_key       /etc/nginx/ssl/<private-key>;\n    ssl_session_cache         shared:SSL:1m;\n    ssl_prefer_server_ciphers on;\n }\n```\n\n----------------------------------------\n\nTITLE: Disabling Caching Based on Conditions in Nginx\nDESCRIPTION: This snippet shows how to define conditions under which Nginx Plus does not cache a response at all. It uses the proxy_no_cache directive with conditions based on HTTP headers. This prevents certain responses from being cached in the first place.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_no_cache $http_pragma $http_authorization;\n```\n\n----------------------------------------\n\nTITLE: Testing Nginx App Protect Enforcement with Docker\nDESCRIPTION: This command uses `curl` to send a request to the deployed Nginx service and verify that the Nginx App Protect WAF is enforcing security policies when running with Docker Compose. The expectation is that a request containing `<script>` will be rejected, indicating that the WAF is working as expected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_31\n\nLANGUAGE: shell\nCODE:\n```\ncurl \"localhost/<script>\"\n```\n\n----------------------------------------\n\nTITLE: Setting Gzip MIME Types in NGINX\nDESCRIPTION: This snippet configures NGINX to compress responses with MIME types 'text/plain' and 'application/xml' in addition to the default 'text/html'.  Requires the gzip module to be enabled.  The gzip_types directive allows extending the types of content that are compressed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/compression.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\ngzip_types text/plain application/xml;\n```\n\n----------------------------------------\n\nTITLE: Configuring Health Checks for Tomcat Application\nDESCRIPTION: This snippet configures NGINX Plus to send out-of-band requests to the /tomcat-app/ URI every 2 seconds to check server health. It marks a server down if it fails once and brings it back up after five successful checks. Requires the proxy_pass and proxy_cache directives. Uses the tomcat_check match block to determine server health.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_30\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /tomcat-app/ {\n    proxy_pass http://tomcat;\n    proxy_cache backcache;\n    health_check interval=2s fails=1 passes=5 uri=/ match=tomcat_check;\n}\n```\n\n----------------------------------------\n\nTITLE: Listing NGINX Plus Image Tags with curl\nDESCRIPTION: This command uses `curl` to retrieve the list of tags available for a specific NGINX Plus image type in the private registry.  It requires specifying the image type (`base`, `rootless-base`, `agent`, or `rootless-agent`), as well as the paths to your client key and certificate.  The output is formatted as JSON using the `jq` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-plus-and-agent-docker.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\ncurl https://private-registry.nginx.com/v2/nginx-plus/<nginxplus-image-type>/tags/list --key <nginx-repo.key> --cert <nginx-repo.crt> | jq\n```\n\n----------------------------------------\n\nTITLE: Specifying Requested URI for Health Checks in Nginx Plus\nDESCRIPTION: This snippet sets the URI to `/some/path` for health check requests to the `backend` upstream group.  NGINX Plus will request `http://backend1.example.com/some/path` for the health check of `backend1.example.com`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-health-check.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    proxy_pass   http://backend;\n    health_check uri=/some/path;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP Context for Exchange Proxy (nginx)\nDESCRIPTION: This snippet configures the HTTP context for proxying various Microsoft Exchange services. It defines log formats, access logs, keepalive settings, and includes a status configuration file. It also configures upstream servers for different Exchange components like general, ActiveSync, ECP, MAPI, OWA, and RPC.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_57\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    log_format main '$remote_addr - $remote_user [$time_local]\n                    \"$request\" $status $body_bytes_sent \"$http_referer\"\n                    \"$http_user_agent\" $upstream_addr';\n    access_log /var/log/nginx/access.log main;\n    keepalive_timeout 3h;\n    proxy_read_timeout 3h;\n    tcp_nodelay on;\n\n    # If this file serves as the main nginx.conf file (contains your entire\n    # site configuration), this 'include' directive reads in the\n    # configuration file for live activity monitoring. If creating a\n    # separate conf.d/exchange-http.conf file, put this directive in the main\n    # nginx.conf file instead.\n    include conf.d/status.conf;\n\n    upstream exchange {\n        zone exchange-general 64k;\n        ntlm;\n\n        server 10.0.0.237:443; # Replace with IP address of a CAS\n        server 10.0.0.238:443; # Replace with IP address of a CAS\n    }\n\n    upstream exchange-activesync {\n        zone exchange-activesync 64k;\n        ntlm;\n\n        server 10.0.0.237:443; # Replace with IP address of a CAS\n        server 10.0.0.238:443; # Replace with IP address of a CAS\n    }\n\n    upstream exchange-ecp {\n        zone exchange-ecp 64k;\n        ntlm;\n\n        server 10.0.0.237:443; # Replace with IP address of a CAS\n        server 10.0.0.238:443; # Replace with IP address of a CAS\n    }\n\n    upstream exchange-mapi {\n        zone exchange-mapi 64k;\n        ntlm;\n\n        server 10.0.0.237:443; # Replace with IP address of a CAS\n        server 10.0.0.238:443; # Replace with IP address of a CAS\n    }\n\n    upstream exchange-owa {\n        zone exchange-owa 64k;\n        ntlm;\n\n        server 10.0.0.237:443; # Replace with IP address of a CAS\n        server 10.0.0.238:443; # Replace with IP address of a CAS\n    }\n\n    upstream exchange-rpc {\n        zone exchange-rpc 64k;\n        ntlm;\n\n        server 10.0.0.237:443; # Replace with IP address of a CAS\n        server 10.0.0.238:443; # Replace with IP address of a CAS\n        sticky learn create=$remote_addr lookup=$remote_addr\n                     zone=client_sessions:10m timeout=3h;\n    }\n\n    match exchange-auth {\n        status 401;\n        header WWW-Authenticate ~ Basic;\n    }\n\n    match exchange-health {\n        status 200;\n        body ~ \"200 OK\";\n    }\n```\n\n----------------------------------------\n\nTITLE: Enabling SSL session reuse in Nginx\nDESCRIPTION: This snippet shows how to enable SSL session reuse between Nginx and upstream servers. This optimization reduces CPU load by allowing Nginx to reuse previously negotiated SSL parameters, avoiding a full handshake on subsequent connections. The `proxy_ssl_session_reuse` directive enables this feature.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-http-traffic-upstream.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /upstream {\n    #...\n    proxy_ssl_session_reuse on;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring keepalived for Active-Active - YAML\nDESCRIPTION: This YAML code configures keepalived for active-active high availability by creating two vrrp_instance blocks in the keepalived.conf file. It involves duplicating the existing `vrrp_instance`, renaming it, changing the `virtual_router_id`, updating the `virtual_ipaddress`, and adjusting the priority values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived-nodes.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\nvrrp_script chk_nginx_service {\n    script  \"/usr/lib/keepalived/nginx-ha-check\"\n    interval 3\n    weight   50\n}\n\nvrrp_instance VI_1 {\n    interface         eth0\n    state             BACKUP\n    priority          101\n    virtual_router_id 51\n    advert_int        1\n    accept\n    unicast_src_ip    192.168.10.10\n\n    unicast_peer {\n        192.168.10.11\n    }\n\n    virtual_ipaddress {\n        192.168.10.100\n    }\n\n    track_script {\n        chk_nginx_service\n    }\n\n    notify \"/usr/lib/keepalived/nginx-ha-notify\"\n}\n\nvrrp_instance VI_2 {\n    interface         eth0\n    state             BACKUP\n    priority          100\n    virtual_router_id 61\n    advert_int        1\n    accept\n    unicast_src_ip    192.168.10.10\n\n    unicast_peer {\n        192.168.10.11\n    }\n\n    virtual_ipaddress {\n        192.168.10.101\n    }\n\n    track_script {\n        chk_nginx_service\n    }\n\n    notify \"/usr/lib/keepalived/nginx-ha-notify\"\n}\n```\n\n----------------------------------------\n\nTITLE: Verbose Custom Formatted Message JSON\nDESCRIPTION: This JSON snippet configures the security log to log only illegal requests using a verbose, user-defined format string. It includes the request ID, method, URI, date/time, client IP, and violations. The max request size is set to 2k bytes, and the max message size is 32k.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/logging-overview/security-log.md#_snippet_5\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filter\": {\n        \"request_type\": \"illegal\"\n    },\n    \"content\": {\n        \"format\": \"user-defined\",\n        \"format_string\": \"Request ID %support_id%: %method% %uri% received on %date_time% from IP %ip_client% had the following violations: %violations%\",\n        \"max_request_size\": \"2k\",\n        \"max_message_size\": \"32k\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Define Upstream for Load Balancing - Nginx\nDESCRIPTION: This configuration defines an upstream block named 'myapp' in Nginx, which represents a group of backend servers. It specifies three backend servers (10.0.0.100, 10.0.0.101, and 10.0.0.102) within the upstream block, all listening on port 80. This sets up basic load balancing across these servers using Nginx's upstream module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nupstream myapp {\n    server 10.0.0.100:80;\n    server 10.0.0.101:80;\n    server 10.0.0.102:80;\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect WAF Authorization Rules\nDESCRIPTION: This JSON snippet defines authorization rules within a Nginx App Protect WAF policy for a specific URL. The 'authorizationRules' entity allows access to the URL based on the JWT claims. The example includes rules to check for specific scopes, roles, and email domain.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_10\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"urls\": [\n        {\n            \"name\": \"/api/v3/shops/items/*\",\n            \"accessProfile\": {\n                \"name\": \"my_jwt\"\n            },\n            \"authorizationRules\": [\n                {\n                    \"condition\": \"claims['scope'].contains('pet:read') and claims['scope'].contains('pet:write')\",\n                    \"name\": \"auth_scope\"\n                },\n                {\n                    \"condition\": \"claims['roles'].contains('admin') or claims['roles'].contains('inventory-manager')\",\n                    \"name\": \"auth_roles\"\n                },\n                {\n                    \"condition\": \"claims['email'].endsWith('petshop.com')\",\n                    \"name\": \"auth_email\"\n                }\n            ]\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring keepalived for All-Active HA\nDESCRIPTION: This keepalived configuration is designed for an active-active-active setup. It defines three vrrp_instance blocks, each responsible for managing a virtual IP address. The priority, virtual_router_id, and unicast_peer settings are crucial for proper failover and load balancing across multiple active nodes. A script is defined to check the nginx service to maintain the node status.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived-nodes.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\nvrrp_script chk_nginx_service {\n    script   \"/usr/lib/keepalived/nginx-ha-check\"\n    interval 3\n    weight   50\n}\n\nvrrp_instance VI_1 {\n    interface         eth0\n    state             BACKUP\n    priority          101\n    virtual_router_id 51\n    advert_int        1\n    accept\n    unicast_src_ip    192.168.10.10\n\n    unicast_peer {\n        192.168.10.11\n        192.168.10.12\n        192.168.10.13\n    }\n\n    virtual_ipaddress {\n        192.168.10.100\n    }\n\n    track_script {\n        chk_nginx_service\n    }\n\n    notify \"/usr/lib/keepalived/nginx-ha-notify\"\n}\n\nvrrp_instance VI_2 {\n    interface         eth0\n    state             BACKUP\n    priority          100\n    virtual_router_id 61\n    advert_int        1\n    accept\n    unicast_src_ip    192.168.10.10\n\n    unicast_peer {\n        192.168.10.11\n        192.168.10.12\n        192.168.10.13\n    }\n\n    virtual_ipaddress {\n        192.168.10.101\n    }\n\n    track_script {\n        chk_nginx_service\n    }\n\n    notify \"/usr/lib/keepalived/nginx-ha-notify\"\n}\n\nvrrp_instance VI_3 {\n    interface         eth0\n    state             BACKUP\n    priority          99\n    virtual_router_id 71\n    advert_int        1\n    accept\n    unicast_src_ip    192.168.10.10\n\n    unicast_peer {\n        192.168.10.11\n        192.168.10.12\n        192.168.10.13\n    }\n\n    virtual_ipaddress {\n        192.168.10.102\n    }\n\n    track_script {\n        chk_nginx_service\n    }\n\n    notify \"/usr/lib/keepalived/nginx-ha-notify\"\n}\n```\n\n----------------------------------------\n\nTITLE: Full Nginx Configuration for WebLogic Load Balancing\nDESCRIPTION: This NGINX configuration provides enhanced load balancing for WebLogic Server applications. It includes features like caching, WebSocket support, health checks, and session persistence. To use this configuration, include it in the http context of your main nginx.conf file using an `include` directive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_44\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /tmp/NGINX_cache/ keys_zone=backcache:10m;\n\n# WebSocket configuration\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n\n# Map the PURGE method to the request method, for cache purging\nmap $request_method $purge_method {\n    PURGE 1;\n    default 0;\n}\n\n# Application health checks\nmatch health_check {\n    status 200;\n    header Content-Type = text/html;\n    body ~ \"Welcome To Dizzyworld\";\n}\n\nupstream weblogic {\n    # Shared memory zone for application health checks, live activity\n    # monitoring, and dynamic reconfiguration\n    zone weblogic 64k;\n\n    # List of WebLogic Server application servers\n    server 192.168.25.33:7001 slow_start=30s;\n    server 192.168.25.69:7001 slow_start=30s;\n\n    # Session persistence based on JSESSIONID\n    sticky learn create=$upstream_cookie_JSESSIONID\n                 lookup=$cookie_JSESSIONID\n                 zone=client_sessions:1m;\n}\n\nserver {\n    listen 80;\n    server_name example.com;\n\n    # Required for live activity monitoring of HTTP traffic\n    status_zone weblogic;\n\n    # Redirect all HTTP requests to HTTPS\n    location / {\n        return 301 https://$server_name$request_uri;\n     }\n}\n\nserver {\n    listen 443 ssl;\n    http2  on;\n\n    server_name example.com;\n\n    # Required for live activity monitoring of HTTPS traffic\n    status_zone weblogic-ssl;\n    ssl_certificate     /etc/nginx/ssl/certificate-name;\n    ssl_certificate_key /etc/nginx/ssl/private-key;\n    ssl_session_cache shared:SSL:1m;\n    ssl_prefer_server_ciphers on;\n\n    # Load balance requests for '/weblogic-app/' across WebLogic Server\n    # application servers\n    location /weblogic-app/ {\n        proxy_pass http://weblogic;\n        proxy_cache backcache;\n\n        # Enable purging of the content cache\n        proxy_cache_purge $purge_method;\n\n        # Active health checks\n        health_check uri=/benefits match=health_check;\n    }\n\n    # Return a 302 redirect to '/weblogic-app/' when user requests '/'\n    location = / {\n        return 302 /weblogic-app/;\n    }\n\n    # WebSocket configuration\n    location /wstunnel/ {\n        proxy_pass http://weblogic;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n    }\n\n    # Secured access to the NGINX Plus API\n    location /api {\n        api write=on;\n        allow 127.0.0.1; # Permit access from localhost\n        deny all;        # Deny access from everywhere else\n    }\n}\n\n```\n\n----------------------------------------\n\nTITLE: Create Coffee HTTPRoute\nDESCRIPTION: This snippet defines a Kubernetes HTTPRoute resource named 'coffee' that routes traffic with the hostname 'cafe.example.com' to the 'coffee' service. It attaches the HTTPRoute to the 'cafe' gateway using parentRefs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/routing-traffic-to-your-app.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: coffee\nspec:\n  parentRefs:\n  - name: cafe\n  hostnames:\n  - \"cafe.example.com\"\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /\n    backendRefs:\n    - name: coffee\n      port: 80\nEOF\n```\n\n----------------------------------------\n\nTITLE: Complete Nginx example with HTTPS proxy and upstream configuration\nDESCRIPTION: This comprehensive Nginx configuration showcases a complete setup for proxying HTTPS traffic to upstream servers, including client certificate authentication, SSL verification, session reuse, and specific protocol/cipher configurations. It details how to configure both the proxy server and the upstream servers to establish a secure connection.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-http-traffic-upstream.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n    upstream backend.example.com {\n        server backend1.example.com:443;\n        server backend2.example.com:443;\n   }\n\n    server {\n        listen      80;\n        server_name www.example.com;\n        #...\n\n        location /upstream {\n            proxy_pass                    https://backend.example.com;\n            proxy_ssl_certificate         /etc/nginx/client.pem;\n            proxy_ssl_certificate_key     /etc/nginx/client.key;\n            proxy_ssl_protocols           TLSv1 TLSv1.1 TLSv1.2;\n            proxy_ssl_ciphers             HIGH:!aNULL:!MD5;\n            proxy_ssl_trusted_certificate /etc/nginx/trusted_ca_cert.crt;\n\n            proxy_ssl_verify        on;\n            proxy_ssl_verify_depth  2;\n            proxy_ssl_session_reuse on;\n        }\n    }\n\n    server {\n        listen      443 ssl;\n        server_name backend1.example.com;\n\n        ssl_certificate        /etc/ssl/certs/server.crt;\n        ssl_certificate_key    /etc/ssl/certs/server.key;\n        ssl_client_certificate /etc/ssl/certs/ca.crt;\n        ssl_verify_client      optional;\n\n        location /yourapp {\n            proxy_pass https://url_to_app.com;\n        #...\n        }\n\n    server {\n        listen      443 ssl;\n        server_name backend2.example.com;\n\n        ssl_certificate        /etc/ssl/certs/server.crt;\n        ssl_certificate_key    /etc/ssl/certs/server.key;\n        ssl_client_certificate /etc/ssl/certs/ca.crt;\n        ssl_verify_client      optional;\n\n        location /yourapp {\n            proxy_pass https://url_to_app.com;\n        #...\n        }\n    }\n}\n\n```\n\n----------------------------------------\n\nTITLE: Setting Failure Mode Action - Nginx\nDESCRIPTION: This code snippet demonstrates how to set the `app_protect_failure_mode_action` directive in the `http` block of the nginx.conf file.  This directive controls how NGINX App Protect WAF handles traffic when the App Protect daemons are down or disconnected. The possible values are \"pass\" (fail open, prioritize availability) and \"drop\" (fail closed, prioritize security).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\n...\nhttp {\n    ...\n    app_protect_failure_mode_action drop;\n    ...\n    server {\n        listen       80;\n...\n    }\n...\n\n```\n\n----------------------------------------\n\nTITLE: Enabling HTTP/2 Support in NGINX\nDESCRIPTION: This snippet demonstrates how to enable HTTP/2 support within a `server` block configured for HTTPS traffic in NGINX. It requires Nginx Plus R7 or later or Nginx 1.9.5 or later. The `listen` directive specifies the port for HTTPS, and the `http2` directive enables HTTP/2 protocol support.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_38\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlisten 443 ssl;\nhttp2  on;\n```\n\n----------------------------------------\n\nTITLE: Enabling JWT Key Caching in Nginx\nDESCRIPTION: This snippet shows how to enable JWT key caching using the `auth_jwt_key_cache` directive to improve performance.  The keys will be cached for one hour, reducing the need to repeatedly retrieve them from the file or remote server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80;\n\n    location /products/ {\n        proxy_pass           http://api_server;\n        auth_jwt             \"API\";\n        auth_jwt_type        encrypted;\n        auth_jwt_key_file    private_jwe_keys.jwk;\n        auth_jwt_key_request /public_jws_keys;\n        auth_jwt_key_cache   1h;\n    }\n\n    location /public_jws_keys {\n        proxy_pass \"https_//idp.example.com/keys\";\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure DNS Resolver in NGINX\nDESCRIPTION: This configuration snippet sets up a DNS resolver within the `http` context of the NGINX configuration.  It specifies the resolver IP address, enables IPv4 resolution, and sets a TTL of 300 seconds for DNS record re-resolution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/auth0.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Enable NGINX App Protect WAF in NGINX\nDESCRIPTION: This snippet enables NGINX App Protect WAF on an `http/server/location` context.  It is important to only enable NGINX App Protect WAF with `proxy_pass`/`grpc_pass` locations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enable on;\n```\n\n----------------------------------------\n\nTITLE: Configure DNS Resolver in NGINX\nDESCRIPTION: This snippet configures the DNS resolver within the `http` context of the NGINX configuration. It specifies the DNS server IP address, enables IPv4 resolution, and sets the TTL for DNS records to 300 seconds. This is necessary for NGINX Plus to resolve the IdP's domain.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-oidc.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Limiting Bandwidth per Connection in NGINX\nDESCRIPTION: This configuration shows how to limit bandwidth per connection using the `limit_rate` directive.  It restricts the download speed to 50 kilobytes per second for the `/download/` location. A single connection is allowed per IP address to enforce the rate limit.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /download/ {\n    limit_rate 50k;\n}\n```\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /download/ {\n    limit_conn addr 1;\n    limit_rate 50k;\n}\n```\n\n----------------------------------------\n\nTITLE: Full Nginx Configuration for Basic Load Balancing\nDESCRIPTION: This comprehensive Nginx configuration demonstrates basic load balancing for a Node.js application. It includes configurations for proxy caching, mapping upgrade headers, upstream server definitions, HTTP to HTTPS redirection, HTTP/2 support, SSL certificate settings, and WebSocket proxying. The configuration shows a complete setup including multiple server blocks and directives.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_23\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /tmp/NGINX_cache/ keys_zone=backcache:10m;\n\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ' '     close;\n}\n\nupstream nodejs {\n    # Use IP Hash for session persistence\n    ip_hash;\n\n    # List of Node.js application servers\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n}\n\nserver {\n    listen 80;\n    server_name example.com;\n\n    # Redirect all HTTP requests to HTTPS\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n\nserver {\n    listen 443 ssl;\n    http2  on;\n\n    server_name example.com;\n\n    ssl_certificate           /etc/nginx/ssl/certificate-name;\n    ssl_certificate_key       /etc/nginx/ssl/private-key;\n    ssl_session_cache         shared:SSL:1m;\n    ssl_prefer_server_ciphers on;\n\n    # Return a temporary redirect to '/webapp/' when user requests '/'\n    location = / {\n         return 302 /webapp/;\n    }\n\n    # Load balance requests for '/webapp/' across Node.js app servers\n    location /webapp/ {\n        proxy_pass http://nodejs;\n        proxy_cache backcache;\n    }\n\n    # WebSocket configuration\n    location /wstunnel/ {\n        proxy_pass https://nodejs;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Creating API location in Nginx\nDESCRIPTION: This code snippet illustrates how to create a location block for API requests and include the `app_protect_dos_api` directive. This directive is essential for enabling the Nginx App Protect DoS REST API on a specific location.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/live-activity-monitoring.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    server {\n        listen 192.168.1.23;\n        # ...\n        location /api {\n            app_protect_dos_api;\n            # ...\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Proxy Traffic to Upstream Group\nDESCRIPTION: Configures a virtual server to proxy all requests to the 'backend' upstream group. The `proxy_pass` directive specifies the target upstream group. This server block directs incoming traffic to the load-balanced backend servers defined in the upstream block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    location / {\n        proxy_pass http://backend;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing Image-Filter Module on Alpine\nDESCRIPTION: This shell script uses apk to install the `nginx-plus-module-image-filter` package. This installs the image filter module for NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/image-filter.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-image-filter\n```\n\n----------------------------------------\n\nTITLE: Configure SSH access to peers - Get Primary Node IP\nDESCRIPTION: This command retrieves the IP address of the primary node using the ip addr command. The output is then parsed to identify the IP address assigned to the eth0 interface.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nip addr\n\n1: lo:  mtu 65536 qdisc noqueue state UNKNOWN group default\n   link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n   inet 127.0.0.1/8 scope host lo\n      valid_lft forever preferred_lft forever\n   inet6 ::1/128 scope host\n      valid_lft forever preferred_lft forever\n\n2: eth0:  mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n   link/ether 52:54:00:34:6c:35 brd ff:ff:ff:ff:ff:ff\n   inet 192.168.1.2/24 brd 192.168.1.255 scope global eth0\n      valid_lft forever preferred_lft forever\n   inet6 fe80::5054:ff:fe34:6c35/64 scope link\n      valid_lft forever preferred_lft forever\n```\n\n----------------------------------------\n\nTITLE: Configuring Bot Class Mitigations - JSON\nDESCRIPTION: This JSON snippet configures mitigation actions for different bot classes (`trusted-bot`, `untrusted-bot`, and `malicious-bot`) in an NGINX App Protect policy. It overrides the default actions, setting 'alarm' for trusted bots, and 'block' for both untrusted and malicious bots.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/anti-automation.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"bot_defense_policy\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"bot-defense\": {\n            \"settings\": {\n                \"isEnabled\": true\n            },\n            \"mitigations\": {\n                \"classes\": [\n                    {\n                        \"name\": \"trusted-bot\",\n                        \"action\": \"alarm\"\n                    },\n                    {\n                        \"name\": \"untrusted-bot\",\n                        \"action\": \"block\"\n                    },\n                    {\n                        \"name\": \"malicious-bot\",\n                        \"action\": \"block\"\n                    }\n                ]\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Hash Load Balancing in NGINX Stream\nDESCRIPTION: This configures Hash load balancing, which selects a server based on a user-defined key (e.g., `$remote_addr`). This method can also be used for session persistence. An optional `consistent` parameter can be used for ketama consistent hashing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nupstream stream_backend {\n    hash $remote_addr;\n    server backend1.example.com:12345;\n    server backend2.example.com:12345;\n    server backend3.example.com:12346;\n}\n```\n\n----------------------------------------\n\nTITLE: Returning a 301 Redirect in Nginx\nDESCRIPTION: This snippet shows how to configure NGINX to return a 301 Moved Permanently redirect status code when a request is made to the `/permanently/moved/url` location.  The `return` directive redirects the client to `http://www.example.com/moved/here`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /permanently/moved/url {\n    return 301 http://www.example.com/moved/here;\n}\n```\n\n----------------------------------------\n\nTITLE: Passing Client IP to Upstream Servers via Header\nDESCRIPTION: This snippet uses the `proxy_set_header` directive to pass the client's IP address (`$proxy_protocol_addr`) to upstream servers via the `X-Real-IP` and `X-Forwarded-For` headers.  This allows the upstream servers to identify the true client IP address. This is useful for logging, analytics, and other purposes where the client's IP is needed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/using-proxy-protocol.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    proxy_set_header X-Real-IP       $proxy_protocol_addr;\n    proxy_set_header X-Forwarded-For $proxy_protocol_addr;\n}\n```\n\n----------------------------------------\n\nTITLE: SSL/TLS Termination in NGINX Plus\nDESCRIPTION: This snippet demonstrates SSL/TLS termination in NGINX Plus.  It configures the server to listen on port 443 with SSL enabled, and specifies the SSL certificate and key files.  The ssl_certificate and ssl_certificate_key directives point to the certificate and key files, respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 10.0.0.98:443 ssl;\n    ssl_certificate     test.crt;\n    ssl_certificate_key test.key;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Defining Health Check for Specific Content in Nginx\nDESCRIPTION: This snippet defines a `match` block named `welcome` to check for a specific HTTP status code (200), `Content-Type` header value (`text/html`), and content within the response body (`Welcome to nginx!`). All conditions must be met for the health check to pass.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-health-check.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nmatch welcome {\n    status 200;\n    header Content-Type = text/html;\n    body   ~ \"Welcome to nginx!\";\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Plus Load Balancer\nDESCRIPTION: This Nginx configuration block configures a load balancer. It defines an upstream group named 'backend-servers' containing two backend servers.  The server block proxies requests to the upstream group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/route-53-global-server-load-balancing.md#_snippet_9\n\nLANGUAGE: Nginx\nCODE:\n```\nupstream backend-servers {\n    server <public DNS name of Backend 1>; # Backend 1\n    server <public DNS name of Backend 2>; # Backend 2\n}\nserver {\n    location / {\n        proxy_pass http://backend-servers;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Deploy Gateway API resources for Header application - YAML\nDESCRIPTION: Deploys a Gateway resource with a single HTTP listener on port 80. This gateway will be used for routing traffic to the header application. The gatewayClassName is set to 'nginx'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nmetadata:\n  name: gateway\nspec:\n  gatewayClassName: nginx\n  listeners:\n  - name: http\n    port: 80\n    protocol: HTTP\nEOF\n```\n\n----------------------------------------\n\nTITLE: Loading GeoIP2 Modules in Nginx Configuration\nDESCRIPTION: These `load_module` directives enable dynamic loading of the GeoIP2 modules within the Nginx configuration. The modules `ngx_http_geoip2_module.so` and `ngx_stream_geoip2_module.so` provide HTTP and Stream context functionality respectively, allowing for IP-based geolocation data usage within Nginx Plus configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip2.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_geoip2_module.so;\nload_module modules/ngx_stream_geoip2_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Random Load Balancing\nDESCRIPTION: Configures Random load balancing, selecting two servers and then choosing the one with the least time to receive the last byte (full response). The `random two least_time=last_byte` directive picks two random servers based on weights and selects one based on the least time to receive the full response.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    random two least_time=last_byte;\n    server backend1.example.com;\n    server backend2.example.com;\n    server backend3.example.com;\n    server backend4.example.com;\n}\n```\n\n----------------------------------------\n\nTITLE: SSL/TLS Termination Configuration on NGINX Plus\nDESCRIPTION: This code snippet demonstrates how to configure SSL/TLS termination on NGINX Plus. It defines an upstream pool and a server block that listens on port 443 with SSL enabled, specifying the certificate and key files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nupstream ssl_test_pool {\n        server 10.10.10.10:443;\n        server 10.10.10.20:443;\n   }\n\n   server {\n        listen 192.168.10.10:443 ssl;\n        ssl_certificate     /etc/nginx/ssl/test.crt;\n        ssl_certificate_key /etc/nginx/ssl/test.key;\n\n        location / {\n            proxy_pass http://ssl_test_pool;\n        }\n   }\n```\n\n----------------------------------------\n\nTITLE: Enabling Sync for Keyval Memory Zones in NGINX\nDESCRIPTION: This Nginx configuration block enables synchronization for keyval memory zones and specifies the state files to persist the current state across NGINX restarts. The `keyval_zone` directive is used to define memory zones for storing OIDC tokens and PKCE code verifiers with specific timeouts and state file paths.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/oidc.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nkeyval_zone zone=oidc_id_tokens:1M     state=/opt/oidc_id_tokens.json     timeout=1h sync;\nkeyval_zone zone=oidc_access_tokens:1M state=/opt/oidc_access_tokens.json timeout=1h sync;\nkeyval_zone zone=refresh_tokens:1M     state=/opt/refresh_tokens.json     timeout=8h sync;\nkeyval_zone zone=oidc_pkce:128K timeout=90s sync; # Temporary storage for PKCE code verifier.\n```\n\n----------------------------------------\n\nTITLE: Customizing Health Check Parameters in Nginx Plus\nDESCRIPTION: This snippet customizes the health check parameters for the `backend` upstream group. It sets the `interval` to 10 seconds, `fails` to 3, and `passes` to 2. This means that NGINX Plus will send health checks every 10 seconds, a server must fail three consecutive health checks to be marked as unhealthy, and it must pass two consecutive checks to be marked as healthy again.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-health-check.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    proxy_pass   http://backend;\n    health_check interval=10 fails=3 passes=2;\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration for User-Defined Signatures\nDESCRIPTION: This snippet configures NGINX to load user-defined signatures for NGINX App Protect WAF.  It includes directives to enable App Protect, specify the policy file, and define the path to the user-defined signature definitions file.  It requires the ngx_http_app_protect_module.so module to be loaded. The user and error_log configurations are also included for context. The user must ensure that the specified files are accessible to the nginx user.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nworker_processes  4;\n\nload_module modules/ngx_http_app_protect_module.so;\n\nerror_log /var/log/nginx/error.log debug;\n\nevents {\n    worker_connections  65536;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    app_protect_enable on;\n    app_protect_policy_file \"/etc/nginx/user_defined_signatures_policy.json\";\n    app_protect_user_defined_signatures \"/etc/nginx/user_defined_signature_definitions.json\";\n\n    app_protect_security_log_enable on;\n    app_protect_security_log \"/etc/app_protect/conf/log_default.json\" syslog:server=127.0.0.1:514;\n\n    server {\n        listen       80;\n        server_name  localhost;\n        proxy_http_version 1.1;\n\n        location / {\n            client_max_body_size 0;\n            default_type text/html;\n            proxy_pass http://127.0.0.1:8080$request_uri;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create HTTP2 Environment with NGINX Management Suite API (JSON)\nDESCRIPTION: This JSON configures an HTTP2 Environment with TLS in NGINX Management Suite.  The `listeners` array defines the transport protocol, port, and TLS enablement. It includes a `tls-inbound` policy that requires both a server certificate (`cert`) and key (`key`), using placeholders `{{tls key}}` and `{{tls cert}}` respectively.  The `environmentHostname` and `instanceGroupName` use the `{{environmentHostname}}` and `{{instanceGroupName}}` placeholders respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/add-api-gateway.md#_snippet_3\n\nLANGUAGE: JSON\nCODE:\n```\n{\n   \"name\": \"{{environmentname}}\",\n   \"proxies\": [\n      {\n         \"proxyClusterName\": \"{{instanceGroupName}}\",\n         \"listeners\": [\n            {\n               \"transportProtocol\": \"HTTP2\",\n               \"port\": 443,\n               \"tlsEnabled\": true\n            }\n         ],\n         \"hostnames\": [\n            \"{{environmentHostname}}\"\n         ],\n         \"policies\": {\n            \"tls-inbound\": [\n               {\n                  \"data\": {\n                     \"serverCerts\": [\n                        {\n                           \"key\": \"{{tls key}}\",\n                           \"cert\": \"{{tls cert}}\"\n                        }\n                     ]\n                  }\n               }\n            ]\n         }\n      }\n   ]\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring SMTP, POP3 and IMAP Servers\nDESCRIPTION: This snippet demonstrates how to configure individual SMTP, POP3, and IMAP servers within the `mail` context. It uses the `server` blocks to define settings such as the listening port, protocol, and permitted authentication methods.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n        listen    25;\n        protocol  smtp;\n        smtp_auth login plain cram-md5;\n    }\n\n    server {\n        listen    110;\n        protocol  pop3;\n        pop3_auth plain apop cram-md5;\n    }\n\n    server {\n        listen   143;\n        protocol imap;\n    }\n```\n\n----------------------------------------\n\nTITLE: Define Proxy Pass Directive NGINX\nDESCRIPTION: This code snippet demonstrates the use of the `proxy_pass` directive to define the upstream group or server to which traffic will be forwarded. It provides examples for forwarding TCP traffic to both an upstream group and a specific server, as well as forwarding UDP traffic to an upstream group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n\n    server {\n        listen     12345;\n        #TCP traffic will be forwarded to the \"stream_backend\" upstream group\n        proxy_pass stream_backend;\n    }\n\n    server {\n        listen     12346;\n        #TCP traffic will be forwarded to the specified server\n        proxy_pass backend.example.com:12346;\n    }\n\n    server {\n        listen     53 udp;\n        #UDP traffic will be forwarded to the \"dns_servers\" upstream group\n        proxy_pass dns_servers;\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Upstream Group for Load Balancing in Nginx\nDESCRIPTION: This snippet defines an upstream group named 'oracle' with two EBS application servers. It configures a shared memory zone for storing runtime state information and specifies the server addresses and ports. The `max_fails=0` parameter disables passive health checks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_21\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream oracle {\n    zone oracle 64k;\n    server 172.31.11.210:8000 max_fails=0;\n    server 172.31.0.146:8000 max_fails=0;\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Byte-Range Caching with Cache Slice module in Nginx\nDESCRIPTION: This snippet configures byte-range caching using the Cache Slice module.  It sets the slice size, includes the `$slice_range` variable in the cache key, enables caching of responses with the 206 status code, and passes the `$slice_range` variable in the Range header to the backend. The cache_slice module must be compiled with Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    slice  1m;\n}\n```\n\n----------------------------------------\n\nTITLE: Generic Hash Load Balancing\nDESCRIPTION: Configures Generic Hash load balancing using the `$request_uri` as the hash key. The `hash` directive specifies the key used to determine which server handles the request. The 'consistent' parameter enables ketama consistent hashing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    hash $request_uri consistent;\n    server backend1.example.com;\n    server backend2.example.com;\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Proxy Cache for Tomcat App Location\nDESCRIPTION: This snippet enables content caching for a specific location in the Nginx configuration. It uses the `proxy_cache` directive to reference the cache zone defined earlier, ensuring that requests to `/tomcat-app/` are cached if possible, improving response times and reducing server load.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_22\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /tomcat-app/ {\n    proxy_pass http://tomcat;\n    proxy_cache backcache;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Debug Logging for Specific IPs\nDESCRIPTION: These Nginx configuration directives enable debug logging for connections originating from the specified IP addresses or IP address ranges. This allows targeted debugging without impacting overall server performance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nerror_log /path/to/log;\n...\nevents {\n    debug_connection 192.168.1.1;\n    debug_connection 192.168.10.0/24;\n}\n```\n\n----------------------------------------\n\nTITLE: Define Exchange Health Check Match Block Nginx\nDESCRIPTION: This `match` block defines criteria for a successful Exchange health check by verifying the status code is 200 and the response body contains the string \"200 OK\". This is used in conjunction with the `health_check` directive to monitor backend servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_49\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nmatch exchange-health {\n    status 200;\n    body ~ \"200 OK\";\n}\n```\n\n----------------------------------------\n\nTITLE: Specifying JWT Type as Encrypted (JWE) in Nginx\nDESCRIPTION: This snippet demonstrates how to specify the type of JWT as encrypted (JWE) using the `auth_jwt_type` directive. This is necessary when using JSON Web Encryption instead of the default JSON Web Signature.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80;\n\n    location /products/ {\n        proxy_pass        http://api_server;\n        auth_jwt          \"API\";\n        auth_jwt_type     encrypted;\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Defining the internal /auth location\nDESCRIPTION: This snippet defines an internal location `/auth` which is used as the target for the authentication subrequest. It uses `proxy_pass` to forward the authentication request to an external authentication server, `http://auth-server`. The `internal` directive ensures that this location can only be accessed by internal requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-subrequest-authentication.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nlocation = /auth {\n    internal;\n    proxy_pass http://auth-server;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: JSON Log Example\nDESCRIPTION: This JSON snippet is an example of the `json_log` field included in NGINX App Protect security logs. It provides details about violations and signatures detected during a request, and whether they would result in blocking the request if the policy was enforced in Blocking Mode. The `isBlocked` property indicates the blocking status for each violation and signature.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/logging-overview/security-log.md#_snippet_7\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"violations\": [\n    {\n      \"enforcementState\": {\n        \"isBlocked\": false\n      },\n      \"violation\": {\n        \"name\": \"VIOL_URL_METACHAR\"\n      }\n    },\n    {\n      \"enforcementState\": {\n        \"isBlocked\": true\n      },\n      \"violation\": {\n        \"name\": \"VIOL_RATING_THREAT\"\n      }\n    },\n    {\n      \"enforcementState\": {\n        \"isBlocked\": true\n      },\n      \"signature\": {\n        \"name\": \"XSS script tag (URI)\",\n        \"signatureId\": 200000099\n      },\n      \"violation\": {\n        \"name\": \"VIOL_ATTACK_SIGNATURE\"\n      }\n    },\n    {\n      \"enforcementState\": {\n        \"isBlocked\": true\n      },\n      \"signature\": {\n        \"name\": \"XSS script tag end (URI)\",\n        \"signatureId\": 200000093\n      },\n      \"violation\": {\n        \"name\": \"VIOL_ATTACK_SIGNATURE\"\n      }\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Stream Context for Exchange Proxy (nginx)\nDESCRIPTION: This snippet configures the stream context for proxying Exchange IMAPS and SMTP services. It defines upstream servers for IMAPS and SMTP, configures server blocks to listen on ports 993 and 25, and sets up proxy passes to the respective upstream servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_59\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    upstream exchange-imaps {\n        zone exchange-imaps 64k;\n\n        server 10.0.0.237:993; # Replace with IP address of a CAS\n        server 10.0.0.238:993; # Replace with IP address of a CAS\n    }\n\n    upstream exchange-smtp {\n        zone exchange-smtp 64k;\n\n        server 10.0.0.237:25; # Replace with IP address of a CAS\n        server 10.0.0.238:25; # Replace with IP address of a CAS\n    }\n\n    server {\n        listen 993;\n        status_zone exchange-imaps;\n        proxy_pass exchange-imaps;\n    }\n\n    server {\n        listen 25; # SMTP port can be changed here (to 587, for example)\n        status_zone exchange-smtp;\n        proxy_pass exchange-smtp;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Full Configuration Example for Enhanced Load Balancing Nginx\nDESCRIPTION: This is an example of a complete nginx configuration. It configures the user, worker processes, error logging, events, and other top level parameters. It also contains the http block that will handle the different http configurations. \nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_56\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nworker_processes auto;\nerror_log /var/log/nginx/error.log info;\npid /var/run/nginx.pid;\n\nevents {\n    worker_connections 1024;\n}\n\n# If placing all directives in the main nginx.conf file, copy the following\n# 'http' block into it, including the initial and final lines ('http { ... }')\n# which open and close the 'http' context.\n\n# If creating a separate conf.d/exchange-http.conf file, either exclude the\n# initial and final lines from the copied region, or copy them but comment\n```\n\n----------------------------------------\n\nTITLE: Adding Peer IP to keepalived Configuration - YAML\nDESCRIPTION: This YAML snippet shows how to add the IP address of the new passive node to the `unicast_peer` section in the `keepalived.conf` file on the other nodes. This ensures that all nodes are aware of each other for proper communication and failover.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived-nodes.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\nunicast_peer {\n    192.168.10.11\n    192.168.10.12\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Full Configuration for Enhanced Load Balancing\nDESCRIPTION: This Nginx configuration provides enhanced load balancing for a Node.js application. It includes features such as HTTP to HTTPS redirection, load balancing using upstream groups, sticky sessions, caching, WebSocket support, health checks, and secured API access. It utilizes directives like `proxy_pass`, `proxy_cache`, `upstream`, `location`, `health_check`, `sticky`, and `ssl_*` to manage traffic and ensure high availability.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_37\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /tmp/NGINX_cache/ keys_zone=backcache:10m;\n\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n\nmatch nodejs_check {\n    status 200;\n    header Content-Type ~ \"text/html\";\n    body ~ \"Hello world\";\n}\n\nupstream nodejs {\n    # Health-monitored upstream groups must have a zone defined\n    zone nodejs 64k;\n\n    # List of Node.js application servers\n    server 192.168.33.11:8080 slow_start=30s;\n    server 192.168.33.12:8080 slow_start=30s;\n\n    # Session persistence using sticky cookie\n    sticky cookie srv_id expires=1h domain=.example.com path=/;\n}\n\nserver {\n    listen 80;\n    server_name example.com;\n\n    # Redirect all HTTP requests to HTTPS\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n\nserver {\n    listen 443 ssl;\n    http2  on;\n\n    server_name example.com;\n\n    # Required for NGINX Plus to provide extended status information\n    status_zone nodejs;\n\n    ssl_certificate            /etc/nginx/ssl/certificate-name;\n    ssl_certificate_key        /etc/nginx/ssl/private-key;\n    ssl_session_cache          shared:SSL:1m;\n    ssl_prefer_server_ciphers  on;\n\n    # Return a 302 redirect to '/webapp/' when user requests '/'\n    location = / {\n        return 302 /webapp/;\n    }\n\n    # Load balance requests for '/webapp/' across Node.js app servers\n    location /webapp/ {\n        proxy_pass http://nodejs;\n        proxy_cache backcache;\n        # Set up active health checks\n        health_check match=nodejs_check;\n    }\n\n    # WebSocket configuration\n    location /wstunnel/ {\n        proxy_pass https://nodejs;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n    }\n\n    # Secured access to the NGINX Plus API\n    location /api {\n        api write=on;\n        allow 127.0.0.1; # Permit access from localhost\n        deny all;        # Deny access from everywhere else\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing Brotli Module on Amazon Linux 2 LTS, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This command updates the package repositories and installs the nginx-plus-module-brotli package using the yum package manager.  This installs the necessary files for Brotli compression support in NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/brotli.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-brotli\n```\n\n----------------------------------------\n\nTITLE: Full Configuration for Basic Load Balancing\nDESCRIPTION: This is a complete Nginx configuration for basic load balancing.  It includes defining a proxy cache, mapping for websocket upgrades, an upstream block for JBoss servers, redirecting HTTP to HTTPS, enabling HTTP/2, configuring SSL, and setting up load balancing for the /webapp/ and /wstunnel/ locations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_23\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /tmp/NGINX_cache/ keys_zone=backcache:10m;\n\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n\nupstream jboss {\n    # Use IP Hash for session persistence\n    ip_hash;\n\n    # List of Wildfly application servers\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n}\n\nserver {\n    listen 80;\n    server_name example.com;\n\n    # Redirect all HTTP requests to HTTPS\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n\nserver {\n    listen 443 ssl;\n    http2  on;\n\n    server_name example.com;\n\n    ssl_certificate     /etc/nginx/ssl/<certificate-name>;\n    ssl_certificate_key /etc/nginx/ssl/<private-key>;\n    ssl_session_cache   shared:SSL:1m;\n    ssl_prefer_server_ciphers on;\n\n    # Load balance requests for '/webapp/' across Wildfly application servers\n    location /webapp/ {\n        proxy_pass http://jboss;\n        proxy_cache backcache;\n    }\n\n    # Return a temporary redirect to '/webapp/' when user requests '/'\n    location = / {\n        return 302 /webapp/;\n    }\n\n    # WebSocket configuration\n    location /wstunnel/ {\n        proxy_pass https://jboss;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n    }\n}\n\n```\n\n----------------------------------------\n\nTITLE: Configuring proxy_pass for HTTPS upstream in Nginx\nDESCRIPTION: This configuration snippet demonstrates how to set up the `proxy_pass` directive in Nginx to forward traffic to an HTTPS upstream server.  The `location` block defines the URL path that triggers the proxy, and `proxy_pass` specifies the upstream server's address using the `https` protocol. This enables SSL/TLS encryption for the connection between Nginx and the upstream.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-http-traffic-upstream.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /upstream {\n    proxy_pass https://backend.example.com;\n}\n```\n\n----------------------------------------\n\nTITLE: WebSocket Configuration\nDESCRIPTION: This snippet defines a map to manage WebSocket connection upgrades and specifies an upstream block for WebLogic servers, configuring IP hash for session persistence. It includes server definitions with their IP addresses and ports.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_26\n\nLANGUAGE: nginx\nCODE:\n```\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n\nupstream weblogic {\n    # Use IP Hash for session persistence\n    ip_hash;\n\n    # List of WebLogic Server application servers\n    server 192.168.25.33:7001;\n    server 192.168.25.69:7001;\n}\n```\n\n----------------------------------------\n\nTITLE: Querying Request Counts Based on App Security Processing\nDESCRIPTION: This example shows how to query the number of requests processed by App Security, grouped by 'request_outcome_reason'.  The startTime is set to 0 and endTime to now, with a resolution of 5 minutes.  It also includes a filter to narrow down the results to a specific application, environment, and component.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/view-app-security-analytics.md#_snippet_1\n\nLANGUAGE: curl\nCODE:\n```\nhttps://{{host}}/api/v1/analytics/metrics?\n    startTime=0&\n    endTime=now&\n    resolution=5m&\n    names=sum(http.request.count)&\n    groupBy=request_outcome_reason&\n    filter=(\n        app='shopping' and\n        environment='prod' and\n        component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Configuring WebSocket Proxying in NGINX\nDESCRIPTION: This configuration snippet shows how to proxy WebSocket traffic through Nginx. It includes a map block to set the Connection header and a location block to configure the proxy.  It sets necessary headers and the HTTP version to 1.1 to correctly proxy WebSocket connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_19\n\nLANGUAGE: nginx\nCODE:\n```\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n\nlocation /wstunnel/ {\n    proxy_pass http://jboss;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection $connection_upgrade;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP Basic Authentication in Nginx\nDESCRIPTION: This snippet configures HTTP Basic authentication for a specific location in Nginx.  It specifies the `auth_basic` directive to enable authentication and sets a message for the authentication prompt. The `auth_basic_user_file` directive points to the password file containing the user credentials.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-http-basic-authentication.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /api {\n    auth_basic \"Administrator’s Area\";\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Creating a CNAME Record in BIND DNS Server\nDESCRIPTION: This shell script demonstrates how to add a CNAME record to a BIND DNS zone file, mapping 'healthcheck.example.com' to 'healthy.svcs.example.com'. It includes commands to open the zone file, add the CNAME record, save the file, and reload the BIND service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nsudo nano /etc/bind/zones/db.example.com\n```\n\n----------------------------------------\n\nTITLE: Enabling SSL for TCP Stream\nDESCRIPTION: This snippet shows how to enable SSL for a TCP stream by specifying the `ssl` parameter in the `listen` directive within the `stream` context.  This tells NGINX Plus to accept SSL connections on the specified port. It requires an upstream group named 'backend' to proxy the traffic to.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-tcp.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n\n    server {\n        listen     12345 ssl;\n        proxy_pass backend;\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Sticky Learn Zone Synchronization in NGINX\nDESCRIPTION: This snippet configures sticky learn zone synchronization in NGINX. It adds the `sync` parameter to the `sticky` directive, allowing existing session state to be shared across the cluster. The `zone` name must be consistent across all NGINX nodes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nupstream my_backend {\n    zone my_backend 64k;\n\n\t\tserver backends.example.com resolve;\n\t\t\tsticky learn zone=sessions:1m\n\t\t\tcreate=$upstream_cookie_session\n\t\t\tlookup=$cookie_session\n\t\t\tsync;\n}\n\nserver {\n    listen 80;\n\t\tlocation / {\n\t\t    proxy_pass http://my_backend;\n\t\t}\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Conditional Logging in Nginx\nDESCRIPTION: This snippet enables conditional logging by excluding requests with HTTP status codes `2xx` (Success) and `3xx` (Redirection) from the access log. It uses the `map` directive to define a variable `$loggable` based on the `$status` and the `if` parameter of the `access_log` directive to conditionally log requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/logging.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nmap $status $loggable {\n    ~^[23]  0;\n    default 1;\n}\n\naccess_log /path/to/access.log combined if=$loggable;\n```\n\n----------------------------------------\n\nTITLE: Setting Worker Processes\nDESCRIPTION: This configuration snippet demonstrates how to set the number of worker processes to match the number of processors. It uses the `worker_processes` directive outside the mail context, as it's a global setting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nworker_processes auto;\n    mail {\n        #...\n    }\n```\n\n----------------------------------------\n\nTITLE: Pass OIDC Claims as Headers in NGINX\nDESCRIPTION: This configuration snippet shows how to pass OIDC claims as HTTP headers to the upstream application. It uses the `proxy_set_header` directive to set the 'sub', 'email', and 'name' headers based on the corresponding OIDC claims. This allows the application to identify the authenticated user.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/entra-id.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n\n     auth_oidc entra;\n\n     proxy_set_header sub   $oidc_claim_sub;\n     proxy_set_header email $oidc_claim_email;\n     proxy_set_header name  $oidc_claim_name;\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Configuring JWK File and Request in Nginx\nDESCRIPTION: This snippet demonstrates how to combine a local JWK file (`private_jwe_keys.jwk`) with a subrequest to an external identity provider (`https_//idp.example.com/keys`) to obtain public keys.  This setup allows Nginx to use both local and remote key sources for JWT validation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80;\n\n    location /products/ {\n        proxy_pass           http://api_server;\n        auth_jwt             \"API\";\n        auth_jwt_type        encrypted;\n        auth_jwt_key_file    private_jwe_keys.jwk;\n        auth_jwt_key_request /public_jws_keys;\n    }\n\n    location /public_jws_keys {\n        proxy_pass \"https_//idp.example.com/keys\";\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Set Memory and CPU Thresholds for WAF in NGINX\nDESCRIPTION: This snippet illustrates how to add an HTTP Snippet to a Gateway to control the memory and CPU threshold values which determine when NGINX App Protect enters and exits failure mode. It configures the `app_protect_physical_memory_util_thresholds` and `app_protect_cpu_thresholds` directives to set high and low utilization percentages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/concepts/extend-app-security-snippets.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"<gateway-name>\"\n    },\n    \"desiredState\": {\n        \"configSnippets\": {\n            \"httpSnippet\": {\n                \"directives\": [\n                    {\n                        \"directive\": \"app_protect_physical_memory_util_thresholds\",\n                        \"args\": [\"high=85 low=60\"]\n                    },\n                    {\n                        \"directive\": \"app_protect_cpu_thresholds\",\n                        \"args\": [\"high=85 low=60\"]\n                    }\n                ]\n            }\n        },\n        \"ingress\": {\n            \"uris\": {\n                \"http://example.com:8000\": {}\n            },\n            \"placement\":  {\n                \"instanceRefs\": [\n                    {\n                        \"ref\": \"/infrastructure/locations/unspecified/instances/<instance-name>\"\n                    }\n                ]\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Least Connections Load Balancing\nDESCRIPTION: Configures Least Connections load balancing for the 'backend' upstream group. The `least_conn` directive ensures that requests are sent to the server with the fewest active connections.  This method helps balance the load based on real-time connection counts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    least_conn;\n    server backend1.example.com;\n    server backend2.example.com;\n}\n```\n\n----------------------------------------\n\nTITLE: Configure SSL session ticket key in NGINX\nDESCRIPTION: This snippet demonstrates how to configure NGINX to use a secret key for encrypting and decrypting TLS session tickets with `ssl_session_ticket_key` directive. The file specified should contain 80 or 48 bytes of random data generated using `openssl` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/securing-upstream-traffic.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    server {\n         ssl_certificate /etc/nginx/client.pem;\n         ssl_certificate_key /etc/nginx/client.key;\n         ssl_client_certificate /etc/nginx/ca.pem;\n         ssl_session_ticket_key keys;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enable Shared Memory Zone for Upstream - Nginx\nDESCRIPTION: This Nginx configuration snippet adds the `zone` directive to the `appservers` upstream block. This directive creates a shared memory zone that allows worker processes to share the upstream configuration and enables dynamic configuration through the Nginx Plus API. The `zone` directive is essential for managing upstreams without reloads.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/dynamic-configuration-api.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    upstream appservers {\n        zone appservers 64k;\n\n        server appserv1.example.com      weight=5;\n        server appserv2.example.com:8080 fail_timeout=5s;\n        server reserve1.example.com:8080 backup;\n        server reserve2.example.com:8080 backup;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Base64 Encode Docker Credentials\nDESCRIPTION: This command encodes Docker registry credentials into a base64 string, which can then be used in the values.yaml file to allow Kubernetes to pull images from the private registry. Replace <JWT Token> with the actual JWT token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-helm.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\necho '{\n    \"auths\": {\n        \"private-registry.nginx.com\": {\n            \"username\": \"<JWT Token>\",\n            \"password\": \"none\"\n        }\n    }\n}' | base64 -w 0\n```\n\n----------------------------------------\n\nTITLE: Docker Compose Configuration for NGINX App Protect with mTLS (YAML)\nDESCRIPTION: Defines a Docker Compose configuration for NGINX with App Protect Enforcer, and Config Manager, securing traffic with mTLS. It mounts volumes for configuration, defines network settings, and specifies dependencies between services. Key aspects include certificate volume mounting, environment variables for the Enforcer, and service dependencies to ensure proper startup order.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_9\n\nLANGUAGE: YAML\nCODE:\n```\nservices:\n\t  nginx:\n\t    container_name: nginx\n\t    image: nginx-app-protect-5\n\t    volumes:\n\t      - app_protect_bd_config:/opt/app_protect/bd_config\n\t      - app_protect_config:/opt/app_protect/config\n\t      - app_protect_etc_config:/etc/app_protect/conf\n\t      - /conf/nginx.conf:/etc/nginx/nginx.conf # based on the provided example\n\t      - /conf/default.conf:/etc/nginx/conf.d/default.conf # based on the provided example\n\t      - /path/to/your/certs:/etc/ssl/certs  # mount certificates directory\n\t    networks:\n\t      - waf_network\n\t    ports:\n\t      - \"80:80\"\n\n\t  waf-enforcer:\n\t    container_name: waf-enforcer\n\t    image: \"private-registry.nginx.com/nap/waf-enforcer:<version-tag>\"\n\t    environment:\n\t      - ENFORCER_PORT=4431\n\t      - ENFORCER_SERVER_CERT=/etc/ssl/certs/app_protect_server.crt\n\t      - ENFORCER_SERVER_KEY=/etc/ssl/certs/app_protect_server.key\n\t      - ENFORCER_CA_FILE=/etc/ssl/certs/app_protect_client_ca.crt\n\t    volumes:\n\t      - app_protect_bd_config:/opt/app_protect/bd_config\n\t      - /path/to/your/certs:/etc/ssl/certs  # mount certificates directory\n\t    networks:\n\t      - waf_network\n\t    restart: always\n\n\t  waf-config-mgr:\n\t    container_name: waf-config-mgr\n\t    image: \"private-registry.nginx.com/nap/waf-config-mgr:<version-tag>\"\n\t    volumes:\n\t      - app_protect_bd_config:/opt/app_protect/bd_config\n\t      - app_protect_config:/opt/app_protect/config\n\t      - app_protect_etc_config:/etc/app_protect/conf\n\t    restart: always\n\t    network_mode: none\n\t    depends_on:\n\t      waf-enforcer:\n\t        condition: service_started\n\n\tnetworks:\n\t  waf_network:\n\t    driver: bridge\n\n\tvolumes:\n\t  app_protect_bd_config:\n\t  app_protect_config:\n\t  app_protect_etc_config:\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS SRV records in Nginx\nDESCRIPTION: This snippet configures Nginx to use DNS SRV records for dynamic upstream server configuration.  The `service` parameter, along with the `resolve` parameter, instructs Nginx to use the additional information in the DNS SRV records, such as the port number, when resolving the domain name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_36\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nresolver <IP-address-of-DNS-server>;\n\nupstream nodejs {\n    zone nodejs 64k;\n    server example.com service=http resolve;\n}\n```\n\n----------------------------------------\n\nTITLE: Serving Static Files from a Location\nDESCRIPTION: This snippet demonstrates how to serve static files from a specific directory using the `root` directive within a `location` block.  Requests matching `/images/` will serve files from `/data/`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    location /images/ {\n        root /data;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Tcp_nopush in Nginx\nDESCRIPTION: This snippet demonstrates enabling the `tcp_nopush` directive, which sends HTTP response headers in one packet right after the chunk of data has been obtained by `sendfile()`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /mp3 {\n    sendfile   on;\n    tcp_nopush on;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect WAF Basic Configuration\nDESCRIPTION: This example demonstrates a basic NGINX configuration with App Protect WAF enabled. It includes enabling App Protect, referencing a security policy file, enabling security logging, and defining a remote logger. The configuration also includes a server block with a proxy pass to a backend server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nworker_processes  4;\n\nload_module modules/ngx_http_app_protect_module.so;\n\nerror_log /var/log/nginx/error.log debug;\n\nevents {\n    worker_connections  65536;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    app_protect_enable on; # This is how you enable NGINX App Protect WAF in the relevant context/block\n    app_protect_policy_file \"/etc/app_protect/conf/NginxDefaultPolicy.json\"; # This is a reference to the policy file to use. If not defined, the default policy is used\n    app_protect_security_log_enable on; # This section enables the logging capability\n    app_protect_security_log \"/etc/app_protect/conf/log_default.json\" syslog:server=127.0.0.1:514; # This is where the remote logger is defined in terms of: logging options (defined in the referenced file), log server IP, log server port\n\n    server {\n        listen       80;\n        server_name  localhost;\n        proxy_http_version 1.1;\n\n        location / {\n            client_max_body_size 0;\n            default_type text/html;\n            proxy_pass http://172.29.38.211:80$request_uri;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Path Rewrite - Kubernetes YAML\nDESCRIPTION: This Kubernetes YAML configures an HTTPRoute to rewrite the traffic URL for the coffee application. It defines two filters: one to rewrite `/coffee` and `/coffee/flavors` to `/beans`, and another to rewrite `/latte` to `/prices`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: coffee\nspec:\n  parentRefs:\n  - name: gateway\n    sectionName: http\n  hostnames:\n  - \"cafe.example.com\"\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /coffee\n    filters:\n    - type: URLRewrite\n      urlRewrite:\n        path:\n          type: ReplaceFullPath\n          replaceFullPath: /beans\n    backendRefs:\n    - name: coffee\n      port: 80\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /latte\n    filters:\n    - type: URLRewrite\n      urlRewrite:\n        path:\n          type: ReplacePrefixMatch\n          replacePrefixMatch: /\n    backendRefs:\n    - name: coffee\n      port: 80\nEOF\n```\n\n----------------------------------------\n\nTITLE: Validate NGINX Configuration - Azure CLI\nDESCRIPTION: This snippet validates an NGINX configuration before submission. It uses the `analyze` command and requires the deployment name, resource group, root file, a configuration name and the files that compose the configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configuration-azure-cli.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment configuration analyze --deployment-name $DEPLOYMENT_NAME \\\n   --resource-group $RESOURCE_GROUP --root-file /etc/nginx/nginx.conf \\\n   --name default --files \"$FILES_CONTENT\"\n```\n\n----------------------------------------\n\nTITLE: Enabling HTTP/2 in NGINX Server Block\nDESCRIPTION: This configuration enables HTTP/2 support for HTTPS traffic within a server block. The listen directive specifies the port, and the http2 directive turns on HTTP/2 protocol support.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_22\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlisten 443 ssl;\nhttp2  on;\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP Basic Authentication in NGINX\nDESCRIPTION: This snippet configures HTTP Basic Authentication for a specific location in NGINX. It uses the `auth_basic` directive to define the protected area and `auth_basic_user_file` to specify the password file location. Ensure the password file is placed in a directory the NGINX worker processes can read (e.g., /opt, /srv, /var/www).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/auth-basic.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /protected {\n    auth_basic           \"Protected Area\";\n    auth_basic_user_file /opt/.htpasswd;\n}\n```\n\n----------------------------------------\n\nTITLE: Restricting Cache Purge Access with geo and map directives in NGINX\nDESCRIPTION: This snippet uses the `geo` directive to define allowed IP addresses for cache purging and the `map` directive to associate the allowed IPs with the PURGE request method. If a request uses the PURGE method and originates from a whitelisted IP, the `$purge_method` variable is set, allowing purging to proceed. Otherwise, purging is denied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\ngeo $purge_allowed {\n   default         0;  # deny from other\n   10.0.0.1        1;  # allow from 10.0.0.1 address\n   192.168.0.0/24  1;  # allow from 192.168.0.0/24\n}\n\nmap $request_method $purge_method {\n   PURGE   $purge_allowed;\n   default 0;\n}\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Stable Helm Repository\nDESCRIPTION: Adds the official NGINX stable Helm repository to the local Helm configuration.  This allows users to install charts directly from the NGINX repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nhelm repo add nginx-stable https://helm.nginx.com/stable\n```\n\n----------------------------------------\n\nTITLE: Restricting Access by IP Address in Nginx\nDESCRIPTION: This snippet demonstrates how to restrict access to a specific location based on IP addresses using the `allow` and `deny` directives. It allows access from the `192.168.1.1/24` network (excluding `192.168.1.2`) and `127.0.0.1`, while denying access from all other IP addresses.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-http-basic-authentication.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /api {\n    #...\n    deny  192.168.1.2;\n    allow 192.168.1.1/24;\n    allow 127.0.0.1;\n    deny  all;\n}\n```\n\n----------------------------------------\n\nTITLE: Create ConfigMap for CA Certificate (YAML)\nDESCRIPTION: This snippet creates a Kubernetes ConfigMap named `backend-cert` to store the CA certificate (`ca.crt`) used for verifying self-signed certificates for backend TLS termination. The ConfigMap is applied using `kubectl apply`. The certificate is embedded within the YAML definition.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/securing-backend-traffic.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: backend-cert\ndata:\n  ca.crt: |\n    -----BEGIN CERTIFICATE-----\n    MIIDbTCCAlWgAwIBAgIUPA3fFnkLl63GZ7noUjb5NoLhSYkwDQYJKoZIhvcNAQEL\n    BQAwRjEfMB0GA1UEAwwWc2VjdXJlLWFwcC5leGFtcGxlLmNvbTELMAkGA1UEBhMC\n    VVMxFjAUBgNVBAcMDVNhbiBGcmFuc2lzY28wHhcNMjQwMTE4MTgwMTAxWhcNMjUw\n    MTA4MTgwMTAxWjBGMR8wHQYDVQQDDBZzZWN1cmUtYXBwLmV4YW1wbGUuY29tMQsw\n    CQYDVQQGEwJVUzEWMBQGA1UEBwwNU2FuIEZyYW5jaXNjbzCCASIwDQYJKoZIhvcN\n    AQEBBQADggEPADCCAQoCggEBAJGgn81BrqzmI4aQmGrg7RgkO5oYwlThQ9X/xVHB\n    YVFptjRPAZz9g92g5birI/NZ43C6nEbZrJrSCqN3wgvV84jJmBAgpAvW+LhF4caa\n    nhAnecJCcTbwrd542vCDoDRsNV5ffbpESgC4FxPGkRVbSa0KHQz8qCLqS2+uaB7X\n    t76iw6y4pQ3klobVp1XtUpzZMGMBqZFnsAdl+PWMmSTvqjixkSlfcUY6Crnk9W6d\n    Sns5cpzKdUs+2ZkBe6VkBgSs8xbaz8Y2YC1GhRqGlxYLT3WBaIlSCKPuRrGjwE3r\n    AsW6gSL919H1O1a+MjQuLuQ4lnCbCpNzM9OV1JISMWfwifMCAwEAAaNTMFEwHQYD\n    VR0OBBYEFOEzjs7FrQr1bW3mKkUgI+5Fo9XaMB8GA1UdIwQYMBaAFOEzjs7FrQr1\n    bW3mKkUgI+5Fo9XaMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEB\n    AG/eX4pctINIrHvRyHOusdac5iXSJbQRZgWvP1F2p95qoIDESciAU1Sh1oJv+As5\n    IlJOZPJNuZFpDLjc8kzSoEbc1Q5+QyTBlyNNsagWYYwK0CEJ6KJt80vytffmdOIg\n    z8/a+2Ax829vcn1w1SUi5V6ea/l8K74f2SL/zSSHgtEiz8V0TlvT7J6wurgmnk4t\n    yQRmsXlDGefuijMNCVf7jWwLx2BODfKoEA1pJkthnNvdizlikmz+9elxhV9bRf3Y\n    NnubytWPfO1oeHjVGvxVjCouIYine+VlskvwHmMi/dYod6yd7aFYu4CU3g/hjwKo\n    LY2WNv5j3JhDnEYK9Zj3z7A=\n    -----END CERTIFICATE-----\nEOF\n```\n\n----------------------------------------\n\nTITLE: Configuring Single HTTP/HTTPS Server - NGINX\nDESCRIPTION: This configuration allows a single NGINX server to handle both HTTP (port 80) and HTTPS (port 443) requests. The `listen` directives specify the ports and the `ssl` parameter enables HTTPS.  The `ssl_certificate` and `ssl_certificate_key` directives specify the paths to the SSL certificate and private key files respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen              80;\n    listen              443 ssl;\n    server_name         www.example.com;\n    ssl_certificate     www.example.com.crt;\n    ssl_certificate_key www.example.com.key;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: JSON Log for 'login_page' Override Rule (shell)\nDESCRIPTION: This snippet demonstrates how the `json_log` field is populated when the 'login_page' override rule is matched. The `policy_name` is set to 'login_page_block_redirect'. The JSON will contain 'overrideRule' with the name 'login_page' and 'originalPolicyName' set to 'override_rule_example'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/override-rules-logging-reporting.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\n...\\npolicy_name=\"login_page_block_redirect\"\\n...\n```\n\n----------------------------------------\n\nTITLE: Configure Health Check\nDESCRIPTION: Configures an Nginx server block with an upstream for backend servers and a dedicated @healthcheck location. The @healthcheck location performs health checks by proxying requests to the backend servers and setting timeouts.  A health_check directive sets up the health monitoring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/route-53-global-server-load-balancing.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend-servers {\n    server <public DNS name of Backend 1>; # Backend 1\n    server <public DNS name of Backend 2>; # Backend 2\n    zone backend-servers 64k;\n}\n\nserver {\n    location / {\n        proxy_pass http://backend-servers;\n    }\n\n    location @healthcheck {\n        proxy_pass http://backend-servers;\n        proxy_connect_timeout 1s;\n        proxy_read_timeout 1s;\n        health_check uri=/ interval=1s;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Gateway Fabric from OCI Registry (NGINX OSS)\nDESCRIPTION: This command installs the latest stable release of NGINX Gateway Fabric in the 'nginx-gateway' namespace using Helm from the OCI registry. It creates the namespace if it doesn't exist. Requires Helm 3.0+ and kubectl.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nhelm install ngf oci://ghcr.io/nginx/charts/nginx-gateway-fabric --create-namespace -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Adding a Response Headers Policy via REST API in JSON\nDESCRIPTION: This JSON payload is sent via a PUT request to the environment endpoint to create or update a Response Headers policy. The policy configuration includes enabling/disabling various header functionalities (e.g., web-security-headers, correlation-id) and setting custom response headers. The `always` flag determines if the configuration should be applied regardless of the response status.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-response-headers.md#_snippet_12\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policies\": {\n        \"proxy-response-headers\": [\n            {\n                \"action\": {\n                    \"config\": [\n                        {\n                            \"always\": true,\n                            \"enabled\": true,\n                            \"name\": \"web-security-headers\"\n                        },\n                        {\n                            \"always\": true,\n                            \"enabled\": true,\n                            \"name\": \"correlation-id\"\n                        },\n                        {\n                            \"always\": false,\n                            \"enabled\": true,\n                            \"name\": \"latency-headers\"\n                        },\n                        {\n                            \"always\": true,\n                            \"enabled\": true,\n                            \"name\": \"cache-headers\"\n                        },\n                        {\n                            \"always\": false,\n                            \"enabled\": false,\n                            \"name\": \"hide-nginx-headers\"\n                        },\n                        {\n                            \"always\": true,\n                            \"enabled\": true,\n                            \"name\": \"client-headers\"\n                        }\n                    ],\n                    \"customResponseHeaders\": [\n                        {\n                            \"always\": true,\n                            \"key\": \"x-custom-header\",\n                            \"value\": \"3da14f4aea89f\"\n                        }\n                    ]\n                }\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX Signing Key on Debian (Shell)\nDESCRIPTION: This command downloads the NGINX signing key, converts it to a usable format, and saves it in the `/usr/share/keyrings/nginx-archive-keyring.gpg` file on Debian systems. This key is used to verify the authenticity of packages from the NGINX repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nwget -qO - https://cs.nginx.com/static/keys/nginx_signing.key \\\n| gpg --dearmor \\\n| sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null\n```\n\n----------------------------------------\n\nTITLE: Disabling mTLS globally using nginx-meshctl\nDESCRIPTION: This bash command shows how to disable mTLS globally when deploying NGINX Service Mesh. The `--mtls-mode off` flag is passed to the `nginx-meshctl deploy` command, which configures the mesh to operate without mutual TLS encryption. This is useful for initial setup or when mTLS is not required for all services.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/secure-traffic-mtls.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --mtls-mode off\n```\n\n----------------------------------------\n\nTITLE: Virtual Server Configuration in NGINX Plus\nDESCRIPTION: This snippet configures a virtual server in NGINX Plus. It listens on a specific IP address and port, and uses the server_name directive to match the Host header for requests ending in .example.com.  The listen directive specifies the IP address and port to listen on, and the server_name directive specifies the hostname(s) to match.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 10.0.0.99:80;\n    server_name .example.com;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTPS Virtual Server - Nginx\nDESCRIPTION: This snippet configures a server block to listen for HTTPS requests on port 443 for a specific domain. It includes directives for specifying the SSL certificate, private key, session cache, and preferred server ciphers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 443 ssl;\n    server_name example.com;\n\n    ssl_certificate     /etc/nginx/ssl/example.com.crt;\n    ssl_certificate_key /etc/nginx/ssl/example.com.key;\n    ssl_session_cache   shared:SSL:1m;\n    ssl_prefer_server_ciphers on;\n}\n```\n\n----------------------------------------\n\nTITLE: Setting RealIP Header to PROXY Protocol\nDESCRIPTION: This snippet configures the `real_ip_header` directive within the `http` block to use the PROXY protocol for obtaining the client IP address. This tells the RealIP module to expect the client IP address to be provided in the PROXY protocol header. This must be used in conjunction with `set_real_ip_from`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/using-proxy-protocol.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    server {\n        #...\n        real_ip_header proxy_protocol;\n      }\n}\n```\n\n----------------------------------------\n\nTITLE: Delaying Excessive Requests in Nginx\nDESCRIPTION: This snippet configures Nginx to pass the first 3 excessive requests without delay, delay the next 2 requests, and reject any further excessive requests beyond the configured burst limit.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n\n    limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;\n\n    server {\n        #...\n\n        location /search/ {\n            limit_req zone=one burst=5 delay=3;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Server Group Zone in NGINX\nDESCRIPTION: This snippet demonstrates how to configure a `zone` directive within an `upstream` block in NGINX.  This enables statistics collection for the upstream server group, allowing it to be monitored in the live activity monitoring dashboard. The `zone` directive allocates shared memory for tracking the upstream group's state.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    zone   backend 64k;\n    server backend1.example.com;\n    server backend2.example.com;\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Plus Sticky Cookie Session Persistence\nDESCRIPTION: This snippet configures session persistence using the `sticky cookie` method in NGINX Plus. A cookie named `srv_id` is added to the first response from the upstream server, and subsequent requests containing this cookie are routed to the same server. The cookie has an expiration time, domain, and path specified.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    server backend1.example.com;\n    server backend2.example.com;\n    sticky cookie srv_id expires=1h domain=.example.com path=/;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Content Caching\nDESCRIPTION: This configuration snippet sets up a simple caching mechanism in NGINX to cache content from a WebLogic Server backend. It defines a cache path and key zone and then configures a location block to use the cache.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_21\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nproxy_cache_path /tmp/NGINX_cache/ keys_zone=backcache:10m;\n```\n\n----------------------------------------\n\nTITLE: Configuring Session Persistence with IP Hash - Nginx\nDESCRIPTION: This snippet configures session persistence using the 'ip_hash' directive within an upstream block. This ensures that requests from the same client IP address are consistently routed to the same backend server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_17\n\nLANGUAGE: nginx\nCODE:\n```\nupstream tomcat {\n    ip_hash;\n    server 10.100.100.11:8080;\n    server 10.100.100.12:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: Complete NGINX Configuration Example\nDESCRIPTION: This complete example summarizes the steps outlined above. It includes specifying the DNS resolver, defining the OIDC provider, configuring SSL, and proxying requests to an internal server. Replace `<client_id>` and `<client_secret>` with your actual AD FS Client ID and Secret.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/active-directory-federation-services.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # Use a public DNS resolver for Issuer discovery, etc.\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider adfs {\n\n        # The 'issuer' is typically your AD FS OIDC URL\n        # e.g. https://adfs.example.com/adfs\n        issuer https://adfs.example.com/adfs;\n\n        # Replace with your actual AD FS Client ID and Secret\n        client_id     <client_id>;\n        client_secret <client_secret>;\n    }\n\n    server {\n        listen      443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate     /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n            # Protect this location with AD FS OIDC\n            auth_oidc adfs;\n\n            # Forward OIDC claims as headers if desired\n            proxy_set_header sub   $oidc_claim_sub;\n            proxy_set_header email $oidc_claim_email;\n            proxy_set_header name  $oidc_claim_name;\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n\n    server {\n        listen 8080;\n\n        location / {\n            return 200 \"Hello, $http_name!\\nEmail: $http_email\\nAD FS sub: $http_sub\\n\";\n            default_type text/plain;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Cache Purger Process in Nginx\nDESCRIPTION: This configuration enables a special cache purger process using the `purger=on` parameter in the `proxy_cache_path` directive. This process iterates through all cache entries and deletes those matching a wildcard key, effectively removing files from the cache when combined with appropriate purging logic in the server block. It requires the `ngx_http_proxy_module`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /data/nginx/cache levels=1:2 keys_zone=mycache:10m purger=on;\n```\n\n----------------------------------------\n\nTITLE: Enabling NJS Dynamic Modules - Nginx\nDESCRIPTION: This configuration snippet shows how to enable the Nginx JavaScript (njs) dynamic module by using the `load_module` directive in the main Nginx configuration file (nginx.conf).  These directives load the specified shared object files, making the module's functionality available to Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/dynamic-modules.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\nload_module modules/ngx_stream_js_module.so;\n```\n\n----------------------------------------\n\nTITLE: Configuring buffers for Nginx proxy\nDESCRIPTION: This snippet demonstrates how to configure the buffering settings for responses from proxied servers. `proxy_buffers` sets the number and size of the buffers used for storing the response, while `proxy_buffer_size` sets the size of the buffer used for the first part of the response. Adjusting these values can help optimize performance based on the characteristics of the backend server and the clients.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/reverse-proxy.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /some/path/ {\n    proxy_buffers 16 4k;\n    proxy_buffer_size 2k;\n    proxy_pass http://localhost:8000;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP Headers for Exchange Proxy in NGINX\nDESCRIPTION: This configuration sets the `proxy_http_version` to 1.1 and the `proxy_set_header` to an empty connection string.  This configures Nginx to use HTTP 1.1 and disable keepalive connections to the upstream Exchange servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_19\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    # ...\n    proxy_http_version 1.1;\n    proxy_set_header   Connection \"\";\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Passive Health Check Configuration\nDESCRIPTION: Configures passive health checks for TCP servers. This involves setting `max_fails` to define the number of failed connection attempts within the `fail_timeout` duration before the server is marked as unavailable. This snippet configures `backend2.example.com` to be considered unavailable after 2 failed attempts within 30 seconds.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nupstream stream_backend {\n    server backend1.example.com:12345 weight=5;\n    server backend2.example.com:12345 max_fails=2 fail_timeout=30s;\n    server backend3.example.com:12346 max_conns=3;\n}\n```\n\n----------------------------------------\n\nTITLE: Create Network Security Perimeter Profile - Azure CLI\nDESCRIPTION: This snippet creates a network security perimeter profile using the Azure CLI. It requires setting the `PROFILE_NAME`, `NSP_RESOURCE_GROUP`, and `NSP_NAME` environment variables.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\naz network perimeter profile create --name $PROFILE_NAME \\\n      --resource-group $NSP_RESOURCE_GROUP \\\n      --perimeter-name $NSP_NAME\n```\n\n----------------------------------------\n\nTITLE: Import NGINX Signing Key - Shell\nDESCRIPTION: Imports the NGINX signing key into the rpm database. This allows zypper and rpm to verify the authenticity of packages signed with this key when installing from the Nginx Agent repository on SLES.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\nsudo rpmkeys --import /tmp/nginx_signing.key\n```\n\n----------------------------------------\n\nTITLE: Configure access_log with Syslog - Nginx\nDESCRIPTION: Configures the `access_log` directive to send logs to a Syslog server. This allows centralized log management and integration with other monitoring tools. The example uses `127.0.0.1:12000` as Syslog server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-metrics-collection.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\naccess_log syslog:server=127.0.0.1:12000,tag=controller,severity=info main_ext;\n```\n\n----------------------------------------\n\nTITLE: Configure Proxy Cache for a Location in Nginx\nDESCRIPTION: This configuration block sets up proxy caching for a specific location. The `proxy_cache` directive references the cache defined by `proxy_cache_path`. This ensures that responses from the backend server are cached for requests to the `/webapp/` location, improving response times and reducing server load.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_21\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /webapp/ {\n    proxy_pass http://nodejs;\n    proxy_cache backcache;\n}\n```\n\n----------------------------------------\n\nTITLE: Complete Load Balancer Configuration NGINX\nDESCRIPTION: This snippet presents a complete NGINX Plus configuration, including upstream definitions with zones, server blocks for HTTP and HTTPS, health checks, and status monitoring setup. It configures sticky sessions, keepalive connections, proxy settings, and live activity monitoring via the NGINX Plus API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_19\n\nLANGUAGE: nginx\nCODE:\n```\nupstream test_pool {\n    zone test_pool_zone 64k;\n    server 10.10.10.10:80;\n    server 10.10.10.20:80;\n    sticky cookie mysession expires=1h;\n    keepalive 32;\n}\n\nupstream ssl_test_pool {\n    zone ssl_test_pool_zone 64k;\n    server 10.10.10.10:443;\n    server 10.10.10.20:443;\n    sticky cookie mysession expires=1h;\n    keepalive 32;\n}\n\nserver {\n    listen 192.168.10.10:80 default_server;\n    proxy_set_header Host $host;\n\n    location / {\n         proxy_pass http://test_pool;\n         health_check;\n         proxy_http_version 1.1;\n    }\n\n    location ~ /favicon.ico {\n        root /usr/share/nginx/images;\n    }\n}\n\nserver {\n    listen 192.168.10.10:443 ssl default_server;\n    ssl_certificate     test.crt;\n    ssl_certificate_key test.key;\n    proxy_set_header    Host $host;\n\n    location / {\n        proxy_pass https://ssl_test_pool;\n        proxy_http_version 1.1;\n        proxy_set_header Connection \"\";\n        health_check;\n    }\n\n    location ~ /favicon.ico {\n        root /usr/share/nginx/images;\n    }\n}\n\nserver {\n    listen 8080;\n    status_zone status-page;\n    root /usr/share/nginx/html;\n\n    location /api {\n        api write=on;\n        # directives controlling access, such as 'allow' and 'deny'\n    }\n\n    location = /dashboard.html {\n        root /usr/share/nginx/html;\n    }\n\n    # Redirect requests made to the old (pre-R14) dashboard\n    location = /status.html {\n        return 301 /dashboard.html;\n    }\n\n    location ~ /favicon.ico {\n        root /usr/share/nginx/images;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Least Time Load Balancing in NGINX Stream\nDESCRIPTION: This snippet configures the Least Time load balancing method, where NGINX selects the server with the lowest average latency and the least number of active connections. The `least_time` directive specifies which metric to use for latency calculation (e.g., `first_byte`).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nupstream stream_backend {\n    least_time first_byte;\n    server backend1.example.com:12345;\n    server backend2.example.com:12345;\n    server backend3.example.com:12346;\n}\n```\n\n----------------------------------------\n\nTITLE: Health Checks NGINX\nDESCRIPTION: This snippet configures HTTP health checks in NGINX Plus. It defines an upstream group `test_pool` with a shared memory zone. Inside a `server` block, it sets up a `location` block to proxy requests to the `test_pool` and enables health checks with an interval of 5 seconds and 2 failed attempts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_17\n\nLANGUAGE: nginx\nCODE:\n```\nupstream test_pool {\n    # ...\n    zone test_pool_zone 64k;\n}\n\nserver {\n   # ...\n   location / {\n       proxy_pass http://test_pool;\n       health_check interval=5 fails=2;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Editing GatewayClass to attach NginxProxy\nDESCRIPTION: This command opens the 'nginx' GatewayClass in your default editor to attach the NginxProxy resource. The `parametersRef` section in the spec is updated to point to the created NginxProxy resource, allowing NGINX Gateway Fabric to utilize its configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/data-plane-configuration.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nkubectl edit gatewayclass nginx\n```\n\n----------------------------------------\n\nTITLE: Example NGINX Configuration for OIDC with Localhost Upstream\nDESCRIPTION: This is a complete example of an Nginx configuration file (`nginx.conf`) demonstrating OpenID Connect (OIDC) integration with a localhost upstream server.  It includes module loading, HTTP server configuration, and stream configuration for zone synchronization. It needs the `ngx_http_js_module` module installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/oidc.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\n\nhttp {\n\n    # This is the backend application we are protecting with OpenID Connect\n    upstream my_backend {\n        zone my_backend 64k;\n        # Reuse the localhost as a upstream server\n        # Modify to the real upstream server address if you have\n        server 127.0.0.1;\n    }\n\n    # A local server block representing the upstream server for testing only\n    # Remove if you have the real upstream servers\n    server {\n        listen 80;\n        default_type text/html;\n        return 200 '<!DOCTYPE html><h2>This is a site protected by OIDC!</h2>\\n';\n    }\n\n    # Custom log format to include the 'sub' claim in the REMOTE_USER field\n    log_format main_jwt '$remote_addr - $jwt_claim_sub [$time_local] \"$request\" $status '\n                        '$body_bytes_sent \"$http_referer\" \"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    # The frontend server - reverse proxy with OpenID Connect authentication\n    #\n    include conf.d/openid_connect_configuration.conf;\n    server {\n        include conf.d/openid_connect.server_conf; # Authorization code flow and Relying Party processing\n        error_log /var/log/nginx/error.log debug;  # Reduce severity level as required\n\n        listen 443 ssl; # Use SSL/TLS in production\n        ssl_certificate /etc/nginx/ssl/my-cert.crt;\n        ssl_certificate_key /etc/nginx/ssl/my-cert.key;\n\n        location / {\n            # This site is protected with OpenID Connect\n            auth_jwt \"\" token=$session_jwt;\n            error_page 401 = @do_oidc_flow;\n\n            #auth_jwt_key_file $oidc_jwt_keyfile; # Enable when using filename\n            auth_jwt_key_request /_jwks_uri; # Enable when using URL\n\n            # Successfully authenticated users are proxied to the backend,\n            # with 'sub' claim passed as HTTP header\n            proxy_set_header username $jwt_claim_sub;\n\n            # Bearer token is uses to authorize NGINX to access protected backend\n            #proxy_set_header Authorization \"Bearer $access_token\";\n\n            # Intercept and redirect \"401 Unauthorized\" proxied responses to nginx\n            # for processing with the error_page directive. Necessary if Access Token\n            # can expire before ID Token.\n            #proxy_intercept_errors on;\n\n            proxy_pass http://my_backend; # The backend site/app\n\n            access_log /var/log/nginx/access.log main_jwt;\n        }\n    }\n}\n\nstream {\n    # Add localhost resolver for internal clustering hostname with resolver metrics collection\n    resolver 127.0.0.1:49153 valid=20s status_zone=stream_resolver_zone1;\n\n    server {\n        listen 9000;\n        zone_sync;\n        zone_sync_server internal.nginxaas.nginx.com:9000 resolve;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Start NGINX Plus Container (Docker)\nDESCRIPTION: This command starts a Docker container for NGINX Plus, connecting it to NGINX One.  It configures environment variables such as the JWT license, agent server host and port, and data plane key. Replace `YOUR_JWT_HERE` with your JWT and `YOUR_NGINX_ONE_DATA_PLANE_KEY_HERE` with your NGINX One data plane key, and `VERSION_TAG` with the tag used when the image was pulled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/containers/connect-nginx-plus-container-images-to-nginx-one.md#_snippet_3\n\nLANGUAGE: sh\nCODE:\n```\nsudo docker run \\\n--env=NGINX_LICENSE_JWT=\"YOUR_JWT_HERE\" \\\n--env=NGINX_AGENT_SERVER_GRPCPORT=443 \\\n--env=NGINX_AGENT_SERVER_HOST=agent.connect.nginx.com \\\n--env=NGINX_AGENT_SERVER_TOKEN=\"YOUR_NGINX_ONE_DATA_PLANE_KEY_HERE\" \\\n--env=NGINX_AGENT_TLS_ENABLE=true \\\n--restart=always \\\n--runtime=runc \\\n-d private-registry.nginx.com/nginx-plus/agent:<VERSION_TAG>\n```\n\n----------------------------------------\n\nTITLE: Configuring IP Hash Session Persistence in NGINX\nDESCRIPTION: This code adds the `ip_hash` directive to the upstream block, enabling session persistence based on the client's IP address.  Requests from the same IP address are routed to the same server in the upstream group, maintaining session continuity.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_17\n\nLANGUAGE: nginx\nCODE:\n```\nupstream jboss {\n    ip_hash;\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Error Logging with Syslog in Nginx\nDESCRIPTION: This snippet configures Nginx to send error logs to a syslog server. It uses the `error_log` directive with the `syslog` parameter to specify the server address and severity level.  The configuration can be placed in the main, http, server, or location block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_33\n\nLANGUAGE: nginx\nCODE:\n```\n# In the main, 'http', 'server', or 'location' block\nerror_log syslog:server=192.168.1.1 info;\n```\n\n----------------------------------------\n\nTITLE: Enabling App Protect DoS in Nginx\nDESCRIPTION: This code snippet demonstrates how to enable the App Protect DoS module using the `app_protect_dos_enable` directive. The `on` value activates the module within the specified context (location, server, or http block). This directive is mandatory for enabling App Protect DoS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_dos_enable on;\n```\n\n----------------------------------------\n\nTITLE: Example Policy Definition (timeout)\nDESCRIPTION: This YAML defines an example policy named 'timeout' that targets an HTTPRoute named 'foo' and sets the timeout to 60 seconds. It shows how to configure different aspects of an HTTPRoute using custom policies in NGINX Gateway Fabric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/custom-policies.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: gateway.nginx.org/v1alpha1\nkind: ExamplePolicy\nmetadata:\n  name: timeout\nspec:\n  targetRef:\n    kind: HTTPRoute\n    name: foo\n  timeout: 60s\n```\n\n----------------------------------------\n\nTITLE: Accessing application over HTTPS with curl\nDESCRIPTION: This shell command utilizes curl to access the 'coffee' application over HTTPS. The `--resolve` option maps cafe.example.com to the NGINX Gateway Fabric's IP address and HTTPS port. The `--insecure` option disables certificate verification, as the certificate is self-signed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/https-termination.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_HTTPS_PORT:$GW_IP https://cafe.example.com:$GW_HTTPS_PORT/coffee --insecure\n```\n\n----------------------------------------\n\nTITLE: Configuring Server Weights in NGINX\nDESCRIPTION: This snippet configures server weights for an NGINX upstream, distributing requests based on the specified `weight` parameter. `backend1.example.com` receives 5 out of 6 requests, while `backend2.example.com` receives 1. `192.0.0.1` acts as a backup server, only receiving requests when the other servers are unavailable.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    server backend1.example.com weight=5;\n    server backend2.example.com;\n    server 192.0.0.1 backup;\n}\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Persistent Volume Configuration\nDESCRIPTION: This YAML configuration defines a PersistentVolume (PV) and a PersistentVolumeClaim (PVC) in Kubernetes. The PV provides a local storage resource, and the PVC requests that storage. This is used for persistent storage of NGINX App Protect bundles.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_21\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: nap5-bundles-pv\n  labels:\n    type: local\nspec:\n  storageClassName: manual\n  capacity:\n    storage: 2Gi\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  hostPath:\n    path: \"/mnt/nap5_bundles_pv_data\"\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: nap5-bundles-pvc\nspec:\n  storageClassName: manual\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 2Gi\n  volumeName: nap5-bundles-pv\n```\n\n----------------------------------------\n\nTITLE: Load NGINX App Protect WAF Module\nDESCRIPTION: Loads the NGINX App Protect WAF module in the main context of the Nginx configuration.\nThis module is essential for enabling the WAF functionality.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/configure-waf.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Agent Installation - Shell\nDESCRIPTION: Verifies the successful installation of Nginx Agent by running the nginx-agent command with the -v flag. This command outputs the Nginx Agent version if the installation was successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx-agent -v\n```\n\n----------------------------------------\n\nTITLE: Create Multiple File NGINX Configuration - Azure CLI\nDESCRIPTION: This command creates an NGINX configuration with multiple files. It specifies the configuration name, deployment name, resource group, root file, and the content of the configuration files encoded as base64 strings. The 'files' parameter takes a JSON array containing multiple objects, each with 'content' and 'virtual-path' keys.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configuration-azure-cli.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment configuration create --name default \\\n      --deployment-name myDeployment --resource-group myResourceGroup \\\n      --root-file /etc/nginx/nginx.conf \\\n      --files \"[{'content':'aHR0cCB7CiAgICB1cHN0cmVhbSBhcHAgewogICAgICAgIHpvbmUg \n      YXBwIDY0azsKICAgICAgICBsZWFzdF9jb25uOwogICAgICAgIHNlcnZlciAxMC4wLjEu \n      NDo4MDAwOwogICAgfQoKICAgIHNlcnZlciB7CiAgICAgICAgbGlzdGVuIDgwOwogICAg \n      ICAgIHNlcnZlcl9uYW1lICouZXhhbXBsZS5jb207CgogICAgICAgIGxvY2F0aW9uIC8g \n      ewogICAgICAgICAgICBpbmNsdWRlIC9ldGMvbmdpbngvY29uZi5kL3Byb3h5LmNvbmY7 \n      CiAgICAgICAgICAgIHByb3h5X3Bhc3MgaHR0cDovL2FwcDsKICAgICAgICAgICAgaGVh \n      bHRoX2NoZWNrOwogICAgICAgIH0KICAgICAgICAKICAgIH0KfQ==', \\\n      'virtual-path':'/etc/nginx/nginx.conf'}, \\\n      {'content':'cHJveHlfc2V0X2hlYWRlciBIb3N0ICRob3N0Owpwcm94eV9zZXRfaGVhZGVy \n      IFgtUmVhbC1JUCAkcmVtb3RlX2FkZHI7CnByb3h5X3NldF9oZWFkZXIgWC1Qcm94eS1B \n      cHAgYXBwOwpwcm94eV9zZXRfaGVhZGVyIEdpdGh1Yi1SdW4tSWQgMDAwMDAwOwpwcm94 \n      eV9idWZmZXJpbmcgb247CnByb3h5X2J1ZmZlcl9zaXplIDRrOwpwcm94eV9idWZmZXJz \n      IDggOGs7CnByb3h5X3JlYWRfdGltZW91dCA2MHM7', \\\n      'virtual-path':'/etc/nginx/conf.d/proxy.conf'}]\"\n```\n\n----------------------------------------\n\nTITLE: Deploy Tea Applications\nDESCRIPTION: Deploys the `tea` and `tea-post` applications using `kubectl apply`. This command fetches the application definitions from a remote YAML file and creates the necessary Kubernetes resources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/examples/advanced-routing/tea.yaml\n```\n\n----------------------------------------\n\nTITLE: Configuring IPv4 Whitelist IPs in NGINX App Protect Policy\nDESCRIPTION: This JSON snippet configures an Nginx App Protect policy with whitelist IP addresses and ranges. It demonstrates the configuration of always allowed, always denied, and never logged settings for IPv4 addresses. The policy includes a setting to block requests matching the `VIOL_BLACKLISTED_IP` violation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/deny-allow-never-log-lists.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"allow_deny\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_BLACKLISTED_IP\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"whitelist-ips\": [\n            {\n                \"blockRequests\": \"never\",\n                \"neverLogRequests\": false,\n                \"ipAddress\": \"1.1.1.1\",\n                \"ipMask\": \"255.255.255.255\"\n            },\n            {\n                \"blockRequests\": \"always\",\n                \"ipAddress\": \"2.2.2.2\",\n                \"ipMask\": \"255.255.255.255\"\n            },\n            {\n                \"blockRequests\": \"never\",\n                \"neverLogRequests\": false,\n                \"ipAddress\": \"3.3.3.0\",\n                \"ipMask\": \"255.255.255.0\"\n            },\n            {\n                \"blockRequests\": \"never\",\n                \"neverLogRequests\": true,\n                \"ipAddress\": \"4.4.4.0\",\n                \"ipMask\": \"255.255.255.0\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create NGINXaaS Deployment with Public IP (Azure CLI)\nDESCRIPTION: This example creates an NGINXaaS deployment configured with a public IP address. It sets the name, resource group, location, and SKU. The `network-profile` parameter is used to configure the front-end IP with a specified public IP address ID and a subnet ID. Prerequisites include having an existing public IP and virtual network/subnet.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/create-deployment/deploy-azure-cli.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment create --name myDeployment --resource-group \\\n      myResourceGroup --location eastus2 --sku name=\"standardv2_Monthly\" \\\n      --network-profile front-end-ip-configuration=\"{public-ip-addresses:[{id:/subscriptions/mySubscription/resourceGroups/myResourceGroup/providers/Microsoft.Network/publicIPAddresses/myPublicIP}]}\" \\\n      network-interface-configuration=\"{subnet-id:/subscriptions/mySubscription/resourceGroups/myResourceGroup/providers/Microsoft.Network/virtualNetworks/myVNet/subnets/mySubnet}\"\n```\n\n----------------------------------------\n\nTITLE: Internal Redirect on 404 to Backend in Nginx\nDESCRIPTION: This snippet configures NGINX to perform an internal redirect to a backend server when a file is not found. If a file is not found in the `/images/` location, the request is internally redirected to `/fetch$uri`, which is then proxied to the backend server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_18\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    ...\n    location /images/ {\n        # Set the root directory to search for the file\n        root /data/www;\n\n        # Disable logging of errors related to file existence\n        open_file_cache_errors off;\n\n        # Make an internal redirect if the file is not found\n        error_page 404 = /fetch$uri;\n    }\n\n    location /fetch/ {\n        proxy_pass http://backend/;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Proxying requests to HTTP server with port in Nginx\nDESCRIPTION: This example shows how to proxy requests to an HTTP server running on a specific port. The `location` block uses a regular expression to match PHP files, and the `proxy_pass` directive forwards the requests to the specified IP address and port. This allows NGINX to handle requests for PHP files by proxying them to a backend server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/reverse-proxy.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nlocation ~ \\.php {\n    proxy_pass http://127.0.0.1:8000;\n}\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Server for OIDC Protection\nDESCRIPTION: This snippet configures an NGINX server block to listen on HTTPS and defines a location that proxies requests to a backend application.  The `ssl_certificate` and `ssl_certificate_key` should point to valid SSL certificates.  The proxy_pass directive sends the requests to the application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/active-directory-federation-services.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n\n    # ...\n\n    server {\n        listen      443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate     /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n\n            # ...\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Capturing VRRP Packets Filtered by Host (Shell)\nDESCRIPTION: This command captures VRRP packets on the eth0 interface, filtering for traffic between the local node and a specific peer IP address.  Useful for isolating traffic related to a specific VRRP instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\ncentos7-1 $ tcpdump -vvv -ni eth0 proto vrrp and host 192.168.100.101\n```\n\n----------------------------------------\n\nTITLE: NGINX Agent Configuration File\nDESCRIPTION: This is an example of the `nginx-agent.conf` file. It shows how to configure the NGINX Agent's connection to the control plane, TLS settings, logging, NGINX monitoring, and data plane status reporting. The `server.host` and `server.grpcPort` are key parameters for specifying the control plane connection. Metrics collection and extension configurations are also included.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configuration-overview.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\n#\n# /etc/nginx-agent/nginx-agent.conf\n#\n# Configuration file for NGINX Agent.\n#\n# This file tracks agent configuration values that are meant to be statically set. There\n# are additional NGINX Agent configuration values that are set via the API and agent install script\n# which can be found in /etc/nginx-agent/agent-dynamic.conf.\n\n# specify the server grpc port to connect to\nserver:\n  # host of the control plane\n  host: <FQDN>\n  grpcPort: 443\n  backoff: # note: default values are prepopulated \n    initial_interval: 100ms # Add the appropriate duration value here, e.g., \"100ms\" for 100 milliseconds, \"5s\" for 5 seconds, \"1m\" for 1 minute, \"1h\" for 1 hour\n    randomization_factor: 0.10 # Add the appropriate float value here, e.g., 0.10\n    multiplier: 1.5 # Add the appropriate float value here, e.g., 1.5\n    max_interval: 1m # Add the appropriate duration value here, e.g., \"100ms\" for 100 milliseconds, \"5s\" for 5 seconds, \"1m\" for 1 minute, \"1h\" for 1 hour\n    max_elapsed_time: 0 # Add the appropriate duration value here, e.g., \"0\" for indefinite \"100ms\" for 100 milliseconds, \"5s\" for 5 seconds, \"1m\" for 1 minute, \"1h\" for 1 hour\n# tls options\ntls:\n  # enable tls in the nginx-agent setup for grpcs\n  # default to enable to connect with secure connection but without client cert for mtls\n  enable: true\n  # controls whether the server certificate chain and host name are verified.\n  # for production use, see instructions for configuring TLS\n  skip_verify: false\nlog:\n  # set log level (panic, fatal, error, info, debug, trace; default \"info\")\n  level: info\n  # set log path. if empty, don't log to file.\n  path: /var/log/nginx-agent/\nnginx:\n  # path of NGINX logs to exclude\n  exclude_logs: \"\"\n  # Set to true when NGINX configuration should contain no warnings when performing a configuration apply (nginx -t is used to carry out this check)\n  treat_warnings_as_errors: false # Default is false\n# data plane status message / 'heartbeat'\ndataplane:\n  status:\n    # poll interval for dataplane status - the frequency the NGINX Agent will query the dataplane for changes\n    poll_interval: 30s\n    # report interval for dataplane status - the maximum duration to wait before syncing dataplane information if no updates have been observed\n    report_interval: 24h\nmetrics:\n  # specify the size of a buffer to build before sending metrics\n  bulk_size: 20\n  # specify metrics poll interval\n  report_interval: 1m\n  collection_interval: 15s\n  mode: aggregated\n    backoff: # note: default values are prepopulated \n      initial_interval: 100ms # Add the appropriate duration value here, e.g., \"100ms\" for 100 milliseconds, \"5s\" for 5 seconds, \"1m\" for 1 minute, \"1h\" for 1 hour\n      randomization_factor: 0.10 # Add the appropriate float value here, e.g., 0.10\n      multiplier: 1.5 # Add the appropriate float value here, e.g., 1.5\n      max_interval: 1m # Add the appropriate duration value here, e.g., \"100ms\" for 100 milliseconds, \"5s\" for 5 seconds, \"1m\" for 1 minute, \"1h\" for 1 hour\n      max_elapsed_time: 0 # Add the appropriate duration value here, e.g., \"0\" for indefinite \"100ms\" for 100 milliseconds, \"5s\" for 5 seconds, \"1m\" for 1 minute, \"1h\" for 1 hour\n\n# OSS NGINX default config path\n# path to aux file dirs can also be added\nconfig_dirs: \"/etc/nginx:/usr/local/etc/nginx\"\n\n# Internal queue size\nqueue_size: 100\n\nextensions:\n  - nginx-app-protect\n\n# Enable reporting NGINX App Protect details to the control plane.\nnginx_app_protect:\n  # Report interval for NGINX App Protect details - the frequency NGINX Agent checks NGINX App Protect for changes.\n  report_interval: 15s\n  # Enable precompiled publication from the NGINX Management Suite (true) or perform compilation on the data plane host (false).\n  precompiled_publication: true\n```\n\n----------------------------------------\n\nTITLE: Redirecting Root Traffic to OWA (Nginx)\nDESCRIPTION: This snippet configures a location block to redirect traffic from the main mail page (/**) to the Outlook Web App (OWA) within the 'server' block for HTTPS traffic. It uses the `return` directive with a 301 redirect to the /owa/ path.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_35\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation / {\n    return 301 /owa/\";\n}\n```\n\n----------------------------------------\n\nTITLE: Cluster-Wide Config - JSON Request (All Options)\nDESCRIPTION: This JSON request demonstrates all the available options for configuring the Cluster-Wide Config setting in NGINX. It includes settings for client connection keepalive, client header buffer, map hash size, server names hash size, and worker configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/cluster-wide-config.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n    \"cluster-wide-config\": [\n      {\n        \"action\": {\n            \"clientConnection\": {\n                \"keepaliveRequests\": 1000,\n                \"keepaliveTime\": \"1h\",\n                \"keepaliveTimeout\": \"75s\"\n            },\n            \"clientHeaderBuffer\": {\n                \"number\": 4,\n                \"size\": \"8K\",\n                \"timeout\": \"60s\"\n            },\n            \"mapHashBucketSize\": 128,\n            \"mapHashMaxSize\": 2048,\n            \"serverNamesHashBucket\": 256,\n            \"serverNamesHashMaxSize\": 1024,\n            \"workersConfig\": {\n                \"connections\": 8192,\n                \"maxLimitForOpenFile\": 20000,\n                \"maxProcesses\": \"auto\"\n            }\n        },\n      }\n    ],\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Install SPNEGO Auth Module (SLES)\nDESCRIPTION: Installs the `nginx-plus-module-auth-spnego` package using zypper on SUSE Linux Enterprise Server (SLES). It first refreshes the package repositories and then installs the specified module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/spnego.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-auth-spnego\n```\n\n----------------------------------------\n\nTITLE: Slow Start Configuration\nDESCRIPTION: This snippet enables the slow start feature for the upstream servers. This ensures that when a failed server recovers or a new server is added, NGINX Plus gradually increases the traffic to it, preventing it from being overwhelmed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_33\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'upstream' block\nserver 192.168.25.33:7001 slow_start=30s;\nserver 192.168.25.69:7001 slow_start=30s;\n```\n\n----------------------------------------\n\nTITLE: Rewriting HTTP Responses (Scheme and Host) using Sub_filter in Nginx\nDESCRIPTION: This snippet replaces the scheme and host in HTTP responses using the `sub_filter` directive. It changes `http://127.0.0.1:8080/` to `https://$host/` for both `href` and `img src` attributes. The `sub_filter_once on;` directive ensures this substitution only happens once per location processing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    sub_filter     'href=\"http://127.0.0.1:8080/'    'href=\"https://$host/';\n    sub_filter     'img src=\"http://127.0.0.1:8080/' 'img src=\"https://$host/';\n    sub_filter_once on;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Group for Session Persistence with Sticky Learn\nDESCRIPTION: This snippet configures an upstream group named `jboss` for session persistence using the `sticky learn` directive. It specifies how new sessions are created (`create` parameter) and existing sessions are searched for (`lookup` parameter) based on the `JSESSIONID` cookie. A shared memory zone is also defined using the `zone` parameter to store session information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_24\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream jboss {\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n    sticky learn create=$upstream_cookie_JSESSIONID lookup=$cookie_JSESSIONID\n                 zone=client_sessions:1m;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Passive Health Checks in Nginx\nDESCRIPTION: This snippet configures passive health checks for servers in the `backend` upstream group. It sets the `max_fails` parameter to 3 and the `fail_timeout` parameter to 30 seconds for `backend2.example.com`. This means that if NGINX fails to send a request to the server or does not receive a response from it 3 times in 30 seconds, it marks the server as unavailable for 30 seconds.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-health-check.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    server backend1.example.com;\n    server backend2.example.com max_fails=3 fail_timeout=30s;\n}\n```\n\n----------------------------------------\n\nTITLE: Pushing to Docker Registry - Shell\nDESCRIPTION: This shell snippet shows how to push the tagged Docker image to your private registry. This assumes that you have already logged into the registry.  After pushing, the image is available for deployment in your Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/frequently-used-helm-configs.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ndocker push <my-docker-registry>/nms-apigw-plus:<version>\n```\n\n----------------------------------------\n\nTITLE: Configure Server Block (Nginx)\nDESCRIPTION: This snippet configures a server block for `demo.example.com` on port 443 (SSL).  It specifies the SSL certificates and keys, and includes a location block that proxies requests to `http://127.0.0.1:8080`.  This assumes that a backend application is running on port 8080.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/ping-identity.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n\n    # ...\n\n    server {\n        listen      443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate     /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n            # ...\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Fine-Tuning Active UDP Health Checks - NGINX\nDESCRIPTION: Fine-tunes the UDP health checks by specifying the `interval`, `passes`, and `fails` parameters to the `health_check` directive. This configures how often health checks are sent, how many consecutive passes are required for a server to be considered healthy, and how many consecutive failures are needed to mark a server as unhealthy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen       53 udp;\n    proxy_pass   dns_upstream;\n    health_check interval=20 passes=2 fails=2 udp;\n}\n```\n\n----------------------------------------\n\nTITLE: Try_files Directive with Proxy Pass in Nginx\nDESCRIPTION: This snippet demonstrates using the `try_files` directive to check for the existence of a file or directory. If neither are found, the request is redirected to a named location which then passes it to a proxied server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    try_files $uri $uri/ @backend;\n}\n\nlocation @backend {\n    proxy_pass http://backend.example.com;\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Full Load Balancing Configuration\nDESCRIPTION: This NGINX configuration provides enhanced load balancing features for Wildfly application servers, including WebSocket support, health checks, session persistence, and secure API access. It defines upstream servers, configures caching, and includes settings for HTTP to HTTPS redirection. The configuration utilizes the NGINX Plus API for dynamic reconfiguration, but it can be modified to use the DNS method instead.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_38\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /tmp/NGINX_cache/ keys_zone=backcache:10m;\n\n# WebSocket configuration\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n\n# Application health checks\nmatch jboss_check {\n    status 200;\n    header Content-Type = text/html;\n    body ~ \"Your WildFly 9 is running\";\n\n}\n\nupstream jboss {\n    # Shared memory zone for application health checks, live activity\n    # monitoring, and dynamic reconfiguration\n    zone jboss 64k;\n\n    # List of Wildfly application servers\n    server 192.168.33.11:8080 slow_start=30s;\n    server 192.168.33.12:8080 slow_start=30s;\n\n    # Session persistence based on JSESSIONID\n    sticky learn create=$upstream_cookie_JSESSIONID\n                 lookup=$cookie_JSESSIONID\n                 zone=client_sessions:1m;\n}\n\nserver {\n    listen 80;\n    server_name example.com;\n\n    # Redirect all HTTP requests to HTTPS\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n\nserver {\n    listen 443 ssl;\n    http2  on;\n\n    server_name example.com;\n\n    # Required for live activity monitoring of HTTPS traffic\n    status_zone jboss;\n    ssl_certificate            /etc/nginx/ssl/<certificate-name>;\n    ssl_certificate_key        /etc/nginx/ssl/<private-key>;\n    ssl_session_cache          shared:SSL:1m;\n    ssl_prefer_server_ciphers  on;\n\n    # Load balance requests for '/webapp/' across Wildfly application servers\n    location /webapp/ {\n        proxy_pass http://jboss;\n        proxy_cache backcache;\n\n        # Active health checks\n        health_check match=jboss_check;\n    }\n\n    # Return a 302 redirect to '/webapp/' when user requests '/'\n    location = / {\n        return 302 /webapp/;\n    }\n\n    # WebSocket configuration\n    location /wstunnel/ {\n        proxy_pass http://jboss;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n    }\n\n    # Secured access to the NGINX Plus API\n    location /api {\n        api write=on;\n        allow 127.0.0.1; # Permit access from localhost\n        deny all;        # Deny access from everywhere else\n    }\n}\n\n```\n\n----------------------------------------\n\nTITLE: Rate Limit based on HTTPRouteGroup\nDESCRIPTION: This YAML configuration creates a RateLimit resource that applies to traffic destined for the 'dest-svc' service from 'client-v1' and 'client-v2' deployments.  The rate limit is set to 10r/m and applies only to requests that match the 'get-only' rule from the 'hrg' HTTPRouteGroup (i.e., GET requests).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_11\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi.nginx.com/v1alpha2\nkind: RateLimit\nmetadata:\n   name: ratelimit-v1\n   namespace: default\nspec:\n   destination:\n     kind: Service\n     name: dest-svc\n     namespace: default\n   sources:\n   - kind: Deployment\n     name: client-v1\n     namespace: default\n   - kind: Deployment\n     name: client-v2\n     namespace: default\n   name: 10rm\n   rate: 10r/m\n   rules:\n   - kind: HTTPRouteGroup\n     name: hrg\n     matches:\n     - get-only\n```\n\n----------------------------------------\n\nTITLE: Complete Nginx Configuration for Dynamic Upstream Management\nDESCRIPTION: This is a complete Nginx configuration demonstrating the configuration of an upstream group, enabling the shared memory zone, and configuring the API endpoint for dynamic management. The configuration also proxies requests to the upstream servers and sets up a health check. Access control is configured for the API endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/dynamic-configuration-api.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    # Configuration of the server group\n    upstream appservers {\n        zone appservers 64k;\n\n        server appserv1.example.com      weight=5;\n        server appserv2.example.com:8080 fail_timeout=5s;\n        server reserve1.example.com:8080 backup;\n        server reserve2.example.com:8080 backup;\n    }\n    server {\n        # Location that proxies requests to the upstream group\n        location / {\n            proxy_pass http://appservers;\n            health_check;\n        }\n\n        # Location for dynamic configuration requests\n        location /api {\n            limit_except GET {\n                auth_basic \"NGINX Plus API\";\n                auth_basic_user_file /path/to/passwd/file;\n            }\n            api write=on;\n            allow 127.0.0.1;\n            deny  all;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Add SSL client certificate and key to NGINX config\nDESCRIPTION: This snippet shows how to add the client certificate and key to the NGINX configuration to authenticate NGINX to upstream servers using `proxy_ssl_certificate` and `proxy_ssl_certificate_key` directives. Ensure the filepaths match those assigned to the certificate and key added to the NGINXaaS Deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/securing-upstream-traffic.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /upstream {\n    proxy_pass                https://backend.example.com;\n    proxy_ssl_certificate     /etc/nginx/client.pem;\n    proxy_ssl_certificate_key /etc/nginx/client.key;\n}\n```\n\n----------------------------------------\n\nTITLE: Updating TrafficSplit for Canary Deployment (10% v2.0, 90% v1.0)\nDESCRIPTION: This YAML configuration updates the TrafficSplit resource to implement a canary deployment strategy. It directs 90% of the traffic to `target-v1-0` and 10% to `target-v2-0`. This allows for testing the new version with a small subset of users before a full rollout. The weights control the proportion of traffic sent to each backend service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_11\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: split.smi-spec.io/v1alpha3\nkind: TrafficSplit\nmetadata:\n  name: target-ts\nspec:\n  service: target-svc\n  backends:\n  - service: target-v1-0\n    weight: 90\n  - service: target-v2-0\n    weight: 10\n```\n\n----------------------------------------\n\nTITLE: Complete Nginx Configuration Example\nDESCRIPTION: This snippet provides a complete example of an Nginx configuration, including HTTP and Stream contexts, integrating the Prometheus module, defining upstreams, and setting up the `/metrics` endpoint for Prometheus. It demonstrates how to load the `ngx_http_js_module`, configure dynamic key-value replacements, and disable specific metrics using the `$prom_metrics_disabled` variable.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\n\n#...\n\nhttp {\n\n    js_import /usr/share/nginx-plus-module-prometheus/prometheus.js;\n\n    subrequest_output_buffer_size 32k;\n\n    upstream backend {\n        zone   backend 64k;\n        server backend1.example.com;\n        server backend2.example.com;\n    }\n\n    server {\n        listen 80;\n\n        location / {\n            proxy_pass http://backend;\n        }\n\n        location /api {\n            api;\n        }\n\n        location = /metrics {\n            set $prom_keyval           \"http_upstream_keyval\";\n            set $prom_keyval_stream    \"stream_upstream_keyval\";\n            set $prom_metrics_disabled \"stream/upstreams, resolvers\";\n            js_content                 prometheus.metrics;\n        }\n\n        status_zone backend_zone;\n    }\n}\n\nstream {\n\n    keyval_zone zone=stream_keyval:32k;\n\n    upstream stream_backend {\n        zone   stream_backend 64k;\n        server backend1.example.com:12345;\n        server backend2.example.com:12345;\n    }\n\n    server {\n        listen 12345;\n\n        proxy_pass  stream_backend;\n        status_zone backend_stream_zone;\n}\n\n```\n\n----------------------------------------\n\nTITLE: IP Hash Load Balancing\nDESCRIPTION: Configures IP Hash load balancing for the 'backend' upstream group.  The `ip_hash` directive uses the client's IP address to determine which server receives the request, ensuring that a client is consistently routed to the same server unless it is unavailable. It uses either the first three octets of the IPv4 address or the entire IPv6 address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    ip_hash;\n    server backend1.example.com;\n    server backend2.example.com;\n}\n```\n\n----------------------------------------\n\nTITLE: Default Logging Content Configuration in JSON\nDESCRIPTION: This JSON snippet defines the default logging content for NGINX App Protect WAF. It specifies that only illegal requests should be logged and uses the default log format with a max request size of 2k and a max message size of 32k.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/logging-overview/security-log.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filter\": {\n        \"request_type\": \"illegal\"\n    },\n\n    \"content\": {\n        \"format\": \"default\",\n        \"max_request_size\": \"2k\",\n        \"max_message_size\": \"32k\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Query Metric with SUM Aggregation\nDESCRIPTION: This cURL command queries the Metrics API for the sum of the `http.request.count` metric over the last three hours.  The `SUM()` function aggregates all the metric values within the specified time frame, providing a single total value for each dimension set. `startTime` is required when using aggregate functions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=SUM(http.request.count)&startTime=now-3h\"\n```\n\n----------------------------------------\n\nTITLE: Running NGINX Plus and NGINX Agent Container (Shell)\nDESCRIPTION: This snippet shows how to start a Docker container with both NGINX Plus and the NGINX Agent. It passes the JWT license file and the NGINX One data plane key as environment variables.  It configures the agent to communicate with NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_13\n\nLANGUAGE: sh\nCODE:\n```\nsudo docker run \\\n--env=NGINX_LICENSE_JWT=$(cat license.jwt) \\\n--env=NGINX_AGENT_SERVER_GRPCPORT=443 \\\n--env=NGINX_AGENT_SERVER_HOST=agent.connect.nginx.com \\\n--env=NGINX_AGENT_SERVER_TOKEN=\"YOUR_NGINX_ONE_DATA_PLANE_KEY\" \\\n--env=NGINX_AGENT_TLS_ENABLE=true \\\n--restart=always \\\n--runtime=runc \\\n-d <YOUR_REGISTRY>/nginx-plus/agent:<VERSION_TAG>\n```\n\n----------------------------------------\n\nTITLE: Starting NGINX Open Source on Ubuntu\nDESCRIPTION: This command starts the NGINX web server. It is used to initiate the NGINX process, making it available to serve web content.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_28\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTPS Virtual Server - Nginx\nDESCRIPTION: This Nginx configuration defines a virtual server that listens for HTTPS requests on port 443 for the domain `company.com`. It specifies the SSL certificate and private key files, and sets the SSL protocol to TLSv1.2. This block should reside within the `http` block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_17\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nserver {\n    listen 443 ssl;\n    server_name company.com;\n\n    ssl_certificate     /etc/nginx/ssl/server.crt;\n    ssl_certificate_key /etc/nginx/ssl/server.key;\n    ssl_protocols       TLSv1.2;\n}\n```\n\n----------------------------------------\n\nTITLE: Generate User Access Token\nDESCRIPTION: This command generates a user access token from Keycloak using the password grant type. It requires providing the client ID, client secret, username, and password.  The output is formatted with `jq`.  Values within angle brackets must be replaced with actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\ncurl -L -X POST 'http://{HOST/IP_ADDRESS}:{PORT}/realms/{REALM}/protocol/openid-connect/token' \\\n  -H 'Content-Type: application/x-www-form-urlencoded' \\\n  --data-urlencode 'client_id=<REPLACE_WITH_CLIENT_ID>' \\\n  --data-urlencode 'grant_type=password' \\\n  --data-urlencode 'client_secret=<REPLACE_ME_WITH_CLIENT_SECRET>' \\\n  --data-urlencode 'scope=openid' \\\n  --data-urlencode 'username=<REPLACE_WITH_USERNAME>' \\\n  --data-urlencode 'password=<REPLACE_ME_WITH_PASSWORD>'\n```\n\n----------------------------------------\n\nTITLE: Update Proxy with Token in Query - Bash\nDESCRIPTION: This bash snippet shows the PUT request used to update the proxy configuration such that it accepts the access token in a query parameter named `queryAuthz`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_34\n\nLANGUAGE: bash\nCODE:\n```\nPUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy\n```\n\n----------------------------------------\n\nTITLE: Setting App Protect Failure Mode Action in Nginx\nDESCRIPTION: This snippet demonstrates how to set the `app_protect_failure_mode_action` directive within the `http` block of the nginx.conf file.  It configures the behavior of App Protect WAF when the daemons are down or disconnected, either to 'pass' traffic without inspection (fail open) or 'drop' traffic (fail closed).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_21\n\nLANGUAGE: nginx\nCODE:\n```\n...\nhttp {\n    ...\n    app_protect_failure_mode_action drop;\n    ...\n    server {\n        listen       80;\n...\n    }\n...\n\n```\n\n----------------------------------------\n\nTITLE: Defining Shared Memory Zone for Upstream Group\nDESCRIPTION: This snippet configures a shared memory zone for the `jboss` upstream group using the `zone` directive.  This zone stores the group's configuration and run-time state for sharing among worker processes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_27\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream jboss {\n    zone jboss 64k;\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration with App Protect Enabled\nDESCRIPTION: This example demonstrates how to enable NGINX App Protect WAF in the HTTP context of an NGINX configuration file. It includes enabling the module, specifying the policy bundle file, and configuring security logging. The configuration also shows how to define a proxy pass.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nworker_processes  4;\n\nload_module modules/ngx_http_app_protect_module.so;\n\nerror_log /var/log/nginx/error.log debug;\n\nevents {\n    worker_connections  65536;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    app_protect_enable on; # This is how you enable NGINX App Protect WAF in the relevant context/block\n    app_protect_policy_file \"/etc/app_protect/conf/policy1.tgz\"; # This is a reference to the policy bundle file to use. If not defined, the default policy is used\n    app_protect_security_log_enable on; # This section enables the logging capability\n    app_protect_security_log \"/etc/app_protect/conf/log_all.tgz\" syslog:server=127.0.0.1:514; # This is where the remote logger is defined in terms of: logging options (defined in the referenced file), log server IP, log server port\n\n    server {\n        listen       80;\n        server_name  localhost;\n        proxy_http_version 1.1;\n\n        location / {\n            client_max_body_size 0;\n            default_type text/html;\n            proxy_pass http://172.29.38.211/;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Example Signature JSON Content\nDESCRIPTION: This shows example contents of the signature JSON output file, including the tag and a signatures array. Each signature includes details such as accuracy, risk, systems, rule, description, signature type and ID, revision, last update time, name, and attack type.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_28\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"tag\": \"user-defined-signatures\",\n    \"signatures\": [\n        {\n            \"accuracy\": \"high\",\n            \"risk\": \"high\",\n            \"systems\": [],\n            \"rule\": \"content:\\\"header1\\\"; nocase;\",\n            \"description\": \"\",\n            \"signatureType\": \"request\",\n            \"signatureId\": \"300000000\",\n            \"revision\": \"1\",\n            \"lastUpdateMicros\": 1731425468000000,\n            \"name\": \"sig_1_header\",\n            \"attackType\": {\n                \"name\": \"Abuse of Functionality\"\n            }\n        },\n        {\n            \"signatureId\": \"300000002\",\n            \"signatureType\": \"request\",\n            \"attackType\": {\n                \"name\": \"Cross Site Scripting (XSS)\"\n            },\n            \"name\": \"sig_3_uri\",\n            \"lastUpdateMicros\": 1731425631000000,\n            \"revision\": \"1\",\n            \"risk\": \"high\",\n            \"accuracy\": \"high\",\n            \"description\": \"\",\n            \"rule\": \"uricontent:\\\"<script>\\\"; nocase;\",\n            \"systems\": [\n                {\n                    \"name\": \"Nginx\"\n                }\n            ]\n        },\n        {\n            \"name\": \"sig_2_param\",\n            \"attackType\": {\n                \"name\": \"Abuse of Functionality\"\n            },\n            \"lastUpdateMicros\": 1731425549000000,\n            \"revision\": \"1\",\n            \"signatureId\": \"300000001\",\n            \"signatureType\": \"request\",\n            \"description\": \"\",\n            \"rule\": \"valuecontent:!\\\"param\\\"; nocase; httponly; norm;\",\n            \"systems\": [],\n            \"accuracy\": \"high\",\n            \"risk\": \"high\"\n        },\n        {\n            \"systems\": [\n                {\n                    \"name\": \"Apache\"\n                },\n                {\n                    \"name\": \"Unix/Linux\"\n                },\n                {\n                    \"name\": \"Proxy Servers\"\n                },\n                {\n                    \"name\": \"Django\"\n                }\n            ],\n            \"description\": \"\",\n            \"rule\": \"valuecontent:\\\"json123\\\"; nocase; jsononly; norm;\",\n            \"risk\": \"high\",\n            \"accuracy\": \"high\",\n            \"lastUpdateMicros\": 1731425782000000,\n            \"revision\": \"1\",\n            \"attackType\": {\n                \"name\": \"Server-Side Request Forgery (SSRF)\"\n            },\n            \"name\": \"sig_5_\",\n            \"signatureType\": \"request\",\n            \"signatureId\": \"300000004\"\n        },\n        {\n            \"description\": \"\",\n            \"rule\": \"uricontent:\\\"etc\\\"; nocase;\",\n            \"systems\": [\n                {\n                    \"name\": \"Microsoft Windows\"\n                },\n                {\n                    \"name\": \"Unix/Linux\"\n                }\n            ],\n            \"accuracy\": \"high\",\n            \"risk\": \"high\",\n            \"name\": \"sig_4_\",\n            \"attackType\": {\n                \"name\": \"Path Traversal\"\n            },\n            \"lastUpdateMicros\": 1731425708000000,\n            \"revision\": \"1\",\n            \"signatureId\": \"300000003\",\n            \"signatureType\": \"request\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Verify WAF Enforcement\nDESCRIPTION: Verifies that the NGINX App Protect WAF is enforcing security policies. This command sends a request to localhost containing a potentially malicious script tag. If the WAF is properly configured, the request should be rejected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ncurl \"localhost/<script>\"\n```\n\n----------------------------------------\n\nTITLE: NGINX: Server Configuration\nDESCRIPTION: This configures an Nginx server block to listen on port 443 with SSL enabled, specifying the server name and SSL certificate paths. It sets up a location block that will proxy requests to an application running on `http://127.0.0.1:8080`. This is the basic server setup before OIDC is applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/keycloak.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n\n    server {\n        listen      443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate     /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n\n            # ...\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: JSON Log Example\nDESCRIPTION: This JSON snippet demonstrates the structure of the `json_log` field in NGINX App Protect security logs. It showcases how violations and signatures are represented, including their enforcement state and whether they would trigger a blocking condition in Blocking Mode. The snippet provides a clear example of how to interpret the `json_log` data for security analysis.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/security-log.md#_snippet_8\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"violations\": [\n    {\n      \"enforcementState\": {\n        \"isBlocked\": false\n      },\n      \"violation\": {\n        \"name\": \"VIOL_URL_METACHAR\"\n      }\n    },\n    {\n      \"enforcementState\": {\n        \"isBlocked\": true\n      },\n      \"violation\": {\n        \"name\": \"VIOL_RATING_THREAT\"\n      }\n    },\n    {\n      \"enforcementState\": {\n        \"isBlocked\": true\n      },\n      \"signature\": {\n        \"name\": \"XSS script tag (URI)\",\n        \"signatureId\": 200000099\n      },\n      \"violation\": {\n        \"name\": \"VIOL_ATTACK_SIGNATURE\"\n      }\n    },\n    {\n      \"enforcementState\": {\n        \"isBlocked\": true\n      },\n      \"signature\": {\n        \"name\": \"XSS script tag end (URI)\",\n        \"signatureId\": 200000093\n      },\n      \"violation\": {\n        \"name\": \"VIOL_ATTACK_SIGNATURE\"\n      }\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Create Gateway for TLS Passthrough\nDESCRIPTION: This YAML configuration creates a Gateway resource that configures NGINX Gateway Fabric for TLS passthrough. It defines a TLS listener on port 443 with hostname `*.example.com`, allowing traffic to be routed to backend services without decryption, based on SNI. The allowedRoutes specifies that only TLSRoute resources are allowed, ensuring routing is managed appropriately.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/tls-passthrough.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1beta1\nkind: Gateway\nmetadata:\n  name: gateway\n  namespace: default\nspec:\n  gatewayClassName: nginx\n  listeners:\n  - name: tls\n    port: 443\n    protocol: TLS\n    hostname: \"*.example.com\"\n    allowedRoutes:\n      namespaces:\n        from: All\n      kinds:\n        - kind: TLSRoute\n    tls:\n      mode: Passthrough\nEOF\n```\n\n----------------------------------------\n\nTITLE: Configure trusted certificate authority in NGINX\nDESCRIPTION: This snippet configures NGINX to use a trusted certificate authority (CA) certificate for verifying upstream server certificates. It includes the `proxy_ssl_trusted_certificate` directive to specify the path to the CA certificate and the `proxy_ssl_verify` and `proxy_ssl_verify_depth` directives to enable and configure certificate verification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/securing-upstream-traffic.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /upstream {\n    # ...\n    proxy_ssl_trusted_certificate /etc/nginx/trusted_ca_cert.crt;\n    proxy_ssl_verify       on;\n    proxy_ssl_verify_depth 2;\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Get NGINX Plus and App Protect packages version (Shell)\nDESCRIPTION: This command retrieves the versions of the installed NGINX Plus and App Protect packages on Debian/Ubuntu systems and appends them to the `package_versions.txt` file. This is part of the process of collecting troubleshooting information to send to customer support.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/troubleshooting-guide/how-to-troubleshoot.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\napt list --installed | grep -E 'nginx-plus|app-protect' >> package_versions.txt\n```\n\n----------------------------------------\n\nTITLE: Configuring upstream API server in Nginx\nDESCRIPTION: This snippet demonstrates how to configure an upstream block in Nginx to define multiple API servers for load balancing. It sets up two servers, 10.0.0.1 and 10.0.0.2, that will handle requests proxied from the `location /products/` block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nupstream api_server {\n    server 10.0.0.1;\n    server 10.0.0.2;\n}\n\nserver {\n    listen 80;\n\n    location /products/ {\n        proxy_pass http://api_server;\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Example of curl HTTPS response\nDESCRIPTION: This text block presents an example HTTP response from the curl command accessing the application over HTTPS.  It displays information such as the server address and the server name, indicating a successful connection to the 'coffee' service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/https-termination.md#_snippet_10\n\nLANGUAGE: text\nCODE:\n```\nServer address: 10.244.0.6:80\nServer name: coffee-6b8b6d6486-7fc78\n```\n\n----------------------------------------\n\nTITLE: Configure Health Check Timeout\nDESCRIPTION: Reduces the timeout between two consecutive health checks using the `health_check_timeout` directive.  It overrides the `proxy_timeout` value for health checks, as this timeout needs to be significantly shorter for health checks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    server {\n        listen               12345;\n        proxy_pass           stream_backend;\n        health_check;\n        health_check_timeout 5s;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Nginx Server Block Configuration\nDESCRIPTION: This Nginx configuration snippet represents a server block listening on port 80 with the server name \"cafe.example.com\". It contains a location block for the root path ('/') that proxy passes requests to an upstream named 'default_coffee_80'. This configuration ensures that traffic to cafe.example.com is routed to the appropriate upstream servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/routing-traffic-to-your-app.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n  listen 80;\n\n  server_name cafe.example.com;\n\n  location / {\n    ...\n    proxy_pass http://default_coffee_80$request_uri; # the upstream is named default_coffee_80\n    ...\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Gateway Fabric with tracing configuration\nDESCRIPTION: Installs NGINX Gateway Fabric using Helm, referencing the configured `values.yaml` file. This command creates a new namespace 'nginx-gateway' and deploys NGINX Gateway Fabric with the specified tracing configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nhelm install ngf oci://ghcr.io/nginx/charts/nginx-gateway-fabric --create-namespace -n nginx-gateway -f values.yaml\n```\n\n----------------------------------------\n\nTITLE: Load NJS Module in nginx.conf\nDESCRIPTION: This directive loads the NGINX JavaScript module. It must be included in the top-level (\"main\") configuration context in /etc/nginx/nginx.conf. This enables njs scripting within NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/ping-identity.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\n```\n\n----------------------------------------\n\nTITLE: Importing prometheus.js in NGINX Configuration\nDESCRIPTION: This configuration imports the prometheus.js file using the js_import directive within the http block.  This makes the functions defined in prometheus.js available for use in the NGINX configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    js_import /usr/share/nginx-plus-module-prometheus/prometheus.js;\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Trusted CA Certificate Verification in Nginx TCP Proxy\nDESCRIPTION: This configuration enables verification of the upstream server's certificate using a trusted CA certificate.  It includes the path to the trusted CA certificate and enables certificate verification with a specified depth.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-tcp-traffic-upstream.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    ...\n    proxy_ssl_trusted_certificate /etc/ssl/certs/trusted_ca_cert.crt;\n    proxy_ssl_verify       on;\n    proxy_ssl_verify_depth 2;\n}\n```\n\n----------------------------------------\n\nTITLE: Creating API Location Nginx\nDESCRIPTION: This snippet defines a location block for API requests and specifies the `api` directive.  It listens on a specific IP address and associates /api with the Nginx API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    server {\n        listen 192.168.1.23;\n        # ...\n        location /api {\n            api;\n            # ...\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Protect Location with AD FS OIDC\nDESCRIPTION: This snippet protects a specific location with AD FS OIDC by using the `auth_oidc` directive, referencing the configured AD FS provider (`adfs`). Any requests to this location will require authentication against the AD FS server. Depends on the oidc_provider being configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/active-directory-federation-services.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n\n     auth_oidc adfs;\n\n     # ...\n\n     proxy_pass http://127.0.0.1:8080;\n\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Configure Server Block for OIDC Protection\nDESCRIPTION: This snippet configures a server block to listen on port 443 with SSL enabled. It defines the server name and specifies the SSL certificate and key files. The `location /` block is configured to proxy requests to the application running on `http://127.0.0.1:8080`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-oidc.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n\n    server {\n        listen      443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate     /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n            # ...\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Upstream Configuration with Sticky Learn\nDESCRIPTION: This code snippet demonstrates configuring sticky learn-based session persistence using the `sticky learn` directive. It configures NGINX Plus to learn the session identifier from the `JSESSIONID` cookie sent by the Tomcat application and uses a shared memory zone to store session information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_29\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream tomcat {\n    server 10.100.100.11:8080;\n    server 10.100.100.12:8080;\n    sticky learn create=$upstream_cookie_JSESSIONID\n                 lookup=$cookie_JSESSIONID\n                 zone=client_sessions:1m;\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling All Signatures with Block and Alarm - JSON\nDESCRIPTION: This snippet configures the 'All Signatures' set to be enforced and logged by setting the `block` and `alarm` properties to `true`. This ensures that all signatures known to NGINX App Protect WAF are actively blocked and generate alerts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/signature-sets.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"attack_sigs\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"signature-sets\": [\n            {\n                 \"name\": \"All Signatures\",\n                 \"block\": true,\n                 \"alarm\": true\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx configuration\nDESCRIPTION: This snippet shows the command to reload the Nginx configuration after making changes, ensuring that the new configuration is applied without restarting the server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginx-waf.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: NGINX Full Configuration\nDESCRIPTION: This snippet provides the full Nginx configuration for two web entry points, including user, worker processes, event settings, HTTP configuration, upstream servers, server configurations with SSL/TLS, proxy caching, and live activity monitoring. It defines upstream groups for load balancing between production and disaster recovery servers, and configures SSL termination and caching for each web entry point.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_41\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nworker_processes auto;\nerror_log /var/log/nginx/error.log info;\npid /var/run/nginx.pid;\n\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    include /etc/nginx/mime.types;\n    default_type text/html;\n    proxy_cache_path /var/oracle-cache-one\n                     keys_zone=cache_oracle_one:50m max_size=500m;\n    proxy_cache_path /var/oracle-cache-two\n                     keys_zone=cache_oracle_two:50m max_size=500m;\n\n    # Custom logging configuration\n    log_format main '$remote_addr - $remote_user [$time_local]\n                    \"$request\" $status $body_bytes_sent \"$http_referer\"\n                    \"$http_user_agent\" $upstream_addr';\n    access_log /var/log/nginx/access.log main;\n\n    upstream oracle_one {\n        zone oracle_one 64k;\n\n        # Production servers\n        server 172.31.11.210:8000 max_fails=0;\n        server 172.31.0.146:8000 max_fails=0;\n\n        # Disaster recovery servers\n        server 172.33.111.210:8000 max_fails=0 backup;\n        server 172.33.100.146:8000 max_fails=0 backup;\n\n        # Session persistence\n        sticky cookie ngxcookie;\n    }\n\n    upstream oracle_two {\n        zone oracle_two 64k;\n\n        # Production servers\n        server 172.31.11.211:8000 max_fails=0;\n        server 172.31.0.147:8000 max_fails=0;\n\n        # Disaster recovery servers\n        server 172.33.111.211:8000 max_fails=0 backup;\n        server 172.33.100.147:8000 max_fails=0 backup;\n\n        # Session persistence\n        sticky cookie ngxcookie;\n    }\n\n    server {\n        listen 80;\n        status_zone oracle-http-redirect;\n        return 302 https://$http_host$request_uri;\n    }\n\n    server {\n        listen 192.168.210.10:443 ssl;\n        http2  on;\n        server_name oracle-one.company.com;\n        ssl_certificate     /etc/nginx/ssl/server_one.crt;\n        ssl_certificate_key /etc/nginx/ssl/server_one.key;\n        ssl_protocols       TLSv1.2;\n        status_zone oracle-ssl-one;\n        proxy_cache cache_oracle_one;\n\n        location / {\n            proxy_pass http://oracle_one;\n            proxy_set_header Host $host;\n            proxy_cache_valid any 1h;\n        }\n\n        location @health_check {\n            internal;\n            proxy_connect_timeout 3s;\n            proxy_read_timeout 3s;\n            proxy_pass http://oracle_one;\n            proxy_set_header Host \"oracle-one.company.com\";\n            health_check match=oracleok interval=4s\n                         uri=/OA_HTML/AppsLocalLogin.jsp;\n        }\n    }\n\n    server {\n        listen 192.168.210.11:443 ssl;\n        http2  on;\n        server_name oracle-two.company.com;\n        ssl_certificate     /etc/nginx/ssl/server_two.crt;\n        ssl_certificate_key /etc/nginx/ssl/server_two.key;\n        ssl_protocols       TLSv1.2;\n        status_zone oracle-ssl-two;\n        proxy_cache cache_oracle_two;\n\n        location / {\n            proxy_pass http://oracle_two;\n            proxy_set_header Host $host;\n            proxy_cache_valid any 1h;\n        }\n\n        location @health_check {\n            internal;\n            proxy_connect_timeout 3s;\n            proxy_read_timeout 3s;\n            proxy_pass http://oracle_two;\n            proxy_set_header Host \"oracle-two.company.com\";\n            health_check match=oracleok interval=4s\n                         uri=/OA_HTML/AppsLocalLogin.jsp;\n        }\n    }\n\n    match oracleok {\n        status 200-399;\n        header X-ORACLE-DMS-ECID;\n    }\n\n    # Live activity monitoring configuration\n    server {\n        # Status zone required for live activity monitoring. Enable it for\n        # every 'server' block in other configuration files.\n        status_zone status-page;\n\n        # If NGINX Plus is listening on multiple IP addresses, uncomment this\n        # directive to restrict access to the live activity monitoring\n        # dashboard to a single IP address (substitute the appropriate\n        # address).\n        # listen 10.2.3.4:8080;\n        # Live activity monitoring is enabled on port 8080 by default.\n        listen 8080;\n\n        # HTTP Basic authentication is enabled by default. Use an htpasswd\n        # generator to add users, or command-line and other management tools are\n        # readily available online. If you have Apache HTTP Server installed, you\n        # can reuse its htpasswd file.\n        #auth_basic on;\n        #auth_basic_user_file /etc/nginx/users;\n\n        # Limit access to the dashboard to users on admin networks only.\n        # Uncomment the \"allow\" directive and change the IP address.\n        #allow 10.0.0.0/8;\n        deny all;\n\n        # Enable the NGINX Plus API for metrics collection.\n        location /api {\n            api write=on;\n            access_log off;\n        }\n\n        # NGINX Plus includes a built-in dashboard.\n        location = /dashboard.html {\n            root /usr/share/nginx/html;\n        }\n\n        # Redirect requests made to the pre-R14 dashboard.\n        location = /status.html {\n            return 301 /dashboard.html;\n        }\n\n        # Standard HTTP features are fully supported with the dashboard.\n        # Redirect request for '/' to '/dashboard.html'.\n        location = / {\n            return 301 /dashboard.html;\n        }\n    }\n}\n\n```\n\n----------------------------------------\n\nTITLE: Saving NGINX App Protect Images\nDESCRIPTION: These commands save the built NGINX image and the `waf-enforcer` and `waf-config-mgr` images to tar archives. This is typically done for transferring the images to an environment where direct Docker image pulling is not possible (e.g., an air-gapped or offline environment). The `docker save` command serializes the image into a tar archive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\ndocker save -o nginx-app-protect-5.tar nginx-app-protect-5\n\ndocker save -o waf-enforcer.tar waf-enforcer:5.2.0\n\ndocker save -o waf-config-mgr.tar waf-config-mgr:5.2.0\n```\n\n----------------------------------------\n\nTITLE: Apreload Command Line Utility\nDESCRIPTION: This snippet shows the usage of the `apreload` command-line utility, which is used to apply new configurations in the NGINX App Protect WAF enforcer.  It lists the available options, including applying the configuration, specifying the config set path, setting the policy map location, testing the configuration, and waiting for the enforcer to load the updated configuration.  The utility is located at `/opt/app_protect/bin/apreload`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/apreload\n```\n\nLANGUAGE: text\nCODE:\n```\nUSAGE:\n    /opt/app_protect/bin/apreload:\n\nOptional arguments with default values:\n  -apply\n        Apply new configuration in enforcer (default true)\n  -i string\n        Path to the config set. Ex. /opt/app_protect/config/config_set.json (default \"/opt/app_protect/config/config_set.json\")\n  -policy-map-location string\n        Path to policy map location (default \"/opt/app_protect/bd_config/policy_path.map\")\n  -t    Test and prepare configuration without updating enforcement\n  -wait-for-enforcer\n        Wait until updated config is loaded (default true)\n\nOptionally, using --help will issue this help message.\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Plus packages on Alpine Linux\nDESCRIPTION: This snippet demonstrates how to download NGINX Plus packages, including dependencies, on Alpine Linux. It involves creating a directory, updating the package index, and fetching the app-protect-module-plus package recursively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_26\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir /etc/packages/\nsudo apk update\nsudo apk fetch --recursive --output /etc/packages app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Restricting Access with IP Address-Based ACL\nDESCRIPTION: This configures IP address-based access control lists (ACLs) to restrict access to the dashboard. Only users on the 10.0.0.0/8 network are allowed to access the status page.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_36\n\nLANGUAGE: nginx\nCODE:\n```\nallow 10.0.0.0/8;\ndeny all;\n```\n\n----------------------------------------\n\nTITLE: Debug Logging Configuration Syntax\nDESCRIPTION: This snippet illustrates the syntax for adding a module for logging within the `/etc/app_protect/bd/logger.cfg` file. It shows how to define the MODULE, LOG_LEVEL, and FILE parameters.  The `MODULE` parameter specifies the App Protect module to log.  The `LOG_LEVEL` defines the severity of messages to include.  The `FILE` parameter indicates the log file to use.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/debug-logs.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\n#       MODULE = <module_name>;\n#       LOG_LEVEL = <log level 1> | <log level 2> | ... | <log level n>;\n#       FILE = <file number> (recommended 2 always);\n#\n#       Use # to comment out lines.\n```\n\n----------------------------------------\n\nTITLE: Sample JSON Output of Signature Conversion\nDESCRIPTION: This is an example of the JSON output generated by the signature conversion tool. It confirms the filename, file size, and completion status of the conversion.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_27\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filename\": \"/path/to/signatures.json\",\n    \"file_size\": 1602,\n    \"completed_successfully\": true\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Nginx API Location (Server block)\nDESCRIPTION: This configuration defines a location block for the Nginx Plus API, enabling write access and restricting access to only localhost (127.0.0.1). The `api` directive enables the API, and the `allow` and `deny` directives control access. This should be placed within the `server` block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_43\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /api {\n     api write=on;\n     allow 127.0.0.1;\n     deny all;\n}\n```\n\n----------------------------------------\n\nTITLE: Nginx Upstream Block Configuration\nDESCRIPTION: This Nginx configuration snippet represents an upstream block named 'default_coffee_80'. It defines the backend servers, which are the pod IPs of the 'coffee' pods, listening on port 8080. The proxy_pass directive in the server block directs traffic to these backend servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/routing-traffic-to-your-app.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nupstream default_coffee_80 {\n  ...\n  server 10.12.0.18:8080; # these should be the pod IPs of the coffee pods\n  server 10.12.0.19:8080;\n  ...\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Brotli Compression in Nginx\nDESCRIPTION: This configuration enables Brotli compression within the `server` block of the Nginx configuration file. The `brotli on;` directive enables Brotli compression for all responses served by this server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/brotli.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n\n    server {\n        brotli on;\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring IP Hash Session Persistence Nginx\nDESCRIPTION: This snippet configures IP Hash session persistence for the 'weblogic' upstream group. It ensures that requests from the same client IP address are always routed to the same backend server. This snippet must be placed inside the 'http' block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_18\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream weblogic {\n    ip_hash;\n    server 192.168.25.33:7001;\n    server 192.168.25.69:7001;\n}\n```\n\n----------------------------------------\n\nTITLE: YAML Configuration for Compiler Resource Pruning\nDESCRIPTION: This YAML snippet configures the time-to-live (TTL) values for attack signatures, compiled bundles (security policies and log profiles), and threat campaigns within the `policy_manager` section of the `integrations` configuration in NGINX Instance Manager. This allows the system to automatically remove unused compiler resources, which helps maintain performance and resource usage. The duration unit can be seconds (s), minutes (m), or hours (h).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\nintegrations:\n  address: unix:/var/run/nms/integrations.sock\n  dqlite:\n    addr: 127.0.0.1:7892\n  policy_manager:\n    # Time to live for attack signatures. If the attack signatures exceed their TTL and are not\n    # deployed to an instance or instance group, they will be deleted from the database.\n    # Duration unit can be seconds (s), minutes (m), or hours (h).\n    attack_signatures_ttl: 336h\n\n    # Time to live for compiled bundles, including compiled security policies and log profiles.\n    # If a compiled bundle exceeds its TTL and are not deployed to an instance or instance group,\n    # it will be deleted from the database. The bundle is deleted, not the resource definition.\n    compiled_bundles_ttl: 336h\n\n    # Time to live for threat campaigns. If the threat campaigns exceed their TTL and are not\n    # deployed to an instance or instance group, they will be deleted from the database.\n    threat_campaigns_ttl: 1440h\n\n  app_protect_security_update:\n    enable: true\n    interval: 6\n    number_of_updates: 10\n```\n\n----------------------------------------\n\nTITLE: Enabling NGINX Plus API in Read-Write Mode\nDESCRIPTION: This snippet enables the NGINX Plus API in read-write mode.  The `api write=on;` directive is placed within a `location` block, allowing access to the API endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\n    server {\n        listen 80;\n        server_name www.example.com;\n\n        location /api {\n            api write=on;\n        }\n    }\n```\n\n----------------------------------------\n\nTITLE: Set NGINX App Protect Enforcer Address\nDESCRIPTION: Sets the address of the NGINX App Protect enforcer. This directive specifies the IP address and port where the App Protect enforcer is listening for connections.\nIt is a required directive for Nginx App Protect to function correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/configure-waf.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enforcer_address 127.0.0.1:50000;\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Plus OpenTelemetry Module on Amazon Linux 2023, AlmaLinux, and Rocky Linux (Shell)\nDESCRIPTION: This command updates the package repositories and installs the `nginx-plus-module-otel` package on Amazon Linux 2023, AlmaLinux, and Rocky Linux systems. This installs the OpenTelemetry module for NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update  && \\\nsudo dnf install nginx-plus-module-otel\n```\n\n----------------------------------------\n\nTITLE: Generating Self-Signed Certificate\nDESCRIPTION: This snippet demonstrates how to generate a self-signed SSL/TLS certificate using OpenSSL.  It uses the `-new` and `-x509` options to create a new self-signed certificate and the `-days` parameter to set the validity period.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl req -new -x509 -key ~/private-key.pem -out ~/self-cert.pem -days 10950\n```\n\n----------------------------------------\n\nTITLE: Creating API Proxy via API with OpenAPI Spec Reference\nDESCRIPTION: This JSON payload is sent to the `/proxies` endpoint to create a new API proxy. It includes the proxy's name, metadata, version, and a reference to a previously uploaded OpenAPI specification (`specRef`).  The `proxyConfig` section defines the hostname, ingress settings (basePath), and backend service configurations for routing requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/publish-api-proxy.md#_snippet_8\n\nLANGUAGE: JSON\nCODE:\n```\n{\n        \"name\": \"{{proxyName}}\",\n        \"metadata\": {\n            \"description\": \"Swagger Petstore API\"\n        },\n        \"version\": \"v1\",\n        \"specRef\": \"petstore-1\",\n        \"proxyConfig\": {\n            \"hostname\": \"{{environmentHostname}}\",\n            \"ingress\": {\n                \"basePath\": \"/v1\"\n            },\n            \"backends\": [\n                {\n                    \"serviceName\": \"petstore-api-svc\",\n                    \"serviceTargets\": [\n                        {\n                            \"hostname\": \"petstore.example.com\"\n                        }\n                    ]\n                }\n            ]\n        }\n    }\n```\n\n----------------------------------------\n\nTITLE: Copy GeoLite2 Database to NGINX Instance Manager\nDESCRIPTION: This command securely copies the GeoLite2-Country.mmdb database file to the NGINX Instance Manager control plane.  It utilizes `scp` to transfer the file from a local path to a remote server, requiring the path to the database, the username, and the host address of the NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/update-geo-db.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo scp /path/to/GeoLite2-Country.mmdb {user}@{host}:/usr/share/nms/geolite2/GeoLite2-Country.mmdb\n```\n\n----------------------------------------\n\nTITLE: Backup Private Key\nDESCRIPTION: This snippet shows how to create a backup of the generated private key in a secure location. This is important for disaster recovery and to prevent data loss should the original key become corrupted or lost.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nroot# cp ~/private-key.pem <SECURE-DIR>/private-key.pem.backup\n```\n\n----------------------------------------\n\nTITLE: Install Zypper Prerequisites - Shell\nDESCRIPTION: Installs the necessary packages on SLES systems to manage zypper repositories and cryptographic operations. These include curl, ca-certificates, gpg2, and gawk, all of which are required for setting up and using the Nginx Agent repository securely.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper install curl ca-certificates gpg2 gawk\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP Basic Authentication in NGINX\nDESCRIPTION: This snippet configures HTTP Basic authentication for the NGINX Plus dashboard, requiring users to authenticate before accessing the dashboard. It specifies the directives `auth_basic` to enable authentication and `auth_basic_user_file` to point to the file containing user credentials. The user entries are defined in the specified file, e.g. /etc/nginx/users.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_31\n\nLANGUAGE: nginx\nCODE:\n```\nauth_basic on;\nauth_basic_user_file /etc/nginx/users;\n```\n\n----------------------------------------\n\nTITLE: Enabling HTTP Substitutions Filter Module in NGINX\nDESCRIPTION: This NGINX configuration snippet demonstrates how to enable the HTTP Substitutions Filter module by dynamically loading it using the `load_module` directive. The directive is placed in the top-level context. The `http` block is included to show where to place the configurations for the module itself.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/http-substitutions-filter.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_subs_filter_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Enable Access and Error Logs in Nginx\nDESCRIPTION: Enables access and error logs in the `http` block of the main Nginx configuration file.  These logs are crucial for troubleshooting communication issues between Nginx Agent and Nginx Instance Manager. The access log records all client requests and the error log captures any errors during request processing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\n# nginx.conf\n    http {\n        ...\n        access_log /var/log/nginx/access.log;\n        error_log /var/log/nginx/error.log;\n        ...\n    }\n```\n\n----------------------------------------\n\nTITLE: Configuring Cookie Seed for Horizontal Scaling - Nginx\nDESCRIPTION: This snippet shows how to configure the `app_protect_cookie_seed` directive within the `http` block of the nginx.conf file. This directive is essential for horizontal scaling of NGINX App Protect WAF, ensuring that multiple instances can decrypt cookies generated by other instances. The argument should be a random alphanumeric string with a length between 20 and 1000 characters. This seed is used to generate the encryption key for cookies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\n...\nhttp {\n    ...\n    app_protect_cookie_seed jkldsf90upiokasdj120;\n    ...\n    server {\n        listen       80;\n...\n}\n...\n\n```\n\n----------------------------------------\n\nTITLE: Dockerfile for NGINX Plus on Amazon Linux 2023\nDESCRIPTION: This Dockerfile installs NGINX Plus and NGINX App Protect WAF v5 module on Amazon Linux 2023. It configures the necessary repositories, installs the required packages, and sets up logging. It mounts the certificate and key for the NGINX Plus repository. The image exposes port 80 and starts Nginx in daemon off mode.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_1\n\nLANGUAGE: dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Base image\nFROM amazonlinux:2023\n\n# Install NGINX Plus and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    yum -y install wget ca-certificates shadow-utils \\\n    && wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/plus-amazonlinux2023.repo \\\n    && echo \"[app-protect-x-plus]\" > /etc/yum.repos.d/app-protect-plus.repo \\\n    && echo \"name=nginx-app-protect repo\" >> /etc/yum.repos.d/app-protect-plus.repo \\\n    && echo \"baseurl=https://pkgs.nginx.com/app-protect-x-plus/amzn/2023/$basearch/\" >> /etc/yum.repos.d/app-protect-plus.repo \\\n    && echo \"sslclientcert=/etc/ssl/nginx/nginx-repo.crt\" >> /etc/yum.repos.d/app-protect-plus.repo \\\n    && echo \"sslclientkey=/etc/ssl/nginx/nginx-repo.key\" >> /etc/yum.repos.d/app-protect-plus.repo \\\n    && echo \"gpgcheck=0\" >> /etc/yum.repos.d/app-protect-plus.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/app-protect-plus.repo \\\n    && yum -y install app-protect-module-plus \\\n    && yum clean all \\\n    && rm -rf /var/cache/yum \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log\n\n# Expose port\nEXPOSE 80\n\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Configure client certificate verification in NGINX\nDESCRIPTION: This snippet configures NGINX to verify client certificates. The `ssl_client_certificate` directive specifies the path to a trusted client CA certificate, and `ssl_verify_client` is set to optional.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/securing-upstream-traffic.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    #...\n    ssl_client_certificate /etc/ssl/certs/ca.crt;\n    ssl_verify_client      optional;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Defining Health Check Criteria\nDESCRIPTION: This snippet defines the criteria for a server to be considered healthy. It checks for a 200 status code, a Content-Type header of text/html, and a response body matching the regex 'Apache Tomcat/8'. This match block is referenced in the health_check directive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_31\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nmatch health_check {\n    status 200;\n    header Content-Type = text/html;\n    body ~ \"Apache Tomcat/8\";\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Proxy Cache Path in NGINX\nDESCRIPTION: This Nginx configuration block sets the path for the proxy cache, defining levels, keys zone, and maximum size.  It is used for caching JWTs and requires a directory accessible to the Nginx worker processes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/oidc.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /var/cache/nginx/jwt levels=1 keys_zone=jwk:64k max_size=1m;\n```\n\n----------------------------------------\n\nTITLE: Inspecting Nginx Configuration (kubectl)\nDESCRIPTION: This command uses `kubectl exec` to execute the `nginx -T` command inside the Nginx Gateway pod. This dumps the entire Nginx configuration to standard output, allowing inspection of the generated configuration, including server blocks and upstream definitions. Requires `kubectl` and access to the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/routing-traffic-to-your-app.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nkubectl exec -it -n nginx-gateway <nginx gateway pod> -c nginx -- nginx -T\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS SRV Record for Autodiscover\nDESCRIPTION: This DNS SRV record enables clients to automatically discover the Exchange Autodiscover service.  It specifies the service location (port and hostname). Replace `mail.company.com` with the actual mail server hostname.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\n_autodiscover._tcp.company.com.    60    SRV    1  10  443  mail.company.com\n```\n\n----------------------------------------\n\nTITLE: Request Limits Zone Synchronization in NGINX\nDESCRIPTION: This snippet configures request limits zone synchronization in NGINX. It adds the `sync` parameter to the `limit_req_zone` directive to apply rate limiting across the cluster. The `zone` name must be the same on all NGINX nodes in the cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nlimit_req_zone $remote_addr zone=req:1M rate=100r/s sync;\n\nserver {\n    listen 80;\n    location / {\n        limit_req zone=req;\n\n        proxy_pass http://my_backend;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Apreload Command - Shell\nDESCRIPTION: This command executes the apreload script inside the `waf-nginx` container. It uses `kubectl` to access the container in a specific namespace and pod. Requires `kubectl` to be configured and the target pod and namespace to exist.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n [namespace] exec -it [podname] -c waf-nginx -- bash /opt/app_protect/bin/apreload\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX FIPS module on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This shell command sequence updates the package list and installs the nginx-plus-module-fips-check package using the yum package manager on Amazon Linux 2, CentOS, Oracle Linux, and RHEL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/fips.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-fips-check\n```\n\n----------------------------------------\n\nTITLE: Create NGINX Amplify Agent Config (Bash)\nDESCRIPTION: Creates the NGINX Amplify Agent configuration file from a template by replacing the `api_key` placeholder with the user's actual API key. It reads the default configuration file, substitutes the API key using `sed`, and writes the modified configuration to `/etc/amplify-agent/agent.conf`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_15\n\nLANGUAGE: bash\nCODE:\n```\napi_key=\"YOUR_API_KEY\" && \\\nsed \"s/api_key.*$/api_key = ${api_key}/\" \\\n/etc/amplify-agent/agent.conf.default > \\\n/etc/amplify-agent/agent.conf\n```\n\n----------------------------------------\n\nTITLE: Including status.conf in nginx.conf\nDESCRIPTION: This snippet includes the downloaded status.conf file into the main nginx.conf file within the http block. This enables the configurations defined in the status.conf file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_35\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\ninclude conf.d/status.conf;\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration for Keycloak OIDC\nDESCRIPTION: This configuration sets up Nginx as an OpenID Connect (OIDC) client with Keycloak. It defines the OIDC provider, configures SSL, and proxies requests to a backend server, forwarding OIDC claims as headers. The resolver is essential for issuer discovery.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/keycloak.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # Use a public DNS resolver for Issuer discovery, etc.\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider keycloak {\n        # The 'issuer' typically matches your Keycloak realm's base URL:\n        # For example: https://<keycloak-server>/realms/<realm_name>\n        issuer https://<keycloak-server>/realms/master;\n\n        # Replace with your actual Keycloak client_id and secret\n        client_id <client_id>;\n        client_secret <client_secret>;\n\n        # If the .well-known endpoint can’t be derived automatically,\n        # specify config_url:\n        # config_url https://<keycloak-server>/realms/master/.well-known/openid-configuration;\n    }\n\n    server {\n        listen 443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n            # Protect this location with Keycloak OIDC\n            auth_oidc keycloak;\n\n            # Forward OIDC claims as headers if desired\n            proxy_set_header sub $oidc_claim_sub;\n            proxy_set_header email $oidc_claim_email;\n            proxy_set_header name $oidc_claim_name;\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n\n    server {\n        # Simple test backend\n        listen 8080;\n\n        location / {\n            return 200 \"Hello, $http_name!\\nEmail: $http_email\\nSub: $http_sub\\n\";\n            default_type text/plain;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration (Shell)\nDESCRIPTION: This shell command sends the HUP signal to a Docker container, which triggers Nginx to reload its configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_33\n\nLANGUAGE: shell\nCODE:\n```\ndocker kill -s HUP container-name\n```\n\n----------------------------------------\n\nTITLE: Server-Specific Parameters in NGINX Stream Upstream\nDESCRIPTION: This snippet demonstrates how to specify server-specific parameters, such as `weight` and `max_conns`, for individual servers within an upstream group. These parameters allow for fine-grained control over load distribution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nupstream stream_backend {\n    hash   $remote_addr consistent;\n    server backend1.example.com:12345 weight=5;\n    server backend2.example.com:12345;\n    server backend3.example.com:12346 max_conns=3;\n}\nupstream dns_servers {\n    least_conn;\n    server 192.168.136.130:53;\n    server 192.168.136.131:53;\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Plus (Alpine Linux)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Plus package from Alpine Linux. It uses the `apk del` command to remove the `app-protect-module-plus` package. Requires root privileges and the apk package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_49\n\nLANGUAGE: shell\nCODE:\n```\nsudo apk del app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Caching Additional Methods in Nginx\nDESCRIPTION: This snippet demonstrates how to cache responses to requests using methods other than GET and HEAD, such as POST. The proxy_cache_methods directive is used to specify the HTTP methods to cache. This expands caching capabilities to support various request types.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_methods GET HEAD POST;\n```\n\n----------------------------------------\n\nTITLE: Full JWKs Subrequest Example - Nginx Configuration\nDESCRIPTION: This configuration provides a complete example of fetching JWKs from a subrequest and caching them. It sets up the cache path, defines a server block with a location that requires JWT authentication, and an internal location to fetch the keys from an external identity provider. Caching is used to minimize the load on the IdP.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\n#\nproxy_cache_path /var/cache/nginx/jwk levels=1 keys_zone=jwk:1m max_size=10m;\n\nserver {\n    listen 80; # Use SSL/TLS in production\n\n    location / {\n        auth_jwt             \"closed site\";\n        auth_jwt_key_cache   1h;\n        auth_jwt_key_request /_jwks_uri;    # Keys will be fetched by subrequest\n\n        proxy_pass http://my_backend;\n    }\n\n    location = /_jwks_uri {\n        internal;\n        proxy_method      GET;\n        proxy_cache       jwk; # Cache responses\n        proxy_cache_valid 200 12h;\n        proxy_pass        https://idp.example.com/oauth2/keys; # Obtain keys from here\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring TLS Protocol Versions in NGINXaaS\nDESCRIPTION: This snippet references the NGINX documentation on how to overwrite the default TLS/SSL policy in NGINX. It describes how to configure desired TLS protocol versions.  The configuration is done by overwriting the NGINX default protocol to configure the desired TLS/SSL policy, using the ssl_protocols directive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/faq.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\nModule ngx_http_ssl_module (http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_protocols)\n```\n\n----------------------------------------\n\nTITLE: Set Accept-Encoding Header in openid_connect.server_conf\nDESCRIPTION: This snippet adds the `proxy_set_header` directive to the `/_jwks_uri` and `/_token` locations in the `openid_connect.server_conf` file. This configures Nginx to accept gzipped responses from the Auth0 server, potentially improving performance. This is important for handling large JWKS (JSON Web Key Set) responses.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/auth0.md#_snippet_4\n\nLANGUAGE: Nginx configuration file\nCODE:\n```\n...\\n location = /_jwks_uri {\n    ...\n    proxy_set_header    Accept-Encoding \"gzip\"\n}\n...\nlocation = /_token {\n    ...\n    proxy_set_header    Accept-Encoding \"gzip\"\n}\n...\n```\n\n----------------------------------------\n\nTITLE: Referencing Updated Policy in nginx.conf - Nginx\nDESCRIPTION: This configuration directive specifies the path to the updated App Protect policy file. The `app_protect_policy_file` directive in the `nginx.conf` file points to the location of the newly created default policy. Assumes the policy file is located in the `/policies_mount/` directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_policy_file /policies_mount/new_default_policy.tgz;\n```\n\n----------------------------------------\n\nTITLE: Install njs module on Debian and Ubuntu\nDESCRIPTION: This code snippet illustrates how to install the `nginx-plus-module-njs` package on Debian and Ubuntu systems using the `apt` package manager. The script first updates the package index and then installs the njs module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginscript.md#_snippet_2\n\nLANGUAGE: Shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Querying Metrics with Dimensions and GroupBy using cURL\nDESCRIPTION: This cURL command retrieves metrics, specifically the sum of HTTP request counts, grouping the results by 'app' and 'location' and including the 'app' dimension. It requires a session cookie, specifies a 3-hour startTime window, and sets the resolution to 5 minutes. The controller IP address needs to be replaced in the URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_20\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=SUM(http.request.count)&groupBy=app,location&dimensions=app&startTime=now-3h&resolution=5m\"\n```\n\n----------------------------------------\n\nTITLE: Update Proxy with Token in Header - JSON\nDESCRIPTION: This JSON snippet represents the request body for updating the proxy configuration to handle access tokens in the request header using a custom name. It configures the `oauth2-introspection` policy with the `clientTokenName` set to `apiAccessToken`, instructing NGINX to look for the access token in the header with that key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_32\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"test-proxy\",\n   \"version\": \"v1\",\n   \"proxyConfig\": {\n      \"hostname\": \"data-host\",\n      \"ingress\": {\n         \"basePath\": \"/\",\n         \"basePathVersionAppendRule\": \"NONE\"\n      },\n      \"backends\": [\n         {\n            \"serviceName\": \"backend-echo-svc\",\n            \"serviceTargets\": [\n               {\n                  \"hostname\": \"192.0.2.4\",\n                  \"listener\": {\n                     \"enableTLS\": false,\n                     \"port\": 10000,\n                     \"transportProtocol\": \"HTTP\"\n                  }\n               }\n            ]\n         }\n      ],\n      \"policies\": {\n         \"oauth2-introspection\": [\n            {\n               \"action\": {\n                  \"introspectionEndpoint\": \"http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect\",\n                        \"clientTokenName\": \"apiAccessToken\"\n               },\n               \"data\": [\n                  {\n                     \"clientAppID\": \"nginx-plus\",\n                     \"clientSecret\": \"<client secret>\"\n                  }\n               ]\n            }\n         ]\n      }\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Verifying Enforcement Functionality with cURL (Shell)\nDESCRIPTION: Verifies the enforcement functionality by sending a request with a potentially malicious script using `curl`.  This command sends a request to the localhost with a URL containing a `<script>` tag.  The expected output is a rejection of the request, indicating that the WAF is functioning correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_11\n\nLANGUAGE: Shell\nCODE:\n```\ncurl \"localhost/<script>\"\n```\n\n----------------------------------------\n\nTITLE: Enabling ModSecurity module in Nginx configuration\nDESCRIPTION: This snippet demonstrates how to enable dynamic loading of the ModSecurity module in the Nginx configuration file (`nginx.conf`) by using the `load_module` directive within the top-level (\"main\") context and the http block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginx-waf.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_modsecurity_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Default Health Check - Nginx\nDESCRIPTION: This configures a default health check in Nginx. The `location /` block sets up a proxy to the 'myapp' upstream and the `health_check;` directive enables the health check. Nginx will send GET requests to the root path of the backend servers and consider them healthy if they return a 2xx or 3xx response code.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    proxy_pass http://myapp;\n    health_check;\n}\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration\nDESCRIPTION: This command reloads the Nginx configuration, applying any changes made to the configuration files. This is necessary for the new OWASP CRS rules to take effect. The command requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_4\n\nLANGUAGE: none\nCODE:\n```\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Redirecting HTTP to HTTPS - Nginx\nDESCRIPTION: This snippet configures a server block to listen for HTTP requests on port 80 and redirect them to the HTTPS version of the same domain. It uses a 'return' directive within a 'location' block to achieve this redirection.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80;\n    server_name example.com;\n\n    # Redirect all HTTP requests to HTTPS\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure DNS Resolver in NGINX\nDESCRIPTION: This snippet configures the DNS resolver within the NGINX `http` block.  The `resolver` directive specifies the IP address of the DNS server to use for resolving domain names. `ipv4=on` ensures IPv4 addresses are resolved. `valid=300s` sets the DNS record's TTL to 300 seconds.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/onelogin.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring JWT from Query String Parameter in Nginx\nDESCRIPTION: This snippet shows how to configure Nginx to accept the JWT from a query string parameter named `apijwt`. The `token=$arg_apijwt` parameter tells Nginx to extract the JWT from the `apijwt` query parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\n   #...\n   auth_jwt \"API\" token=$arg_apijwt;\n   #...\n```\n\n----------------------------------------\n\nTITLE: Enabling App Protect DoS API - Nginx\nDESCRIPTION: This code snippet demonstrates how to enable the App Protect DoS monitoring capability via REST API in an Nginx server configuration. It configures a location block `/api` to use the `app_protect_dos_api` directive, restricting access to a specific network using `allow` and `deny` directives. A separate location is also defined for serving the dashboard.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_18\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    server {\n        listen 192.168.1.23;\n        # ...\n        location /api {\n            app_protect_dos_api;\n            allow 192.168.1.0/24;\n            deny  all;\n        }\n        location = /dashboard-dos.html {\n            root   /usr/share/nginx/html;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing Ansible on Debian/Ubuntu\nDESCRIPTION: These commands install Ansible on Debian and Ubuntu systems. It first updates the package list, then installs python-pip, and finally installs Ansible using pip.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/microsoft-azure/virtual-machines-for-nginx.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\napt update\napt install python-pip -y\npip install ansible\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Zone for Monitoring\nDESCRIPTION: This snippet configures the `zone` directive for an upstream group named `jboss`.  This directive creates a shared memory zone that stores the group's configuration and run-time state, enabling monitoring and dynamic reconfiguration. The zone size is set to 64k.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_33\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream jboss {\n    zone jboss 64k;\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Disabling Buffering for RPC Over HTTP in NGINX\nDESCRIPTION: This snippet configures a `location` block within the `server` block for HTTPS traffic in NGINX. It disables buffering for both uploads and downloads, which is necessary for Microsoft RPC Over HTTP to function correctly. It also sets the `proxy_http_version` to 1.1 and configures the `Connection` header to `Keep-Alive` for persistent connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_40\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation / {\n    proxy_pass https://exchange;\n    proxy_buffering off;\n    proxy_http_version 1.1;\n    proxy_request_buffering off;\n    proxy_set_header Connection \"Keep-Alive\";\n}\n```\n\n----------------------------------------\n\nTITLE: Example NGINX dest-svc Configuration YAML\nDESCRIPTION: This YAML demonstrates configuring the destination service (dest-svc) with a specific container port, NGINX listen port within the ConfigMap, and Service port. It shows how to modify these parameters to control the destination service's behavior.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_25\n\nLANGUAGE: yaml\nCODE:\n```\n---\nkind: Deployment\nspec:\n  template:\n    spec:\n      containers:\n      - name: example\n          - containerPort: 55555\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: dest-svc\ndata:\n  nginx.conf: |-\n    events {}\n    http {\n      server {\n        listen 55555;\n        location / {\n          return 200 \"destination service\\n\";\n        }\n      }\n    }\n---\nkind: Service\nspec:\n  ports:\n  - port: 55555\n```\n\n----------------------------------------\n\nTITLE: Configuring X-Content-Type-Options header in Nginx\nDESCRIPTION: This snippet configures the X-Content-Type-Options header to prevent MIME sniffing. Setting it to 'nosniff' instructs the browser to strictly adhere to the MIME types specified in the Content-Type headers, avoiding potential security vulnerabilities.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-response-headers.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nadd_header X-Content-Type-Options nosniff [always]\n```\n\n----------------------------------------\n\nTITLE: Creating API Location Block NGINX\nDESCRIPTION: This snippet defines a location block `/api` within the `http` and `server` blocks in the Nginx configuration.  This location will handle API requests.  It's required to specify where the API endpoint will be exposed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    server {\n        location /api {\n            # ...\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Data Guard Policy with Custom Patterns\nDESCRIPTION: This JSON configuration defines an NGINX policy with Data Guard enabled for masking data based on custom patterns. The `customPatternsList` specifies the regular expressions to match, while `firstCustomCharactersToExpose` and `lastCustomCharactersToExpose` define the number of characters to leave unmasked at the beginning and end of the matched patterns, respectively. The `enforcementMode` is set to ignore URLs in the `enforcementUrls` list.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/partial-masking-of-data.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"custom_pattern_mask_policy\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_DATA_GUARD\",\n                    \"alarm\": true,\n                    \"block\": false\n                }\n            ]\n        },\n        \"data-guard\": {\n            \"enabled\": true,\n            \"maskData\": true,\n            \"creditCardNumbers\": false,\n            \"usSocialSecurityNumbers\": true,\n            \"enforcementMode\": \"ignore-urls-in-list\",\n            \"enforcementUrls\": [],\n            \"customPatterns\": true,\n            \"firstCustomCharactersToExpose\": 2,\n            \"lastCustomCharactersToExpose\": 4,\n            \"customPatternsList\": [\n               \"....-....-....-....\",\n               \"siteTk_[0-9]+\"\n            ]\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS Resolver and Upstream in Nginx\nDESCRIPTION: This code snippet demonstrates how to configure a DNS resolver and an upstream server with automatic re-resolution of the domain name in Nginx. It specifies a DNS server, defines an upstream group, and configures a server within that group to automatically resolve its domain name. This is useful for dynamic environments where upstream server IPs may change.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/faq.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nresolver 10.0.0.2 valid=10s;\nupstream backends {\n    zone backends 64k;\n    server backends.example.com:8080 resolve;\n}\n\nserver {\n    location / {\n        proxy_pass http://backends;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Passing the original request URI\nDESCRIPTION: This configuration passes the original request URI to the authentication server. The `proxy_set_header` directive sets the `X-Original-URI` header to the value of `$request_uri`, which contains the full URI with arguments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-subrequest-authentication.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nlocation = /auth {\n    internal;\n    proxy_pass              http://auth-server;\n    proxy_pass_request_body off;\n    proxy_set_header        Content-Length \"\";\n    proxy_set_header        X-Original-URI $request_uri;\n}\n```\n\n----------------------------------------\n\nTITLE: Adding a Server to Upstream Group via API Shell\nDESCRIPTION: This snippet shows how to add a new server to an upstream group using a `POST` request to the NGINX Plus API. The `curl` command sends the server details (address and weight) as JSON data. It requires Nginx plus with API enabled and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_21\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X POST -d '{ \\\n   \"server\": \"appserv3.example.com:12345\", \\\n   \"weight\": 4 \\\n }' -s 'http://127.0.0.1/api/9/stream/upstreams/appservers/servers'\n```\n\n----------------------------------------\n\nTITLE: Check Keepalived Logs\nDESCRIPTION: This snippet retrieves the last 50 lines of the `keepalived` service logs using `journalctl`. This is useful for troubleshooting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\njournalctl -u keepalived --no-pager | tail -50\n```\n\n----------------------------------------\n\nTITLE: Proxying Requests to Upstream Group Nginx\nDESCRIPTION: This snippet configures location blocks to proxy requests to the 'weblogic' upstream group. It also sets up a redirect from the root path to the /weblogic-app/ location. This snippet should be placed inside the server block for HTTPS traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_17\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /weblogic-app/ {\n    proxy_pass http://weblogic;\n}\n\nlocation = / {\n    return 302 /weblogic-app/;\n}\n```\n\n----------------------------------------\n\nTITLE: Listing WAF Enforcer Tags\nDESCRIPTION: This command retrieves and displays the list of available tags for the NGINX App Protect WAF enforcer image from the private registry. It uses `curl` to make the request, authenticates with provided certificate and key, and formats the output using `jq`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://private-registry.nginx.com/v2/nap/waf-enforcer/tags/list --key <nginx-repo.key> --cert <nginx-repo.crt> | jq\n```\n\n----------------------------------------\n\nTITLE: Validating and Reloading Nginx Configuration\nDESCRIPTION: This shell script first validates the Nginx configuration using `nginx -t`, then reloads Nginx using `nginx -s reload`. This ensures that any configuration changes are applied without interrupting traffic.  It requires Nginx to be installed and accessible in the system's PATH.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Configuring Basic Upstream Group in NGINX\nDESCRIPTION: This code defines an upstream group named 'jboss' with two Wildfly application servers listening on port 8080. The 'upstream' block is placed within the 'http' block in the Nginx configuration. This configuration enables Nginx to distribute traffic between these servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\nupstream jboss {\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: Complete NGINX Auth0 OIDC Configuration\nDESCRIPTION: This configuration demonstrates a complete setup integrating Auth0 OIDC authentication with an Nginx reverse proxy, including DNS resolution, OIDC provider configuration, SSL certificate setup, and header forwarding. It includes an example of a basic backend application that displays authentication details.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/auth0.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # Use a public DNS resolver for Issuer discovery, etc.\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider auth0 {\n        # Issuer from your Auth0 tenant's .well-known/openid-configuration\n        issuer https://yourTenantId.us.auth0.com/;\n\n        # Replace with your actual Client ID and Secret from Auth0\n        client_id <client_id>;\n        client_secret <client_secret>;\n    }\n\n    server {\n        listen 443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n            # Enforce OIDC for root path with Auth0\n            auth_oidc auth0;\n\n            # Forward OIDC claims to the upstream as headers if desired\n            proxy_set_header email $oidc_claim_email;\n            proxy_set_header name  $oidc_claim_name;\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n\n    server {\n        # Simple test upstream server\n        listen 8080;\n\n        location / {\n            return 200 \"Hello, $http_name!\\nEmail: $http_email\\nAuth0 sub: $http_sub\\n\";\n            default_type text/plain;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Nginx Configuration for gRPC with App Protect\nDESCRIPTION: This Nginx configuration enables gRPC capability with HTTP/2, applying an application protection policy using `app_protect_policy_file` and logging all gRPC messages to the security log. The configuration also includes settings for timeouts, keepalive, and proxy parameters.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/how-to/bidirectional-configuration.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nworker_processes auto;\n\nload_module modules/ngx_http_app_protect_module.so;\n\nerror_log /var/log/nginx/error.log debug;\nworking_directory /tmp/cores;\nworker_rlimit_core 1000M;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    keepalive_timeout  30m;\n    client_body_timeout 30m;\n    client_max_body_size 0;\n    send_timeout 30m;\n\n    proxy_connect_timeout  30m;\n    proxy_send_timeout  30m;\n    proxy_read_timeout  30m;\n    proxy_socket_keepalive on;\n\n    server {\n        listen       80 default_server http2;\n        server_name  localhost;\n        app_protect_enable on;\n        app_protect_policy_file \"/etc/app_protect/conf/grpc_policy.json\";\n        app_protect_security_log_enable on;\n        app_protect_security_log \"/opt/app_protect/share/defaults/log_grpc_all.json\" /tmp/grpc.log;\n\n        grpc_socket_keepalive on;\n        grpc_read_timeout 30m;\n        grpc_send_timeout 30m;\n\n        location / {\n            default_type text/html;\n            grpc_pass grpc://<GRPC_BACKEND_SERVER_IP>:<PORT>;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP to HTTPS Redirect - Nginx\nDESCRIPTION: This Nginx configuration defines a virtual server that listens for HTTP requests on port 80 and redirects them to the HTTPS version of the site.  It uses a 301 redirect, which is a permanent redirect, and the `$http_host` and `$request_uri` variables to construct the new HTTPS URL. This block should reside within the `http` block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_19\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nserver {\n     listen 80;\n     status_zone oracle-http-redirect;\n     return 301 https://$http_host$request_uri;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring keepalived for a Passive Node - YAML\nDESCRIPTION: This code snippet demonstrates the configuration of the keepalived.conf file for an additional passive node in an NGINX Plus high availability setup. It sets the priority lower than the other nodes, specifies the unicast source IP, and includes the IP addresses of all other nodes in the unicast_peer section.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived-nodes.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nvrrp_script chk_nginx_service {\n    script  \"/usr/lib/keepalived/nginx-ha-check\"\n    interval 3\n    weight   50\n}\n\nvrrp_instance VI_1 {\n    interface         eth0\n    state             BACKUP\n    priority          99\n    virtual_router_id 51\n    advert_int        1\n    accept\n    unicast_src_ip    192.168.10.12\n\n    unicast_peer {\n        192.168.10.10\n        192.168.10.11\n    }\n\n    virtual_ipaddress {\n        192.168.10.100\n    }\n\n    track_script {\n        chk_nginx_service\n    }\n\n    notify \"/usr/lib/keepalived/nginx-ha-notify\"\n}\n```\n\n----------------------------------------\n\nTITLE: Applying Proxy Cache Policy via API\nDESCRIPTION: This JSON payload demonstrates how to apply the Proxy Cache policy to an API proxy using the NGINX Management Suite API. It configures various caching parameters, including HTTP methods to cache, cache keys, maximum cache size, validation time, revalidation, background update, stale content delivery settings, and cache lock options.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-cache.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policies\": {\n        \"proxy-cache\": [\n            {\n                \"action\": {\n                    \"httpMethods\": [\n                        \"GET\",\n                        \"HEAD\",\n                        \"POST\"\n                    ],\n                    \"cacheKey\": [\n                        \"host\",\n                        \"requestURI\",\n                        \"scheme\",\n                        \"cookieJSessionID\",\n                        \"cookieUser\"\n                    ],\n                    \"maxCacheSize\": \"1G\",\n                    \"cacheValidTime\": \"10m\",\n                    \"minUseOfProxyToCache\": 1,\n                    \"reValidate\": true,\n                    \"backgroundUpdate\": true,\n                    \"stale\": {\n                        \"backendErrors\": [\n                            \"error\",\n                            \"timeout\",\n                            \"invalid_header\",\n                            \"updating\"\n                        ],\n                        \"backendErrorCodes\": [\n                            403,\n                            404,\n                            429,\n                            500,\n                            502,\n                            503,\n                            504\n                        ]\n                    },\n                    \"cacheLock\": {\n                        \"enabled\": true,\n                        \"age\": \"5s\",\n                        \"timeout\": \"5s\"\n                    }\n                }\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Creating custom NGINX Plus Docker image (Shell)\nDESCRIPTION: This snippet demonstrates how to create a custom NGINX Plus Docker image. It uses docker build with the --secret option to securely pass the nginx-repo.key and nginx-repo.crt files during the build process and the `--no-cache` option is used to ensure the installation of the latest version of NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\ndocker build  --no-cache --secret id=nginx-key,src=nginx-repo.key --secret id=nginx-crt,src=nginx-repo.crt -t nginxplus .\n```\n\n----------------------------------------\n\nTITLE: Pulling Docker images for waf-enforcer and waf-config-mgr\nDESCRIPTION: This snippet pulls the `waf-enforcer` and `waf-config-mgr` Docker images from the private registry. Replace `5.2.0` with the actual release version being deployed. These images are necessary for running the NGINX App Protect WAF services.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_39\n\nLANGUAGE: shell\nCODE:\n```\ndocker pull private-registry.nginx.com/nap/waf-enforcer:5.2.0\ndocker pull private-registry.nginx.com/nap/waf-config-mgr:5.2.0\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP Basic Authentication in Nginx\nDESCRIPTION: This snippet configures HTTP Basic authentication for the Nginx status page.  The `auth_basic` and `auth_basic_user_file` directives are used to enable authentication and specify the file containing user credentials.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_37\n\nLANGUAGE: nginx\nCODE:\n```\nauth_basic on;\nauth_basic_user_file /etc/nginx/users;\n```\n\n----------------------------------------\n\nTITLE: Defining an HTTPRoute in YAML\nDESCRIPTION: This YAML snippet defines an HTTPRoute named 'coffee' that matches requests with the path prefix '/coffee' for the hostname 'cafe.example.com'. It directs traffic to the 'coffee' backend service on port 80.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_8\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: coffee\nspec:\n  parentRefs:\n    - name: gateway\n      sectionName: http\n  hostnames:\n    - \"cafe.example.com\"\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /coffee\n      backendRefs:\n        - name: coffee\n          port: 80\n```\n\n----------------------------------------\n\nTITLE: Generating a JSON Policy for NGINX App Protect WAF\nDESCRIPTION: Example command to generate a JSON policy suitable for NGINX App Protect WAF using the Policy Converter tool within a Docker container. The command mounts the current directory, sets the entrypoint to the converter, and specifies input and output files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker run --rm \\\n -v $(pwd):$(pwd) \\\n --entrypoint=/opt/app_protect/bin/convert-policy \\\n waf-compiler-<version-tag>:custom \\\n -i $(pwd)/policy1.xml -o $(pwd)/policy1.json\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX sync - Create sync config file\nDESCRIPTION: This code snippet shows the content of the /etc/nginx-sync.conf file. It defines the NODES to synchronize with, the CONFPATHS to synchronize and the EXCLUDE files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nNODES=\"node2.example.com node3.example.com node4.example.com\"\nCONFPATHS=\"/etc/nginx/nginx.conf /etc/nginx/conf.d\"\nEXCLUDE=\"default.conf\"\n```\n\n----------------------------------------\n\nTITLE: Configuring UDP Proxy Server - NGINX\nDESCRIPTION: Configures a server that listens on UDP port 53 and proxies incoming traffic to the `dns_upstream` group. It also sets a proxy timeout of 1 second and expects only 1 response, logging errors to `logs/dns.log`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    server {\n        listen          53 udp;\n        proxy_pass      dns_upstream;\n        proxy_timeout   1s;\n        proxy_responses 1;\n        error_log       logs/dns.log;\n    }\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Define GitLab CI/CD Rule for Instance Directory Changes (YAML)\nDESCRIPTION: This YAML snippet defines a rule for a GitLab CI/CD pipeline that triggers only when changes are detected within the 'instance' directory, specifically targeting 'nginx.conf' and any other files in the directory. It ensures that the pipeline runs only when relevant configuration files are modified, optimizing the deployment process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/publish-configs-version-control.md#_snippet_0\n\nLANGUAGE: YAML\nCODE:\n```\n_run_only_when_change_in_instance_directory:  &_run_only_when_change_in_instance_directory\n changes:\n -  instance/nginx.conf\n -  instance/*\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Plus (Ubuntu 22.04)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Plus package from Ubuntu 22.04. It uses the `apt-get remove` command to remove the `app-protect-module-plus` package. Requires root privileges and the apt package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_69\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get remove app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Configuring Access File - Nginx\nDESCRIPTION: This snippet demonstrates the use of the `app_protect_dos_access_file` directive to define an allowlist policy from a specified file.  The provided file path points to a JSON file containing IP addresses or ranges that should never be blocked by App Protect DoS. The referenced file should adhere to a specific JSON structure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_20\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_dos_access_file \"/etc/app_protect_dos/allowlist.json\";\n```\n\n----------------------------------------\n\nTITLE: Customizing Blocking Page in NGINX Policy (JSON)\nDESCRIPTION: This snippet shows how to customize the blocking page displayed to the user when a request is blocked. The `responseContent` field contains the HTML markup for the custom page, including the support ID.  The `responseHeader` sets the HTTP headers for the response. `responseActionType` is set to custom and `responsePageType` to default for a custom replacement.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/additional-config-options.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n {\n    \"policy\": {\n        \"name\": \"blocking_page\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"response-pages\": [\n            {\n                \"responseContent\": \"<html><head><title>Custom Reject Page</title></head><body>This is a custom response page; it is supposed to overwrite the default page with custom text.<br><br>Your support ID is: <%TS.request.ID()%><br><br><a href='javascript:history.back();'>[Go Back]</a></body></html>\",\n                \"responseHeader\": \"HTTP/1.1 200 OK\\r\\nCache-Control: no-cache\\r\\nPragma: no-cache\\r\\nConnection: close\",\n                \"responseActionType\": \"custom\",\n                \"responsePageType\": \"default\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Server Block in Nginx\nDESCRIPTION: Configures a server block in Nginx to listen on port 80, sets the server name, defines the root directory for serving files, configures error logging, sets the index file, disables caching, and configures sub_filter directives to replace placeholders with server information. This configuration defines how the server responds to HTTP requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/setting-up-nginx-demo-environment.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80 default_server;\n    server_name app_server;\n\n    root /usr/share/nginx/html;\n    error_log /var/log/nginx/app-server-error.log notice;\n    index demo-index.html index.html;\n    expires -1;\n\n    sub_filter_once off;\n    sub_filter 'server_hostname' '$hostname';\n    sub_filter 'server_address'  '$server_addr:$server_port';\n    sub_filter 'server_url'      '$request_uri';\n    sub_filter 'remote_addr'     '$remote_addr:$remote_port';\n    sub_filter 'server_date'     '$time_local';\n    sub_filter 'client_browser'  '$http_user_agent';\n    sub_filter 'request_id'      '$request_id';\n    sub_filter 'nginx_version'   '$nginx_version';\n    sub_filter 'document_root'   '$document_root';\n    sub_filter 'proxied_for_ip'  '$http_x_forwarded_for';\n}\n\t\n```\n\n----------------------------------------\n\nTITLE: Enable NGINX App Protect WAF\nDESCRIPTION: Enables NGINX App Protect WAF in the specified context (http, server, or location). It is recommended to enable a basic policy at the `http` or `server` level to process malicious requests comprehensively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/configure-waf.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enable on;\n```\n\n----------------------------------------\n\nTITLE: Proxying to Upstream Group Nginx\nDESCRIPTION: This snippet configures two location blocks inside the HTTPS server block. The first location proxies requests to /webapp/ to the 'nodejs' upstream group. The second location redirects requests to the root ('/') to /webapp/ using a 302 redirect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /webapp/ {\n    proxy_pass http://nodejs;\n}\n\nlocation = / {\n    return 302 /webapp/;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Path to Nginx Config File\nDESCRIPTION: Shows how to manually specify the path to the Nginx configuration file in the agent.conf file.  This should only be used as a workaround if the agent cannot automatically find the configuration file. This setting is crucial for the agent to correctly parse the Nginx configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/configuring-amplify-agent.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\n[nginx]\nconfigfile = /etc/nginx/nginx.conf\n```\n\n----------------------------------------\n\nTITLE: Route gRPC requests to upstream server group in Nginx\nDESCRIPTION: Configures a server location that routes gRPC requests to the upstream server group defined as `grpc_backend`. Any requests to the `/grpc` location will be proxied to the gRPC backend servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/grpc-health-check.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /grpc {\n    grpc_pass grpc://grpc_backend;\n}\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Agent REST API\nDESCRIPTION: This code snippet configures the REST API within the NGINX Agent configuration file.  It defines the host and port on which the API will listen.  This configuration is required to enable access to the `/health` endpoint for health checks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/health-checks.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\napi:\n  host: 127.0.0.1\n  port: 8038\n```\n\n----------------------------------------\n\nTITLE: Configuring SSL Certificate and Protocols (Nginx)\nDESCRIPTION: This snippet configures the SSL certificate, private key, and allowed SSL/TLS protocols within the 'server' block for HTTPS traffic. It specifies the paths to the certificate and key files and disables protocols less secure than TLS version 1.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_34\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nssl_certificate /etc/nginx/ssl/company.com.crt;\nssl_certificate_key /etc/nginx/ssl/company.com.key;\nssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n```\n\n----------------------------------------\n\nTITLE: Configuring X-Backend-Latency header in Nginx\nDESCRIPTION: This snippet adds the X-Backend-Latency header to the response, indicating the backend/upstream response time. The $upstream_header_time variable represents the time taken to receive the headers from the upstream server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-response-headers.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nadd_header X-Backend-Latency $upstream_header_time [always]\n```\n\n----------------------------------------\n\nTITLE: Protect Location with OIDC\nDESCRIPTION: This snippet protects a specific location with OIDC using the `auth_oidc` directive. It points to the previously defined OIDC provider `my_idp`. Any requests to this location will be authenticated against the configured IdP.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-oidc.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc my_idp;\n\n     # ...\n\n     proxy_pass http://127.0.0.1:8080;\n\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Disable Nginx Plus Metrics with $prom_metrics_disabled\nDESCRIPTION: This snippet demonstrates how to use the `$prom_metrics_disabled` variable to disable specific NGINX Plus status metrics from being exported to Prometheus. The variable is set within the `/metrics` location block, specifying a comma-separated list of endpoints to disable. This is useful for reducing the amount of storage used by NGINX Plus metrics in Prometheus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /metrics {\n    set $prom_keyval           \"http_upstream_keyval\";\n    set $prom_keyval_stream    \"stream_upstream_keyval\";\n    set $prom_metrics_disabled \"stream/upstreams, resolvers\";\n    js_content                 prometheus.metrics;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Slow Start for Upstream Servers - Nginx\nDESCRIPTION: This snippet configures a slow-start period for upstream servers. When a failed server recovers, or a new server is added, NGINX Plus slowly ramps up the traffic to it over a defined period of time.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_28\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'upstream' block\nserver 192.168.33.11:8080 slow_start=30s;\nserver 192.168.33.12:8080 slow_start=30s;\n```\n\n----------------------------------------\n\nTITLE: Enabling Server-Side TLS via Config File - Bash\nDESCRIPTION: This snippet shows how to enable server-side TLS by modifying the `/etc/nginx-agent/nginx-agent.conf` configuration file. It sets the `tls.enable` option to `true` to enable TLS. `skip_verify` is set to `false` to enforce certificate validation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/encrypt-communication.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ntls:\n  enable: true\n  skip_verify: false\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx Configuration (Shell)\nDESCRIPTION: This command reloads the Nginx configuration without interrupting service.  This ensures that the new configuration is applied without downtime.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_11\n\nLANGUAGE: none\nCODE:\n```\nroot# nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Querying Request Counts by App Security Processing (curl)\nDESCRIPTION: This query retrieves request counts based on how App Security processed the traffic, grouped by `request_outcome_reason`.  It filters the data by application, environment, and component, allowing for granular analysis of App Security's impact.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/view-app-security-analytics.md#_snippet_1\n\nLANGUAGE: curl\nCODE:\n```\nhttps://{{host}}/api/v1/analytics/metrics?\n    startTime=0&\n    endTime=now&\n    resolution=5m&\n    names=sum(http.request.count)&\n    groupBy=request_outcome_reason&\n    filter=(\n        app='shopping' and\n        environment='prod' and\n        component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Complete NTP Health Check Configuration - NGINX\nDESCRIPTION: Provides a complete configuration example for NTP health checks, including the upstream definition, server configuration, and match block.  It defines an upstream group `ntp_upstream`, configures a server to listen on UDP port 53, and applies the `ntp` match block for health checks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    upstream ntp_upstream {\n        zone   ntp_zone 64k;\n        server 192.168.136.130:53;\n        server 192.168.136.131:53;\n        server 192.168.136.132:53;\n}\n    server {\n        listen          53 udp;\n        proxy_pass      ntp_upstream;\n        health_check    match=ntp udp;\n        proxy_timeout   1s;\n        proxy_responses 1;\n        error_log       logs/ntp.log;\n        }\n\n    match ntp {\n        send \\xe3\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00;\n        expect ~* \\x24;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Including Tomcat Configuration in Nginx (Nginx)\nDESCRIPTION: This configuration snippet includes the specified tomcat configuration file (either basic or enhanced) into the http block of the main nginx.conf file. This allows Nginx to load and use the settings defined in the external configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    include conf.d/tomcat-(basic|enhanced).conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Testing Nginx App Protect Enforcement\nDESCRIPTION: This command uses `curl` to send a request to the deployed Nginx service and verify that the Nginx App Protect WAF is enforcing security policies. The expectation is that a request containing `<script>` will be rejected, indicating that the WAF is working as expected. `<node-external-ip>:<node-port>` refers to the address and port where the Nginx service is exposed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_27\n\nLANGUAGE: shell\nCODE:\n```\ncurl \"<node-external-ip>:<node-port>/<script>\"\n```\n\n----------------------------------------\n\nTITLE: Complete NGINX Configuration with App Protect and Security Logs\nDESCRIPTION: This snippet provides a complete NGINX configuration example that includes enabling App Protect, specifying the policy file, enabling security logs, and configuring the log destination. It sets up a simple reverse proxy and includes a basic location block to return a 'Hello World' message.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/enable-logging.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nworker_processes auto;\nworker_rlimit_nofile 8192;\npid /run/nginx/nginx.pid;\n\nload_module modules/ngx_http_app_protect_module.so;\n\nevents {\n    worker_connections 4000;\n}\n\nerror_log /var/log/nginx/error.log debug;\n\nhttp {\n    access_log off;\n    server_tokens \"\";\n\n    app_protect_enforcer_address 127.0.0.1:50000;\n\n    server {\n        listen 80 default_server;\n\n        location / {\n            app_protect_enable on;\n            app_protect_policy_file /etc/app_protect/conf/NginxDefaultPolicy.tgz;\n            app_protect_security_log_enable on;\n            app_protect_security_log \"/etc/app_protect/conf/log_all.tgz\" syslog:server=localhost:5140;\n            proxy_pass http://127.0.0.1:80/proxy/$request_uri;\n        }\n\n        location /proxy {\n            default_type text/html;\n            return 200 \"Hello World\\n\";\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Group for Load Balancing - Nginx\nDESCRIPTION: This snippet defines an upstream group named 'tomcat' that consists of two backend servers listening on port 8080. This upstream block is used for load balancing requests across these servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\nupstream tomcat {\n    server 10.100.100.11:8080;\n    server 10.100.100.12:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: Example invalid proxy buffers number and size\nDESCRIPTION: This text example illustrates an invalid configuration where the proxy busy buffers size is not less than the total buffer size minus one buffer, causing a configuration error in NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/http-backend-configuration.md#_snippet_6\n\nLANGUAGE: text\nCODE:\n```\nproxy busy buffers size : 16 KB\nproxy buffer number     : 2\nproxy buffer size       : 2k\ntotal buffer size       : 8 KB\n\nbusy_buffers < total buffer size - buffer\n16 KB < 8 KB - 2k\n16 KB < 6k\nFalse: Invalid proxy buffer number & size configuration\n```\n\n----------------------------------------\n\nTITLE: Example Scan API Response (JSON)\nDESCRIPTION: This JSON response provides details on the completion status of a scan request submitted to the NGINX Instance Manager API. It includes information such as the completion time, duration, number of endpoints scanned, servers found, percentage complete, the initial request parameters, and the scan status. The values represent a completed scan that found 6 Nginx instances after scanning 508 endpoints.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/scan-instances.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"completionTime\": \"2021-12-02T00:27:34.517919044Z\",\n  \"duration\": 13110,\n  \"endpointsScanned\": 508,\n  \"nginxFound\": 6,\n  \"percentageComplete\": 100,\n  \"request\": {\n    \"cidr\": \"192.0.2.0/24\",\n    \"hostDiscovery\": \"icmp\",\n    \"portRanges\": [\n      \"80\",\n      \"443\"\n    ]\n  },\n  \"serversFound\": 6,\n  \"status\": \"complete\"\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling SSL Session Cache\nDESCRIPTION: This snippet shows how to enable and configure the SSL session cache.  The `ssl_session_cache` directive enables the cache. Using `shared` allows worker processes to share the cache which improves performance for subsequent connections. The `shared` cache type requires a size to be defined.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-tcp.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nssl_session_cache shared:SSL:1m;\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Plus for Active-Active - Nginx\nDESCRIPTION: This Nginx configuration snippet shows how to configure NGINX Plus for active-active high availability where each node handles different applications based on the VIP it's listening on. It configures two server blocks, each listening on a different VIP and serving different content based on the root directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived-nodes.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 192.168.10.100:80;\n\n    location / {\n        root /application1;\n    }\n}\n\nserver {\n    listen 192.168.10.101:80;\n\n    location / {\n        root /application2;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS Resolver and Upstream with Resolve\nDESCRIPTION: This snippet configures the DNS resolver and adds the `resolve` parameter to the `server` directive in the `upstream` block.  This instructs NGINX Plus to periodically re-resolve the domain name (example.com) with DNS, enabling dynamic updates to the upstream group's members. A `zone` directive is also included.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_36\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nresolver <IP-address-of-DNS-server>;\n\nupstream jboss {\n    zone jboss 64k;\n    server example.com resolve;\n}\n```\n\n----------------------------------------\n\nTITLE: Test service with curl\nDESCRIPTION: This curl command tests the 'tea' service using local port forwarding. The `--resolve` option maps the hostname cafe.example.com to 127.0.0.1:8080. This sends an HTTP GET request to /tea to verify the service is reachable and returns the expected response.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:8080:127.0.0.1 http://cafe.example.com:8080/tea\n```\n\n----------------------------------------\n\nTITLE: Query Metrics with Filter and Logical Expressions - cURL\nDESCRIPTION: This cURL command demonstrates the use of `filter` with logical expressions (`AND`).  It retrieves data for applications starting with `ap` in the `prod` environment for the last three hours. The filter uses `app` and `environment` dimensions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_12\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=http.request.count&filter=app='ap*' and environment='prod'&startTime=now-3h\"\n```\n\n----------------------------------------\n\nTITLE: Create NGINX Configuration - Azure CLI\nDESCRIPTION: This snippet shows the command to create a new NGINX configuration for a deployment using the Azure CLI. It requires specifying the configuration name, deployment name, and resource group. Optional parameters include specifying individual files, location, and root file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configuration-azure-cli.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment configuration create --configuration-name\n                                         --deployment-name\n                                         --resource-group\n                                         [--files]\n                                         [--location]\n                                         [--no-wait {0, 1, f, false, n, no, t, true, y, yes}]\n                                         [--package]\n                                         [--protected-files]\n                                         [--root-file]\n```\n\n----------------------------------------\n\nTITLE: Configuring Active Health Check Location Block Nginx\nDESCRIPTION: Configures a 'location' block for the health check within the server block for HTTPS traffic. It sets up proxy settings, defines the health check interval, the URI to check, and associates the 'oracleok' match block for validation. This ensures the health check targets a specific endpoint of the Oracle application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_26\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation @health_check {\n     internal;\n     proxy_connect_timeout 3s;\n     proxy_read_timeout 3s;\n     proxy_pass http://oracle;\n     proxy_set_header Host \"oracle.company.com\";\n     health_check match=oracleok interval=4s\n                  uri=/OA_HTML/AppsLocalLogin.jsp;\n}\n```\n\n----------------------------------------\n\nTITLE: Creating ReferenceGrant for cafe-secret\nDESCRIPTION: This YAML configuration defines a ReferenceGrant resource, named 'access-to-cafe-secret', that allows the default namespace to access the 'cafe-secret' Secret located in the 'certificate' namespace. This is required for the Gateway to use the secret for TLS termination.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/https-termination.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1beta1\nkind: ReferenceGrant\nmetadata:\n  name: access-to-cafe-secret\n  namespace: certificate\nspec:\n  to:\n  - group: \"\"\n    kind: Secret\n    name: cafe-secret # if you omit this name, then Gateways in default namespace can access all Secrets in the certificate namespace\n  from:\n  - group: gateway.networking.k8s.io\n    kind: Gateway\n    namespace: default\nEOF\n```\n\n----------------------------------------\n\nTITLE: On-the-fly Configuration Example NGINX\nDESCRIPTION: This snippet provides a complete example configuration for on-the-fly configuration using stream and http blocks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_20\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    # ...\n    # Configuration of an upstream server group\n    upstream appservers {\n        zone appservers 64k;\n        server appserv1.example.com:12345 weight=5;\n        server appserv2.example.com:12345 fail_timeout=5s;\n        server backup1.example.com:12345 backup;\n        server backup2.example.com:12345 backup;\n    }\n\n    server {\n        # Server that proxies connections to the upstream group\n        proxy_pass appservers;\n        health_check;\n    }\n}\nhttp {\n    # ...\n    server {\n        # Location for API requests\n        location /api {\n            limit_except GET {\n                auth_basic \"NGINX Plus API\";\n                auth_basic_user_file /path/to/passwd/file;\n            }\n            api write=on;\n            allow 127.0.0.1;\n            deny  all;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Describe NginxGateway resource\nDESCRIPTION: This command retrieves and displays the current configuration and status of the NginxGateway custom resource, which holds the NGINX Gateway Fabric control plane configuration. It uses `kubectl` to describe the resource in the `nginx-gateway` namespace. The resource name, `ngf-config`, may need to be adjusted based on the installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/control-plane-configuration.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n nginx-gateway describe nginxgateways ngf-config\n```\n\n----------------------------------------\n\nTITLE: Defining Key-Value Lookup in Nginx\nDESCRIPTION: This configuration defines how client IP addresses are evaluated against the key-value database.  The `keyval` directive looks up the client's IP address (`$remote_addr`) in the 'one' zone and sets the `$target` variable to the corresponding value (1 or 0).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n  # ...\n  keyval_zone zone=one:1m type=ip state=one.keyval;\n  keyval $remote_addr $target zone=one; # Client address is the key,\n                    # $target is the value;\n }\n```\n\n----------------------------------------\n\nTITLE: Set Gateway IP Environment Variable\nDESCRIPTION: This command sets the external IP address of the gateway service as an environment variable. This variable is used in the subsequent command to send traffic to the application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nexport GATEWAY_IP=<gateway external IP>\n```\n\n----------------------------------------\n\nTITLE: Loading NGINX App Protect WAF module\nDESCRIPTION: This snippet shows how to load the NGINX App Protect WAF module within the main NGINX context. This directive is essential to enable the WAF functionality in Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n```\n\n----------------------------------------\n\nTITLE: Ansible Playbook for NGINX Installation\nDESCRIPTION: This is an Ansible playbook that uses the nginxinc.nginx role to install NGINX on the localhost. The `become: true` directive allows the playbook to run with elevated privileges, and the `roles` section specifies the NGINX role to be used.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ec2-instances-for-nginx.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\n---\n- hosts: localhost\n  become: true\n  roles:\n    - role: nginxinc.nginx\n```\n\n----------------------------------------\n\nTITLE: Reloading NGINX Configuration via Service\nDESCRIPTION: Reloads the NGINX configuration using either `nginx -s reload` or `service nginx reload`. This applies the new configuration without interrupting service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_12\n\nLANGUAGE: none\nCODE:\n```\nroot# service nginx reload\n```\n\n----------------------------------------\n\nTITLE: Load GeoIP Modules in NGINX Configuration\nDESCRIPTION: These directives enable dynamic loading of the GeoIP modules within the 'main' context of the NGINX configuration file. The modules for both HTTP and Stream contexts are loaded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_geoip_module.so;\nload_module modules/ngx_stream_geoip_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configure SSL Verification in Nginx mgmt block\nDESCRIPTION: Configures the `mgmt` block in Nginx to enable SSL verification for usage reporting, specifically when using self-signed certificates.  The `ssl_trusted_certificate` directive specifies the path to the CA certificate file.  `ssl_verify on` enforces certificate validation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n    usage_report endpoint=<NGINX-INSTANCE-MANAGER-FQDN>;\n    ssl_verify on;\n    ssl_trusted_certificate <CA-CERT-FILE-FROM-NGINX-INSTANCE-MANAGER>;\n    ssl_name manager-server;\n}\n```\n\n----------------------------------------\n\nTITLE: Updating NGINX Amplify Agent on CentOS/Red Hat\nDESCRIPTION: This snippet updates the NGINX Amplify Agent on CentOS or Red Hat systems. It first refreshes the yum cache using `yum makecache` to ensure access to the latest package information and then updates the agent using `yum update nginx-amplify-agent`. This ensures the system has the most recent version of the Amplify Agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/updating-amplify-agent.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nyum makecache && \\\nyum update nginx-amplify-agent\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Group for Load Balancing Nginx\nDESCRIPTION: This snippet configures an upstream group named 'nodejs' containing two Node.js application servers listening on port 8080.  This group is used for load balancing between the two specified servers. The 'upstream' block defines the backend servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream nodejs {\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Monitor URI with Proxy Protocol in NGINX\nDESCRIPTION: This snippet shows configuring the monitor URI with proxy protocol enabled using the `app_protect_dos_monitor` directive. It includes specifying the protocol, timeout, and enabling proxy_protocol. The monitor URI specifies the endpoint used for monitoring, and the proxy protocol allows NGINX to pass client connection information to the upstream server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nlisten 443 ssl http2 proxy_protocol;\nserver_name serv;\n\nlocation / {\n    # Protected Object is defined here\n    # Note: Use proxy_protocol=on if the listen directive includes the \"proxy_protocol\" parameter.\n    app_protect_dos_monitor uri=https://serv:443/ protocol=http2 timeout=5 proxy_protocol=on;\n}\n\nlocation /abc {\n    # Protected Object is defined here\n    app_protect_dos_monitor uri=https://serv:443/abc protocol=http2 timeout=5 proxy_protocol;\n}\n```\n\n----------------------------------------\n\nTITLE: Virtual IP Address Exclusion (None)\nDESCRIPTION: This configuration shows how to exclude an IPv6 address from VRRP advertisements while still having Keepalived manage it. The IPv4 address is advertised via VRRP.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_14\n\nLANGUAGE: none\nCODE:\n```\nvrrp_instance VI_1 {\n    ...\n    unicast_src_ip 192.168.100.100\n\n    unicast_peer {\n        192.168.100.101\n    }\n\n    virtual_ipaddress {\n        192.168.100.150\n    }\n    ...\n\n    virtual_ipaddress_excluded {\n        1234:5678:9abc:def::1\n    }\n    ...\n}\n```\n\n----------------------------------------\n\nTITLE: Handling 404 Errors with a Custom Page in Nginx\nDESCRIPTION: This snippet demonstrates how to configure NGINX to return a custom 404 error page.  When a 404 error occurs, Nginx serves the `/404.html` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\nerror_page 404 /404.html;\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx configuration\nDESCRIPTION: This shell command reloads the Nginx configuration.  It applies any changes made to the configuration file without restarting Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/encrypted-session.md#_snippet_8\n\nLANGUAGE: Shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Installing Nginx njs Module (Debian/Ubuntu)\nDESCRIPTION: This command installs the NGINX JavaScript module (njs) on Debian and Ubuntu systems. njs is required for handling the interaction between NGINX Plus and the Identity Provider (IdP) in the SSO configuration. The command uses the apt package manager with sudo privileges to install the nginx-plus-module-njs package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/active-directory-federation-services.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\nsudo apt install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Create HTTPRoute resource for tea and soda redirect (YAML)\nDESCRIPTION: This YAML configuration defines two HTTPRoute resources: `tea-redirect` and `soda-redirect`. The `tea-redirect` route uses `ReplacePrefixMatch` to redirect requests from `/tea` to `/organic`. The `soda-redirect` route uses `ReplaceFullPath` to redirect requests from `/soda` to `/flavors`. The `parentRefs` points to gateway and hostname is set to `cafe.example.com`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_6\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: tea-redirect\nspec:\n  parentRefs:\n  - name: gateway\n    sectionName: http\n  hostnames:\n  - \"cafe.example.com\"\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /tea\n    filters:\n    - type: RequestRedirect\n      requestRedirect:\n        path:\n          type: ReplacePrefixMatch\n          replacePrefixMatch: /organic\n        port: 8080\n---\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: soda-redirect\nspec:\n  parentRefs:\n  - name: gateway\n    sectionName: http\n  hostnames:\n  - \"cafe.example.com\"\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /soda\n    filters:\n    - type: RequestRedirect\n      requestRedirect:\n        path:\n          type: ReplaceFullPath\n          replaceFullPath: /flavors\n        port: 8080\nEOF\n```\n\n----------------------------------------\n\nTITLE: Configure SSH access to peers - Generate SSH key pair\nDESCRIPTION: This snippet generates an SSH key pair for the root user on the primary node, then displays the public key. This key is used to configure passwordless SSH access to peer nodes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo ssh-keygen -t rsa -b 2048\nsudo cat /root/.ssh/id_rsa.pub\n\nssh-rsa AAAAB3Nz4rFgt...vgaD root@node1\n```\n\n----------------------------------------\n\nTITLE: Configuring Purge Method Variable in Nginx\nDESCRIPTION: This snippet configures a variable that depends on the $request_method variable to identify PURGE requests. A map is created to set the value of $purge_method to 1 if the request method is PURGE, and 0 otherwise. This allows to use PURGE requests to clear the cache.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    map $request_method $purge_method {\n        PURGE 1;\n        default 0;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create NGINXaaS Deployment with Managed Identity, Storage, Scaling (Azure CLI)\nDESCRIPTION: This command creates an NGINXaaS deployment with a managed identity, configures logging to a storage account, and sets scaling properties.  It specifies the deployment name, resource group, location, and SKU. The `network-profile` is configured with a subnet and public IP address. The `identity` parameter sets a UserAssigned managed identity. Logging is configured to a specified storage account and container. Scaling is configured using the `scaling-properties` parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/create-deployment/deploy-azure-cli.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment create --deployment-name myDeployment --resource-group \\\n      myResourceGroup --location eastus2 --sku name=standardv2_Monthly \\\n      --network-profile \\\n      network-interface-configuration='{subnet-id:/subscriptions/subscriptionId/resourcegroups/myResourceGroup/providers/Microsoft.Network/virtualNetworks/vnet-azclitest/subnets/mySubnet}' \\\n      front-end-ip-configuration='{public-ip-addresses:[{id:/subscriptions/subscriptionId/resourceGroups/myResourceGroup/providers/Microsoft.Network/publicIPAddresses/myPublicIP}]}' \\\n      --identity '{\"type\":\"UserAssigned\",\"userAssignedIdentities\":{\"/subscriptions/subscriptionId/resourcegroups/myResourceGroup/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myManagedIdentity\":{}}}' \\\n      --logging storage-account='{\"account-name\":\"myStorageAccount\",\"container-name\":\"myContainer\"}' \\\n      --scaling-properties capacity=10\n```\n\n----------------------------------------\n\nTITLE: Publish gRPC API Proxy with Service-Level Routing (JSON)\nDESCRIPTION: This JSON payload defines a gRPC API proxy configuration with service-level routing for NGINX Management Suite API Connectivity Manager.  The `grpcIngress` service is set to \"helloworld.Greeter\", enabling routing based on the specific gRPC service. The configuration also specifies backend details similar to the package-level routing example.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/services/publish-gRPC-proxy.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"dev-grpc-hello\",\n    \"version\": \"v1\",\n    \"proxyConfig\": {\n        \"hostname\": \"example.com\",\n        \"grpcIngress\": {\n            \"service\": \"helloworld.Greeter\"\n        },\n        \"backends\": [\n          {\n            \"serviceName\": \"hello-grpc-service-name\",\n            \"serviceTargets\": [\n                {\n                    \"hostname\": \"grpc-backend.example.com\",\n                    \"listener\": {\n                        \"enableTLS\": false,\n                        \"port\": 50051,\n                        \"transportProtocol\": \"GRPC\"\n                    }\n                }\n            ]\n          }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Check ClickHouse Version (Shell)\nDESCRIPTION: Retrieves and displays the version of the ClickHouse server. This command helps ensure compatibility with backup and restore functionalities.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_20\n\nLANGUAGE: shell\nCODE:\n```\nclickhouse-server --version\n```\n\n----------------------------------------\n\nTITLE: Enabling Connection Caching for Health Checks in Nginx Plus\nDESCRIPTION: This snippet enables connection caching (keepalive) for health checks to the backend.  It sets the `interval` to 1 second and the `keepalive_time` to 60 seconds.  This allows connections to be reused for health check probes, avoiding the full TLS handshake on every check if using TLS upstreams.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-health-check.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    proxy_http_version 1.1;\n    proxy_set_header   Connection \"\";\n    proxy_pass         https://backend;\n    health_check       interval=1 keepalive_time=60s;\n}\n```\n\n----------------------------------------\n\nTITLE: Enable App Security WAF Monitor-Only Mode (JSON)\nDESCRIPTION: This JSON payload is used to enable monitor-only mode for the App Security WAF policy.  When enabled, traffic is allowed to pass, but security events are still generated and metrics are collected.  A POST or PUT request should be sent to the Components endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/set-waf-monitor-mode.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"metadata\": {...},\n  \"desiredState\": {\n    \"ingress\": {...},\n    \"security\": {\n       \"strategyRef\": {\n         \"ref\": \"/security/strategies/policyName\"\n       },\n       \"waf\": {\n            \"isEnabled\": true,\n            \"isMonitorOnly\": true\n        }\n    },\n    \"backend\": {...},\n    \"logging\": {...}\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: HTTPRoute Traffic Splitting - YAML\nDESCRIPTION: This YAML snippet configures traffic splitting between two backend services (old and new versions of an application). The `weight` parameter in the `backendRefs` section determines the proportion of traffic directed to each service, enabling canary releases or A/B testing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/upgrade-apps-without-downtime.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\n- matches:\n    - path:\n        type: PathPrefix\n        value: /\n  backendRefs:\n    - name: my-app-old\n      port: 80\n      weight: 95\n    - name: my-app-new\n      port: 80\n      weight: 5\n```\n\n----------------------------------------\n\nTITLE: Enabling JWT Authentication in Nginx\nDESCRIPTION: This snippet demonstrates how to enable JWT authentication for a specific location in Nginx. It uses the `auth_jwt` directive to specify the authentication realm (API).  Requests to `/products/` will require a valid JWT.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80;\n\n    location /products/ {\n        proxy_pass http://api_server;\n        auth_jwt   \"API\";\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuration Error Log Event JSON\nDESCRIPTION: This JSON object represents an error during the configuration loading process, specifically related to an invalid directive in the `nginx.conf` file.  The log level is Error. This event is generated only on configuration reload.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/operation-logs.md#_snippet_5\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"event\": \"configuration_error\",\n    \"error_message\": \"unknown argument\",\n    \"line_number\": 58\n}\n```\n\n----------------------------------------\n\nTITLE: Proxying to a Single Server in NGINX Stream\nDESCRIPTION: This configuration demonstrates proxying traffic to a single server identified by hostname, which resolves to multiple IP addresses.  NGINX will load balance traffic across these IP addresses using the Round Robin algorithm.  The server's port number must be specified in the `proxy_pass` directive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    # ...\n    server {\n        listen     12345;\n        proxy_pass backend.example.com:12345;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Gzip Compression in NGINX\nDESCRIPTION: This snippet enables gzip compression for all responses.  It adds considerable processing overhead, potentially affecting performance. NGINX performs compression before sending responses to clients, but does not \"double compress\" responses that are already compressed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/compression.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\ngzip on;\n```\n\n----------------------------------------\n\nTITLE: Configure Enforcer Address in NGINX\nDESCRIPTION: This snippet shows how to configure the Enforcer address within the `http` context of the NGINX configuration. The Enforcer address specifies the location where NGINX App Protect WAF will communicate to enforce security policies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enforcer_address 127.0.0.1:50000;\n```\n\n----------------------------------------\n\nTITLE: Configuring Negative Conditions in Health Check in Nginx\nDESCRIPTION: This snippet demonstrates how to use the exclamation point (!) to define conditions that a response must *not* have to pass the health check. The `not_redirect` match block checks that the status code is not one of 301, 302, 303, or 307, and that the Refresh header is absent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-health-check.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nmatch not_redirect {\n    status ! 301-303 307;\n    header ! Refresh;\n}\n```\n\n----------------------------------------\n\nTITLE: Adding API Key Authentication Policy via REST API in NGINX ACM\nDESCRIPTION: This snippet demonstrates how to add an API key authentication policy to an API Proxy in NGINX Management Suite API Connectivity Manager using a POST request. The configuration includes specifying the API key name, where the key is supplied (header), credential forwarding settings, error return codes for invalid or missing keys, and client-specific API keys.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/apikey-authn.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n\t\"policies\": {\n\t\t\"apikey-authn\": [\n\t\t\t{\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"apiKeyName\": \"apikey\",\n\t\t\t\t\t\"suppliedIn\": \"header\",\n\t\t\t\t\t\"credentialForward\": false,\n\t\t\t\t\t\"errorReturnConditions\": {\n\t\t\t\t\t\t\"notSupplied\": {\n\t\t\t\t\t\t\t\"returnCode\": 401\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"noMatch\": {\n\t\t\t\t\t\t\t\"returnCode\": 403\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"data\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"clientID\": \"clientA\",\n\t\t\t\t\t\t\"apiKey\": \"<api key>\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"clientID\": \"clientB\"\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t]\n\t}\n}\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration - Bash\nDESCRIPTION: Reloads the Nginx configuration using the `service nginx reload` command. This command applies the changes made to the Nginx configuration without interrupting service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-metrics-collection.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nservice nginx reload\n```\n\n----------------------------------------\n\nTITLE: Limiting Request Rate in a Nginx Location Block\nDESCRIPTION: This configuration limits the request rate to 1 request per second within the `/search/` location. It utilizes the previously defined 'one' zone to track and enforce the rate limit.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n\n    limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;\n\n    server {\n        #...\n\n        location /search/ {\n            limit_req zone=one;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling SSL Session Tickets\nDESCRIPTION: This snippet shows how to enable SSL session tickets.  Setting `ssl_session_tickets` to `on` stores session information on the client side, eliminating the need for a server-side cache.  When a client resumes a session, it presents the ticket, avoiding renegotiation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-tcp.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    #...\n    ssl_session_tickets on;\n}\n```\n\n----------------------------------------\n\nTITLE: Defining Protected Object Name in NGINX\nDESCRIPTION: This snippet demonstrates how to define a custom name for a protected object using the `app_protect_dos_name` directive. This name helps to identify the protected object in logs. The directive is optional and can be defined within `location`, `server`, or `http` blocks. If omitted, a name will be automatically generated.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_dos_name po-example;\n```\n\n----------------------------------------\n\nTITLE: Update NGINX Certificate Paths and Key Vault - Azure CLI\nDESCRIPTION: This example updates an NGINX certificate's virtual path, key virtual path, and key vault secret using the Azure CLI. This command assumes that a certificate with the name `myCertificate` already exists in the `myDeployment` deployment under the resource group `myResourceGroup`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-azure-cli.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment certificate update --certificate-name myCertificate \\\n      --deployment-name myDeployment --resource-group myResourceGroup \\\n      --certificate-path /etc/nginx/testupdated.cert \\\n      --key-path /etc/nginx/testupdated.key \\\n      --key-vault-secret-id newKeyVaultSecretId\n```\n\n----------------------------------------\n\nTITLE: Removing or Commenting Out ip_hash Directive - Nginx\nDESCRIPTION: This snippet shows how to remove or comment out the `ip_hash` directive in the upstream block, which is a prerequisite for using sticky cookies for session persistence.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_29\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream nodejs {\n    #ip_hash;\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Server Block for OIDC\nDESCRIPTION: This snippet configures a server block in NGINX to listen on port 443 with SSL enabled. It sets the server name, SSL certificates, and defines a location block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/cognito.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n\n    # ...\n\n    server {\n        listen      443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate     /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n\n            # ...\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Change API Key in NGINX Controller Agent\nDESCRIPTION: This code snippet shows how to update the API key within the NGINX Controller Agent's configuration file (`agent.conf`). The API key is used for authentication and communication with the NGINX Controller.  It requires editing the `agent.conf` file and replacing `YOUR_API_KEY` with the new key. Restarting the agent is required for the changes to take effect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-the-agent.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\n[credentials]\napi_key = YOUR_API_KEY\n```\n\n----------------------------------------\n\nTITLE: Configuring Cache Loader in Nginx\nDESCRIPTION: This snippet configures the cache loader with iterative loading to avoid performance slowdown during Nginx startup. It sets the duration of an iteration, the maximum number of items loaded per iteration, and the delay between iterations. This allows Nginx to load cached metadata more gradually.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /data/nginx/cache keys_zone=mycache:10m loader_threshold=300 loader_files=200;\n```\n\n----------------------------------------\n\nTITLE: Configure Enforcer Address\nDESCRIPTION: Configures the address for the NGINX App Protect Enforcer within the HTTP context. This setting specifies the endpoint where NGINX will communicate with the Enforcer to make WAF decisions. The address should match the Enforcer's listening address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enforcer_address 127.0.0.1:50000;\n```\n\n----------------------------------------\n\nTITLE: Testing API Gateway Configuration with Curl\nDESCRIPTION: This curl command is used to test the API Gateway configuration. It sends an HTTP GET request to a specified endpoint, bypassing SSL certificate verification with the -k option. The target URL is constructed using the gateway proxy hostname, version, and basepath to ensure the request is routed correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/publish-api-proxy.md#_snippet_6\n\nLANGUAGE: Bash\nCODE:\n```\ncurl -k -X GET \"https://gateway-proxy-hostname/version/basepath\"\n```\n\n----------------------------------------\n\nTITLE: Setting the $prom_keyval Variable in Nginx\nDESCRIPTION: This snippet sets the `$prom_keyval` variable within a specific location block.  The `$prom_keyval` variable is used to correctly show statistics for dynamic configuration of upstream routing.  It is assigned the name of the key-value storage zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nset $prom_keyval \"upstream_keyval\";\n```\n\n----------------------------------------\n\nTITLE: Implementing Server Slow-Start in NGINX Plus\nDESCRIPTION: This snippet demonstrates how to use the `slow_start` parameter in NGINX Plus to gradually increase the traffic to a recovered server. `backend1.example.com` will slowly ramp up its traffic over 30 seconds after recovery, preventing it from being overwhelmed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    server backend1.example.com slow_start=30s;\n    server backend2.example.com;\n    server 192.0.0.1 backup;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Enforcer Address\nDESCRIPTION: This snippet configures the Enforcer address in the `http` context of the NGINX configuration. The `app_protect_enforcer_address` directive specifies the address where the NGINX App Protect WAF enforcer is listening for connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enforcer_address 127.0.0.1:50000;\n```\n\n----------------------------------------\n\nTITLE: Pulling NGINX Plus with NGINX Agent image\nDESCRIPTION: This command pulls the NGINX Plus image bundled with the NGINX Agent from the private NGINX registry. The <version-tag> should be replaced with the desired version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ndocker pull private-registry.nginx.com/nginx-plus/agent:<version-tag>\n```\n\n----------------------------------------\n\nTITLE: Restricting Access using Allow and Deny directives (Server block)\nDESCRIPTION: This configuration uses the `allow` and `deny` directives to restrict access to a specific network. Only clients from the 10.0.0.0/8 network are allowed, while all other clients are denied access. This is usually defined within a `location` block, inside the `server` block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_39\n\nLANGUAGE: nginx\nCODE:\n```\nallow 10.0.0.0/8;\ndeny all;\n```\n\n----------------------------------------\n\nTITLE: Configuring SSL Termination in Nginx\nDESCRIPTION: This code snippet demonstrates how to configure SSL termination for NGINX Instance Manager within an NGINX configuration file. It includes settings for listening on port 443 with SSL, enabling HTTP/2, specifying SSL protocols and ciphers, setting up session caching, and defining the paths to the SSL certificate, key, and client certificate. These directives ensure secure communication between clients and the NGINX Instance Manager server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\n# Main external HTTPS server, needs port 443\nserver {\n    listen 443 ssl;\n    http2  on;\n    root   /var/www/nms;\n\n    server_name _;\n\n    ssl_protocols       TLSv1.1 TLSv1.2;\n    ssl_ciphers         HIGH:!aNULL:!MD5;\n    ssl_session_cache   shared:SSL:10m;\n    ssl_session_timeout 10m;\n\n    ssl_certificate         /etc/nms/certs/manager-server.pem;\n    ssl_certificate_key     /etc/nms/certs/manager-server.key;\n    ssl_client_certificate  /etc/nms/certs/ca.pem;\n}\n```\n\n----------------------------------------\n\nTITLE: Using curl with JWT Authentication\nDESCRIPTION: This code snippet demonstrates how to make a GET request to the NGINX Instance Manager API using curl with a JSON Web Token (JWT) for authentication. The JWT is passed in the Authorization header as a Bearer token. Ensure that `<NIM_FQDN>` is replaced with the fully qualified domain name of the NGINX Instance Manager instance and `<API_VERSION>` is replaced with the API version you want to use, and `<access token>` is replaced with the actual JWT.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/fundamentals/api-overview.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET \"https://<NIM_FQDN>/api/platform/<API_VERSION>/systems\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Restart Nginx (Shell)\nDESCRIPTION: This snippet restarts the Nginx service to apply the configuration changes made. It uses `sudo systemctl restart nginx` to ensure the service is restarted with the necessary permissions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/set-up-app-protect-instances.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Creating Access Control Rule in Nginx\nDESCRIPTION: This configuration creates a rule that either allows or denies access depending on the client IP address and the value of the `$target` variable.  If `$target` is 1 (denylisted), the server returns a 403 Forbidden error.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nif ($target) {\n  return 403;\n }\n```\n\n----------------------------------------\n\nTITLE: NGINX Upstream Configuration\nDESCRIPTION: Configures an NGINX upstream server block to point to the private endpoint's IP address on a specific port (e.g., 8000).  This ensures traffic is routed through the private endpoint to the upstream server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/private-link-to-upstreams.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nupstream {\n    server <private endpoint IP address>:8000;\n}\n```\n\n----------------------------------------\n\nTITLE: Setting Session Timeout\nDESCRIPTION: This snippet shows how to increase the session lifetime using the `ssl_session_timeout` directive. The default session lifetime is 5 minutes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nworker_processes auto;\n\n    mail {\n        #...\n        ssl_session_cache   shared:SSL:10m;\n        ssl_session_timeout 10m;\n        #...\n    }\n```\n\n----------------------------------------\n\nTITLE: Apply configurations for OpenTelemetry Collector and Jaeger\nDESCRIPTION: Applies the configurations defined in 'otel-collector.yaml' and 'jaeger.yaml' to deploy the OpenTelemetry Collector and Jaeger within the 'tracing' namespace. This step installs the necessary components for collecting and visualizing traces.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f otel-collector.yaml -f jaeger.yaml -n tracing\n```\n\n----------------------------------------\n\nTITLE: Setting Up Mainline NGINX Repository on Ubuntu\nDESCRIPTION: This command adds the official NGINX mainline repository to the apt sources list, enabling the system to install and update NGINX packages from the official mainline source.  It's similar to adding the stable repository but points to the `mainline` directory. It uses echo to create a deb line with the repository URL and then uses tee to append it to the nginx.list file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_25\n\nLANGUAGE: shell\nCODE:\n```\necho \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n    http://nginx.org/packages/mainline/ubuntu `lsb_release -cs` nginx\" \\\n        | sudo tee /etc/apt/sources.list.d/nginx.list\n```\n\n----------------------------------------\n\nTITLE: Policy Converter Usage Arguments\nDESCRIPTION: Describes the required and optional arguments for the Policy Converter tool, including input and output file paths, output format, and options for including the full configuration or a full export.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nRequired arguments:\n    --outfile|o='/path/to/policy.json'\n        File name for where to write exported policy.\n        Can also be set via an environment variable: EXPORT_FILE\n    --infile|i='/path/to/policy.xml'\n        Advanced WAF/ASM Security Policy file to convert\n        Can also be set via an environment variable: IMPORT_FILE\n\nOptional arguments:\n    --format|f='json'\n        Desired output format for signature file. Default 'json'\n        Supported formats: 'json'\n    --keep-full-configuration\n        By default the exported policy will only contain elements that are valid for the environment in which this tool is run.\n        If keep-full-configuration is enabled then the full configuration is retained, including elements that are not supported in NGINX App Protect WAF.\n    --full-export\n        By default the exported policy will only contain elements that are different from the default policy template.\n        If full-export is enabled then all policy elements are included in the export file.\n        When this option is selected, no warnings are generated when removing unsupported elements from the exported policy.\n\nOptionally, using --help will issue this help message.\n```\n\n----------------------------------------\n\nTITLE: Installing nginx-sync on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This command installs the nginx-sync package on Amazon Linux 2023, AlmaLinux, and Rocky Linux systems using the dnf package manager. The sudo command is used to execute the command with administrative privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf install nginx-sync\n```\n\n----------------------------------------\n\nTITLE: Require Base64 Decoding in NGINX App Protect Policy (JSON)\nDESCRIPTION: This JSON snippet configures an NGINX App Protect policy to require Base64 decoding for specific cookies, parameters, and headers. The `decodeValueAsBase64` property is set to `required` for these entities, and a violation is raised if the value is not Base64 decodable. Additionally, it defines a blocking setting for the `VIOL_PARAMETER_VALUE_BASE64` violation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/detect-base64.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"detect_base64\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_PARAMETER_VALUE_BASE64\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n\n        \"cookies\": [\n            {\n                \"name\": \"mySession\",\n                \"type\": \"explicit\",\n                \"decodeValueAsBase64\": \"required\"\n            }\n        ],\n        \"parameters\": [\n            {\n                \"name\": \"myId\",\n                \"type\": \"explicit\",\n                \"decodeValueAsBase64\": \"required\"\n            }\n        ],\n        \"headers\": [\n            {\n                \"name\": \"My-Header\",\n                \"type\": \"explicit\",\n                \"decodeValueAsBase64\": \"required\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Plus Repository File - Shell\nDESCRIPTION: Downloads the NGINX Plus repository file to the /etc/yum.repos.d directory using wget. The sudo command is used to execute the command with administrative privileges. This allows the system to access the NGINX Plus repository for package installations and updates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-amazon.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/plus-amazonlinux2023.repo\n```\n\n----------------------------------------\n\nTITLE: Verbose Custom Formatted Message\nDESCRIPTION: This JSON configuration defines a verbose custom format string for logging illegal requests. It includes request ID, method, URI, date and time, client IP, and violations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/security-log.md#_snippet_6\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filter\": {\n        \"request_type\": \"illegal\"\n    },\n    \"content\": {\n        \"format\": \"user-defined\",\n        \"format_string\": \"Request ID %support_id%: %method% %uri% received on %date_time% from IP %ip_client% had the following violations: %violations%\",\n        \"max_request_size\": \"2k\",\n        \"max_message_size\": \"5k\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install Specific NGINX App Protect WAF version - Ubuntu\nDESCRIPTION: These commands install a specific version of the NGINX App Protect WAF module on Ubuntu. The `apt-cache policy` command is used to find available versions, and then `apt-get install` is used to install a specific version of the `app-protect` package, specifying the exact version number.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_37\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-cache policy app-protect | grep 25+\nsudo apt-get install app-protect=25+3.671.0-1~bionic\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration for Serving Static Content\nDESCRIPTION: This Nginx configuration sets up a simple web server that listens on port 80 and serves static content from the `/srv` directory.  It configures the root directory and sets `index.html` as the default index file. This configuration is required to tell Nginx where to find and how to serve the static files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/hosting-static-content.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n\tserver {\n\t\tlisten 80;\n\t\tlocation / {\n\t\t\troot /srv;\n\t\t\tindex index.html;\n\t\t}\n\t}\n}\n```\n\n----------------------------------------\n\nTITLE: Defining HTTPRoute for Secure Application\nDESCRIPTION: This snippet defines an HTTPRoute in Kubernetes to route traffic to the secure-app backend service. The HTTPRoute matches traffic with the hostname 'secure-app.example.com' and the path prefix '/'. It then forwards the traffic to the 'secure-app' service on port 8443.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/securing-backend-traffic.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: secure-app\nspec:\n  parentRefs:\n  - name: gateway\n    sectionName: http\n  hostnames:\n  - \"secure-app.example.com\"\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /\n    backendRefs:\n    - name: secure-app\n      port: 8443\nEOF\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration\nDESCRIPTION: This shell command gracefully reloads the Nginx configuration without interrupting traffic. It applies the new configuration changes, including the enabled OpenTracing module, to the running Nginx instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentracing.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Modifying Server Parameter via API Shell\nDESCRIPTION: This snippet shows how to modify a parameter (e.g., `down`) for a specific server in an upstream group using a `PATCH` request to the NGINX Plus API. The `curl` command sends the parameter to be modified as JSON data to the specified server index.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_23\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X PATCH -d '{ \"down\": true }' -s 'http://127.0.0.1/api/9/http/upstreams/appservers/servers/0'\n```\n\n----------------------------------------\n\nTITLE: Configure Test Application Server Block\nDESCRIPTION: This snippet configures a simple test application server block that listens on port 8080. It returns a 200 OK response with the authenticated user's full name and email, which are obtained from the HTTP headers passed by NGINX. This verifies if OIDC authentication and claim passing is successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-oidc.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nserver {\n    listen 8080;\n\n    location / {\n        return 200 \"Hello, $http_name!\\nEmail: $http_email\\nIdP sub sub: $http_sub\\n\";\n        default_type text/plain;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Convert XML Policy to JSON\nDESCRIPTION: This snippet demonstrates how to convert an XML policy to a JSON policy using the `convert-policy` tool, piping the output to `jq` for formatted output.  `jq` needs to be installed separately.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/convert-policy -i /path/to/policy.xml -o /path/to/policy.json | jq\n```\n\n----------------------------------------\n\nTITLE: Limiting Bandwidth - Nginx\nDESCRIPTION: This snippet demonstrates how to limit the download and upload bandwidth for TCP connections using the `proxy_download_rate` and `proxy_upload_rate` directives. It sets the maximum download speed to 100 kilobytes per second and the maximum upload speed to 50 kilobytes per second. These settings apply per connection.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-tcp.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    #...\n    proxy_download_rate 100k;\n    proxy_upload_rate   50k;\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Accelerated Mitigation - Nginx\nDESCRIPTION: This snippet illustrates how to enable App Protect DoS L4 accelerated mitigation using the `app_protect_dos_accelerated_mitigation` directive. It demonstrates enabling the `syn_drop` mode which drops SYN packets from detected bad actors and requires the eBPF package to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_19\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_dos_accelerated_mitigation on syn_drop=on;\n```\n\n----------------------------------------\n\nTITLE: Installing Encrypted Session module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This shell script updates the package manager and installs the `nginx-plus-module-encrypted-session` package using dnf.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/encrypted-session.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-encrypted-session\n```\n\n----------------------------------------\n\nTITLE: Inline JSON Schema in NGINX App Protect Policy (JSON)\nDESCRIPTION: This policy snippet demonstrates how to embed a JSON schema directly within an NGINX App Protect policy. The schema is included in the `json-validation-files` array, and the `json-profiles` section associates the schema with a specific profile used for URL validation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/handling-xml-and-json-content.md#_snippet_3\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"json_form_policy_inline_schema\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"json-validation-files\": [\n            {\n                \"fileName\": \"person_schema.json\",\n                \"contents\": \"{\\r\\n \\\"$schema\\\": \\\"http://json-schema.org/draft-07/schema#\\\",\\r\\n \\\"title\\\": \\\"Person\\\",\\r\\n \\\"type\\\": \\\"object\\\",\\r\\n \\\"properties\\\": {\\r\\n \\\"firstName\\\": {\\r\\n \\\"type\\\": \\\"string\\\",\\r\\n \\\"description\\\": \\\"The person's first name.\\\"\\r\\n },\\r\\n \\\"lastName\\\": {\\r\\n \\\"type\\\": \\\"string\\\",\\r\\n \\\"description\\\": \\\"The person's last name.\\\"\\r\\n },\\r\\n \\\"age\\\": {\\r\\n \\\"description\\\": \\\"Age in years which must be equal to or greater than zero.\\\",\\r\\n \\\"type\\\": \\\"integer\\\",\\r\\n \\\"minimum\\\": 0\\r\\n }\\r\\n }\\r\\n}\"\n            }\n        ],\n        \"json-profiles\": [\n            {\n                \"name\": \"reg_form_prof\",\n                \"defenseAttributes\": {\n                    \"maximumArrayLength\": \"any\",\n                    \"maximumStructureDepth\": \"any\",\n                    \"maximumTotalLengthOfJSONData\": 1000,\n                    \"maximumValueLength\": \"any\",\n                    \"tolerateJSONParsingWarnings\": false\n                },\n                \"validationFiles\": [\n                    {\n                        \"isPrimary\": true,\n                        \"jsonValidationFile\": {\n                            \"fileName\": \"person_schema.json\"\n                        }\n                    }\n                ]\n            }\n        ],\n        \"urls\": [\n            {\n                \"name\": \"/register\",\n                \"type\": \"explicit\",\n                \"method\": \"POST\",\n                \"attackSignaturesCheck\": true,\n                \"clickjackingProtection\": false,\n                \"disallowFileUploadOfExecutables\": false,\n                \"isAllowed\": true,\n                \"mandatoryBody\": false,\n                \"methodsOverrideOnUrlCheck\": false,\n                \"urlContentProfiles\": [\n                    {\n                        \"contentProfile\": {\n                            \"name\": \"reg_form_prof\"\n                        },\n                        \"headerName\": \"*\",\n                        \"headerOrder\": \"default\",\n                        \"headerValue\": \"*\",\n                        \"type\": \"json\"\n                    }\n                ]\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Nginx as Reverse Proxy\nDESCRIPTION: This Nginx configuration sets up a reverse proxy that listens on port 80 and forwards all requests to the demo application running on localhost:8085. It also sets the Host header to the value of the incoming request's Host header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80;\n    location / {\n        proxy_pass http://localhost:8085;\n        proxy_set_header Host $host;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enable OpenTracing Module Loading in Nginx\nDESCRIPTION: This Nginx configuration snippet demonstrates how to enable the OpenTracing module dynamically by using the `load_module` directive within the main context of the Nginx configuration. This allows Nginx to load the OpenTracing module at runtime.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentracing.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_opentracing_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Gateway Fabric with Helm\nDESCRIPTION: This command installs NGINX Gateway Fabric using the Helm package manager. It pulls the nginx-gateway-fabric chart from the ghcr.io registry, creates the nginx-gateway namespace, installs the chart with the name `ngf` in that namespace, and disables service creation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nhelm install ngf oci://ghcr.io/nginx/charts/nginx-gateway-fabric --create-namespace -n nginx-gateway --set service.create=false\n```\n\n----------------------------------------\n\nTITLE: HTTPS Server Configuration\nDESCRIPTION: This snippet configures an HTTPS server block, including SSL settings, HTTP/2, and proxy configurations for a WebLogic application. It defines locations for load balancing, redirects, and WebSocket proxying, setting appropriate headers for WebSocket connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_28\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 443 ssl;\n    http2  on;\n\n    server_name example.com;\n\n    ssl_certificate     /etc/nginx/ssl/certificate-name;\n    ssl_certificate_key /etc/nginx/ssl/private-key;\n    ssl_session_cache shared:SSL:1m;\n    ssl_prefer_server_ciphers on;\n\n    # Load balance requests for '/weblogic-app/' across WebLogic Server\n    # application servers\n    location /weblogic-app/ {\n        proxy_pass http://weblogic;\n        proxy_cache backcache;\n    }\n\n    # Return a temporary redirect to '/weblogic-app/' when user requests '/'\n    location = / {\n        return 302 /weblogic-app/;\n    }\n\n    # WebSocket configuration\n    location /wstunnel/ {\n        proxy_pass https://weblogic;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect WAF Policy (JSON)\nDESCRIPTION: This JSON snippet represents an NGINX App Protect WAF policy that can be uploaded to NGINX Controller.  It defines various security settings, including signatures, headers, cookies, and parameters. Requires an HTTP client like cURL to send a PUT request to the Security Policy REST API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/add-app-security-with-waf.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"metadata\": {\n    \"name\": \"yourPolicyName\",\n    \"displayName\": \"App Protect Policy\",\n    \"description\": \"my special NAP policy\",\n    \"tags\": [\"test1\", \"test2\"]\n  },\n  \"desiredState\": {\n    \"content\": {\"policy\": {\"name\": \"/Common/yourPolicyName\", \"template\": {\"name\": \"POLICY_TEMPLATE_NGINX_BASE\"}, \"applicationLanguage\": \"utf-8\", \"enforcementMode\": \"blocking\", \"signatures\": [{\"signatureId\": 123458888, \"enabled\": false}, {\"signatureId\": 200000098, \"enabled\": false}, {\"signatureId\": 200001475, \"enabled\": false}, {\"signatureId\": 200002595, \"enabled\": false}], \"bot-defense\": {\"settings\": {\"isEnabled\": false}}, \"headers\": [{\"name\": \"*\", \"type\": \"wildcard\", \"decodeValueAsBase64\": \"disabled\"}, {\"name\": \"*-bin\", \"type\": \"wildcard\", \"decodeValueAsBase64\": \"required\"}, {\"name\": \"Referer\", \"type\": \"explicit\", \"decodeValueAsBase64\": \"disabled\"}, {\"name\": \"Authorization\", \"type\": \"explicit\", \"decodeValueAsBase64\": \"disabled\"}, {\"name\": \"Transfer-Encoding\", \"type\": \"explicit\", \"decodeValueAsBase64\": \"disabled\"}], \"cookies\": [{\"name\": \"*\", \"type\": \"wildcard\", \"decodeValueAsBase64\": \"disabled\"}], \"parameters\": [{\"name\": \"*\", \"type\": \"wildcard\", \"decodeValueAsBase64\": \"disabled\"}]}}\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Log Illegal Requests in Key-Value Format\nDESCRIPTION: This JSON configuration logs illegal requests in a custom key-value format.  It defines a custom format string including client IP, port, request details, violations, and signature IDs. It also sets size limits for the request and message.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/security-log.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filter\": {\n        \"request_type\": \"illegal\"\n    },\n    \"content\": {\n        \"format\": \"user-defined\",\n        \"format_string\": \"client_ip=%ip_client%,client_port=%src_port%,request=%request%,violations=%violations%,signature_ids=%sig_ids%\",\n        \"max_request_size\": 2000,\n        \"max_message_size\": \"5k\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure OpenID Connect with configure.sh\nDESCRIPTION: This bash command executes the configure.sh script from the nginx-openid-connect repository. It updates the NGINX configuration files with the specific values from your Auth0 application, such as client ID, client secret, and OpenID configuration URL. The --auth_jwt_key parameter configures the key for JWT authentication. Replace <example>.us.auth0.com with the actual domain of your Auth0 tenant.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/auth0.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\n./nginx-openid-connect/configure.sh \\\n    --auth_jwt_key request \\\n    --client_id Nhotzxx...IERmUi \\\n    --client_secret 6ZHd0j_r...UtDZ5bkdu \\\n    https://<example>.us.auth0.com/.well-known/openid-configuration\n```\n\n----------------------------------------\n\nTITLE: Configure Disk Upstream Authority with Bundle in YAML\nDESCRIPTION: This YAML configures SPIRE to use a root CA stored on disk for production. It specifies paths to an intermediate certificate and key, as well as a bundle containing the root CA certificate. This improves security by not directly using the root CA key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/secure-traffic-mtls.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: \"v1\"\nupstreamAuthority: \"disk\"\nconfig:\n    cert_file_path: \"/path/to/intermediateCA.crt\"\n    key_file_path: \"/path/to/intermediateCA.key\"\n    bundle_file_path: \"/path/to/rootCA.crt\"\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Gateway Fabric (NodePort)\nDESCRIPTION: This command deploys NGINX Gateway Fabric with NGINX OSS using a Service type of `NodePort`. It relies on a specific deployment manifest from the nginx-gateway-fabric repository tailored for NodePort configurations. It uses `kubectl apply` to apply the configurations defined in the remote YAML file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/deploy/nodeport/deploy.yaml\n```\n\n----------------------------------------\n\nTITLE: Configuring IP address-based ACLs in NGINX\nDESCRIPTION: This snippet configures IP address-based access control lists (ACLs) to restrict access to the NGINX Plus dashboard. It allows access from a specified network (10.0.0.0/8 in this example) and denies access from all other networks.  Uncommenting and adapting 'allow' and 'deny' directives is necessary within the server configuration block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_30\n\nLANGUAGE: nginx\nCODE:\n```\nallow 10.0.0.0/8;\ndeny all;\n```\n\n----------------------------------------\n\nTITLE: Modifying plus_package.rb for HA Setup (Ruby)\nDESCRIPTION: This snippet modifies the `plus_package.rb` recipe to include package and configuration templates for the NGINX Plus HA solution. It looks up the IP address of the eth1 interface, finds the other HA node using Chef's search, installs the nginx-ha-keepalived package, registers the keepalived service, and generates the keepalived.conf configuration file as a template.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_0\n\nLANGUAGE: ruby\nCODE:\n```\nif node['nginx']['enable_ha_mode'] == 'true'\n\n  ha_pair_ips = Array.new\n\n  origip = \"#{node[:network][:interfaces][:eth1][:addresses].detect{|k,v| v[:family] == 'inet'}.first}\"\n\n  # The code for finding the IP address of the eth0 interface\n\n  # follows, commented out.\n\n  #origip = \"#{node[:ipaddress]}\"\n\n  #search(:node, \"role:nginx_plus_ha\") do |nodes|\n\n  #  ha_pair_ips << nodes[\"ipaddress\"]\n  #end\n  # This is a workaround for getting the IP address for the eth1\n  # that VMs need\n  search(:node, \"role:nginx_plus_ha AND enable_ha_mode:true NOT name:#{node.name}\") do |nodes|\n    nodes[\"network\"][\"interfaces\"][\"eth1\"][\"addresses\"].each_pair do |address,value|\n      ha_pair_ips << address if value.has_key?(\"broadcast\")\n    end\n  end\n\n  package 'nginx-ha-keepalived' do\n    action :install\n  end\n\n  service 'keepalived' do\n    supports :status => true, :restart => true, :reload => true\n\n    action   :enable\n\n  end\n\n  template '/etc/keepalived/keepalived.conf' do\n\n    source 'nginx_plus_keepalived.conf.erb'\n\n    owner 'root'\n\n    group node['root_group']\n\n    mode '0644'\n\n    variables(\n\n              :myip => origip,\n\n              :ha_pair_ip => ha_pair_ips\n\n             )\n\n    notifies :reload, 'service[keepalived]', :delayed\n\n  end\n\nend\n```\n\n----------------------------------------\n\nTITLE: Send Traffic to Coffee v2 with Header\nDESCRIPTION: Sends a request to the coffee application with a custom 'version' header. This request is routed to the `coffee-v2` pod because the header matches the conditions defined in the HTTPRoute.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee -H \"version:v2\"\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration File\nDESCRIPTION: This is the main Nginx configuration file, which loads the App Protect module and defines the enforcer address, worker processes, and includes default configurations. It also sets up logging and configures the HTTP context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nuser  nginx;\nworker_processes  auto;\n\n# NGINX App Protect WAF\nload_module modules/ngx_http_app_protect_module.so;\n\nerror_log  /var/log/nginx/error.log notice;\npid        /var/run/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                    '$status $body_bytes_sent \"$http_referer\" '\n                    '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    # NGINX App Protect WAF\n    app_protect_enforcer_address waf-enforcer:50000;\n\n    include /etc/nginx/conf.d/*.conf;\n}\n\n```\n\n----------------------------------------\n\nTITLE: Add Environment using API - JSON Payload\nDESCRIPTION: This JSON payload is used to create a new Environment within a Workspace via the API. It includes the environment name and proxy configurations, specifying the proxy cluster name and hostnames for the API Gateway. The `environmentname`, `proxyClusterName`, and `environmentHostname` placeholders need to be replaced with the actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/infrastructure/manage-api-infrastructure.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"{{environmentname}}\",\n    \"proxies\": [\n        {\n            \"proxyClusterName\": \"{{proxyClusterName}}\",\n            \"hostnames\": [\n                \"{{environmentHostname}}\"\n            ]\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Redirecting HTTP to HTTPS (Nginx)\nDESCRIPTION: This snippet configures a server block to permanently redirect HTTP requests received on port 80 to the HTTPS server within the 'http' block. It uses a `return` directive with a 301 redirect to `https://$host$request_uri`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_37\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nserver {\n    listen 80;\n    location / {\n        return 301 https://$host$request_uri;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Try_files Directive with Default Image in Nginx\nDESCRIPTION: This snippet demonstrates using the `try_files` directive to check for the existence of a file corresponding to the request URI. If the file doesn't exist, Nginx will redirect to a default image.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    root /www/data;\n\n    location /images/ {\n        try_files $uri /images/default.gif;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Basic Caching Configuration via REST API (JSON)\nDESCRIPTION: This JSON snippet shows a sample REST API request to configure basic caching in NGINX Controller. It defines a single disk store with its path, maximum size, minimum free space, in-memory store size, and inactive time.  This configuration will add `proxy_cache_path` to the `http` context and `proxy_cache` directive to the `location` block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-caching.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n\"desiredState\": {\n    \"caching\": {\n        \"diskStores\": [\n        {\n            \"path\": \"/tmp/cache-1\",\n            \"maxSize\": \"5G\",\n            \"minFree\": \"10k\",\n            \"inMemoryStoreSize\": \"500M\",\n            \"inactiveTime\": \"2s\"\n        }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring a Queue via API in NGINX using JSON\nDESCRIPTION: This JSON configuration snippet demonstrates how to configure a request queue for an API Proxy using the backend-config policy. The `maxNumberOfRequests` parameter defines the maximum number of requests allowed in the queue, and `timeout` sets the maximum time to establish a connection with the proxied server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/http-backend-configuration.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"policies\" : {\n      \"backend-config\" : [\n         {\n            \"action\" : {\n               \"queue\" : {\n                  \"maxNumberOfRequests\": 10,\n                  \"timeOut\": \"60s\"\n               }\n            }\n         }\n      ]\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Generating a base64url-encoded key\nDESCRIPTION: This snippet demonstrates how to generate a base64url-encoded key from a secret using shell commands.  It pipes the secret `fantasticjwt` through base64 encoding and then replaces characters to make it URL-safe.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\necho -n fantasticjwt | base64 | tr '+/' '-_' | tr -d '='\nZmFudGFzdGljand0\n```\n\n----------------------------------------\n\nTITLE: Generate Root CA Certificates with OpenSSL\nDESCRIPTION: This snippet generates self-signed root CA certificates for the App Protect Enforcer (server) and NGINX (client) using OpenSSL. These certificates are used for mTLS authentication. The certificates are stored in `/etc/ssl/certs/` directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nmkdir -p /etc/ssl/certs\nopenssl genpkey -algorithm RSA -out /etc/ssl/certs/app_protect_server_ca.key\nopenssl genpkey -algorithm RSA -out /etc/ssl/certs/app_protect_client_ca.key\nopenssl req -x509 -new -key /etc/ssl/certs/app_protect_server_ca.key -out /etc/ssl/certs/app_protect_server_ca.crt -subj \"/O=F5/OU=app-protect/CN=mTLS Server Root CA\"\nopenssl req -x509 -new -key /etc/ssl/certs/app_protect_client_ca.key -out /etc/ssl/certs/app_protect_client_ca.crt -subj \"/O=F5/OU=app-protect/CN=mTLS Client Root CA\"\n```\n\n----------------------------------------\n\nTITLE: Accessing WAF Enforcer Container Logs with Docker\nDESCRIPTION: This command allows you to view the logs from the `waf-enforcer` container using Docker.  This assumes that `stderr` is set as the destination for the security logs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/logging-overview/logs-overview.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ndocker logs waf-enforcer\n```\n\n----------------------------------------\n\nTITLE: Defining a Request Rate Limit Zone in Nginx\nDESCRIPTION: This snippet defines a shared memory zone 'one' of 10MB to store the request rate per client IP address. The rate is set to 1 request per second (1r/s) using the `$binary_remote_addr` variable as the key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n    limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;\n}\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Config Publishing and Dataplane Status (YAML)\nDESCRIPTION: Configures the NGINX Agent to enable the publishing of NGINX configurations, monitoring of dataplane status, and file watcher functionality. This configuration disables metric collection and focuses on configuration management and status reporting. Newlines are represented as `\\n`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configure-nginx-agent-features.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\nfeatures:\\n  - nginx-config-async\\n  - dataplane-status\\n  - file-watcher\n```\n\n----------------------------------------\n\nTITLE: Configuring OCSP Response Cache\nDESCRIPTION: This snippet shows how to configure a shared memory zone for caching OCSP responses in Nginx. The `ssl_ocsp_cache` directive defines the name and size of the zone. Cached responses are valid for 1 hour unless the OCSP response specifies a different `nextUpdate` value.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\n#...\nssl_ocsp_cache shared:one:10m;\n#...\n```\n\n----------------------------------------\n\nTITLE: Start NGINX Agent - Bash\nDESCRIPTION: This command starts the NGINX Agent service using `systemctl start` with `sudo` privileges.  This activates the NGINX Agent after it has been stopped or after the metrics module has been installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-plus-advanced-metrics.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Enable Security Logging\nDESCRIPTION: This configuration directive enables security logging within the specified context (http, server, or location). The security log attributes are determined by the `app_protect_security_log` directive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/security-log.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log_enable on\n```\n\n----------------------------------------\n\nTITLE: Successful Nginx Configuration Test Output\nDESCRIPTION: This is the expected output when the `nginx -t` command is run successfully, indicating that the Nginx configuration file syntax is correct and the configuration file is valid.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentracing.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: NGINX Agent Configuration\nDESCRIPTION: This YAML configuration file configures the NGINX Agent. It specifies the NGINX Instance Manager host and port, enables TLS with certificate verification, and defines the paths to the agent's certificate, key, and the CA certificate used to verify the NGINX Instance Manager's server certificate. It also configures logging, data plane synchronization, and metrics reporting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_8\n\nLANGUAGE: yaml\nCODE:\n```\n#\n# /etc/nginx-agent/nginx-agent.conf\n#\n# Configuration file for NGINX Agent.\n#\n# This file is to track agent configuration values that are meant to be statically set. There\n# are additional agent configuration values that are set via the API and agent install script\n# which can be found in /var/lib/nginx-agent/agent-dynamic.conf.\n\n# specify the server grpc port to connect to\nserver:\n    # host of the control plane\n    host: <NGINX-INSTANCE-MANAGER-FQDN>\n    grpcPort: 443\n    # provide servername overrides if using SNI\n    metrics: \"nginx-manager.example.com\"\n    command: \"nginx-manager.example.com\"\n# tls options\ntls:\n    enable: true\n    skip_verify: false\n    cert: /etc/nms/certs/agent.crt\n    key: /etc/nms/certs/agent.key\n    ca: /etc/nms/certs/ca.pem\nlog:\n    # set log level (panic, fatal, error, info, debug, trace; default \"info\")\n    level: info\n    # set log path. if empty, don't log to file.\n    path: /var/log/nginx-agent/\n# data plane status message / 'heartbeat'\nnginx:\n    # path of NGINX logs to exclude\n    exclude_logs: \"\"\n\ndataplane:\n    sync:\n        enable: true\n    # poll interval for data plane status\n    status:\n        poll_interval: 30s\nmetrics:\n    # specify the size of a buffer to build before sending metrics\n    bulk_size: 20\n    # specify metrics poll interval\n    report_interval: 1m\n    collection_interval: 15s\n    mode: aggregated\n\n# OSS NGINX default config path\n# path to aux file dirs can also be added\nconfig_dirs: \"/etc/nginx:/usr/local/etc/nginx\"\n```\n\n----------------------------------------\n\nTITLE: Configuring MAPI Location Block for HTTPS Traffic in Nginx\nDESCRIPTION: This snippet configures the location block for MAPI Over HTTP ('/mapi') in the 'server' block for HTTPS traffic in Nginx. It proxies requests to the 'exchange-mapi' upstream, sets the HTTP version to 1.1, and clears the Connection header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_45\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /mapi {\n    proxy_pass https://exchange-mapi;\n    proxy_http_version 1.1;\n    proxy_set_header Connection \"\";\n}\n```\n\n----------------------------------------\n\nTITLE: Security Policy Bundles Request - JSON\nDESCRIPTION: This is an example JSON payload for creating security policy bundles. It defines the structure for specifying `appProtectWAFVersion`, `policyName`, `policyUID`, `attackSignatureVersionDateTime`, and `threatCampaignVersionDateTime` for multiple bundles. The request expects these fields to be configured according to the NGINX App Protect WAF policy requirements.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_8\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"bundles\": [{\n      \"appProtectWAFVersion\": \"4.457.0\",\n      \"policyName\": \"default-enforcement\",\n      \"policyUID\": \"<policy-uid>\",\n      \"attackSignatureVersionDateTime\": \"2023.06.20\",\n      \"threatCampaignVersionDateTime\": \"2023.07.18\"\n    },\n    {\n      \"appProtectWAFVersion\": \"4.279.0\",\n      \"policyName\": \"default-enforcement\",\n      \"attackSignatureVersionDateTime\": \"latest\",\n      \"threatCampaignVersionDateTime\": \"latest\"\n    },\n    {\n      \"appProtectWAFVersion\": \"4.457.0\",\n      \"policyName\": \"ignore-xss\"\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Setting Policy File Path for App Protect DoS in Nginx\nDESCRIPTION: This snippet sets the path to the JSON policy file for App Protect DoS using the `app_protect_dos_policy_file` directive. The policy file includes configuration parameters for the module. If the directive is not specified, a default path is used.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_dos_policy_file /etc/app_protect_dos/BADOSPolicy.json;\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration for Cognito OIDC\nDESCRIPTION: This Nginx configuration demonstrates the integration with Amazon Cognito for OpenID Connect (OIDC) authentication. It defines the OIDC provider details, configures SSL, and proxies requests to an internal server. The configuration requires specifying the DNS resolver, Cognito issuer, client ID, and client secret.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/cognito.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # Use a public DNS resolver for Issuer discovery, etc.\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider cognito {\n        # Typically your Cognito issuer is something like:\n        # https://cognito-idp.<region>.amazonaws.com/<UserPoolID>\n        issuer https://cognito-idp.us-east-2.amazonaws.com/us-east-2_abCdEfGhI;\n\n        # Your Cognito \"App client id\" and \"App client secret\"\n        client_id <client_id>;\n        client_secret <client_secret>;\n    }\n\n    server {\n        listen 443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n            # Protect this path with Cognito OIDC\n            auth_oidc cognito;\n\n            # Forward OIDC claims as headers if desired\n            proxy_set_header sub $oidc_claim_sub;\n            proxy_set_header email $oidc_claim_email;\n            proxy_set_header name $oidc_claim_name;\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n\n    server {\n        listen 8080;\n\n        location / {\n            return 200 \"Hello, $http_name!\\nEmail: $http_email\\nSub: $http_sub\\n\";\n            default_type text/plain;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Query Metrics with Filter - cURL\nDESCRIPTION: This cURL command retrieves data for a specific application (`app1`) for the last three hours using the `filter` parameter. The filter targets the `app` dimension and uses the `=` operator.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_11\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=http.request.count&filter=app='app1'&startTime=now-3h\"\n```\n\n----------------------------------------\n\nTITLE: Configure Security Log Destination\nDESCRIPTION: This directive configures the security log attributes, including the path to the log configuration file and the destination of the log messages.  Destinations can be `stderr`, a local file path, or a syslog server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/security-log.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log \"/etc/app_protect/conf/log_default.json\" stderr;\n```\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log \"/etc/app_protect/conf/log_default.json\" /var/log/app_protect/security.log;\n```\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log \"/etc/app_protect/conf/log_default.json\" syslog:server=localhost:514;\n```\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log \"/etc/app_protect/conf/log_default.json\" syslog:server=my-specific-machine-name:514;\n```\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log \"/etc/app_protect/conf/log_default.json\" syslog:server=192.168.12.34:514;\n```\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log \"/etc/app_protect/conf/log_default.json\" syslog:server=my.domain.com:514;\n```\n\n----------------------------------------\n\nTITLE: Include conf.d Configuration Nginx\nDESCRIPTION: This directive includes all files with the .conf extension from the conf.d directory. This allows for modular configuration of Nginx, where different aspects of the server configuration can be managed in separate files. This line must appear in the top-level or \"main\" context of nginx.conf.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/setting-up-nginx-demo-environment.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\ninclude conf.d/*.conf;\n```\n\n----------------------------------------\n\nTITLE: Publish API Proxy without OpenAPI Spec API Request (JSON)\nDESCRIPTION: This JSON configuration creates an API Proxy to a backend service within NGINX Management Suite API Connectivity Manager, without using an OpenAPI specification.  It defines the proxy's name, version, hostname, ingress settings (base path), and backend service details, including the target hostname.  The `proxyName` and `environmentHostname` are placeholders to be replaced with actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/publish-api-proxy.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"{{proxyName}}\",\n    \"metadata\": {\n        \"description\": \"Swagger Petstore Proxy\"\n    },\n    \"version\": \"v1\",\n    \"proxyConfig\": {\n        \"hostname\": \"{{environmentHostname}}\",\n        \"ingress\": {\n            \"basePath\": \"/v1\"\n        },\n        \"backends\": [\n            {\n                \"serviceName\": \"petstore-api-svc\",\n                \"serviceTargets\": [\n                    {\n                        \"hostname\": \"petstore.example.com\"\n                    }\n                ]\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Open Source (Oracle Linux 8.1+)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Open Source package from Oracle Linux 8.1 and later. It uses the `dnf remove` command to remove the `app-protect-module-oss` package. Requires root privileges and the dnf package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_58\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf remove app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Making API Request with Basic Auth using curl\nDESCRIPTION: This command makes an API request to the specified endpoint using curl with basic authentication. It includes the base64-encoded credentials in the Authorization header, replacing <NIM_FQDN> with the NGINX Instance Manager's fully qualified domain name and <API_VERSION> with the desired API version. The expected output is the response from the API endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/admin-guide/auth/basic-auth-api-requests.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X GET \"https://<NIM_FQDN>/api/platform/<API_VERSION>/systems\" -H \"Authorization: Basic <base64_encoded_credentials>\"\n```\n\n----------------------------------------\n\nTITLE: Create Azure Load Balancer - Azure CLI\nDESCRIPTION: Creates an Azure Load Balancer with a Standard SKU in a specified resource group and virtual network. It also configures a frontend IP and backend pool.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/private-link-to-upstreams.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n$ az network lb create \\\n    --resource-group $APP_RESOURCE_GROUP \\\n    --name load-balancer \\\n    --sku Standard \\\n    --vnet-name $APP_VNET_NAME \\\n    --subnet-name $APP_SUBNET_NAME \\\n    --frontend-ip-name frontend \\\n    --backend-pool-name backend-pool\n```\n\n----------------------------------------\n\nTITLE: Test traffic flow to the application\nDESCRIPTION: Tests the traffic flow to the 'coffee' application using curl. This command sends a request to 'http://cafe.example.com:$GW_PORT/coffee' and verifies that a response is received from the coffee Pod.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee\n```\n\n----------------------------------------\n\nTITLE: Example Keycloak OpenID Configuration\nDESCRIPTION: This JSON snippet shows an example of the OpenID Connect configuration returned by Keycloak. It includes essential endpoints like authorization_endpoint, jwks_uri, and token_endpoint.  These values need to be configured in NGINX Plus's openid_connect_configuration.conf file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/keycloak.md#_snippet_5\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"authorization_endpoint\": \"https://<keycloak-server-address>/auth/realms/master/protocol/openid-connect/auth\",\n    \"jwks_uri\": \"https://<keycloak-server-address>/auth/realms/master/protocol/openid-connect/certs\",\n    \"token_endpoint\": \"https://<keycloak-server-address>/auth/realms/master/protocol/openid-connect/token\"\n}\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Gateway Fabric with Experimental Gateway API Features\nDESCRIPTION: This command installs NGINX Gateway Fabric and enables experimental Gateway API features. It creates the 'nginx-gateway' namespace if it doesn't exist. Requires Helm 3.0+, kubectl, and the Gateway APIs installed from the experimental channel.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nhelm install ngf oci://ghcr.io/nginx/charts/nginx-gateway-fabric --create-namespace -n nginx-gateway --set nginxGateway.gwAPIExperimentalFeatures.enable=true\n```\n\n----------------------------------------\n\nTITLE: Stream Discarded Connections Metric\nDESCRIPTION: Describes the 'plus.stream.discarded' metric, which is a counter for the total number of connections completed without creating a session. This metric can show connections that did not complete correctly, or connections that were rejected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_21\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Total number of connections completed without creating a session.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Configuring ActiveSync Location Block for HTTPS Traffic in Nginx\nDESCRIPTION: This snippet configures the location block for ActiveSync ('/Microsoft-Server-ActiveSync') in the 'server' block for HTTPS traffic in Nginx. It proxies requests to the 'exchange-activesync' upstream, sets the HTTP version to 1.1, and clears the Connection header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_46\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /Microsoft-Server-ActiveSync {\n    proxy_pass https://exchange-activesync;\n    proxy_http_version 1.1;\n    proxy_set_header Connection \"\";\n}\n```\n\n----------------------------------------\n\nTITLE: Bypassing Cache Based on Conditions in Nginx\nDESCRIPTION: This snippet demonstrates how to define conditions under which Nginx Plus does not send cached responses to clients. It uses the proxy_cache_bypass directive to bypass the cache based on cookie or request argument values. This prevents the cache from being used when certain conditions are met.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_bypass $cookie_nocache $arg_nocache$arg_comment;\n```\n\n----------------------------------------\n\nTITLE: Enabling njs Module in NGINX Configuration\nDESCRIPTION: This snippet shows how to enable the njs (Nginx JavaScript) module by loading the module and configuring the http block. The load_module directive loads the njs module, and the http block contains the configuration for the HTTP server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Docker Login with JWT Token\nDESCRIPTION: This command logs into the private NGINX registry using a JWT token for authentication. Replace `<JWT Token>` with the actual token provided. The username is set to the JWT token, and the password is set to `none`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/nginx-plus-jwt.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\ndocker login private-registry.nginx.com --username=<JWT Token> --password=none\n```\n\n----------------------------------------\n\nTITLE: Delete Security Policy via REST API using DELETE\nDESCRIPTION: This snippet demonstrates deleting a security policy using a `DELETE` request to the NGINX Instance Manager REST API.  It requires a valid access token and the policy's UID to identify the policy to be deleted.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_6\n\nLANGUAGE: Shell\nCODE:\n```\ncurl -X DELETE https://{{NIM_FQDN}}/api/platform/v1/security/policies/<policy-uid> \\\n    -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect Module Load\nDESCRIPTION: This code snippet shows how to load the NGINX App Protect module to resolve the `unknown directive app_protect_xxx` error message. This line must be added to the main (global) context of the nginx.conf file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/troubleshooting-guide/troubleshooting.md#_snippet_4\n\nLANGUAGE: none\nCODE:\n```\nload_module \"/etc/nginx/modules/ngx_http_app_protect_module.so\";\n```\n\n----------------------------------------\n\nTITLE: Combining Gzip and Gunzip in NGINX\nDESCRIPTION: This snippet demonstrates enabling both gzip compression and gunzip decompression within the same server context.  Requires both the ngx_http_gzip_module and the ngx_http_gunzip_module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/compression.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    gzip on;\n    gzip_min_length 1000;\n    gunzip on;\n    ...\n}\n```\n\n----------------------------------------\n\nTITLE: Pass OIDC Claims to Backend in NGINX\nDESCRIPTION: This snippet configures NGINX to pass OIDC claims as headers to the backend application. The `proxy_set_header` directives set HTTP headers with values from the OIDC claims, allowing the application to access user information such as the subject identifier, email address, and full name.  These claims are extracted from the ID token returned by OneLogin.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/onelogin.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc onelogin;\n\n     proxy_set_header sub   $oidc_claim_sub;\n     proxy_set_header email $oidc_claim_email;\n     proxy_set_header name  $oidc_claim_name;\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Creating Cache Directory Shell\nDESCRIPTION: Creates a directory for cached files and assigns ownership to the 'nginx' user. This directory will be used by NGINX Plus to store cached content, improving application performance. It requires root privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_28\n\nLANGUAGE: shell\nCODE:\n```\nroot@nginx# mkdir /var/oracle-cache\nroot@nginx# chown nginx /var/oracle-cache\n```\n\n----------------------------------------\n\nTITLE: Configuring IP Hash Session Persistence Nginx\nDESCRIPTION: This snippet configures IP Hash session persistence for the 'nodejs' upstream group.  The `ip_hash` directive ensures that requests from the same client IP address are consistently routed to the same backend server. This is added to the upstream block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream nodejs {\n   ip_hash;\n   server 192.168.33.11:8080;\n   server 192.168.33.12:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: OpenSSL CA Configuration\nDESCRIPTION: This YAML configuration file defines settings for creating a Certificate Authority (CA) using OpenSSL.  It sets parameters such as key size (4096 bits), distinguished name fields (country, state, locality, organization, common name), and extensions for the CA certificate, including basic constraints (CA:true) and key usage (keyCertSign, cRLSign).  This configuration is used by the `openssl req` command to generate the CA certificate.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\n[req]\ndefault_bits        = 4096\ndistinguished_name  = req_distinguished_name\nprompt              = no\ndefault_md          = sha256\nreq_extensions      = v3_req\n\n# recommend changing these to your needs\n[req_distinguished_name]\ncountryName                 = US\nstateOrProvinceName         = California\nlocalityName                = San Francisco\norganizationName            = NGINX, Inc.\ncommonName                  = nms-ca\n\n[v3_req]\nbasicConstraints = critical, CA:true\nkeyUsage = critical, keyCertSign, cRLSign\nsubjectKeyIdentifier = hash\n```\n\n----------------------------------------\n\nTITLE: Configure HTTPS proxy_pass in NGINX\nDESCRIPTION: This snippet demonstrates how to configure the `proxy_pass` directive to use the HTTPS protocol, enabling SSL connections to the backend server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/securing-upstream-traffic.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /upstream {\n    proxy_pass https://backend.example.com;\n}\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX JavaScript module (njs) on Debian/Ubuntu\nDESCRIPTION: This command installs the NGINX JavaScript module (njs) on Debian and Ubuntu systems using the apt package manager. This module is required for handling the interaction between NGINX Plus and the Keycloak identity provider.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/keycloak.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nsudo apt install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Removing a Server from Upstream Group via API with DELETE Method (Shell)\nDESCRIPTION: This command removes a server from the specified upstream group using the DELETE method via curl. It targets a specific server ID in the `/servers` endpoint. Server IDs are integers starting from 0.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_22\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X DELETE -s 'http://192.168.1.23/api/9/http/upstreams/appservers/servers/0'\n```\n\n----------------------------------------\n\nTITLE: Configuring Strict-Transport-Security header in Nginx\nDESCRIPTION: This snippet shows how to configure the Strict-Transport-Security header in Nginx to force browsers to access the site only via HTTPS. It sets the max-age to 31536000 seconds (1 year) and includes subdomains, ensuring that all subdomains are also accessed via HTTPS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-response-headers.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nadd_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" [always]\n```\n\n----------------------------------------\n\nTITLE: Querying NGINX Plus API for Active Connections\nDESCRIPTION: This snippet retrieves the number of active connections from the NGINX Plus API. It uses `curl` to make a GET request to the API endpoint and `python -m json.tool` to format the JSON output. The output is then filtered using `grep` to extract the value of the `active` field.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\n$ curl -X GET \"127.0.0.1:8000/api/<version>/connections\" -H \"accept: application/json\" | python -m json.tool | grep active\n\n\"active\": 1,\n```\n\n----------------------------------------\n\nTITLE: Specify Auth0 Credentials in NGINX\nDESCRIPTION: This snippet configures the `oidc_provider` block with the Auth0 Issuer URL, Client ID, and Client Secret. These values are essential for Nginx to communicate with Auth0 for authentication and authorization purposes. Replace `<client_id>` and `<client_secret>` with your actual Auth0 credentials.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/auth0.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider auth0 {\n        issuer        https://yourTenantId.us.auth0.com/;\n        client_id     <client_id>;\n        client_secret <client_secret>;\n    }\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Zone for Health Checks - Nginx\nDESCRIPTION: This snippet configures a zone within the upstream block. This zone is required for health checks to function correctly and is used to store configuration and runtime state accessible to all worker processes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_27\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream nodejs {\n    zone nodejs 64k;\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Delete Certificate via REST API (bash)\nDESCRIPTION: This cURL command sends a DELETE request to the NGINX Instance Manager REST API to delete a certificate. It requires the certificate name in the API endpoint URL.  Authorization and proper API configuration are prerequisites.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/manage-certificates.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X DELETE \"https://nginx-manager.example.com/api/platform/v1/certs/pem_cert_with_ca\" \\\n  -H \"accept: application/json\"\n```\n\n----------------------------------------\n\nTITLE: Specify Cluster Nodes (Static) NGINX\nDESCRIPTION: Specifies other NGINX instances in the cluster using the `zone_sync_server` directive, adding each node statically as a separate line. This approach requires manual configuration for each node and does not automatically adapt to changes in the cluster membership.  Each `zone_sync_server` directive specifies the hostname and port of another cluster member.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n\n    server {\n        zone_sync;\n        zone_sync_server nginx-node1.example.com:9000;\n        zone_sync_server nginx-node2.example.com:9000;\n        zone_sync_server nginx-node3.example.com:9000;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Proxy Cache in Location Block\nDESCRIPTION: This configuration enables caching for requests to the /webapp/ path by referencing the cache zone defined earlier. The proxy_pass directive forwards requests to the upstream JBoss server, and proxy_cache activates the cache.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_21\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /webapp/ {\n    proxy_pass http://jboss;\n    proxy_cache backcache;\n}\n```\n\n----------------------------------------\n\nTITLE: List Installed Packages (CentOS/RHEL)\nDESCRIPTION: Lists installed Nginx and App Protect packages on CentOS, RHEL, Amazon Linux, or Oracle Linux systems. The output is saved to a text file for documentation when opening a support ticket.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/troubleshooting-guide/troubleshooting.md#_snippet_2\n\nLANGUAGE: Shell\nCODE:\n```\nrpm -qa nginx* app-protect* > package_versions.txt\n```\n\n----------------------------------------\n\nTITLE: Internal Redirect with PHP Handling in Nginx\nDESCRIPTION: This snippet demonstrates an internal redirect scenario where the request URI is checked for both HTML and PHP index files. If the HTML file doesn't exist but the PHP file does, an internal redirect occurs, and the request is then passed to a FastCGI server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    root /data;\n    index index.html index.php;\n}\n\nlocation ~ \\.php {\n    fastcgi_pass localhost:8000;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Nginx: Load App Protect Module and Configure Servers\nDESCRIPTION: This configuration snippet loads the App Protect module and defines two server blocks. The first server block (port 8080) proxies all requests to localhost:8888 after passing through an authorization request sent to /scan, handled by the second server block (port 8081). The second server block enables App Protect on the /scan location and proxies requests to localhost:8888.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/configure-client-authorization.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n\nhttp {\n    server {\n        listen       127.0.0.1:8080;\n        server_name  localhost;\n\n        location / {\n            auth_request /scan;\n            proxy_pass http://localhost:8888;\n        }\n        location /scan {\n            proxy_pass http://localhost:8081$request_uri;\n       }\n    }\n\n    server {\n        listen       127.0.0.1:8081;\n        server_name  localhost;\n\n        location /scan {\n            app_protect_enable on;\n            proxy_pass http://localhost:8888;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling HTTP Basic Authentication in Nginx (Server block)\nDESCRIPTION: This configuration enables HTTP Basic authentication, requiring users to authenticate before accessing a protected resource. The `auth_basic` directive turns on authentication, and `auth_basic_user_file` specifies the file containing user credentials. This would typically be within a `location` block, within the `server` block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_40\n\nLANGUAGE: nginx\nCODE:\n```\nauth_basic on;\nauth_basic_user_file /etc/nginx/users;\n```\n\n----------------------------------------\n\nTITLE: Configuring Keep-Alive via API with JSON\nDESCRIPTION: This JSON payload configures keep-alive connections for an NGINX API proxy by specifying settings for connection caching, request limits, and timeout durations. It defines the `keepCacheConnectionAlive`, `keepAliveRequests`, `keepAliveTime`, and `keepAliveTimeout` parameters within the `backend-config` policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/http-backend-configuration.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"policies\" : {\n      \"backend-config\" : [\n         {\n            \"action\" : {\n               \"keepCacheConnectionAlive\": 32,\n               \"keepAliveRequests\": 1000,\n               \"keepAliveTime\": \"1h\",\n               \"keepAliveTimeout\": \"60s\"\n            }\n         }\n      ]\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Setting Up Repository Pinning for NGINX on Ubuntu\nDESCRIPTION: This command configures apt to prefer packages from the official NGINX repository over those provided by the distribution. It creates a preferences file that assigns a higher priority to packages originating from nginx.org, ensuring that the official packages are used when available.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_26\n\nLANGUAGE: shell\nCODE:\n```\necho -e \"Package: *\\nPin: origin nginx.org\\nPin: release o=nginx\\nPin-Priority: 900\\n\" \\\n        | sudo tee /etc/apt/preferences.d/99nginx\n```\n\n----------------------------------------\n\nTITLE: Displaying Node State with ip addr show (Backup Node)\nDESCRIPTION: This command displays the IP address configuration for the specified network interface on the backup node.  It is used to verify which node is currently the backup by checking if the VIP is NOT assigned to the node's interface. Requires the `iproute2` package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ncentos7-2 $ ip addr show eth0\n```\n\n----------------------------------------\n\nTITLE: Enabling API Read-Write Mode Nginx\nDESCRIPTION: This snippet enables read-write mode for the API by specifying the `write=on` parameter for the `api` directive within the location block. This allows making changes to the Nginx configuration via the API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    server {\n        listen 192.168.1.23;\n        # ...\n        location /api {\n            api write=on;\n            # ...\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Set App Protect Directory Ownership\nDESCRIPTION: Sets the ownership of the NGINX App Protect WAF directories to the specified UID/GID (defaulting to 101:101). This ensures that the WAF services have the necessary permissions to access and modify files within these directories. The command uses sudo chown -R to recursively change the ownership of the directories.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nsudo chown -R 101:101 /opt/app_protect/\n```\n\n----------------------------------------\n\nTITLE: TCP Component IPv6 Configuration\nDESCRIPTION: This snippet configures a TCP component to listen on an IPv6 address.  It uses the uriSnippets block to add a listen directive for the wildcard IPv6 address ([::]:9090). The `reuseport` option is crucial for avoiding bind errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-snippets.md#_snippet_9\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"metadata\": {\n    \"name\": \"<component-name>\"\n  },\n  \"desiredState\": {\n    \"configSnippets\": {\n      \"uriSnippets\": [\n        {\n          \"directives\": [\n            {\n              \"directive\": \"listen\",\n              \"args\": [\n                \"[::]:9090\",\n                \"reuseport\"\n              ]\n            }\n          ]\n        }\n      ]\n    },\n    \"backend\": {\n      \"workloadGroups\": {\n        \"wg\": {\n          \"uris\": {\n            \"tcp://<workload-host>:9090\": {}\n          },\n        }\n      }\n    },\n    \"componentType\": \"TCPUDP\",\n    \"ingress\": {\n      \"gatewayRefs\": [\n        {\n          \"ref\": \"/services/environments/<env-name>/gateways/<gateway-name>\"\n        }\n      ],\n      \"uris\": {\n        \"tcp://*:9090\": {}\n      }\n    }\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Apply Cafe Application Resources with Kubectl\nDESCRIPTION: This command applies the application resources defined in the cafe.yaml file to the Kubernetes cluster, creating deployments and services for the coffee and tea applications. This sets up the example application to be used with NGINX Gateway Fabric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f cafe.yaml\n```\n\n----------------------------------------\n\nTITLE: Deleting Target v1.0 with kubectl\nDESCRIPTION: This command removes the deployed `target-v1.0` resources from the Kubernetes cluster using `kubectl delete`. This is performed after the successful blue-green deployment of v2.1, ensuring all traffic is directed to the new version, and the old version is no longer needed. Deleting the old version helps to clean up resources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_16\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete -f target-v1.0.yaml\n```\n\n----------------------------------------\n\nTITLE: Redirecting HTTP to HTTPS Nginx\nDESCRIPTION: This snippet configures a virtual server listening on port 80 for HTTP traffic and redirects all requests to the HTTPS server. It ensures all unencrypted traffic is redirected to the secure HTTPS version of the website. It needs to be placed inside the 'http' block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nserver {\n    listen 80;\n    server_name example.com;\n\n    # Redirect all HTTP requests to HTTPS\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Protect Location with OIDC in NGINX\nDESCRIPTION: This snippet enables OIDC protection for the specified location.  The `auth_oidc onelogin` directive instructs NGINX to authenticate requests to this location using the `onelogin` OIDC provider configured earlier.  Requests are proxied to the backend application only after successful authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/onelogin.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc onelogin;\n\n     # ...\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Define Key-Value Storage for Client Identification (NGINX)\nDESCRIPTION: This snippet defines a key-value storage zone named `clients` with a size of 80MB and a timeout of 3600 seconds.  It's used to track unique combinations of client IP addresses and User-Agent headers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/logging.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nkeyval_zone zone=clients:80m timeout=3600s;\n```\n\n----------------------------------------\n\nTITLE: Including Status Configuration in Nginx (HTTP block)\nDESCRIPTION: This configuration includes a separate status configuration file into the main Nginx configuration. This file typically contains settings for live activity monitoring or other status-related features. This is usually placed inside the http block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_38\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block in nginx.conf\ninclude conf.d/status.conf;\n```\n\n----------------------------------------\n\nTITLE: Install OpenTracing Module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This shell script updates the package repository and installs the `nginx-plus-module-opentracing` package using dnf. This enables the OpenTracing module within Nginx Plus. It is compatible with Amazon Linux 2023, AlmaLinux, and Rocky Linux.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentracing.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-opentracing\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Deployment Configuration\nDESCRIPTION: This YAML configuration defines a Kubernetes Deployment for deploying Nginx with WAF services (waf-enforcer, waf-config-mgr). It sets up the necessary containers, volumes, volume mounts, environment variables, and image pull policies. Ensure the image tags are accurate before deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_22\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nap5-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nap5\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nap5\n    spec:\n      containers:\n        - name: nginx\n          image: localhost:5000/nginx-app-protect-5:latest\n          imagePullPolicy: IfNotPresent\n          volumeMounts:\n            - name: app-protect-bd-config\n              mountPath: /opt/app_protect/bd_config\n            - name: app-protect-config\n              mountPath: /opt/app_protect/config\n            - name: nginx-config-volume\n              mountPath: /etc/nginx/nginx.conf\n              subPath: nginx.conf\n            - name: nginx-default-config-volume\n              mountPath: /etc/nginx/conf.d/default.conf\n              subPath: default.conf\n        - name: waf-enforcer\n          image: localhost:5000/waf-enforcer:5.2.0\n          imagePullPolicy: IfNotPresent\n          env:\n            - name: ENFORCER_PORT\n              value: \"50000\"\n          volumeMounts:\n            - name: app-protect-bd-config\n              mountPath: /opt/app_protect/bd_config\n        - name: waf-config-mgr\n          image: localhost:5000/waf-config-mgr:5.2.0\n          imagePullPolicy: IfNotPresent\n          securityContext:\n            allowPrivilegeEscalation: false\n            capabilities:\n              drop:\n                - all\n          volumeMounts:\n            - name: app-protect-bd-config\n              mountPath: /opt/app_protect/bd_config\n            - name: app-protect-config\n              mountPath: /opt/app_protect/config\n            - name: app-protect-bundles\n              mountPath: /etc/app_protect/bundles\n      volumes:\n        - name: app-protect-bd-config\n          emptyDir: {}\n        - name: app-protect-config\n          emptyDir: {}\n        - name: app-protect-bundles\n          persistentVolumeClaim:\n            claimName: nap5-bundles-pvc\n        - name: nginx-config-volume\n          configMap:\n            name: nginx-config\n            items:\n              - key: nginx.conf\n                path: nginx.conf\n        - name: nginx-default-config-volume\n          configMap:\n            name: nginx-config\n            items:\n              - key: default.conf\n                path: default.conf\n```\n\n----------------------------------------\n\nTITLE: Default Logrotate Configuration\nDESCRIPTION: This is the default logrotate configuration file for NGINX App Protect WAF. It specifies how the log files in `/var/log/app_protect/` should be rotated based on size, rotation count, and other attributes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/logs-overview.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\n/var/log/app_protect/*.log {\n        size 1M\n        copytruncate\n        notifempty\n        create 644 nginx nginx\n        rotate 20\n}\n```\n\n----------------------------------------\n\nTITLE: HTTP Gateway IPv6 Configuration\nDESCRIPTION: This snippet configures an HTTP gateway to listen on IPv6 addresses. It uses the uriSnippets block to add listen directives for both wildcard IPv6 address ([::]:80) and a specific IPv6 address, ensuring proper handling of IPv6 traffic. The `reuseport` option is crucial for avoiding bind errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-snippets.md#_snippet_8\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"metadata\": {\n    \"name\": \"<gateway-name>\"\n  },\n  \"desiredState\": {\n    \"configSnippets\": {\n      \"uriSnippets\": [\n        {\n          \"directives\": [\n            {\n              \"directive\": \"listen\",\n              \"args\": [\n                \"[::]:80\",\n                \"reuseport\"\n              ]\n            },\n            {\n              \"directive\": \"listen\",\n              \"args\": [\n                \"[<IPv6-address>]:80\",\n                \"reuseport\"\n              ]\n            }\n          ]\n        }\n      ]\n    },\n    \"ingress\": {\n      \"placement\": {\n        \"instanceRefs\": [\n          {\n            \"ref\": \"/infrastructure/locations/unspecified/instances/<instance-name>\"\n          }\n        ]\n      },\n      \"uris\": {\n        \"http://example.com:80\": {}\n      }\n    }\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Install GeoIP Module on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This shell command updates the package manager and installs the nginx-plus-module-geoip package using yum. It's specific to Amazon Linux 2, CentOS, Oracle Linux, and RHEL distributions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-geoip\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration\nDESCRIPTION: Reloads the NGINX configuration without downtime.  This command applies the new configuration changes after a successful test.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/spnego.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Basic Load Balancing Configuration\nDESCRIPTION: This configuration snippet shows the basic full configuration including the cache path.  This snippet highlights the cache path directive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_25\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /tmp/NGINX_cache/ keys_zone=backcache:10m;\n\n```\n\n----------------------------------------\n\nTITLE: Defining Health Check Tests with Match Directive - Nginx\nDESCRIPTION: This snippet defines the tests that a server must pass to be considered functional. It checks for a status code of 200, a 'Content-Type' header containing 'text/html', and a response body matching the string 'Hello world'. This configuration is referenced by the `health_check` directive in the location block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_26\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nmatch health_check {\n     status 200;\n     header Content-Type ~ text/html;\n     body ~ \"Hello world\";\n}\n```\n\n----------------------------------------\n\nTITLE: Parent-based Tracing Configuration (Nginx)\nDESCRIPTION: This configuration enables parent-based tracing, capturing and propagating trace information from incoming requests.  The `otel_trace_context propagate` directive ensures that tracing contexts are inherited from the parent request when Nginx acts as a reverse proxy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_21\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    server {\n        location / {\n            otel_trace $otel_parent_sampled;\n            otel_trace_context propagate;\n\n            proxy_pass http://backend;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Plus and App Protect in Dockerfile\nDESCRIPTION: This snippet installs Nginx Plus and Nginx App Protect WAF v5 module within a Dockerfile. It uses multi-stage builds for secure handling of repository keys and certificates via Docker secrets. The snippet configures the package repositories, imports the signing key, and installs the required packages using apt-get.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-plus/build-debian.md#_snippet_0\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Supported OS_CODENAME's are: bullseye/bookworm\nARG OS_CODENAME=bookworm\n\n# Base image\nFROM debian:${OS_CODENAME}\n\n# Install NGINX Plus and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    apt-get update \\\n    && apt-get install -y \\\n       apt-transport-https \\\n       lsb-release \\\n       ca-certificates \\\n       wget \\\n       gnupg2 \\\n       debian-archive-keyring \\\n    && wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key | \\\n       gpg --dearmor | tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null \\\n    && gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg \\\n    && printf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n       https://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\\n\" | \\\n       tee /etc/apt/sources.list.d/nginx-plus.list \\\n    && printf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n       https://pkgs.nginx.com/app-protect-x-plus/debian `lsb_release -cs` nginx-plus\\n\" | \\\n       tee /etc/apt/sources.list.d/nginx-app-protect.list \\\n    && wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx \\\n    && apt-get update \\\n    && DEBIAN_FRONTEND=\"noninteractive\" apt-get install -y app-protect-module-plus \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log \\\n    && apt-get clean \\\n    && rm -rf /var/lib/apt/lists/*\n```\n\n----------------------------------------\n\nTITLE: Configuring IP Address-Based ACLs in Nginx\nDESCRIPTION: This snippet demonstrates how to restrict access to the Nginx status page using IP address-based access control lists (ACLs).  The `allow` and `deny` directives are used to permit or deny access based on the client's IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_36\n\nLANGUAGE: nginx\nCODE:\n```\nallow 10.0.0.0/8;\ndeny all;\n```\n\n----------------------------------------\n\nTITLE: Get Shell Access to NGINX Container\nDESCRIPTION: This command uses `kubectl exec` to obtain an interactive shell session within the `nginx` container of a specified pod in the `nginx-gateway` namespace.  Replace `<ngf-pod-name>` with the actual name of the NGINX Gateway Fabric pod. This allows you to inspect the container's environment, logs, and configurations for debugging purposes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nkubectl exec -it -n nginx-gateway  <ngf-pod-name> -c nginx -- /bin/sh\n```\n\n----------------------------------------\n\nTITLE: Generate Self-Signed Certificate (Shell)\nDESCRIPTION: This set of commands generates a self-signed certificate for testing purposes. It creates a directory for SSL certificates and uses OpenSSL to generate a new RSA key and a self-signed X.509 certificate, storing them in /etc/nginx/ssl.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/fips-compliance-nginx-plus.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nmkdir -p /etc/nginx/ssl\nopenssl req -newkey rsa:2048 -nodes -keyout /etc/nginx/ssl/test.key -x509 -days 365 -out /etc/nginx/ssl/test.crt\n```\n\n----------------------------------------\n\nTITLE: Pulling NGINX Instance Manager Helm Chart (helm pull)\nDESCRIPTION: This command downloads the NGINX Instance Manager Helm chart from the specified repository. It requires the repository to be added and updated beforehand. Replace `nms` with the actual chart name if it differs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nhelm pull nginx-stable/nms\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Agent using API (Shell)\nDESCRIPTION: This snippet downloads and executes the `install.sh` script from the Nginx Instance Manager host to install Nginx Agent. It uses `curl` to download the script and `sudo sh` to execute it with superuser privileges.  It also showcases the use of flags to set the child fields for 'nap_monitoring' and config field 'precompiled_publication'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/set-up-app-protect-instances.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\n# Download install script via API\ncurl https://<NMS_FQDN>/install/nginx-agent > install.sh\n\n# Use the flag --nap-monitoring to set the child fields for the field 'nap_monitoring', the\n# child field values will be set to the values in the example configuration from above. Specify\n# the -m | --nginx-app-protect-mode flag to set up management of NGINX App Protect on the instance.\n# In the example below we specify 'precompiled-publication' for the flag value which will make the\n# config field 'precompiled_publication' set to 'true', if you would like to set the config field\n# 'precompiled_publication' to 'false' you can specify 'none' as the flag value.\nsudo sh ./install.sh --nap-monitoring true --nginx-app-protect-mode precompiled-publication\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Plus (Ubuntu 20.04)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Plus package from Ubuntu 20.04. It uses the `apt-get remove` command to remove the `app-protect-module-plus` package. Requires root privileges and the apt package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_67\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get remove app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Configuring JWT Access Profile in NGINX App Protect WAF (Shell)\nDESCRIPTION: This shell configuration example demonstrates how to configure an access profile named 'access_profile_jwt' in NGINX App Protect WAF to authenticate JSON Web Tokens. The access profile is configured to enforce a maximum token length of 2000, verifies the digital signature, and is located in the authorization header. This example showcases the enforcement settings, location, and access profile settings for JWT authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_3\n\nLANGUAGE: Shell\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"jwt_policy\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"access-profiles\": [\n         {\n            \"description\": \"\",\n            \"enforceMaximumLength\": true,\n            \"enforceValidityPeriod\": false,\n            \"keyFiles\": [\n               {\n                  \"contents\": \"{\\r\\n  \\\"keys\\\": [\\r\\n    {\\r\\n      \\\"alg\\\": \\\"RS256\\\",\\r\\n      \\\"e\\\": \\\"AQAB\\\",\\r\\n      \\\"kid\\\": \\\"1234\\\",\\r\\n      \\\"kty\\\": \\\"RSA\\\",\\r\\n      \\\"n\\\": \\\"tSbi8WYTScbuM4fe5qe4l60A2SG5oo3u5JDBtH_dPJTeQICRkrgLD6oyyHJc9BCe9abX4FEq_Qd1SYHBdl838g48FWblISBpn9--B4D9O5TPh90zAYP65VnViKun__XHGrfGT65S9HFykvo2KxhtxOFAFw0rE6s5nnKPwhYbV7omVS71KeT3B_u7wHsfyBXujr_cxzFYmyg165Yx9Z5vI1D-pg4EJLXIo5qZDxr82jlIB6EdLCL2s5vtmDhHzwQSdSOMWEp706UgjPl_NFMideiPXsEzdcx2y1cS97gyElhmWcODl4q3RgcGTlWIPFhrnobhoRtiCZzvlphu8Nqn6Q\\\",\\r\\n      \\\"use\\\": \\\"sig\\\",\\r\\n      \\\"x5c\\\": [\\r\\n        \\\"MIID1zCCAr+gAwIBAgIJAJ/bOlwBpErqMA0GCSqGSIb3DQEBCwUAMIGAMQswCQYDVQQGEwJpbDEPMA0GA1UECAwGaXNyYWVsMRAwDgYDVQQHDAd0ZWxhdml2MRMwEQYDVQQKDApmNW5ldHdvcmtzMQwwCgYDVQQLDANkZXYxDDAKBgNVBAMMA21heDEdMBsGCSqGSIb3DQEJARYOaG93ZHlAbWF0ZS5jb20wIBcNMjIxMTA3MTM0ODQzWhgPMjA1MDAzMjUxMzQ4NDNaMIGAMQswCQYDVQQGEwJpbDEPMA0GA1UECAwGaXNyYWVsMRAwDgYDVQQHDAd0ZWxhdml2MRMwEQYDVQQKDApmNW5ldHdvcmtzMQwwCgYDVQQLDANkZXYxDDAKBgNVBAMMA21heDEdMBsGCSqGSIb3DQEJARYOaG93ZHlAbWF0ZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC1JuLxZhNJxu4zh97mp7iXrQDZIbmije7kkMG0f908lN5AgJGSuAsPqjLIclz0EJ71ptfgUSr9B3VJgcF2XzfyDjwVZuUhIGmf374HgP07lM+H3TMBg/rlWdWIq6f/9ccat8ZPrlL0cXKS+jYrGG3E4UAXDSsTqzmeco/CFhtXuiZVLvUp5PcH+7vAex/IFe6Ov9zHMVibKDXrljH1nm8jUP6mDgQktcijmpkPGvzaOUgHoR0sIvazm+2YOEfPBBJ1I4xYSnvTpSCM+X80UyJ16I9ewTN1zHbLVxL3uDISWGZZw4OXirdGBwZOVYg8WGuehuGhG2IJnO+WmG7w2qfpAgMBAAGjUDBOMB0GA1UdDgQWBBSHykVOY3Q1bWmwFmJbzBkQdyGtkTAfBgNVHSMEGDAWgBSHykVOY3Q1bWmwFmJbzBkQdyGtkTAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQCgcgp72Xw6qzbGLHyNMaCm9A6smtquKTdFCXLWVSOBix6WAJGPv1iKOvvMNF8ZV2RU44vS4Qa+o1ViBN8DXuddmRbShtvxcJzRKy1I73szZBMlZL6euRB1KN4m8tBtDj+rfKtPpheMtwIPbiukRjJrzRzSz3LXAAlxEIEgYSifKpL/okYZYRY6JF5PwSR0cvrfe/qa/G2iYF6Ps7knxy424RK6gpMbnhxb2gdhLPqDE50uxkr6dVHXbc85AuwAi983tOMhTyzDh3XTBEt2hr26F7jSeniC7TTIxmMgDdtYzRMwdb1XbubdtzUPnB/SW7jemK9I45kpKlUBDZD/QwER\\\"\\r\\n      ]\\r\\n    }\\r\\n  ]\\r\\n}\",  # there can be more only one JWKs file (contents) in the policy JSON schema, however, the total amount of JWK in the JWKs is limited to 10.\n                  \"fileName\": \"JWKSFile.json\"\n               }\n            ],\n            \"location\": {\n               \"in\": \"header\",  # the other option is: \"query\"\n               \"name\": \"authorization\"  # the name of the header or parameter (according to \"part\")\n            },\n            \"maximumLength\": 2000,\n            \"name\": \"access_profile_jwt\",\n            \"type\": \"jwt\",\n            \"usernameExtraction\": {\n               \"claimPropertyName\": \"sub\",\n               \"enabled\": true,\n               \"isMandatory\": false\n            },\n            \"verifyDigitalSignature\": true\n        }\n      ],\n      \"urls\": [\n         {\n            \"name\": \"/jwt\",\n            \"accessProfile\": {\n               \"name\": \"access_profile_jwt\"\n            },\n            \"attackSignaturesCheck\": true,\n            \"isAllowed\": true,\n            \"mandatoryBody\": false,\n            \"method\": \"*\",\n            \"methodsOverrideOnUrlCheck\": false,\n            \"name\": \"/jwt\",\n            \"performStaging\": false,\n            \"protocol\": \"http\",\n            \"type\": \"explicit\"\n         }\n      ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Updating Default Policy - app_protect_strict_policy - Shell\nDESCRIPTION: This command updates the `app_protect_strict_policy` using the `-factory-policy` option. It mounts the current working directory into the container, uses the `waf-compiler-1.0.0:custom` image and saves the output to `new_strict_policy.tgz`. Requires a compiler image named `waf-compiler-1.0.0:custom`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ndocker run \\\n -v $(pwd):$(pwd) \\\n waf-compiler-1.0.0:custom \\\n -factory-policy strict -o $(pwd)/new_strict_policy.tgz\n```\n\n----------------------------------------\n\nTITLE: Build NGINX OSS Image (Debian, Older Agent)\nDESCRIPTION: Builds an NGINX Open Source image with Debian as the base operating system and a specific older version of the NGINX Agent. The `OS_RELEASE` and `OS_VERSION` variables define the Debian distribution, and `NGINX_AGENT_VERSION` specifies the agent version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nIMAGE_BUILD_TARGET=install-agent-repo NGINX_AGENT_VERSION=2.37.0~bullseye OS_RELEASE=debian OS_VERSION=bullseye-slim make oss-image\n```\n\n----------------------------------------\n\nTITLE: Limiting API access with allow and deny in Nginx\nDESCRIPTION: This snippet demonstrates how to restrict access to the API location using `allow` and `deny` directives, allowing only local network access. Securing the API endpoint is crucial for preventing unauthorized access.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/live-activity-monitoring.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    server {\n        listen 192.168.1.23;\n        # ...\n        location /api {\n            app_protect_dos_api;\n            allow 192.168.1.0/24;\n            deny all;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Complete Nested JWT Example - Nginx Configuration\nDESCRIPTION: This configuration provides a complete example of handling nested JWTs. It defines an upstream block, sets the `auth_jwt_type` to `nested`, specifies the key file, and passes the decrypted JWT payload to the backend application via the `Authorization` header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\nupstream api_server {\n    server 10.0.0.1;\n    server 10.0.0.2;\n}\n\nhttp {\n    server {\n        listen 80;\n\n        auth_jwt          \"API\";\n        auth_jwt_type     nested;\n        auth_jwt_key_file conf/api_secret.jwk;\n\n        proxy_pass       http://api_server;\n        proxy_set_header Authorization \"Bearer $jwt_payload\";\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Download NGINX App Protect Certificates\nDESCRIPTION: This snippet demonstrates how to download the necessary certificates for NGINX App Protect WAF from My F5. These certificates are crucial for building the compiler image and accessing the required resources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nnginx-repo.key\nnginx-repo.crt\n```\n\n----------------------------------------\n\nTITLE: Configuring Nginx Cache Splitting with Pattern Matching in JSON\nDESCRIPTION: This JSON snippet defines the desired state for Nginx cache splitting based on string criteria (pattern matching). It sets up three different storage paths: one for .html files, one for .mp4 files, and one default. The add_header and proxy_cache_valid directives are also configured using the configSnippets API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-caching.md#_snippet_4\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"desiredState\": {\n        \"configSnippets\": {\n            \"uriSnippets\": [\n        {\n            \"directives\": [\n            {\n                \"directive\": \"proxy_cache_valid\",\n                \"args\": [\n                \"any\",\n                \"1m\"\n                ]\n            }\n            ]\n        }\n        ]\n    },\n    \"programmability\": {\n        \"responseHeaderModifications\": [\n            {\n                \"action\": \"ADD\",\n                \"headerName\": \"X-Cache-Status\",\n                \"headerValue\": \"$upstream_cache_status\"\n            }\n        ]\n    },\n    \"caching\": {\n        \"splitConfig\": {\n        \"criteriaType\": \"STRING\",\n        \"key\": \"$request_uri\"\n        },\n        \"diskStores\": [\n        {\n            \"inMemoryStoreSize\": \"10m\",\n            \"inactiveTime\": \"1m\",\n            \"isDefault\": false,\n            \"maxSize\": \"2G\",\n            \"minFree\": \"1m\",\n            \"path\": \"/tmp/hdd1\",\n            \"stringCriteria\": [\"~.html$\"]\n        },\n        {\n            \"inMemoryStoreSize\": \"50m\",\n            \"inactiveTime\": \"1m\",\n            \"isDefault\": false,\n            \"maxSize\": \"1g\",\n            \"minFree\": \"10k\",\n            \"path\": \"/tmp/hdd2\",\n            \"stringCriteria\": [\"~.mp4$\"]\n        },\n        {\n            \"inMemoryStoreSize\": \"30m\",\n            \"inactiveTime\": \"1m\",\n            \"isDefault\": true,\n            \"maxSize\": \"2g\",\n            \"minFree\": \"10k\",\n            \"path\": \"/tmp/default\"\n        }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Component Configuration with WAF Enabled (JSON)\nDESCRIPTION: This JSON snippet shows a complete Component configuration with WAF enabled using a security strategy in NGINX Controller.  It demonstrates how to integrate WAF functionality into a component's desired state. The `strategyRef` points to a security strategy containing WAF configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/add-app-security-with-waf.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"secure\",\n        \"displayName\": \"protected web server\",\n        \"description\": \"ProtectedWeb Server\",\n        \"tags\": [\n            \"dev\",\n            \"protected\"\n        ]\n    },\n    \"desiredState\": {\n        \"ingress\": {\n            \"gatewayRefs\": [\n                {\n                    \"ref\": \"/services/environments/dev/gateways/dev-gw\"\n                }\n            ],\n            \"uris\": {\n                \"/secure\": {\n                    \"matchMethod\": \"PREFIX\"\n                }\n            }\n        },\n        \"security\": {\n            \"strategyRef\": {\n                \"ref\": \"/security/strategies/balanced_default\"\n            },\n            \"waf\": {\n                \"isEnabled\": true\n            }\n        },\n        \"backend\": {\n            \"ntlmAuthentication\": \"DISABLED\",\n            \"preserveHostHeader\": \"DISABLED\",\n            \"workloadGroups\": {\n                \"farm\": {\n                    \"locationRefs\": [\n                        {\n                            \"ref\": \"/infrastructure/locations/unspecified\"\n                        }\n                    ],\n                    \"loadBalancingMethod\": {\n                        \"type\": \"ROUND_ROBIN\"\n                    },\n                    \"uris\": {\n                        \"http://{{workload-1}}:8080\": {\n                            \"isBackup\": false,\n                            \"isDown\": false,\n                            \"isDrain\": false,\n                            \"resolve\": \"DISABLED\"\n                        },\n                        \"http://{{workload-2}}:8080\": {\n                            \"isBackup\": false,\n                            \"isDown\": false,\n                            \"isDrain\": false,\n                            \"resolve\": \"DISABLED\"\n                        },\n                        \"http://{{workload-3}}:8080\": {\n                            \"isBackup\": false,\n                            \"isDown\": false,\n                            \"resolve\": \"DISABLED\"\n                        },\n                        \"http://{{workload-4}}:8080\": {\n                            \"isBackup\": false,\n                            \"isDown\": false,\n                            \"isDrain\": false,\n                            \"resolve\": \"DISABLED\"\n                        }\n                    }\n                }\n            }\n        },\n        \"logging\": {\n            \"errorLog\": \"ENABLED\",\n            \"accessLog\": {\n                \"state\": \"DISABLED\",\n                \"format\": \"\"\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisites for NGINX on Ubuntu\nDESCRIPTION: This command installs necessary tools for managing and verifying packages from the official NGINX repository. It includes curl for downloading files, gnupg2 for verifying cryptographic signatures, ca-certificates for SSL certificate verification, lsb-release for determining the Linux distribution version, and ubuntu-keyring for managing GPG keys.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_21\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt install curl gnupg2 ca-certificates lsb-release ubuntu-keyring\n```\n\n----------------------------------------\n\nTITLE: Upstream Configuration with Sticky Learn\nDESCRIPTION: This snippet configures session persistence using the `sticky learn` directive in NGINX Plus.  It monitors the `JSESSIONID` cookie from the upstream server and client to maintain session affinity. A shared memory zone is created to store session information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_29\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream weblogic {\n    server 192.168.25.33:7001;\n    server 192.168.25.69:7001;\n    sticky learn create=$upstream_cookie_JSESSIONID\n                 lookup=$cookie_JSESSIONID\n                 zone=client_sessions:1m;\n}\n```\n\n----------------------------------------\n\nTITLE: Using Environment Variables\nDESCRIPTION: This demonstrates how to configure NGINX Agent using environment variables. First, the environment variable is exported with a value, and then the `nginx-agent` command is executed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_10\n\nLANGUAGE: sh\nCODE:\n```\nexport ENV_VARIABLE_NAME=\"value\"\nnginx-agent\n```\n\n----------------------------------------\n\nTITLE: Configure Syslog Logging\nDESCRIPTION: This code snippet shows how to configure the NGINX Controller Agent to collect logs using `syslog`. This is useful in environments where NGINX logs are not stored on disk, such as containerized environments. It involves adding a `[listeners]` section and a `[listener_syslog-default]` section to the `agent.conf` file, and restarting the agent, as well as modifying the nginx config file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-the-agent.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\n[listeners]\nkeys = syslog-default\n\n[listener_syslog-default]\naddress = 127.0.0.1:12000\n```\n\n----------------------------------------\n\nTITLE: Stop NGINX Instance Manager\nDESCRIPTION: This command stops the NGINX Instance Manager service (`nms`). This is a preliminary step before performing tasks like migrating secrets or changing the configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-vault.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl stop nms\n```\n\n----------------------------------------\n\nTITLE: Configure Security Logs to a File Path\nDESCRIPTION: This snippet configures NGINX App Protect security logs to be written to a file path. Logs written under `/var/log/app_protect` are sent to the sink configured in Diagnostic Setting. The log configuration file and the file path are specified.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/enable-logging.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log \"/etc/app_protect/conf/log_all.json\" /var/log/app_protect/security.log;\n```\n\n----------------------------------------\n\nTITLE: Netcat Log Redirection\nDESCRIPTION: This command uses Netcat to listen on a specified IP address and port, redirecting all received data to a specified file. It captures both standard output and standard error streams.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/security-log.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nnc -vv -l “[ip]” “[port]” > “[name_of_file]” 2>&1\n```\n\n----------------------------------------\n\nTITLE: Reloading NGINX configuration\nDESCRIPTION: This command gracefully reloads the NGINX configuration without interrupting existing connections. It applies changes made to the configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/passenger-open-source.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Displaying Configuration Differences using diff (Diff)\nDESCRIPTION: This `diff` output shows the differences between two Nginx configuration files. Specifically, it highlights a change in the `return` statement within the `location /` block, where the string \"blue\" is replaced with \"red\". This output is typically generated by a configuration management tool or a synchronization script to indicate changes that need to be applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_13\n\nLANGUAGE: diff\nCODE:\n```\ndiff -ru /tmp/localconf.1XrIqP7f/etc/nginx/conf.d/responder.conf /tmp/remoteconf.Xq5LWGKU/etc/nginx/conf.d/responder.conf\n--- /tmp/localconf.1XrIqP7f/etc/nginx/conf.d/responder.conf\t2020-09-25 10:29:36.988064021 -0800\n+++ /tmp/remoteconf.Xq5LWGKU/etc/nginx/conf.d/responder.conf\t2020-09-25 10:28:39.764066539 -0800\n@@ -4,6 +4,6 @@\n    listen 80;\n\n    location / {\n-        return 200 \"Received request on $server_addr on host $hostname blue\\n\";\n+        return 200 \"Received request on $server_addr on host $hostname red\\n\";\n    }\n}\n\n* Synchronization ended at Fri Sep 25 18:30:49 UTC 2020\n```\n\n----------------------------------------\n\nTITLE: Define Logging Volume in Dockerfile (Dockerfile)\nDESCRIPTION: This Dockerfile defines a Docker volume for the logging directory /var/log/nginx/log within the Nginx container.  It assumes content and configuration files are managed as previously defined.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_32\n\nLANGUAGE: dockerfile\nCODE:\n```\nFROM nginx\nCOPY content /usr/share/nginx/html\nCOPY conf /etc/nginx\nVOLUME /var/log/nginx/log\n```\n\n----------------------------------------\n\nTITLE: Enabling stub_status Module in Nginx\nDESCRIPTION: This snippet demonstrates how to enable the `stub_status` module in an Nginx configuration file. It creates a new configuration file `stub_status.conf` in the `conf.d` directory, defining a server block that listens on `127.0.0.1:80` and exposes the stub_status metrics at the `/nginx_status` location. Access is restricted to localhost (127.0.0.1).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/configuring-metric-collection.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n# cd /etc/nginx\n\n# grep -i include\\.*conf nginx.conf\n    include /etc/nginx/conf.d/*.conf;\n\n# cat > conf.d/stub_status.conf\nserver {\n    listen 127.0.0.1:80;\n    server_name 127.0.0.1;\n    location /nginx_status {\n        stub_status on;\n        allow 127.0.0.1;\n        deny all;\n    }\n}\n<Ctrl-D>\n\n# ls -la conf.d/stub_status.conf\n-rw-r--r-- 1 root root 162 Nov  4 02:40 conf.d/stub_status.conf\n\n# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n\n# kill -HUP `cat /var/run/nginx.pid`\n```\n\n----------------------------------------\n\nTITLE: Defining Proxy Cache Path in NGINX (HTTP block)\nDESCRIPTION: This configuration sets up the path for the proxy cache, defining the directory and a keys zone for metadata storage. The `proxy_cache_path` directive specifies the location on disk where cached files will be stored, and `keys_zone` allocates shared memory for storing cache metadata. This is usually placed inside the http block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_34\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /tmp/NGINX_cache/ keys_zone=backcache:10m;\n```\n\n----------------------------------------\n\nTITLE: Retrieving Pods Status using Kubectl\nDESCRIPTION: This command retrieves the status of all Pods running in the default namespace. It is used to verify that the bursty-client and destination Pods are running correctly before applying rate limiting configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_18\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get pods\n```\n\n----------------------------------------\n\nTITLE: Load Nginx App Protect Module\nDESCRIPTION: Loads the NGINX App Protect WAF module within the main NGINX configuration context. This directive enables the WAF functionality by loading the specified shared object. Ensure the path to the module is correct and accessible.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n```\n\n----------------------------------------\n\nTITLE: Setting Default Actions for Trustwave Rules - Nginx\nDESCRIPTION: This snippet sets the `SecDefaultAction` directive within `/etc/nginx/modsec/main.conf` to block malicious requests.  It configures the ModSecurity WAF to deny requests and return a 403 status code. This is added below the `SecRemoteRules` directive to ensure downloaded rules are enforced by default.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-trustwave-spiderlabs-rules.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nSecDefaultAction \"phase:2,log,auditlog,deny,status:403\"\nSecDefaultAction \"phase:1,log,auditlog,deny,status:403\"\n```\n\n----------------------------------------\n\nTITLE: Define Custom Log Format for SSL Parameters (NGINX)\nDESCRIPTION: This snippet defines a custom log format named `sslparams` that captures the SSL protocol version, cipher used, client IP address, and User-Agent header. It uses NGINX variables to extract this information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/logging.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nlog_format sslparams '$ssl_protocol $ssl_cipher '\n                     '$remote_addr \"$http_user_agent\"';\n```\n\n----------------------------------------\n\nTITLE: Set OIDC Provider Details in NGINX\nDESCRIPTION: This snippet configures the OneLogin OIDC provider within the `oidc_provider` block. It sets the `issuer` URL, `client_id`, and `client_secret`. The `issuer` points to the OneLogin OIDC endpoint.  The `client_id` and `client_secret` are obtained from the OneLogin application configuration and are used to authenticate NGINX Plus with OneLogin.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/onelogin.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider onelogin {\n        issuer        https://<subdomain>.onelogin.com/oidc/2;\n        client_id     <client_id>;\n        client_secret <client_secret>;\n    }\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Example OpenID Configuration JSON\nDESCRIPTION: This JSON shows an example of the OpenID Connect configuration metadata returned by Auth0.  It includes the issuer, authorization_endpoint, token_endpoint, and jwks_uri. The issuer value is required for configuring NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/auth0.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    ...\n    \"issuer\": \"https://{yourTenantId}.us.auth0.com/\",\n    \"authorization_endpoint\": \"https://{yourTenantId}.us.auth0.com/oauth/token\",\n    \"token_endpoint\": \"https://{yourTenantId}.us.auth0.com/oauth/token\",\n    \"jwks_uri\": \"https://{yourTenantId}.us.auth0.com/.well-known/jwks.json\",\n    ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring ECP Location Block for HTTPS Traffic with Access Control in Nginx\nDESCRIPTION: This snippet configures the location block for the Exchange Control Panel ('/ecp') in the 'server' block for HTTPS traffic in Nginx. It includes commented-out directives for access control (allow/deny), and proxies requests to the 'exchange-ecp' upstream, sets the HTTP version to 1.1, and clears the Connection header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_44\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /ecp {\n    #allow 172.16.0.0/16; # Replace with your admin network\n    #deny all;\n    proxy_pass https://exchange-ecp;\n    proxy_http_version 1.1;\n    proxy_set_header Connection \"\";\n}\n```\n\n----------------------------------------\n\nTITLE: Querying Dimensions Catalog API\nDESCRIPTION: This curl command retrieves the list of available dimensions from the Dimensions Catalog API. It uses a GET request and requires a valid access token provided in the Authorization header. The response provides a comprehensive list of dimensions that can be used to filter and group metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/catalogs/dimensions\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Pass Request to Upstream Server with multiple upstreams\nDESCRIPTION: This snippet demonstrates a complete Nginx configuration using GeoIP2 and upstream server groups for continent-based redirection. It includes the `geoip2`, `map`, `server`, and multiple `upstream` blocks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_18\n\nLANGUAGE: nginx\nCODE:\n```\n#...\nserver {\n    listen 12346;\n    proxy_pass http://$nearest_server;\n}\n\nupstream all {\n    server all1.example.com:12345;\n    server all2.example.com:12345;\n\nupstream eu {\n    server eu1.example.com:12345;\n    server eu2.example.com:12345;\n}\nupstream na {\n    server na1.example.com:12345;\n    server na2.example.com:12345;\n}\n#...\n```\n\n----------------------------------------\n\nTITLE: Dockerfile for NGINX Plus and App Protect\nDESCRIPTION: This Dockerfile installs Nginx Plus and App Protect WAF module on a Red Hat UBI base image. It uses secrets for the Nginx repository certificate and key, and configures package repositories to install the necessary packages. It exposes port 80 and defines the stop signal and default command for the Nginx container.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-plus/build-rhel.md#_snippet_0\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Supported UBI_VERSION's are 7/8/9\nARG UBI_VERSION=9\n\n# Base Image\nFROM registry.access.redhat.com/ubi${UBI_VERSION}/ubi\n\n# Define the ARG again after FROM to use it in this stage\nARG UBI_VERSION\n\n# Install NGINX Plus and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    PKG_MANAGER=dnf; \\\n    if [ \"${UBI_VERSION}\" = \"7\" ]; then \\\n        PKG_MANAGER=yum; \\\n        NGINX_PLUS_REPO=\"nginx-plus-7.4.repo\"; \\\n    elif [ \"${UBI_VERSION}\" = \"9\" ]; then \\\n        NGINX_PLUS_REPO=\"plus-${UBI_VERSION}.repo\"; \\\n    else \\\n        NGINX_PLUS_REPO=\"nginx-plus-${UBI_VERSION}.repo\"; \\\n    fi \\\n    && $PKG_MANAGER -y install wget ca-certificates \\\n    && wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo \\\n    && wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/${NGINX_PLUS_REPO} \\\n    && echo \"[app-protect-x-plus]\" > /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-plus.repo \\\n    && echo \"name=nginx-app-protect repo\" >> /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-plus.repo \\\n    && echo \"baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/${UBI_VERSION}/\\$basearch/\" >> /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-plus.repo \\\n    && echo \"sslclientcert=/etc/ssl/nginx/nginx-repo.crt\" >> /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-plus.repo \\\n    && echo \"sslclientkey=/etc/ssl/nginx/nginx-repo.key\" >> /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-plus.repo \\\n    && echo \"gpgcheck=0\" >> /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-plus.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-plus.repo \\\n    && $PKG_MANAGER clean all \\\n    && $PKG_MANAGER install -y app-protect-module-plus \\\n    && $PKG_MANAGER clean all \\\n    && rm -rf /var/cache/$PKG_MANAGER \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log\n\n# Expose port\nEXPOSE 80\n\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS SRV Records - Nginx\nDESCRIPTION: This configuration snippet extends the DNS configuration to utilize SRV records. The 'service' parameter, along with the 'resolve' parameter, instructs NGINX Plus to use the additional information provided in the SRV records, such as the port number. This allows more flexible and dynamic configuration of the upstream servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_43\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nresolver <IP-address-of-DNS-server>;\n\nupstream tomcat {\n    zone tomcat 64k;\n    server example.com service=http resolve;\n}\n```\n\n----------------------------------------\n\nTITLE: Replace Certificate via REST API (bash)\nDESCRIPTION: This cURL command sends a PUT request to the NGINX Instance Manager REST API to replace an existing certificate.  It requires the certificate name and details, including the private key, public certificate, and CA certificates, all base64 encoded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/manage-certificates.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X PUT \"https://nginx-manager.example.com/api/platform/v1/certs/pem_cert_with_ca\" \\\n  -H \"accept: application/json\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"pem_cert_with_ca\",\n    \"certPEMDetails\": {\n      \"type\": \"PEM\",\n      \"privateKey\": \"-----BEGIN PRIVATE KEY-----<base64-encoded blob>-----END PRIVATE KEY-----\",\n      \"publicCert\": \"-----BEGIN CERTIFICATE-----<base64-encoded blob>-----END CERTIFICATE-----\",\n      \"password\": \"\",\n      \"caCerts\": [\n        \"-----BEGIN CERTIFICATE-----<base64-encoded blob>-----END CERTIFICATE-----\"\n      ]\n    },\n    \"instanceRefs\": [\n      \"/api/platform/v1/systems/<system-uuid>/instances/<instance-uuid>\"\n    ]\n  }'\n```\n\n----------------------------------------\n\nTITLE: Installing GeoIP2 Module on Alpine\nDESCRIPTION: This command installs the `nginx-plus-module-geoip2` package on Alpine Linux systems. The module is necessary for leveraging MaxMind GeoIP2 databases within Nginx Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip2.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-geoip2\n```\n\n----------------------------------------\n\nTITLE: Copy CRS Setup Configuration\nDESCRIPTION: This snippet copies the example CRS setup configuration file to a working configuration file. This allows customizations to be made without altering the original example file.  It assumes the OWASP CRS has been extracted to /usr/local/owasp-modsecurity-crs-3.0.2.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\ncd /usr/local/owasp-modsecurity-crs-3.0.2\nsudo cp crs-setup.conf.example crs-setup.conf\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX Plus repository on Ubuntu\nDESCRIPTION: This snippet adds the NGINX Plus repository to the apt sources list on Ubuntu. It uses printf and tee to write the repository configuration to a new file in the sources.list.d directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_31\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-plus.list\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX with App Protect WAF\nDESCRIPTION: This snippet configures Nginx to use the App Protect WAF module by loading it and setting the address of the enforcer.  It also sets up user, worker processes, error logging, events, and the HTTP context with include directives for MIME types and custom configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/nginx-conf-localhost.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nuser  nginx;\nworker_processes  auto;\n\n# NGINX App Protect WAF\nload_module modules/ngx_http_app_protect_module.so;\n\nerror_log  /var/log/nginx/error.log notice;\npid        /var/run/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                    '$status $body_bytes_sent \"$http_referer\" '\n                    '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    # NGINX App Protect WAF\n    app_protect_enforcer_address 127.0.0.1:50000;\n\n    include /etc/nginx/conf.d/*.conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Custom Cache Key for Nginx Proxy\nDESCRIPTION: This snippet configures a custom cache key for Nginx. It includes the `$proxy_host`, `$request_uri`, and `$cookie_jessionid` variables in the key to create a unique cache entry for each user based on their session.  This ensures that cached content is specific to each user's session.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_23\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_key $proxy_host$request_uri$cookie_jessionid;\n```\n\n----------------------------------------\n\nTITLE: Specifying SSL Certificate and Key for Nginx TCP Proxy\nDESCRIPTION: This configuration sets the paths to the SSL certificate and private key used for authenticating NGINX to the upstream server. The `proxy_ssl_certificate` and `proxy_ssl_certificate_key` directives are used to specify the file paths.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-tcp-traffic-upstream.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n        ...\n        proxy_ssl_certificate     /etc/ssl/certs/backend.crt;\n        proxy_ssl_certificate_key /etc/ssl/certs/backend.key;\n}\n```\n\n----------------------------------------\n\nTITLE: Querying Security Violation Events by Remote Address (Client IP)\nDESCRIPTION: This example shows how to retrieve events from a specific remote address (client IP) using the NGINX Controller REST API. The startTime is set to 0 and endTime to now.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/view-app-security-analytics.md#_snippet_12\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            http.remote_addr='172.18.71.147' and\n            app='shopping' and\n            environment='prod' and\n            component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Update and Install NGINX App Protect WAF - Debian\nDESCRIPTION: These commands update the apt package lists and install the latest supported NGINX App Protect WAF package. The `sudo apt-get update` command refreshes the package lists from the configured repositories.  The `sudo apt-get install nginx-plus-module-appprotect` command installs the NGINX App Protect WAF module for NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_22\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get update\nsudo apt-get install nginx-plus-module-appprotect\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX with Debug Symbols (GCC)\nDESCRIPTION: This configures NGINX to include debugging symbols and disables compiler optimization for easier debugging, specifically for the GCC compiler system. The \"-g\" flag includes debugging symbols, and the \"-O0\" flag disables compiler optimization.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\n./configure --with-debug --with-cc-opt='-O0 -g' ...\n```\n\n----------------------------------------\n\nTITLE: Apply ClientSettingsPolicy to Gateway\nDESCRIPTION: This snippet applies a ClientSettingsPolicy to the Gateway, limiting the maximum client body size to 50 bytes. It uses kubectl apply with an inline YAML definition.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_8\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.nginx.org/v1alpha1\nkind: ClientSettingsPolicy\nmetadata:\n  name: gateway-client-settings\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: Gateway\n    name: gateway\n  body:\n    maxSize: \"50\" # sizes without a unit are bytes.\nEOF\n```\n\n----------------------------------------\n\nTITLE: Define AD FS OIDC Provider in NGINX\nDESCRIPTION: This snippet defines the AD FS OIDC provider within the `http` context using the `oidc_provider` directive. This block configures the interaction with the AD FS server, including client ID, client secret, and issuer URL.  It relies on the resolver being configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/active-directory-federation-services.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider adfs {\n\n        # ...\n\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX: Full Configuration for Single Web Entry Point\nDESCRIPTION: This configuration sets up NGINX for a single web entry point, including user, worker processes, error logging, and PID configuration. It defines an upstream for Oracle servers, configures HTTP to HTTPS redirection, and sets up an HTTPS server with SSL/TLS, caching, and health checks. It also includes live activity monitoring configuration with API access and a built-in dashboard.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_40\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nworker_processes auto;\nerror_log /var/log/nginx/error.log info;\npid /var/run/nginx.pid;\n\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    include /etc/nginx/mime.types;\n    default_type text/html;\n    proxy_cache_path /var/oracle-cache keys_zone=cache_oracle:50m max_size=500m;\n\n    # Custom logging configuration\n    log_format main '$remote_addr - $remote_user [$time_local]\n                    \"$request\" $status $body_bytes_sent \"$http_referer\"\n                    \"$http_user_agent\" $upstream_addr';\n    access_log /var/log/nginx/access.log main;\n\n    upstream oracle {\n        zone oracle 64k;\n\n        # Production servers\n        server 172.31.11.210:8000 max_fails=0;\n        server 172.31.0.146:8000 max_fails=0;\n\n        # Disaster recovery servers\n        server 172.33.111.210:8000 max_fails=0 backup;\n        server 172.33.100.146:8000 max_fails=0 backup;\n\n        # Session persistence\n        sticky cookie ngxcookie;\n    }\n\n    server {\n        listen 80;\n        status_zone oracle-http-redirect;\n        return 302 https://$http_host$request_uri;\n    }\n\n    server {\n        listen 443 ssl;\n        http2  on;\n        server_name company.com;\n        ssl_certificate     /etc/nginx/ssl/certificate-name.crt;\n        ssl_certificate_key /etc/nginx/ssl/private-key.key;\n        ssl_protocols       TLSv1.2;\n        status_zone oracle-ssl;\n        proxy_cache cache_oracle;\n\n        location / {\n            proxy_pass http://oracle;\n            proxy_set_header Host $host;\n            proxy_cache_valid any 1h;\n        }\n\n        location @health_check {\n            internal;\n            proxy_connect_timeout 3s;\n            proxy_read_timeout 3s;\n            proxy_pass http://oracle;\n            proxy_set_header Host \"oracle.company.com\";\n            health_check match=oracleok interval=4s\n                         uri=/OA_HTML/AppsLocalLogin.jsp;\n        }\n    }\n\n    match oracleok {\n        status 200-399;\n        header X-ORACLE-DMS-ECID;\n    }\n\n    # Live activity monitoring configuration\n    server {\n        # Status zone required for live activity monitoring. Enable it for\n        # every 'server' block in other configuration files.\n        status_zone status-page;\n\n        # If NGINX Plus is listening on multiple IP addresses, uncomment this\n        # directive to restrict access to the live activity monitoring\n        # dashboard to a single IP address (substitute the appropriate\n        # address).\n        # listen 10.2.3.4:8080;\n        # Live activity monitoring is enabled on port 8080 by default.\n        listen 8080;\n\n        # HTTP Basic authentication is enabled by default. Use an htpasswd\n        # generator to add users, or command-line and other management tools are\n        # readily available online. If you have Apache HTTP Server installed, you\n        # can reuse its htpasswd file.\n        #auth_basic on;\n        #auth_basic_user_file /etc/nginx/users;\n\n        # Limit access to the dashboard to users on admin networks only.\n        # Uncomment the \"allow\" directive and change the IP address.\n        #allow 10.0.0.0/8;\n        deny all;\n\n        # Enable the NGINX Plus API for metrics collection.\n        location /api {\n            api write=on;\n            access_log off;\n        }\n\n        # NGINX Plus includes a built-in dashboard.\n        location = /dashboard.html {\n            root /usr/share/nginx/html;\n        }\n\n        # Redirect requests made to the pre-R14 dashboard.\n        location = /status.html {\n            return 301 /dashboard.html;\n        }\n\n        # Standard HTTP features are fully supported with the dashboard.\n        # Redirect request for '/' to '/dashboard.html'.\n        location = / {\n            return 301 /dashboard.html;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Arbitrator FQDN in NGINX\nDESCRIPTION: This snippet demonstrates how to configure the Arbitrator FQDN using the `app_protect_dos_arb_fqdn` directive. This directive specifies the FQDN or IP address of the desired Arbitrator.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_dos_arb_fqdn svc-appprotect-dos-arb.arb.svc.cluster.local;\n```\n\n----------------------------------------\n\nTITLE: NGINX: Test Application Configuration\nDESCRIPTION: This configuration defines a simple test application that listens on port 8080. It returns a 200 OK response with a message including the authenticated user's full name, email, and sub, which are obtained from the headers passed by NGINX Plus after successful authentication. This is useful for verifying that the OIDC setup is working correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/keycloak.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nserver {\n    listen 8080;\n\n    location / {\n        return 200 \"Hello, $http_name!\\nEmail: $http_email\\nSub: $http_sub\\n\";\n        default_type text/plain;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Security Logging to Stderr in NGINX\nDESCRIPTION: This snippet demonstrates configuring the security log destination to stderr using the `app_protect_dos_security_log` directive. This directive specifies the configuration file path and sets the destination to stderr.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_dos_security_log \"/etc/app_protect_dos/log-default.json\" stderr;\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX with Debug Support\nDESCRIPTION: This command configures NGINX with debugging support using the `--with-debug` flag, along with any other existing configure arguments.  This step is essential before compiling NGINX from source with debug symbols.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\n./configure --with-debug <other configure arguments>\n```\n\n----------------------------------------\n\nTITLE: Downloading Enhanced Load Balancing Configuration\nDESCRIPTION: These commands download the enhanced load balancing configuration file from the nginx.com website and save it as `nodejs-enhanced.conf` in the `/etc/nginx/conf.d` directory. Similar to the basic configuration, the commands first change the directory to `/etc/nginx/conf.d` and then uses `curl` to download the file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_7\n\nLANGUAGE: none\nCODE:\n```\nroot# cd /etc/nginx/conf.d\nroot# curl https://www.nginx.com/resource/conf/nodejs-enhanced.conf > nodejs-enhanced.conf\n```\n\n----------------------------------------\n\nTITLE: Installing Brotli Module on Debian and Ubuntu\nDESCRIPTION: This command updates the package lists and installs the nginx-plus-module-brotli package using the apt package manager. This allows Brotli compression to be enabled in Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/brotli.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-brotli\n```\n\n----------------------------------------\n\nTITLE: Installing GeoIP2 Module on Amazon Linux/AlmaLinux/Rocky Linux\nDESCRIPTION: This command updates the package manager and installs the `nginx-plus-module-geoip2` package on Amazon Linux 2023, AlmaLinux and Rocky Linux systems.  The module allows the usage of MaxMind GeoIP2 databases within Nginx Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip2.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-geoip2\n```\n\n----------------------------------------\n\nTITLE: Configure gRPC HTTPS server with mTLS in Nginx\nDESCRIPTION: Configures a gRPC HTTPS server with mTLS by setting up SSL certificates, enabling client certificate verification, and defining locations for metric ingestion and DPM services. Requires SSL certificates and keys to be generated and placed in `/etc/nms/certs/`. The `server_name` should match the CN or SAN in the server certificate.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\n# gRPC HTTPS server, needs port 443\n    server {\n        listen 443 ssl;\n        http2  on;\n        root   /var/www/nms;\n\n        server_name nginx-instance-manager.example.com;\n\n        ssl_protocols       TLSv1.1 TLSv1.2;\n        ssl_ciphers         HIGH:!aNULL:!MD5;\n        ssl_session_cache   shared:SSL:10m;\n        ssl_session_timeout 10m;\n\n        ssl_certificate         /etc/nms/certs/server.crt;\n        ssl_certificate_key     /etc/nms/certs/server.key;\n        ssl_client_certificate  /etc/nms/certs/ca.pem;\n        ssl_verify_client on;\n\n        # gRPC service for metric ingestion\n        location /f5.nginx.agent.sdk.MetricsService {\n            include /etc/nms/nginx/errors-grpc.loc_conf;\n            grpc_socket_keepalive on;\n            grpc_read_timeout 5m;\n            grpc_send_timeout 5m;\n            client_body_timeout 10m;\n            grpc_pass grpc://ingestion-grpc-service;\n        }\n\n        # gRPC service for DPM\n        location /f5.nginx.agent.sdk.Commander {\n            include /etc/nms/nginx/errors-grpc.loc_conf;\n            grpc_socket_keepalive on;\n            grpc_read_timeout 5m;\n            grpc_send_timeout 5m;\n            client_body_timeout 10m;\n            grpc_pass grpc://dpm-grpc-service;\n        }\n    }\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Gateway Fabric (NGINX Plus Experimental)\nDESCRIPTION: This command deploys NGINX Gateway Fabric with NGINX Plus and experimental features, pulling the image from the NGINX Plus Docker registry. It uses `imagePullSecretName` for pulling the image and requires an NGINX Plus JWT Secret, specified in a volume mount and `--usage-report-secret` parameter. Requires the Gateway APIs installed from the experimental channel and Secrets created in the 'Before you begin' section. It uses `kubectl apply` to apply the configurations specified in the remote YAML file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/deploy/nginx-plus-experimental/deploy.yaml\n```\n\n----------------------------------------\n\nTITLE: Start bd_agent service - Debian and Ubuntu\nDESCRIPTION: This command starts the `bd_agent` service, which is necessary for integration with Controller ADC Agent 3.20.1 or Controller APIM Agent 3.19.2. It uses `su` to run the `bd_agent` process as the `nginx` user.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_26\n\nLANGUAGE: shell\nCODE:\n```\n/bin/su -s /bin/bash -c '/opt/app_protect/bin/bd_agent &' nginx\n```\n\n----------------------------------------\n\nTITLE: Opening the dumped Nginx config file\nDESCRIPTION: Opens the `nginx_conf.txt` file, containing the dumped Nginx configuration, using `vi` editor. This allows verifying the currently loaded configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_31\n\nLANGUAGE: shell\nCODE:\n```\nsudo vi nginx.conf.txt\n```\n\n----------------------------------------\n\nTITLE: Configuring Backup Servers in Nginx Upstream Block\nDESCRIPTION: This snippet demonstrates how to configure backup servers in an Nginx `upstream` block for disaster recovery.  The `backup` parameter is added to the `server` directive to designate the server as a backup. Traffic is only routed to backup servers when all primary servers are down.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_39\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'upstream' block\nserver 172.33.111.210:8000 max_fails=0 backup;\nserver 172.33.100.146:8000 max_fails=0 backup;\n```\n\n----------------------------------------\n\nTITLE: Help Output: User Defined Signatures Converter\nDESCRIPTION: Displays the usage instructions, required and optional arguments for the User Defined Signatures Converter tool. This output appears when running the converter without arguments, or using the --help flag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\nUSAGE:\n    /opt/app_protect/bin/convert-signatures\n\nRequired arguments:\n    --outfile|o='/path/to/signatures.json'\n        File name to write JSON format export\n        Can also be set via an environment variable: EXPORT_FILE\n    --infile|i='/path/to/signatures.xml'\n        Advanced WAF/ASM User Defined Signatures file to Convert\n        Can also be set via an environment variable: IMPORT_FILE\n\nOptional arguments:\n    --tag|t='mytag'\n        Signature Tag to associate with User Defined Signatures.\n        If no tag is specified in the XML file, a default tag of 'user-defined-signatures' will be assigned.\n        Can also be set via an environment variable: TAG\n    --format|f='json'\n        Desired output format for signature file. Default 'json'\n        Supported formats: 'json'\n\nOptionally, using --help will issue this help message.\n```\n\n----------------------------------------\n\nTITLE: Configure Security Logs to NGINXaaS Syslog\nDESCRIPTION: This snippet demonstrates how to configure NGINX App Protect security logs to be sent to the local syslog server running on NGINXaaS, which then forwards them to the sink configured in the Diagnostic Setting.  It specifies the log configuration file and the syslog server address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/enable-logging.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log \"/etc/app_protect/conf/log_all.json\" syslog:server=localhost:5140;\n```\n\n----------------------------------------\n\nTITLE: Deploying Coffee Application and Service (YAML)\nDESCRIPTION: This YAML manifest defines a Kubernetes Deployment and Service for a simple coffee application. The Deployment ensures a single replica of the `nginxdemos/nginx-hello:plain-text` image is running, while the Service exposes the application on port 80, forwarding traffic to the container's port 8080.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/integrating-cert-manager.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: coffee\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: coffee\n  template:\n    metadata:\n      labels:\n        app: coffee\n    spec:\n      containers:\n      - name: coffee\n        image: nginxdemos/nginx-hello:plain-text\n        ports:\n        - containerPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: coffee\nspec:\n  ports:\n  - port: 80\n    targetPort: 8080\n    protocol: TCP\n    name: http\n  selector:\n    app: coffee\n```\n\n----------------------------------------\n\nTITLE: Limiting Connections per Server Name in Nginx\nDESCRIPTION: This example demonstrates how to limit connections based on the `$server_name` variable.  A shared memory zone 'servers' is defined, and then the `limit_conn` directive is used within the `server` block to limit connections to 1000.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    limit_conn_zone $server_name zone=servers:10m;\n\n    server {\n        limit_conn servers 1000;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring WebSocket Proxy\nDESCRIPTION: This configuration snippet sets up NGINX to correctly proxy WebSocket connections to a WebLogic Server backend. It defines a map to set the Connection header based on the presence of the Upgrade header and configures the proxy to use HTTP/1.1 and forward the Upgrade and Connection headers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_20\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n\n# In the 'server' block for HTTPS traffic\nlocation /wstunnel/ {\n    proxy_pass http://weblogic;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection $connection_upgrade;\n}\n```\n\n----------------------------------------\n\nTITLE: External JSON Schema Reference in NGINX App Protect Policy (JSON)\nDESCRIPTION: This policy demonstrates how to reference an external JSON schema file in an NGINX App Protect policy.  The `json-validation-files` array includes a `link` property specifying the location of the schema, which can be a file path or a URL. The policy then associates this schema with a JSON profile.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/handling-xml-and-json-content.md#_snippet_4\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"json_form_policy_external_schema\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"json-validation-files\": [\n            {\n                \"fileName\": \"person_schema.json\",\n                \"link\": \"file://person_schema.json\"\n            }\n        ],\n        \"json-profiles\": [\n            {\n                \"name\": \"reg_form_prof\",\n                \"defenseAttributes\": {\n                    \"maximumArrayLength\": \"any\",\n                    \"maximumStructureDepth\": \"any\",\n                    \"maximumTotalLengthOfJSONData\": 1000,\n                    \"maximumValueLength\": \"any\",\n                    \"tolerateJSONParsingWarnings\": false\n                },\n                \"validationFiles\": [\n                    {\n                        \"isPrimary\": true,\n                        \"jsonValidationFile\": {\n                            \"fileName\": \"person_schema.json\"\n                        }\n                    }\n                ]\n            }\n        ],\n        \"urls\": [\n            {\n                \"name\": \"/register\",\n                \"type\": \"explicit\",\n                \"method\": \"POST\",\n                \"attackSignaturesCheck\": true,\n                \"clickjackingProtection\": false,\n                \"disallowFileUploadOfExecutables\": false,\n                \"isAllowed\": true,\n                \"mandatoryBody\": false,\n                \"methodsOverrideOnUrlCheck\": false,\n                \"urlContentProfiles\": [\n                    {\n                        \"contentProfile\": {\n                            \"name\": \"reg_form_prof\"\n                        },\n                        \"headerName\": \"*\",\n                        \"headerOrder\": \"default\",\n                        \"headerValue\": \"*\",\n                        \"type\": \"json\"\n                    }\n                ]\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Bot Defense with Default Configuration - JSON\nDESCRIPTION: This JSON snippet demonstrates how to enable bot defense using the default bot configuration in an NGINX App Protect policy. It sets the `isEnabled` flag to `true` within the `bot-defense` section of the policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/anti-automation.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"bot_defense_policy\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"bot-defense\": {\n            \"settings\": {\n                \"isEnabled\": true\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Set Up Certificate-Based Authentication\nDESCRIPTION: This snippet configures certificate-based authentication by enabling `ssl_verify_client` and providing `ssl_client_certificate`.  It also includes directives for SSL/TLS and certificate verification, ensuring secure communication between cluster instances. Requires client certificate and CA.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/runtime-state-sharing.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n  resolver 127.0.0.1:49153 valid=20s;\n\n  server {\n    listen 9000 ssl;\n\n    ssl_certificate     /opt/ssl/zone_sync.crt;\n    ssl_certificate_key /opt/ssl/zone_sync.key;\n    ssl_verify_client       on;\n    ssl_client_certificate /opt/ssl/zone_sync_ca.pem;\n\n    zone_sync;\n    zone_sync_server internal.nginxaas.nginx.com:9000 resolve;\n\n    zone_sync_ssl                     on;\n    zone_sync_ssl_verify              on;\n    zone_sync_ssl_trusted_certificate /opt/ssl/zone_sync_ca.pem;\n\n    zone_sync_ssl_certificate     /opt/ssl/zone_sync.crt;\n    zone_sync_ssl_certificate_key /opt/ssl/zone_sync.key;\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Get User/System Assigned Managed Identity ID - Azure CLI\nDESCRIPTION: This snippet retrieves the principal ID of a user-assigned managed identity using the Azure CLI. It requires `MI_NAME` and `MI_RESOURCE_GROUP` environment variables to be set. Specifically for User Assigned Identity.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nmi_principal_id=$(az identity show --name $MI_NAME \\\n         --resource-group $MI_RESOURCE_GROUP \\\n         --query principalId --output tsv)\n```\n\n----------------------------------------\n\nTITLE: Nginx stream health check for HTTP 200 OK\nDESCRIPTION: This snippet configures a stream health check that sends an HTTP GET request to the server and expects a '200 OK' response. It defines an upstream, a match block, and a server block to configure health checks for HTTP traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    upstream   stream_backend {\n        zone   upstream_backend 64k;\n        server backend1.example.com:12345;\n    }\n    match http {\n        send      \"GET / HTTP/1.0\\r\\nHost: localhost\\r\\n\\r\\n\";\n        expect ~* \"200 OK\";\n    }\n    server {\n        listen       12345;\n        health_check match=http;\n        proxy_pass   stream_backend;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Viewing Client Logs\nDESCRIPTION: This command streams the logs of the `client-v1` container, filtering by the `app=client-v1` label. This is used to verify the effect of the rate limit policy by observing denied requests and the timing of successful requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nkubectl logs -l app=client-v1 -f -c client\n```\n\n----------------------------------------\n\nTITLE: Retrieving Rejected Security Violation Events (curl)\nDESCRIPTION: This query retrieves security violation events where the request was rejected by WAF. This helps to identify and investigate incidents where App Security blocked traffic due to detected violations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/view-app-security-analytics.md#_snippet_4\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            request_outcome='REJECTED')\n```\n\n----------------------------------------\n\nTITLE: Checking for debug support\nDESCRIPTION: Checks if the NGINX binary was compiled with debug support using the `--with-debug` configure option. The output from `nginx -V` is piped to `grep` to search for the option.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_27\n\nLANGUAGE: shell\nCODE:\n```\nnginx -V 2>&1 | grep -- '--with-debug'\n```\n\n----------------------------------------\n\nTITLE: Configure GeoIP2 Module in Nginx\nDESCRIPTION: This snippet configures the GeoIP2 module in Nginx to obtain the continent code of the client's IP address.  The `geoip2` block specifies the path to the GeoLite2-Country.mmdb database and defines a variable `$geoip2_data_continent_code` that will store the continent code extracted from the database.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\ngeoip2 GeoIP2/GeoLite2-Country.mmdb {\n    $geoip2_data_continent_code continent code;\n}\n```\n\n----------------------------------------\n\nTITLE: Check NGINX Plus Version (Shell)\nDESCRIPTION: This command checks the version of NGINX Plus installed. It is crucial to ensure that you are using NGINX Plus Release 34 or later for OIDC compatibility.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/entra-id.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nnginx -v\n```\n\n----------------------------------------\n\nTITLE: Global Settings JSON Example with user-defined-signatures\nDESCRIPTION: This JSON example shows a global settings file used by the NGINX App Protect WAF compiler.  It configures the cookie protection seed and user-defined signatures.  The seed value should be a random alphanumeric string of at least 20 characters.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_11\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"waf-settings\": {\n        \"cookie-protection\": {\n            \"seed\": \"80miIOiSeXfvNBiDJV4t\"\n        },\n        \"user-defined-signatures\": [\n            {\n                \"$ref\": \"file:///policies/uds.json\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: TransportServer YAML\nDESCRIPTION: This YAML configuration defines a TransportServer resource that routes UDP traffic from the `accept-udp` listener (defined in the GlobalConfiguration) to the `udp-listener-upstream` upstream. The upstream is configured to pass traffic to the `udp-listener` service at port 5005. It specifies parameters for UDP requests and the action to pass the traffic to the upstream.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-udp-walkthrough.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: k8s.nginx.org/v1alpha1\nkind: TransportServer\nmetadata:\n  name: udp-listener\nspec:\n  listener:\n    name: accept-udp\n    protocol: UDP\n  upstreams:\n  - name: udp-listener-upstream\n    service: udp-listener\n    port: 5005\n  upstreamParameters:\n    udpRequests: 1\n  action:\n    pass: udp-listener-upstream\n```\n\n----------------------------------------\n\nTITLE: Loading NGINX App Protect WAF Module (Nginx)\nDESCRIPTION: Configures NGINX to load the NGINX App Protect WAF v5 module. It uses the `load_module` directive to specify the path to the module's shared object file. This directive must be placed in the main context of the Nginx configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_16\n\nLANGUAGE: Nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Servers in NGINX\nDESCRIPTION: This code snippet demonstrates how to configure upstream servers in NGINX to define a pool of application servers for load balancing. The `upstream` block specifies the server addresses and uses `sticky cookie` for session persistence.  It is used within the gce-all-active-lb.conf file to direct traffic to the backend application servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\nupstream upstream_app_pool {\n    zone upstream-apps 64k;\n\n    server 10.10.10.1;\n    server 10.10.10.2;\n    server 10.10.10.3;\n    server 10.10.10.4;\n\n    sticky cookie GCPPersist expires=300;\n}\n```\n\n----------------------------------------\n\nTITLE: Update Proxy with OAuth2 Hostname - Bash\nDESCRIPTION: This command updates the proxy with a new introspection endpoint that requires hostname resolution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_42\n\nLANGUAGE: bash\nCODE:\n```\nPUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy\n```\n\n----------------------------------------\n\nTITLE: Set Hostname in NGINX Controller Agent\nDESCRIPTION: This code snippet illustrates how to manually set the hostname for the NGINX Controller Agent in the `agent.conf` file.  This is useful when the agent cannot automatically determine the correct hostname. The hostname is crucial for unique object identification in NGINX Controller. The hostname should be a valid, real hostname, and restarting the agent is needed after making the changes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-the-agent.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\n[credentials]\n..\nhostname = myhostname1\n```\n\n----------------------------------------\n\nTITLE: Defining Key-Value Zone in Nginx\nDESCRIPTION: This configuration defines a key-value zone named 'one' with a size of 1MB. It's used to store the list of denylisted and allowlisted IP addresses. The `type=ip` parameter enables matching IP addresses against subnets/network ranges, and `state=one.keyval` persists the database across reloads and restarts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    keyval_zone zone=one:1m;\n }\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect WAF Configuration\nDESCRIPTION: This Nginx configuration snippet enables NGINX App Protect WAF, references a custom security policy bundle, enables security logging, and specifies the log profile. The paths for the policy and log files should be valid on the data plane host.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_21\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n  ...\n\n  location / {\n    # Enable NGINX App Protect WAF\n    app_protect_enable on;\n\n    # Reference a custom security policy bundle\n    app_protect_policy_file /etc/nms/ignore-xss.tgz;\n\n    # Enable security logging\n    app_protect_security_log_enable on;\n\n    # Reference the log profile bundle\n    app_protect_security_log /etc/nms/log-default.tgz /var/log/nginx/security-violations.log;\n\n    ...\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Create Azure Private Link Service - Azure CLI\nDESCRIPTION: Creates an Azure Private Link service, associating it with a specified virtual network, subnet, and load balancer. This enables Private Link access to the application behind the load balancer.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/private-link-to-upstreams.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\n$ az network private-link-service create \\\n    --resource-group $APP_RESOURCE_GROUP \\\n    --name private-link-service \\\n    --vnet-name $APP_VNET_NAME \\\n    --subnet-name $APP_SUBNET_NAME \\\n    --lb-name load-balancer \\\n    --lb-frontend-ip-configs frontend \\\n    --location $APP_LOCATION\n```\n\n----------------------------------------\n\nTITLE: Configuring the Enforcer address in NGINX\nDESCRIPTION: This snippet configures the Enforcer address in the NGINX `http` context.  The `app_protect_enforcer_address` directive specifies the IP address and port where the Enforcer service is listening.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_35\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enforcer_address 127.0.0.1:50000;\n```\n\n----------------------------------------\n\nTITLE: Importing NGINX Signing Key to RPM Database on SUSE\nDESCRIPTION: This command imports the downloaded NGINX signing key into the RPM database, allowing zypper/rpm to verify the authenticity of NGINX packages. It uses the rpmkeys command with the --import option to add the key to the trusted key store.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_35\n\nLANGUAGE: shell\nCODE:\n```\nsudo rpmkeys --import /tmp/nginx_signing.key\n```\n\n----------------------------------------\n\nTITLE: Configuring Global Directives - Nginx\nDESCRIPTION: These Nginx directives define global settings for the Nginx server. They configure the user Nginx runs as, the number of worker processes, the error log location and level, the process ID file, and the number of worker connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nworker_processes auto;\nerror_log /var/log/nginx/error.log info;\npid /var/run/nginx.pid;\n\nevents {\n    worker_connections 1024;\n}\n\n# If using the standard configuration scheme, the 'http' block is usually placed here\n# and encloses 'include' directives that refer to files in the conf.d directory.\n```\n\n----------------------------------------\n\nTITLE: Inspect NGINX Configuration (Shell)\nDESCRIPTION: This command executes `nginx -T` inside the NGINX Gateway Fabric pod to print the complete NGINX configuration. This allows verification of whether the `UpstreamSettingsPolicy` has been applied correctly to the NGINX configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nkubectl exec -it -n nginx-gateway $NGF_POD_NAME -c nginx -- nginx -T\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect Policy with URL OpenAPI Reference (JSON)\nDESCRIPTION: This JSON snippet configures an NGINX App Protect WAF API Security Policy that references an OpenAPI Specification file using a URL. The policy defines blocking settings for various violations based on the referenced OpenAPI specification, such as disallowed file uploads, missing request bodies, and illegal parameter data types. The link property within the open-api-files array specifies the URL of the OpenAPI file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-openapi-references.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"petstore_api_security_policy\",\n        \"description\": \"NGINX App Protect WAF API Security Policy for the Petstore API\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"open-api-files\": [\n            {\n                \"link\": \"http://127.0.0.1:8088/myapi.yaml\"\n            }\n        ],\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"block\": true,\n                    \"description\": \"Disallowed file upload content detected in body\",\n                    \"name\": \"VIOL_FILE_UPLOAD_IN_BODY\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Mandatory request body is missing\",\n                    \"name\": \"VIOL_MANDATORY_REQUEST_BODY\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Illegal parameter location\",\n                    \"name\": \"VIOL_PARAMETER_LOCATION\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Mandatory parameter is missing\",\n                    \"name\": \"VIOL_MANDATORY_PARAMETER\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"JSON data does not comply with JSON schema\",\n                    \"name\": \"VIOL_JSON_SCHEMA\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Illegal parameter array value\",\n                    \"name\": \"VIOL_PARAMETER_ARRAY_VALUE\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Illegal Base64 value\",\n                    \"name\": \"VIOL_PARAMETER_VALUE_BASE64\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Disallowed file upload content detected\",\n                    \"name\": \"VIOL_FILE_UPLOAD\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Illegal request content type\",\n                    \"name\": \"VIOL_URL_CONTENT_TYPE\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Illegal static parameter value\",\n                    \"name\": \"VIOL_PARAMETER_STATIC_VALUE\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Illegal parameter value length\",\n                    \"name\": \"VIOL_PARAMETER_VALUE_LENGTH\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Illegal parameter data type\",\n                    \"name\": \"VIOL_PARAMETER_DATA_TYPE\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Illegal parameter numeric value\",\n                    \"name\": \"VIOL_PARAMETER_NUMERIC_VALUE\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Parameter value does not comply with regular expression\",\n                    \"name\": \"VIOL_PARAMETER_VALUE_REGEXP\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Illegal URL\",\n                    \"name\": \"VIOL_URL\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Illegal parameter\",\n                    \"name\": \"VIOL_PARAMETER\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Illegal empty parameter value\",\n                    \"name\": \"VIOL_PARAMETER_EMPTY_VALUE\"\n                },\n                {\n                    \"block\": true,\n                    \"description\": \"Illegal repeated parameter name\",\n                    \"name\": \"VIOL_PARAMETER_REPEATED\"\n                }\n            ]\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Outbound Proxy for NGINX Plus\nDESCRIPTION: This configuration snippet shows how to configure an outbound proxy server for NGINX Plus instances to communicate with F5's licensing endpoint. It includes the `proxy`, `proxy_username`, and `proxy_password` directives within the `mgmt` block. Replace `PROXY_ADDR:PORT`, `USER`, and `PASS` with your actual proxy server details.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/solutions/about-subscription-licenses.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n        proxy          PROXY_ADDR:PORT; #can be http or https\n        proxy_username USER;            #optional\n        proxy_password PASS;            #optional\n    }\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Plus and App Protect WAF using Dockerfile\nDESCRIPTION: This Dockerfile installs NGINX Plus and the App Protect WAF v5 module on Amazon Linux 2. It utilizes Docker secrets for repository authentication. It configures yum repositories, installs required packages, sets up symbolic links for logging, exposes port 80, defines the stop signal as SIGQUIT, and sets the default command to start Nginx in the foreground.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-plus/build-amazon.md#_snippet_0\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Base image\nFROM amazonlinux:2\n\n# Install NGINX Plus and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    amazon-linux-extras enable epel \\\n    && yum clean metadata \\\n    && yum -y install wget ca-certificates epel-release shadow-utils \\\n    && wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-amazon2.repo \\\n    && echo \"[app-protect-x-plus]\" > /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && echo \"name=nginx-app-protect repo\" >> /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && echo \"baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/7/\\$basearch/\" >> /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && echo \"sslclientcert=/etc/ssl/nginx/nginx-repo.crt\" >> /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && echo \"sslclientkey=/etc/ssl/nginx/nginx-repo.key\" >> /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && echo \"gpgcheck=0\" >> /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && yum -y install app-protect-module-plus \\\n    && yum clean all \\\n    && rm -rf /var/cache/yum \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log\n\n# Expose port\nEXPOSE 80\n\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Generating Signature Report (all signature details)\nDESCRIPTION: This example demonstrates how to generate a signature report using the `get-signatures` tool. It runs inside a Docker container and saves the report to a JSON file. No specific fields are requested, so all signature details are included in the report.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_23\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker run --rm \\\n -v $(pwd):$(pwd) \\\n --entrypoint=/opt/app_protect/bin/get-signatures \\\n waf-compiler-<version-tag>:custom \\\n -o $(pwd)/signature-report.json\n```\n\n----------------------------------------\n\nTITLE: Configuring Nginx App Protect\nDESCRIPTION: This snippet demonstrates how to load the App Protect module and configure it within an Nginx server block. It includes enabling the module and setting up a proxy pass. The proxy_pass directive forwards requests to another server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/configure-slice.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n\nhttp {\n    server {\n        listen 127.0.0.1:8080;\n        server_name localhost;\n\n        location / {\n            app_protect_enable on;\n            proxy_pass http://127.0.0.1:8081$request_uri;\n        }\n    }\n\n    server {\n        listen 127.0.0.1:8081;\n        server_name localhost;\n\n        location / {\n            proxy_pass http://1.2.3.4$request_uri;\n            slice 2;\n            proxy_set_header Range $slice_range;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enable Key Vault Certificate - Azure CLI\nDESCRIPTION: This snippet enables a certificate in key vault using the Azure CLI.  Requires `certificate_id` to be set to the certificate's resource ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_16\n\nLANGUAGE: bash\nCODE:\n```\naz keyvault certificate set-attributes --enabled true --id $certificate_id\n```\n\n----------------------------------------\n\nTITLE: Install XSLT Module on Debian and Ubuntu\nDESCRIPTION: This shell command updates the package manager and installs the `nginx-plus-module-xslt` package on Debian and Ubuntu systems. It uses `apt` as the package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/xslt.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-xslt\n```\n\n----------------------------------------\n\nTITLE: Get OpenID Configuration with curl\nDESCRIPTION: This command retrieves the OpenID Connect configuration metadata from Auth0 using curl. It requires the tenant ID and optionally uses jq for formatting the JSON output.  The output includes the issuer, authorization endpoint, token endpoint, and jwks_uri.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/auth0.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://yourTenantId.us.auth0.com/.well-known/openid-configuration | jq\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS A Record for Email Server\nDESCRIPTION: This DNS A record maps the mail server's hostname to its IP address.  Replace `mail.company.com` with the mail server hostname, and `X.X.X.X` with the public IP address of the NGINX Plus server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nmail.company.com.    60    A    X.X.X.X\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Open Source (RHEL 9)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Open Source package from RHEL 9. It uses the `dnf remove` command to remove the `app-protect-module-oss` package. Requires root privileges and the dnf package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_64\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf remove app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Enabling HTTP/2 Support in Nginx\nDESCRIPTION: This snippet enables HTTP/2 support in the Nginx server block. By adding `http2 on;` to the server configuration, Nginx will negotiate HTTP/2 connections with clients that support it, improving performance and efficiency.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_24\n\nLANGUAGE: nginx\nCODE:\n```\nlisten 443 ssl;\nhttp2  on;\n```\n\n----------------------------------------\n\nTITLE: Install ca-certificates on SLES\nDESCRIPTION: This snippet refreshes the zypper package manager and installs the ca-certificates package on SUSE Linux Enterprise Server. It is a prerequisite for installing NGINX Plus on SLES.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_18\n\nLANGUAGE: Shell\nCODE:\n```\nzypper refresh\nzypper install ca-certificates\n```\n\n----------------------------------------\n\nTITLE: Setup repository pinning for Nginx packages\nDESCRIPTION: This command sets up repository pinning for Nginx packages, ensuring that packages from the official Nginx repository are preferred over distribution-provided ones. This is done by creating a preferences file with a higher priority for the Nginx repository. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\necho -e \"Package: *\\nPin: origin nginx.org\\nPin: release o=nginx\\nPin-Priority: 900\\n\" \\\n        | sudo tee /etc/apt/preferences.d/99nginx\n```\n\n----------------------------------------\n\nTITLE: Configuring OWA Location Block for HTTPS Traffic in Nginx\nDESCRIPTION: This snippet configures the location block for OWA ('/owa') in the 'server' block for HTTPS traffic in Nginx. It proxies requests to the 'exchange-owa' upstream, sets the HTTP version to 1.1, and clears the Connection header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_47\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /owa {\n    proxy_pass https://exchange-owa;\n    proxy_http_version 1.1;\n    proxy_set_header Connection \"\";\n}\n```\n\n----------------------------------------\n\nTITLE: Run Ansible Playbook\nDESCRIPTION: This command executes the Ansible playbook named `playbook.yml`. The playbook is responsible for automating the installation and configuration of Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ec2-instances-for-nginx.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nansible-playbook playbook.yml\n```\n\n----------------------------------------\n\nTITLE: Configuring PROXY Protocol in NGINX Listen Directive\nDESCRIPTION: This snippet demonstrates how to enable the PROXY protocol in the `listen` directive within the `http` and `stream` blocks of the NGINX configuration.  It allows NGINX to receive client connection information passed through proxy servers and load balancers.  This is a necessary first step for utilizing client IP addresses.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/using-proxy-protocol.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n    server {\n        listen 80   proxy_protocol;\n        listen 443  ssl proxy_protocol;\n        #...\n    }\n}\n\nstream {\n    #...\n    server {\n        listen 12345 proxy_protocol;\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Plus Certificate Bundle as GZIP\nDESCRIPTION: This command downloads the NGINX Plus certificate and key bundle in GZIP format using the NGINX Controller API. It requires a valid session cookie for authentication and saves the output to a file named `nginx-plus-certs.gz`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/get-n-plus-cert-and-key.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncurl -b cookie.txt -c cookie.txt -X GET --url 'https://192.0.2.0/api/v1/platform/licenses/nginx-plus-licenses/controller-provided' --output nginx-plus-certs.gz\n```\n\n----------------------------------------\n\nTITLE: Download and Add NGINX Signing Key\nDESCRIPTION: Downloads the NGINX signing key and adds it to the system's trusted keyrings. This ensures that packages from the NGINX repository can be securely verified during installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nwget -qO - https://cs.nginx.com/static/keys/nginx_signing.key \\\n    | gpg --dearmor \\\n    | sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null\n```\n\n----------------------------------------\n\nTITLE: Configure HTTPRoute with RequestHeaderModifier - YAML\nDESCRIPTION: Creates an HTTPRoute resource that routes traffic to the header application. This route modifies request headers by setting, adding, and removing specific headers using the RequestHeaderModifier filter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: headers\nspec:\n  parentRefs:\n  - name: gateway\n    sectionName: http\n  hostnames:\n  - \"echo.example.com\"\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /headers\n    filters:\n    - type: RequestHeaderModifier\n      requestHeaderModifier:\n        set:\n        - name: My-Overwrite-Header\n          value: this-is-the-only-value\n        add:\n        - name: Accept-Encoding\n          value: compress\n        - name: My-Cool-header\n          value: this-is-an-appended-value\n        remove:\n        - User-Agent\n    backendRefs:\n    - name: headers\n      port: 80\nEOF\n```\n\n----------------------------------------\n\nTITLE: Defining HTTP Upstreams using JSON Schema\nDESCRIPTION: This JSON schema defines the structure for configuring HTTP upstreams in Nginx. It specifies properties for the upstream label, name in configuration, and a list of upstream servers with their addresses and ports.  The schema is used to validate and structure user input for creating and managing Nginx upstreams.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/tutorials/round-robin-reverse-proxy.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"title\": \"HTTP Upstreams\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"templateInput\": {\n      \"type\": [\n        \"object\",\n        \"null\"\n      ],\n      \"properties\": {\n        \"name\": {\n          \"title\": \"Upstream Label\",\n          \"type\": \"string\",\n          \"description\": \"Enter a unique label for the upstream. This label is displayed in the user interface and acts as a key for matching and applying augment input to the specific upstream.\",\n          \"examples\": [\n            \"Users Service\"\n          ]\n        },\n        \"nameInConfig\": {\n          \"title\": \"Name\",\n          \"type\": \"string\",\n\n          \"examples\": [\n            \"users_backend\"\n          ]\n        },\n        \"servers\": {\n          \"type\": \"array\",\n          \"title\": \"Upstream Servers\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"address\": {\n                \"title\": \"Upstream server address\",\n                \"type\": \"string\",\n                \"description\": \"Specifies the address for the upstream server.\",\n                \"examples\": [\n                  \"users1.example.com\",\n                  \"192.0.0.1\"\n                ]\n              },\n              \"port\": {\n                \"type\": \"integer\",\n                \"title\": \"Port\",\n                \"description\": \"Specifies the port for the upstream server.\",\n                \"minimum\": 1,\n                \"maximum\": 65535,\n                \"examples\": [\n                  80\n                ]\n              }\n            },\n            \"required\": [\n              \"address\"\n            ]\n          }\n        }\n      },\n      \"required\": [\n        \"name\",\n        \"servers\",\n        \"nameInConfig\"\n      ]\n    }\n  },\n  \"required\": []\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling HTTPD Network Connections with SELinux - bash\nDESCRIPTION: This command enables the httpd_can_network_connect SELinux boolean, allowing HTTPD processes (like Nginx) to make network connections.  The -P flag makes the change persistent across reboots. This is required for NGINX Agent to connect to external ports.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nsudo setsebool -P httpd_can_network_connect 1\n```\n\n----------------------------------------\n\nTITLE: Dockerfile Setup for Nginx with App Protect\nDESCRIPTION: This Dockerfile configures Nginx OSS and Nginx App Protect WAF v5 within a Debian container. It begins by setting the OS codename via an ARG. It installs necessary dependencies like apt-transport-https, lsb-release, and ca-certificates. Crucially, it adds the Nginx and Nginx App Protect repositories, imports signing keys using gpg, and installs the specified Nginx and app-protect-module-oss packages.  It uses secrets for repository authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-debian.md#_snippet_0\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Supported OS_CODENAME's are: bullseye/bookworm\nARG OS_CODENAME=bookworm\n\n# Base image\nFROM debian:${OS_CODENAME}\n\n# Install NGINX OSS and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    apt-get update \\\n    && apt-get install -y \\\n      apt-transport-https \\\n      lsb-release \\\n      ca-certificates \\\n      wget \\\n      gnupg2 \\\n      debian-archive-keyring \\\n    && wget -qO - https://nginx.org/keys/nginx_signing.key | gpg --dearmor | \\\n      tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null \\\n    && gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg \\\n    && printf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n      http://nginx.org/packages/mainline/debian `lsb_release -cs` nginx\\n\" | \\\n      tee /etc/apt/sources.list.d/nginx.list \\\n    && wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key | gpg --dearmor | \\\n      tee /usr/share/keyrings/nginx-static-archive-keyring.gpg >/dev/null \\\n    && gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-static-archive-keyring.gpg \\\n    && printf \"deb [signed-by=/usr/share/keyrings/nginx-static-archive-keyring.gpg] \\\n      https://pkgs.nginx.com/app-protect-x-oss/debian `lsb_release -cs` nginx-plus\\n\" | \\\n      tee /etc/apt/sources.list.d/nginx-app-protect.list \\\n    && wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx \\\n    && apt-get update \\\n    && DEBIAN_FRONTEND=\"noninteractive\" apt-get install -y nginx=1.25.5-1~`lsb_release -cs` app-protect-module-oss \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log \\\n    && apt-get clean \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Expose port\nEXPOSE 80\n\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: WAF Policy Structure Example\nDESCRIPTION: Illustrates the expected declarative policy structure for NGINX App Protect WAF.  This structure ensures the WAF policy is correctly interpreted and applied by the security module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/troubleshooting-guide/troubleshooting.md#_snippet_7\n\nLANGUAGE: Other\nCODE:\n```\n`{\"`\n`    \"policy\": {`\n`        ...`\n`    }`\n`}`\n```\n\n----------------------------------------\n\nTITLE: Publish gRPC API Proxy with Advanced Routes (JSON)\nDESCRIPTION: This JSON configuration demonstrates advanced routing for a gRPC API proxy within NGINX Management Suite API Connectivity Manager, incorporating specific gRPC methods. The `grpcIngress` includes a `routes` array, defining how requests to the `SayGoodbye` and `SayHello` methods of the `helloworld.Greeter` service are routed to the specified backend.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/services/publish-gRPC-proxy.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"dev-grpc-hello\",\n    \"version\": \"v1\",\n    \"proxyConfig\": {\n        \"hostname\": \"example.com\",\n        \"grpcIngress\": {\n            \"service\": \"helloworld.Greeter\",\n            \"routes\": [\n                {\n                  \"method\": \"SayGoodbye\",\n                  \"targetBackendServiceLabel\": \"default\"\n                },\n                {\n                  \"method\": \"SayHello\",\n                  \"targetBackendServiceLabel\": \"default\"\n                }\n            ]\n        },\n        \"backends\": [\n          {\n            \"serviceName\": \"hello-grpc-service-name\",\n            \"serviceTargets\": [\n                {\n                    \"hostname\": \"grpc-backend.example.com\",\n                    \"listener\": {\n                        \"enableTLS\": false,\n                        \"port\": 50051,\n                        \"transportProtocol\": \"GRPC\"\n                    }\n                }\n            ]\n          }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Swagger UI Nginx\nDESCRIPTION: This snippet configures Swagger UI for interactive API documentation. It specifies a location for Swagger UI files, adds a Content-Security-Policy header, and restricts access to local networks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n\n    server {\n        listen 192.168.1.23;\n        # ...\n\n        location /api {\n            limit_except GET {\n                auth_basic \"NGINX Plus API\";\n                auth_basic_user_file /path/to/passwd/file;\n            }\n\n            api   write=on;\n            allow 192.168.1.0/24;\n            deny  all;\n        }\n\n        location = /dashboard.html {\n            root   /usr/share/nginx/html;\n        }\n\n        location /swagger-ui {\n            add_header Content-Security-Policy \"default-src 'self'\";\n            root       /usr/share/nginx/html;\n            allow      192.168.1.0/24;\n            deny       all;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Convert XML Policy, Keep Full Configuration\nDESCRIPTION: This snippet demonstrates how to convert an XML policy to a JSON policy, retaining all configuration elements including those unsupported in NGINX App Protect WAF.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/convert-policy -i /path/to/policy.xml -o /path/to/policy.json --keep-full-configuration\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP Basic Authentication\nDESCRIPTION: This snippet configures HTTP Basic authentication to protect the NGINX Plus API. It requires users to authenticate with a username and password stored in the `/etc/nginx/users` file. The `auth_basic` and `auth_basic_user_file` directives are used to enable and configure basic authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_32\n\nLANGUAGE: nginx\nCODE:\n```\nauth_basic on;\nauth_basic_user_file /etc/nginx/users;\n```\n\n----------------------------------------\n\nTITLE: Getting Security Policy Bundle with GET - Shell\nDESCRIPTION: This snippet shows how to retrieve a specific security policy bundle using a GET request to the `/api/platform/v1/security/policies/{security-policy-uid}/bundles/{security-policy-bundle-uid}` endpoint. The example curl command includes an authorization header with a bearer token. Requires a valid policy UID, bundle UID, and access token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET https://{{NIM_FQDN}}/api/platform/v1/security/policies/<policy-uid>/bundles/<bundle-uid> \\\n    -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Define OIDC Provider in NGINX\nDESCRIPTION: This snippet defines an OpenID Connect (OIDC) provider named `onelogin` within the NGINX `http` block.  This block uses the `oidc_provider` directive to encapsulate the configuration related to OneLogin, including the `issuer`, `client_id`, and `client_secret` settings.  These settings are used for communicating with the OneLogin OIDC provider.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/onelogin.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider onelogin {\n\n        # ...\n\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX App Protect Repository\nDESCRIPTION: This snippet configures the NGINX App Protect WAF v5 repository. It defines the repository name, base URL, SSL client certificate and key paths, and enables the repository. This configuration is placed in the `/etc/yum.repos.d/app-protect-x-oss.repo` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-centos.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\n[app-protect-x-oss]\nname=nginx-app-protect repo\nbaseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/7/$basearch/\nsslclientcert=/etc/ssl/nginx/nginx-repo.crt\nsslclientkey=/etc/ssl/nginx/nginx-repo.key\ngpgcheck=0\nenabled=1\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx Configuration\nDESCRIPTION: This command reloads the Nginx configuration without restarting the Nginx process. This is useful for applying changes to the Nginx configuration without causing downtime. It sends the `reload` signal to the Nginx process running inside the `nginx` container.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_32\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker exec nginx  nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Create a Gateway using kubectl\nDESCRIPTION: This command applies a YAML file to create a Gateway within a Kubernetes cluster using `kubectl`. It retrieves the YAML file from a specified URL on GitHub, targeting a particular version of NGINX Gateway Fabric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_1\n\nLANGUAGE: YAML\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/examples/snippets-filter/gateway.yaml\n```\n\n----------------------------------------\n\nTITLE: Protect Location with Cognito OIDC\nDESCRIPTION: This configuration snippet protects a specific location (e.g., `/`) with Amazon Cognito OIDC by using the `auth_oidc` directive. It references the `cognito` provider defined earlier.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/cognito.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc cognito;\n\n     # ...\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Configure Test Application Server in NGINX\nDESCRIPTION: This configuration defines a simple test application that listens on port 8080. It returns a 200 OK response with a message containing the authenticated user's name, email, and subject identifier. The name and email are read from the headers passed by the main NGINX server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/entra-id.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nserver {\n    listen 8080;\n\n    location / {\n        return 200 \"Hello, $http_name!\\nEmail: $http_email\\nSub: $http_sub\\n\";\n        default_type text/plain;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Example OpenID Connect Configuration Metadata\nDESCRIPTION: This JSON snippet shows the typical format of the OpenID Connect configuration metadata returned by the AD FS server. It includes key endpoints such as the issuer, authorization endpoint, token endpoint, and JWKS URI.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/active-directory-federation-services.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    ...\n    \"issuer\": \"https://adfs-server-address/adfs\",\n    \"authorization_endpoint\": \"https://adfs-server-address/adfs/oauth2/authorize/\",\n    \"token_endpoint\": \"https://adfs-server-address/adfs/oauth2/token/\",\n    \"jwks_uri\": \"https://adfs-server-address/adfs/discovery/keys\",\n    ...\n}\n```\n\n----------------------------------------\n\nTITLE: Deploy Tea HTTPRoute\nDESCRIPTION: Deploys the `tea` HTTPRoute using `kubectl apply`. This HTTPRoute configures traffic routing for the tea applications based on the HTTP method. It references the 'cafe' gateway and defines rules for routing POST requests to `tea-post-svc` and GET requests to `tea-svc`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_8\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: tea\nspec:\n  parentRefs:\n  - name: cafe\n  hostnames:\n  - cafe.example.com\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /tea\n      method: POST\n    backendRefs:\n    - name: tea-post-svc\n      port: 80\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /tea\n      method: GET\n    backendRefs:\n    - name: tea-svc\n      port: 80\n```\n\n----------------------------------------\n\nTITLE: Retrieve Security Log Profile UID (GET) - Shell\nDESCRIPTION: This code snippet demonstrates how to retrieve the UID of a security log profile using a GET request to the NGINX Instance Manager API.  Requires `curl` and a valid access token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_21\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET https://{{NIM_FQDN}}/api/platform/v1/security/logprofiles \\\n        -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Enabling NGINX FIPS check module\nDESCRIPTION: This Nginx configuration snippet enables the dynamic loading of the FIPS check module by using the `load_module` directive.  It should be added to the main context of the `nginx.conf` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/fips.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_fips_check_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Packer Variables for AWS Credentials\nDESCRIPTION: This snippet demonstrates how to configure AWS credentials within the `variables` block of the `packer.json` file for both NGINX Open Source (ngx-oss) and NGINX Plus (ngx-plus) Packer configurations. The `aws_access_key` and `aws_secret_key` variables must be populated with valid AWS credentials for Packer to create the AMI.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-network-load-balancer.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\n \"variables\": {\n     \"home\": \"{{env `HOME`}}\",\n     \"aws_access_key\": \"\",\n     \"aws_secret_key\": \"\"\n }\n```\n\n----------------------------------------\n\nTITLE: Setting up APK Repository (Alpine Linux)\nDESCRIPTION: Configures the apk repository for nginx-agent packages by appending the repository URL to the /etc/apk/repositories file. This allows the apk package manager to find and install the nginx-agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_21\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"%s%s%s\\n\" \\\n    \"https://pkgs.nginx.com/nginx-agent/alpine/v\" \\\n    `grep -o -E '^[0-9]+\\.[0-9]+' /etc/alpine-release` \\\n    \"/main\" \\\n    | sudo tee -a /etc/apk/repositories\n```\n\n----------------------------------------\n\nTITLE: Disabling Access Logging Nginx\nDESCRIPTION: Disables access logging for all HTTP traffic. This directive can be placed in the http, server, or location block to disable logging at different levels. This can be useful for reducing disk space usage and improving performance in certain situations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_32\n\nLANGUAGE: nginx\nCODE:\n```\naccess_log off;\n```\n\n----------------------------------------\n\nTITLE: Creating the cafe gateway\nDESCRIPTION: This YAML configuration defines a Gateway resource named 'cafe' which uses the 'nginx' gateway class. It configures two listeners: one for HTTP traffic on port 80 and another for HTTPS traffic on port 443, terminating TLS using the 'cafe-secret' in the 'certificate' namespace.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/https-termination.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nmetadata:\n  name: cafe\nspec:\n  gatewayClassName: nginx\n  listeners:\n  - name: http\n    port: 80\n    protocol: HTTP\n  - name: https\n    port: 443\n    protocol: HTTPS\n    tls:\n      mode: Terminate\n      certificateRefs:\n      - kind: Secret\n        name: cafe-secret\n        namespace: certificate\nEOF\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Plus (RHEL 9)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Plus package from RHEL 9. It uses the `dnf remove` command to remove the `app-protect-module-plus` package. Requires root privileges and the dnf package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_65\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf remove app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Checking NGINX App Protect Version with metadata.json\nDESCRIPTION: This command is used to verify the 'build' version of NGINX App Protect after an upgrade. It reads the contents of the `/etc/nms/app_protect_metadata.json` file, which contains metadata about the installed NGINX App Protect version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/upgrade-nap-waf.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo more /etc/nms/app_protect_metadata.json\n```\n\n----------------------------------------\n\nTITLE: Create HTTPRoutes for Coffee and Tea (YAML)\nDESCRIPTION: This YAML configuration creates two HTTPRoute resources, `coffee` and `tea`.  Each route is associated with the `gateway` and forwards traffic to the respective backend service based on the path `/coffee` or `/tea` and the hostname `cafe.example.com`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: coffee\nspec:\n  parentRefs:\n    - name: gateway\n      sectionName: http\n  hostnames:\n    - \"cafe.example.com\"\n  rules:\n    - matches:\n        - path:\n            type: Exact\n            value: /coffee\n      backendRefs:\n        - name: coffee\n          port: 80\n---\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: tea\nspec:\n  parentRefs:\n    - name: gateway\n      sectionName: http\n  hostnames:\n    - \"cafe.example.com\"\n  rules:\n    - matches:\n        - path:\n            type: Exact\n            value: /tea\n      backendRefs:\n        - name: tea\n          port: 80\nEOF\n```\n\n----------------------------------------\n\nTITLE: Running NGINX Plus Container (Shell)\nDESCRIPTION: This snippet demonstrates how to run a container based on the custom NGINX Plus image that was built. It maps port 80 on the host to port 80 in the container and runs the container in detached mode.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\ndocker run --name mynginxplus -p 80:80 -d nginxplus\n```\n\n----------------------------------------\n\nTITLE: Logging in to NGINX Plus Registry with Docker\nDESCRIPTION: This command logs in to the NGINX Plus private Docker registry using a JSON Web Token (JWT) obtained from the MyF5 customer portal.  Replace `YOUR_JWT_HERE` with your actual JWT. The username is set to the JWT and the password is set to `none`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-plus-and-agent-docker.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\nsudo docker login private-registry.nginx.com --username=YOUR_JWT_HERE --password=none\n```\n\n----------------------------------------\n\nTITLE: Describe Rate Limiting SnippetsFilter using kubectl\nDESCRIPTION: This command retrieves the details of the `SnippetsFilter` resource named `rate-limiting-sf` from a Kubernetes cluster using `kubectl describe`. It's used to verify the status and configuration of the `SnippetsFilter`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_7\n\nLANGUAGE: Shell\nCODE:\n```\nkubectl describe snippetsfilters.gateway.nginx.org rate-limiting-sf\n```\n\n----------------------------------------\n\nTITLE: Add OAuth2 JWT Assertion Policy - REST API\nDESCRIPTION: This JSON payload is used in a POST request to add an OAuth2 JWT Assertion policy to an API Proxy using the API Connectivity Manager's REST API.  It includes settings for the JWKS URI or keys, cache duration, token name, token location (header or query parameter), and error return conditions.  The jwksURI is the endpoint for public keys used to verify JWT signatures. The request must be sent to the `/services/workspaces/<SERVICE_WORKSPACE_NAME>/proxies` endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/jwt-assertion.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n\t\"policies\": {\n\t\t\"oauth2-jwt-assertion\": [\n\t\t\t{\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"jwksURI\": \"https://idp.io:8443/oauth/certs\",\n\t\t\t\t\t\"cacheKeysDuration\": \"12h\",\n\t\t\t\t\t\"jwksKeys\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"k\": \"bXlzZWNyZXQ\",\n\t\t\t\t\t\t\t\"kid\": \"0001\",\n\t\t\t\t\t\t\t\"kty\": \"oct\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"tokenName\": \"Authorization\",\n\t\t\t\t\t\"tokenSuppliedIn\": \"HEADER\",\n\t\t\t\t\t\"errorReturnConditions\": {\n\t\t\t\t\t\t\"notSupplied\": {\n\t\t\t\t\t\t\t\"returnCode\": 401\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"noMatch\": {\n\t\t\t\t\t\t\t\"returnCode\": 403\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t}\n}\n```\n\n----------------------------------------\n\nTITLE: Verifying Certificate Chain with OpenSSL\nDESCRIPTION: This shell command uses `openssl s_client` to connect to a server and display the certificate chain. This can be used to verify that the server is sending the complete certificate chain, ensuring proper validation by clients.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nopenssl s_client -connect www.godaddy.com:443\n```\n\n----------------------------------------\n\nTITLE: Updating Deployment YAML for mTLS Configuration\nDESCRIPTION: This YAML configuration defines a Kubernetes deployment for NGINX App Protect, including the NGINX instance, WAF Enforcer, and WAF Config Manager. It mounts the `enforcer-certificates` secret as a volume, sets environment variables for the enforcer to point to the certificate and key files, and configures necessary image pull secrets, volumes, and volume mounts.  The containers use the mounted certificates to establish a secure mTLS connection.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/nap-k8s-mtls-deployment.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nap5-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nap5\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: nap5\n    spec:\n      imagePullSecrets:\n          - name: regcred\n      containers:\n        - name: nginx\n          image: <your-private-registry>/nginx-app-protect-5:<your-tag>\n          imagePullPolicy: IfNotPresent\n          volumeMounts:\n            - name: app-protect-bd-config\n              mountPath: /opt/app_protect/bd_config\n            - name: app-protect-config\n              mountPath: /opt/app_protect/config\n            - name: certs\n              mountPath: /etc/ssl/certs\n              readOnly: true\n            - name: waf-enforcer\n              image: private-registry.nginx.com/nap/waf-enforcer:<version-tag>\n              imagePullPolicy: IfNotPresent\n              env:\n                - name: ENFORCER_PORT\n                  value: \"4431\"\n                - name: ENFORCER_SERVER_CERT\n                  value: \"/etc/ssl/certs/app_protect_server.crt\"\n                - name: ENFORCER_SERVER_KEY\n                  value: \"/etc/ssl/certs/app_protect_server.key\"\n                - name: ENFORCER_CA_FILE\n                  value: \"/etc/ssl/certs/app_protect_client_ca.crt\"\n              volumeMounts:\n                - name: app-protect-bd-config\n                  mountPath: /opt/app_protect/bd_config\n                - name: certs\n                  mountPath: /etc/ssl/certs\n                  readOnly: true\n            - name: waf-config-mgr\n              image: private-registry.nginx.com/nap/waf-config-mgr:<version-tag>\n              imagePullPolicy: IfNotPresent\n              securityContext:\n                allowPrivilegeEscalation: false\n                capabilities:\n                  drop:\n                    - all\n              volumeMounts:\n                - name: app-protect-bd-config\n                  mountPath: /opt/app_protect/bd_config\n                - name: app-protect-config\n                  mountPath: /opt/app_protect/config\n                - name: app-protect-bundles\n                  mountPath: /etc/app_protect/bundles\n          volumes:\n            - name: app-protect-bd-config\n              emptyDir: {}\n            - name: app-protect-config\n              emptyDir: {}\n            - name: app-protect-bundles\n              persistentVolumeClaim:\n                claimName: nap5-bundles-pvc\n            - name: certs\n              secret:\n                secretName: enforcer-certificates\n```\n\n----------------------------------------\n\nTITLE: Installing Image-Filter Module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This shell script updates the dnf package manager and installs the `nginx-plus-module-image-filter` package. This will install the image filter module for NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/image-filter.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-image-filter\n```\n\n----------------------------------------\n\nTITLE: Adding Database Entry using curl\nDESCRIPTION: This shell command uses curl to add a new entry to the keyval zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X POST -d '{\"10.0.0.5\": \"1\"}' -s 'http://www.example.com/api/6/http/keyvals/one'\n```\n\n----------------------------------------\n\nTITLE: Editing Rate Limit Configuration using Kubectl\nDESCRIPTION: This command opens the ratelimit-burst RateLimit resource in a text editor, allowing users to modify its configuration, such as adding or adjusting the 'burst' parameter, which defines the number of allowed requests beyond the defined rate.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_21\n\nLANGUAGE: bash\nCODE:\n```\nkubectl edit ratelimit ratelimit-burst\n```\n\n----------------------------------------\n\nTITLE: Create Rate Limiting SnippetsFilter using kubectl\nDESCRIPTION: This command applies a YAML definition to create a `SnippetsFilter` resource named `rate-limiting-sf` in a Kubernetes cluster.  The `SnippetsFilter` configures rate limiting by injecting NGINX configuration snippets into the `http` and `http.server.location` contexts. The rate limit is set to 1 request per second with a burst of 3.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_6\n\nLANGUAGE: YAML\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.nginx.org/v1alpha1\nkind: SnippetsFilter\nmetadata:\n  name: rate-limiting-sf\nspec:\n  snippets:\n    - context: http\n      value: limit_req_zone \\$binary_remote_addr zone=rate-limiting-sf:10m rate=1r/s;\n    - context: http.server.location\n      value: limit_req zone=rate-limiting-sf burst=3;\nEOF\n```\n\n----------------------------------------\n\nTITLE: Enabling Active UDP Health Checks - NGINX\nDESCRIPTION: Enables active UDP health checks for the upstream server group. This is done by specifying the `udp` parameter to the `health_check` directive within the `server` block that forwards traffic to the upstream group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    server {\n         listen       53 udp;\n         proxy_pass   dns_upstream;\n         health_check udp;\n    }\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Publishing Configs: Example JSON Request (POST/PUT)\nDESCRIPTION: This JSON payload is used in a POST or PUT request to publish NGINX configurations, including specifying an optional external ID and type for version control, to an instance.  The externalId represents the commit hash. Config contents must be base64 encoded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/publish-configs.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"auxFiles\": {\n        \"files\": [],\n        \"rootDir\": \"/\"\n    },\n    \"configFiles\": {\n        \"rootDir\": \"/etc/nginx\",\n        \"files\": [\n            {\n                \"contents\": \"base64_encoded_contents\",\n                \"name\": \"/etc/nginx/nginx.conf\"\n            }\n        ]\n    },\n    \"updateTime\": \"2023-02-22T17:10:02.677Z\",\n    \"externalId\": \"521747298a3790fde1710f3aa2d03b55020575aa\",\n    \"externalIdType\": \"git\"\n}\n```\n\n----------------------------------------\n\nTITLE: Example NGINX Version Output\nDESCRIPTION: This is an example of the output you should see when running the `nginx -v` command.  It shows the nginx version and the nginx-plus release.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/active-directory-federation-services.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\nnginx version: nginx/1.27.4 (nginx-plus-r34)\n```\n\n----------------------------------------\n\nTITLE: Update Security Policy via REST API using POST\nDESCRIPTION: This snippet demonstrates updating a security policy by creating a new revision using a `POST` request to the NGINX Instance Manager REST API. It requires a valid access token and the updated policy definition in JSON format, sent as the request body.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_3\n\nLANGUAGE: Shell\nCODE:\n```\ncurl -X POST https://{{NIM_FQDN}}/api/platform/v1/security/policies?isNewRevision=true \\\n    -H \"Authorization: Bearer <access token>\" \\\n    -d @update-xss-policy.json\n```\n\n----------------------------------------\n\nTITLE: Polling Sync Status with curl\nDESCRIPTION: This snippet shows how to poll the synchronization status of the shared memory zone using the NGINX Plus API with the curl command.  It uses jq to format the JSON output.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\ncurl -s '127.0.0.1/api/9/stream/zone_sync' | jq\n```\n\n----------------------------------------\n\nTITLE: Inspect Nginx Config for Keepalive (Shell)\nDESCRIPTION: This command executes `nginx -T` inside the NGINX Gateway Fabric pod to print the NGINX configuration, allowing verification that the `UpstreamSettingsPolicy` with the keepalive settings has been correctly applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\nkubectl exec -it -n nginx-gateway $NGF_POD_NAME -c nginx -- nginx -T\n```\n\n----------------------------------------\n\nTITLE: Configure Upstream Server Groups in Nginx\nDESCRIPTION: This snippet configures upstream server groups for different continents. It defines servers for Europe (eu), North America (na), and a default group (all) for cases where the IP address cannot be matched against the GeoIP database. Each upstream block contains server directives specifying the server's address and port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nupstream all {\n    server all1.example.com:12345;\n    server all2.example.com:12345;\n}\n\nupstream eu {\n    server eu1.example.com:12345;\n    server eu2.example.com:12345;\n}\n\nupstream na {\n    server na1.example.com:12345;\n    server na2.example.com:12345;\n}\n```\n\n----------------------------------------\n\nTITLE: Updating Database Entry using curl\nDESCRIPTION: This shell command uses curl to update the value of an existing entry in the keyval zone. In this example, the access status for IP address 10.0.0.4 is changed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X PATCH -d '{\"10.0.0.4\": \"1\"}' -s 'http://www.example.com/api/6/http/keyvals/one'\n```\n\n----------------------------------------\n\nTITLE: Setting Minimum Compression Length in NGINX\nDESCRIPTION: This snippet specifies the minimum length of the response to compress, here set to 1000 bytes. Responses smaller than this length will not be compressed. Requires the gzip module to be enabled and the gzip directive set to on.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/compression.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\ngzip_min_length 1000;\n```\n\n----------------------------------------\n\nTITLE: Reset Azure Application Credential\nDESCRIPTION: This command generates a new client secret for the registered application in Microsoft Entra ID.  Replace `<appId>` with the application ID obtained during application registration. The output provides the password (Client Secret) and tenant ID required for NGINX Plus configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/entra-id.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\naz ad app credential reset --id <appId>\n```\n\n----------------------------------------\n\nTITLE: Fetching NGINX Signing Key\nDESCRIPTION: This command downloads the official NGINX signing key from nginx.org and saves it to the /tmp directory. This key is used to verify the authenticity of the NGINX Agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_24\n\nLANGUAGE: shell\nCODE:\n```\ncurl -o /tmp/nginx_signing.rsa.pub https://nginx.org/keys/nginx_signing.rsa.pub\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect Enforcer Address\nDESCRIPTION: This Nginx configuration snippet specifies the enforcer address for NGINX App Protect WAF v5.  It should be added in the http context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_23\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enforcer_address 127.0.0.1:50000;\n```\n\n----------------------------------------\n\nTITLE: Installing Prometheus Module on SLES\nDESCRIPTION: This command installs the nginx-plus-module-prometheus package using the zypper package manager, specific to SUSE Linux Enterprise Server (SLES). It requires sudo privileges to install packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper install nginx-plus-module-prometheus\n```\n\n----------------------------------------\n\nTITLE: Create Azure Load Balancer Rule - Azure CLI\nDESCRIPTION: Creates a load balancing rule for an Azure Load Balancer, configuring it to listen on a specified frontend port (e.g., 8000) and forward traffic to a backend port (e.g., 8000). It associates the rule with a health probe, sets an idle timeout, and enables TCP reset.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/private-link-to-upstreams.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\n$ az network lb rule create \\\n    --resource-group $APP_RESOURCE_GROUP \\\n    --lb-name load-balancer \\\n    --name 8000-rule \\\n    --protocol tcp \\\n    --frontend-port 8000 \\\n    --backend-port 8000 \\\n    --frontend-ip-name frontend \\\n    --backend-pool-name backend-pool \\\n    --probe-name 8000-probe \\\n    --idle-timeout 15 \\\n    --enable-tcp-reset true\n```\n\n----------------------------------------\n\nTITLE: Enabling mTLS via Config File - YAML\nDESCRIPTION: This snippet demonstrates how to enable mTLS by modifying the `/etc/nginx-agent/nginx-agent.conf` configuration file. It sets the `tls.enable`, `tls.cert`, `tls.key`, and `tls.ca` options to enable mTLS using the specified certificate and key files. The `server.metrics` and `server.command` values are set to `cert-sni-name` which should match the SubjectAltName of the server certificate.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/encrypt-communication.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nserver:\n  metrics: \"cert-sni-name\"\n  command: \"cert-sni-name\"\ntls:\n  enable: true\n  cert: \"path-to-cert\"\n  key: \"path-to-key\"\n  ca: \"path-to-ca-cert\"\n  skip_verify: false\n```\n\n----------------------------------------\n\nTITLE: Configuring gRPC Monitor URI in NGINX\nDESCRIPTION: This snippet demonstrates configuring the monitor URI for a gRPC service using the `app_protect_dos_monitor` directive. It involves specifying the protocol as grpc and including a valid gRPC method in the URI. The monitor URI specifies the endpoint used for monitoring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nlisten 50051 http2 reuseport;\nserver_name my_grpc;\n\nlocation /routeguide. {\n    # Protected Object is defined here\n    # Note: The URI must include a valid gRPC method (e.g., /routeguide.RouteGuide/GetFeature).\n    # The health check will expect a grpc-status of 12 (UNIMPLEMENTED) because it is not a true gRPC client.\n    app_protect_dos_monitor uri=http://my_grpc:50051/routeguide.RouteGuide/GetFeature protocol=grpc;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Plus API Location - Nginx\nDESCRIPTION: This configuration snippet defines a location block for the NGINX Plus API, typically under the path '/api'. The 'api write=on' directive enables write access to the API, allowing dynamic reconfiguration of upstream groups.  The 'allow' and 'deny' directives restrict access to the API, allowing only authorized administrators to make changes. This example allows access from localhost only.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_41\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /api {\n    api write=on;\n    allow 127.0.0.1;\n    deny all;\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Server-Side TLS with Environment Variables - Bash\nDESCRIPTION: This snippet shows how to enable server-side TLS by setting the `NGINX_AGENT_TLS_ENABLE` environment variable to `true`. This enables TLS without needing to specify certificates or keys.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/encrypt-communication.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nNGINX_AGENT_TLS_ENABLE=true\n```\n\n----------------------------------------\n\nTITLE: Installing GeoIP2 Module on CentOS/RHEL\nDESCRIPTION: This command updates the package manager and installs the `nginx-plus-module-geoip2` package on CentOS, Oracle Linux, and RHEL systems. The module facilitates using MaxMind GeoIP2 databases within Nginx Plus to obtain contextual data for IP addresses.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip2.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-geoip2\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisites for CentOS/RHEL/Oracle Linux\nDESCRIPTION: This command updates the package list and installs essential build tools and development libraries, including gcc, make, pcre-devel, and zlib-devel, on CentOS, RHEL, and Oracle Linux.  These are required for compiling NGINX modules.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_33\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update\nsudo yum install gcc make pcre-devel zlib-devel\n```\n\n----------------------------------------\n\nTITLE: Nginx Reverse Proxy Configuration\nDESCRIPTION: This configuration sets up Nginx as a reverse proxy for the domain 'domain.com'. It listens on port 80, enables NGINX App Protect WAF, sets the client maximum body size to 0, configures the default content type, and forwards requests to a backend server running on localhost:8080 using HTTP/1.1.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/default-conf-localhost.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80;\n    server_name domain.com;\n\n    proxy_http_version 1.1;\n\n    location / {\n\n        # NGINX App Protect WAF\n        app_protect_enable on;\n\n        client_max_body_size 0;\n        default_type text/html;\n        proxy_pass http://127.0.0.1:8080/;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring AJAX Response Page for SPAs in NGINX Policy (JSON)\nDESCRIPTION: This snippet configures an AJAX response page for Single Page Applications (SPAs).  When a request is blocked, a pop-up message will be displayed in the browser instead of a full HTML page. `ajaxEnabled` is set to true and `ajaxPopupMessage` contains the customized message to be displayed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/additional-config-options.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"NGINX-SPA\",\n        \"description\": \"Policy with AJAX response page enabled for blocking AJAX requests\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"enforcementMode\": \"blocking\",\n        \"response-pages\": [\n            {\n                \"responsePageType\": \"ajax\",\n                \"ajaxEnabled\": true,\n                \"ajaxPopupMessage\": \"My customized popup message! Your support ID is: <%TS.request.ID()%>\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: TrafficSplit Configuration for Blue-Green Deployment (100% v2.1)\nDESCRIPTION: This YAML configuration updates the TrafficSplit resource to implement a blue-green deployment strategy. It directs 100% of the traffic to the `target-v2-1` service and 0% to `target-v1-0`. This effectively switches all traffic from the old version to the new version. This is done after validating the new version works as expected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_15\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: split.smi-spec.io/v1alpha3\nkind: TrafficSplit\nmetadata:\n  name: target-ts\nspec:\n  service: target-svc\n  backends:\n  - service: target-v1-0\n    weight: 0\n  - service: target-v2-1\n    weight: 100\n```\n\n----------------------------------------\n\nTITLE: Enable gRPC Interface (nginx-agent.conf)\nDESCRIPTION: Configures the NGINX Agent to enable the gRPC interface. This involves setting the host and gRPC port in the `nginx-agent.conf` file. TLS is disabled in this example, which is not recommended for production environments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_8\n\nLANGUAGE: yaml\nCODE:\n```\nserver:\n  host: 127.0.0.1 # mock control plane host\n  grpcPort: 54789 # mock control plane gRPC port\n\n# gRPC TLS options - DISABLING TLS IS NOT RECOMMENDED FOR PRODUCTION\ntls:\n  enable: false\n  skip_verify: true\n```\n\n----------------------------------------\n\nTITLE: Enable App Protect Module in Nginx\nDESCRIPTION: This Nginx configuration enables the App Protect module and configures a basic server with a mirrored location. The `load_module` directive loads the App Protect module, and the `app_protect_enable on;` directive enables it for the root location. Logging is configured to capture request URIs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/configure-nginx-mirror.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n\nhttp {\n    log_format test $uri;\n\n    server {\n        listen       127.0.0.1:8080;\n        server_name  localhost;\n\n        location / {\n            app_protect_enable on;\n            mirror /mirror;\n        }\n\n        location /mirror {\n            log_subrequest on;\n            access_log test$args.log test;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Group for Exchange in NGINX\nDESCRIPTION: This snippet configures an upstream group named `exchange` with the `ntlm` directive enabled. This directive allows the servers in the group to accept requests with NTLM authentication. The `zone` directive is also included to share the configuration among worker processes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_20\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    upstream exchange {\n        zone exchange 64k;\n        ntlm;\n        # ...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Group for Load Balancing Nginx\nDESCRIPTION: This snippet configures an upstream group named 'weblogic' with two backend servers. This group is used for load balancing HTTP and HTTPS traffic to the specified servers. The configuration should be within the 'http' block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream weblogic {\n    server 192.168.25.33:7001;\n    server 192.168.25.69:7001;\n}\n```\n\n----------------------------------------\n\nTITLE: Enable Content Security Policy for Swagger UI\nDESCRIPTION: This snippet adds a Content Security Policy header to the Swagger UI location. It specifies that all resources should be loaded from the same origin, enhancing security.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_27\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /swagger-ui {\n    add_header Content-Security-Policy \"default-src 'self'\";\n    root       /usr/share/nginx/html;\n    allow      192.168.1.0/24;\n    deny       all;\n}\n```\n\n----------------------------------------\n\nTITLE: Edit Kubernetes ConfigMap (Shell)\nDESCRIPTION: This command opens the `nms-conf` ConfigMap for editing in a Kubernetes cluster.  Replace `<namespace>` with the actual namespace where NGINX Instance Manager is deployed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-forward-proxy.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nkubectl edit cm nms-conf -n <namespace>\n```\n\n----------------------------------------\n\nTITLE: Least Time Load Balancing\nDESCRIPTION: Configures Least Time load balancing based on the time to receive the header. The `least_time header` directive instructs NGINX Plus to select the server with the lowest average latency for receiving the response header.  This method optimizes for quick initial response times.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    least_time header;\n    server backend1.example.com;\n    server backend2.example.com;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring IMAP Upstream for TCP Load Balancing (Nginx)\nDESCRIPTION: This snippet configures an upstream group for IMAP servers in the 'stream' block. It defines the servers to be load balanced across, sets a zone for shared memory, and specifies the port (993) for IMAP traffic. Replace the IP addresses with the actual addresses of your CAS servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_25\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'stream' block\nupstream exchange-imaps {\n    zone exchange-imaps 64k;\n    server 10.0.0.237:993; # Replace with IP address of a CAS\n    server 10.0.0.238:993; # Replace with IP address of a CAS\n}\n```\n\n----------------------------------------\n\nTITLE: Implementing HTTP Basic Authentication Nginx\nDESCRIPTION: This snippet implements HTTP basic authentication for all methods except GET within the API location. It requires a username and password from the specified user file for PATCH, POST, and DELETE requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    server {\n        listen 192.168.1.23;\n        # ...\n        location /api {\n            limit_except GET {\n                auth_basic \"NGINX Plus API\";\n                auth_basic_user_file /path/to/passwd/file;\n            }\n            api   write=on;\n            allow 192.168.1.0/24;\n            deny  all;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent on Amazon Linux 2 (YUM)\nDESCRIPTION: This command installs the NGINX Agent package using the yum package manager on Amazon Linux 2. It assumes that the yum repository has been properly configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_34\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Set user password using basic_passwords.sh script in Bash\nDESCRIPTION: This script changes a user's password by running the `basic_passwords.sh` script, which requires OpenSSL v1.1.1 or later. The script adds the user's encrypted password to the `/etc/nms/nginx/.htpasswd` file on the NGINX Instance Manager host. The username and desired password are provided as arguments to the script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/basic-auth/set-up-basic-authentication.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo bash /etc/nms/scripts/basic_passwords.sh <username> '<desired password>'\n```\n\n----------------------------------------\n\nTITLE: Query Metric (http.request.count)\nDESCRIPTION: This cURL command queries the Metrics API for the `http.request.count` metric.  This is the most basic query, using only the `names` parameter which is required.  The response will contain the last recorded value for this metric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=http.request.count\"\n```\n\n----------------------------------------\n\nTITLE: Create API Proxy (JSON)\nDESCRIPTION: This snippet shows the JSON payload for creating a basic API proxy in API Connectivity Manager within a service workspace.  It defines the proxy's name, version, and configuration, including the hostname, ingress settings, and backend service targets. The backend service target specifies the Echo Server's hostname, port, and protocol.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/enable-metrics.md#_snippet_7\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"test-proxy\",\n   \"version\": \"v1\",\n   \"proxyConfig\": {\n      \"hostname\": \"data-host\",\n      \"ingress\": {\n         \"basePath\": \"/\",\n         \"basePathVersionAppendRule\": \"NONE\"\n      },\n      \"backends\": [\n         {\n            \"serviceName\": \"backend-echo-svc\",\n            \"serviceTargets\": [\n               {\n                  \"hostname\": \"192.0.2.4\",\n                  \"listener\": {\n                     \"enableTLS\": false,\n                     \"port\": 10000,\n                     \"transportProtocol\": \"HTTP\"\n                  }\n               }\n            ]\n         }\n      ]\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Nginx match block for POP3 response\nDESCRIPTION: This snippet demonstrates how to configure a `match` block to check for a specific response from a POP3 server.  It uses the `expect` parameter with a regular expression to verify that the server sends a '+OK' response.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nmatch pop3 {\n    expect ~* \"\\+OK\";\n}\n```\n\n----------------------------------------\n\nTITLE: IP Hash with Server Down\nDESCRIPTION: Configures IP Hash load balancing, marking one server as 'down'.  The `down` parameter excludes the server from the load-balancing rotation, while preserving the IP hash algorithm.  Requests that would have been processed by the 'down' server are automatically redirected to the next available server in the group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    server backend1.example.com;\n    server backend2.example.com;\n    server backend3.example.com down;\n}\n```\n\n----------------------------------------\n\nTITLE: Creating HTTP Health Check Policy (JSON Request)\nDESCRIPTION: This JSON snippet demonstrates the structure of a request to create an HTTP health check policy for NGINX API Proxies using the API. It includes parameters for defining the target backend, transport protocol, health check intervals, thresholds, and HTTP-specific configuration such as URI path and response matching criteria (status code, header, and body).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/health-check.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n    \"backend-health-check\": [\n      {\n        \"action\": {\n          \"targetBackendPolicyLabel\": \"default\",\n          \"transportProtocol\": \"http\",\n          \"isMandatory\": true,\n          \"persistent\": true,\n          \"port\": 8080,\n          \"interval\": 5,\n          \"unhealthyThreshold\": 3,\n          \"healthyThreshold\": 2,\n          \"http\": {\n            \"uriPath\": \"/health_check\",\n            \"responseMatch\": {\n              \"statusCode\": {\n                \"range\": [\n                  \"200-399\"\n                ]\n              },\n              \"header\": {\n                \"name\": \"some-header\",\n                \"value\": \"ok\",\n                \"condition\": \"=\"\n              },\n              \"body\": {\n                \"requiredVariable\": \"jsonField\",\n                \"value\": \"some-response-body\",\n                \"condition\": \"~\"\n              }\n            }\n          },\n          \"connectTimeout\": \"10s\",\n          \"readTimeout\": \"10s\"\n        }\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisites on Alpine Linux\nDESCRIPTION: This command installs the necessary prerequisites for installing NGINX Agent on Alpine Linux. It installs openssl, curl, and ca-certificates using the apk package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_22\n\nLANGUAGE: shell\nCODE:\n```\nsudo apk add openssl curl ca-certificates\n```\n\n----------------------------------------\n\nTITLE: Create Service Workspace (JSON)\nDESCRIPTION: This snippet shows the JSON payload for creating a service workspace in API Connectivity Manager. The service workspace provides a way to group API proxies. The minimum configuration requires a `name` field.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/enable-metrics.md#_snippet_6\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"service-ws\"\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Cookie-Based Session Persistence - Citrix ADC\nDESCRIPTION: This configures cookie-based session persistence on a Citrix ADC virtual server. It adds a load balancing virtual server 'mysslvserver' using SSL on IP address 10.0.0.91 and port 443.  It sets the persistence type to COOKIEINSERT with a timeout of 60 seconds and a cookie name of 'mysession', ensuring clients are directed to the same server based on the cookie.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_4\n\nLANGUAGE: none\nCODE:\n```\nadd lb vserver mysslvserver SSL 10.0.0.91 443 -persistenceType COOKIEINSERT -timeout 60 -cookieName mysession\n```\n\n----------------------------------------\n\nTITLE: Testing Nginx Configuration Syntax (Shell)\nDESCRIPTION: This command tests the Nginx configuration file for syntactic validity. It's recommended to run this command after any changes to the configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_10\n\nLANGUAGE: none\nCODE:\n```\nroot# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n```\n\n----------------------------------------\n\nTITLE: Install nginx-plus package on SLES\nDESCRIPTION: This command installs the nginx-plus package on SUSE Linux Enterprise Server using the zypper package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_21\n\nLANGUAGE: Shell\nCODE:\n```\nzypper install nginx-plus\n```\n\n----------------------------------------\n\nTITLE: Configuring UDP Upstream Group - NGINX\nDESCRIPTION: Defines an upstream group named `dns_upstream` with three servers listening on port 53, which are commonly used for DNS services. This upstream group is used to load balance UDP traffic across these servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    upstream dns_upstream {\n        server 192.168.136.130:53;\n        server 192.168.136.131:53;\n        server 192.168.136.132:53;\n    }\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Metrics API Response Example\nDESCRIPTION: This JSON snippet showcases an example response from the Metrics API. It contains query metadata and an array of metrics, with each metric including a name and data series.  Each series includes dimension values, timestamps, and corresponding metric values.  This example highlights how metrics data is grouped by dimension values like 'app', 'component', and 'environment'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"metrics\":[\n      {\n         \"name\":\"http.request.count\",\n         \"series\":[\n            {\n               \"dimensions\":{\n                  \"app\":\"app-name\",\n                  \"component\":\"component-name\",\n                  \"environment\":\"environment-name\",\n                  \"gateway\":\"gateway-name\",\n                  \"instance\":\"instance-name\"\n               },\n               \"timestamps\":[\n                  \"2020-07-01T12:00:00Z\"\n               ],\n               \"values\":[\n                  1000\n               ]\n            },\n            {\n               \"dimensions\":{\n                  \"app\":\"app-name-2\",\n                  \"component\":\"component-name\",\n                  \"environment\":\"environment-name\",\n                  \"gateway\":\"gateway-name\",\n                  \"instance\":\"instance-name\"\n               },\n               \"timestamps\":[\n                  \"2020-07-01T12:00:00Z\"\n               ],\n               \"values\":[\n                  2000\n               ]\n            }\n         ]\n      }\n   ],\n   \"queryMetadata\":{\n      \"endTime\":\"2020-07-01T12:00:00.970106672Z\"\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Enable Zone Synchronization NGINX\nDESCRIPTION: Enables synchronization between cluster nodes by creating a server block with the `zone_sync` directive within the top-level `stream` block. This configuration enables the NGINX instance to participate in state sharing with other nodes in the cluster. The `stream` block is used for TCP/UDP proxying, and `zone_sync` enables the zone synchronization module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n   #...\n\n    server {\n        zone_sync;\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Connection Settings via API with JSON\nDESCRIPTION: This JSON payload configures connection settings (timeouts and max body size) for an NGINX API proxy by defining `clientMaxBodySize`, `connectTimeout`, `readTimeout`, and `sendTimeout` parameters within the `backend-config` policy. These settings control the maximum client request body size and timeout values for establishing, reading from, and sending to the proxied server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/http-backend-configuration.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"policies\" : {\n      \"backend-config\" : [\n         {\n            \"action\" : {\n               \"clientMaxBodySize\" : \"2m\",\n               \"connectTimeout\": \"30s\",\n               \"readTimeout\": \"30s\",\n               \"sendTimeout\": \"30s\"\n            }\n         }\n      ]\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Ratio-based Tracing Configuration (Nginx)\nDESCRIPTION: This configuration enables sampling of requests for tracing based on configurable ratios. It uses `split_clients` to define the sampling ratios.  The `otel_trace` directive then uses the result of the `split_clients` block to determine whether to trace a request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_22\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # trace 10% of requests\n    split_clients $otel_trace_id $ratio_sampler {\n        10%     on;\n        *       off;\n    }\n\n    # or we can trace 10% of user sessions\n    split_clients $cookie_sessionid $session_sampler {\n        10%     on;\n        *       off;\n    }\n\n    server {\n        location / {\n            otel_trace $ratio_sampler;\n            otel_trace_context inject;\n\n            proxy_pass http://backend;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Testing NGINX configuration with curl (exact path)\nDESCRIPTION: This curl command tests the configuration by sending a request to the '/coffee' path. It demonstrates how the request is routed to the backend server when the path exactly matches what is defined in the HTTPRoute.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee\n```\n\n----------------------------------------\n\nTITLE: Example Get Servers API Response (JSON)\nDESCRIPTION: This JSON response contains details for scanned Nginx servers, providing information about their certificates, CVEs, network configuration (IP and port), server application, update time, vendor, and version.  The `items` array contains a list of objects, where each object represents a scanned Nginx server instance and its associated attributes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/scan-instances.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"items\": [\n    {\n      \"certs\": [],\n      \"createTime\": \"2021-12-01T19:00:27.514Z\",\n      \"cves\": [\n        {\n          \"advisory\": \"http://mailman.nginx.org/pipermail/nginx-announce/2021/000300.html\",\n          \"description\": \"1-byte memory overwrite in resolver\",\n          \"id\": \"2021-23017\",\n          \"severity\": \"medium\"\n        }\n      ],\n      \"links\": [],\n      \"network\": [\n        {\n          \"ip\": \"192.168.56.2\",\n          \"port\": 80\n        }\n      ],\n      \"serverApplication\": \"nginx\",\n      \"updateTime\": \"2021-12-01T19:00:27.514Z\",\n      \"vendor\": \"Ubuntu\",\n      \"version\": \"1.18.0\"\n    },\n    {\n      \"certs\": [],\n      \"createTime\": \"2021-12-01T19:00:27.514Z\",\n      \"cves\": [\n        {\n          \"advisory\": \"http://mailman.nginx.org/pipermail/nginx-announce/2021/000300.html\",\n          \"description\": \"1-byte memory overwrite in resolver\",\n          \"id\": \"2021-23017\",\n          \"severity\": \"medium\"\n        }\n      ],\n      \"links\": [],\n      \"network\": [\n        {\n          \"ip\": \"192.168.56.1\",\n          \"port\": 80\n        }\n      ],\n      \"serverApplication\": \"nginx\",\n      \"updateTime\": \"2021-12-01T19:00:27.514Z\",\n      \"vendor\": \"Ubuntu\",\n      \"version\": \"1.18.0\"\n    },\n    {\n      \"certs\": [],\n      \"createTime\": \"2021-12-01T19:00:27.515Z\",\n      \"cves\": [\n        {\n          \"advisory\": \"http://mailman.nginx.org/pipermail/nginx-announce/2021/000300.html\",\n          \"description\": \"1-byte memory overwrite in resolver\",\n          \"id\": \"2021-23017\",\n          \"severity\": \"medium\"\n        }\n      ],\n      \"links\": [],\n      \"network\": [\n        {\n          \"ip\": \"192.168.56.2\",\n          \"port\": 443\n        }\n      ],\n      \"serverApplication\": \"nginx\",\n      \"updateTime\": \"2021-12-01T19:00:27.515Z\",\n      \"vendor\": \"Ubuntu\",\n      \"version\": \"1.18.0\"\n    },\n    {\n      \"certs\": [\n        {\n          \"endpoint\": {\n            \"ip\": \"192.168.56.1\",\n            \"port\": 443\n          },\n          \"metadata\": {\n            \"authorityKeyIdentifier\": \"\",\n            \"commonName\": \"manager-server\",\n            \"expired\": false,\n            \"expiry\": 3161225998,\n            \"issuer\": \"C=US, ST=Washington, L=Seattle,  Inc., O=F5\\\\, OU=Controller, CN=apigw-svc\",\n            \"publicKeyType\": \"RSA (2048 bit)\",\n            \"serialNumber\": \"290091060211653667347751276868955784795456843516\",\n            \"signatureAlgorithm\": \"SHA256-RSA\",\n            \"subject\": \"C=US, ST=Washington, L=Seattle,  Inc., O=F5\\\\, OU=Controller, CN=manager-server\",\n            \"subjectAlternativeName\": \"manager-server\",\n            \"subjectKeyIdentifier\": \"\",\n            \"thumbprint\": \"E0:B3:53:81:59:28:B6:C5:88:41:11:8D:B3:E2:B1:C8:D4:32:C1:6B:46:8D:B4:45:37:75:2E:9B:29:C2:A1:70\",\n            \"thumbprintAlgorithm\": \"SHA-256\",\n            \"validFrom\": \"2021-11-20T06:48:59Z\",\n            \"validTo\": \"2122-02-04T06:48:59Z\",\n            \"version\": 3\n          }\n        }\n      ],\n      \"createTime\": \"2021-12-01T19:00:27.516Z\",\n      \"links\": [],\n      \"network\": [\n        {\n          \"ip\": \"192.168.56.1\",\n          \"port\": 443\n        }\n      ],\n      \"serverApplication\": \"nginx\",\n      \"updateTime\": \"2021-12-01T19:00:27.516Z\"\n    },\n    {\n      \"certs\": [\n        {\n          \"endpoint\": {\n            \"ip\": \"192.168.56.3\",\n            \"port\": 443\n          },\n          \"metadata\": {\n            \"authorityKeyIdentifier\": \"\",\n            \"commonName\": \"manager-server\",\n            \"expired\": false,\n            \"expiry\": 3161225998,\n            \"issuer\": \"C=US, ST=Washington, L=Seattle,  Inc., O=F5\\\\, OU=Controller, CN=apigw-svc\",\n            \"publicKeyType\": \"RSA (2048 bit)\",\n            \"serialNumber\": \"290091060211653667347751276868955784795456843516\",\n            \"signatureAlgorithm\": \"SHA256-RSA\",\n            \"subject\": \"C=US, ST=Washington, L=Seattle,  Inc., O=F5\\\\, OU=Controller, CN=manager-server\",\n            \"subjectAlternativeName\": \"manager-server\",\n            \"subjectKeyIdentifier\": \"\",\n            \"thumbprint\": \"E0:B3:53:81:59:28:B6:C5:88:41:11:8D:B3:E2:B1:C8:D4:32:C1:6B:46:8D:B4:45:37:75:2E:9B:29:C2:A1:70\",\n            \"thumbprintAlgorithm\": \"SHA-256\",\n            \"validFrom\": \"2021-11-20T06:48:59Z\",\n            \"validTo\": \"2122-02-04T06:48:59Z\",\n            \"version\": 3\n          }\n        }\n      ],\n      \"createTime\": \"2021-12-01T19:00:27.516Z\",\n      \"links\": [],\n      \"network\": [\n        {\n          \"ip\": \"192.168.56.3\",\n          \"port\": 443\n        }\n      ],\n      \"serverApplication\": \"nginx\",\n      \"updateTime\": \"2021-12-01T19:00:27.516Z\"\n    },\n    {\n      \"certs\": [],\n      \"createTime\": \"2021-12-02T00:27:34.507Z\",\n      \"cves\": [\n        {\n          \"advisory\": \"http://mailman.nginx.org/pipermail/nginx-announce/2021/000300.html\",\n          \"description\": \"1-byte memory overwrite in resolver\",\n          \"id\": \"2021-23017\",\n          \"severity\": \"medium\"\n        }\n      ],\n      \"links\": [],\n      \"network\": [\n        {\n          \"ip\": \"192.168.56.3\",\n          \"port\": 80\n        }\n      ],\n      \"serverApplication\": \"nginx\",\n      \"updateTime\": \"2021-12-02T00:27:34.507Z\",\n      \"vendor\": \"Ubuntu\",\n      \"version\": \"1.18.0\"\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Listing Security Policy Bundles Response - JSON\nDESCRIPTION: This is an example JSON response received when listing security policy bundles. It includes metadata for each bundle, like creation and modification timestamps, App Protect WAF version, policy name and UID, attack signature and threat campaign versions, a unique bundle UID, content information, and compilation status. This response provides a list of existing security policy bundles and their metadata.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_11\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"items\": [{\n      \"metadata\": {\n        \"created\": \"2023-10-04T23:19:58.502Z\",\n        \"modified\": \"2023-10-04T23:19:58.502Z\",\n        \"appProtectWAFVersion\": \"4.457.0\",\n        \"policyName\": \"default-enforcement\",\n        \"policyUID\": \"<policy-uid>\",\n        \"attackSignatureVersionDateTime\": \"2023.06.20\",\n        \"threatCampaignVersionDateTime\": \"2023.07.18\",\n        \"uid\": \"<bundle-uid>\"\n      },\n      \"content\": \"\",\n      \"compilationStatus\": {\n        \"status\": \"compiled\",\n        \"message\": \"\"\n      }\n    },\n    {\n      \"metadata\": {\n        \"created\": \"2023-10-04T23:19:58.502Z\",\n        \"modified\": \"2023-10-04T23:19:58.502Z\",\n        \"appProtectWAFVersion\": \"4.279.0\",\n        \"policyName\": \"defautl-enforcement\",\n        \"policyUID\": \"<policy-uid>\",\n        \"attackSignatureVersionDateTime\": \"2023.08.10\",\n        \"threatCampaignVersionDateTime\": \"2023.08.09\",\n        \"uid\": \"<bundle-uid>\"\n      },\n      \"content\": \"\",\n      \"compilationStatus\": {\n        \"status\": \"compiled\",\n        \"message\": \"\"\n      }\n    },\n    {\n      \"metadata\": {\n        \"created\": \"2023-10-04T23:19:58.502Z\",\n        \"modified\": \"2023-10-04T23:19:58.502Z\",\n        \"appProtectWAFVersion\": \"4.457.0\",\n        \"policyName\": \"ignore-xss\",\n        \"policyUID\": \"<policy-uid>\",\n        \"attackSignatureVersionDateTime\": \"2023.08.10\",\n        \"threatCampaignVersionDateTime\": \"2023.08.09\",\n        \"uid\": \"<bundle-uid>\"\n      },\n      \"content\": \"\",\n      \"compilationStatus\": {\n        \"status\": \"compiling\",\n        \"message\": \"\"\n      }\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Query HTTP Request Rate with Prometheus\nDESCRIPTION: This Prometheus query calculates the rate of HTTP requests flowing through the NGINX Service Mesh. It uses the `irate` function to compute the per-second average rate of increase of the `nginxplus_http_requests_total` counter over a 30-second window.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_0\n\nLANGUAGE: promQL\nCODE:\n```\nirate(nginxplus_http_requests_total[30s])\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisite Packages\nDESCRIPTION: Installs prerequisite packages required for adding the NGINX repository, including apt-transport-https, lsb-release, ca-certificates, wget, gnupg2, and debian-archive-keyring. This command also updates the apt package list.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-debian.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get update && sudo apt-get install apt-transport-https lsb-release ca-certificates wget gnupg2 debian-archive-keyring\n```\n\n----------------------------------------\n\nTITLE: Query TCP First Byte Time with Prometheus\nDESCRIPTION: This Prometheus query retrieves the time to first byte for TCP connections to upstream servers. The query uses the `nginxplus_stream_upstream_server_first_byte_time` metric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_6\n\nLANGUAGE: promQL\nCODE:\n```\nnginxplus_stream_upstream_server_first_byte_time\n```\n\n----------------------------------------\n\nTITLE: Installing Brotli Module on SLES 15\nDESCRIPTION: This command refreshes the package repositories and installs the nginx-plus-module-brotli package using the zypper package manager on SLES 15 systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/brotli.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-brotli\n```\n\n----------------------------------------\n\nTITLE: Add Nginx mainline repository to apt sources\nDESCRIPTION: This command adds the Nginx mainline repository to the apt sources list, allowing apt to install the latest mainline Nginx packages from the official Nginx repository.  It uses lsb_release to determine the Debian codename. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\necho \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n    http://nginx.org/packages/mainline/debian `lsb_release -cs` nginx\" \\\n        | sudo tee /etc/apt/sources.list.d/nginx.list\n```\n\n----------------------------------------\n\nTITLE: Listing Secrets with Label Selector (kubectl)\nDESCRIPTION: This command uses `kubectl` to retrieve all Kubernetes Secrets with the label `usage=nginx-mesh-registry-key` across all namespaces. It's used to identify the secrets created for private registry access by NGINX Service Mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/private-registry.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get secrets -l usage=nginx-mesh-registry-key -A\n```\n\n----------------------------------------\n\nTITLE: Check Nginx status\nDESCRIPTION: This command checks the status of the Nginx service using systemctl. It's a preliminary step to ensure Nginx is running before installing Nginx Agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/getting-started.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl status nginx\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX ModSecurity WAF on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This snippet shows how to install the NGINX ModSecurity WAF module package on Amazon Linux 2, CentOS, Oracle Linux, and RHEL using the `yum` package manager. It first updates the package list and then installs the specified module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginx-waf.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-modsecurity\n```\n\n----------------------------------------\n\nTITLE: Configuring Virtual Server on NGINX Plus\nDESCRIPTION: This code snippet shows how to configure a virtual server in NGINX Plus to listen on port 80 and proxy traffic to an upstream pool.  It defines an upstream block with two servers and a server block that listens on a specific IP and port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    upstream test_pool {\n        server 10.10.10.10:80;\n        server 10.10.10.20:80;\n    }\n\n    server {\n        listen 192.168.10.10:80;\n        location / {\n            proxy_pass http://test_pool;\n        }\n        #...\n     }\n }\n```\n\n----------------------------------------\n\nTITLE: List Available Image Tags from Docker Registry\nDESCRIPTION: This command retrieves and formats the list of available tags for the NGINX App Protect WAF compiler image from the private registry. It uses curl to make the request with the client key and certificate, and jq to format the JSON response for readability. Requires jq to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ncurl -s https://private-registry.nginx.com/v2/nap/waf-compiler/tags/list --key <path-to-your-nginx-repo.key> --cert <path-to-your-nginx-repo.crt> |jq\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Group with Shared Memory Zone\nDESCRIPTION: This snippet configures an upstream group named 'tomcat' and defines a shared memory zone for storing the group's configuration and runtime state, which are shared among worker processes. This shared memory is necessary for the health check and live activity monitoring features.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_32\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream tomcat {\n   zone tomcat 64k;\n\n   server 10.100.100.11:8080;\n   server 10.100.100.12:8080;\n   # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring WebSocket Proxying with Nginx\nDESCRIPTION: This snippet configures Nginx as a reverse proxy for WebSocket connections to a Tomcat application. It sets necessary headers for WebSocket communication, including `Upgrade` and `Connection`, and defines the target server for the proxy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_20\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /wstunnel/ {\n    proxy_pass http://tomcat;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection $connection_upgrade;\n}\n```\n\n----------------------------------------\n\nTITLE: Checking NGINX Status\nDESCRIPTION: This snippet provides a command to check the status of the NGINX service. This helps verify that NGINX is running after the upgrade.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/admin-guide/upgrade-nap-waf.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl status nginx\n```\n\n----------------------------------------\n\nTITLE: Enabling Evasion Technique Violation with Sub-Violations in JSON\nDESCRIPTION: This JSON snippet demonstrates how to enable the evasion technique violation and its sub-violations within an NGINX App Protect policy. It sets the 'VIOL_EVASION' violation to block mode and enables various sub-violations such as 'Bad unescape', 'Directory traversals', and 'Multiple decoding'. The 'maxDecodingPasses' parameter is used to configure the maximum decoding passes for the 'Multiple decoding' sub-violation. Not listing a sub-violation means the default configuration will not be overridden for it.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/policy-authoring-and-tuning.md#_snippet_6\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"evasions_enabled\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_EVASION\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ],\n            \"evasions\": [\n                {\n                    \"description\": \"Bad unescape\",\n                    \"enabled\": true\n                },\n                {\n                    \"description\": \"Directory traversals\",\n                    \"enabled\": true\n                },\n                {\n                    \"description\": \"Bare byte decoding\",\n                    \"enabled\": true\n                },\n                {\n                    \"description\": \"Apache whitespace\",\n                    \"enabled\": true\n                },\n                {\n                    \"description\": \"Multiple decoding\",\n                    \"enabled\": true,\n                    \"maxDecodingPasses\": 2\n                },\n                {\n                    \"description\": \"IIS Unicode codepoints\",\n                    \"enabled\": true\n                },\n                {\n                    \"description\": \"IIS backslashes\",\n                    \"enabled\": true\n                },\n                {\n                    \"description\": \"%u decoding\",\n                    \"enabled\": true\n                }\n            ]\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Plus Repo to Ubuntu\nDESCRIPTION: Adds the NGINX Plus repository to the system's APT sources list for Ubuntu. This allows the system to find and install the NGINX Plus packages. The Ubuntu version is dynamically determined using lsb_release.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n    https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" \\\n    | sudo tee /etc/apt/sources.list.d/nginx-plus.list\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Plus Repo to Debian\nDESCRIPTION: Adds the NGINX Plus repository to the system's APT sources list for Debian. The lsb_release command is used to dynamically determine the Debian version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n    https://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\\n\" \\\n    | sudo tee /etc/apt/sources.list.d/nginx-plus.list\n```\n\n----------------------------------------\n\nTITLE: Applying Deployment with Auto-Injection Enabled\nDESCRIPTION: This command applies a Kubernetes Deployment manifest file (e.g., `examples/bookinfo.yaml`). Because auto-injection is enabled in the namespace, the NGINX Service Mesh sidecar proxy will be automatically added to the Pods defined in the manifest.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/deploy-example-app.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f examples/bookinfo.yaml\n```\n\n----------------------------------------\n\nTITLE: Configure Rate Limiting in NGINX Service Mesh (YAML)\nDESCRIPTION: This YAML configuration defines a RateLimit resource in NGINX Service Mesh to limit traffic from a specific source deployment to a destination service. It uses an HTTPRouteGroup to filter requests based on the 'get-only' match. Rate is set to 10 requests per minute with a burst of 10 and no delay.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/smi-traffic-policies.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi.nginx.com/v1alpha2\nkind: RateLimit\nmetadata:\n  name: ratelimit-v1\n  namespace: default\nspec:\n  destination:\n    kind: Service\n    name: dest-svc\n    namespace: default\n  sources:\n    - kind: Deployment\n      name: source-1\n      namespace: default\n  name: 10rm\n  rate: 10r/m\n  burst: 10\n  delay: \"nodelay\"\n  rules:\n    - kind: HTTPRouteGroup\n      name: hrg\n      matches:\n        - get-only\n```\n\n----------------------------------------\n\nTITLE: Install Keepalived on RHEL Systems (CentOS, RHEL)\nDESCRIPTION: This snippet shows how to install `keepalived` on RHEL-based systems using `yum`. It installs the `keepalived` package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install keepalived -y\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX and BD Processes (Shell)\nDESCRIPTION: These commands use `ps -ef` to list all running processes and then `grep` to filter the output and show only processes related to `nginx` and `bd`. This verifies that both NGINX and the BD agent are running.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nps -ef | grep nginx\nps -ef | grep bd\n```\n\n----------------------------------------\n\nTITLE: OpenSSL Agent Configuration\nDESCRIPTION: This YAML configuration file defines settings for creating an agent certificate for NGINX Agent using OpenSSL. It specifies parameters such as key size (2048 bits), distinguished name fields, and extensions for the agent certificate, including basic constraints (CA:FALSE), key usage (nonRepudiation, digitalSignature, keyEncipherment, keyAgreement), and extended key usage (clientAuth). This certificate is used for client authentication when connecting to NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\n[req]\nprompt             = no\ndefault_bits       = 2048\nx509_extensions    = v3_req\nreq_extensions     = v3_req\ndefault_md         = sha256\ndistinguished_name = req_distinguished_name\n\n# recommend changing these to your needs\n[req_distinguished_name]\ncountryName                 = US\nstateOrProvinceName         = California\nlocalityName                = San Francisco\norganizationName            = NGINX, Inc.\ncommonName                  = agent.example.com\n\n[v3_req]\nbasicConstraints = CA:FALSE\nkeyUsage         = nonRepudiation, digitalSignature, keyEncipherment, keyAgreement\nextendedKeyUsage = critical, clientAuth\n```\n\n----------------------------------------\n\nTITLE: Upstream Zone Configuration\nDESCRIPTION: This snippet defines a shared memory zone for the 'weblogic' upstream group. This zone stores the group's configuration and runtime state, allowing it to be shared between worker processes. It is important for the `health_check` directive to function correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_32\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream weblogic {\n    zone weblogic 64k;\n    server 192.168.25.33:7001;\n    server 192.168.25.69:7001;\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Updating App Protect WAF (Debian/Ubuntu)\nDESCRIPTION: These commands are used to update the App Protect WAF solution on Debian or Ubuntu based systems. It stops the Nginx service, updates the apt-get package list, installs the app-protect package using apt-get, and then starts the Nginx service. Requires `sudo`, `service`, `apt-get`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nsudo service nginx stop\nsudo apt-get update\nsudo apt-get install app-protect\nsudo service nginx start\n```\n\n----------------------------------------\n\nTITLE: Applying Kubernetes Manifests\nDESCRIPTION: This command applies the Kubernetes manifests located in the `/home/user/k8s` directory to the Kubernetes cluster.  It creates or updates the resources defined in the manifests, such as Deployments, Services, and PersistentVolumeClaims. This command is the primary method for deploying the application defined in the YAML files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_25\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f /home/user/k8s\n```\n\n----------------------------------------\n\nTITLE: Enabling NTLM Authentication via API (JSON)\nDESCRIPTION: This snippet demonstrates how to enable or disable NTLM authentication for an API proxy using a POST request with a JSON payload. The `enableNTLMAuthn` parameter within the `backend-config` policy controls the NTLM authentication setting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/http-backend-configuration.md#_snippet_10\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"policies\" : {\n      \"backend-config\" : [\n         {\n            \"action\" : {\n               \"enableNTLMAuthn\": false\n            }\n         }\n      ]\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing EPEL Release on CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This command updates the package repositories and installs the EPEL repository on CentOS, Oracle Linux, and RHEL systems.  This is a prerequisite for installing the nginx-plus-module-brotli package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/brotli.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install epel-release -y\n```\n\n----------------------------------------\n\nTITLE: Restore Default SELinux Labels for NGINX Instance Manager\nDESCRIPTION: Restores the default SELinux security context labels for NGINX Instance Manager binaries, systemd service files, configuration files, and directories.  This ensures that the files and processes have the correct security attributes. Requires `restorecon` utility to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-selinux.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo restorecon -F -R /usr/bin/nms-core\nsudo restorecon -F -R /usr/bin/nms-dpm\nsudo restorecon -F -R /usr/bin/nms-ingestion\nsudo restorecon -F -R /usr/bin/nms-integrations\nsudo restorecon -F -R /usr/lib/systemd/system/nms.service\nsudo restorecon -F -R /usr/lib/systemd/system/nms-core.service\nsudo restorecon -F -R /usr/lib/systemd/system/nms-dpm.service\nsudo restorecon -F -R /usr/lib/systemd/system/nms-ingestion.service\nsudo restorecon -F -R /usr/lib/systemd/system/nms-integrations.service\nsudo restorecon -F -R /var/lib/nms/modules/manager.json\nsudo restorecon -F -R /var/lib/nms/modules.json\nsudo restorecon -F -R /var/lib/nms/streaming\nsudo restorecon -F -R /var/lib/nms\nsudo restorecon -F -R /var/lib/nms/dqlite\nsudo restorecon -F -R /var/run/nms\nsudo restorecon -F -R /var/lib/nms/modules\nsudo restorecon -F -R /var/log/nms\n```\n\n----------------------------------------\n\nTITLE: App Component with BYO WAF Policy (JSON)\nDESCRIPTION: This JSON snippet shows how to add a reference to a Security Strategy (containing a BYO NGINX App Protect WAF policy) to an App Component. It requires sending a PUT request to the Components REST API.  `isMonitorOnly` and `signatureOverrides` are not supported when referencing a custom security strategy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/add-app-security-with-waf.md#_snippet_4\n\nLANGUAGE: JSON\nCODE:\n```\n{\n     \"security\": {\n      \"strategyRef\": {\n        \"ref\": \"/security/strategies/<yourSecStrategyName>\"\n      },\n      \"waf\": {\n        \"isEnabled\": true\n      }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Restart API Connectivity Manager service\nDESCRIPTION: This command restarts the specific service for API Connectivity Manager. This is needed to make sure API Connectivity Manager uses the latest configurations and code after an upgrade.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nms-acm\n```\n\n----------------------------------------\n\nTITLE: Install Debian Prerequisites - Shell\nDESCRIPTION: Installs the required packages on Debian systems to handle https repositories and cryptographic operations. These include curl, gnupg2, ca-certificates, lsb-release, and debian-archive-keyring, which are necessary for setting up and utilizing the Nginx Agent repository securely.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt install curl gnupg2 ca-certificates lsb-release debian-archive-keyring\n```\n\n----------------------------------------\n\nTITLE: Downloading Multiple Web Entry Points Configuration - Shell\nDESCRIPTION: These commands download a complete NGINX configuration file for multiple web entry points into the `/etc/nginx/conf.d` directory using `curl`. The first command changes the current directory to `/etc/nginx/conf.d`, and the second command downloads the configuration file from the specified URL and saves it as `oracle-multiple-entry-point.conf`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_10\n\nLANGUAGE: none\nCODE:\n```\nroot# cd /etc/nginx/conf.d\nroot# curl https://www.nginx.com/resource/conf/oracle-multiple-entry-point.conf > oracle-multiple-entry-point.conf\n```\n\n----------------------------------------\n\nTITLE: Test NGINX Configuration\nDESCRIPTION: This shell command tests the NGINX configuration file for syntax errors before reloading the configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Running NGINX Plus Container with JWT License (Shell)\nDESCRIPTION: This snippet demonstrates how to run a Docker container with NGINX Plus, passing the JWT license file as an environment variable. It uses `docker run` with the `--env` flag to set the `NGINX_LICENSE_JWT` variable by reading the contents of the `license.jwt` file. The container is configured to restart automatically and uses the `runc` runtime.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_12\n\nLANGUAGE: sh\nCODE:\n```\nsudo docker run \\\n--env=NGINX_LICENSE_JWT=$(cat license.jwt) \\\n--restart=always \\\n--runtime=runc \\\n-d <YOUR_REGISTRY>/nginx-plus/base:<VERSION_TAG>\n```\n\n----------------------------------------\n\nTITLE: HTTPS Cookie Persistence on BIG-IP LTM\nDESCRIPTION: This code snippet configures HTTPS cookie-based session persistence on BIG-IP LTM. It creates a persistence profile and modifies the SSL virtual server to use it.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_8\n\nLANGUAGE: none\nCODE:\n```\n# create persistence cookie test_bigip_cookie cookie-name BIGIP_COOKIE_PERSIST expiration 1:0:0\n# modify virtual test_ssl_virtual { persist replace-all-with { test_bigip_cookie } }\n# save /sys config\n```\n\n----------------------------------------\n\nTITLE: Configuring SecRemoteRules in main.conf - Nginx\nDESCRIPTION: This snippet demonstrates how to configure the `SecRemoteRules` directive in the `/etc/nginx/modsec/main.conf` file. This directive instructs the NGINX ModSecurity WAF to download rules from a remote server using a specified license key. Ensure any other rules, like SecRule, are commented out.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-trustwave-spiderlabs-rules.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\n# Include the recommended configuration\nInclude \"/etc/nginx/modsec/modsecurity.conf\"\nSecRemoteRules <license‑key> https://<url>\n```\n\n----------------------------------------\n\nTITLE: Enabling STARTTLS for Mail Proxy\nDESCRIPTION: This configuration snippet shows how to enable STARTTLS for the mail proxy using the `starttls` directive. This allows for opportunistic encryption.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nstarttls on;\n```\n\n----------------------------------------\n\nTITLE: Configuring mTLS in NGINX mgmt block\nDESCRIPTION: This snippet demonstrates how to configure mutual TLS (mTLS) for secure communication between NGINX Plus and NGINX Instance Manager. It includes specifying SSL protocols, ciphers, client certificate, private key, trusted CA certificate, and SSL verification settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/usage-tracking/agentless-reporting.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers   DEFAULT;\n\n    ssl_certificate     client_cert.pem;\n    ssl_certificate_key client_cert.key;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Verifying NGINX is Running on Ubuntu\nDESCRIPTION: This command sends an HTTP HEAD request to the local NGINX server (127.0.0.1) and displays the response headers. It is used to verify that NGINX is running and accessible on the default port (80).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_29\n\nLANGUAGE: shell\nCODE:\n```\ncurl -I 127.0.0.1\n```\n\n----------------------------------------\n\nTITLE: Full Configuration for Enhanced Load Balancing - Nginx\nDESCRIPTION: This is a full Nginx configuration demonstrating enhanced load balancing features. It includes proxy caching, websocket support, session persistence using cookies and the jvmRoute parameter, application health checks, and a secure API endpoint. It requires the http context and includes definitions for upstream tomcat servers, server blocks for HTTP and HTTPS traffic, and map directives for managing cookies and URIs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_44\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /tmp/NGINX_cache/ keys_zone=backcache:10m;\n\n# WebSocket configuration\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n\n# Extract the data after the final period (.) in the\n# JSESSIONID cookie and store it in the $route_cookie variable.\nmap $cookie_jsessionid $route_cookie {\n    ~.+\\.(?P<route>w+)$ $route;\n}\n\n# Search the URL for a trailing jsessionid parameter, extract the\n# data after the final period (.), and store it in\n# the $route_uri variable.\nmap $request_uri $route_uri {\n    jsessionid=.+\\.(?P<route>w+)$ $route;\n}\n\n# Application health checks\nmatch tomcat_check {\n    status 200;\n    header Content-Type = text/html;\n    body ~ \"Apache Tomcat/8\";\n}\n\nupstream tomcat {\n    # Shared memory zone for application health checks, live activity\n    # monitoring, and dynamic reconfiguration\n    zone tomcat 64k;\n\n    # List of Tomcat application servers\n    server 10.100.100.11:8080 slow_start=30s;\n    server 10.100.100.12:8080 slow_start=30s;\n\n    # Session persistence based on the jvmRoute value in\n    # the JSESSION ID cookie\n    sticky route $route_cookie $route_uri;\n\n    # Uncomment the following directive (and comment the preceding\n    # 'sticky route' and JSESSIONID 'map' directives) for session\n    # persistence based on the JSESSIONID\n    #sticky learn create=$upstream_cookie_JSESSIONID\n    #             lookup=$cookie_JSESSIONID\n    #             zone=client_sessions:1m;\n}\n\nserver {\n    listen 80;\n    server_name example.com;\n    # Redirect all HTTP requests to HTTPS\n    location / {\n        return 301 https://$server_name$request_uri;\n     }\n}\n\nserver {\n    listen 443 ssl;\n    http2  on;\n\n    server_name example.com;\n\n    # Required for live activity monitoring of HTTPS traffic\n    status_zone tomcat;\n\n    ssl_certificate     /etc/nginx/ssl/example.com.crt;\n    ssl_certificate_key /etc/nginx/ssl/example.com.key;\n    ssl_session_cache         shared:SSL:1m;\n    ssl_prefer_server_ciphers on;\n\n    # Load balance requests for '/tomcat-app/' across Tomcat application\n    # servers\n    location /tomcat-app/ {\n        proxy_pass http://tomcat;\n        proxy_cache backcache;\n\n        # Active health checks\n        health_check interval=2s fails=1 passes=5 uri=/ match=tomcat_check;\n    }\n\n    # Return a 302 redirect to '/tomcat-app/' when user requests '/'\n    location = / {\n        return 302 /tomcat-app/;\n    }\n\n    # WebSocket configuration\n    location /wstunnel/ {\n        proxy_pass http://tomcat;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n    }\n\n    # Secured access to the NGINX Plus API\n    location /api {\n        api write=on;\n        allow 127.0.0.1; # Permit access from localhost\n        deny all;        # Deny access from everywhere else\n    }\n}\n\n```\n\n----------------------------------------\n\nTITLE: Create Cluster Zone Sync Policy - All options specified - JSON\nDESCRIPTION: This JSON payload demonstrates a complete Cluster Zone Sync policy configuration, including all available options. It covers TCP server settings (listeners, hostnames, TLS protocols, cipher suites, session cache), DNS resolver settings, Zone Sync TLS configuration (enablement, certificate verification, SNI), synchronization buffers, connection timeouts, and certificates. It shows all possible configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/cluster-zone-sync.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"cluster-zone-sync\": [\n    {\n      \"action\": {\n        \"tcpServer\": {\n          \"listeners\": [\n            {\n              \"port\": 12345,\n              \"tlsEnabled\": true\n            }\n          ],\n          \"hostnames\": [\"10.0.0.9\"],\n          \"tlsProtocols\": [\"TLSv1.1\", \"TLSv1.2\", \"TLSv1.3\"],\n          \"tlsCipher\": \"ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384\",\n          \"tlsSessionCache\": {\n            \"enable\": \"none\"\n          },\n          \"tlsSessionTimeOut\": \"15m\"\n        },\n        \"resolver\": {\n          \"enableIPv6\": false,\n          \"valid\": \"30s\",\n          \"timeout\": \"5s\",\n          \"servers\": [\n            {\n              \"hostname\": \"192.0.2.0\"\n            }\n          ]\n        },\n        \"enableZoneSyncTLS\": true,\n        \"enableZoneSyncCertVerify\": true,\n        \"zoneSyncCertChainVerifyDepth\": 2,\n        \"zoneSyncEnableSNI\": true,\n        \"zoneSyncTLSServerName\": \"custom-sni-host.com\",\n        \"zoneSyncServers\": [\n          {\n            \"name\": \"nginx-cluster.com\",\n            \"port\": 12345\n          }\n        ],\n        \"syncBuffers\": {\n          \"number\": 10,\n          \"size\": \"8k\"\n        },\n        \"connectionRetryInterval\": \"8s\",\n        \"connectionTimeout\": \"10m\",\n        \"timeout\": \"5s\",\n        \"interval\": \"1s\"\n      },\n      \"data\": {\n        \"serverCerts\": [\n          {\n            \"key\": \"<server-key>\",\n            \"cert\": \"<server-cert>\"\n          }\n        ],\n        \"zoneSyncCerts\": [\n          {\n            \"key\": \"<server-key>\",\n            \"cert\": \"<server-cert>\"\n          }\n        ],\n        \"zoneSyncTrustedCACert\": \"<ca-cert>\"\n      }\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Keepalived Configuration File Example\nDESCRIPTION: This is an example of a keepalived configuration file generated by the `nginx-ha-setup` script. It configures VRRP, health checks, and notification settings for NGINX Plus high availability.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nglobal_defs {\n    vrrp_version 3\n}\n\nvrrp_script chk_manual_failover {\n    script   \"/usr/libexec/keepalived/nginx-ha-manual-failover\"\n    interval 10\n    weight   50\n}\n\nvrrp_script chk_nginx_service {\n    script   \"/usr/libexec/keepalived/nginx-ha-check\"\n    interval 3\n    weight   50\n}\n\nvrrp_instance VI_1 {\n    interface                  eth0\n    priority                   101\n    virtual_router_id          51\n    advert_int                 1\n    accept\n    garp_master_refresh        5\n    garp_master_refresh_repeat 1\n    unicast_src_ip             192.168.100.100\n\n    unicast_peer {\n        192.168.100.101\n    }\n\n    virtual_ipaddress {\n        192.168.100.150\n    }\n\n    track_script {\n        chk_nginx_service\n        chk_manual_failover\n    }\n\n    notify \"/usr/libexec/keepalived/nginx-ha-notify\"\n}\n\n```\n\n----------------------------------------\n\nTITLE: Rate Limit Policy Configuration (YAML)\nDESCRIPTION: This YAML configuration defines a rate limit policy named `ratelimit-v1` in the `default` namespace. It limits traffic from `client-v1` to `dest-svc` to 10 requests per minute. The `destination` specifies the target service, and the `sources` list specifies the clients to which the rate limit applies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi.nginx.com/v1alpha2\nkind: RateLimit\nmetadata:\n  name: ratelimit-v1\n  namespace: default\nspec:\n  destination:\n    kind: Service\n    name: dest-svc\n    namespace: default\n  sources:\n  - kind: Deployment\n    name: client-v1\n    namespace: default\n  name: 10rm\n  rate: 10r/m\n```\n\n----------------------------------------\n\nTITLE: Resolve NLB DNS Name to IP Address\nDESCRIPTION: This command resolves the provided DNS name (obtained from the previous step in AWS) to an IP address. It is intended for testing purposes as the DNS name is recommended.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/expose-nginx-gateway-fabric.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nnslookup <dns-name>\n```\n\n----------------------------------------\n\nTITLE: Compiling NGINX with Mail Modules\nDESCRIPTION: This command configures NGINX Open Source with the necessary mail modules for email proxy functionality and SSL/TLS support. It specifies the mail module and the mail SSL module, including the path to the OpenSSL library.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\n./configure --with-mail --with-mail_ssl_module --with-openssl=[DIR]/openssl-1.1.1\n```\n\n----------------------------------------\n\nTITLE: Run license_usage_offline.sh - NGINX Instance Manager\nDESCRIPTION: This bash script automates the process of adding a license to NGINX Instance Manager and submitting the initial usage report in a disconnected environment.  It takes several parameters, including the license file path, NIM IP address, username, password, output report filename, and the submission type (initial).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\n./license_usage_offline.sh \\\n  -j <license-filename>.jwt \\\n  -i <NIM-IP-address> \\\n  -u admin \\\n  -p <password> \\\n  -o report.zip \\\n  -s initial\n```\n\n----------------------------------------\n\nTITLE: Add User to nginx-agent Group\nDESCRIPTION: This command adds a specified user to the `nginx-agent` group using `usermod`.  The `-a` option appends the user to the group, and the `-G` option specifies the group. `sudo` is required for administrative privileges. The `<username>` should be replaced with the actual NGINX user.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configure-nginx-agent-group.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo usermod -a -G nginx-agent <username>\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX with App Protect WAF\nDESCRIPTION: This code configures the NGINX web server and integrates the NGINX App Protect WAF module. It sets parameters for user, worker processes, logging, event handling, HTTP server settings, and the App Protect enforcer address. This configuration prepares NGINX to handle web traffic and provides a base configuration for security rules.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/nginx-conf-hostname-docker.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nuser  nginx;\nworker_processes  auto;\n\n# NGINX App Protect WAF\nload_module modules/ngx_http_app_protect_module.so;\n\nerror_log  /var/log/nginx/error.log notice;\npid        /var/run/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                    '$status $body_bytes_sent \"$http_referer\" '\n                    '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    # NGINX App Protect WAF\n    app_protect_enforcer_address waf-enforcer:50000;\n\n    include /etc/nginx/conf.d/*.conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Collect Backup Info (Docker)\nDESCRIPTION: This command executes the `nim-backup` script inside the `nim-nim-1` Docker container to generate a new backup of NGINX Instance Manager data for support purposes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\ndocker exec nim-nim-1 nim-backup\n```\n\n----------------------------------------\n\nTITLE: Complete OIDC Configuration Example (Nginx)\nDESCRIPTION: This is a complete example combining the DNS resolver configuration, OIDC provider definition, SSL configuration, and proxy settings for Ping Identity OIDC integration with Nginx. Placeholders like <environment_id>, <client_id>, and <client_secret> must be replaced with the actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/ping-identity.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # Use a public DNS resolver for Issuer discovery, etc.\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider ping {\n        # The issuer is typically something like:\n        # https://auth.pingone.com/<environment_id>/as\n        issuer https://auth.pingone.com/<environment_id>/as;\n\n        # Your Ping Identity Client ID and Secret\n        client_id <client_id>;\n        client_secret <client_secret>;\n    }\n\n    server {\n        listen 443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n            # Enforce OIDC with Ping Identity\n            auth_oidc ping;\n\n            # Forward OIDC claims as headers if desired\n            proxy_set_header sub $oidc_claim_sub;\n            proxy_set_header email $oidc_claim_email;\n            proxy_set_header name $oidc_claim_name;\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n\n    server {\n        # Simple backend application for demonstration\n        listen 8080;\n\n        location / {\n            return 200 \"Hello, $http_name!\\nEmail: $http_email\\nSub: $http_sub\\n\";\n            default_type text/plain;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Edit NginxGateway resource\nDESCRIPTION: This command opens the NginxGateway custom resource in the default editor, allowing for modifications to the NGINX Gateway Fabric control plane configuration. It uses `kubectl` to edit the resource in the `nginx-gateway` namespace. Changes are automatically applied to the control plane. The resource name, `ngf-config`, may need to be adjusted based on the installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/control-plane-configuration.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n nginx-gateway edit nginxgateways ngf-config\n```\n\n----------------------------------------\n\nTITLE: Extracting NGINX Instance Manager Helm Chart (tar)\nDESCRIPTION: This command extracts the downloaded NGINX Instance Manager Helm chart from a gzipped tar archive.  Replace `nms-<version>.tgz` with the actual filename. Requires `tar` utility.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ntar zxvf nms-<version>.tgz\n```\n\n----------------------------------------\n\nTITLE: Load NGINX Prometheus Module (Gateway) - JSON\nDESCRIPTION: This JSON snippet configures a gateway to load the NGINX Prometheus module. It uses `mainSnippet` to include the `load_module` directive, specifying the path to the module's shared object. It also uses `httpSnippet` to import the prometheus.js file for use in reporting metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-snippets.md#_snippet_3\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"<gateway-name>\"\n    },\n    \"desiredState\": {\n        \"configSnippets\": {\n            \"mainSnippet\": {\n                \"directives\": [\n                    {\n                        \"directive\": \"load_module\",\n                        \"args\": [\"modules/ngx_http_js_module.so\"]\n                    }\n                ]\n            },\n                \"httpSnippet\":{\n                \"directives\": [\n                    {\n                        \"directive\": \"js_import\",\n                        \"args\": [\"/usr/share/nginx-plus-module-prometheus/prometheus.js\"]\n                    }\n                ]\n            }\n        },\n        \"ingress\": {\n            \"uris\": {\n                \"http://example.com:8020\": {}\n            },\n            \"placement\":  {\n                \"instanceRefs\": [\n                    {\n                        \"ref\": \"/infrastructure/locations/unspecified/instances/<instance-name>\"\n                    }\n                ]\n            }\n        }\n    }\n}\n\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx Configuration using Service Command (Shell)\nDESCRIPTION: This command reloads the Nginx configuration using the service command.  This achieves the same result as `nginx -s reload` but uses the system's service management tool.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_12\n\nLANGUAGE: none\nCODE:\n```\nroot# service nginx reload\n```\n\n----------------------------------------\n\nTITLE: Install Headers-More Module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This shell script updates the package repositories and installs the `nginx-plus-module-headers-more` package using dnf. It is specific to Amazon Linux 2023, AlmaLinux, and Rocky Linux operating systems. It assumes that the user has sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/headers-more.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-headers-more\n```\n\n----------------------------------------\n\nTITLE: Describing NginxProxy Configuration using kubectl\nDESCRIPTION: This command retrieves and displays the current configuration of the NginxProxy resource named 'ngf-proxy-config' using kubectl. It allows you to inspect the current state of the data plane configuration for NGINX Gateway Fabric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/data-plane-configuration.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe nginxproxies ngf-proxy-config\n```\n\n----------------------------------------\n\nTITLE: Dynamic Proxy Configuration with Go Template\nDESCRIPTION: This Go template dynamically generates a `proxy_pass` directive for Nginx configuration. It retrieves augment data, extracts the location label, and matches it against user-provided data. If a match is found, it injects the `proxy_pass` directive with the target upstream name into the targeted location block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/tutorials/round-robin-reverse-proxy.md#_snippet_4\n\nLANGUAGE: go\nCODE:\n```\n{{ $augmentData := .AugmentData.V1 }}\n{{ $server := index .Args 1 }}\n{{ $location := index .Args 0 }}\n{{ $arguments := dict }}\n\n{{/* Get the location label from the base template */}}\n{{ $locationLabel := $location.templateInput.nameExpression | trim | lower }}\n\n{{/* Check if there is a nameExpression (label) for this location ID */}}\n{{ range $args := $augmentData.location.templateInput.locations }}\n  {{ $targetLabel := $args.targetLabel | trim | lower }}\n  {{ if (eq $targetLabel $locationLabel) }}\n    {{ $arguments = $args }}\n    {{ break }}\n  {{ end\n\n }}\n{{ end }}\n\n{{/* If augment arguments related to this location were found, perform templating */}}\n{{ if not (empty $arguments) }}\n  proxy_pass http://{{ $arguments.upstreamName }};\n{{ end }}\n```\n\n----------------------------------------\n\nTITLE: Add Advanced Security Policy to Environment via API (JSON)\nDESCRIPTION: This snippet shows the JSON request body for adding or updating an Advanced Security policy on an Environment using the NGINX Management Suite REST API. The policyRef specifies the name of the NGINX App Protect policy to apply. This snippet is intended for use with a PUT or POST request to the Environments endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/advanced-security.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n     \"advanced-security\": [\n        {\n           \"action\": {\n              \"policyRef\": \"<my_policy_name_here>\"\n           }\n        }\n     ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Loading GeoIP2 Modules in NGINX Configuration\nDESCRIPTION: Loads the HTTP and Stream GeoIP2 modules in the Nginx configuration using the `load_module` directive.  This makes the geoip2 functionality available within the Nginx configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_geoip2_module.so;\nload_module modules/ngx_stream_geoip2_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Load Kernel Modules at Startup\nDESCRIPTION: This command creates a configuration file (`/etc/modules-load.d/k8s.conf`) that ensures the `overlay`, `br_netfilter`, and `iptable_nat` kernel modules are loaded at system startup. These modules are required for Kubernetes networking functionality.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\ncat <<EOF | sudo tee /etc/modules-load.d/k8s.conf\noverlay\nbr_netfilter\niptable_nat\nEOF\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Zone for Monitoring\nDESCRIPTION: This snippet configures a shared memory zone for the 'tomcat' upstream group. This shared memory zone is used for live activity monitoring of the Tomcat application servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_38\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream tomcat {\n   zone tomcat 64k;\n\n   server 10.100.100.11:8080;\n   server 10.100.100.12:8080;\n   #...\n}\n```\n\n----------------------------------------\n\nTITLE: HTTP Server Input JSON Schema Example\nDESCRIPTION: This JSON schema defines the structure and validation rules for HTTP server inputs, including properties for server name and ID. It utilizes the 'object' type and specifies required fields for valid configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/reference/json-schema-reference.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"title\": \"HTTP Server Inputs\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"templateInput\": {\n      \"type\": [\n        \"object\",\n        \"null\"\n      ],\n      \"properties\": {\n        \"serverName\": {\n          \"title\": \"Server name\",\n          \"type\": \"string\",\n          \"description\": \"Specifies the HTTP server name.\",\n          \"examples\": [\n            \"foo.com\"\n          ]\n        },\n        \"id\": {\n\t\t\t  \"title\": \"Server ID\",\n\t\t\t  \"type\": \"string\",\n\t\t\t  \"description\": \"Case-sensitive, alphanumeric ID used for specifying augment placement.\",\n\t\t\t  \"examples\": [\n\t\t\t\t\"main_server\"\n\t\t\t  ]\n\t\t\t}\n      },\n      \"required\": [\"serverName\", \"id\"]\n    }\n  },\n  \"required\": []\n}\n```\n\n----------------------------------------\n\nTITLE: Deploying a Secure Application with Kubernetes\nDESCRIPTION: This snippet deploys a secure application within a Kubernetes environment. It includes a Deployment, Service, ConfigMap, and Secret resource to configure an Nginx instance that only accepts HTTPS traffic on port 8443. The secret contains the TLS certificate and key used by the application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/securing-backend-traffic.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: secure-app\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: secure-app\n  template:\n    metadata:\n      labels:\n        app: secure-app\n    spec:\n      containers:\n        - name: secure-app\n          image: nginxinc/nginx-unprivileged:latest\n          ports:\n            - containerPort: 8443\n          volumeMounts:\n            - name: secret\n              mountPath: /etc/nginx/ssl\n              readOnly: true\n            - name: config-volume\n              mountPath: /etc/nginx/conf.d\n      volumes:\n        - name: secret\n          secret:\n            secretName: app-tls-secret\n        - name: config-volume\n          configMap:\n            name: secure-config\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: secure-app\nspec:\n  ports:\n    - port: 8443\n      targetPort: 8443\n      protocol: TCP\n      name: https\n  selector:\n    app: secure-app\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: secure-config\ndata:\n  app.conf: |-\n    server {\n      listen 8443 ssl;\n      listen [::]:8443 ssl;\n\n      server_name secure-app.example.com;\n\n      ssl_certificate /etc/nginx/ssl/tls.crt;\n      ssl_certificate_key /etc/nginx/ssl/tls.key;\n\n      default_type text/plain;\n\n      location / {\n        return 200 \"hello from pod secure-app\\n\";\n      }\n    }\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: app-tls-secret\ntype: Opaque\ndata:\n  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQwRENDQXJpZ0F3SUJBZ0lVVDQwYTFYd3doUHVBdDJNMkdZZUovYXluZlFBd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1JqRWZNQjBHQTFVRUF3d1djMlZqZFhKbExXRndjQzVsZUdGdGNHeGxMbU52YlRFTE1Ba0dBMVVFQmhNQwpWVk14RmpBVUJnTlZCQWNNRFZOaGJpQkdjbUZ1YzJselkyOHdIaGNOTWpRd01URTRNVGd3TVRBeFdoY05NalV3Ck1URTNNVGd3TVRBeFdqQi9NUXN3Q1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0F3S1EyRnNhV1p2Y201cFlURVcKTUJRR0ExVUVCd3dOVTJGdUlFWnlZVzV6YVhOamJ6RU9NQXdHQTFVRUNnd0ZUa2RKVGxneEVqQVFCZ05WQkFzTQpDVTVIU1U1WUlFUmxkakVmTUIwR0ExVUVBd3dXYzJWamRYSmxMV0Z3Y0M1bGVHRnRjR3hsTG1OdmJUQ0NBU0l3CkRRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFMeUx0eURNbTZ4M0ZEUFJsOGZ0azNweCtrRWQKYTVpTGZOQ3lDbUVjYktBQVBDNEhZckl5b1B5QXpSTlJCMWErekE0UTlrbzJZRG5vR0dkeFJaMEdydldKZUV2Mgo3MWlHNGxhbHRVTS9WOWNvSktQY0UyTEI0R3R6cFA3ckdIWXNvRDlOUXFpV3YwZ0lOdE42MjdrWGg4UW41V1hYCk92Y2FkS2h0bjJER3RvU0VzT3dpNzR5NEt3SmFkWnlwLzJaM0hPakRTNjVIVmxydmUxUXpBMVRzTEp6S3cva3gKbHBSR0lWK0lhUjZXbXZsaVFVdDJxWFg0L3hGeVVEM2Vic05TeXpHUk5mQ0NOTWxlWlV3MTR3ZUdhOEVnc2tDcQprOGdYSmpFZXQxMlR4OGxkY3BpVWlxYVpkOStYZjJmUS8yL2Y5c1IzM3Q4K0VVUWpoZ2ZIbHlsLzV1RUNBd0VBCkFhTjlNSHN3SHdZRFZSMGpCQmd3Rm9BVTRUT096c1d0Q3ZWdGJlWXFSU0FqN2tXajFkb3dDUVlEVlIwVEJBSXcKQURBTEJnTlZIUThFQkFNQ0JQQXdJUVlEVlIwUkJCb3dHSUlXYzJWamRYSmxMV0Z3Y0M1bGVHRnRjR3hsTG1OdgpiVEFkQmdOVkhRNEVGZ1FVZmtWREFFWmIwcjRTZ2swck10a0FvQ2c2RjRnd0RRWUpLb1pJaHZjTkFRRUxCUUFECmdnRUJBQWFiQit6RzVSODl6WitBT2RsRy9wWE9nYjF6VkJsQ0dMSkhyYTl1cTMvcXRPR1VacDlnd2dZSWJ4VnkKUkVLbWVRa05pV0haSDNCSlNTZ3czbE9abGNxcW5xbUJ2OFAxTUxDZ3JqbDJSN1d2NVhkb2RlQkJxc0lvZkNxVgp3ZG51THJUU3RTbmd2MGhDcldBNlBmTnlQeXMzSGJva1k3RExNREhuNmhBQWcwMUNDT0pWWGpNZjFqLzNIMFNCClBQSWxtek5aRUpEd0JMR2hyb1V3aUY3NkNUV1Fudi8yc1pvWHMwUlFiRTY3TmNraXc2Z0svaWRwVTVzMmlkOEQKVExjVjNxenVFaE1ZeUlua0ZWNEJLZlFkTWxDQnE1QWdyU1Jqb2FoaCszbFRwYVpUalJGUGFVd3VZYXVsQXRzNgpra1ROaGltWWQ3Ym1aVk5MK2I0MzhmN1RMaGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=\n  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRQzhpN2Nnekp1c2R4UXoKMFpmSDdaTjZjZnBCSFd1WWkzelFzZ3BoSEd5Z0FEd3VCMkt5TXFEOGdNMFRVUWRXdnN3T0VQWktObUE1NkJobgpjVVdkQnE3MWlYaEw5dTlZaHVKV3BiVkRQMWZYS0NTajNCTml3ZUJyYzZUKzZ4aDJMS0EvVFVLb2xyOUlDRGJUCmV0dTVGNGZFSitWbDF6cjNHblNvYlo5Z3hyYUVoTERzSXUrTXVDc0NXbldjcWY5bWR4em93MHV1UjFaYTczdFUKTXdOVTdDeWN5c1A1TVphVVJpRmZpR2tlbHByNVlrRkxkcWwxK1A4UmNsQTkzbTdEVXNzeGtUWHdnalRKWG1WTQpOZU1IaG12QklMSkFxcFBJRnlZeEhyZGRrOGZKWFhLWWxJcW1tWGZmbDM5bjBQOXYzL2JFZDk3ZlBoRkVJNFlICng1Y3BmK2JoQWdNQkFBRUNnZ0VBUXJucGJleXJmVTVKTW91Ty9UenBrQkJ0UWdVZzhvUVBBS2E1d0tONEYrbnQKWWxiUHlZUGNjSEErNDRLdUo3ZHZiTno0NU11NG8xV3Q2Vkh2a29KdWdjd01iRW53YTdLVXdKaDFmVjZaL2pXaApQZkpoVS9hTUwwcm1qaWJ5YWNRaVZEVEtEZk1Ici96a05sVEpGUWlzVGpIV1lBUGJSTjh5Z1BjR3pBK1hRVzg5CmxsOFdoeWwrZndjRVAzNTM4TUdKYUpHVmV4Q2d5cVRyKzZwQ29yRUpFL1pSNytiMTNyejRsbmxpZXVYa2pCVkcKSnYvUVI0RVhTSDhuRit3K2FvWTFQaGd2QnFJTnFQZjJMT1V0MzNiN3FDTkFmSVBRdFZFejJsN3NqbmJlcElTTwpvTkhNUFY0N21XTzY2dzhFMzJVMjNjVEtUbytJcWovM0d1eGhweXlYaHdLQmdRRDVNRDhmY3ZyM0xVZHkvZ3I0Ci82MVBqUXNSaWRYdjN0Mk1MVEk4UkduNzJWcGxvVVExNDZHV2xGTGVVVDY1L1ZVMjNsZFUrUWt2eFNMK3U1bW4KRUJIdXUyVmtBUWVYcUJXWkpPTmFSZG9Ia1YzK2Fyc0U4Qld0SWVtZHJ0MWN6bHFjc1VzMWdGdG1COGI3RHB3UwpHKzRoZDlzZG0weDBNS2hoOFVGOUQrZytUd0tCZ1FEQnN4dUpoZ1hnck14S0dVMHJ5MW9WWTJtMGpDUEpJcTkzCmNZRUZGY3lYZ0U4OWlDVmlob3dVVE8yMXpTZ3o0SVVKNUxoc2M5N3VIVER1VXdwcVI5NFBsdjlyaXJvakowM1UKT3FyWHgwbWdNN2xibVM1L1RwS0czZG1QblZ0WEZMektISFgyWDVnUW56emYvdXVKK3NtbDVLQW5WN0VZc1oxcgpkVXJvRm8zcnp3S0JnUUNZdjM5aUdzeEdLaVpMRWZqTjY0UmthRFBwdTFFOTZhSnE0K1dRVmV1VnF3V2ptTGhFClJGWHdCTm5MVjRnWTRIYVUzTFF4N1RvNVl5RnhmclBRV2FSMGI4RFdEVitIRWt5ekJJNnM3bmFZL3YzY0Q3YTIKYnlrS2FPaFlkVEZTUzFmMkJ5UHdGczl2K3NKNWNOb3dxNWhNUWJrNks5RXd4QWJqaXN5M0NjSTJOd0tCZ1FDbwo2c2pZNVVlNjV2WkFxRS9rSVRJdDlNUDU3enhGNnptWnNDSVRqUzhkNzRjcTRjKzRYQjFNbHNtMkFYTk55ajQ2Cm9uc3lHTm9RVE9TZThVdmo0MGlEeitwdW5rdzAyOUhEZ21YNlJwQ3VaRzBBdEZVWU1DMFg3K0FLbmU5SndZdmgKdFhBcHFyT3h5eXdMS3dPOUVEZEp0RmIxK0VNNGhhd0NTZ2RJM21KbGdRS0JnRzIxeEJNRXRzMFBVN3lDYTZ0YwpadDc1NUV4aEdkR3F5MmtHYmtmdzBEaHBQQVVUZmdncVF3NVBYdGVIS1ZBSDlKaG5kVnBBZFFxNmZ1MER1MDNKCkl0cGpxNWluZXVoR0x0alpMR1Nhd0dwY0FUU3h4Z3dCM0l0Z29LKzBCRFhteWxId0lEcUc5Z2crRU5KK0VhL0MKeTFOMmV0ZG1sQ01hNjM4cVJlNFlTWk55Ci0tLS0tRU5EIFFSSVZBVEUgS0VZLS0tLS0=\n\nEOF\n```\n\n----------------------------------------\n\nTITLE: Configuring Active Health Check Match Block Nginx\nDESCRIPTION: Defines a 'match' block within the http context to specify the criteria for a successful health check. The server must return a status code between 200 and 399, and include the 'X-ORACLE-DMS-ECID' header to be considered healthy. The 'match' directive defines tests a server must pass to be considered functional.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_25\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nmatch oracleok {\n     status 200-399;\n     header X-ORACLE-DMS-ECID;\n}\n```\n\n----------------------------------------\n\nTITLE: Create NGINX Configuration from Package - Azure CLI\nDESCRIPTION: This snippet demonstrates how to upload a gzipped tar archive containing the NGINX configuration files and use it to create an NGINX configuration. It encodes the tar.gz file using base64 and then passes it as the data parameter to the `az nginx deployment configuration create` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configuration-azure-cli.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nTAR_DATA=$(base64 -i nginx.tar.gz)\naz nginx deployment configuration create --deployment-name myDeployment \\\n      --resource-group myResourceGroup --root-file nginx.conf --name default \\\n      --package data=\"$TAR_DATA\"\n```\n\n----------------------------------------\n\nTITLE: Querying Nginx Plus API for Upstream Status (up)\nDESCRIPTION: This code snippet queries the Nginx Plus API to verify the status of a specific upstream group. It uses `curl` to send a GET request to the API endpoint and `grep` to filter the output for the 'state' field, expecting 'up'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\n$ curl -X GET \"127.0.0.1:8000/api/<version>/http/upstreams/my_backend/\" -H \"accept: application/json\" | python -m json.tool | grep state\n\n\"state\": \"up\",\n```\n\n----------------------------------------\n\nTITLE: Create UpstreamSettingsPolicy for Keepalive (YAML)\nDESCRIPTION: This YAML configuration creates an `UpstreamSettingsPolicy` named `upstream-keepalives`. It targets only the `coffee` service and sets the number of keepalive connections to 32.  This enables connection caching and limits the number of idle connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_14\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.nginx.org/v1alpha1\nkind: UpstreamSettingsPolicy\nmetadata:\n  name: upstream-keepalives\nspec:\n  targetRefs:\n  - group: core\n    kind: Service\n    name: coffee\n  keepAlive:\n    connections: 32\nEOF\n```\n\n----------------------------------------\n\nTITLE: Installing ca_root_nss (FreeBSD)\nDESCRIPTION: Installs the `ca_root_nss` package, which provides a set of root certificates, a prerequisite for establishing secure connections on FreeBSD.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_35\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg install ca_root_nss\n```\n\n----------------------------------------\n\nTITLE: Create Cluster Zone Sync Policy - With TLS and DNS Resolver - JSON\nDESCRIPTION: This JSON payload configures a Cluster Zone Sync policy with both TLS enabled for the TCP server and a DNS resolver. It includes listener configurations with `tlsEnabled: true`, resolver settings, and zone sync server details. Server certificates are also provided.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/cluster-zone-sync.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"cluster-zone-sync\": [\n    {\n      \"action\": {\n        \"tcpServer\": {\n          \"listeners\": [\n            {\n              \"port\": 12345,\n              \"tlsEnabled\": true\n            }\n          ],\n        },\n        \"resolver\": {\n          \"enableIPv6\": false,\n          \"valid\": \"30s\",\n          \"timeout\": \"5s\",\n          \"servers\": [\n            {\n              \"hostname\": \"192.0.2.0\"\n            }\n          ]\n        },\n        \"zoneSyncServers\": [\n          {\n            \"name\": \"nginx-cluster.com\",\n            \"port\": 12345\n          }\n        ]\n      },\n      \"data\": {\n        \"serverCerts\": [\n          {\n            \"key\": \"<server-key>\",\n            \"cert\": \"<server-cert>\"\n          }\n        ]\n      }\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Test HTTPS Connection with OpenSSL (Shell)\nDESCRIPTION: This command tests HTTPS connectivity to the NGINX Plus server using `openssl s_client`. It sends a 'GET /' request and displays the SSL/TLS cipher negotiated during the connection. This allows verification that the server is accessible and uses the expected cipher.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/fips-compliance-nginx-plus.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\n(echo \"GET /\" ; sleep 1) | openssl s_client -connect <NGINX-Plus-address>:443\n```\n\n----------------------------------------\n\nTITLE: Configure Component Backend with DNS Service Discovery (JSON)\nDESCRIPTION: This snippet configures the component backend with DNS service discovery. It shows how to specify the Kubernetes service FQDN and configure DNS service discovery settings, including the DNS server IP, TTL, and timeout. This allows NGINX to resolve the IP addresses of the pods and load balance traffic. Requires a Kubernetes cluster with functional DNS service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-containerized-instances.md#_snippet_4\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"workloadGroups\": {\n        \"serverGrp12345\": {\n            \"uris\": {\n                \"http://hello-mini.default.svc.cluster.local:8080\": {}\n            },\n            \"dnsServiceDiscovery\": {\n                \"servers\": [\"10.96.0.10\"],\n                \"ttl\": \"30s\",\n                \"timeout\": \"30s\"\n            }\n        }\n    },\n    \"monitoring\":{}\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Security Log Path and Destination in NGINX\nDESCRIPTION: This snippet shows how to configure the path to the log configuration file and the destination for the NGINX App Protect security logs.  The destination can be either a syslog server or a file path.  The example uses syslog to forward logs to localhost on port 5140.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/enable-logging.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log \"/etc/app_protect/conf/log_all.json\" syslog:server=localhost:5140;\n```\n\n----------------------------------------\n\nTITLE: Add TLS Policies to External Developer Portal - JSON\nDESCRIPTION: This JSON configuration defines the TLS policies to be added to the external developer portal, including both TLS inbound and TLS backend policies.  It specifies cipher suites, protocols, session cache settings, server certificates, and client certificates. The `{{environmentName}}`, `{{portalInstanceGName}}`, `{{portalEnvironmentHostname}}`, `{{tlsServerKey}}`, `{{tlsServerCert}}`, `{{caCert}}`, `{{tlsClientKey}}`, and `{{tlsClientCert}}` are placeholders for the actual environment details and certificate data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/tls-policies.md#_snippet_3\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"{{environmentName}}\",\n    \"functions\": [\n        \"DEVPORTAL\"\n    ],\n    \"proxies\": [\n        {\n            \"proxyClusterName\": \"{{portalInstanceGName}}\",\n            \"hostnames\": [\n                \"{{portalEnvironmentHostname}}\"\n            ],\n            \"runtime\": \"PORTAL-PROXY\",\n            \"policies\": {\n                \"tls-inbound\": [\n                    {\n                        \"action\": {\n                            \"cipher\": \"ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5\",\n                            \"protocols\": [\n                                \"TLSv1.2\"\n                            ],\n                            \"sessionCache\": {\n                                \"enable\": \"on\",\n                                \"size\": \"10M\",\n                                \"type\": \"shared\"\n                            },\n                            \"sessionTimeout\": \"5m\"\n                        },\n                        \"data\": {\n                            \"trustedRootCACerts\": {\n                                    \"clientId\": \"clientId1\",\n                                    \"cert\": \"{{}}\"\n                            },\n                            \"serverCerts\": [\n                                {\n                                    \"key\": {{tlsServerKey}},\n                                    \"cert\": {{tlsServerCert}}\n                                }\n                            ]\n                        }\n                    }\n                ],\n                \"tls-backend\": [\n                    {\n                        \"action\": {\n                            \"cipher\": \"HIGH:!aNULL:!MD5\",\n                            \"sessionReuse\": false,\n                            \"proxyServerName\": false,\n                            \"protocols\": [\n                                \"TLSv1.2\"\n                            ]\n                        },\n                        \"data\": {\n                            \"trustedRootCACerts\":\"{{caCert}}\",\n                            \"clientCerts\": [\n                                {\n                                    \"key\": {{tlsClientKey}},\n                                    \"cert\": {{tlsClientCert}}\n                                }\n                            ]\n                        }\n                    }\n                ]\n            }\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX: Resolver Configuration\nDESCRIPTION: This configuration snippet sets up the DNS resolver in the `http` context of the NGINX configuration. It specifies the IP address of the DNS server, enables IPv4 resolution, and sets the TTL value for DNS records to 300 seconds. This is required for NGINX Plus to resolve the Keycloak server's domain name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/keycloak.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Service Definition\nDESCRIPTION: This Kubernetes service definition exposes an application using a NodePort service type. It includes an annotation 'nginx.com/nginxaas: nginxaas' that signals the NLK controller to monitor this service. The port name 'http-my-service' follows the required format to link to the 'my-service' upstream in the NGINX configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/loadbalancer-kubernetes.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nkind: Service\nmetadata:\n  name: my-service\n  annotations:\n    # Let the controller know to pay attention to this service.\n    # If you are connecting multiple controller the value can be used to distinguish them\n    nginx.com/nginxaas: nginxaas\nspec:\n  # expose a port on the nodes\n  type: NodePort\n  ports:\n    - targetPort: http\n      protocol: TCP\n      # The port name helps connect to NGINXaaS. It must be prefixed with either `http-` or `stream-`\n      # and the rest of the name must match the name of an upstream in that context.\n      name: http-my-service\n  selector:\n    app: awesome\n```\n\n----------------------------------------\n\nTITLE: Configuring a Location Block with a Prefix String\nDESCRIPTION: This snippet demonstrates how to configure a `location` block with a prefix string.  Requests starting with /some/path/ will be matched by this location block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /some/path/ {\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration after Syslog config - Bash\nDESCRIPTION: Reloads the Nginx configuration after configuring the `access_log` directive to use Syslog. This ensures that the changes are applied and that Nginx starts sending logs to the Syslog server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-metrics-collection.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nservice nginx reload\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Open Source (RHEL 8.1+)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Open Source package from RHEL 8.1 and later. It uses the `dnf remove` command to remove the `app-protect-module-oss` package. Requires root privileges and the dnf package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_62\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf remove app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Viewing Extracted Debug Log File\nDESCRIPTION: This command opens the `debug_log.txt` file, which contains the extracted debug log from the Nginx memory buffer, allowing you to examine the detailed debugging information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nsudo less debug_log.txt\n```\n\n----------------------------------------\n\nTITLE: Workaround for WAF Enabling Failure\nDESCRIPTION: This workaround addresses an issue where enabling WAF when creating or updating a component using the web interface might fail for non-admin users. The recommended solution is to use the NGINX Controller REST API instead of the web interface, or upgrade to NGINX Controller v3.18.1 or later.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_1\n\n\n\n----------------------------------------\n\nTITLE: Creating a Rate Limit Policy using Kubectl\nDESCRIPTION: This command creates a rate limit policy in Kubernetes using kubectl. It reads the configuration from the `ratelimit.yaml` file and applies it to the cluster. This policy limits the number of requests from a specific client to a destination service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nkubectl create -f ratelimit.yaml\n```\n\n----------------------------------------\n\nTITLE: Add Nginx Agent repository on Debian\nDESCRIPTION: This command adds the Nginx Agent repository to the system's apt sources, allowing the package manager to find and install the Nginx Agent package on Debian.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\necho \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n  http://packages.nginx.org/nginx-agent/debian/ `lsb_release -cs` agent\" \\| sudo tee /etc/apt/sources.list.d/nginx-agent.list\n```\n\n----------------------------------------\n\nTITLE: Uncomment OIDC Sections in nms-http.conf - Nginx\nDESCRIPTION: This snippet shows how to uncomment and configure the necessary OIDC-related `map` directives in the `/etc/nginx/conf.d/nms-http.conf` file to enable Microsoft Entra as an Identity Provider. These maps extract the groups claim, audience, and user email from the JWT.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/microsoft-entra-automation.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\n...\n# Enable when using OIDC with Microsoft Entra\nmap $http_authorization $groups_claim {\n    \"~^Bearer.*\" $jwt_claim_roles;\n    default $jwt_claim_groups;\n}\n\nmap $jwt_audience $jwt_aud_client {\n    default  $jwt_audience;\n    ~^api://(.+)$ $1;\n}\n\nmap $http_authorization $user_email {\n    \"~^Bearer.*\" '$jwt_aud_client@$oidc_domain';\n    default $jwt_claim_email;\n}\n...\n```\n\n----------------------------------------\n\nTITLE: Install Set-Misc Module on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This snippet shows how to install the nginx-plus-module-set-misc package on Amazon Linux 2, CentOS, Oracle Linux, and RHEL systems using the yum package manager. It first updates the package repositories and then installs the module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/set-misc.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-set-misc\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Open Source (Ubuntu 22.04)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Open Source package from Ubuntu 22.04. It uses the `apt-get remove` command to remove the `app-protect-module-oss` package. Requires root privileges and the apt package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_68\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get remove app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Configuring an Exact Match Location\nDESCRIPTION: This snippet configures a location that matches exactly the root path, '/'. The `=` modifier ensures that the search stops after this match, improving performance for frequent requests to the root.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nlocation = / {\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Create Kubernetes Secret for Docker Registry\nDESCRIPTION: This snippet creates a Kubernetes secret named `regcred` for authenticating with a private Docker registry. It's crucial that the JWT token is correctly passed as the username, and the password can be set to `none`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nkubectl create secret docker-registry regcred --docker-server=private-registry.nginx.com --docker-username=<JWT Token> --docker-password=none\n```\n\n----------------------------------------\n\nTITLE: Move and Rename NGINX Plus Certificate and Key\nDESCRIPTION: Moves and renames the NGINX Plus SSL certificate and private key files to the expected location for the build process. The Makefile expects these files to be in the `./build/certs` directory with specific names (nginx-repo.key and nginx-repo.crt).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nmkdir -p $HOME/nginx-agent/build/certs\nmv nginx-repo-S-X00012345.key $HOME/nginx-agent/build/certs/nginx-repo.key\nmv nginx-repo-S-X00012345.crt $HOME/nginx-agent/build/certs/nginx-repo.crt\n```\n\n----------------------------------------\n\nTITLE: Configure Forward Proxy in docker-compose.yaml (YAML)\nDESCRIPTION: This snippet configures a forward proxy within the `docker-compose.yaml` file for NGINX Instance Manager. It defines environment variables to enable the proxy, set the host, port, protocol, authentication, and SSL verification settings. It also shows how to mount the proxy CA certificate for SSL verification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-forward-proxy.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\nservices:\n  nim:\n  image: private-registry.nginx.com/nms/nim-standalone-compose:<version>\n  depends_on:\n    clickhouse:\n      condition: service_healthy\n  hostname: nim\n  ports:\n    - 443:443\n  networks:\n    - external_network\n    - clickhouse\n  environment:\n    - PROXY_ENABLE=true\n    - PROXY_HOST=<proxy-ip>\n    - PROXY_PORT=<proxy-port>\n    - PROXY_PROTOCOL=[http|https]\n    - PROXY_AUTH_REQUIRED=[true|false]\n    - PROXY_SSL_VERIFY=[true|false]\n volumes:\n    - nim-data:/data\n    - proxy-certs:/usr/local/share/ca-certificates\n    - ./<proxy-ca-cert-file>:/usr/local/share/ca-certificates/<proxy-ca-cert-file>\n```\n\nLANGUAGE: yaml\nCODE:\n```\n- PROXY_AUTH_USERNAME=<username>\n- PROXY_PASSWORD=<password>\n```\n\n----------------------------------------\n\nTITLE: Restore Embedded Config Database (Specific File) (Bash)\nDESCRIPTION: This command restores the embedded NGINX Controller configuration database from a specific backup file using the `helper.sh` script.  The `backup restore` subcommand with the filename argument restores from the specified backup file. The filename argument is mandatory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh backup restore <filename>\n```\n\n----------------------------------------\n\nTITLE: Test Application Configuration in NGINX\nDESCRIPTION: This snippet configures a simple test application in NGINX that returns the authenticated user's full name, email, and subject identifier upon successful authentication. It listens on port 8080 and uses the `$http_name`, `$http_email`, and `$http_sub` variables, which are populated with the OIDC claims passed as headers from the main server block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/onelogin.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nserver {\n    listen 8080;\n\n    location / {\n        return 200 \"Hello, $http_name!\\nEmail: $http_email\\nSub: $http_sub\\n\";\n        default_type text/plain;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install Keepalived on Debian Systems (Ubuntu, Debian)\nDESCRIPTION: This snippet shows how to install `keepalived` on Debian-based systems using `apt`. It updates the package list and installs the `keepalived` package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update\nsudo apt install keepalived -y\n```\n\n----------------------------------------\n\nTITLE: Example modified Headers application response - Text\nDESCRIPTION: This is an example of the HTTP response received after applying the ResponseHeaderModifier filter. It demonstrates the 'X-Header-Set' being overwritten, 'X-Header-Add' having a new value appended, and 'X-Header-Remove' being absent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_13\n\nLANGUAGE: text\nCODE:\n```\nHTTP/1.1 200 OK\nServer: nginx/1.25.5\nDate: Mon, 06 May 2024 17:58:33 GMT\nContent-Type: text/plain\nContent-Length: 2\nConnection: keep-alive\nX-Header-Unmodified: unmodified\nX-Header-Add: add-to\nX-Header-Add: this-is-the-appended-value\nX-Header-Set: overwritten-value\n\nok\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx configuration\nDESCRIPTION: Reloads the Nginx configuration using the `nginx -s reload` command. This command applies changes to the Nginx configuration without interrupting service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx Configuration - Shell (service)\nDESCRIPTION: These commands reload the Nginx configuration, instructing Nginx to start using the new configuration settings without restarting the server. The first option uses the `nginx` command with the `-s reload` option, and the second option uses the `service` command. Both achieve the same result.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_15\n\nLANGUAGE: none\nCODE:\n```\nroot# service nginx reload\n```\n\n----------------------------------------\n\nTITLE: Installing Brotli Module on FreeBSD\nDESCRIPTION: This command updates the package repository and installs the nginx-plus-module-brotli package using the pkg package manager on FreeBSD. This command installs the Brotli module necessary for Brotli compression in Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/brotli.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-brotli\n```\n\n----------------------------------------\n\nTITLE: Edit NGINX configuration file\nDESCRIPTION: Opens the Nginx configuration file using nano text editor. This allows the user to modify the worker_connections and worker_rlimit_nofile parameters.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-gateway.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo nano /etc/nginx/nginx.conf\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Public Key (CentOS/RHEL/Amazon Linux - Bash - Alternative)\nDESCRIPTION: An alternative method to downloads the NGINX public key and imports it using `rpm`. It enables the system to verify the authenticity of NGINX packages. The `wget` command downloads the key, and `rpm --import` adds it to the RPM database.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nwget -q -O nginx_signing.key https://nginx.org/keys/nginx_signing.key && \\\nrpm --import nginx_signing.key\n```\n\n----------------------------------------\n\nTITLE: Configure HTTPS server with SSL certificate and key\nDESCRIPTION: This snippet demonstrates how to configure an HTTPS server with SSL certificate and key. The `ssl_certificate` and `ssl_certificate_key` directives specify the paths to the server certificate and private key, respectively. These files must be added to the NGINXaaS Deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/securing-upstream-traffic.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen              443 ssl;\n    server_name         backend1.example.com;\n\n    ssl_certificate     /etc/ssl/certs/server.crt;\n    ssl_certificate_key /etc/ssl/certs/server.key;\n    #...\n    location /upstream {\n        proxy_pass http://url_to_app.com;\n        # ...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure GeoIP2 directives in NGINX\nDESCRIPTION: This code snippet demonstrates how to load the GeoIP2 module and configure the `geoip2` directive within the `http` block to map city names to variables.  It then uses this information in a server block to return a message with the city name. Requires the `ngx_http_geoip2_module` module to be installed and a GeoIP2 database file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/geoip2.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_geoip2_module.so;\n\nhttp {\n    # \"GeoLite2-City\" is one of the EditionIDs in /etc/nginx/GeoIP.conf\n    geoip2 /usr/local/share/GeoIP/GeoLite2-City.mmdb {\n        $geoip2_city_name   city names en;\n    }\n\n    server {\n        listen 80;\n        server_name localhost;\n        location / {\n            return 200 \"Hello $geoip2_city_name\";\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Cache Zone in NGINX\nDESCRIPTION: This snippet demonstrates how to configure a cache zone using the `proxy_cache_path` directive in the `http` block in NGINX.  This enables caching and statistics collection for the cache zone, allowing it to be monitored in the live activity monitoring dashboard. The `keys_zone` parameter defines the shared memory zone for storing cache keys and metadata.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    proxy_cache_path /data/nginx/cache keys_zone=one:10m;\n}\n```\n\n----------------------------------------\n\nTITLE: Check Usage Acknowledgement Status via REST API (curl)\nDESCRIPTION: This curl command checks the status of the usage acknowledgement from F5. It sends a GET request to the `/ee/v1/entitlements/telemetry/bulk/status/<report-id>` endpoint, replacing `<report-id>` with the specific report ID received after submitting the report. Requires a JWT for authorization.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/report-usage-disconnected-deployment.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\ncurl --location 'https://product.apis.f5.com/ee/v1/entitlements/telemetry/bulk/status/<report-id>' \\\n--header \"Authorization: Bearer $(cat /path/to/jwt-file)\"\n```\n\n----------------------------------------\n\nTITLE: Proxy Configuration with JWT Introspection\nDESCRIPTION: This JSON snippet shows the configuration for an NGINX API proxy using the `application/jwt` introspection response type. It defines the proxy settings, backend service details, and the OAuth2 introspection policy, including the introspection endpoint and client credentials.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_56\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"test-proxy\",\n   \"version\": \"v1\",\n   \"proxyConfig\": {\n      \"hostname\": \"data-host\",\n      \"ingress\": {\n         \"basePath\": \"/\",\n         \"basePathVersionAppendRule\": \"NONE\"\n      },\n      \"backends\": [\n         {\n            \"serviceName\": \"backend-echo-svc\",\n            \"serviceTargets\": [\n               {\n                  \"hostname\": \"192.0.2.4\",\n                  \"listener\": {\n                     \"enableTLS\": false,\n                     \"port\": 10000,\n                     \"transportProtocol\": \"HTTP\"\n                  }\n               }\n            ]\n         }\n      ],\n      \"policies\": {\n         \"oauth2-introspection\": [\n            {\n               \"action\": {\n                  \"introspectionEndpoint\": \"https://192.0.2.5:8080/oauth/v2/oauth-introspect\",\n                  \"introspectionResponse\": \"application/jwt\"\n\n               },\n               \"data\": [\n                  {\n                     \"clientAppID\": \"nginx-plus\",\n                     \"clientSecret\": \"<client secret>\"\n                  }\n               ]\n            }\n         ]\n      }\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Converting User Defined Signatures to JSON (default tag)\nDESCRIPTION: This example demonstrates how to convert a User Defined Signatures XML file to a JSON file using the `convert-signatures` tool. It utilizes a Docker container to execute the conversion, mounting the current directory to enable access to the input and output files. The default tag 'user-defined-signatures' is applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_20\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker run --rm \\\n -v $(pwd):$(pwd) \\\n --entrypoint=/opt/app_protect/bin/convert-signatures \\\n waf-compiler-<version-tag>:custom \\\n -i $(pwd)/signatures.xml -o $(pwd)/signatures.json\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisites (Alpine Linux)\nDESCRIPTION: Installs the necessary prerequisites such as openssl, curl, and ca-certificates on Alpine Linux using the apk package manager. These packages are required for secure communication and package verification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_20\n\nLANGUAGE: shell\nCODE:\n```\nsudo apk add openssl curl ca-certificates\n```\n\n----------------------------------------\n\nTITLE: Rewriting URIs with Last Flag and Returning 403 in Nginx\nDESCRIPTION: This Nginx configuration demonstrates URI rewriting using the `rewrite` directive with the `last` flag, and a default `return` directive for unmatched URIs.  It rewrites URIs matching specific patterns to different file paths and serves a 403 error for unmatched requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    #...\n    rewrite ^(/download/.*)/media/(\\w+)\\.?.*$ $1/mp3/$2.mp3 last;\n    rewrite ^(/download/.*)/audio/(\\w+)\\.?.*$ $1/mp3/$2.ra  last;\n    return  403;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Add TLS Backend Policy - JSON\nDESCRIPTION: This JSON configuration defines a TLS Backend policy to secure communication between the API proxy and the backend service.  It includes parameters such as cipher suites, protocols, trusted root CA certificates, and client certificates. The `{{caCert}}`, `{{clientCert}}`, and `{{clientKey}}` are placeholders for the actual certificate data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/tls-policies.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policies\": {\n        \"tls-backend\": [\n            { \"action\": {\n            \"cipher\": \"HIGH:!aNULL:!MD5\",\n            \"protocols\": [\n                \"TLSv1.2\"\n            ]\n        },\n            \"data\": {\n                \"trustedRootCACerts\":\"{{caCert}}\",\n                \"clientCerts\": [\n                    {\n                        \"cert\": \"{{clientCert}}\",\n                        \"key\": \"{{clientKey}}\"\n\n                    }\n                ]\n            }\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX as TCP Proxy for NGINX One\nDESCRIPTION: This snippet configures an NGINX instance as a TCP proxy server to forward connections to agent.connect.nginx.com on port 443. It defines an upstream server, sets up logging, and configures the proxy server to listen on port 5000.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/proxy-setup/set-up-nginx-proxy-for-nginx-one.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    upstream stream_backend {\n        zone tcp_servers 64k;\n        server agent.connect.nginx.com:443;\n    }\n\n    log_format basic '$remote_addr [$time_local] '\n                    '$protocol $status $bytes_sent $bytes_received '\n                    '$session_time \"$upstream_addr\" '\n                    '\"$upstream_bytes_sent\" \"$upstream_bytes_received\" \"$upstream_connect_time\"';\n\n    access_log /var/log/nginx/nginx1_access.log basic;\n    error_log /var/log/nginx/nginx1_error.log;\n\n    server {\n        listen 5000;\n        status_zone tcp_server;\n        proxy_pass stream_backend;\n        proxy_next_upstream on;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing Passenger module on Debian and Ubuntu\nDESCRIPTION: This code snippet shows the installation of the `nginx-plus-module-passenger` package on Debian and Ubuntu systems using the apt package manager. It updates the package list and then installs the NGINX Passenger module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/passenger-open-source.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-passenger\n```\n\n----------------------------------------\n\nTITLE: Backup Private Key\nDESCRIPTION: This command copies a private key file to a secure backup location. It is crucial to backup private keys, as losing them renders certificates unusable.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_16\n\nLANGUAGE: Shell\nCODE:\n```\nroot# cp ~/company.com.key <SECURE-DIR>/company.com.key.backup\n```\n\n----------------------------------------\n\nTITLE: Configuring Error Log for Debugging to a File\nDESCRIPTION: This NGINX configuration directive sets the error logging level to `debug` and specifies the path to the log file. This enables detailed debugging information to be written to the specified file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nerror_log  /var/log/nginx/error.log debug;\n```\n\n----------------------------------------\n\nTITLE: Limiting Connections and Bandwidth - Nginx\nDESCRIPTION: This snippet combines connection limiting and bandwidth limiting. It limits both the number of connections to 1 and the download/upload speeds. This ensures that a single client cannot consume excessive resources by opening multiple connections. A shared memory zone `ip_addr` is defined to track connection counts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-tcp.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    limit_conn_zone $binary_remote_addr zone=ip_addr:10m;\n\n    server {\n        #...\n        limit_conn ip_addr  1;\n        proxy_download_rate 100k;\n        proxy_upload_rate   50k;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure worker connections and file descriptors in NGINX\nDESCRIPTION: Modifies the `worker_connections` and `worker_rlimit_nofile` settings within the Nginx configuration file. This increases the number of concurrent connections and file descriptors available to Nginx worker processes. The values should be adjusted based on the number of Nginx agents.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-gateway.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nevents {\n    worker_connections 2000;\n}\n\nworker_rlimit_nofile 2000;\n```\n\n----------------------------------------\n\nTITLE: Enable HTTP/2 Support in Nginx\nDESCRIPTION: This snippet enables HTTP/2 support by adding the `http2` directive in the `server` block for HTTPS traffic. The `listen` directive specifies that the server should listen on port 443 for SSL connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_24\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlisten 443 ssl;\nhttp2  on;\n```\n\n----------------------------------------\n\nTITLE: Enabling Violations in Policy JSON\nDESCRIPTION: This JSON snippet demonstrates how to enable specific violations within the policy. It sets the `alarm` and `block` properties for the `VIOL_JSON_FORMAT` and `VIOL_PARAMETER_VALUE_METACHAR` violations within the `blocking-settings`. These settings override the default enforcement mode.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/policy-authoring-and-tuning.md#_snippet_4\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"policy_name\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_JSON_FORMAT\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_VALUE_METACHAR\",\n                    \"alarm\": false,\n                    \"block\": false\n                }\n            ]\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Plus Repo to RHEL 8/Oracle/Alma/Rocky 8\nDESCRIPTION: Downloads the Nginx Plus repository file for RHEL 8 (and compatible distributions) and places it in the /etc/yum.repos.d directory. This enables access to the NGINX Plus packages using the DNF package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-8.repo\n```\n\n----------------------------------------\n\nTITLE: Copy JWT License File - Linux\nDESCRIPTION: Copies the JWT license file to the /etc/nginx directory on Linux systems.  The <downloaded-file-name> placeholder should be replaced with the actual name of the downloaded JWT file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_56\n\nLANGUAGE: shell\nCODE:\n```\nsudo cp <downloaded-file-name>.jwt /etc/nginx/license.jwt\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Open Source Packages on RHEL 9\nDESCRIPTION: These commands create a directory, navigate into it, and download NGINX Open Source packages, including dependencies using `repotrack`. Repotrack is used to download packages and their dependencies from a yum repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_24\n\nLANGUAGE: script\nCODE:\n```\nsudo mkdir /etc/packages/\ncd /etc/packages/\nsudo repotrack --forcearch x86_64 app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Send Traffic with Rewrite - Shell\nDESCRIPTION: This shell command uses `curl` to send traffic to the coffee application through NGINX Gateway Fabric, demonstrating the URL rewrite. The `--resolve` option is used to map `cafe.example.com` to the Gateway IP and port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee/flavors\n```\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee\n```\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee/mocha\\?test\\=v1\\&test\\=v2\n```\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/latte/prices\n```\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/latte/prices\\?test\\=v1\\&test\\=v2\n```\n\n----------------------------------------\n\nTITLE: Pulling WAF Enforcer and Config Manager Images (Shell)\nDESCRIPTION: Downloads the `waf-enforcer` and `waf-config-mgr` Docker images from the specified private registry. It utilizes the `docker pull` command and requires authentication with the registry. The `5.4.0` tag should be replaced with the actual release version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_13\n\nLANGUAGE: Shell\nCODE:\n```\ndocker pull private-registry.nginx.com/nap/waf-enforcer:5.4.0\ndocker pull private-registry.nginx.com/nap/waf-config-mgr:5.4.0\n```\n\n----------------------------------------\n\nTITLE: Enable Nginx mainline repository on RHEL/CentOS\nDESCRIPTION: This command enables the Nginx mainline repository using yum-config-manager, allowing users to install the latest mainline version of Nginx. Requires yum-utils to be installed. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum-config-manager --enable nginx-mainline\n```\n\n----------------------------------------\n\nTITLE: Granting Execution Permissions to the Script\nDESCRIPTION: This command grants execution permissions to the downloaded `nginx-supportpkg.sh` script. This is required to allow the script to be executed as a program.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/diagnostic-package.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nchmod +x nginx-supportpkg.sh\n```\n\n----------------------------------------\n\nTITLE: Enabling mTLS with Environment Variables - Bash\nDESCRIPTION: This snippet demonstrates how to enable mTLS for the NGINX Agent by setting environment variables. The `NGINX_AGENT_TLS_CA`, `NGINX_AGENT_TLS_KEY`, and `NGINX_AGENT_TLS_CERT` environment variables are set to the paths of the CA certificate, key, and certificate files, respectively. `NGINX_AGENT_TLS_ENABLE` is set to `true` to enable TLS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/encrypt-communication.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nNGINX_AGENT_TLS_CA=\"my-env-ca\"\nNGINX_AGENT_TLS_KEY=\"my-env-key\"\nNGINX_AGENT_TLS_CERT=\"my-env-cert\"\nNGINX_AGENT_TLS_ENABLE=true\n```\n\n----------------------------------------\n\nTITLE: Enabling WAF on Component - JSON\nDESCRIPTION: This JSON snippet configures the `checkout-component` to enable WAF and reference a security strategy. It sets `waf.isEnabled` to `true` and specifies the `strategyRef` pointing to `sensitive-app-strategy`.  This example shows the complete JSON for the component configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/using-rbac-with-app-security.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\n{\n      \"metadata\": {\n        \"name\": \"checkout-component\",\n        \"displayName\": \"checkout-component\",\n        \"tags\": []\n      },\n      \"desiredState\": {\n        \"backend\": {\n          \"ntlmAuthentication\": \"DISABLED\",\n          \"preserveHostHeader\": \"DISABLED\",\n          \"workloadGroups\": {\n            \"wg\": {\n              \"locationRefs\": [\n                {\n                  \"ref\": \"/infrastructure/locations/location-name\"\n                }\n              ],\n              \"loadBalancingMethod\": {\n                \"type\": \"ROUND_ROBIN\"\n              },\n              \"uris\": {\n                \"http://192.0.2.0:8080\": {\n                  \"isBackup\": false,\n                  \"isDown\": false,\n                  \"isDrain\": false\n                },\n                \"http://192.0.2.1:8080\": {\n                  \"isBackup\": false,\n                  \"isDown\": false,\n                  \"isDrain\": false\n                }\n              }\n            }\n          }\n        },\n        \"ingress\": {\n          \"gatewayRefs\": [\n            {\n              \"ref\": \"/services/environments/env-name/gateways/gateway-name\"\n            }\n          ],\n          \"uris\": {\n            \"/checkout\": {}\n          },\n          \"clientMaxBodySize\": \"10m\"\n        },\n        \"logging\": {\n          \"accessLog\": {\n            \"state\": \"DISABLED\"\n          },\n          \"errorLog\": \"DISABLED\"\n        },\n        \"security\": {\n          \"strategyRef\": {\n            \"ref\": \"/security/strategies/sensitive-app-strategy\"\n          },\n          \"waf\": {\n            \"isEnabled\": true\n          }\n        }\n      }\n    }\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Open Source (CentOS 7.4+)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Open Source package from CentOS 7.4 and later. It uses the `yum remove` command to remove the `app-protect-module-oss` package. Requires root privileges and the yum package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_52\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum remove app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Shell: Upload Attack Signatures via REST API\nDESCRIPTION: This curl command uploads the attack signatures bundle to NGINX Instance Manager using the REST API. It uses a POST request with the filename and revisionTimestamp as form data. Replace `<access token>` and `{{NIM_FQDN}}` with the actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_5\n\nLANGUAGE: Shell\nCODE:\n```\ncurl -X POST 'https://{{NIM_FQDN}}/api/platform/v1/security/attack-signatures' \\\n  --header \"Authorization: Bearer <access token>\" \\\n  --form 'revisionTimestamp=\"2022.11.16\"' \\\n  --form 'filename=@\"/attack-signatures.tgz\"'\n```\n\n----------------------------------------\n\nTITLE: Tagging NGINX Ingress Controller Image\nDESCRIPTION: This command tags the NGINX Ingress Controller image with the specified AWS account ID, region code, ECR repository, and tag (`edge`). It ensures the image is properly labeled for pushing to the AWS ECR repository. Requires the correct `registry/image`, `aws_account_id`, `aws-region-code` and `ecr_repo` to be defined.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_2\n\nLANGUAGE: Shell\nCODE:\n```\ndocker tag <registry/image>:edge <aws_account_id>.dkr.ecr.<aws-region-code>.amazonaws.com/<ecr_repo>:edge\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Agent Repository - Ubuntu - Shell\nDESCRIPTION: Adds the Nginx Agent repository to the apt sources list on Ubuntu. This allows the system to find and install the nginx-agent package. The command uses echo and tee to write the repository information to a new list file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\necho \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/nginx-agent/ubuntu/ `lsb_release -cs` agent\" \\\n  | sudo tee /etc/apt/sources.list.d/nginx-agent.list\n```\n\n----------------------------------------\n\nTITLE: Get Average Client Latency with curl\nDESCRIPTION: This command retrieves the average value of maximum client latencies for a specified application (`app1`) over the last 24 hours from the Nginx Controller Analytics. It uses the `AVG` aggregation function on the `client.latency.max` metric and filters results by the 'app' dimension. Requires a valid session cookie for authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/view-traffic-metrics.md#_snippet_4\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{Controller-FQDN}/api/v1/analytics/metrics?names=AVG(client.latency.max)&startTime=now-24h&filter=app='app1'\"\n```\n\n----------------------------------------\n\nTITLE: HTTPS Cookie Persistence on NGINX Plus\nDESCRIPTION: This code snippet configures HTTPS cookie-based session persistence on NGINX Plus. It uses the `sticky cookie` directive within the upstream block to enable cookie-based persistence with an expiration time for an SSL upstream.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nupstream ssl_test_pool {\n        server 10.10.10.10:443;\n        server 10.10.10.20:443;\n        sticky cookie mysession expires=1h;\n   }\n```\n\n----------------------------------------\n\nTITLE: Configure Runtime State Sharing in NGINX Stream Block\nDESCRIPTION: This code snippet configures runtime state sharing by defining a server block in the `stream` context with the `zone_sync` directive. It specifies a local resolver, a listening port, and the `zone_sync_server` directive to identify other NGINXaaS cluster instances using the domain name `internal.nginxaas.nginx.com`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/runtime-state-sharing.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n  resolver 127.0.0.1:49153 valid=20s;\n\n  server {\n    listen 9000; # should match the port specified with zone_sync_server\n\n    zone_sync;\n    zone_sync_server internal.nginxaas.nginx.com:9000 resolve;\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Extract Certificate from PFX OpenSSL\nDESCRIPTION: This command extracts the certificate from a .pfx file (PKCS#12 archive) using OpenSSL. It extracts only the certificates and not the private key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_15\n\nLANGUAGE: Shell\nCODE:\n```\nroot# openssl pkcs12 -in exported-cert.pfx -clcerts -nokeys -out company.com.crt\n```\n\n----------------------------------------\n\nTITLE: Define shell variables for Nginx Gateway Fabric IP and Port\nDESCRIPTION: This snippet shows how to save the public IP address and port of NGINX Gateway Fabric into shell variables. These variables are then used in subsequent curl commands.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\nGW_IP=XXX.YYY.ZZZ.III\nGW_PORT=<port number>\n```\n\n----------------------------------------\n\nTITLE: Get Metrics Catalog\nDESCRIPTION: This cURL command retrieves the full list of supported metrics from the Catalog API. It requires a valid session cookie for authentication. The response provides detailed descriptions of the available metrics and their supported aggregate functions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/catalogs/metrics\"\n```\n\n----------------------------------------\n\nTITLE: Pulling NGINX Plus rootless base image\nDESCRIPTION: This command pulls the NGINX Plus image configured for rootless execution from the private NGINX registry.  The <version-tag> should be replaced with the specific version of NGINX Plus to be pulled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ndocker pull private-registry.nginx.com/nginx-plus/rootless-base:<version-tag>\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration\nDESCRIPTION: This command reloads the NGINX configuration without interrupting service.  It is used to apply changes made to the configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/auth0.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent on Alpine Linux (APK)\nDESCRIPTION: This command installs the NGINX Agent package using the apk package manager. It assumes that the apk repository and signing key have been properly configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_27\n\nLANGUAGE: shell\nCODE:\n```\nsudo apk add nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Perl Module (SLES)\nDESCRIPTION: This shell script refreshes the package manager and installs the `nginx-plus-module-perl` package on SLES systems. It uses the `zypper` package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/perl.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-perl\n```\n\n----------------------------------------\n\nTITLE: Create a ClusterIssuer for Let's Encrypt\nDESCRIPTION: Defines a ClusterIssuer resource to use Let's Encrypt as the CA, with HTTP01 challenge solver configured to use the Gateway resource.  The `email` field must be updated.  This is used for automated certificate issuance and renewal.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/integrating-cert-manager.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n  name: letsencrypt-prod\nspec:\n  acme:\n    # You must replace this email address with your own.\n    # Let's Encrypt will use this to contact you about expiring\n    # certificates, and issues related to your account.\n    email: my-name@example.com\n    server: https://acme-v02.api.letsencrypt.org/directory\n    privateKeySecretRef:\n      # Secret resource that will be used to store the account's private key.\n      name: issuer-account-key\n    # Add a single challenge solver, HTTP01 using NGINX Gateway Fabric\n    solvers:\n    - http01:\n        gatewayHTTPRoute:\n          parentRefs: # This is the name of the Gateway that will be created in the next step\n          - name: gateway\n            namespace: default\n            kind: Gateway\n```\n\n----------------------------------------\n\nTITLE: Dockerfile for NGINX Plus API Gateway\nDESCRIPTION: This Dockerfile provides instructions for building a custom NGINX Plus API Gateway image for NGINX Instance Manager. It requires an existing `apigw:<version>` base image and your own `nginx-repo.crt` and `nginx-repo.key` obtained from the MyF5 portal. The Dockerfile installs NGINX Plus and necessary modules, removes certificate and key files after installation and configures logging.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/frequently-used-helm-configs.md#_snippet_1\n\nLANGUAGE: dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# NGINX PLUS API-GW\n# NOTE:\n# NMS does not publish this Docker image and these are only instructions on how to build API-GW with NGINX-PLUS.\n# This Docker build should be performed by the customer using their own nginx-repo.crt and nginx-repo.key.\n# API-GW with NGINX-PLUS is needed to enable OIDC.\n\n# Download NMS API gateway Docker image from MyF5 Downloads, https://docs.nginx.com/nginx-management-suite/installation/helm-chart/\n# Replace \"apigw:<version>\" with a known release tag.\n# For example: apigw:2.6.0\n\nFROM apigw:<version> as apigw-plus\n\nARG REPO_PATH=.\n\n# Define NGINX versions for NGINX Plus and NGINX Plus modules\n# Uncomment this block and the versioned nginxPackages in the main RUN\n# instruction to install a specific release\n# ENV NGINX_VERSION 21\n# ENV NJS_VERSION   0.3.9\n# ENV PKG_RELEASE   1\n\n# Remove any previous version of NGINX\nRUN apk del nginx*\n\n# Download certificate and key from the customer portal (https://cs.nginx.com)\n# and copy them to the build context\nCOPY ${REPO_PATH}/nginx-repo.crt /etc/apk/cert.pem\nCOPY ${REPO_PATH}/nginx-repo.key /etc/apk/cert.key\n\nRUN set -x \\\n# Install the latest release of NGINX Plus and/or NGINX Plus modules\n# Uncomment individual modules if necessary\n# Use versioned packages over defaults to specify a release\n   && nginxPackages=\" \\\n       nginx-plus \\\n       # nginx-plus=${NGINX_VERSION}-${PKG_RELEASE} \\\n       nginx-plus-module-njs \\\n       # nginx-plus-module-lua \\\n       # nginx-plus-module-xslt \\\n       # nginx-plus-module-xslt=${NGINX_VERSION}-${PKG_RELEASE} \\\n       # nginx-plus-module-geoip \\\n       # nginx-plus-module-geoip=${NGINX_VERSION}-${PKG_RELEASE} \\\n       # nginx-plus-module-image-filter \\\n       # nginx-plus-module-image-filter=${NGINX_VERSION}-${PKG_RELEASE} \\\n       # nginx-plus-module-perl \\\n       # nginx-plus-module-perl=${NGINX_VERSION}-${PKG_RELEASE} \\\n       # nginx-plus-module-njs=${NGINX_VERSION}.${NJS_VERSION}-${PKG_RELEASE} \\\n   \" \\\n   KEY_SHA512=\"de7031fdac1354096d3388d6f711a508328ce66c168967ee0658c294226d6e7a161ce7f2628d577d56f8b63ff6892cc576af6f7ef2a6aa2e17c62ff7b6bf0d98 *stdin\" \\\n   && apk add --no-cache --virtual .cert-deps \\\n       openssl vim \\\n   && wget -O /tmp/nginx_signing.rsa.pub https://nginx.org/keys/nginx_signing.rsa.pub \\\n   && if [ \"$(openssl rsa -pubin -in /tmp/nginx_signing.rsa.pub -text -noout | openssl sha512 -r)\" = \"$KEY_SHA512\" ]; then \\\n       echo \"key verification succeeded!\"; \\\n       mv /tmp/nginx_signing.rsa.pub /etc/apk/keys/;\n   else \\\n       echo \"key verification failed!\"; \\\n       exit 1;\n   fi \\\n   && apk del .cert-deps \\\n   && apk add -X \"https://plus-pkgs.nginx.com/alpine/v$(egrep -o '^[0-9]+\\.[0-9]+' /etc/alpine-release)/main\" --no-cache $nginxPackages \\\n   && if [ -n \"/etc/apk/keys/nginx_signing.rsa.pub\" ]; then rm -f /etc/apk/keys/nginx_signing.rsa.pub; fi \\\n   && if [ -n \"/etc/apk/cert.key\" && -n \"/etc/apk/cert.pem\"]; then rm -f /etc/apk/cert.key /etc/apk/cert.pem; fi \\\n# Bring in gettext so we can get `envsubst`, then throw\n# the rest away. To do this, we need to install `gettext`\n# then move `envsubst` out of the way so `gettext` can\n# be deleted completely, then move `envsubst` back.\n   && apk add --no-cache --virtual .gettext gettext \\\n   && mv /usr/bin/envsubst /tmp/ \\\n   \\\n   && runDeps=\"$( \\\n       scanelf --needed --nobanner /tmp/envsubst \\\n           | awk '{ gsub(/,/, \"\\nso:\", $2); print \"so:\" $2 }' \\\n           | sort -u \\\n           | xargs -r apk info --installed \\\n           | sort -u \\\n   )\" \\\n   && apk add --no-cache $runDeps \\\n   && apk del .gettext \\\n   && mv /tmp/envsubst /usr/local/bin/ \\\n# Bring in tzdata so users can set timezones through environment variables\n   && apk add --no-cache tzdata \\\n# Bring in curl and ca-certificates to make registering on DNS SD easier\n   && apk add --no-cache curl ca-certificates \\\n# Forward request and error logs to Docker log collector\n   && ln -sf /dev/stdout /var/log/nginx/access.log \\\n   && ln -sf /dev/stderr /var/log/nginx/error.log\n\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n\n# vim:syntax=Dockerfile\n```\n\n----------------------------------------\n\nTITLE: Enable SSL for Zone Sync Nginx\nDESCRIPTION: Enables SSL for the zone synchronization TCP server by specifying the `ssl` parameter in the `listen` directive. This ensures encrypted communication between cluster nodes. It assumes a resolver is configured for dynamic node discovery. The example utilizes a resolver, listen port, and `zone_sync_server` with resolve flag for cluster member discovery.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n\n    resolver 10.0.0.53 valid=20s;\n\n    server {\n        listen 10.0.0.1:9000 ssl;\n        #...\n\n        zone_sync;\n        zone_sync_server nginx-cluster.example.com:9000 resolve;\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Apply NodePort Config with Kubectl\nDESCRIPTION: This command applies the NodePort configuration defined in the `nodeport-config.yaml` file to the Kubernetes cluster. It creates or updates the `nginx-gateway` service in the `nginx-gateway` namespace, exposing NGINX Gateway Fabric through NodePort.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f nodeport-config.yaml\n```\n\n----------------------------------------\n\nTITLE: Installing Encrypted Session module on SLES\nDESCRIPTION: This shell script refreshes the package manager and installs the `nginx-plus-module-encrypted-session` package using zypper.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/encrypted-session.md#_snippet_3\n\nLANGUAGE: Shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-encrypted-session\n```\n\n----------------------------------------\n\nTITLE: REST API - Add OAuth2 Introspection Policy\nDESCRIPTION: This snippet demonstrates a JSON payload for adding an OAuth2 Introspection policy to an API proxy using a REST API POST request. It includes configurations for introspection endpoint, client token, claims verification, resolver and forwarded claims. This configuration assumes an NGINX environment configured for API management and security.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/introspection.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"{{proxyName}}\",\n   \"version\": \"v1\",\n   \"proxyConfig\": {\n       \"hostname\": \"{{environmentHostname}}\",\n       \"ingress\": {\n           \"basePath\": \"/api\"\n       },\n       \"backends\": [\n           {\n               \"serviceName\": \"backend-svc\",\n               \"serviceTargets\": [\n                   {\n                       \"hostname\": \"10.0.0.10\"\n                   }\n               ]\n           }\n       ],\n       \"policies\": {\n           \"oauth2-introspection\": [\n               {\n                   \"action\": {\n                       \"introspectionEndpoint\": \"https://example.idp.com:8443/oauth/v2/oauth-introspect\",\n                       \"enableSNI\": true,\n                       \"proxyTLSName\": \"test.oauth.com\",\n                       \"introspectionResponse\": \"application/json\",\n                       \"cacheIntrospectionResponse\": \"5m\",\n                       \"clientTokenSuppliedIn\": \"HEADER\",\n                       \"clientTokenName\": \"Authorization\",\n                       \"authzServerTokenHint\": \"ACCESS_TOKEN\",\n                       \"forwardToken\": false,\n                       \"forwardedClaimsInProxyHeader\": [\n                           \"username\",\n                           \"exp\",\n                           \"scope\"\n                       ],\n\t\t\t\t\t   \"verifyClaims\": [\n\t\t\t\t\t\t   {\n\t\t\t\t\t\t\t   \"claim\": \"sub\",\n\t\t\t\t\t\t\t   \"type\": \"STRING\",\n\t\t\t\t\t\t\t   \"value\": \"a95117bf-1a2e-4d46-9c44-5fdee8dddd11\"\n\t\t\t\t\t\t   },\n\t\t\t\t\t\t   {\n\t\t\t\t\t\t\t   \"claim\": \"scope\",\n\t\t\t\t\t\t\t   \"type\": \"STRING\",\n\t\t\t\t\t\t\t   \"value\": \"read write email\",\n\t\t\t\t\t\t\t   \"delimiter\": \"SPACE\"\n\t\t\t\t\t\t   },\n\t\t\t\t\t\t   {\n\t\t\t\t\t\t\t   \"claim\": \"aud\",\n\t\t\t\t\t\t\t   \"type\": \"ARRAY\",\n\t\t\t\t\t\t\t   \"value\": [\"https://protected.example.net/resource\"]\n\t\t\t\t\t\t   },\n\t\t\t\t\t\t   {\n\t\t\t\t\t\t\t   \"claim\": \"resource_access.account.groups\",\n\t\t\t\t\t\t\t   \"type\": \"STRING\",\n\t\t\t\t\t\t\t   \"value\": \"default-group\"\n\t\t\t\t\t\t   },\n\t\t\t\t\t\t   {\n\t\t\t\t\t\t\t   \"claim\": \"resource_access.account.roles\",\n\t\t\t\t\t\t\t   \"type\": \"ARRAY\",\n\t\t\t\t\t\t\t   \"value\": [\n\t\t\t\t\t\t\t\t   \"default-roles\",\n\t\t\t\t\t\t\t\t   \"offline_access\",\n\t\t\t\t\t\t\t   ]\n\t\t\t\t\t\t   },\n\t\t\t\t\t\t   {\n\t\t\t\t\t\t\t   \"claim\": \"email_verified\",\n\t\t\t\t\t\t\t   \"type\": \"BOOLEAN\",\n\t\t\t\t\t\t\t   \"value\": true\n\t\t\t\t\t\t   },\n\t\t\t\t\t\t   {\n\t\t\t\t\t\t\t   \"claim\": \"user-group\",\n\t\t\t\t\t\t\t   \"type\": \"INTEGER\",\n\t\t\t\t\t\t\t   \"value\": 42\n\t\t\t\t\t\t   }\n\t\t\t\t\t   ],\n                       \"resolver\": {\n                           \"valid\": \"30s\"\n\n```\n\n----------------------------------------\n\nTITLE: Verify Nginx signing key on Ubuntu\nDESCRIPTION: This command verifies the integrity of the Nginx signing key that was downloaded, by checking its fingerprint.  It confirms that the key is the correct one before adding the Nginx repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ngpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg\n```\n\n----------------------------------------\n\nTITLE: Query Metrics with SeriesLimit and OrderSeriesBy - cURL\nDESCRIPTION: This cURL command demonstrates the use of both `seriesLimit` and `orderSeriesBy`. It retrieves the top 5 series ordered by the maximum value in descending order. `orderSeriesBy` must be used in combination with `seriesLimit`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_16\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=SUM(some.metric.name)&groupBy=someDimension&seriesLimit=5&orderSeriesBy=MAX DESC&startTime=now-1d&endTime=now&resolution=5m\"\n```\n\n----------------------------------------\n\nTITLE: Exporting OIDC Environment Variables (Keycloak < 18.x)\nDESCRIPTION: This snippet exports environment variables necessary for configuring OIDC with Keycloak versions earlier than 18.x. It retrieves OIDC endpoints using `curl` and `jq`. Replace the placeholders with the appropriate values for your Keycloak and NGINX Instance Manager setup.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n# Either the FQDN or the IP address is suitable for these environment variables.\nexport KEYCLOAK_IP=\"<insert-keycloak-IP>\"\nexport NIM_IP=\"<insert-NIM-IP>\"\nexport KEYCLOAK_CLIENT_ID=\"<insert-keycloak-client-id>\"\nexport KEYCLOAK_CLIENT_SECRET=\"<insert-kecloak-client-secret>\"\n\n# Choose an appropriate Hash-Based Message Authentication Code (HMAC)\nexport HMAC_KEY=\"<insert-HMAC>\"\n\nexport KEYCLOAK_AUTH_ENDPOINT=$(curl -k \"https://$KEYCLOAK_IP:8443/auth/realms/<realm-name>/.well-known/openid-configuration\" | jq -r \".authorization_endpoint\")\nexport KEYCLOAK_TOKEN_ENDPOINT=$(curl -k \"https://$KEYCLOAK_IP:8443/auth/realms/<realm-name>/.well-known/openid-configuration\" | jq -r \".token_endpoint\")\nexport KEYCLOAK_KEYS_ENDPOINT=$(curl -k \"https://$KEYCLOAK_IP:8443/auth/realms/<realm-name>/.well-known/openid-configuration\" | jq -r \".jwks_uri\")\n```\n\n----------------------------------------\n\nTITLE: Configure Backend Upstream in frontend.conf\nDESCRIPTION: This snippet configures the upstream server `my_backend` in the `frontend.conf` file. This upstream should point to the application server that NGINX Plus is proxying and protecting with OpenID Connect. The zone directive sets up a shared memory zone for load balancing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/auth0.md#_snippet_3\n\nLANGUAGE: Nginx configuration file\nCODE:\n```\nupstream my_backend {\n    zone my_backend 64k;\n    server my-backend-app.com:80;\n}\n```\n\n----------------------------------------\n\nTITLE: Setting Up Mainline NGINX Repository on Alpine\nDESCRIPTION: This command adds the official NGINX mainline repository to the apk package manager's list of repositories. It constructs the repository URL using the Alpine version from /etc/alpine-release and appends it to /etc/apk/repositories.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_39\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"%s%s%s\\n\" \\\n    \"http://nginx.org/packages/mainline/alpine/v\" \\\n    `egrep -o '^[0-9]+\\.[0-9]+' /etc/alpine-release` \\\n    \"/main\" \\\n    | sudo tee -a /etc/apk/repositories\n```\n\n----------------------------------------\n\nTITLE: Configure Certificate Authentication NGINX\nDESCRIPTION: Configures certificate-based authentication across cluster nodes using `zone_sync_ssl_certificate`, `zone_sync_ssl_certificate_key`, `ssl_verify_client`, and `ssl_trusted_certificate` directives. `zone_sync_ssl_certificate` and `zone_sync_ssl_certificate_key` configure client certificate for outgoing connections. `ssl_verify_client on` and `ssl_trusted_certificate` are for server-side client verification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n\n    resolver 10.0.0.53 valid=20s;\n\n    server {\n        listen 10.0.0.1:9000 ssl;\n\n        ssl_certificate        /etc/ssl/nginx-1.example.com.server_cert.pem;\n        ssl_certificate_key    /etc/ssl/nginx-1.example.com.key.pem;\n\n        zone_sync;\n        zone_sync_server    nginx-cluster.example.com:9000 resolve;\n\n        zone_sync_ssl                     on;\n        zone_sync_ssl_verify              on;\n        zone_sync_ssl_trusted_certificate /etc/ssl/server_ca.pem;\n\n        zone_sync_ssl_certificate     localhost.crt;\n        zone_sync_ssl_certificate_key localhost.key;\n\n        ssl_verify_client       on;\n        ssl_trusted_certificate /etc/ssl/client_ca.pem;\n        #...\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Create Cafe Gateway\nDESCRIPTION: This snippet defines a Kubernetes Gateway resource named 'cafe' that uses the 'nginx' gateway class. It configures a listener on port 80 for HTTP traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/routing-traffic-to-your-app.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nmetadata:\n  name: cafe\nspec:\n  gatewayClassName: nginx\n  listeners:\n  - name: http\n    port: 80\n    protocol: HTTP\nEOF\n```\n\n----------------------------------------\n\nTITLE: Remove Previous NGINX Plus repository and apt configuration files - Ubuntu\nDESCRIPTION: These commands remove any previous NGINX Plus repository and apt configuration files, ensuring a clean slate for the new installation. `sudo rm /etc/apt/sources.list.d/nginx-plus.list` removes the repository file, and `sudo rm /etc/apt/apt.conf.d/90nginx` removes the configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_33\n\nLANGUAGE: shell\nCODE:\n```\nsudo rm /etc/apt/sources.list.d/nginx-plus.list\nsudo rm /etc/apt/apt.conf.d/90nginx\n```\n\n----------------------------------------\n\nTITLE: Restart API Connectivity Manager Service\nDESCRIPTION: This command restarts the `nms-acm` service using `systemctl`. This is necessary to apply any configuration changes made during the API Connectivity Manager upgrade.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm-offline.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nms-acm\n```\n\n----------------------------------------\n\nTITLE: API Certificate Authentication with curl\nDESCRIPTION: This snippet shows how to authenticate an API request using an API certificate with curl.  The certificate path and password are included in the request using the --cert option.  Replace <tenant> with your tenant name, <api-creds> with the path to your certificate file, and <password> with your certificate password.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/api/authentication.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://<tenant>.console.ves.volterra.io/api/web/namespaces --cert-type P12 \\\n--cert <api-creds>:<password>\n```\n\n----------------------------------------\n\nTITLE: Configure Security Event Log Backup with Security Monitoring and NGINX Instance Manager - NGINX\nDESCRIPTION: This configuration enables backup logging for NGINX App Protect security events when using both Security Monitoring and NGINX Instance Manager.  It configures the policy file, enables security logging, and specifies two log destinations: syslog and a local file.  The path to the local log file needs to be configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/troubleshooting.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_policy_file \"/etc/nms/NginxDefaultPolicy.tgz\";\napp_protect_security_log_enable on;\napp_protect_security_log \"/etc/nms/secops_dashboard.tgz\" syslog:server=127.0.0.1:514;\napp_protect_security_log \"/etc/nms/secops_dashboard.tgz\" <Path to store log file>;\n# Example: app_protect_security_log \"/etc/nms/secops_dashboard.tgz\" /var/log/app_protect/security.log;\n```\n\n----------------------------------------\n\nTITLE: Filter Data Plane Logs for Emergency Errors\nDESCRIPTION: This command retrieves logs from the `nginx` container of a specified pod in the `nginx-gateway` namespace and filters the output using `grep` to find log entries with the `emerg` level. Replace `<ngf-pod-name>` with the actual name of the NGINX Gateway Fabric pod. This is useful for quickly identifying critical errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n nginx-gateway logs <ngf-pod-name> -c nginx | grep emerg\n```\n\n----------------------------------------\n\nTITLE: Setting Up PKG Repository for NGINX Agent (FreeBSD)\nDESCRIPTION: This command creates the `/etc/pkg/nginx-agent.conf` file, which configures the pkg package manager to use the NGINX Agent repository for FreeBSD. The repository URL and other settings are defined in this file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_35\n\nLANGUAGE: shell\nCODE:\n```\nnginx-agent: {\n    URL: pkg+http://packages.nginx.org/nginx-agent/freebsd/${ABI}/latest\n    ENABLED: true\n    MIRROR_TYPE: SRV\n    }\n```\n\n----------------------------------------\n\nTITLE: Configure yum repository for Nginx Agent on RHEL\nDESCRIPTION: This snippet configures the yum repository for Nginx Agent on RHEL-based systems by creating a repository file. The file specifies the repository name, base URL, GPG key for verification, and enables module hotfixes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\n[nginx-agent]\nname=nginx agent repo\nbaseurl=http://packages.nginx.org/nginx-agent/centos/$releasever/$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n```\n\n----------------------------------------\n\nTITLE: Persist UUID across OS upgrades\nDESCRIPTION: This code snippet demonstrates setting the `store_uuid` option to `True` in the `agent.conf` file to ensure the UUID persists across OS upgrades. This prevents the agent from being registered as a new object in NGINX Controller after an OS upgrade. This configuration avoids downtime during and after OS upgrades.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-the-agent.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\n[credentials]\n...\nstore_uuid = True\n```\n\n----------------------------------------\n\nTITLE: Example agent-dynamic.conf file\nDESCRIPTION: This is an example dynamic configuration file (`agent-dynamic.conf`) for NGINX Agent. It defines settings for `instance_group` and `tags`. These values can be dynamically changed via the API or the agent install script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_8\n\nLANGUAGE: yaml\nCODE:\n```\n#\n# /var/lib/nginx-agent/agent-dynamic.conf\n#\n# Dynamic configuration file for NGINX Agent.\n#\n# The purpose of this file is to track agent configuration\n# values that can be dynamically changed via the API and the agent install script.\n# You may edit this file, but API calls that modify the tags on this system will\n# overwrite the tag values in this file.\n#\n# The agent configuration values that API calls can modify are as follows:\n#    - tags\n#\n# The agent configuration value that the agent install script can modify are as follows:\n#    - instance_group\n\ninstance_group: devenv-group\ntags:\n  - devenv\n  - test\n```\n\n----------------------------------------\n\nTITLE: Install Nginx njs Module on CentOS/RHEL/Oracle Linux\nDESCRIPTION: This command installs the NGINX JavaScript module (njs) for CentOS, RHEL, and Oracle Linux operating systems. It requires root privileges and uses the yum package manager to install the nginx-plus-module-njs package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/cognito.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: NGINX Instance Manager Secrets Configuration\nDESCRIPTION: This is an example of the `secrets` configuration block within the `/etc/nms/nms.conf` file. It specifies the `driver` as `vault`, the Vault `address`, and an `isolation` configuration to manage secrets within a specific namespace and prefix within Vault.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-vault.md#_snippet_4\n\nLANGUAGE: text\nCODE:\n```\nsecrets:\n  # change driver to \"local\" if you want to stop using vault\n  driver: vault\n  config:\n    # local file path for stored secrets when using the local driver\n    path: /var/lib/nms/secrets\n    # key_file is required for local driver\n    key_file: /var/lib/nms/secrets/key\n    # vault address for when using the vault driver\n    address: http://127.0.0.1:8200/v1\n    # isolation is used to store secrets in a specific namespace and prefix to better restrict access rights\n    # on the local file system or shared vault server.\n    isolation:\n      namespace: secret\n      prefix: secureString\n```\n\n----------------------------------------\n\nTITLE: Publish Response - JSON\nDESCRIPTION: This JSON snippet shows an example response from the publish API, including the deployment UID, a link to the deployment details, and a result message. The deploymentUID can be used to check the publication status.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_24\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"deployments\": [\n    {\n      \"deploymentUID\": \"ddc781ca-15d6-46c9-86ea-e7bdb91e8dec\",\n      \"links\": {\n        \"rel\": \"/api/platform/v1/security/deployments/ddc781ca-15d6-46c9-86ea-e7bdb91e8dec\"\n      },\n      \"result\": \"Publish security content request Accepted\"\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Slow Start for Upstream Servers\nDESCRIPTION: This snippet configures the `slow_start` parameter for servers in the upstream group. This parameter gradually increases traffic to a server as it recovers or is added to the group, preventing it from being overwhelmed with connections during startup.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_28\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'upstream' block\nserver 192.168.33.11:8080 slow_start=30s;\nserver 192.168.33.12:8080 slow_start=30s;\n```\n\n----------------------------------------\n\nTITLE: Verifying NGINX Amplify Agent Status\nDESCRIPTION: This snippet demonstrates how to verify if the NGINX Amplify Agent process is running. It uses `ps ax` to list all processes and then pipes the output to `grep` to filter for processes containing 'amplify-agent'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/faq/nginx-amplify-agent.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nps ax | grep -i 'amplify\\-'\n2552 ?        S      0:00 amplify-agent\n```\n\n----------------------------------------\n\nTITLE: API Proxy Verification with cURL\nDESCRIPTION: This cURL command is used to verify the setup of an API proxy after publishing it. It sends a GET request to the specified endpoint using the gateway proxy hostname, version, and base path. A successful response indicates that the proxy is configured correctly and can forward traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/publish-api-proxy.md#_snippet_2\n\nLANGUAGE: curl\nCODE:\n```\ncurl -k -X GET \"https://gateway-proxy-hostname/version/basepath\"\n```\n\n----------------------------------------\n\nTITLE: Rewriting HTTP Responses with Sub_filter in Nginx\nDESCRIPTION: This snippet demonstrates the use of the `sub_filter` directive to replace strings in the HTTP response body.  It replaces `/blog/` with `/blog-staging/` and applies this substitution only once.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    sub_filter      /blog/ /blog-staging/;\n    sub_filter_once off;\n}\n```\n\n----------------------------------------\n\nTITLE: Upstream Active Connections Metric\nDESCRIPTION: Describes the 'plus.upstream.conn.active' metric, which is a gauge representing the current number of active connections to the upstream servers. This metric helps monitor the current load on the upstream servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, integer\nDescription: Current number of active connections to the upstream servers.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Run NGINX Agent Docker Container\nDESCRIPTION: Runs the NGINX Agent Docker container in detached mode (-d) with the name 'nginx-agent'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ndocker run --name nginx-agent -d nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Complete Nginx Configuration\nDESCRIPTION: This complete Nginx configuration sets up load balancing, session persistence, SSL, and health checks.  It includes defining an upstream block with a shared memory zone, backend servers, and cookie-based session persistence. It also configures a server block listening on port 443 with SSL, sets the 'Host' header, proxies requests to the upstream, enables health checks, and sets the HTTP version to 1.1.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nupstream myapp {\n    zone myapp 64k;\n    server 10.0.0.100:80;\n    server 10.0.0.101:80;\n    server 10.0.0.102:80;\n    sticky cookie mysession expires=1h;\n}\n\nserver {\n    listen 10.0.0.98:443 ssl default_server;\n    ssl_certificate     test.crt;\n    ssl_certificate_key test.key;\n    proxy_set_header Host $host;\n    location / {\n        proxy_pass http://myapp;\n        health_check;\n        proxy_http_version 1.1;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Defining and Applying GraphQL Profiles in Nginx (JSON)\nDESCRIPTION: This JSON configuration defines a policy named \"graphql_policy\" and configures two GraphQL profiles: \"Default\" and \"My Custom Profile\". It then associates these profiles with specific URLs (/graphql and /mygraphql, respectively) to enforce security policies on GraphQL traffic. The configuration includes settings for attack signature checks, defense attributes, and response enforcement.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/associating-graphql-profiles.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"graphql_policy\",\n    \"template\": {\n        \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"applicationLanguage\": \"utf-8\",\n    \"caseInsensitive\": false,\n    \"enforcementMode\": \"blocking\",\n\n    \"graphql-profiles\": [\n        {\n            \"attackSignaturesCheck\": true,\n            \"defenseAttributes\": {\n                \"allowIntrospectionQueries\": true,\n                \"maximumBatchedQueries\": \"any\",\n                \"maximumQueryCost\": \"any\",\n                \"maximumStructureDepth\": \"any\",\n                \"maximumTotalLength\": \"any\",\n                \"maximumValueLength\": \"any\",\n                \"tolerateParsingWarnings\": true\n            },\n            \"description\": \"Default GraphQL Profile\",\n            \"metacharElementCheck\": true,\n            \"name\": \"Default\",\n            \"responseEnforcement\": {\n                \"blockDisallowedPatterns\": false\n            }\n        },\n        {\n            \"attackSignaturesCheck\": true,\n            \"defenseAttributes\": {\n                \"allowIntrospectionQueries\": true,\n                \"maximumBatchedQueries\": \"any\",\n                \"maximumQueryCost\": \"any\",\n                \"maximumStructureDepth\": \"any\",\n                \"maximumTotalLength\": \"400\",\n                \"maximumValueLength\": \"any\",\n                \"tolerateParsingWarnings\": false\n            },\n            \"description\": \"my custom Profile\",\n            \"metacharElementCheck\": true,\n            \"name\": \"My Custom Profile\",\n            \"responseEnforcement\": {\n                \"blockDisallowedPatterns\": true,\n                \"disallowedPatterns\": [\"pattern1\", \"pattern2\"]\n            }\n        }\n    ],\n    \"urls\": [\n        {\n            \"$action\": \"delete\",\n            \"method\": \"*\",\n            \"name\": \"*\",\n            \"protocol\": \"http\",\n            \"type\": \"wildcard\"\n        },\n        {\n            \"isAllowed\": true,\n            \"name\": \"/graphql\",\n            \"protocol\": \"http\",\n            \"type\": \"explicit\",\n            \"performStaging\": false,\n            \"urlContentProfiles\": [\n                {\n                    \"contentProfile\": {\n                        \"name\": \"Default\"\n                    },\n                    \"headerValue\": \"*\",\n                    \"headerName\": \"*\",\n                    \"headerOrder\": \"default\",\n                    \"type\": \"graphql\"\n                }\n            ]\n        },\n        {\n            \"isAllowed\": true,\n            \"name\": \"/mygraphql\",\n            \"protocol\": \"http\",\n            \"type\": \"explicit\",\n            \"performStaging\": false,\n            \"urlContentProfiles\": [\n                {\n                    \"contentProfile\": {\n                        \"name\": \"My Custom Profile\"\n                    },\n                    \"headerValue\": \"*\",\n                    \"headerName\": \"*\",\n                    \"headerOrder\": \"default\",\n                    \"type\": \"graphql\"\n                }\n            ]\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: GDB script for dumping Nginx configuration\nDESCRIPTION: GDB script to extract the current Nginx configuration from the master process in memory. It iterates through the `config_dump` structure in the Nginx cycle and saves each configuration part to the `nginx_conf.txt` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_30\n\nLANGUAGE: nginx\nCODE:\n```\nset $cd = ngx_cycle->config_dump\nset $nelts = $cd.nelts\nset $elts = (ngx_conf_dump_t*)($cd.elts)\nwhile ($nelts-- > 0)\nset $name = $elts[$nelts]->name.data\nprintf \"Dumping %s to nginx_conf.txt\\n\", $name\nappend memory nginx_conf.txt \\\n      $elts[$nelts]->buffer.start $elts[$nelts]->buffer.end\nend\n```\n\n----------------------------------------\n\nTITLE: NGINX Proxy Pass Directive\nDESCRIPTION: This snippet shows the `proxy_pass` directive, which is used within a location block to forward requests to an upstream server. It is a fundamental part of reverse proxy configurations in NGINX. The directive specifies the address of the upstream server that will handle the request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/tutorials/round-robin-reverse-proxy.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_pass http://users_backend;\n```\n\n----------------------------------------\n\nTITLE: Create Security Policy via REST API using curl\nDESCRIPTION: This snippet demonstrates how to create a security policy using the NGINX Instance Manager REST API. It requires a valid access token and the policy definition in JSON format, which is sent as a request body. The JSON policy must be base64 encoded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\ncurl -X POST https://{{NIM_FQDN}}/api/platform/v1/security/policies \\\n    -H \"Authorization: Bearer <access token>\" \\\n    -d @ignore-xss-example.json\n```\n\n----------------------------------------\n\nTITLE: Configuring Readiness Probe in NGINX\nDESCRIPTION: This snippet demonstrates how to configure the readiness probe using the `app_protect_dos_readiness` directive. This directive enables or disables the readiness probe feature and allows specifying the URI and port for the probe.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_dos_readiness on uri:/readiness port:8090;\n```\n\n----------------------------------------\n\nTITLE: Create Kubernetes Namespace for NMS\nDESCRIPTION: Creates a dedicated namespace named 'nms' in Kubernetes. This namespace isolates the NGINX Instance Manager deployment from other applications running on the cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl create namespace nms\n```\n\n----------------------------------------\n\nTITLE: Reference Backend Configuration Policy API Request Body (JSON)\nDESCRIPTION: This snippet provides a comprehensive example of a backend configuration policy API request body in JSON format. It includes various settings for target backend policy, connection management, timeouts, client body size, NTLM authentication, load balancing, queueing, buffering, and session cookies. This is a reference to various backend settings that can be configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/http-backend-configuration.md#_snippet_11\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"policies\": {\n      \"backend-config\": [\n         {\n            \"action\": {\n               \"targetBackendPolicyLabel\" : \"default\",\n               \"keepCacheConnectionAlive\": 32,\n               \"keepAliveRequests\": 1000,\n               \"keepAliveTime\": \"1h\",\n               \"keepAliveTimeout\": \"60s\",\n               \"connectTimeout\": \"30s\",\n               \"readTimeout\": \"30s\",\n               \"sendTimeout\": \"30s\",\n               \"clientMaxBodySize\": \"2m\",\n               \"enableNTLMAuthn\": false,\n               \"loadBalancing\": {\n                  \"algorithm\": \"LEAST_CONN\",\n                  \"leastTimeMeasurement\": \"HEADER\",\n                  \"hashKey\": \"$request_uri\",\n                  \"consistentHashing\": true,\n                  \"randomTwo\": true,\n                  \"randomMethod\": \"LEAST_CONN\"\n               },\n               \"queue\": {\n                  \"maxNumberOfRequests\": 10,\n                  \"timeOut\": \"60s\"\n               },\n               \"buffer\": {\n                  \"number\": 8,\n                  \"size\": \"8k\"\n               },\n               \"sessionCookie\": {\n                  \"name\": \"auth_cookie\",\n                  \"path\": \"/\",\n                  \"expiresIn\": \"1h\",\n                  \"domainName\": \".example.com\",\n                  \"httpOnly\": true,\n                  \"secure\": true,\n                  \"sameSite\": \"strict\"\n               }\n            }\n         }\n      ]\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Applying Rate Limit Configuration using Kubectl\nDESCRIPTION: This command applies the ratelimit-burst.yaml file to create a RateLimit resource in the Kubernetes cluster. This RateLimit resource configures rate limiting policies for the bursty-client deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_20\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f ratelimit-burst.yaml\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX and App Protect on Ubuntu 24.04\nDESCRIPTION: This snippet installs NGINX and App Protect on Ubuntu 24.04 systems. It creates a directory, updates the package index, and installs nginx and app-protect-module-oss package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_30\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/packages/\ncd /etc/packages/\nsudo apt-get update\nsudo apt-get install nginx app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Generating an Unmodified JSON Policy\nDESCRIPTION: Example command to generate an unmodified JSON policy, including elements not supported by NGINX App Protect WAF. This is achieved using the `--keep-full-configuration` flag. Resulting policy might cause warnings/errors when used in NGINX App Protect WAF.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker run --rm \\\n -v $(pwd):$(pwd) \\\n --entrypoint=/opt/app_protect/bin/convert-policy \\\n waf-compiler-<version-tag>:custom \\\n -i $(pwd)/policy1.xml -o $(pwd)/policy1.json --keep-full-configuration\n```\n\n----------------------------------------\n\nTITLE: Get Inventory List via API\nDESCRIPTION: This command sends an API request to get the inventory list from NGINX Management Suite. It uses `curl` with basic authentication (`-u <user>:<password>`) to make a GET request to the specified URL. The output is then piped to `jq` for JSON formatting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\ncurl -u <user>:<password> https://<NMS_FQDN>/api/platform/v1/systems | jq\n```\n\n----------------------------------------\n\nTITLE: Overwrite Existing Security Log Profile (PUT) - Shell\nDESCRIPTION: This code snippet demonstrates how to overwrite an existing security log profile using a PUT request to the NGINX Instance Manager API. It requires the log profile's UID to be included in the URL. The `-d` flag specifies the JSON payload to be sent from the `update-log-profile.json` file. Requires `curl`, a valid access token, and the log profile's UID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X PUT https://{{NIM_FQDN}}/api/platform/v1/security/logprofiles/<log-profile-uid> \\\n      -H \"Authorization: Bearer <access token>\" \\\n      --Content-Type application/json \\\n      -d @update-log-profile.json\n```\n\n----------------------------------------\n\nTITLE: Publish Request - JSON\nDESCRIPTION: This JSON snippet defines the structure for a request to the publish API. It allows for specifying instance and instance group UIDs, policy content, log profile content, attack signature library details, and threat campaign details. This example contains placeholders for actual UIDs and names.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_23\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"publications\": [\n    {\n      \"instances\": [\n        \"<instance-uid>\"\n      ],\n      \"instanceGroups\": [\n        \"<instance-group-uid>\"\n      ],\n      \"policyContent\": {\n        \"name\": \"example-policy\",\n        \"uid\": \"<policy-uid>\"\n      },\n      \"logProfileContent\": {\n        \"name\": \"example-log-profile\",\n        \"uid\": \"<log-profile-uid>\"\n      },\n      \"attackSignatureLibrary\": {\n        \"uid\": \"<signature-library-uid>\",\n        \"versionDateTime\": \"2023.10.02\"\n      },\n      \"threatCampaign\": {\n        \"uid\": \"<campaign-uid>\",\n        \"versionDateTime\": \"2023.10.01\"\n      }\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Create App Protect Directories\nDESCRIPTION: Creates the necessary directories for NGINX App Protect WAF v5 services. These directories are used to store configuration and data required by the WAF components. The command uses sudo mkdir -p to create the directories and their parent directories if they do not exist.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /opt/app_protect/config /opt/app_protect/bd_config\n```\n\n----------------------------------------\n\nTITLE: Generating JSON with Default Tag (Shell)\nDESCRIPTION: This command demonstrates how to generate a user defined signature JSON file using the `convert-signatures` tool with default tag settings.  It uses Docker to run the tool, specifying input and output files and piping the result through `jq` for formatting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_26\n\nLANGUAGE: shell\nCODE:\n```\ndocker run -v `pwd`:`pwd` -w `pwd` --entrypoint /opt/app_protect/bin/convert-signatures docker_img:latest -i /path/to/signatures.xml -o /path/to/signatures.json | jq\n```\n\n----------------------------------------\n\nTITLE: Update NGINXaaS Deployment using Azure CLI\nDESCRIPTION: This Azure CLI command updates the NGINXaaS deployment to the Standard V2 plan. It requires the deployment name and resource group. The command updates the SKU to `standardv2_Monthly_gmz7xq9ge3py`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/troubleshooting/migrate-from-standard.md#_snippet_1\n\nLANGUAGE: Bash\nCODE:\n```\naz nginx deployment update --name myDeployment --resource-group \\\n   myResourceGroup --sku name=\"standardv2_Monthly_gmz7xq9ge3py\"\n```\n\n----------------------------------------\n\nTITLE: Install OpenTracing Module on FreeBSD\nDESCRIPTION: This shell script updates the package repository and installs the `nginx-plus-module-opentracing` package using pkg. This enables the OpenTracing module within Nginx Plus. It is compatible with FreeBSD.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentracing.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-opentracing\n```\n\n----------------------------------------\n\nTITLE: Check Service Status\nDESCRIPTION: This bash command retrieves the status of the Services in the cluster, ensuring that the target-v3-0 Service is available. It helps verify that the new application version is correctly exposed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_21\n\nLANGUAGE: bash\nCODE:\n```\n$ kubectl get svc\nNAME          TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE\ngateway-svc   LoadBalancer   10.0.0.2        1.2.3.4         80:30975/TCP   2m\ntarget-svc    ClusterIP      10.0.0.3        <none>          80/TCP         2m\ntarget-v2-1   ClusterIP      10.0.0.4        <none>          80/TCP         2m\ntarget-v3-0   ClusterIP      10.0.0.5        <none>          80/TCP         2m\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Mainline Repository\nDESCRIPTION: This snippet shows the configuration file for the NGINX mainline repository. It defines the repository's name, base URL, GPG key for verification, and enables it for use by the package manager. The `$basearch` variable will be replaced with the system's architecture.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-amazon.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\n[nginx-mainline]\nname=nginx mainline repo\nbaseurl=http://nginx.org/packages/mainline/amzn/2023/$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n```\n\n----------------------------------------\n\nTITLE: Scale Kubernetes Deployment (Bash)\nDESCRIPTION: This snippet shows how to scale a Kubernetes deployment using the `kubectl scale deployments` command. This allows you to increase or decrease the number of replicas for the deployment. Requires `kubectl` command-line tool to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-containerized-instances.md#_snippet_9\n\nLANGUAGE: Bash\nCODE:\n```\nkubectl scale deployments/hello-node --replicas=2\n```\n\n----------------------------------------\n\nTITLE: Nginx Configuration for Percentage-Based Cache Splitting\nDESCRIPTION: This Nginx configuration snippet is generated based on the percentage-based cache splitting configuration. It includes the split_clients directive, proxy_cache_path directives for each disk store, and configures the location block with proxy_cache, add_header, and proxy_cache_valid directives. The hl_lines attribute highlights key lines related to the cache splitting configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-caching.md#_snippet_3\n\nLANGUAGE: Nginx configuration file\nCODE:\n```\nsplit_clients $request_uri $cache_bdfa5d91f97d37dbb97a42dde6a5f4ff {\n    20% app_centric_env|app|split_cache_percentage|/tmp/hdd1;\n    50% app_centric_env|app|split_cache_percentage|/tmp/hdd2;\n    * app_centric_env|app|split_cache_percentage|/tmp/default;\n}\nproxy_cache_path /tmp/hdd1/app_centric_env|app|split_cache_percentage| max_size=5G min_free=10k keys_zone=app_centric_env|app|split_cache_percentage|/tmp/hdd1: 100m purger=off inactive=1m;\nproxy_cache_path /tmp/hdd2/app_centric_env|app|split_cache_percentage| max_size=5g min_free=10k keys_zone=app_centric_env|app|split_cache_percentage|/tmp/hdd2: 100m purger=off inactive=10s;\nproxy_cache_path /tmp/default/app_centric_env|app|split_cache_percentage| max_size=2g min_free=10k keys_zone=app_centric_env|app|split_cache_percentage|/tmp/default: 100m purger=off inactive=15s;\nupstream split_p_http_7ec84d9e-373e-4d90-bcaa-0e33dcc4b906 {\n    zone split_p_http_7ec84d9e-373e-4d90-bcaa-0e33dcc4b906 160k;\n    server 10.146.187.154: 80;\n    keepalive 64;\n    keepalive_requests 100;\n    keepalive_timeout 60s;\n}\nserver {\n    server_name test.example.com;\n    listen 80 reuseport;\n    status_zone server_4d1ee345-cf08-354e-93dc-1c3a844a04e3;\n    set $f5_gateway gw;\n    f5_metrics_marker gateway $f5_gateway;\n    set $f5_environment env;\n    f5_metrics_marker environment $f5_environment;\n    location /aaa {\n        error_log /dev/null;\n        access_log off;\n        proxy_cache $cache_bdfa5d91f97d37dbb97a42dde6a5f4ff;\n        set $f5_app app;\n        f5_metrics_marker app $f5_app;\n        set $f5_component split_cache_percentage;\n        f5_metrics_marker component $f5_component;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_set_header Host $host;\n        proxy_set_header Connection '';\n        proxy_http_version 1.1;\n        add_header Cache $upstream_cache_status;\n        proxy_cache_valid any 1m;\n        proxy_pass http: //split_p_http_7ec84d9e-373e-4d90-bcaa-0e33dcc4b906;\n}\n\n```\n\n----------------------------------------\n\nTITLE: Create a Developer Portal Environment (HTTPS) - JSON\nDESCRIPTION: This snippet shows the JSON payload for creating a Developer Portal environment using HTTPS. It includes the TLS Inbound policy with base64 encoded server certificate and key. The environment name, function, proxy details, and runtime are also defined.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/add-devportal.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"{{environmentName}}\",\n    \"functions\": [\n        \"DEVPORTAL\"\n    ],\n    \"proxies\": [\n        {\n            \"proxyClusterName\": \"{{portalInstanceGroupName}}\",\n            \"hostnames\": [\n                \"{{portalClusterHostname}}\"\n            ],\n            \"runtime\": \"PORTAL-PROXY\",\n            \"policies\": {\n                \"tls-inbound\": [\n                    {\n                        \"data\": {\n                            \"serverCerts\": [\n                                {\n                                    \"key\": \"{{tls key}}\",\n                                    \"cert\": \"{{tls cert}}\"\n                                }\n                            ]\n                        }\n                    }\n                ]\n            }\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Get Kubernetes pods with wide output (Bash)\nDESCRIPTION: This command retrieves a list of all pods in the current namespace (`default` if not specified) with extended information, including the IP address and node.  It's used to verify that the `egress-driver` pod is injected with the sidecar proxy (indicated by `2/2` READY state).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get pods -o wide\n\nNAME                             READY   STATUS    RESTARTS   AGE    IP           NODE        NOMINATED NODE   READINESS GATES\negress-driver-5587fbdf78-hm4w6   2/2     Running   0          5s     10.1.1.1     node-name   <none>           <none>\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Plus Packages (Unprivileged)\nDESCRIPTION: This command installs NGINX Plus from downloaded packages using `ngxunprivinst.sh`.  Replace `<path>` with the desired installation path, `<license_file>` with the path to `license.jwt`, and `<file1.rpm>` and `<file2.rpm>` with the names of the NGINX Plus package files. The `-y` parameter forces overwriting an existing installation. \nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_44\n\nLANGUAGE: shell\nCODE:\n```\n./ngxunprivinst.sh install [-y] -p <path> -j <license_file> <file1.rpm> <file2.rpm>\n```\n\n----------------------------------------\n\nTITLE: NGINX Service Mesh Top Command (Bash)\nDESCRIPTION: This command uses the `nginx-meshctl top` tool to display traffic metrics for a specified deployment (in this case, `deploy/egress-driver`). It is used to check if traffic is flowing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl top deploy/egress-driver\n```\n\n----------------------------------------\n\nTITLE: Verifying NGINX Installation on Ubuntu\nDESCRIPTION: This command checks the installed version of NGINX using the nginx command-line tool. It provides a quick way to confirm that NGINX has been successfully installed and to check the version number.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_20\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx -v\n```\n\n----------------------------------------\n\nTITLE: Send traffic to the modified Headers application - Shell\nDESCRIPTION: This shell command sends a curl request to the '/headers' endpoint of the 'cafe.example.com' application. It resolves the hostname to the specified gateway IP and port to verify the modified response headers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\ncurl -i --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/headers\n```\n\n----------------------------------------\n\nTITLE: Restore NGINX Controller Config DB from Specific Backup (Bash)\nDESCRIPTION: This command restores the embedded NGINX Controller config database from a specific backup file. The `<filename>` argument specifies the path to the backup file. This command requires the filename of the backup file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-embedded-config-db.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh backup restore <filename>\n```\n\n----------------------------------------\n\nTITLE: Configure Terraform Provider for AWS Credentials\nDESCRIPTION: This snippet configures the AWS provider in Terraform, specifying the AWS region, access key, and secret key. Replace the empty strings for `access_key` and `secret_key` with your AWS credentials. The `region` should be set to the AWS region where you want to deploy the infrastructure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-network-load-balancer.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nprovider \"aws\" {\n  region = \"us-west-1\"\n  access_key = \"\"\n  secret_key = \"\"\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling App Protect WAF\nDESCRIPTION: This command enables Nginx App Protect WAF within an http/server/location context in the nginx.conf file. This activates the WAF rules for a specific location. Requires the App Protect WAF module to be loaded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\napp_protect_enable on;\n```\n\n----------------------------------------\n\nTITLE: Include OWASP CRS Rules in Nginx Configuration\nDESCRIPTION: This snippet adds Include directives in the NGINX ModSecurity WAF configuration file to load the OWASP CRS configuration and rule sets. It includes the main ModSecurity configuration, CRS setup, and various rule files for different attack types.  It requires ModSecurity to be installed and configured, and the OWASP CRS files to be placed in /usr/local/owasp-modsecurity-crs-3.0.2.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\n# Include the recommended configuration\nInclude /etc/nginx/modsec/modsecurity.conf\n# OWASP CRS v3 rules\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/crs-setup.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-901-INITIALIZATION.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-905-COMMON-EXCEPTIONS.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-910-IP-REPUTATION.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-911-METHOD-ENFORCEMENT.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-912-DOS-PROTECTION.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-913-SCANNER-DETECTION.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-921-PROTOCOL-ATTACK.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-930-APPLICATION-ATTACK-LFI.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-931-APPLICATION-ATTACK-RFI.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-933-APPLICATION-ATTACK-PHP.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-941-APPLICATION-ATTACK-XSS.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-943-APPLICATION-ATTACK-SESSION-FIXATION.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/REQUEST-949-BLOCKING-EVALUATION.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/RESPONSE-950-DATA-LEAKAGES.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/RESPONSE-951-DATA-LEAKAGES-SQL.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/RESPONSE-952-DATA-LEAKAGES-JAVA.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/RESPONSE-953-DATA-LEAKAGES-PHP.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/RESPONSE-954-DATA-LEAKAGES-IIS.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/RESPONSE-959-BLOCKING-EVALUATION.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/RESPONSE-980-CORRELATION.conf\nInclude /usr/local/owasp-modsecurity-crs-3.0.2/rules/RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf\n```\n\n----------------------------------------\n\nTITLE: Reloading NGINX Configuration\nDESCRIPTION: These commands reload the NGINX configuration without downtime.  The first uses the nginx command-line tool, and the second uses the service command.  Both achieve the same result: applying the new configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_22\n\nLANGUAGE: none\nCODE:\n```\nroot# nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Configuring PHP-FPM Socket Ownership\nDESCRIPTION: These directives configure the ownership of the PHP-FPM listen socket. Setting `listen.owner` and `listen.group` to the user under which Nginx and NGINX Amplify Agent run ensures that NGINX Amplify Agent can access the PHP-FPM pool socket to collect metrics. `listen.mode` sets the permissions on the socket.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/other-metrics.md#_snippet_3\n\nLANGUAGE: text\nCODE:\n```\nlisten.owner = www-data\nlisten.group = www-data\nlisten.mode = 0660\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX ModSecurity WAF on Debian and Ubuntu\nDESCRIPTION: This snippet shows how to install the NGINX ModSecurity WAF module package on Debian and Ubuntu using the `apt` package manager. It first updates the package list and then installs the specified module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginx-waf.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-modsecurity\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Blocks for Exchange Applications in Nginx\nDESCRIPTION: This snippet configures multiple upstream blocks in the 'http' block of Nginx configuration for different Exchange applications. Each upstream block defines the servers (CAS) to which traffic will be proxied, along with the use of NTLM authentication and zone configuration.  The 'sticky' directive is used in the exchange-rpc upstream for session persistence.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_42\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream exchange {\n    zone exchange-general 64k;\n    ntlm;\n\n    server 10.0.0.237:443; # Replace with IP address of a CAS\n    server 10.0.0.238:443; # Replace with IP address of a CAS\n}\n\nupstream exchange-activesync {\n    zone exchange-activesync 64k;\n    ntlm;\n\n    server 10.0.0.237:443;  # Replace with IP address of a CAS\n    server 10.0.0.238:443;  # Replace with IP address of a CAS\n}\n\nupstream exchange-ecp {\n    zone exchange-ecp 64k;\n    ntlm;\n\n    server 10.0.0.237:443;  # Replace with IP address of a CAS\n    server 10.0.0.238:443;  # Replace with IP address of a CAS\n}\n\nupstream exchange-mapi {\n    zone exchange-mapi 64k;\n    ntlm;\n\n    server 10.0.0.237:443;  # Replace with IP address of a CAS\n    server 10.0.0.238:443;  # Replace with IP address of a CAS\n}\n\nupstream exchange-owa {\n    zone exchange-owa 64k;\n    ntlm;\n\n    server 10.0.0.237:443;  # Replace with IP address of a CAS\n    server 10.0.0.238:443;  # Replace with IP address of a CAS\n}\n\nupstream exchange-rpc {\n    zone exchange-rpc 64k;\n    ntlm;\n\n    server 10.0.0.237:443; # Replace with IP address of a CAS\n    server 10.0.0.238:443; # Replace with IP address of a CAS\n    sticky learn create=$remote_addr lookup=$remote_addr\n                 zone=client_sessions:10m timeout=3h;\n}\n```\n\n----------------------------------------\n\nTITLE: Run Ansible Playbook for NGINX Instance Manager\nDESCRIPTION: This shell command executes the Ansible playbook to install NGINX Instance Manager.  It uses the specified inventory file and playbook to configure and install the software on the target host. The -i flag specifies the path to the inventory file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/infrastructure-as-code/configuration.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\nansible-playbook -i <path-to-your-hostfile> nms-playbook.yml\n```\n\n----------------------------------------\n\nTITLE: Downloading and Extracting PCRE Library for NGINX\nDESCRIPTION: These commands download, extract, configure, build, and install the PCRE2 library.  This is required for regular expression support in NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_48\n\nLANGUAGE: shell\nCODE:\n```\nwget github.com/PCRE2Project/pcre2/releases/download/pcre2-10.43/pcre2-10.43.tar.gz\ntar -zxf pcre2-10.43.tar.gz\ncd pcre2-10.43\n./configure\nmake\nsudo make install\n```\n\n----------------------------------------\n\nTITLE: Filter Control Plane Logs for Errors\nDESCRIPTION: This command retrieves logs from the `nginx-gateway` container, then filters the logs to show only lines that contain the word `error`. Replace `<ngf-pod-name>` with the actual name of the NGINX Gateway Fabric pod.  This helps to quickly identify error messages within the control plane logs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n nginx-gateway logs <ngf-pod-name> -c nginx-gateway | grep error\n```\n\n----------------------------------------\n\nTITLE: Get Data Plane Container Logs\nDESCRIPTION: This command retrieves logs from the `nginx` container of a specified pod in the `nginx-gateway` namespace using `kubectl logs`. Replace `<ngf-pod-name>` with the actual name of the NGINX Gateway Fabric pod. These logs provide insights into data plane operations, including traffic processing and potential errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n nginx-gateway logs <ngf-pod-name> -c nginx\n```\n\n----------------------------------------\n\nTITLE: Starting NGINX Instance Manager Service (systemctl)\nDESCRIPTION: This command starts the NGINX Instance Manager service using `systemctl`. It ensures that the NGINX Instance Manager services are running before proceeding with backup or restore operations. It depends on `systemctl` being available on the system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl start nms\n```\n\n----------------------------------------\n\nTITLE: Add nginx-plus repo for SLES 15\nDESCRIPTION: This command adds the NGINX Plus repository for SLES 15 to the zypper package manager. It specifies the path to the certificate bundle for authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_20\n\nLANGUAGE: Shell\nCODE:\n```\nzypper addrepo -G -t yum -c \\\n\"https://pkgs.nginx.com/plus/sles/15?ssl_clientcert=/etc/ssl/nginx/nginx-repo-bundle.crt&ssl_verify=peer\" \\\nnginx-plus\n```\n\n----------------------------------------\n\nTITLE: Update NGINX Controller - Bash\nDESCRIPTION: This command runs the update script to update NGINX Controller to a newer version. This script is executed on each node in the cluster to ensure all nodes are running the same version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/resilient-cluster-aws.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./update.sh\n```\n\n----------------------------------------\n\nTITLE: Start bd_agent Service (Shell)\nDESCRIPTION: This command starts the `bd_agent` service, which is required for Controller ADC Agent 3.20.1 or Controller APIM Agent 3.19.2. It uses `su` to execute the command as the `nginx` user.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\n/bin/su -s /bin/bash -c '/opt/app_protect/bin/bd_agent &' nginx\n```\n\n----------------------------------------\n\nTITLE: Enabling Caching and Setting Cache Validity Nginx\nDESCRIPTION: Enables caching by defining the name of the shared memory zone for the cache and setting the cache validity for all responses to 1 hour. Caching is enabled within the 'server' block. This reduces load on the backend servers and improves response times for clients.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_30\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nproxy_cache cache_oracle;\nlocation / {\n     proxy_pass http://oracle_one;\n     proxy_set_header Host $host;\n     proxy_cache_valid any 1h;\n}\n```\n\n----------------------------------------\n\nTITLE: Verify redirect with curl for soda application (Shell)\nDESCRIPTION: This `curl` command sends a request to `http://cafe.example.com/soda` and includes the response headers to verify the redirect. The `--resolve` maps hostname to the specified IP and Port, and the `--include` option is used to show the response headers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/soda --include\n```\n\n----------------------------------------\n\nTITLE: Configuring app_protect_dos_monitor in Nginx\nDESCRIPTION: This snippet shows the correct configuration of the `app_protect_dos_monitor` directive within a Nginx server block.  The port configuration should match the port the server listens to, otherwise it could lead to false attack declarations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-2.4.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 8080;\n    location / {  app_protect_dos_monitor \"myservice.com:8080\";  }\n}\n```\n\n----------------------------------------\n\nTITLE: Bicep Template Certificate Dependency Configuration\nDESCRIPTION: This Bicep template demonstrates how to create dependencies between Nginx certificates using the `dependsOn` property. This ensures sequential deployment and avoids conflicts when attaching multiple certificates to the same Nginx deployment. This approach helps prevent errors related to concurrent updates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/known-issues.md#_snippet_5\n\nLANGUAGE: bicep\nCODE:\n```\nresource cert1 'NGINX.NGINXPLUS/nginxDeployments/certificates@2021-05-01-preview' = {\n  name: '${nginxDeploymentName}/cert1'\n  properties: {\n    certificateVirtualPath: certificateVirtualPath\n    keyVirtualPath: keyVirtualPath\n    keyVaultSecretId: keyVaultSecretId\n  }\n}\n\nresource cert2 'NGINX.NGINXPLUS/nginxDeployments/certificates@2021-05-01-preview' = {\n  name: '${nginxDeploymentName}/cert2'\n  properties: {\n    certificateVirtualPath: certificateVirtualPath\n    keyVirtualPath: keyVirtualPath\n    keyVaultSecretId: keyVaultSecretId\n  }\n  dependsOn: [cert1]\n}\n```\n\n----------------------------------------\n\nTITLE: Building NGINX Plus Ingress Controller Image\nDESCRIPTION: This command builds the NGINX Plus Ingress Controller image using a Dockerfile and sets a prefix for the repository name. It is crucial for preparing a custom NGINX Plus image for deployment, ensuring it is correctly configured for the target environment. The `DOCKERFILE` argument specifies the Dockerfile to use, and the `PREFIX` argument sets the repository name in the private container registry.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\nmake container DOCKERFILE=DockerfileForPlus PREFIX=nginx/nginx-plus-ingress\n```\n\n----------------------------------------\n\nTITLE: Configure Active Cookie Session Persistence in Nginx\nDESCRIPTION: This snippet adds the `sticky cookie` directive to the upstream block, enabling active-cookie session persistence. Nginx adds a cookie called `ngxcookie` to every new user session, recording a hash of the backend server that was selected for the first request from the user. The cookie expires when the browser restarts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_23\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream oracle {\n    zone oracle 64k;\n    server 172.31.11.210:8000 max_fails=0;\n    server 172.31.0.146:8000 max_fails=0;\n    sticky cookie ngxcookie;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS MX Record for Mail Delivery\nDESCRIPTION: This DNS MX record is essential for directing incoming email to the mail server.  It specifies the mail server's hostname and a priority value. Replace `mail.company.com` with the actual mail server hostname.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\ncompany.com.   300     MX    10  mail.company.com\n```\n\n----------------------------------------\n\nTITLE: Installing HTTP Substitutions Filter on Debian and Ubuntu\nDESCRIPTION: This shell command updates the package repositories and installs the `nginx-plus-module-subs-filter` package using the `apt` package manager. This is for Debian and Ubuntu distributions. `sudo` privileges are necessary.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/http-substitutions-filter.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-subs-filter\n```\n\n----------------------------------------\n\nTITLE: Dockerfile for Nginx App Protect OSS\nDESCRIPTION: This Dockerfile defines the steps to build an Nginx image with the Nginx App Protect WAF v5 module. It starts with an Alpine Linux base image, installs Nginx from the mainline repository, and configures the necessary dependencies and settings. Secrets are used for certificate and key management. The Dockerfile exposes port 80 and defines the default command to start Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-alpine.md#_snippet_0\n\nLANGUAGE: dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Supported OS_VER's are 3.16/3.17/3.19\nARG OS_VER=\"3.19\"\n\n# Base image\nFROM alpine:${OS_VER}\n\n# Install NGINX OSS and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/apk/cert.pem,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/apk/cert.key,mode=0644 \\\n    apk add openssl curl ca-certificates \\\n    && printf \"%s%s%s%s\\n\" \\\n        \"http://nginx.org/packages/mainline/alpine/v\" \\\n        `egrep -o '^[0-9]+\\.[0-9]+' /etc/alpine-release` \\\n        \"/main\" \\\n        | tee -a /etc/apk/repositories \\\n    && wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub \\\n    && printf \"https://pkgs.nginx.com/app-protect-x-oss/alpine/v`egrep -o '^[0-9]+\\.[0-9]+' /etc/alpine-release`/main\\n\" | \\\n        tee -a /etc/apk/repositories \\\n    && apk update \\\n    && apk add app-protect-module-oss \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log \\\n    && rm -rf /var/cache/apk/*\n\n# Expose port\nEXPOSE 80\n\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Token-Based Session Persistence NGINX\nDESCRIPTION: This snippet configures token-based session persistence in NGINX Plus using the `sticky learn` directive. It creates an upstream group named `test_pool` and configures session persistence based on the `jsessionid` cookie. The `zone` parameter defines a shared memory zone for storing session information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nupstream test_pool {\n    server 10.10.10.10:80;\n    server 10.10.10.20:80;\n    sticky learn create=$upstream_cookie_jsessionid\n                 lookup=$cookie_jsessionid\n                 zone=client_sessions:1m;\n}\n```\n\n----------------------------------------\n\nTITLE: Pushing NGINX Plus Image to Private Registry\nDESCRIPTION: This command pushes the tagged NGINX Plus image to your private Docker registry. Replace `<my-docker-registry>` with your registry’s path and `<my-version-tag>` with the version tag you assigned.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-plus-and-agent-docker.md#_snippet_6\n\nLANGUAGE: Shell\nCODE:\n```\ndocker push <my-docker-registry>/nginx-plus/agent:<my-version-tag>\n```\n\n----------------------------------------\n\nTITLE: Docker Pull NGINX Plus Image\nDESCRIPTION: This command pulls the NGINX Plus image for NGINX Gateway Fabric from the private registry. The version of the image is specified by `{{< version-ngf >}}`. Ensure you are logged in before running this command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/nginx-plus-jwt.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\ndocker pull private-registry.nginx.com/nginx-gateway-fabric/nginx-plus:{{< version-ngf >}}\n```\n\n----------------------------------------\n\nTITLE: Full Nginx Configuration Example\nDESCRIPTION: This is the complete Nginx configuration example, combining key-value zone definition, API configuration, and access control rules to implement dynamic IP denylisting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n # ...\n keyval_zone zone=one:1m type=ip state=one.keyval;\n keyval $remote_addr $target zone=one;\n\n server {\n  listen 80;\n  server_name www.example.com;\n\n  location /api {\n   api   write=on;\n\n   allow 127.0.0.1;\n   deny  all;\n\n   limit_except GET {\n    auth_basic \"NGINX Plus API\";\n    auth_basic_user_file /path/to/passwd/file;\n   }\n  }\n\n  if ($target) {\n   return 403;\n  }\n }\n}\n```\n\n----------------------------------------\n\nTITLE: Create Gateway via NGINX Controller REST API (JSON)\nDESCRIPTION: This snippet shows how to create a gateway using the NGINX Controller REST API. It sends a PUT request to the Gateways API endpoint, defining the gateway's metadata, ingress URIs, and instance group placement.  Replace `{{host}}` with the NGINX Controller hostname. It requires that an instance group has already been created and that you have the correct permissions in NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-containerized-instances.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"sportsgw\",\n        \"displayName\": \"sports GW\",\n        \"description\": \"sports.com\"\n    },\n    \"desiredState\": {\n        \"ingress\": {\n            \"uris\": {\n                \"http://api.dev.sports.com\": {\n                    \"matchMethod\": \"PREFIX\"\n                }\n            },\n            \"placement\": {\n                \"instanceGroupRefs\": [\n                    {\n                        \"ref\": \"/infrastructure/instance-groups/k8s-nginx-deploy\"\n                    }\n                ]\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX Plus Repository on Ubuntu (Shell)\nDESCRIPTION: This command adds the NGINX Plus repository to the APT sources list on Ubuntu systems. This allows the system to find and install packages from the NGINX Plus repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\nhttps://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" \\\n| sudo tee /etc/apt/sources.list.d/nginx-plus.list\n```\n\n----------------------------------------\n\nTITLE: Define Monitored Services in nms-notify-keepalived.sh\nDESCRIPTION: This snippet shows how to define the services that `keepalived` should monitor to determine if a node is operational. These services are checked by the script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ncheck_nms_services=(\n  \"clickhouse-server\"\n  \"nginx\"\n  \"nms-core\"\n  \"nms-dpm\"\n  \"nms-integrations\"\n  \"nms-ingestion\"\n)\n```\n\n----------------------------------------\n\nTITLE: Specify AD FS Client Credentials and Issuer\nDESCRIPTION: This snippet specifies the AD FS client ID, client secret, and issuer URL within the `oidc_provider` context. These values are obtained during the AD FS configuration.  Replace `<client_id>` and `<client_secret>` with the actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/active-directory-federation-services.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider adfs {\n        issuer        https://adfs.example.com/adfs;\n        client_id     <client_id>;\n        client_secret <client_secret>;\n    }\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Upgrade API Connectivity Manager Package (Debian)\nDESCRIPTION: This command upgrades the API Connectivity Manager package on Debian-based systems like Ubuntu and Debian. It uses the `apt-get install` command with the `-y` option to automatically answer 'yes' to any prompts and `-f` to fix broken dependencies. Replace `<version>` with the actual ACM version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm-offline.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get -y install -f /home/user/nms-api-connectivity-manager_<version>_amd64.deb\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Agent Repository - SLES - Shell\nDESCRIPTION: Adds the Nginx Agent repository to the zypper configuration on SLES. This enables zypper to locate and install the nginx-agent package. The command includes SSL client certificate and verification parameters.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper addrepo --refresh --check \\\n    'https://pkgs.nginx.com/nginx-agent/sles/$releasever_major?ssl_clientcert=/etc/ssl/nginx/nginx-repo-bundle.crt&ssl_verify=peer' nginx-agent\n```\n\n----------------------------------------\n\nTITLE: NGINX Plus Sticky Learn Session Persistence\nDESCRIPTION: This snippet configures the `sticky learn` method for session persistence in NGINX Plus.  NGINX learns the association between session identifiers (cookies in this example) and upstream servers. The `create` parameter specifies how new sessions are created (from the `EXAMPLECOOKIE` sent by the upstream), and the `lookup` parameter specifies how to search for existing sessions (in the `$cookie_examplecookie` sent by the client). A shared memory `zone` is used to store session information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n   server backend1.example.com;\n   server backend2.example.com;\n   sticky learn\n       create=$upstream_cookie_examplecookie\n       lookup=$cookie_examplecookie\n       zone=client_sessions:1m\n       timeout=1h;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring X-Xss-Protection header in Nginx\nDESCRIPTION: This snippet configures the X-Xss-Protection header to enable the browser's built-in cross-site scripting (XSS) filter. Setting it to '1; mode=block' enables the filter and instructs the browser to block the page from loading if an XSS attack is detected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-response-headers.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nadd_header X-Xss-Protection \"1; mode=block\" [always]\n```\n\n----------------------------------------\n\nTITLE: Example OpenID Connect Configuration (openid_configuration.conf)\nDESCRIPTION: This is an example configuration file for OpenID Connect, specifically tailored for use with Microsoft Entra. It defines mappings for various parameters needed for authentication, such as the groups claim, user email, authorization endpoint, token endpoint, and JWT key file.  It requires the `{tenant_key}` to be replaced with the actual tenant ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/microsoft-entra-setup.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\n# NGINX Instance Manager - OpenID Connect configuration\n# Created for v. 2.0\n# (c) NGINX, Inc. 2021\n\n# Enable when using OIDC with Microsoft Entra\nmap $http_authorization $groups_claim {\n    \"~^Bearer.*\" $jwt_claim_roles;\n    default $jwt_claim_groups;\n}\nmap $jwt_audience $jwt_aud_client {\n    default  $jwt_audience;\n    ~^api://(.+)$ $1;\n}\nmap $http_authorization $user_email {\n    \"~^Bearer.*\" '$jwt_aud_client@$oidc_domain';\n    default $jwt_claim_email;\n}\nmap $host $oidc_authz_endpoint {\n    default \"https://login.microsoftonline.com/{tenant_key}/oauth2/v2.0/authorize\";\n}\nmap $host $oidc_token_endpoint {\n    default \"https://login.microsoftonline.com/{tenant_key}/oauth2/v2.0/token\";\n}\nmap $host $oidc_jwt_keyfile {\n    default \"https://login.microsoftonline.com/{tenant_key}/discovery/v2.0/keys\";\n}\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration\nDESCRIPTION: This command reloads the Nginx configuration without downtime.  This ensures that the changes made to the configuration file are applied immediately without interrupting existing connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/onelogin.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Defining API Gateway Backend in JSON\nDESCRIPTION: This JSON snippet demonstrates how to define a backend service for an API Gateway. It includes configurations for the service name, version, label, context root, and upstream server details such as URL, maximum failed attempts, connection limits, fail timeout, and slow start parameters. These settings define how the API Gateway interacts with the upstream server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/publish-api-proxy.md#_snippet_5\n\nLANGUAGE: JSON\nCODE:\n```\n\"x-acm-backends\": [\n      {\n        \"serviceName\": \"pets-backend\",\n        \"serviceVersion\": \"pets-backend-v1\",\n        \"serviceLabel\": \"default\",\n        \"contextRoot\": \"/dev\",\n        \"upstreams\": [\n          {\n            \"url\": \"https://server.example.com\",\n            \"maxFails\": 10,\n            \"maxConnections\": 5,\n            \"failTimeout\": \"5s\",\n            \"slowStart\": \"10s\"\n          }\n\n```\n\n----------------------------------------\n\nTITLE: Update Nginx Configuration File Content using Azure CLI\nDESCRIPTION: This example demonstrates how to update the content of the first configuration file in an Nginx deployment using the Azure CLI. The `--files` parameter takes an array of file objects, where the `content` property is set to a base64 encoded string of the desired configuration. The command requires the deployment name, resource group, and configuration name as parameters.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configuration-azure-cli.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment configuration update --name default \\\n   --deployment-name myDeployment --resource-group myResourceGroup \\\n   --files [0].content=\"aHR0cCB7CiAgICB1cHN0cmVhbSBhcHAgewogICAgICAgIHpvbmUgIFxuICAgICAgICBhcHAgNjRrOwogICAgICAgIGxlYXN0X2Nvbm47CiAgICAgICAgbmV4dCBzZXJ2ZXIgaXQgaXMgbm90IGFwcGxpY2FibGUuCiAgICAgICAgc2VydmVyIDEwLjAuMS4gXG4gICAgICA0OjgwMDA7CiAgICB9CgogICAgc2VydmVyIHtcbiAgICAgICAgbGlzdGVuIDgwOwogICAgICAgIHNlcnZlcl9uYW1lICouZXhhbXBsZS5jb207CgogICAgICAgIGxvY2F0aW9uIC8gXG4gICAgICAgIHtcbiAgICAgICAgICAgIHByb3h5X3NldF9oZWFkZXIgSG9zdCAkaG9zdDtcbiAgICAgICAgICAgIHByb3h5X3NldF9oZWFkZXIgWC1SZWFsLUlQICRyZW1vdGVfYWRkcjsKICAgICAgICAgICAgbmV4dCBzZXJ2ZXIgaXQgaXMgbm90IGFwcGxpY2FibGUuCiAgICAgICAgICAgIHByb3h5X3NldF9oZWFkZXIgWC1Qcm94eS1BcHAIGFwcDsKICAgICAgICAgICAgbmV4dCBzZXJ2ZXIgaXQgaXMgbm90IGFwcGxpY2FibGUuCiAgICAgICAgICAgIHByb3h5X3NldF9oZWFkZXIgR2l0aHViLVJ1bi1JZCAwMDAwMDA7CiAgICAgICAgICAgIHByb3h5X2J1ZmZlcmluZyBvbjsKICAgICAgICAgICAgbmV4dCBzZXJ2ZXIgaXQgaXMgbm90IGFwcGxpY2FibGUuCiAgICAgICAgICAgIHByb3h5X2J1ZmZlcl9zaXplIDRrOwogICAgICAgICAgICBuZXh0IHNlcnZlciBpdCBpcyBub3QgYXBwbGljYWJsZS4KICAgICAgICAgICAgbmV4dCBzZXJ2ZXIgaXQgaXMgbm90IGFwcGxpY2FibGUuCiAgICAgICAgICAgIHByb3h5X2J1ZmZlcnMgOCA4azsKICAgICAgICAgICAgbmV4dCBzZXJ2ZXIgaXQgaXMgbm90IGFwcGxpY2FibGUuCiAgICAgICAgICAgIHByb3h5X3JlYWRfdGltZW91dCA2MHM7CiAgICAgICAgICAgIHByb3h5X3Bhc3MgaHR0cDovL2FwcDsKICAgICAgICAgICAgaGVhbHRoX2NoZWNrO1xuICAgICAgICB9CiAgICAgICAgXG4gICAgfQp9\"\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Service Mesh via Helm Repository\nDESCRIPTION: This command installs the NGINX Service Mesh from the specified Helm repository into the `nginx-mesh` namespace. It creates the namespace if it doesn't exist and waits until all resources are ready.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade-with-helm.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nhelm repo update\nhelm install nsm nginx-stable/nginx-service-mesh --namespace nginx-mesh --create-namespace --wait\n```\n\n----------------------------------------\n\nTITLE: Retrieve metric definitions via Azure Monitor API (Bash)\nDESCRIPTION: This `curl` command retrieves metric definitions within a specified namespace for an NGINXaaS deployment. It requires an authorization token, subscription ID, resource group, deployment name, and the target namespace.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/monitoring/enable-monitoring.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncurl --request GET --header \"Authorization: Bearer $TOKEN\" \"https://management.azure.com/subscriptions/12345678-abcd-98765432-abcdef012345/resourceGroups/my-nginx-rg/providers/NGINX.NGINXPLUS/nginxDeployments/my-nginx-dep/providers/microsoft.insights/metricDefinitions?metricnamespace=nginx%20connections%20statistics&api-version=2024-02-01\"\n```\n\n----------------------------------------\n\nTITLE: Enabling NGINX Access Logs\nDESCRIPTION: This code snippet demonstrates how to enable NGINX access logs by defining a custom log format and specifying the log file path. The `log_format` directive defines the format, and the `access_log` directive specifies the path to the log file and the format to use.  The log path is configured within /var/log/nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginxaas-azure/logging-config-access-logs.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n\tlog_format myfmt '$remote_addr - $remote_user [$time_local] '\n\t\t\t\t\t\t   '\"$request\" $status $body_bytes_sent '\n\t\t\t\t\t\t   '\"$http_referer\" \"$http_user_agent\" \"$gzip_ratio\"';\n\n\taccess_log /var/log/nginx/nginx-access.log myfmt;\n\t# ...\n}\n```\n\n----------------------------------------\n\nTITLE: Load NGINX Prometheus Module (Component) - JSON\nDESCRIPTION: This JSON snippet configures a component to expose Prometheus metrics. It uses `uriSnippets` to define a `location /metrics` block. The `js_content` directive calls the `prometheus.metrics` function from the imported JavaScript module, enabling the endpoint for metrics reporting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-snippets.md#_snippet_4\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"<gateway-name>\"\n    },\n    \"desiredState\": {\n        \"configSnippets\": {\n            \"uriSnippets\": [\n                {\n                    \"applicableUris\": [\n                        {\n                            \"uri\": \"/metrics\"\n                        }\n                    ],\n                    \"directives\": [\n                        {\n                            \"directive\":\"js_content\",\n                            \"args\": [\"prometheus.metrics\"]\n                        }\n                    ]\n                }\n            ]\n        },\n        \"ingress\": {\n            \"uris\": {\n                \"http://example.com:8020\": {}\n            },\n            \"placement\":  {\n                \"instanceRefs\": [\n                    {\n                        \"ref\": \"/infrastructure/locations/unspecified/instances/<instance-name>\"\n                    }\n                ]\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Apply Kubernetes Manifests\nDESCRIPTION: This shell command applies Kubernetes manifests from a specified directory.  It is used to create, update, or delete resources in the Kubernetes cluster based on the definitions in the YAML files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f /home/user/k8s\n```\n\n----------------------------------------\n\nTITLE: Verifying SPIRE Pods Deployment in NGINX Service Mesh\nDESCRIPTION: This bash command allows verification of the SPIRE Server and Agent pods deployment in the configured control plane namespace (default `nginx-mesh`). It checks whether the SPIRE Pods are running, expecting a single Server Pod and an Agent Pod for each Kubernetes Node, thus confirming a proper installation of the security components.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/secure-traffic-mtls.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get pods -n nginx-mesh\nNAME                READY   STATUS    RESTARTS   AGE\n...\nspire-agent-mb9jv   1/1     Running   0          24h\nspire-server-0      2/2     Running   0          24h\n...\n```\n\n----------------------------------------\n\nTITLE: Get Key Vault Resource ID - Azure CLI\nDESCRIPTION: This snippet retrieves the resource ID of a key vault using the Azure CLI.  It depends on the `KV_NAME` and `KV_RESOURCE_GROUP` environment variables being set.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nkey_vault_id=$(az keyvault show --name $KV_NAME \\\n      --resource-group $KV_RESOURCE_GROUP \\\n      --query id --output tsv)\n```\n\n----------------------------------------\n\nTITLE: Enable ModSecurity in Nginx Proxy Configuration\nDESCRIPTION: This Nginx configuration enables ModSecurity for the reverse proxy. It turns ModSecurity on and specifies the location of the ModSecurity rules file. This configuration protects the application by enabling the ModSecurity WAF.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80;\n    modsecurity on;\n    modsecurity_rules_file /etc/nginx/modsec/main.conf;\n    location / {\n        proxy_pass http://localhost:8085;\n        proxy_set_header Host $host;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Under Attack Traffic Summary Shell Example\nDESCRIPTION: This snippet demonstrates a traffic summary report while 'Under Attack' as reported by NGINX App Protect DoS. It illustrates elevated incoming DPS and RPS values, highlighting the ongoing attack. The snippet includes statistics for mitigated bad actors and signature-based mitigations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/security-log.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ndate_time=\"Oct 05 2021 08:02:35\",\nproduct=\"app-protect-dos\",\nproduct_version=\"25+1.78.0-1.el7.ngx\",\nunit_hostname=\"localhost.localdomain\",\ninstance_id=\"129c76\",\nvs_name=\"example.com/\",\ndos_attack_id=\"1\",\nattack_event=\"Under Attack\",\nstress_level=\"0.50\",\nlearning_confidence=\"Ready\",\nbaseline_dps=\"12\",\nincoming_dps=\"893\",\nincoming_rps=\"893\",\nsuccessful_tps=\"12\",\nallowlist_rps=\"1\",\nunsuccessful_rps=\"0\",\nincoming_datagrams=\"87823\",\nincoming_requests=\"87823\",\nallowlist_requests=\"1523\",\nsuccessful_responses=\"5736\",\nunsuccessful_requests=\"0\",\nactive_connections=\"1\",\nthreshold_dps=\"92.40\",\nthreshold_conns=\"92.40\",\nmitigated_bad_actors=\"0\",\nmitigated_by_signatures=\"75137\",\nmitigated_by_global_rate=\"2861\",\nmitigated_bad_actors_l4=\"62788\",\nmitigated_slow=\"0\",\nredirect_global=\"2861\",\nredirect_bad_actor=\"0\",\nredirect_signature=\"75137\",\nredirect_slow=\"0\",\nchallenge_global=\"0\",\nchallenge_bad_actor=\"0\",\nchallenge_signature=\"0\",\nchallenge_slow=\"0\",\nblock_global=\"0\",\nblock_bad_actor=\"0\",\nblock_signature=\"0\",\nblock_slow=\"0\",\nmitigated_connections=\"0\",\nmitigated_bad_actors_rps=\"0\",\nmitigated_by_signatures_rps=\"879\",\nmitigated_by_global_rate_rps=\"0\",\nmitigated_bad_actors_l4_rps=\"0\",\nmitigated_slow_rps=\"0\",\nredirect_global_rps=\"0\",\nredirect_bad_actor_rps=\"0\",\nredirect_signature_rps=\"879\",\nredirect_slow_rps=\"0\",\nchallenge_global_rps=\"0\",\nchallenge_bad_actor_rps=\"0\",\nchallenge_signature_rps=\"0\",\nchallenge_slow_rps=\"0\",\nblock_global_rps=\"0\",\nblock_bad_actor_rps=\"0\",\nblock_signature_rps=\"0\",\nblock_slow_rps=\"0\",\nmitigated_connections_rps=\"0\"\n```\n\n----------------------------------------\n\nTITLE: No Attack Traffic Summary Shell Example\nDESCRIPTION: This snippet illustrates a traffic summary report indicating 'No Attack' from NGINX App Protect DoS. It showcases the baseline traffic metrics, incoming requests, successful transactions, and active connections under normal operation, including values for various mitigation methods.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/security-log.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ndate_time=\"Oct 05 2021 07:54:29\",\nproduct=\"app-protect-dos\",\nproduct_version=\"25+1.78.0-1.el7.ngx\",\nunit_hostname=\"localhost.localdomain\",\ninstance_id=\"129c76\",\nvs_name=\"example.com/\",\ndos_attack_id=\"0\",\nattack_event=\"No Attack\",\nstress_level=\"0.50\",\nlearning_confidence=\"Not ready\",\nbaseline_dps=\"19\",\nincoming_dps=\"9\",\nincoming_rps=\"9\",\nsuccessful_tps=\"10\",\nallowlist_rps=\"1\",\nunsuccessful_rps=\"0\",\nincoming_datagrams=\"678\",\nincoming_requests=\"678\",\nallowlist_requests=\"52\",\nsuccessful_responses=\"678\",\nunsuccessful_requests=\"0\",\nactive_connections=\"0\",\nthreshold_dps=\"2121.60\",\nthreshold_conns=\"2121.60\",\nmitigated_bad_actors=\"0\",\nmitigated_by_signatures=\"0\",\nmitigated_by_global_rate=\"0\",\nmitigated_bad_actors_l4=\"0\",\nmitigated_slow=\"0\",\nredirect_global=\"0\",\nredirect_bad_actor=\"0\",\nredirect_signature=\"0\",\nredirect_slow=\"0\",\nchallenge_global=\"0\",\nchallenge_bad_actor=\"0\",\nchallenge_signature=\"0\",\nchallenge_slow=\"0\",\nblock_global=\"0\",\nblock_bad_actor=\"0\",\nblock_signature=\"0\",\nblock_slow=\"0\",\nmitigated_connections=\"0\",\nmitigated_bad_actors_rps=\"0\",\nmitigated_by_signatures_rps=\"0\",\nmitigated_by_global_rate_rps=\"0\",\nmitigated_bad_actors_l4_rps=\"0\",\nmitigated_slow_rps=\"0\",\nredirect_global_rps=\"0\",\nredirect_bad_actor_rps=\"0\",\nredirect_signature_rps=\"0\",\nredirect_slow_rps=\"0\",\nchallenge_global_rps=\"0\",\nchallenge_bad_actor_rps=\"0\",\nchallenge_signature_rps=\"0\",\nchallenge_slow_rps=\"0\",\nblock_global_rps=\"0\",\nblock_bad_actor_rps=\"0\",\nblock_signature_rps=\"0\",\nblock_slow_rps=\"0\",\nmitigated_connections_rps=\"0\"\n```\n\n----------------------------------------\n\nTITLE: Attack Ended Notification Shell Example\nDESCRIPTION: This snippet shows an example of an 'Attack Ended' notification from NGINX App Protect DoS. Similar to the 'Attack Started' notification, it includes parameters like date and time, product information, and attack ID, but also provides information on mitigated threats and updated traffic statistics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/security-log.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ndate_time=\"Oct 05 2021 08:06:21\",\nproduct=\"app-protect-dos\",\nproduct_version=\"25+1.78.0-1.el7.ngx\",\nunit_hostname=\"localhost.localdomain\",\ninstance_id=\"129c76\",\nvs_name=\"example.com/\",\ndos_attack_id=\"1\",\nattack_event=\"Attack ended\",\nstress_level=\"0.50\",\nlearning_confidence=\"Ready\",\nbaseline_dps=\"12\",\nincoming_dps=\"0\",\nincoming_rps=\"0\",\nsuccessful_tps=\"0\",\nallowlist_rps=\"0\",\nunsuccessful_rps=\"0\",\nincoming_datagrams=\"226566\",\nincoming_requests=\"226566\",\nallowlist_requests=\"1632\",\nsuccessful_responses=\"7760\",\nunsuccessful_requests=\"0\",\nactive_connections=\"0\",\nthreshold_dps=\"2121.60\",\nthreshold_conns=\"2121.60\",\nmitigated_bad_actors=\"94488\",\nmitigated_by_signatures=\"117361\",\nmitigated_by_global_rate=\"2861\",\nmitigated_bad_actors_l4=\"62788\",\nmitigated_slow=\"0\",\nredirect_global=\"2861\",\nredirect_bad_actor=\"94488\",\nredirect_signature=\"117361\",\nredirect_slow=\"0\",\nchallenge_global=\"0\",\nchallenge_bad_actor=\"0\",\nchallenge_signature=\"0\",\nchallenge_slow=\"0\",\nblock_global=\"0\",\nblock_bad_actor=\"0\",\nblock_signature=\"0\",\nblock_slow=\"0\",\nmitigated_connections=\"0\",\nmitigated_bad_actors_rps=\"0\",\nmitigated_by_signatures_rps=\"0\",\nmitigated_by_global_rate_rps=\"0\",\nmitigated_bad_actors_l4_rps=\"0\",\nmitigated_slow_rps=\"0\",\nredirect_global_rps=\"0\",\nredirect_bad_actor_rps=\"0\",\nredirect_signature_rps=\"0\",\nredirect_slow_rps=\"0\",\nchallenge_global_rps=\"0\",\nchallenge_bad_actor_rps=\"0\",\nchallenge_signature_rps=\"0\",\nchallenge_slow_rps=\"0\",\nblock_global_rps=\"0\",\nblock_bad_actor_rps=\"0\",\nblock_signature_rps=\"0\",\nblock_slow_rps=\"0\",\nmitigated_connections_rps=\"0\"\n```\n\n----------------------------------------\n\nTITLE: Restarting NGINX App Protect on Debian/Ubuntu\nDESCRIPTION: This snippet demonstrates how to restart NGINX App Protect on Debian and Ubuntu systems using systemctl. This applies the updates after installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/admin-guide/upgrade-nap-waf.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx-app-protect\n```\n\n----------------------------------------\n\nTITLE: Check REST Interface Configuration\nDESCRIPTION: Uses the `curl` command to test if the REST interface is correctly configured by targeting the `/nginx/` endpoint. A successful configuration should return a JSON object with NGINX metadata.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ncurl 0.0.0.0:8038/nginx/\n```\n\n----------------------------------------\n\nTITLE: KQL Query for Blocked Requests by URL\nDESCRIPTION: This KQL query retrieves blocked requests by URL from NGINX security logs in Azure Log Analytics. It extracts the URL and summarizes the count of requests by URL and time.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/enable-logging.md#_snippet_7\n\nLANGUAGE: kql\nCODE:\n```\nNGXSecurityLogs\n| extend JSONLog = extract(@\"json_log\\s*=\\s*\\\"({.*?})\\\"\", 1, Message)\n| extend Log = parse_json(replace_string(JSONLog, '\"\"', '\"'))\n| where Log.enforcementAction == \"block\"\n| project URL = tostring(Log.url), TimeGenerated\n| summarize count() by URL, bin(TimeGenerated, 1m)\n| render timechart\n```\n\n----------------------------------------\n\nTITLE: Opening NGINX configuration file\nDESCRIPTION: Opens the NGINX configuration file using `vi` editor. This command assumes the configuration file is located at `/usr/local/etc/nginx/nginx.conf`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_21\n\nLANGUAGE: shell\nCODE:\n```\nsudo vi /usr/local/etc/nginx/nginx.conf\n```\n\n----------------------------------------\n\nTITLE: Loading Brotli Modules in Nginx Configuration\nDESCRIPTION: This configuration snippet shows how to load the Brotli filter and static modules in the main context of the Nginx configuration file (nginx.conf).  It uses the `load_module` directive to enable dynamic loading of the modules.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/brotli.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_brotli_filter_module.so; # for compressing responses on-the-fly\nload_module modules/ngx_http_brotli_static_module.so; # for serving pre-compressed files\n\nhttp {\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP Compliance Violations in Policy JSON\nDESCRIPTION: This JSON snippet demonstrates configuring HTTP compliance violations. It enables the `VIOL_HTTP_PROTOCOL` violation and configures its sub-violations, such as checking for header names with no header value, chunked requests with Content-Length header, and the maximum number of parameters and headers.  The `maxParams` and `maxHeaders` properties can be adjusted.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/policy-authoring-and-tuning.md#_snippet_5\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"policy_name\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_HTTP_PROTOCOL\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ],\n            \"http-protocols\": [\n                {\n                    \"description\": \"Header name with no header value\",\n                    \"enabled\": true\n                },\n                {\n                    \"description\": \"Chunked request with Content-Length header\",\n                    \"enabled\": true\n                },\n                {\n                    \"description\": \"Check maximum number of parameters\",\n                    \"enabled\": true,\n                    \"maxParams\": 5\n                },\n                {\n                    \"description\": \"Check maximum number of headers\",\n                    \"enabled\": true,\n                    \"maxHeaders\": 20\n                },\n                {\n                    \"description\": \"Body in GET or HEAD requests\",\n                    \"enabled\": true\n                },\n                {\n                    \"description\": \"Bad multipart/form-data request parsing\",\n                    \"enabled\": true\n                },\n                {\n                    \"description\": \"Bad multipart parameters parsing\",\n                    \"enabled\": true\n                },\n                {\n                    \"description\": \"Unescaped space in URL\",\n                    \"enabled\": true\n                }\n            ]\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Perl Module (Alpine)\nDESCRIPTION: This shell script installs the `nginx-plus-module-perl` package on Alpine Linux. It uses the `apk` package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/perl.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-perl\n```\n\n----------------------------------------\n\nTITLE: Get Outlook Anywhere Identity PowerShell\nDESCRIPTION: This command retrieves identity information for the Set-OutlookAnywhere command using PowerShell. It pipes the output to 'fl' (formatted list) to display all properties.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_4\n\nLANGUAGE: PowerShell\nCODE:\n```\nC:\\> Get-OutlookAnywhere | fl\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration\nDESCRIPTION: This shell command reloads the Nginx configuration without downtime. It uses the `nginx -s reload` command, which signals the Nginx master process to reload the configuration. This applies any changes made to the configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/headers-more.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: YAML Snippet for ImagePullSecrets\nDESCRIPTION: This YAML snippet demonstrates how to inject `imagePullSecrets` into a Pod's specification. This ensures that Kubernetes will use the specified secret to pull images from the private registry. The `name` refers to the Kubernetes Secret containing the registry credentials.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/private-registry.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\nimagePullSecrets:\n- name: nginx-mesh-registry-key\n```\n\n----------------------------------------\n\nTITLE: Create NGINX Agent Directory - Shell\nDESCRIPTION: This command creates the `/etc/nginx-agent/` directory and copies the `nginx-agent.conf` file into it.  It requires `sudo` privileges and assumes the existence of a `nginx-agent.conf` file in the project root directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/getting-started.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir /etc/nginx-agent\nsudo cp <project_root_directory>/nginx-agent.conf /etc/nginx-agent/\n```\n\n----------------------------------------\n\nTITLE: Fetching NGINX Plus Unprivileged Installation Script\nDESCRIPTION: This command downloads the `ngxunprivinst.sh` script from the specified GitHub URL using `wget`. This script is used to install NGINX Plus in an unprivileged mode.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_41\n\nLANGUAGE: shell\nCODE:\n```\nwget https://raw.githubusercontent.com/nginxinc/nginx-plus-install-tools/main/ngxunprivinst.sh\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration\nDESCRIPTION: This shell command gracefully reloads the NGINX configuration, applying any changes made to the configuration file without interrupting service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Instance Manager on Ubuntu (OSS)\nDESCRIPTION: This command executes the `install-nim-bundle.sh` script to install NGINX Instance Manager on Ubuntu 24.04 using the latest version of NGINX OSS. It assumes the repository keys are in the default `/etc/ssl/nginx` directory and requires the path to a JWT license file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo bash install-nim-bundle.sh -n latest -d ubuntu24.04 -j /path/to/license.jwt\n```\n\n----------------------------------------\n\nTITLE: Configuring Log Formatting with JSON in NGINX App Protect WAF\nDESCRIPTION: This JSON snippet configures the format of security logs, including escaping characters, list prefixes, delimiters, and suffixes.  It customizes how lists and specific characters are represented in the log messages. The `filter` specifies which request types to log, and `content` defines the log format.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/logging-overview/security-log.md#_snippet_6\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filter\": {\n        \"request_type\": \"all\"\n    },\n    \"content\": {\n        \"format\": \"default\",\n        \"max_request_size\": \"2k\",\n        \"max_message_size\": \"32k\",\n        \"escaping_characters\": [\n      \t    {\n                \"from\": \"/\",\n                \"to\": \"|\"\n            }\n        ],\n        \"list_prefix\": \"[\",\n        \"list_delimiter\": \"::\",\n        \"list_suffix\": \"]\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling SSL Session Reuse for Nginx TCP Proxy\nDESCRIPTION: This configuration enables SSL session reuse to reduce CPU overhead by using abbreviated handshakes for subsequent connections. The `proxy_ssl_session_reuse` directive controls this behavior.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-tcp-traffic-upstream.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_ssl_session_reuse on;\n```\n\n----------------------------------------\n\nTITLE: Load njs Module in NGINX Configuration\nDESCRIPTION: This snippet shows how to load the NGINX JavaScript module (njs) within the main configuration context of NGINX Plus. This is a prerequisite for using njs scripts to handle the OpenID Connect flow with Auth0.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/auth0.md#_snippet_0\n\nLANGUAGE: Nginx configuration file\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\n```\n\n----------------------------------------\n\nTITLE: Run NGINX Controller Installation Script\nDESCRIPTION: These commands change the directory to the extracted installer directory and then run the installation script. The script will guide the user through the installation process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./install.sh\n```\n\n----------------------------------------\n\nTITLE: Describing HTTPRoute Status (kubectl)\nDESCRIPTION: This command uses `kubectl` to describe the status of a Kubernetes HTTPRoute resource named 'coffee'. The output shows the conditions related to the route's acceptance and reference resolution, along with the controller name and parent Gateway reference. This command helps ensure the HTTPRoute is correctly configured and associated with the Gateway.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/routing-traffic-to-your-app.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe httproute coffee\n```\n\n----------------------------------------\n\nTITLE: Checking Nginx Plus status on EC2 - Nginx\nDESCRIPTION: This command allows you to check the status of the NGINX Plus server by logging into the EC2 instance and running it. It utilizes the init.d script for Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus-amazon-web-services.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\n/etc/init.d/nginx status\n```\n\n----------------------------------------\n\nTITLE: NGINX Upstream Configuration\nDESCRIPTION: This NGINX configuration defines an upstream named 'my-service' with a shared memory zone and a state file.  No servers are defined directly in the upstream block, as they will be managed dynamically by the NLK controller. The configuration also includes a server block that proxies requests to the 'my-service' upstream.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/loadbalancer-kubernetes.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n  upstream my-service {\n    # NOTE: There are no servers defined here as they will be managed dynamically by the controller.\n    zone my-service 64K;          # required\n    state /tmp/my-service.state;  # required\n  }\n\n  server {\n    listen 80;\n    location / {\n        proxy_pass http://my-service;\n    }\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Applying LoadBalancer Service Manifest\nDESCRIPTION: This command applies a Kubernetes manifest file to create a `LoadBalancer` service of type NLB. It uses `kubectl apply` with the `-f` flag to specify the manifest file location. It automates the creation of necessary AWS resources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_5\n\nLANGUAGE: Shell\nCODE:\n```\nkubectl apply -f deployments/service/loadbalancer-aws-elb.yaml\n```\n\n----------------------------------------\n\nTITLE: Installing Nginx njs Module (CentOS/RHEL/Oracle Linux)\nDESCRIPTION: This command installs the NGINX JavaScript module (njs) on CentOS, RHEL, and Oracle Linux systems. njs is required for handling the interaction between NGINX Plus and the Identity Provider (IdP) in the SSO configuration. The command uses the yum package manager with sudo privileges to install the nginx-plus-module-njs package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/active-directory-federation-services.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\nsudo yum install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Install and Run Echo Server (shell)\nDESCRIPTION: This snippet shows how to install and run the Echo Server using Go. It first configures the Go environment by disabling modules temporarily, then downloads, installs, and executes the Echo Server, which is useful for testing HTTP proxies. It configures the server to listen on port 10000 and log HTTP headers and bodies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/enable-metrics.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ngo env -w GO111MODULE=off\ngo get -u github.com/jmalloc/echo-server/...\nPORT=10000 LOG_HTTP_BODY=true LOG_HTTP_HEADERS=true echo-server\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Open Source Packages on Amazon Linux 2023\nDESCRIPTION: These commands create a directory, navigate into it, and download NGINX Open Source packages, including dependencies using `repotrack`. Repotrack is used to download packages and their dependencies from a yum repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_17\n\nLANGUAGE: script\nCODE:\n```\nsudo mkdir /etc/packages/\ncd /etc/packages/\nsudo repotrack --forcearch x86_64 app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Example Policy Definition (retries)\nDESCRIPTION: This YAML defines an example policy named 'retries' that targets an HTTPRoute named 'foo' and sets the number of retries to 10. It demonstrates how to define a custom policy in NGINX Gateway Fabric to configure specific features.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/custom-policies.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: gateway.nginx.org/v1alpha1\nkind: ExamplePolicy\nmetadata:\n  name: retries\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: foo\n  retries: 10\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTPS Virtual Server\nDESCRIPTION: Configures a virtual server to listen for HTTPS traffic on port 443.  It specifies the SSL certificate and key, sets up SSL session caching, and enables server-preferred ciphers for enhanced security.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nserver {\n    listen 443 ssl;\n    server_name example.com;\n\n    ssl_certificate     /etc/nginx/ssl/example.com.crt;\n    ssl_certificate_key /etc/nginx/ssl/example.com.key;\n    ssl_session_cache   shared:SSL:1m;\n    ssl_prefer_server_ciphers on;\n}\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Instance Manager (DEB) - Bash\nDESCRIPTION: Upgrades the NGINX Instance Manager package on Debian and Ubuntu systems using the `apt-get` command. The `-y` flag automatically answers yes to prompts. The `-f` flag attempts to correct broken dependencies. After upgrading, it restarts the nms and nginx services.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide-deprecated.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get -y install -f /home/user/nms-instance-manager_<version>_amd64.deb\nsudo systemctl restart nms\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Install prerequisites for Nginx repository setup on Debian\nDESCRIPTION: This command installs the necessary packages for setting up the official Nginx repository on Debian systems, including curl, gnupg2, ca-certificates, lsb-release and debian-archive-keyring for key management and repository access. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt install curl gnupg2 ca-certificates lsb-release debian-archive-keyring\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx Configuration\nDESCRIPTION: This command reloads the Nginx configuration, applying any changes made to the `nginx.conf` file, including the newly loaded GeoIP2 modules. This ensures that the Nginx instance uses the updated configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip2.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: IAM Policy for Elastic IP Address Management in AWS - JSON\nDESCRIPTION: This IAM policy allows an EC2 instance to associate and disassociate Elastic IP addresses, as well as describe instances and addresses. This is required for the HA scripts to function correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-keepalived.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:AssociateAddress\",\n                \"ec2:DescribeInstances\",\n                \"ec2:DescribeAddresses\",\n                \"ec2:DisassociateAddress\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Cache Purge Condition in Nginx\nDESCRIPTION: This snippet configures the proxy_cache_purge directive to specify a condition for cache‑purge requests. It references the $purge_method variable defined in the previous snippet. This allows Nginx to identify and process cache purge requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen      80;\n    server_name www.example.com;\n\n    location / {\n        proxy_pass  https://localhost:8002;\n        proxy_cache mycache;\n\n        proxy_cache_purge $purge_method;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Setting variable based on subrequest result\nDESCRIPTION: This configuration uses the `auth_request_set` directive to set a variable (`$auth_status`) based on the result of the authentication subrequest. `$upstream_status` captures the upstream status code.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-subrequest-authentication.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /private/ {\n    auth_request        /auth;\n    auth_request_set $auth_status $upstream_status;\n}\n```\n\n----------------------------------------\n\nTITLE: Restart Nginx Agent (Bash)\nDESCRIPTION: This command restarts the NGINX Agent service after modifying the `agent-dynamic.conf` file. This ensures that the changes made to the configuration are applied. Requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/manage-instance-groups.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Configuring Monitor URI in NGINX\nDESCRIPTION: This snippet shows how to configure the monitor URI using the `app_protect_dos_monitor` directive. The URI specifies the endpoint used for monitoring the stress level of the protected object, ensuring accurate health checks. Protocol, timeout, and proxy_protocol arguments can be configured for optimal monitoring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nlisten 80;\nserver_name serv;\n\nlocation / {\n    # Protected Object is defined here\n    app_protect_dos_monitor uri=http://serv:80/;\n}\n```\n\n----------------------------------------\n\nTITLE: Update Package Index Files (Ubuntu/Debian - Bash)\nDESCRIPTION: Updates the APT package index files.  It uses the `apt-get update` command to synchronize the package index files from their sources. This command is necessary before installing any new package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\napt-get update\n```\n\n----------------------------------------\n\nTITLE: Configure CSRF Protection with Allowed Origin for a URL - JSON\nDESCRIPTION: This JSON snippet configures CSRF protection in NGINX App Protect WAF by enabling it globally, deleting the default wildcard CSRF URL, defining a new custom CSRF URL, defining a policy-wide hostname domain with subdomains, adding a custom URL where CSRF enforcement is enabled, and defining a custom origin for this URL. The `VIOL_CSRF` is assumed to be already in 'Alarm' mode in the default policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/csrf-protection.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"applicationLanguage\": \"utf-8\",\n        \"name\": \"example_3\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"csrf-protection\": {\n            \"enabled\": true\n        },\n        \"csrf-urls\": [\n            {\n                \"$action\": \"delete\",\n                \"method\": \"POST\",\n                \"url\": \"*\"\n            },\n            {\n                \"enforcementAction\": \"verify-origin\",\n                \"method\": \"POST\",\n                \"url\": \"/csrfurl\"\n            }\n        ],\n        \"host-names\": [\n            {\n                \"name\": \"example.com\",\n                \"includeSubdomains\": true\n            }\n        ],\n        \"urls\": [\n            {\n                \"name\": \"/myurl\",\n                \"html5CrossOriginRequestsEnforcement\": {\n                    \"enforcementMode\": \"enforce\",\n                    \"crossDomainAllowedOrigin\": [\n                        {\n                            \"includeSubDomains\": false,\n                            \"originName\": \"foo.com\",\n                            \"originPort\": \"all\",\n                            \"originProtocol\": \"http/https\"\n                        }\n                    ]\n                }\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Raw Traffic Metrics Output (JSON)\nDESCRIPTION: Shows an example of the JSON output from the `kubectl get` command, including metrics such as latency and success/failure counts for traffic edges. This illustrates the structure of the data returned by the SMI metrics API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/smi-traffic-metrics.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"kind\": \"TrafficMetricsList\",\n  \"apiVersion\": \"metrics.smi-spec.io/v1alpha1\",\n  \"metadata\": {\n    \"selfLink\": \"/apis/metrics.smi-spec.io/v1alpha1/namespaces/default/deployments/reviews-v3/edges\"\n  },\n  \"resource\": {\n    \"kind\": \"Deployment\",\n    \"namespace\": \"default\",\n    \"name\": \"reviews-v3\"\n  },\n  \"items\": [\n    {\n      \"kind\": \"TrafficMetrics\",\n      \"apiVersion\": \"metrics.smi-spec.io/v1alpha1\",\n      \"metadata\": {\n        \"name\": \"reviews-v3\",\n        \"namespace\": \"default\",\n        \"selfLink\": \"/apis/metrics.smi-spec.io/v1alpha1/namespaces/default/deployments/reviews-v3/edges\",\n        \"creationTimestamp\": \"2019-10-16T22:33:02Z\"\n      },\n      \"timestamp\": \"2019-10-16T22:33:02Z\",\n      \"window\": \"30s\",\n      \"resource\": {\n        \"kind\": \"Deployment\",\n        \"namespace\": \"default\",\n        \"name\": \"reviews-v3\"\n      },\n      \"edge\": {\n        \"direction\": \"to\",\n        \"resource\": {\n          \"kind\": \"Deployment\",\n          \"namespace\": \"default\",\n          \"name\": \"ratings-v1\"\n        }\n      },\n      \"metrics\": [\n        {\n          \"name\": \"p99_response_latency\",\n          \"unit\": \"ms\",\n          \"value\": \"2969m\"\n        },\n        {\n          \"name\": \"p90_response_latency\",\n          \"unit\": \"ms\",\n          \"value\": \"2700m\"\n        },\n        {\n          \"name\": \"p50_response_latency\",\n          \"unit\": \"ms\",\n          \"value\": \"1499m\"\n        },\n        {\n          \"name\": \"success_count\",\n          \"value\": \"9\"\n        },\n        {\n          \"name\": \"failure_count\",\n          \"value\": \"0\"\n        }\n      ]\n    },\n    {\n      \"kind\": \"TrafficMetrics\",\n      \"apiVersion\": \"metrics.smi-spec.io/v1alpha1\",\n      \"metadata\": {\n        \"name\": \"reviews-v3\",\n        \"namespace\": \"default\",\n        \"selfLink\": \"/apis/metrics.smi-spec.io/v1alpha1/namespaces/default/deployments/reviews-v3/edges\",\n        \"creationTimestamp\": \"2019-10-16T22:33:02Z\"\n      },\n      \"timestamp\": \"2019-10-16T22:33:02Z\",\n      \"window\": \"30s\",\n      \"resource\": {\n        \"kind\": \"Deployment\",\n        \"namespace\": \"default\",\n        \"name\": \"reviews-v3\"\n      },\n      \"edge\": {\n        \"direction\": \"from\",\n        \"resource\": {\n          \"kind\": \"Deployment\",\n          \"namespace\": \"default\",\n          \"name\": \"productpage-v1\"\n        }\n      },\n      \"metrics\": [\n        {\n          \"name\": \"p99_response_latency\",\n          \"unit\": \"ms\",\n          \"value\": \"29600m\"\n        },\n        {\n          \"name\": \"p90_response_latency\",\n          \"unit\": \"ms\",\n          \"value\": \"26\"\n        },\n        {\n          \"name\": \"p50_response_latency\",\n          \"unit\": \"ms\",\n          \"value\": \"13333m\"\n        },\n        {\n          \"name\": \"success_count\",\n          \"value\": \"11\"\n        },\n        {\n          \"name\": \"failure_count\",\n          \"value\": \"0\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Allowing Meta-Characters in Parameters with JSON\nDESCRIPTION: This JSON snippet configures an Nginx policy to allow specific meta-characters (0x3c and 0x3e) in parameter names and values by overriding the default meta-character checks. It utilizes the 'nameMetacharOverrides' and 'valueMetacharOverrides' to specify allowed characters.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/parameters-and-user-defined-urls.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"parameters_allowed_metachars\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_PARAMETER_MULTIPART_NULL_VALUE\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_NAME_METACHAR\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_VALUE_METACHAR\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"parameters\": [\n            {\n                \"checkMetachars\": true,\n                \"sensitiveParameter\": false,\n                \"parameterLocation\": \"any\",\n                \"valueType\": \"auto-detect\",\n                \"nameMetacharOverrides\": [\n                    {\n                        \"isAllowed\": true,\n                        \"metachar\": \"0x3c\"\n                    },\n                    {\n                        \"isAllowed\": true,\n                        \"metachar\": \"0x3e\"\n                    }\n                ],\n                \"metacharsOnParameterValueCheck\": true,\n                \"allowEmptyValue\": true,\n                \"checkMaxValueLength\": false,\n                \"valueMetacharOverrides\": [\n                    {\n                        \"isAllowed\": true,\n                        \"metachar\": \"0x3c\"\n                    },\n                    {\n                        \"isAllowed\": true,\n                        \"metachar\": \"0x3e\"\n                    }\n                ],\n                \"name\": \"*\",\n                \"level\": \"global\",\n                \"allowRepeatedParameterName\": true,\n                \"attackSignaturesCheck\": true,\n                \"signatureOverrides\": [],\n                \"type\": \"wildcard\",\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring X-Frame-Options with 'deny' in NGINX App Protect WAF (JSON)\nDESCRIPTION: This JSON configuration enables clickjacking protection for the URL `/clickme` and sets the `X-Frame-Options` header to `DENY`. This prevents the content from being displayed in a frame, regardless of the origin of the framing website. It requires NGINX App Protect WAF and the POLICY_TEMPLATE_NGINX_BASE template.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/clickjacking-protection.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"x_frame_options\",\n    \"template\": {\n        \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"applicationLanguage\": \"utf-8\",\n    \"enforcementMode\": \"blocking\",\n    \"urls\": [\n        {\n            \"name\": \"/clickme\",\n            \"type\": \"explicit\",\n            \"method\": \"*\",\n            \"isAllowed\": true,\n            \"clickjackingProtection\": true,\n            \"allowRenderingInFrames\": \"never\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Install NLK controller using Helm\nDESCRIPTION: This snippet installs the NGINX Load Balancer for Kubernetes (NLK) controller using Helm.  It specifies the chart, version, and sets the `nlk.dataplaneApiKey` and `nlk.config.nginxHosts` values. The `nginxHosts` value is the data plane API endpoint retrieved previously.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/loadbalancer-kubernetes.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nhelm install nlk oci://registry-1.docker.io/nginxcharts/nginxaas-loadbalancer-kubernetes --version 1.0.0 \\\n  --set \"nlk.dataplaneApiKey=${keyValue}\" \\\n  --set \"nlk.config.nginxHosts=${dataplaneAPIEndpoint}nplus\"\n```\n\n----------------------------------------\n\nTITLE: Creating Nginx Config Map\nDESCRIPTION: This command creates a Kubernetes ConfigMap named `nginx-config` from the `nginx.conf` and `default.conf` files. ConfigMaps are used to inject configuration data into Pods. In this context, the Nginx configuration files are made available to the Nginx container.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_24\n\nLANGUAGE: shell\nCODE:\n```\nkubectl create configmap nginx-config \\\n  --from-file=/nginx.conf \\\n  --from-file=/default.conf\n```\n\n----------------------------------------\n\nTITLE: Removing Instance Group Association (Text)\nDESCRIPTION: This shows how to remove an instance from a Config Sync Group by commenting out the `instance_group` line in the `agent-dynamic.conf` file.  The `<config_sync_group>` placeholder represents the original group name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/config-sync-groups/manage-config-sync-groups.md#_snippet_5\n\nLANGUAGE: text\nCODE:\n```\n# instance_group: <config_sync_group>\n```\n\n----------------------------------------\n\nTITLE: Configuring stub_status URL\nDESCRIPTION: Demonstrates how to override the stub_status URI/URL in the agent.conf file. This is used to point the agent to the correct location of the Nginx stub_status module endpoint. If only the URI is specified, the agent will use http://127.0.0.1 to construct the full URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/configuring-amplify-agent.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\n[nginx]\n..\nstub_status = http://127.0.0.1/nginx_status\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Service Mesh with Helm\nDESCRIPTION: This set of commands installs NGINX Service Mesh using Helm. It adds the NGINX stable Helm repository, updates the repository information, and then installs the `nginx-service-mesh` chart into the `nginx-mesh` namespace, configuring Prometheus and OpenTelemetry integration using Helm's `--set` flags.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/observability.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nhelm repo add nginx-stable https://helm.nginx.com/stable\nhelm repo update\n\nhelm install nsm nginx-stable/nginx-service-mesh --namespace nginx-mesh --create-namespace --wait --set prometheusAddress=prometheus.nsm-monitoring.svc:9090 --set telemetry.exporters.otlp.host=otel-collector.nsm-monitoring.svc --set telemetry.exporters.otlp.port=4317 --set telemetry.samplerRatio=1\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Agent Tools and Dependencies (Bash)\nDESCRIPTION: This command uses `make` to install the tools and dependencies required by NGINX Agent. It executes the `install-tools` and `deps` targets defined in the `Makefile`. This prepares the development environment with all necessary components before building the agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/contribute/dev-environment-setup.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nmake install-tools deps\n```\n\n----------------------------------------\n\nTITLE: Reloading NGINX Configuration via Service Command\nDESCRIPTION: These commands reload the NGINX configuration without downtime.  The first uses the nginx command-line tool, and the second uses the service command.  Both achieve the same result: applying the new configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_23\n\nLANGUAGE: none\nCODE:\n```\nroot# service nginx reload\n```\n\n----------------------------------------\n\nTITLE: Disabling All Signatures Alarm and Block - JSON\nDESCRIPTION: This snippet attempts to disable all attack signature enforcement by setting both `alarm` and `block` to `false` for 'Generic Detection Signatures (High/Medium Accuracy)' and 'All Signatures'. It's important to note that this may not completely disable enforcement if other signature sets with alarm turned ON are still present in the default policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/signature-sets.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"signatures_block\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"caseInsensitive\": false,\n        \"enforcementMode\": \"blocking\",\n        \"signature-sets\": [\n            {\n                \"name\": \"Generic Detection Signatures (High/Medium Accuracy)\",\n                \"block\": false,\n                \"alarm\": false\n            },\n            {\n                \"name\": \"All Signatures\",\n                \"block\": false,\n                \"alarm\": false\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Creating Azure Location with NGINX Controller API in JSON\nDESCRIPTION: This JSON configuration creates a Location in NGINX Controller, grouping NGINX Plus instances by physical locations on Azure. It requires the Azure resource group name, region, and subscription ID. The `type` is set to `AZURE_LOCATION` and it references the Azure integration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/add-azure-instance.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"metadata\": {\n    \"name\": \"washington\",\n    \"tags\": []\n  },\n  \"desiredState\": {\n    \"type\": \"AZURE_LOCATION\",\n    \"integrationRef\": {\n      \"ref\": \"/platform/integrations/azure\"\n    },\n    \"resourceGroup\": \"...\",\n    \"region\": \"...\",\n    \"subscriptionID\": \"...\"\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Example of $prom_keyval Usage in Nginx Configuration\nDESCRIPTION: This example demonstrates how to use the `$prom_keyval` variable in conjunction with key-value storage for dynamic upstream routing.  It shows the configuration of the keyval_zone, keyval, upstream, server, location for proxying, API, and the metrics endpoint, all working together to enable dynamic upstream configuration and metric collection.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n\n    #...\n\n    keyval_zone zone=upstream_keyval:64k;\n    keyval      $domain $upstream zone=http_upstream_keyval;\n\n    upstream 0 {\n        zone   http_backend 64k;\n        server backend1.example.com;\n        server backend2.example.com;\n    }\n\n    server {\n        #...\n\n        location / {\n            proxy_pass http://$upstream;\n            #...\n        }\n\n        location /api {\n            api;\n            #...\n        }\n\n        location = /metrics {\n            set        $prom_keyval \"http_upstream_keyval\";\n            js_content prometheus.metrics;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Fine-tuning Synchronization NGINX\nDESCRIPTION: Fine-tunes zone synchronization parameters such as buffer size, connection retry interval, connection timeout, sync interval, and timeout. Adjusting these parameters may be necessary for optimizing performance and consistency in different network environments. The directives control buffer size, connect retry interval, connect timeout, synchronization interval, and TCP stream timeout between nodes respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\n#...\nzone_sync;\nzone_sync_server nginx-cluster.example.com:9000 resolve;\n\nzone_sync_buffers                256 4k;\nzone_sync_connect_retry_interval 1s;\nzone_sync_connect_timeout        5s;\nzone_sync_interval               1s;\nzone_sync_timeout                5s;\n#...\n```\n\n----------------------------------------\n\nTITLE: Install NDK Module on SLES\nDESCRIPTION: This shell command refreshes the package repositories and installs the nginx-plus-module-ndk package on SUSE Linux Enterprise Server (SLES). The zypper command ensures the system has the most recent package metadata before installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/ndk.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-ndk\n```\n\n----------------------------------------\n\nTITLE: Configuring Zone directive in Nginx Upstream Block\nDESCRIPTION: This snippet configures the `zone` directive within an Nginx upstream block. The `zone` directive creates a shared memory zone for storing the upstream group's configuration and runtime state, making it accessible to all worker processes. It is crucial for enabling features like session persistence, health checks, and dynamic reconfiguration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_32\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream nodejs {\n    zone nodejs 64k;\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Successful Nginx Configuration Test Output\nDESCRIPTION: The expected output from a successful nginx configuration test. This confirms that the configuration file has no syntax errors and is valid.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/spnego.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Security Log Profile Request - JSON\nDESCRIPTION: This is an example JSON payload for creating a security log profile. The `content` field should contain the base64 encoded log profile configuration. The request includes metadata for the log profile such as its name. The log profile configuration itself must be base64 encoded before being included in this JSON payload.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_16\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"metadata\": {\n    \"name\": \"default-log-example\"\n  },\n  \"content\": \"Cgl7CgkJImZpbHRlciI6IHsKCQkJInJlcXVlc3RfdHlwZSI6ICJpbGxlZ2FsIgoJCX0sCgkJImNvbnRlbnQiOiB7CgkJCSJmb3JtYXQiOiAiZGVmYXVsdCIsCgkJCSJtYXhfcmVxdWVzdF9zaXplIjogImFueSIsCgkJCSJtYXhfbWVzc2FnZV9zaXplIjogIjVrIgoJCX0KCX0=\"\n```\n\n----------------------------------------\n\nTITLE: Including Configuration Files in Nginx\nDESCRIPTION: Includes all configuration files from the `conf.d` directory. This allows for modular configuration of Nginx, where server blocks and other settings can be defined in separate files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/setting-up-nginx-demo-environment.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\ninclude conf.d/*.conf;\n```\n\n----------------------------------------\n\nTITLE: Verify Nginx is running\nDESCRIPTION: This command uses curl to send a request to the local Nginx server on port 80 and checks the HTTP response headers. A 200 OK response indicates that Nginx is running correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\ncurl -I 127.0.0.1\n```\n\n----------------------------------------\n\nTITLE: Copying NGINX Plus Certificates (Shell)\nDESCRIPTION: This command copies the NGINX Plus certificate and key files to the /etc/ssl/nginx/ directory. These files are essential for accessing the NGINX Plus repository and downloading the OpenTelemetry module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo cp <downloaded-file-name>.crt /etc/ssl/nginx/nginx-repo.crt && \\\nsudo cp <downloaded-file-name>.key /etc/ssl/nginx/nginx-repo.key\n```\n\n----------------------------------------\n\nTITLE: Access NGINX Management Suite API with Access Token - Bash\nDESCRIPTION: This snippet demonstrates how to access the NGINX Management Suite API using the access token obtained from Microsoft Entra. The token is included in the `Authorization` header as a Bearer token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/microsoft-entra-automation.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\ncurl -v -k --header \"Authorization: Bearer <access-token>\" https://<nms-ip>/api/platform/v1/userinfo\n```\n\n----------------------------------------\n\nTITLE: Set Root Directory for Swagger UI Files\nDESCRIPTION: This snippet configures the root directory where Swagger UI files are located. It is required for NGINX to serve the UI correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_25\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /swagger-ui {\n    root   /usr/share/nginx/html;\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Generating JSON Schema for Policy Validation\nDESCRIPTION: This command generates a JSON schema file from the NGINX App Protect WAF Compiler image.  The schema can then be used to validate JSON policy files, ensuring they adhere to the required format. The version number in the image name should match the installed compiler version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker run --rm \\\n -v $(pwd):$(pwd) \\\n -w $(pwd) \\\n --entrypoint=/opt/app_protect/bin/generate_json_schema.pl \\\n private-registry.nginx.com/nap/waf-compiler:1.0.0\n```\n\n----------------------------------------\n\nTITLE: Install Nginx OSS and Nginx App Protect WAF module\nDESCRIPTION: This Dockerfile snippet installs Nginx Open Source Software (OSS) and the Nginx App Protect WAF v5 module on an Amazon Linux 2 base image. It uses yum to install the necessary packages and configures repositories for both Nginx mainline and App Protect. The snippet mounts secrets for repository authentication, enables EPEL, and configures logging to stdout/stderr.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-amazon.md#_snippet_0\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Base image\nFROM amazonlinux:2\n\n# Install NGINX OSS and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    amazon-linux-extras enable epel \\\n    && yum clean metadata \\\n    && yum -y install wget ca-certificates epel-release shadow-utils yum-utils \\\n    && echo \"[nginx-mainline]\" > /etc/yum.repos.d/nginx.repo \\\n    && echo \"name=nginx mainline repo\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"baseurl=http://nginx.org/packages/mainline/amzn2/$releasever/$basearch/\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"gpgcheck=1\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"gpgkey=https://nginx.org/keys/nginx_signing.key\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"module_hotfixes=true\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"priority=9\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"[app-protect-x-oss]\" > /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && echo \"name=nginx-app-protect repo\" >> /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && echo \"baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/7/$basearch/\" >> /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && echo \"sslclientcert=/etc/ssl/nginx/nginx-repo.crt\" >> /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && echo \"sslclientkey=/etc/ssl/nginx/nginx-repo.key\" >> /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && echo \"gpgcheck=0\" >> /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && yum -y install app-protect-module-oss \\\n    && yum clean all \\\n    && rm -rf /var/cache/yum \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log\n```\n\n----------------------------------------\n\nTITLE: Executing the support package script\nDESCRIPTION: This code snippet demonstrates how to execute the `support-package.sh` script with root privileges. The script is used to collect system and service information and package it into a tar archive. The output is saved in the same location where the script is run by default.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/support/support-package.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo bash /etc/nms/scripts/support-package.sh\n```\n\n----------------------------------------\n\nTITLE: Limiting Bandwidth after a Certain Amount of Data in NGINX\nDESCRIPTION: This snippet demonstrates how to use `limit_rate_after` to allow an initial amount of data to be downloaded quickly before applying a rate limit.  It sets a rate limit of 20 kilobytes per second after the first 500 kilobytes have been downloaded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nlimit_rate_after 500k;\nlimit_rate       20k;\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Service Mesh with Telemetry Exporter\nDESCRIPTION: This command deploys NGINX Service Mesh and configures it to export tracing data to an OpenTelemetry Protocol (OTLP) exporter. The `--telemetry-exporters` flag specifies the exporter type, host, and port. This allows NGINX Service Mesh to send tracing data to the specified OTLP collector.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/monitoring-and-tracing.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --telemetry-exporters \"type=otlp,host=otel-collector.example-namespace.svc,port=4317\"\n```\n\n----------------------------------------\n\nTITLE: Test NGINX Packages Repository Access - Shell\nDESCRIPTION: This command tests access to the NGINX packages repository using a provided key and certificate.  It is used to verify that the server can access the repository to download updates and security packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_35\n\nLANGUAGE: shell\nCODE:\n```\ncurl --key /etc/ssl/nginx/nginx-repo.key --cert /etc/ssl/nginx/nginx-repo.crt https://pkgs.nginx.com/app-protect-security-updates/index.xml\n```\n\n----------------------------------------\n\nTITLE: Verify redirect with curl for tea with type application (Shell)\nDESCRIPTION: This `curl` command sends a request to `http://cafe.example.com/tea/type` and includes the response headers to verify the redirect. The `--resolve` option maps the hostname to the specified IP and Port. The `--include` option displays headers, so that the `Location` header can be used to determine the redirect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/tea/type --include\n```\n\n----------------------------------------\n\nTITLE: Apply Tea HTTPRoute with No Delay Rate Limiting - Kubernetes YAML\nDESCRIPTION: This snippet applies a Kubernetes HTTPRoute configuration for the tea application. It references a SnippetsFilter named 'no-delay-rate-limiting-sf' to enforce rate limiting with no delay. The route matches requests with the '/tea' path prefix and forwards them to the tea backend service on port 80.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_14\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: tea\nspec:\n  parentRefs:\n    - name: gateway\n      sectionName: http\n  hostnames:\n    - \"cafe.example.com\"\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /tea\n      filters:\n        - type: ExtensionRef\n          extensionRef:\n            group: gateway.nginx.org\n            kind: SnippetsFilter\n            name: no-delay-rate-limiting-sf\n      backendRefs:\n        - name: tea\n          port: 80\nEOF\n```\n\n----------------------------------------\n\nTITLE: Creating Server SSL/TLS Profile on BIG-IP LTM\nDESCRIPTION: This snippet shows how to create a server SSL/TLS profile on BIG-IP LTM, associating a certificate and key.  The profile is then added to the virtual server configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_4\n\nLANGUAGE: none\nCODE:\n```\n# create profile server-ssl test_ssl_server_profile cert test.crt key test.key\n# modify virtual test_ssl_virtual profiles add { test_ssl_server_profile }\n# save /sys config\n```\n\n----------------------------------------\n\nTITLE: OpenAPI Specification (YAML)\nDESCRIPTION: This YAML snippet represents a basic OpenAPI Specification file defining an API endpoint `/query` with two query parameters: `query_int` (integer type) and `query_str` (string type). This specification is used to validate incoming requests against the defined data types.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-openapi-references.md#_snippet_1\n\nLANGUAGE: YAML\nCODE:\n```\nopenapi: 3.0.1\ninfo:\n  title: 'Primitive data types'\n  description: 'Primitive data types.'\n  version: '2.5.0'\nservers:\n  - url: http://localhost\npaths:\n  /query:\n    get:\n      tags:\n        - query_int_str\n      description: query_int_str\n      operationId: query_int_str\n      parameters:\n        - name: query_int\n          in: query\n          required: false\n          allowEmptyValue: false\n          schema:\n            type: integer\n        - name: query_str\n          in: query\n          required: false\n          allowEmptyValue: true\n          schema:\n            type: string\n      responses:\n        200:\n          description: OK\n        404:\n          description: NotFound\n```\n\n----------------------------------------\n\nTITLE: Configuring Dqlite Storage in NGINX Instance Manager\nDESCRIPTION: This YAML snippet configures the dqlite storage for NGINX Instance Manager. It specifies the name of the storage configuration, an optional existing claim to use, the size of the storage, and the access mode. This configuration is part of the `nms-hybrid.core.persistence.claims` setting in the Helm chart.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/helm-config-settings.md#_snippet_1\n\nLANGUAGE: YAML\nCODE:\n```\n  - name: dqlite\n    existingClaim:\n    size: 500Mi\n    accessMode: ReadWriteOnce\n```\n\n----------------------------------------\n\nTITLE: APT Installation Error Example\nDESCRIPTION: This code snippet shows an example of an apt installation error when the app-protect-security-updates repository is missing during NGINX App Protect WAF installation. The error indicates unmet dependencies on app-protect-attack-signatures and app-protect-threat-campaigns.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/troubleshooting-guide/troubleshooting.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nThe following packages have unmet dependencies:\napp-protect-compiler : Depends: app-protect-attack-signatures\n                    Depends: app-protect-threat-campaigns\nError: Unable to correct problems, you have held broken packages.\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS TXT Record for SPF\nDESCRIPTION: This DNS TXT record is used for Sender Policy Framework (SPF) to prevent email spoofing. Replace `X.X.X.X` with the public IP address of the NGINX Plus server. It defines which mail servers are permitted to send email on behalf of the domain.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\ncompany.com.    300    TXT    \"v=spf1  mx  a  ip4:X.X.X.X/32  -all\"\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Plus Installation and OpenSSL Version (Shell)\nDESCRIPTION: This command verifies that NGINX Plus is correctly installed and confirms the version of the OpenSSL cryptographic module it is using. The `-V` flag displays the NGINX version, build information, and OpenSSL version.  The presence of '-fips' indicates a FIPS validated build.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/fips-compliance-nginx-plus.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nnginx -V\nnginx version: nginx/1.15.2 (nginx-plus-r16)\nbuilt by gcc 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC)\nbuilt with OpenSSL 1.0.2k-fips  26 Jan 2017\n```\n\n----------------------------------------\n\nTITLE: Configuring WebSocket Proxy - Nginx\nDESCRIPTION: This snippet configures the necessary settings for proxying WebSocket traffic. It defines a map to set the 'connection_upgrade' variable based on the 'http_upgrade' header, enabling the upgrade to HTTP/1.1.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_19\n\nLANGUAGE: nginx\nCODE:\n```\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent on Amazon Linux 2023 (DNF)\nDESCRIPTION: This command installs the NGINX Agent package using the dnf package manager on Amazon Linux 2023. It assumes that the dnf repository has been properly configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_31\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf install nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Running NGINX Instance Manager Restore Script (./restore.sh)\nDESCRIPTION: This command executes the restore script to restore NGINX Instance Manager from a backup tarball. It requires the path to the backup tarball as an argument. The script is located in `/etc/nms/scripts`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo ./restore.sh /tmp/nms-backup-<DATETIME>.tgz\n```\n\n----------------------------------------\n\nTITLE: Apply Terraform Configuration\nDESCRIPTION: This command applies the changes defined in the Terraform configuration, creating or modifying resources as needed. The `--auto-approve` flag bypasses the interactive approval prompt, automatically applying the changes.  It requires a properly initialized and planned Terraform working directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-terraform.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nterraform apply --auto-approve\n```\n\n----------------------------------------\n\nTITLE: Enabling Utility Pod in Helm Values (YAML)\nDESCRIPTION: This YAML snippet enables the utility pod within the NGINX Instance Manager Helm deployment. It adds a `utility: true` line under the `global` section of the `values.yaml` file. This is required for certain backup and restore operations in Kubernetes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\nglobal:\n    utility: true\n```\n\n----------------------------------------\n\nTITLE: Enable Strict mTLS Mode in NGINX Service Mesh\nDESCRIPTION: This command demonstrates how to deploy NGINX Service Mesh with mTLS enabled in `strict` mode, ensuring that all traffic between pods is encrypted and only traffic destined for injected pods is supported. It uses the `nginx-meshctl deploy` command with the `--mtls-mode strict` flag.  Strict mode is the recommended option for production environments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/secure-traffic-mtls.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --mtls-mode strict\n```\n\n----------------------------------------\n\nTITLE: Create Troubleshooting Tarball\nDESCRIPTION: This code snippet shows the command to create a compressed tarball (logs.tgz) containing various log files and configuration files for troubleshooting NGINX App Protect WAF. The list of files to include is read from `logs.txt`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/troubleshooting-guide/troubleshooting.md#_snippet_10\n\nLANGUAGE: none\nCODE:\n```\ntar cvfz logs.tgz `cat logs.txt`\n```\n\n----------------------------------------\n\nTITLE: Generating Self-Signed Certificate (OpenSSL)\nDESCRIPTION: This command generates a self-signed certificate using the private key. The -new and -x509 parameters create a new self-signed certificate. The -days parameter sets the validity period for the certificate.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\nroot# openssl req -new -x509 -key ~/private-key.pem -out ~/self-cert.pem -days 10950\n```\n\n----------------------------------------\n\nTITLE: Defining Health Check Match Criteria\nDESCRIPTION: This snippet defines a `match` block named `jboss_check` that specifies the criteria for a server to pass a health check. The criteria include the expected HTTP status code, `Content-Type` header, and a regular expression to match against the response body.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_26\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nmatch jboss_check {\n    status 200;\n    header Content-Type = text/html;\n    body ~ \"Your WildFly 9 is running\";\n}\n```\n\n----------------------------------------\n\nTITLE: Clone NGINX Agent Repository (HTTPS)\nDESCRIPTION: Clones the NGINX Agent GitHub repository using HTTPS. This repository contains the Dockerfiles and supporting scripts needed to build the NGINX Agent container images.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ngit clone https://github.com/nginx/agent.git\n```\n\n----------------------------------------\n\nTITLE: Start Controller Agent Service (systemctl)\nDESCRIPTION: This command starts the controller-agent.service using systemctl. It is used to attempt to recover a failed NGINX Controller instance when the Controller Agent service is not running.  Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-instances.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start controller-agent.service\n```\n\n----------------------------------------\n\nTITLE: Check if nginx_agent_selinux is installed (Debian, Ubuntu, DEB)\nDESCRIPTION: This command checks if the `nginx_agent_selinux` package is installed on Debian-based systems. It uses `dpkg -s` to check the status of the `nginx_agent_selinux` package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ndpkg -s nginx_agent_selinux\n```\n\n----------------------------------------\n\nTITLE: Retrieve Security Policies (Shell)\nDESCRIPTION: This `curl` command sends a GET request to the NGINX Instance Manager REST API to retrieve a list of all security policies. It requires a valid access token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_20\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET https://<NIM_FQDN>/api/platform/v1/security/policies \\\n-H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Service Mesh via Helm Source\nDESCRIPTION: This command installs the NGINX Service Mesh from the current directory (assumed to contain the Helm chart) into the `nginx-mesh` namespace. It creates the namespace if it doesn't exist and waits until all resources are ready.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade-with-helm.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nhelm install nsm . --namespace nginx-mesh --create-namespace --wait\n```\n\n----------------------------------------\n\nTITLE: Installing Lua module on Debian and Ubuntu\nDESCRIPTION: These commands update the package list and install the `nginx-plus-module-lua` package using `apt`. This assumes that the nginx-plus repository is configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/lua.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-lua\n```\n\n----------------------------------------\n\nTITLE: Test API Proxy Request (JSON)\nDESCRIPTION: This snippet represents a JSON request used to test the API proxy created in API Connectivity Manager.  It sends a sample JSON payload with a custom header (`X-NGINX-Test`) to the proxy, which then forwards it to the backend Echo Server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/enable-metrics.md#_snippet_8\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"testKey\": \"testValue\"\n}\n```\n\n----------------------------------------\n\nTITLE: Generate Traffic to /api Endpoint\nDESCRIPTION: This bash script sends GET requests to the `/api` endpoint of the gateway Service. It's used to test the traffic splitting configuration based on the path of the request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_27\n\nLANGUAGE: bash\nCODE:\n```\nfor i in $(seq 1 100); do curl $GATEWAY_IP/api; sleep 1; done\n```\n\n----------------------------------------\n\nTITLE: Referenced File Content (modifications.txt) JSON\nDESCRIPTION: This JSON specifies the modifications to the attack signatures.  In this example, it disables a specific signature by its ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-references.md#_snippet_5\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"modifications\": [\n        {\n            \"entityChanges\": {\n                \"enabled\": false\n            },\n            \"entity\": {\n                \"signatureId\": 200001834\n            },\n            \"entityType\": \"signature\",\n            \"action\": \"add-or-update\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Plus - FreeBSD\nDESCRIPTION: Upgrades the NGINX Plus package using pkg on FreeBSD systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_60\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg upgrade nginx-plus\n```\n\n----------------------------------------\n\nTITLE: Creating a Support Package (Basic Bash)\nDESCRIPTION: This command invokes the `helper.sh` script to create a support package for NGINX Controller. The generated support package is saved to a default location. This command will include database dumps and timeseries data of last 12 hours by default.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh supportpkg\n```\n\n----------------------------------------\n\nTITLE: Defining Sensitive Parameters with JSON\nDESCRIPTION: This JSON snippet defines 'mypass' as a sensitive parameter in an Nginx policy. Sensitive parameters are treated specially, often with logging and masking configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/parameters-and-user-defined-urls.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"parameters_sensitive\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_PARAMETER_MULTIPART_NULL_VALUE\",\n                    \"alarm\": true,\n                    \"block\": false\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_NAME_METACHAR\",\n                    \"alarm\": true,\n                    \"block\": false\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_VALUE_METACHAR\",\n                    \"alarm\": true,\n                    \"block\": false\n                }\n            ]\n        },\n        \"sensitive-parameters\": [\n            {\n                \"name\": \"mypass\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enable Active Health Checks\nDESCRIPTION: Enables active health checks for an upstream group by using the `health_check` directive. This directs Nginx Plus to send periodic health check requests to each server in the group. Active Health Checks require Nginx Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    server {\n        listen        12345;\n        proxy_pass    stream_backend;\n        health_check;\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Validating and Reloading NGINX Configuration\nDESCRIPTION: These commands validate the NGINX configuration file for syntax errors and then gracefully reload the NGINX service to apply the changes without downtime. `nginx -t` tests the configuration and `nginx -s reload` sends a reload signal to the Nginx master process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX App Protect WAF for gRPC Security Logging\nDESCRIPTION: This configuration snippet demonstrates how to enable NGINX App Protect WAF for a gRPC service, apply a security policy with a gRPC profile, enable security logging, and configure the `app_protect_security_log` directive with the `log_grpc_all` bundle. It also specifies the `grpc_pass` to the backend service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/concept/grpc-logging.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    server_name my_grpc_service.com;\n    location / {\n        app_protect_enable on;\n        app_protect_policy_file \"/etc/app_protect/conf/policy_with_grpc_profile.tgz\";\n        app_protect_security_log_enable on;\n        app_protect_security_log \"/etc/app_protect/conf/log_grpc_all.tgz\" stderr;\n        grpc_pass grpcs://grpc_backend;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Define Entra ID OIDC Provider in NGINX\nDESCRIPTION: This configuration defines the Entra ID OIDC provider within the `http` context of the NGINX configuration. It specifies the `issuer`, `client_id`, `client_secret`, and `ssl_trusted_certificate` for secure communication with Entra ID.  The issuer URL is used to discover the OIDC configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/entra-id.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider entra {\n        issuer        https://login.microsoftonline.com/<tenant_id>/v2.0;\n        client_id     <client_id>;\n        client_secret <client_secret>;\n\n        ssl_trusted_certificate /etc/ssl/certs/ca-certificates.crt;\n    }\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Agent using apt on Debian\nDESCRIPTION: These commands update the apt package list and install the Nginx Agent package on Debian systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update\nsudo apt install nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Initial Licensing Step - Bash\nDESCRIPTION: This section performs the initial licensing steps by interacting with NGINX Instance Manager APIs. It includes posting the JWT, polling for license status, and making a PUT request.  It uses the previously defined variables for IP address, username, password, and JWT token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nif [ \"$step\" == \"initial\" ]; then\n\n    # Function to print banner\n    print_banner() {\n        echo \"====================================\"\n        echo \"$1\"\n        echo \"====================================\"\n    }\n\n    # Step 1: POST request\n    print_banner \"Executing Step 1: POST request\"\n    post_response=$(curl -k --location \"https://$ip_address/api/platform/v1/license?telemetry=true\" \\\n        --header \"Origin: https://$ip_address\" \\\n        --header \"Referer: https://$ip_address/ui/settings/license\" \\\n        --header \"Content-Type: application/json\" \\\n        --header \"Authorization: Basic $basic_auth\" \\\n        --data '{ \\\n            \"metadata\": { \\\n                \"name\": \"license\" \\\n            }, \\\n            \"desiredState\": { \\\n                \"content\": \"$bearer_token\" \\\n            } \\\n        }')\n    # Use jq to extract modeOfOperation\n    modeOfOperation=$(jq -r '.currentStatus.modeOfOperation' <<< \"$post_response\")\n\n    # Output the modeOfOperation\n    echo \"Mode of Operation: $modeOfOperation\"\n\n    # Parse the modeOfOperation from the response\n    echo $modeOfOperation\n    # Step 2: Polling for the license status with conditional logic based on modeOfOperation\n    while true; do\n        print_banner \"Checking License Status\"\n\n        response=$(curl -k \"https://$ip_address/api/platform/v1/license\" \\\n            -H \"accept: application/json\" \\\n            -H \"authorization: Basic $basic_auth\" \\\n            -H \"referer: https://$ip_address/ui/settings/license\" \\\n            --insecure)\n        fileType=$(jq -r '.currentStatus.state.currentInstance.fileType' <<< \"$response\")\n        status=$(jq -r '.currentStatus.state.currentInstance.status' <<< \"$response\")\n        telemetry=$(jq -r '.currentStatus.state.currentInstance.telemetry' <<< \"$response\")\n\n        echo $fileType\n        echo $status\n        echo $telemetry\n        if [[ \"$modeOfOperation\" == \"CONNECTED\" ]]; then\n        if [[ \"$fileType\" == \"JWT\" && \"$status\" == \"ACTIVATED\" && \"$telemetry\" == \"true\" ]]; then\n                echo \"Connected mode: Desired response received!\"\n                break\n            else\n                echo \"Connected mode: Waiting for the desired response...\"\n            fi\n        elif [[ \"$modeOfOperation\" == \"DISCONNECTED\" ]]; then\n            if [[ \"$fileType\" == \"JWT\" && \"$status\" == \"INITIALIZE_ACTIVATION_COMPLETE\" ]]; then\n                echo \"Disconnected mode: Desired response received!\"\n                break\n            else\n                echo \"Disconnected mode: Waiting for the desired response...\"\n            fi\n        fi\n\n        sleep 5  # Poll every 5 seconds\n    done\n\n    # Step 3: PUT request\n    print_banner \"Executing Step 2: PUT request\"\n    put_response=$(curl -k --location --request PUT \"https://$ip_address/api/platform/v1/license?telemetry=true\" \\\n        --header \"Origin: https://$ip_address\" \\\n        --header \"Referer: https://$ip_address/ui/settings/license\" \\\n        --header \"Content-Type: application/json\" \\\n        --header \"Authorization: Basic $basic_auth\" \\\n        --data '{ \\\n            \"desiredState\": { \\\n                \"content\": \"\", \\\n                \"type\": \"JWT\", \\\n                \"features\": [ \\\n                    {\"limit\": 0, \"name\": \"NGINX_NAP_DOS\", \"valueType\": \"\"}, \\\n                    {\"limit\": 0, \"name\": \"IM_INSTANCES\", \"valueType\": \"\"}, \\\n                    {\"limit\": 0, \"name\": \"TM_INSTANCES\", \"valueType\": \"\"}, \\\n                    {\"limit\": 0, \"name\": \"DATA_PER_HOUR_GB\", \"valueType\": \"\"}, \\\n                    {\"limit\": 0, \"name\": \"NGINX_INSTANCES\", \"valueType\": \"\"}, \\\n                    {\"limit\": 0, \"name\": \"NGINX_NAP\", \"valueType\": \"\"}, \\\n                    {\"limit\": 0, \"name\": \"SUCCESSFUL_API_CALLS_MILLIONS\", \"valueType\": \"\"}, \\\n                    {\"limit\": 0, \"name\": \"IC_PODS\", \"valueType\": \"\"}, \\\n                    {\"limit\": 0, \"name\": \"IC_K8S_NODES\", \"valueType\": \"\"} \\\n                ] \\\n            }, \\\n            \"metadata\": { \\\n                \"name\": \"license\" \\\n            } \\\n        }')\n\n    echo \"Response from Step 2: PUT request:\"\n\n    # Step 4: Polling for the desired license status\n    while true; do\n        print_banner \"Checking License Validation Status\"\n\n        response=$(curl -s \"https://$ip_address/api/platform/v1/license\" \\\n            -H \"accept: application/json\" \\\n            -H \"authorization: Basic $basic_auth\" \\\n            -H \"referer: https://$ip_address/ui/settings/license\" \\\n            --insecure)\n        fileType=$(jq -r '.currentStatus.state.currentInstance.fileType' <<< \"$response\")\n        status=$(jq -r '.currentStatus.state.currentInstance.status' <<< \"$response\")\n        telemetry=$(jq -r '.currentStatus.state.currentInstance.telemetry' <<< \"$response\")\n\n\n        if [[ \"$modeOfOperation\" == \"CONNECTED\" ]]; then\n            if [[ \"$fileType\" == \"JWT\" && \"$status\" == \"VALID\" ]]; then\n                echo \"Connected mode: Desired response received!\"\n                break\n            else\n                echo \"Connected mode: Current license response does not meet conditions. Retrying...\"\n            fi\n        elif [[ \"$modeOfOperation\" == \"DISCONNECTED\" ]]; then\n            if [[ \"$fileType\" == \"JWT\" && \"$status\" == \"CONFIG_REPORT_READY\" ]]; then\n                echo \"Disconnected mode: Desired response received!\"\n                break\n            else\n                echo \"Disconnected mode: Current license response does not meet conditions. Retrying...\"\n            fi\n        fi\n\n        sleep 5\n    done\n\n    # Step 5: Loop to check if licensed\n    while true; do\n        print_banner \"Checking Licensed Status\"\n\n        licensed_response=$(curl -s \"https://$ip_address/api/platform/v1/modules/licensed\" \\\n            -H \"accept: application/json\" \\\n            -H \"authorization: Basic $basic_auth\" \\\n            -H \"referer: https://$ip_address/ui/settings/license\" \\\n            --insecure)\n\n        licensed_status=$(jq -r '.licensed' <<< \"$licensed_response\" )\n        if [[ \"$modeOfOperation\" == \"CONNECTED\" ]]; then\n\n            if [[ \"$licensed_status\" == \"true\" ]]; then\n                echo \"The system is licensed on connected mode!\"\n                break\n            else\n                echo \"The system is not licensed yet. Retrying...\"\n            fi\n        elif [[ \"$modeOfOperation\" == \"DISCONNECTED\" ]]; then\n            if [[ \"$licensed_status\" == \"false\" ]]; then\n                echo \"Upload JWT success on disconnected mode\"\n                break\n        fi\n        fi\n\n        sleep 5\n    done\n\n    echo \"Requests executed successfully.\"\n\n#################################################\n```\n\n----------------------------------------\n\nTITLE: NGINX Security Configuration - JSON\nDESCRIPTION: This JSON configuration defines security settings for an NGINX application. It specifies the enforcement mode, blocking settings for different types of violations (empty parameter value, repeated parameter, mandatory parameter missing, parameter violation), and defines several parameters with attributes like name, type, location, sensitivity, and value type.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/do-nothing-and-user-defined-parameters.md#_snippet_5\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"enforcementMode\": \"blocking\",\n  \"blocking-settings\": {\n    \"violations\": [\n      {\n        \"name\": \"VIOL_PARAMETER_EMPTY_VALUE\",\n        \"alarm\": true,\n        \"block\": true\n      },\n      {\n        \"name\": \"VIOL_PARAMETER_REPEATED\",\n        \"alarm\": true,\n        \"block\": true\n      },\n      {\n        \"name\": \"VIOL_MANDATORY_PARAMETER\",\n        \"alarm\": true,\n        \"block\": true\n      },\n      {\n        \"name\": \"VIOL_PARAMETER\",\n        \"alarm\": true,\n        \"block\": true\n      }\n    ]\n  },\n  \"parameters\": [\n    {\n      \"name\": \"mypass\",\n      \"type\": \"explicit\",\n      \"parameterLocation\": \"any\",\n      \"sensitiveParameter\": true,\n      \"valueType\": \"auto-detect\"\n    },\n    {\n      \"name\": \"empty\",\n      \"type\": \"explicit\",\n      \"parameterLocation\": \"any\",\n      \"mandatory\": false,\n      \"allowEmptyValue\": true,\n      \"allowRepeatedParameterName\": false,\n      \"sensitiveParameter\": false,\n      \"valueType\": \"auto-detect\"\n    },\n    {\n      \"name\": \"repeated\",\n      \"type\": \"explicit\",\n      \"parameterLocation\": \"any\",\n      \"mandatory\": false,\n      \"allowEmptyValue\": false,\n      \"allowRepeatedParameterName\": true,\n      \"sensitiveParameter\": false,\n      \"valueType\": \"auto-detect\"\n    },\n    {\n      \"name\": \"mandatory\",\n      \"type\": \"explicit\",\n      \"parameterLocation\": \"any\",\n      \"mandatory\": true,\n      \"allowEmptyValue\": false,\n      \"allowRepeatedParameterName\": false,\n      \"sensitiveParameter\": false,\n      \"valueType\": \"auto-detect\"\n    }\n  ]\n}\n\n```\n\n----------------------------------------\n\nTITLE: Enabling NDK and Lua modules in NGINX\nDESCRIPTION: These `load_module` directives enable dynamic loading of the NDK HTTP module, the HTTP Lua module, and the Stream Lua module within the main context of the NGINX configuration. The NDK module must be loaded before the Lua modules.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/lua.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ndk_http_module.so;\nload_module modules/ngx_http_lua_module.so;\nload_module modules/ngx_stream_lua_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Nginx App Protect WAF directives in Nginx configuration file\nDESCRIPTION: This configuration snippet demonstrates how to enable Nginx App Protect, reference a security policy file, enable security logging, and define the syslog server for sending security logs. It is intended to be added to the Nginx configuration file within the context where Nginx App Protect WAF is enabled. Ensure that the syslog server IP and port match the Nginx Agent configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/set-up-app-protect-instances.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enable on;\napp_protect_enable on;\napp_protect_policy_file \"/etc/nms/NginxDefaultPolicy.tgz\";\napp_protect_security_log_enable on;\napp_protect_security_log \"/etc/nms/secops_dashboard.tgz\" syslog:server=127.0.0.1:514;\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Service Mesh with Prometheus Address\nDESCRIPTION: This command deploys NGINX Service Mesh and configures it to connect to an existing Prometheus deployment. The `--prometheus-address` flag specifies the address of the Prometheus service in the format `<service-name>.<namespace>:<port>`. This allows NGINX Service Mesh to expose metrics to Prometheus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/monitoring-and-tracing.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ...  --prometheus-address \"my-prometheus.example-namespace:9090\"\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX App Protect WAF v5 Package (Shell)\nDESCRIPTION: This command updates the package list and installs the NGINX App Protect WAF v5 package along with a specific version of Nginx and the required module. It uses apt-get to perform the installation. Requires sudo privileges to install packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-ubuntu.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get update\nsudo apt-get install nginx=1.25.5-1~`lsb_release -cs` app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Define shell variables for Gateway IP and Port\nDESCRIPTION: Defines shell variables to store the public IP address and port number of NGINX Gateway Fabric. These variables are used in subsequent commands to access the deployed application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_9\n\nLANGUAGE: text\nCODE:\n```\nGW_IP=XXX.YYY.ZZZ.III\nGW_PORT=<port number>\n```\n\n----------------------------------------\n\nTITLE: Reloading NGINX Configuration\nDESCRIPTION: This command reloads the NGINX configuration without downtime.  It's used to apply the changes made to the configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/okta.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Stop Nginx Agent (systemctl)\nDESCRIPTION: This command stops the nginx-agent service using systemctl.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/upgrade.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl stop nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Port Forwarding to Grafana (Bash)\nDESCRIPTION: This command sets up port forwarding to the Grafana service. It maps a local port 3000 to the Grafana service's port, allowing access to the Grafana web UI from the local machine. The `<grafana-namespace>` should be replaced with the actual namespace where Grafana is deployed.  This requires `kubectl` to be configured and access to the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_15\n\nLANGUAGE: bash\nCODE:\n```\nkubectl port-forward -n <grafana-namespace> svc/grafana 3000\n```\n\n----------------------------------------\n\nTITLE: Creating NginxProxy with RewriteClientIP settings\nDESCRIPTION: This command creates an NginxProxy resource with `RewriteClientIP` settings using `kubectl apply`. It sets the mode to `ProxyProtocol` and configures a trusted address (CIDR) to find the original client IP. This enables the preservation of the original client IP when using multiple proxies or load balancers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/data-plane-configuration.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.nginx.org/v1alpha1\nkind: NginxProxy\nmetadata:\n  name: ngf-proxy-config\nspec:\n  config:\n    rewriteClientIP:\n      mode: ProxyProtocol\n      trustedAddresses:\n      - type: CIDR\n        value: \"76.89.90.11/24\"\nEOF\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX OpenID Connect\nDESCRIPTION: This shell script demonstrates how to run the `configure.sh` script from the `nginx-openid-connect` repository to update the NGINX configuration files with the values for your OneLogin application.\nIt requires specifying parameters like client ID, client secret, and the OpenID Connect configuration URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/onelogin.md#_snippet_2\n\nLANGUAGE: Shell\nCODE:\n```\n./nginx-openid-connect/configure.sh \\\n        --auth_jwt_key request \\\n        --client_id 168d5600-9224-... \\\n        --client_secret c9210a67d09e85... \\\n        https://<domain>.onelogin.com/oidc/2/.well-known/openid-configuration\n```\n\n----------------------------------------\n\nTITLE: Test ModSecurity Rule\nDESCRIPTION: This command tests the configured ModSecurity rule. It sends a request with the query parameter `testparam` containing the string `test`.  The expected result is a 403 Forbidden error, indicating that ModSecurity is blocking the request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_18\n\nLANGUAGE: none\nCODE:\n```\n$ curl -D - http://localhost/foo?testparam=thisisatestofmodsecurity\nHTTP/1.1 403 Forbidden\nServer: nginx/1.17.10\nDate: Wed, 6 May 2020 09:00:48 GMT\nContent-Type: text/html\nContent-Length: 170\nConnection: keep-alive\n\n<html>\n<head><title>403 Forbidden</title></head>\n<body bgcolor=\"white\">\n<center><h1>403 Forbidden</h1></center>\n<hr/><center>nginx/1.11.10</center>\n</body>\n</html>\n```\n\n----------------------------------------\n\nTITLE: Allowlist Policy - JSON\nDESCRIPTION: This JSON snippet represents an example content for an allowlist file used with `app_protect_dos_access_file` directive. It contains a list of IP addresses and ranges that are allowed, specifying them using the 'ipAddress' field and setting the 'blockRequests' to 'transparent'. It also demonstrates using `$ref` to include additional IP addresses from another file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_21\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"ip-address-lists\": [\n            {\n                \"ipAddresses\": [\n                    { \"ipAddress\": \"1.1.1.1\" },\n                    { \"ipAddress\": \"1.1.1.1/32\" },\n                    { \"ipAddress\": \"3.3.3.0/24\" },\n                    { \"ipAddress\": \"2023::4ef3/128\" },\n                    { \"ipAddress\": \"2034::2300/120\" }\n                ],\n                \"blockRequests\": \"transparent\"\n            },\n            {\n                \"$ref\": \"/etc/app_protect_dos/additional_ips.json\",\n                \"blockRequests\": \"transparent\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: OpenSSL SHA1 Hash Verification (Shell)\nDESCRIPTION: This command verifies the correct operation of OpenSSL by attempting to compute the SHA1 hash of /dev/null. SHA1 is permitted in all modes, so a successful hash confirms that OpenSSL is functioning properly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/fips-compliance-nginx-plus.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nopenssl sha1 /dev/null\nSHA1(/dev/null)= da39a3ee5e6b4b0d3255bfef95601890afd80709\n```\n\n----------------------------------------\n\nTITLE: OpenSSL Intermediate CA Configuration\nDESCRIPTION: This YAML configuration file defines settings for creating an Intermediate Certificate Authority (CA) using OpenSSL. It specifies parameters such as key size (4096 bits), distinguished name fields (country, state, locality, organization, common name), and extensions for the intermediate CA certificate, including basic constraints (CA:true) and key usage (keyCertSign, cRLSign). This configuration is used by the `openssl req` command to generate the intermediate CA certificate, which is signed by the root CA.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\n[req]\ndefault_bits        = 4096\ndistinguished_name  = req_distinguished_name\nprompt              = no\ndefault_md          = sha256\nreq_extensions      = v3_req\n\n# recommend changing these to your needs\n[req_distinguished_name]\ncountryName                 = US\nstateOrProvinceName         = California\nlocalityName                = San Francisco\norganizationName            = NGINX, Inc.\ncommonName                  = nms-int-ca\n\n[v3_req]\nbasicConstraints = critical, CA:true\nkeyUsage = critical, keyCertSign, cRLSign\nsubjectKeyIdentifier = hash\n```\n\n----------------------------------------\n\nTITLE: Testing Nginx Configuration\nDESCRIPTION: This command tests the Nginx configuration file for syntax errors. It is recommended to run this command after making changes to the configuration.  It validates the `nginx.conf` file and reports any errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_10\n\nLANGUAGE: none\nCODE:\n```\nroot# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n```\n\n----------------------------------------\n\nTITLE: Populating Key-Value Database with Network Range using curl\nDESCRIPTION: This shell command uses `curl` to post a network range in CIDR notation to the key-value store. The `type=ip` parameter of `keyval_zone` must be set for this to work.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\n$ curl -X POST -d '{\n  \"192.168.13.0/24\": \"1\"\n }' -s http://www.example.com/api/6/http/keyvals/one\n```\n\n----------------------------------------\n\nTITLE: Create Certificate Bundle - Shell\nDESCRIPTION: Creates a combined certificate and key file (nginx-repo-bundle.crt) by concatenating the certificate and key files. This bundle is required for SLES systems when configuring the zypper repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\ncat /etc/ssl/nginx/nginx-repo.crt /etc/ssl/nginx/nginx-repo.key > /etc/ssl/nginx/nginx-repo-bundle.crt\n```\n\n----------------------------------------\n\nTITLE: Obtaining OpenAPI Policy Template - Shell\nDESCRIPTION: This command retrieves an OpenAPI-ready policy template from a specified Docker image. It utilizes `docker run` with the `--rm` flag to remove the container after execution and uses the `cat` command to output the contents of the `NginxApiSecurityPolicy.json` file. Requires Docker to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker run --rm --entrypoint='' private-registry.nginx.com/nap/waf-compiler:1.0.0 cat /etc/app_protect/conf/NginxApiSecurityPolicy.json\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Plus (RHEL 7.4+)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Plus package from RHEL 7.4 and later. It uses the `yum remove` command to remove the `app-protect-module-plus` package. Requires root privileges and the yum package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_61\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum remove app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: NGINX Agent Environment Variables Usage\nDESCRIPTION: This example demonstrates how to set and use environment variables to configure the NGINX Agent.  The `export` command sets an environment variable named `ENV_VARIABLE_NAME` to a specific value, which the agent will then use when it is invoked. These variables override any configuration settings defined in configuration files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configuration-overview.md#_snippet_3\n\nLANGUAGE: sh\nCODE:\n```\nexport ENV_VARIABLE_NAME=\"value\"\nnginx-agent\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Ansible Role\nDESCRIPTION: This command installs the official Ansible role for NGINX from Ansible Galaxy. This role is used to automate the installation and configuration of NGINX Open Source and NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ec2-instances-for-nginx.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nansible-galaxy install nginxinc.nginx\n```\n\n----------------------------------------\n\nTITLE: Add Advanced Security Policy to Proxy via API (JSON)\nDESCRIPTION: This snippet shows the JSON request body for adding or updating an Advanced Security policy on a Proxy using the NGINX Management Suite REST API. The policyRef specifies the name of the NGINX App Protect policy to apply, and appProtectMode sets the enforcement mode (ENABLE or DISABLE). This snippet is intended for use with a PUT or POST request to the Proxies endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/advanced-security.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n     \"api-advanced-security\": [\n        {\n           \"action\": {\n              \"policyRef\": \"<my_policy_name_here>\",\n              \"appProtectMode\": \"<ENABLE|DISABLE>\"\n           }\n        }\n     ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Delete Resource from Group Request - NGINX Instance Manager\nDESCRIPTION: This bash command demonstrates how to remove a resource from a resource group using the NGINX Instance Manager REST API with a DELETE request.  It requires the resource group UID and the resource UID as path parameters and the module name as a query parameter.  Replace <NIM_FQDN>, {resourceGroupUid}, and {resourceUid} with actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/rbac/manage-resource-groups.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nDELETE https://<NIM_FQDN>/api/platform/v1/resource-groups/{resourceGroupUid}/resources/{resourceUid}?moduleName=Instance Manager\n```\n\n----------------------------------------\n\nTITLE: Configure gRPC Content Profile in Policy\nDESCRIPTION: Configures a gRPC content profile named `photo_service_profile` within a security policy. It enables attack signature and metacharacter checks, disables two specific signatures, limits the maximum data length to 100KB, disallows unknown fields, and references two IDL files: `album.proto` as the primary file and `common/messages.proto` as an imported file.  The imported file requires `importUrl` to correctly match.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/grpc-content-profiles.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"my-grpc-service-policy\",\n        \"grpc-profiles\": [\n            {\n                \"name\": \"photo_service_profile\",\n                \"associateUrls\": true,\n                \"defenseAttributes\": {\n                    \"maximumDataLength\": 100000,\n                    \"allowUnknownFields\": false\n                },\n                \"attackSignaturesCheck\": true,\n                \"signatureOverrides\": [\n                    {\n                        \"signatureId\": 200001213,\n                        \"enabled\": false\n                    },\n                    {\n                        \"signatureId\": 200089779,\n                        \"enabled\": false\n                    }\n                ],\n                \"metacharCheck\": true,\n                \"idlFiles\": [\n                    {\n                        \"idlFile\": {\n                            \"$ref\": \"file:///grpc_files/album.proto\"\n                        },\n                        \"isPrimary\": true\n                    },\n                    {\n                        \"idlFile\": {\n                            \"$ref\": \"file:///grpc_files/common/messages.proto\"\n                        },\n                        \"importUrl\": \"common\"\n                    }\n                ]\n            }\n        ],\n        \"urls\": [\n            {\n                \"name\": \"*\",\n                \"type\": \"wildcard\",\n                \"method\": \"*\",\n                \"$action\": \"delete\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure DNS Resolver (Nginx)\nDESCRIPTION: This snippet configures the DNS resolver within the `http` context of the Nginx configuration.  It's necessary for Nginx to resolve the Issuer URL during OIDC setup. The `valid` parameter specifies the TTL for DNS records.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/ping-identity.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Header Anomaly Mitigations - JSON\nDESCRIPTION: This JSON snippet shows how to override the score and action for header anomalies in an NGINX App Protect policy. It customizes the `scoreThreshold` and `action` for \"Suspicious HTTP Headers\" and \"Invalid HTTP Headers\" anomalies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/anti-automation.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"bot_anomalies_and_signatures\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"bot-defense\": {\n            \"mitigations\": {\n                \"anomalies\": [\n                    {\n                        \"name\": \"Suspicious HTTP Headers\",\n                        \"action\": \"alarm\",\n                        \"scoreThreshold\": 50\n                    },\n                    {\n                        \"name\": \"Invalid HTTP Headers\",\n                        \"action\": \"block\",\n                        \"scoreThreshold\": 99\n                    }\n                ]\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create Environment (JSON)\nDESCRIPTION: This snippet shows the JSON payload for creating an environment in API Connectivity Manager within an infrastructure workspace. The environment represents a deployment context for proxies. The minimum configuration requires a `name` and a `proxies` array, which specifies the instance group and hostnames for the proxy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/enable-metrics.md#_snippet_5\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"demo-env\",\n   \"proxies\": [\n      {\n         \"proxyClusterName\": \"test-ig\",\n         \"hostnames\": [\n            \"data-host\"\n         ]\n      }\n   ]\n}\n```\n\n----------------------------------------\n\nTITLE: Ignore Incoming and Outgoing Ports - YAML\nDESCRIPTION: This YAML snippet demonstrates how to specify ports to be ignored by the sidecar proxy for both incoming and outgoing traffic. It's added as annotations to the `PodTemplateSpec` in the resource definition. Replace `port1`, `port2`, etc. with the actual port numbers to ignore.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/inject-sidecar-proxy.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\nconfig.nsm.nginx.com/ignore-incoming-ports: \"port1, port2, ..., portN\"\nconfig.nsm.nginx.com/ignore-outgoing-ports: \"port1, port2, ..., portN\"\n```\n\n----------------------------------------\n\nTITLE: Defining Key-Value Zone with IP Type in Nginx\nDESCRIPTION: This configuration defines a key-value zone named 'one' with a size of 1MB and specifies that it will store IP addresses. The `type=ip` parameter enables matching of IP addresses against subnets or network ranges. This example also includes state persistence for the zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    keyval_zone zone=one:1m type=ip;\n }\n```\n\n----------------------------------------\n\nTITLE: KQL Query to View Raw Security Log Data\nDESCRIPTION: This KQL query extracts and displays the raw data from NGINX security logs within Azure Log Analytics. It extracts the JSON log from the message, parses it, and projects the resulting log data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/enable-logging.md#_snippet_5\n\nLANGUAGE: kql\nCODE:\n```\nNGXSecurityLogs\n| extend JSONLog = extract(@\"json_log\\s*=\\s*\\\"({.*?})\\\"\", 1, Message)\n| extend Log = parse_json(replace_string(JSONLog, '\"\"', '\"'))\n| project Log\n```\n\n----------------------------------------\n\nTITLE: Active Directory Group Search Filter (Wildcards)\nDESCRIPTION: This snippet demonstrates a group search filter utilizing wildcards (*) to match patterns. In this instance, it searches for groups where the Common Name (CN) includes the term 'Engineering'.  This allows you to dynamically match group names during AD integration in NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_8\n\nLANGUAGE: none\nCODE:\n```\n(&(objectClass=group)(CN=*Engineering*))\n```\n\n----------------------------------------\n\nTITLE: Disable App Security WAF Monitor-Only Mode (JSON)\nDESCRIPTION: This JSON payload is used to disable monitor-only mode for the App Security WAF policy, enabling traffic blocking based on the Violation Rating score. A POST or PUT request should be sent to the `/services/apps/components` REST API endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/set-waf-monitor-mode.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"metadata\": {...},\n  \"desiredState\": {\n    \"ingress\": {...},\n    \"security\": {\n       \"strategyRef\": {\n         \"ref\": \"/security/strategies/policyName\"\n       },\n        \"waf\": {\n            \"isEnabled\": true,\n            \"isMonitorOnly\": false\n        }\n    },\n    \"backend\": {...},\n    \"logging\": {...}\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Upgrading NGINX Gateway Fabric from OCI Registry\nDESCRIPTION: This command upgrades NGINX Gateway Fabric to the latest stable release using Helm from the OCI registry, in the 'nginx-gateway' namespace. Requires Helm 3.0+ and kubectl.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nhelm upgrade ngf oci://ghcr.io/nginx/charts/nginx-gateway-fabric -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: OpenSSL Server Configuration\nDESCRIPTION: This YAML configuration file defines settings for creating a server certificate for NGINX Instance Manager using OpenSSL. It specifies parameters such as key size (4096 bits), distinguished name fields, and extensions for the server certificate, including basic constraints (CA:FALSE), key usage (nonRepudiation, digitalSignature, keyEncipherment, keyAgreement), and extended key usage (serverAuth). It also includes subject alternative names (SANs) for DNS and IP addresses. The server certificate is intended for use with TLS encryption.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\n[req]\nprompt             = no\ndefault_bits       = 4096\nx509_extensions    = v3_req\nreq_extensions     = v3_req\ndefault_md         = sha256\ndistinguished_name = req_distinguished_name\n\n# recommend changing these to your needs\n[req_distinguished_name]\ncountryName                 = US\nstateOrProvinceName         = California\nlocalityName                = San Francisco\norganizationName            = NGINX, Inc.\ncommonName                  = nginx-manager.example.com\n\n[v3_req]\nbasicConstraints = CA:FALSE\nkeyUsage         = nonRepudiation, digitalSignature, keyEncipherment, keyAgreement\nextendedKeyUsage = critical, serverAuth\nsubjectAltName = @alt_names\n\n# apply any DNS or IP SANs as needed\n[alt_names]\nDNS.1 = <NGINX-INSTANCE-MANAGER-FQDN>\nIP.1 = <NGINX-INSTANCE-MANAGER-IP>\n```\n\n----------------------------------------\n\nTITLE: Omitting Dimensions with Empty List\nDESCRIPTION: This code snippet demonstrates how to omit dimensions from the response using `dimensions=` and aggregates all the values in all of the series of the `http.request.count` metric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/metrics?names=SUM(nginx.http.request.count)&startTime=now-12h&dimensions=\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Installing Logrotate on Debian/Ubuntu\nDESCRIPTION: This command installs the logrotate utility on Debian or Ubuntu systems. Logrotate helps manage log files by rotating them automatically.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/logs-overview.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get install logrotate\n```\n\n----------------------------------------\n\nTITLE: Loading Docker images from tar files\nDESCRIPTION: This snippet loads Docker images from tar files on the offline machine. It loads both the `waf-enforcer.tar` and `waf-config-mgr.tar` files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_42\n\nLANGUAGE: shell\nCODE:\n```\ndocker load -i waf-enforcer.tar\ndocker load -i waf-config-mgr.tar\n```\n\n----------------------------------------\n\nTITLE: Referencing External JSON Schema via HTTPS URL (JSON)\nDESCRIPTION: This example shows how to reference a JSON schema file hosted on a remote web server using an HTTPS URL.  This allows for centralized management and version control of the schema. The 'link' property within the `json-validation-files` array points to the external URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/handling-xml-and-json-content.md#_snippet_5\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"json-validation-files\": [\n        {\n            \"fileName\": \"person_schema.json\",\n            \"link\": \"https://git.mydomain.com/my_app/person_schema.json\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring X-Backend-Connection-Time header in Nginx\nDESCRIPTION: This snippet adds the X-Backend-Connection-Time header to the response, indicating the backend/upstream connection time. The $upstream_connect_time variable represents the time taken to establish a connection to the upstream server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-response-headers.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nadd_header X-Backend-Connection-Time $upstream_connect_time [always]\n```\n\n----------------------------------------\n\nTITLE: Retrieving Rejected or Flagged Security Violation Events for Component (curl)\nDESCRIPTION: This query retrieves security violation events where the request was either rejected or flagged for review by WAF, filtered by a specific application, environment, and component.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/view-app-security-analytics.md#_snippet_7\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n                category='security violation' and\n                request_outcome_reason in ('SECURITY_WAF_VIOLATION','SECURITY_WAF_FLAGGED') and\n                app='shopping' and\n                environment='prod' and\n                component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Agent - YAML\nDESCRIPTION: This configuration snippet shows how to enable advanced metrics in the `/etc/nginx-agent/nginx-agent.conf` file. It defines the `extensions`, `socket_path`, aggregation and publishing periods, and table size limits for the advanced metrics functionality.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-plus-advanced-metrics.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\nextensions:\n  - advanced-metrics\nadvanced_metrics:\n  socket_path: /var/run/nginx-agent/advanced-metrics.sock\n  aggregation_period: 1s\n  publishing_period: 3s\n  table_sizes_limits:\n    staging_table_max_size: 1000\n    staging_table_threshold: 1000\n    priority_table_max_size: 1000\n    priority_table_threshold: 1000\n```\n\n----------------------------------------\n\nTITLE: List Resource Groups Request - NGINX Instance Manager\nDESCRIPTION: This bash command shows how to retrieve a list of resource groups, optionally with resource details, using the NGINX Instance Manager REST API with a GET request. The `showDetails` query parameter controls whether resource details are included in the response. Replace <NIM_FQDN> with the fully qualified domain name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/rbac/manage-resource-groups.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nGET https://<NIM_FQDN>/api/platform/v1/resource-groups?showDetails=true\n```\n\n----------------------------------------\n\nTITLE: Extracting the Support Package (Bash)\nDESCRIPTION: Extracts the contents of a support package tar archive using the `tar` command. The archive is named with a timestamp.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/support/support-package.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ntar -xvf support-pkg-<timestamp>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Getting Database Entries using curl\nDESCRIPTION: This shell command uses curl to perform a GET request and retrieve all database entries from the specified keyval zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET 'http://www.example.com/api/6/http/keyvals/one'\n```\n\n----------------------------------------\n\nTITLE: Purging NGINX Cache via Curl Command (Shell)\nDESCRIPTION: This `curl` command demonstrates how to send an HTTP PURGE request to clear the Nginx cache for a specific URL or a set of resources (using a wildcard). It is using the PURGE http method. It includes the command and the resulting HTTP headers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_37\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X PURGE -D - \"http://www.example.com/*\"\nHTTP/1.1 204 No Content\nServer: nginx/1.5.12\nDate: Sat, 03 May 2014 16:33:04 GMT\nConnection: keep-alive\n```\n\n----------------------------------------\n\nTITLE: Adding Virtual IP Addresses (None)\nDESCRIPTION: This configuration block defines multiple virtual IP addresses that Keepalived will manage. These addresses are added to the interface when the node becomes the master.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_12\n\nLANGUAGE: none\nCODE:\n```\nvirtual_ipaddress {\n    192.168.100.150\n    192.168.100.200\n}\n```\n\n----------------------------------------\n\nTITLE: Deploy Coffee HTTPRoute\nDESCRIPTION: Deploys the `coffee` HTTPRoute using `kubectl apply`. This HTTPRoute configures traffic routing for the coffee applications based on path, headers, and query parameters. It references the 'cafe' gateway and defines rules for routing requests to `coffee-v1-svc` and `coffee-v2-svc`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: coffee\nspec:\n  parentRefs:\n  - name: cafe\n    sectionName: http\n  hostnames:\n  - cafe.example.com\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /coffee\n    backendRefs:\n    - name: coffee-v1-svc\n      port: 80\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /coffee\n      headers:\n      - name: version\n        value: v2\n    - path:\n        type: PathPrefix\n        value: /coffee\n      queryParams:\n      - name: TEST\n        value: v2\n    backendRefs:\n    - name: coffee-v2-svc\n      port: 80\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTPS Virtual Server (Nginx)\nDESCRIPTION: This snippet configures a virtual server for HTTPS traffic on port 443 within the 'http' block. It enables SSL/TLS and sets up a status zone for monitoring. The `listen` directive specifies the port and the `ssl` parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_32\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nserver {\n    listen 443 ssl;\n    status_zone exchange-combined;\n}\n```\n\n----------------------------------------\n\nTITLE: Enable Developer Portal Service\nDESCRIPTION: Enables the `nginx-devportal.service` using `systemctl`, ensuring that the service starts automatically on boot.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl enable nginx-devportal.service\n```\n\n----------------------------------------\n\nTITLE: Configure DNS Resolver in NGINX\nDESCRIPTION: This configuration snippet sets up a DNS resolver within the `http` context of the NGINX configuration. It uses the `resolver` directive to specify the DNS server IP address and sets options like IPv4 preference and TTL validation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/cognito.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Manage NGINX Controller Process (start, stop, restart, status)\nDESCRIPTION: These commands use the `helper.sh` script to manage the NGINX Controller process. Options include starting, stopping, restarting, and checking the status of the controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh controller start\n/opt/nginx-controller/helper.sh controller stop\n/opt/nginx-controller/helper.sh controller restart\n/opt/nginx-controller/helper.sh controller status\n```\n\n----------------------------------------\n\nTITLE: Root Directory Configuration in Nginx\nDESCRIPTION: This snippet demonstrates how to configure the root directory for a virtual server and specific locations within it. The `root` directive specifies the base directory for serving files based on the request URI.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    root /www/data;\n\n    location / {\n    }\n\n    location /images/ {\n    }\n\n    location ~ \\.(mp3|mp4) {\n        root /www/media;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Security Log Destination\nDESCRIPTION: This example shows how to configure the security log destination to be under `/var/log/app_protect/`. This configuration enables the security logs to be included in the log rotation process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/logs-overview.md#_snippet_4\n\nLANGUAGE: none\nCODE:\n```\napp_protect_security_log_enable on;\n  app_protect_security_log \"/opt/app_protect/share/defaults/log_illegal.json\" /var/log/app_protect/security.log;\n```\n\n----------------------------------------\n\nTITLE: Running NGINX Instance Manager Backup Script (./backup.sh)\nDESCRIPTION: This command executes the backup script to create a backup of NGINX Instance Manager configuration files, secrets, and databases. The script is located in `/etc/nms/scripts`. It creates a tarball backup in the `/tmp` directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo ./backup.sh\n```\n\n----------------------------------------\n\nTITLE: Set NGINX Configuration File Path\nDESCRIPTION: This code snippet shows how to explicitly set the path to the NGINX configuration file (`nginx.conf`) in the `agent.conf` file. This is used as a workaround if the agent cannot automatically detect the file's location. Modifying this setting should be done with caution, as it can adversely affect system performance if not configured correctly. NGINX Support should be contacted if issues persist.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-the-agent.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\n[nginx]\nconfigfile = /etc/nginx/nginx.conf\n```\n\n----------------------------------------\n\nTITLE: Installing Nginx and App Protect WAF (Shell)\nDESCRIPTION: Installs Nginx and the Nginx App Protect WAF v5 module. This command first updates the APT package index to reflect the newly added repositories. It then installs Nginx with a specified version and installs the app-protect-module-oss package, including the appropriate version tag based on the distribution release code.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-debian.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get update\nsudo apt-get install nginx=1.25.5-1~`lsb_release -cs` app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Invalid Gateway Error\nDESCRIPTION: This error message is displayed when a Gateway resource is invalid according to the CEL validation rules. In this case, a hostname is specified for a TCP listener, which is not allowed.  This validation is performed by the Kubernetes API server during resource creation or update.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/resource-validation.md#_snippet_3\n\nLANGUAGE: text\nCODE:\n```\nThe Gateway \"some-gateway\" is invalid: spec.listeners: Invalid value: \"array\": hostname must not be specified for protocols ['TCP', 'UDP']\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent on Alpine Linux\nDESCRIPTION: This command installs the NGINX Agent package on Alpine Linux using the `apk` package manager. It requires `sudo` (or root privileges) to install the package system-wide. The `<agent-version>` placeholder should be replaced with the actual version of the downloaded package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-github.md#_snippet_3\n\nLANGUAGE: Shell\nCODE:\n```\nsudo apk add nginx-agent-<agent-version>.apk\n```\n\n----------------------------------------\n\nTITLE: Get NFS Volume Details (Bash)\nDESCRIPTION: This command uses `mount` and `grep` to find information about NFS mounts. It filters the output of `mount` to only show lines containing \"nfs\".  The output is used to identify the NFS server and path where the backup files are stored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-embedded-config-db.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nmount | grep nfs\n```\n\n----------------------------------------\n\nTITLE: HTTPRoute Matching Rule - YAML\nDESCRIPTION: This YAML snippet demonstrates a basic HTTPRoute matching rule. It defines how incoming requests with a specific path prefix are routed to a backend service. The `backendRefs` section specifies the target service name and port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/upgrade-apps-without-downtime.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\n- matches:\n    - path:\n        type: PathPrefix\n        value: /\n  backendRefs:\n    - name: my-app\n      port: 80\n```\n\n----------------------------------------\n\nTITLE: Create secure-app application\nDESCRIPTION: This YAML configuration creates a Deployment, Service, ConfigMap, and Secret for the secure-app application. The Deployment defines a pod with an nginx-hello image that serves HTTPS traffic on port 8443. The Service exposes the application, and the ConfigMap configures Nginx. The Secret stores the TLS certificate and key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/tls-passthrough.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: secure-app\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: secure-app\n  template:\n    metadata:\n      labels:\n        app: secure-app\n    spec:\n      containers:\n        - name: secure-app\n          image: nginxdemos/nginx-hello:plain-text\n          ports:\n            - containerPort: 8443\n          volumeMounts:\n            - name: secret\n              mountPath: /etc/nginx/ssl\n              readOnly: true\n            - name: config-volume\n              mountPath: /etc/nginx/conf.d\n      volumes:\n        - name: secret\n          secret:\n            secretName: app-tls-secret\n        - name: config-volume\n          configMap:\n            name: secure-config\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: secure-app\nspec:\n  ports:\n    - port: 8443\n      targetPort: 8443\n      protocol: TCP\n      name: https\n  selector:\n    app: secure-app\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: secure-config\ndata:\n  app.conf: |-\n    server {\n      listen 8443 ssl;\n      listen [::]:8443 ssl;\n\n      server_name app.example.com;\n\n      ssl_certificate /etc/nginx/ssl/tls.crt;\n      ssl_certificate_key /etc/nginx/ssl/tls.key;\n\n      default_type text/plain;\n\n      location / {\n        return 200 \"hello from pod \\$hostname\\n\";\n      }\n    }\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: app-tls-secret\ndata:\n  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURGRENDQWZ3Q0NRQ3EzQWxhdnJiaWpqQU5CZ2txaGtpRzl3MEJBUXNGQURCTU1Rc3dDUVlEVlFRR0V3SlYKVXpFTE1Ba0dBMVVFQ0F3Q1EwRXhGakFVQmdOVkJBY01EVk5oYmlCR2NtRnVZMmx6WTI4eEdEQVdCZ05WQkFNTQpEMkZ3Y0M1bGVHRnRjR3hsTG1OdmJUQWVGdzB5TURBek1qTXlNekl3TkROYUZ3MHlNekF6TWpNeU16SXdORE5hCk1Fd3hDekFKQmdOVkJBWVRBbFZUTVFzd0NRWURWUVFJREFKRFFURVdNQlFHQTFVRUJ3d05VMkZ1SUVaeVlXNWoKYVhOamJ6RVlNQllHQTFVRUF3d1BZWEJ3TG1WNFlXMXdiR1V1WTI5dE1JSUJJakFOQmdrcWhraUc5dzBCQVFFRgpBQU9DQVE4QU1JSUJDZ0tDQVFFQTJCRXhZR1JPRkhoN2VPMVlxeCtWRHMzRzMrVEhyTEZULzdEUFFEQlkza3pDCi9oZlprWCt3OW1NNkQ1RU9uK2lpVlNhUWlQMm1aNFA3N29pR0dmd3JrNjJ0eEQ5cHphODM5NC9aSjF5Q0dXZ1QKK2NWUEVZbkxjQktzSTRMcktJZ21oWVIwUjNzWWRjR1JkSXJWUFZlNUVUQlk1Z1U0RGhhMDZOUEIraitmK0krWgphWGIvMlRBekJhNHozMWpIQzg2amVQeTFMdklGazFiY3I2cSsxRGR5eklxcWxkRDYvU3Q4Q2t3cDlOaDFCUGFhCktZZ1ZVd010UVBib2s1cFFmbVMrdDg4NHdSM0dTTEU4VkxRbzgyYnJhNUR3emhIamlzOTlJRGhzbUt0U3lWOXMKaWNJbXp5dHBnSXlhTS9zWEhRQU9KbVFJblFteWgyekd1WFhTQ0lkRGtRSURBUUFCTUEwR0NTcUdTSWIzRFFFQgpDd1VBQTRJQkFRQ0tsVkhOZ1k5VHZLaW9Xb0tvdllCdnNRMmYrcmFOOEJwdWNDcnRvRm15NUczcGIzU2lPTndaCkF2cnhtSm4vR3lsa3JKTHBpQVA1eUNBNGI2Y2lYMnRGa3pQRmhJVFZKRTVBeDlpaEF2WWZwTUFSdWVqM29HN2UKd0xwQk1iUnlGbHJYV29NWUVBMGxsV0JueHRQQXZYS2Y4SVZGYTRSSDhzV1JJSDB4M2hFdjVtQ3VUZjJTRTg0QwpiNnNjS3Z3MW9CQU5VWGxXRVZVYTFmei9rWWZBa1lrdHZyV2JUcTZTWGxodXRJYWY4WEYzSUMrL2x1b3gzZThMCjBBcEFQVE5sZ0JwOTkvcXMrOG9PMWthSmQ1TmV6TnlJeXhSdUtJMzlDWkxuQm9OYmkzdlFYY1NzRCtYU2lYT0cKcEVnTjNtci8xRms4OVZMSENhTnkyKzBqMjZ0eWpiclcKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\n  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRFlFVEZnWkU0VWVIdDQKN1Zpckg1VU96Y2JmNU1lc3NWUC9zTTlBTUZqZVRNTCtGOW1SZjdEMll6b1BrUTZmNktKVkpwQ0kvYVpuZy92dQppSVlaL0N1VHJhM0VQMm5OcnpmM2o5a25YSUlaYUJQNXhVOFJpY3R3RXF3amd1c29pQ2FGaEhSSGV4aDF3WkYwCml0VTlWN2tSTUZqbUJUZ09GclRvMDhINlA1LzRqNWxwZHYvWk1ETUZyalBmV01jTHpxTjQvTFV1OGdXVFZ0eXYKcXI3VU4zTE1pcXFWMFByOUszd0tUQ24wMkhVRTlwb3BpQlZUQXkxQTl1aVRtbEIrWkw2M3p6akJIY1pJc1R4VQp0Q2p6WnV0cmtQRE9FZU9LejMwZ09HeVlxMUxKWDJ5SndpYlBLMm1Bakpveit4Y2RBQTRtWkFpZENiS0hiTWE1CmRkSUloME9SQWdNQkFBRUNnZ0VCQUxYaW16ODZrT1A0bkhBcTFPYVEyb2l3dndhQTczbTNlUytZSm84eFk4NFcKcmxyNXRzUWR5dGxPcEhTd05yQjBSQnNNTU1XeFNPQ0JJWlltUlVVZ200cGd2Uk9rRWl2OG9VOThQMkE4SnFTKwprWHBFRjVCNi84K2pXRmM0Z1Q4SWhlMEZtR0VJQllvelhYL08wejBsV0h4WXg2MHluWUoycU9vS1FKT3A5YjlsCmpiUVBkaC9mN2ErRWF0RzZNUFlrNG5xSEY3a0FzcmNsRXo2SGUvaEx6NmRkSTJ1N2RMRjB6QlN0QjM5WDFRZysKZ1JzTittOXg1S1FVTXYxMktvajdLc2hEelozOG5hSjd5bDgycGhBV1lGZzBOZHlzRlBRbmt0WmlNSUxOblFjNwpOeUt0cHNQaUxIRE9ha05hdEZLU2lOaUJrUk1lY1ZUMlJNMzMzUG54bFVFQ2dZRUEvYTY5MEEralU4VFJNbVZyCk4vRnlYWkxYa1c5b2NxVjBRbTA0TDMrSExybFNCTlRWSzk2U1pVT203VjViTzIxNmd4S2dJK3IwYm5kdE5GTUQKLzFncDhsdlJNcUlIeGZTeUo4SHpsSzViT0lnaUpxRGhzK3BKWTZmLytIVzZ1QkZyN3NGS3lxbVlIQlA0SC9BdApsT3lLeEVjMHFXazFlT2tCMWNNSGx0WDRwemtDZ1lFQTJncDhDVDVYWjNMSWRQN2M1SHpDS1YwczBYS1hGNmYyCkxzclhPVlZaTmJCN1NIS1NsOTBIU2VWVGx3czdqSnNxcC9yWFY2aHF0eUdEaTg4aTFZekthcEF6dXl3b0U3TnEKMUJpd2ZYSURQeTlPNUdGNXFYNXFUeENzSWNIcmo2Z21XMEZVQWhoS1lQcDRxd1JMdzFMZkJsd3U1VmhuN3I3ego0SkZBTEFpdlp4a0NnWUJicnpuKzVvZjdFSmtqQTdDYWlYTHlDczVLUzkrTi8rcGl6NktNMkNSOWFKRVNHZkhwClp3bTErNXRyRXIwYVgxajE0bGRxWTlKdjBrM3ZxVWs2a2h5bThUUk1mbThjeG5GVkdTMzF3SVpMaWpmOWlndkkKd0paQnBFaEkvaE83enVBWmJGYWhwR1hMVUJSUFJyalNxQ01IQ1UwcEpWTWtIZUtCNVhqcXRPNm5VUUtCZ0NJUAp6VHlzYm44TW9XQVZpSEJ4Uk91dFVKa1BxNmJZYUU3N0JSQkIwd1BlSkFRM1VjdERqaVh2RzFYWFBXQkR4VEFrCnNZdFNGZ214eEprTXJNWnJqaHVEbDNFLy9xckZOb1VYcmtxS2l4Tk4wcWMreXdDOWJPSVpHcXJUWG5jOHIzRkcKRFZlZWI5QWlrTU0ya3BkYTFOaHJnaS8xMVphb1lmVE0vQmRrNi9IUkFvR0JBSnFzTmFZYzE2clVzYzAzUEwybApXUGNzRnZxZGI3SEJyakVSRkhFdzQ0Vkt2MVlxK0ZWYnNNN1FTQVZ1V1llcGxGQUpDYzcrSEt1jRsa1hRM1RkCndSajJLK2pOUzJtUXp1Y2hOQnlBZ1hXVnYveHhMZEE3NnpuWmJYdjl5cXhnTVVjTVZwZGRuSkxVZm9QVVZ1dTcKS0tlVVU3TTNIblRKUStrcldtbUxraUlSCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K\nEOF\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Gateway Fabric (AWS NLB)\nDESCRIPTION: This command deploys NGINX Gateway Fabric with NGINX OSS and an AWS Network Load Balancer (NLB) service. It relies on a specific deployment manifest tailored for AWS NLB integration from the nginx-gateway-fabric repository. This setup requires pre-existing AWS infrastructure and appropriate Kubernetes configuration. This command uses `kubectl apply` to apply the configurations specified in the remote YAML file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/deploy/aws-nlb/deploy.yaml\n```\n\n----------------------------------------\n\nTITLE: Load NGINX JavaScript Module\nDESCRIPTION: This configuration directive loads the NGINX JavaScript module.  It should be added to the top-level (main) section of the `/etc/nginx/nginx.conf` file. This enables the use of njs scripts in NGINX configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/microsoft-entra-setup.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\n```\n\n----------------------------------------\n\nTITLE: Update Proxy for JWT Forwarding\nDESCRIPTION: This example demonstrates how to update the proxy configuration to forward the entire JWT token to the backend using `action.forwardToken`. It involves sending a PUT request to the API with the updated proxy settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_58\n\nLANGUAGE: bash\nCODE:\n```\nPUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy\n```\n\n----------------------------------------\n\nTITLE: Setting Up APK Repository for NGINX Agent\nDESCRIPTION: This command configures the apk package manager to use the NGINX Agent repository. It constructs the repository URL based on the Alpine Linux version and adds it to the /etc/apk/repositories file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_23\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"%s%s%s\\n\" \\\n        \"http://packages.nginx.org/nginx-agent/alpine/v\" \\\n        `grep -o -E '^[0-9]+\\.[0-9]+' /etc/alpine-release` \\\n        \"/main\" \\\n        | sudo tee -a /etc/apk/repositories\n```\n\n----------------------------------------\n\nTITLE: Upgrade Gateway API Resources (Standard Channel) - Shell\nDESCRIPTION: This command upgrades Gateway API resources using the standard channel configuration from the NGINX Gateway Fabric repository. It uses kubectl kustomize to fetch the configuration and kubectl apply to apply it to the cluster.  It requires kubectl to be installed and configured to connect to the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/upgrade-api-resources.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl kustomize \"https://github.com/nginx/nginx-gateway-fabric/config/crd/gateway-api/standard?ref=v{{< version-ngf >}}\" | kubectl apply -f -\n```\n\n----------------------------------------\n\nTITLE: Sending HTTP Traffic to Secure App\nDESCRIPTION: This shell command sends an HTTP request to the secure-app application using `curl`. It resolves the hostname 'secure-app.example.com' to the specified IP address and port using the `--resolve` option. This request demonstrates what happens when plain HTTP traffic is sent to a backend service that expects HTTPS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/securing-backend-traffic.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve secure-app.example.com:$GW_PORT:$GW_IP http://secure-app.example.com:$GW_PORT/\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Access Log\nDESCRIPTION: This snippet shows how to configure NGINX to use the `main_ext` log format for the access log.  By setting the `access_log` directive to use the custom format, NGINX will log detailed request information to the specified file. This is a prerequisite for collecting extended metrics using Nginx Amplify.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\naccess_log  /var/log/nginx/access.log  main_ext;\n```\n\n----------------------------------------\n\nTITLE: Listing WAF Configuration Manager Tags\nDESCRIPTION: This command retrieves and displays the list of available tags for the NGINX App Protect WAF configuration manager image from the private registry. It uses `curl` to make the request, authenticates with provided certificate and key, and formats the output using `jq`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://private-registry.nginx.com/v2/nap/waf-config-mgr/tags/list --key <nginx-repo.key> --cert <nginx-repo.crt> | jq\n```\n\n----------------------------------------\n\nTITLE: Create Admin Password File (Shell)\nDESCRIPTION: Creates a file named `admin_password.txt` containing the initial password for the NGINX Instance Manager admin user. This password is then used during deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\necho \"admin\" > admin_password.txt\n```\n\n----------------------------------------\n\nTITLE: Copying Modified Configuration Files Back\nDESCRIPTION: These commands copy the modified configuration files from `/tmp` back to their original locations. This applies the OIDC configuration changes. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nsudo cp /tmp/nms-http.conf /etc/nginx/conf.d/nms-http.conf\nsudo cp /tmp/openid_configuration.conf /etc/nms/nginx/oidc/openid_configuration.conf\n```\n\n----------------------------------------\n\nTITLE: Configure App Protect DoS Monitor - Shell\nDESCRIPTION: This snippet shows how to correctly configure the `app_protect_dos_monitor` directive.  The port configuration must correspond to the port the server is listening on to avoid false attack declarations. For example, if the server listens on port 8080, the monitor directive should include \":8080\".\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-3.1.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nserver {\n    listen 8080;\n    location / {  app_protect_dos_monitor \"myservice.com:8080\";  }\n}\n```\n\n----------------------------------------\n\nTITLE: Get OS version (Shell)\nDESCRIPTION: This command retrieves the operating system version and kernel information, saving it to `system_version.txt`. It gathers information from `/etc/os-release`, `uname -r`, and `/proc/version`, appending each to the file.  This is part of the process of collecting troubleshooting information to send to customer support.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/troubleshooting-guide/how-to-troubleshoot.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ncat /etc/os-release > system_version.txt && uname -r >> system_version.txt && cat /proc/version >> system_version.txt\n```\n\n----------------------------------------\n\nTITLE: Example GatewayClass Status output\nDESCRIPTION: This is example output from `kubectl describe gatewayclasses nginx`. It shows the `ResolvedRefs` condition in the status, indicating that the parametersRef resource (NginxProxy) is resolved successfully. This confirms the configuration is valid.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/data-plane-configuration.md#_snippet_3\n\nLANGUAGE: text\nCODE:\n```\n...\nStatus:\n  Conditions:\n     ...\n    Message:               parametersRef resource is resolved\n    Observed Generation:   1\n    Reason:                ResolvedRefs\n    Status:                True\n    Type:                  ResolvedRefs\n```\n\n----------------------------------------\n\nTITLE: Specifying the Mail Server Name\nDESCRIPTION: This snippet shows how to specify the server name for your mail server using the `server_name` directive within the `mail` context. The server name is used to identify the mail server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nmail {\n       server_name mail.example.com;\n        #...\n    }\n```\n\n----------------------------------------\n\nTITLE: Creating Security Log Profile with POST - Shell\nDESCRIPTION: This snippet shows how to upload a new security log profile using a POST request to the `/api/platform/v1/security/logprofiles` endpoint. The example curl command includes an authorization header with a bearer token and specifies a JSON file (`default-log-example.json`) to be sent as the request body. Requires a valid access token and `default-log-example.json` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X POST https://{{NIM_FQDN}}/api/platform/v1/security/logprofiles \\\n    -H \"Authorization: Bearer <access token>\" \\\n    -d @default-log-example.json\n```\n\n----------------------------------------\n\nTITLE: Query Metric with Time Window\nDESCRIPTION: This cURL command queries the Metrics API for `http.request.count` within a specific time window. It retrieves all recorded metric values for the last three hours, as indicated by `startTime=now-3h`. If `endTime` is omitted, it defaults to the current time.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=http.request.count&startTime=now-3h\"\n```\n\n----------------------------------------\n\nTITLE: Login to NGINX Controller API\nDESCRIPTION: This curl command logs in to the NGINX Controller API and stores the session cookie in `cookie.txt`. Replace `198.51.100.10`, `arthur@example.net`, and `<password>` with appropriate values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncurl -c cookie.txt -X POST --url 'https://198.51.100.10/api/v1/platform/login' --header 'Content-Type: application/json' --data '{\"credentials\": {\"type\": \"BASIC\",\"username\": \"arthur@example.net\",\"password\": \"<password>\"}}'\n```\n\n----------------------------------------\n\nTITLE: Create Kubernetes Deployment and Get YAML (Bash)\nDESCRIPTION: This snippet shows how to create a Kubernetes deployment using the `kubectl create deployment` command and then retrieve the deployment's YAML configuration using `kubectl get deploy -o yaml`.  This is useful for inspecting and modifying the deployment configuration, such as setting the `imagePullPolicy`.  Requires `kubectl` command-line tool to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-containerized-instances.md#_snippet_7\n\nLANGUAGE: Bash\nCODE:\n```\nkubectl create deployment hello-node --image=yourusername/yourimagename\nkubectl get deploy hello-node -o yaml\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Gateway Fabric (OpenShift)\nDESCRIPTION: This command deploys NGINX Gateway Fabric with NGINX OSS on OpenShift.  It utilizes a specific deployment manifest tailored for OpenShift environments from the nginx-gateway-fabric repository. It uses `kubectl apply` to apply the configurations defined in the remote YAML file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/deploy/openshift/deploy.yaml\n```\n\n----------------------------------------\n\nTITLE: Setting OIDC Headers\nDESCRIPTION: This YAML snippet configures Nginx to pass OIDC-related headers to the upstream application. It sets headers for user, groups, and external ID using JWT claims. Requires correct configuration of OIDC authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_10\n\nLANGUAGE: yaml\nCODE:\n```\n# OIDC: use email as a unique identifier\n# NOTE: the username is dependent upon claims provided by your IdP\nproxy_set_header Nginx-Management-Suite-Auth \"OIDC\";\nproxy_set_header Nginx-Management-Suite-User $user_email;\nproxy_set_header Nginx-Management-Suite-Groups $groups_claim;\nproxy_set_header Nginx-Management-Suite-ExternalId $jwt_claim_sub;\n```\n\n----------------------------------------\n\nTITLE: Enable ModSecurity Rule Execution\nDESCRIPTION: This Nginx configuration snippet shows how to enable the ModSecurity rule engine.  It comments out the `SecRuleEngine DetectionOnly` directive (if it exists) and adds the `SecRuleEngine On` directive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\n# SecRuleEngine DetectionOnly\nSecRuleEngine On\n```\n\n----------------------------------------\n\nTITLE: Configure Developer Portal TLS Certificates\nDESCRIPTION: Configures the location of the server certificate and certificate key in the Dev Portal configuration file, used for securing API communication. It includes setting `INSECURE_MODE` to false and configuring `CA_FILE` and `CLIENT_VERIFY` for mTLS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_14\n\nLANGUAGE: yaml\nCODE:\n```\nCERT_FILE=\"/path/to/devportal-server.crt\"\nKEY_FILE=\"/path/to/devportal-server.key\"\nINSECURE_MODE=false\nCA_FILE=\"/path/to/ca.pem\"  # If using mTLS\nCLIENT_VERIFY=true # If using mTLS\n```\n\n----------------------------------------\n\nTITLE: Restart Keepalived to Trigger Failover\nDESCRIPTION: This snippet restarts the `keepalived` service on the primary server to simulate a failure and trigger failover to the secondary server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart keepalived\n```\n\n----------------------------------------\n\nTITLE: Enabling Insecure Mode via Config File - Bash\nDESCRIPTION: This snippet shows how to enable insecure mode by modifying the `/etc/nginx-agent/nginx-agent.conf` configuration file. It sets the `tls.enable` option to `false` to disable TLS entirely.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/encrypt-communication.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\ntls:\n  enable: false\n```\n\n----------------------------------------\n\nTITLE: Obtaining Nginx Worker Process PID\nDESCRIPTION: This command retrieves the process ID (PID) of the Nginx worker process, which is required to attach the GDB debugger and extract the debug log from memory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nps axu |grep nginx\n```\n\n----------------------------------------\n\nTITLE: Downloading Apt Configuration File\nDESCRIPTION: Downloads the apt configuration file for the NGINX repository and saves it to the `/etc/apt/apt.conf.d` directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-debian.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Gateway Fabric CRDs (Edge)\nDESCRIPTION: This command deploys the NGINX Gateway Fabric Custom Resource Definitions (CRDs) using the edge version manifest from the nginx-gateway-fabric repository. Applying these CRDs is a prerequisite for deploying NGINX Gateway Fabric itself. It uses `kubectl apply` to apply the configurations defined in the remote YAML file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/main/deploy/crds.yaml\n```\n\n----------------------------------------\n\nTITLE: Configure Demo Web Application\nDESCRIPTION: This configuration creates a simple Nginx web server that listens on localhost port 8085. It returns an HTTP 200 OK status code with a message containing the requested URI.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen localhost:8085;\n    location / {\n        default_type text/plain;\n        return 200 \"Thank you for requesting ${request_uri}\\n\";\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Prepare Usage Report via REST API (curl)\nDESCRIPTION: This curl command prepares a telemetry usage report in zip format using the NGINX Instance Manager REST API. It sends a request to the `/api/platform/v1/report/download` endpoint with specific headers for authorization and content type. The `-k` flag disables SSL certificate validation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/report-usage-disconnected-deployment.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncurl -k --location 'https://<NIM-FQDN>/api/platform/v1/report/download?format=zip&reportType=telemetry&telemetryAction=prepare' \\\n--header 'accept: application/json' \\\n--header 'authorization: Basic <base64-encoded-credentials>' \\\n--header 'referer: https://<NIM-FQDN>/ui/settings/license'\n```\n\n----------------------------------------\n\nTITLE: Uninstall Dynamic Module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This command uninstalls the specified dynamic module using the dnf package manager. It requires sudo privileges and the correct dynamic module name. The command removes the module package from the system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/uninstall.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf remove <dynamic_module_name>\n```\n\n----------------------------------------\n\nTITLE: Enable Keepalived Service on System Startup\nDESCRIPTION: This command enables the keepalived service to start automatically when the system restarts. It uses systemctl to manage the keepalived.service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/ha-data-plane.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl enable keepalived.service\n```\n\n----------------------------------------\n\nTITLE: Creating Self-Signed Certificate OpenSSL\nDESCRIPTION: This snippet creates a self-signed certificate using OpenSSL, based on the generated private key. The `-new` and `-x509` parameters are used to create a new self-signed certificate. The `-key` option specifies the private key file. The `-out` option specifies the output certificate file. The `-days` option sets the validity period for the certificate.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl req -new -x509 -key ~/private-key.pem -out ~/self-cert.pem -days 10950\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Instance Manager with Docker Compose (Shell)\nDESCRIPTION: This command deploys NGINX Instance Manager using Docker Compose. The `-d` flag runs the containers in detached mode.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-forward-proxy.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ndocker compose up -d\n```\n\n----------------------------------------\n\nTITLE: WebSocket Component Request Header Modification\nDESCRIPTION: This snippet configures a component to forward WebSocket upgrade headers. It adds 'Upgrade' and 'Connection' headers with values from $http_upgrade and $connection_upgrade variables respectively, ensuring proper WebSocket handshaking between the client and backend.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-snippets.md#_snippet_6\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"<component-name>\",\n    },\n    \"desiredState\": {\n        \"ingress\": {\n            \"uris\": {\n                \"/\": {}\n            },\n            \"gatewayRefs\": [\n                {\"ref\": \"/services/environments/${env}/gateways/<gateway-name>\"}\n            ]\n        },\n        \"programmability\": {\n            \"requestHeaderModifications\": [\n                {\n                    \"action\": \"ADD\",\n                    \"headerName\": \"Upgrade\",\n                    \"headerValue\": \"$http_upgrade\"\n                },\n                {\n                    \"action\": \"ADD\",\n                    \"headerName\": \"Connection\",\n                    \"headerValue\": \"$connection_upgrade\"\n                }\n            ]\n        },\n        \"backend\": {\n            \"workloadGroups\": {\n                \"websocket\": {\n                    \"uris\": {\n                        \"http://<data-host-name>:8010\": {}\n                    }\n                }\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install apt Utils (Debian - Shell)\nDESCRIPTION: This command installs the necessary apt utilities on Debian systems. These utilities include `apt-transport-https` for accessing HTTPS repositories, `lsb-release` for determining the Linux distribution, `ca-certificates` for verifying SSL certificates and `wget` for downloading files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get install apt-transport-https lsb-release ca-certificates wget\n```\n\n----------------------------------------\n\nTITLE: Install Cookie-Flag Module on Amazon Linux, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This shell script updates the system and installs the nginx-plus-module-cookie-flag package using yum. It assumes that the yum package manager is available and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/cookie-flag.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-cookie-flag\n```\n\n----------------------------------------\n\nTITLE: Check Sidecar Logs for UDP Traffic\nDESCRIPTION: This command checks the logs of the `nginx-mesh-sidecar` container within the `udp-listener` Pod. It uses `kubectl` to retrieve the logs and filters for the sidecar container. The expected output includes a line indicating UDP traffic with a 200 status code and the size of the packet, confirming that the sidecar proxy handled the UDP message.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-udp-walkthrough.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nkubectl logs udp-listener-59665d7ffc-drzh2 -c nginx-mesh-sidecar\n...\n2022/01/22 00:09:31 SVID updated for spiffeID: \"spiffe://example.org/ns/default/sa/default\"\n2022/01/22 00:09:31 Enqueueing event: SPIRE, key: 0xc00007ac00\n2022/01/22 00:09:31 Dequeueing event: SPIRE, key: 0xc00007ac00\n2022/01/22 00:09:31 Reloading nginx with configVersion: 2\n2022/01/22 00:09:31 executing nginx -s reload\n2022/01/22 00:09:32 success, version 2 ensured. iterations: 4. took: 100ms\n[08/Feb/2022:19:49:02 +0000] 10.116.0.26:41802 UDP 200 0 49 0.000 \"127.0.0.1:5005\" \"21\" \"0\" \"0.000\"\n```\n\n----------------------------------------\n\nTITLE: Get Kubernetes Node IP\nDESCRIPTION: This command retrieves the IP address of a Kubernetes worker node. It uses `kubectl` to query the Kubernetes cluster for node information and displays it in a wide format, which includes the internal and external IP addresses. This IP is used to send UDP traffic to the exposed port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-udp-walkthrough.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n$ kubectl get node -o wide\nNAME                                     ... INTERNAL-IP     EXTERNAL-IP ...\ngke-aidan-dev-default-pool-f507f772-qiun ... 10.128.15.210   12.115.30.1  ...\ngke-aidan-dev-default-pool-f507f772-tjpo ... 10.128.15.211   12.200.3.8  ...\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Gateway Fabric (NGINX Plus)\nDESCRIPTION: This command deploys NGINX Gateway Fabric with NGINX Plus, pulling the image from the NGINX Plus Docker registry. It uses `imagePullSecretName` for pulling the image and requires an NGINX Plus JWT Secret, specified in a volume mount and `--usage-report-secret` parameter, created in the \"Before you begin\" section. This command uses `kubectl apply` to apply the configurations specified in the remote YAML file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/deploy/nginx-plus/deploy.yaml\n```\n\n----------------------------------------\n\nTITLE: Creating HTML Page\nDESCRIPTION: Defines an HTML page that displays server information.  Includes JavaScript for enabling auto-refresh functionality via cookies, as well as CSS styling for the page layout.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/setting-up-nginx-demo-environment.md#_snippet_4\n\nLANGUAGE: html\nCODE:\n```\n<!DOCTYPE html>\n<html>\n    <head>\n        <title>Hello World - App X <!-- Replace 'X' with '1' or '2' as appropriate --></title>\n        <link href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAGPElEQVR42u1bDUyUdRj/iwpolMlcbZqtXFnNsuSCez/OIMg1V7SFONuaU8P1MWy1lcPUyhK1uVbKcXfvy6GikTGKCmpEyoejJipouUBcgsinhwUKKKJ8PD3vnzsxuLv35Q644+Ue9mwH3P3f5/d7n6/3/3+OEJ/4xCc+8YQYtQuJwB0kIp+JrzUTB7iJuweBf4baTlJ5oCqw11C/JHp+tnqBb1ngT4z8WgReTUGbWCBGq0qvKRFcHf4eT/ZFBKoLvMBGIbhiYkaQIjcAfLAK+D8z9YhjxMgsVUGc84+gyx9AYD0khXcMfLCmUBL68HMZ+PnHxyFw3Uwi8B8hgJYh7j4c7c8PV5CEbUTUzBoHcU78iIl/FYFXWmPaNeC3q4mz5YcqJPI1JGKql2Z3hkcjD5EUznmcu6qiNT+Y2CPEoH3Wm4A/QERWQFe9QQ0caeCDlSZJrht1HxG0D3sOuCEiCA1aj4ZY3Ipzl8LiVtn8hxi5zRgWM8YYPBODF/9zxOLcVRVs+YGtwFzxCs1Bo9y+avBiOTQeUzwI3F5+kOwxsXkkmWNHHrjUokqtqtSyysW5gUHV4mtmZEHSdRkl+aELvcFIRN397gPPXD4ZgbxJW1S5OJdA60MgUAyHu1KfAz+pfCUtwr+HuQc8ORQ1jK4ZgGsTvcY5uQP5oYkY2HfcK5sGLpS6l1xZQwNn7Xkedp3OgMrWC1DX0Qwnms/A1rK9cF9atNVo18DP/3o5fF99BGo7LFDRWgMJJQaYQv/PyOcHySP0TITrBIhYb+WSHLrlNGEx5NeXgj2paW8C5rs46h3Dc3kt3G2Ogr9aqoes+f5RvbL1aJ5iXnKnxkfIEoB3N/zHeHAmF9ovwryvYvC9TysnICkEonPX212vvOU8+As6eS+QCDAw0aNLABq6LO8DkJMSSznMMEfScFFGwCJYXbDV7lq17RYIQu+QTYpjRUBM3gZQIt+cOwyTpWRpYBQRsKrgU4ceNS4JkCSxLI1+ZsIS0NvXB6sLE/tL5EQkQJKOm52YON9y7glqJkCSOqzrD6Uvc1wZ1EBA07V/IafmN4ckHG+ugJkSEHuVQQ0ENFy9BLP3R0NR4ymHJGRWFWBnZ6fPVwMBF9EDgrD2z0USqtoaHJKw49SBoZ2dWggIxmcEsvspYLLi4PKNDrvv68OfuKLt/68MqiJAan4Q0IpDm6G7r8fue692X4fI7PiByqA6AqygNh0XHIaClDOkpz9aGVRJABo8CTP+3sqfHZJQeqkSgvHZn+xaqEICKAlhECSGO60MWdVF4IcesDL/ExUSYN3okCrD31fqHZLwcWkq5owPVUoA3UcIgdBv10BrV7vdz3b39kBhw0kVE2BNirG/bqRghyPqIcBKQkKJcVgE1LQ1wR3S5ooqCDBKlSEUzGdyFBNwvq1RTQT0b4BOF5+BgoayCUqAtTLMSXsRzl6uHX8EONoUtXS2KCfAusOsyVwFLV1tznNAuzflAGxb+R/esGuodDcD0bUVbYLelhRf/mWD08ogdYtTjNwYbIsrORhBIwJMPOTWHh1i6Lriz107FUKviivcZvfp8WZvN8TmbVS2rtsHI8mMtn9gSe50KAz79yWw8490OGYpp8lsTUGictd3EA6PHVwB20+mYUNURo/aMs4dhqjsdcoOWGxH5yYu0g0P0EzFBd7DxZoVHY7aHmWtB6VunwhLB6P0gFULk6zhJnvnBw5HW9D9N5GkpQEjMBcQOg+JMBNxjMZgHISawvGZHiKw+0mybv5ozP0txgvk07AQvWxAoh98sXsur3RmwMStxIud9fiIzMAIXTV6yNqxHaH7gg1GA7bgxVvHfEjq1hAl10ZM/A46gO0x0bOPoiHpSEDvsMZhXVVbVRL4TLz2E140EK1dgsnnd9mBaHcmwuigJHeCGLkXvHNaNHOBP4J/HYmoGbGwsJU1ka0nAvM2ht40758ZNmvvRRJ24l3roMa7MxVq4jpRdyMRc8bh9wR0TyIRWdR9hzNXaJs3Ftif6KDWuBcBH0hErky2bNraV5E9jcBjiapE1ExHkO8iEY1OvjLTjAkugezh7ySqFUPoXHTtZAR7ncY4rRrYYgtcCtGHPUgmjEhPmiKXjXc/l4g6HfGJT3ziEw/If86JzB/YMku9AAAAAElFTkSuQmCC\" rel=\"icon\" type=\"image/png\" />\n        <style>\n            body {\n                margin: 0px;\n                font: 20px 'RobotoRegular', Arial, sans-serif;\n                font-weight: 100;\n                height: 100%;\n                color: #0f1419;\n            }\n            div.info {\n                display: table;\n                background: #e8eaec;\n                padding: 20px 20px 20px 20px;\n                border: 1px dashed black;\n                border-radius: 10px;\n                margin: 0px auto auto auto;\n            }\n            div.info p {\n                display: table-row;\n                margin: 5px auto auto auto;\n            }\n            div.info p span {\n                display: table-cell;\n                padding: 10px;\n            }\n            img {\n                width: 176px;\n                margin: 36px auto 36px auto;\n                display:block;\n            }\n            div.smaller p span {\n                color: #3D5266;\n            }\n            h1, h2 {\n                font-weight: 100;\n            }\n            div.check {\n                padding: 0px 0px 0px 0px;\n                display: table;\n                margin: 36px auto auto auto;\n                font: 12px 'RobotoRegular', Arial, sans-serif;\n            }\n            #footer {\n                position: fixed;\n                bottom: 36px;\n                width: 100%;\n            }\n            #center {\n                width: 400px;\n                margin: 0 auto;\n                font: 12px Courier;\n            }\n        </style>\n\n        <script>\n            var ref;\n            function checkRefresh() {\n                if (document.cookie == \"refresh=1\") {\n                    document.getElementById(\"check\").checked = true;\n                    ref = setTimeout(function(){location.reload();}, 1000);\n                } else {\n                }\n            }\n            function changeCookie() {\n                if (document.getElementById(\"check\").checked) {\n                    document.cookie = \"refresh=1\";\n                    ref = setTimeout(function(){location.reload();}, 1000);\n                } else {\n                    document.cookie = \"refresh=0\";\n                    clearTimeout(ref);\n                }\n            }\n        </script>\n    </head>\n\n    <body onload=\"checkRefresh();\">\n\n```\n\n----------------------------------------\n\nTITLE: Install njs module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This snippet shows how to install the `nginx-plus-module-njs` package on Amazon Linux 2023, AlmaLinux, and Rocky Linux using the `dnf` package manager. It first updates the package list and then installs the njs module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginscript.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Allow or Deny IP Addresses in Gateway (JSON)\nDESCRIPTION: This JSON snippet configures a gateway to manage IP address access using `allow` and `deny` directives. It defines `uriSnippets` with directives to deny a specific IP address, allow a subnet, allow an IPv6 subnet, and deny all other traffic. The `applicableUris` specifies where these rules are applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-snippets.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"<gateway-name>\"\n    },\n    \"desiredState\": {\n        \"configSnippets\": {\n            \"uriSnippets\": [\n                {\n                    \"applicableUris\": [\n                        {\n                            \"uri\": \"<gateway URI>\"\n                        }\n                    ],\n                    \"directives\": [\n                        {\n                            \"directive\": \"deny\",\n                            \"args\": [\"192.0.2.2\"]\n                        },\n                        {\n                            \"directive\": \"allow\",\n                            \"args\": [\"192.0.2.1/24\"]\n                        },\n                                                {\n                            \"directive\": \"allow\",\n                            \"args\": [\"2001:0db8::/32\"]\n                        },\n                                                {\n                            \"directive\": \"deny\",\n                            \"args\": [\"all\"]\n                        }\n                    ]\n                }\n            ]\n        },\n        \"ingress\": {\n            \"uris\": {\n                \"http://example.com:8020\": {}\n            },\n            \"placement\":  {\n                \"instanceRefs\": [\n                    {\n                        \"ref\": \"/infrastructure/locations/unspecified/instances/<instance-name>\"\n                    }\n                ]\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Checking NGINX status with systemctl\nDESCRIPTION: This command is used to check the status of the NGINX service. It uses `systemctl`, which is a systemd utility to manage system services. The output will indicate whether NGINX is running, stopped, or in a failed state.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/upgrade-nap-waf.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl status nginx\n```\n\n----------------------------------------\n\nTITLE: Adding OIDC Policy via REST API\nDESCRIPTION: This code snippet demonstrates how to add an OIDC policy to a cluster using a POST request to the API Connectivity Manager REST API.  It configures the OIDC relying party with necessary settings such as jwksURI, tokenEndpoint, authorizationEndpoint, logOffEndpoint, and client information like clientID and scopes.  Ensure the <IDP Authorization server> and <clientid> placeholders are replaced with actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/infrastructure/enable-sso-devportal.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"test\",\n    \"type\": \"NON-PROD\",\n    \"functions\": [\n        \"DEVPORTAL\"\n    ],\n    \"systemProperties\": {\n        \"acmHostName\": \"<NMS_FQDN>\"\n    },\n    \"proxies\": [...],\n            \"policies\": {\n                \"oidc-authz\": [\n                    {\n                        \"action\": {\n                            \"config\": {\n                                \"jwksURI\": \"https://<IDP Authorization server>/v1/keys\",\n                                \"tokenEndpoint\": \"https://<IDP Authorization server>/v1/token\",\n                                \"userInfoEndpoint\": \"https://<IDP Authorization server>/v1/userinfo\",\n                                \"authorizationEndpoint\": \"https://<IDP Authorization server>/v1/authorize\",\n                                \"logOffEndpoint\": \"https://<IDP Authorization server>/v1/logout\",\n                                \"authFlowType\": \"PKCE\"\n                            }\n                        },\n                        \"data\": [\n                            {\n                                \"appName\": \"Myapp\",\n                                \"clientID\": \"<clientid>\",\n                                \"scopes\": \"apigw+openid+profile+email+offline_access\"\n                            }\n                        ]\n                    }\n                ]\n            }\n        ]\n    }\n\n```\n\n----------------------------------------\n\nTITLE: Configuring nginx.conf for GraphQL Policy\nDESCRIPTION: This nginx.conf snippet demonstrates how to enable NGINX App Protect WAF, specify the security policy file, and configure logging.  Critically, it shows how to apply a specific GraphQL policy to the `/graphql` location block using the `app_protect_policy_file` directive.  This ensures that requests to the GraphQL endpoint are protected by the defined policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/how-to/enable-graphql.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nworker_processes  4;\n\nload_module modules/ngx_http_app_protect_module.so;\n\nerror_log /var/log/nginx/error.log debug;\n\nevents {\n    worker_connections  65536;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    app_protect_enable on;  # This is how you enable NGINX App Protect WAF in the relevant context/block\n    app_protect_policy_file \"/etc/app_protect/conf/NginxDefaultPolicy.json\"; # This is a reference to the policy file to use. If not defined, the default policy is used\n    app_protect_security_log_enable on; # This section enables the logging capability\n    app_protect_security_log \"/etc/app_protect/conf/log_default.json\" syslog:server=127.0.0.1:514; # This is where the remote logger is defined in terms of: logging options (defined in the referenced file), log server IP, log server port\n\n\n    server {\n        listen       80;\n        server_name  localhost;\n        proxy_http_version 1.1;\n\n        location / {\n            client_max_body_size 0;\n            default_type text/html;\n            proxy_pass http://172.29.38.211:80$request_uri;\n        }\n\n        location /graphql {\n            client_max_body_size 0;\n            default_type text/html;\n            app_protect_policy_file \"/etc/app_protect/conf/graphQL_policy.json\"; # This location will invoke the custom GraphQL policy \n            proxy_pass http://172.29.38.211:80$request_uri;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Policy Converter Output Example\nDESCRIPTION: Example JSON output from the Policy Converter tool, including warnings about unsupported features, file size, completion status, and filename. This shows a typical result when converting an XML policy with unsupported elements.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_15\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"warnings\": [\n        \"Traffic Learning, Policy Building, and staging are unsupported\",\n        \"Element '/plain-text-profiles' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_ASM_COOKIE_HIJACKING' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_BLOCKING_CONDITION' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_BRUTE_FORCE' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_CONVICTION' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_CROSS_ORIGIN_REQUEST' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_CSRF' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_CSRF_EXPIRED' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_DYNAMIC_SESSION' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_FLOW' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_FLOW_DISALLOWED_INPUT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_FLOW_ENTRY_POINT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_FLOW_MANDATORY_PARAMS' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_GEOLOCATION' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_GRPC_FORMAT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_GRPC_METHOD' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_GWT_FORMAT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_GWT_MALFORMED' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_HOSTNAME_MISMATCH' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_LOGIN_URL_BYPASSED' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_LOGIN_URL_EXPIRED' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_MALICIOUS_DEVICE' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_MALICIOUS_IP' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_PARAMETER_DYNAMIC_VALUE' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_PLAINTEXT_FORMAT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_REDIRECT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_SESSION_AWARENESS' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_VIRUS' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_BAD_REQUEST' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_BINARY_MESSAGE_LENGTH' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_BINARY_MESSAGE_NOT_ALLOWED' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_EXTENSION' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_FRAMES_PER_MESSAGE_COUNT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_FRAME_LENGTH' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_FRAME_MASKING' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_FRAMING_PROTOCOL' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_TEXT_MESSAGE_NOT_ALLOWED' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_TEXT_NULL_VALUE' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_XML_SCHEMA' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_XML_SOAP_ATTACHMENT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_XML_SOAP_METHOD' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_XML_WEB_SERVICES_SECURITY' is unsupported.\",\n        \"/blocking-settings/http-protocols/description value 'Unparsable request content' is unsupported.\",\n        \"/general/enableEventCorrelation must be 'false' (was 'true').\",\n        \"Element '/websocket-urls' is unsupported.\",\n        \"/protocolIndependent must be 'true' (was 'false').\",\n        \"Element '/redirection-protection' is unsupported.\",\n        \"Element '/gwt-profiles' is unsupported.\",\n        \"/signature-sets/learn value true is unsupported\"\n    ],\n    \"file_size\": 24227,\n    \"completed_successfully\": true,\n    \"filename\": \"/path/to/policy1.json\"\n}\n```\n\n----------------------------------------\n\nTITLE: Declarative Policy with Override Rules - JSON\nDESCRIPTION: This JSON snippet demonstrates a declarative policy with override rules in Nginx App Protect. It includes five override rules, each with a condition and an override. The overrides can be inline policy references, external policy references via $ref, or actions that trigger violations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/override-rules-overview.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"policy\": {\n    \"name\": \"override_rules_example\",\n    \"template\": {\n      \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"override-rules\": [\n      {\n        \"name\": \"localhost-log-only\",\n        \"condition\": \"host.contains('localhost') and clientIp == '127.0.0.1' and userAgent.lower().startsWith('curl')\",\n        \"override\": {\n          \"policy\": {\n            \"enforcementMode\": \"transparent\"\n          }\n        }\n      },\n      {\n        \"name\": \"login_page\",\n        \"condition\": \"method == 'POST' and not parameters['ref'].lower().matches('example') and uri.contains('/login/')\",\n        \"actionType\": \"replace-policy\",\n        \"override\": {\n          \"policy\": {\n            \"name\": \"login_page_block_redirect\",\n            \"template\": {\n              \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n            },\n            \"signature-sets\": [\n              {\n                \"name\": \"All Signatures\",\n                \"block\": true,\n                \"alarm\": true\n              }\n            ],\n            \"response-pages\": [\n              {\n                \"responseRedirectUrl\": \"https://example.com/rejected?id=<%TS.request.ID()%>\",\n                \"responseActionType\": \"redirect\",\n                \"responsePageType\": \"default\"\n              }\n            ]\n          }\n        }\n      },\n      {\n        \"name\": \"api-strict\",\n        \"condition\": \"uri.contains('api4') and not (clientIp.matches('fd00:1::/48') or userAgent.lower().startsWith('Mozilla'))\",\n        \"actionType\": \"replace-policy\",\n        \"override\": {\n          \"$ref\": \"file:///NginxStrictPolicy.json\"\n        }\n      },\n      {\n        \"name\": \"strict-post\",\n        \"condition\": \"method.matches('POST') and (cookies['sessionToken'] != 'c2Vzc2lvblRva2Vu' or headers['Content-Encoding'] == 'gzip')\",\n        \"actionType\": \"replace-policy\",\n        \"override\": {\n          \"$ref\": \"file:///NginxStrictPolicy.json\"\n        }\n      },\n        \"name\": \"usa-only\",\n        \"condition\": \"geolocation != 'US'\",\n                \"actionType\": \"violation\",\n                \"violation\": {\n                    \"block\": true,\n                    \"alarm\": true,\n                    \"attackType\": {\n                           \"name\": \"Forceful Browsing\"\n                       },\n                    \"description\": \"Attempt to access from outside the USA\",\n                    \"rating\": 4\n                }\n        }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Create Dockerfile for NGINX App Protect WAF Compiler\nDESCRIPTION: This Dockerfile configures the NGINX App Protect WAF compiler image by installing necessary packages, setting up the apt repository, and downloading attack signatures, bot signatures, and threat campaigns. It uses multi-stage builds and secret mounts for secure handling of certificates. It also switches to a non-root user for enhanced security.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_1\n\nLANGUAGE: dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\nARG BASE_IMAGE=private-registry.nginx.com/nap/waf-compiler:<version-tag>\nFROM ${BASE_IMAGE}\n\n# Installing packages as root\nUSER root\n\nENV DEBIAN_FRONTEND=\"noninteractive\"\n\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    apt-get update \\\n    && apt-get install -y \\\n        apt-transport-https \\\n        lsb-release \\\n        ca-certificates \\\n        wget \\\n        gnupg2 \\\n        ubuntu-keyring \\\n    && wget -qO - https://cs.nginx.com/static/keys/app-protect-security-updates.key | gpg --dearmor | \\\n    tee /usr/share/keyrings/app-protect-security-updates.gpg >/dev/null \\\n    && printf \"deb [signed-by=/usr/share/keyrings/app-protect-security-updates.gpg] \\\n    https://pkgs.nginx.com/app-protect-security-updates/ubuntu `lsb_release -cs` nginx-plus\\n\" | \\\n    tee /etc/apt/sources.list.d/nginx-app-protect.list \\\n    && wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx \\\n    && apt-get update \\\n    && apt-get install -y \\\n        app-protect-attack-signatures \\\n        app-protect-bot-signatures \\\n        app-protect-threat-campaigns \\\n    && apt-get clean \\\n    && rm -rf /var/lib/apt/lists/*\n\n# non-root default user (UID 101)\nUSER nginx\n```\n\n----------------------------------------\n\nTITLE: Publish gRPC API Proxy with Service-Level Routing using Labels (JSON)\nDESCRIPTION: This JSON configuration illustrates service-level routing using labels in NGINX Management Suite API Connectivity Manager.  The `grpcIngress` has routes that directs methods to different backends based on `targetBackendServiceLabel`. The `backends` array includes labels (`targetName`) that correspond to specific backend service targets, enabling granular routing based on the gRPC method and assigned labels.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/services/publish-gRPC-proxy.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"dev-grpc-hello\",\n    \"version\": \"v1\",\n    \"proxyConfig\": {\n        \"hostname\": \"example.com\",\n        \"grpcIngress\": {\n            \"service\": \"helloworld.Greeter\",\n            \"routes\": [\n                {\n                  \"method\": \"SayGoodbye\",\n                  \"targetBackendServiceLabel\": \"custom\"\n                },\n                {\n                  \"method\": \"SayHello\",\n                  \"targetBackendServiceLabel\": \"default\"\n                }\n            ]\n        },\n        \"backends\": [\n            {\"label\": {\n              \"targetName\": \"default\"\n            },\n            \"serviceName\": \"hello-grpc-service-name\",\n            \"serviceTargets\": [\n                {\n                    \"hostname\": \"grpc-backend.example.com.1\",\n                    \"listener\": {\n                        \"enableTLS\": false,\n                        \"port\": 50051,\n                        \"transportProtocol\": \"GRPC\"\n                    }\n                }\n            ]\n          },\n          {\n             \"label\": {\n              \"targetName\": \"custom\"\n            },\n            \"serviceName\": \"hello-grpc-service-name\",\n            \"serviceTargets\": [\n                {\n                    \"hostname\": \"grpc-backend.example.com.2\",\n                    \"listener\": {\n                        \"enableTLS\": false,\n                        \"port\": 50051,\n                        \"transportProtocol\": \"GRPC\"\n                    }\n                }\n            ]\n          }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Complete Nginx Configuration Example\nDESCRIPTION: This is a complete example of an `nginx.conf` file adjusted for a Kubernetes environment. It includes configurations for user, worker processes, error logging, event handling, HTTP settings (including mime types, logging formats, temporary directories, and sendfile), and an example of incorporating NGINX App Protect WAF. The critical updates are the pid file and temporary directory paths, ensuring they point to writable volumes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/nap-k8s-readonly-paths.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nuser  nginx;\nworker_processes  auto;\n\n# NGINX App Protect WAF\nload_module modules/ngx_http_app_protect_module.so;\n\nerror_log  /var/log/nginx/error.log debug;\npid        /tmp/nginx.pid; \n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                    '$status $body_bytes_sent \"$http_referer\" '\n                    '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log;\n\n    # Temporary directories for kubernetes \"readonlyfilesystem\"\n    client_body_temp_path /tmp/nginx-client-body;\n    proxy_temp_path       /tmp/nginx-proxy;\n    fastcgi_temp_path     /tmp/nginx-fastcgi;\n    uwsgi_temp_path       /tmp/nginx-uwsgi;\n    scgi_temp_path        /tmp/nginx-scgi;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    # NGINX App Protect WAF\n    app_protect_enforcer_address 127.0.0.1:50000;\n\n    include /etc/nginx/conf.d/*.conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Populating Key-Value Database with API using curl - Full Example\nDESCRIPTION: This shell command shows how to populate the key-value store with IP addresses and network ranges using curl. This would typically be used after configuring the key-value store and API endpoint in Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X POST -d '{\n  \"10.0.0.1\": \"1\",\n  \"192.168.13.0/24\": \"1\",\n  \"10.0.0.3\": \"0\",\n  \"10.0.0.4\": \"0\"\n}' -s 'http://www.example.com/api/6/http/keyvals/one'\n```\n\n----------------------------------------\n\nTITLE: Configuring GraphQL URL with Content Profiles\nDESCRIPTION: This snippet shows how to configure a specific URL, `/graphql`, to allow GraphQL API requests. It sets the `isAllowed` flag to `true` and defines a URL content profile that permits any header value and name, using the `graphql` content type.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/graphql-define-url-settings.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\n  \"urls\": [\n        {\n            \"$action\": \"delete\",\n            \"method\": \"*\",\n            \"name\": \"*\",\n            \"protocol\": \"http\",\n            \"type\": \"wildcard\"\n        },\n        {\n            \"isAllowed\": true,\n            \"name\": \"/graphql\",\n            \"protocol\": \"http\",\n            \"type\": \"explicit\",\n            \"performStaging\": false,\n            \"urlContentProfiles\": [\n                {\n                    \"contentProfile\": {\n                        \"name\": \"Default\"\n                    },\n                    \"headerValue\": \"*\",\n                    \"headerName\": \"*\",\n                    \"headerOrder\": \"default\",\n                    \"type\": \"graphql\"\n                }\n            ]\n        }\n    ]\n```\n\n----------------------------------------\n\nTITLE: Default App Protect DoS Policy Configuration (JSON)\nDESCRIPTION: This JSON configuration file represents the default policy settings for App Protect DoS. It defines parameters such as `mitigation_mode`, `signatures`, `bad_actors`, `automation_tools_detection` and `tls_fingerprint`, controlling various aspects of the DoS protection mechanism.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"mitigation_mode\": \"standard\",\n    \"signatures\": \"on\",\n    \"bad_actors\": \"on\",\n    \"automation_tools_detection\": \"on\",\n    \"tls_fingerprint\" : \"on\"\n}\n```\n\n----------------------------------------\n\nTITLE: Deploy Coffee Application - Kubernetes YAML\nDESCRIPTION: This Kubernetes YAML deploys the coffee application, including a deployment with a single replica and a service that exposes the application on port 80. The application is based on the nginxdemos/nginx-hello:plain-text image.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: coffee\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: coffee\n  template:\n    metadata:\n      labels:\n        app: coffee\n    spec:\n      containers:\n      - name: coffee\n        image: nginxdemos/nginx-hello:plain-text\n        ports:\n        - containerPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: coffee\nspec:\n  ports:\n  - port: 80\n    targetPort: 8080\n    protocol: TCP\n    name: http\n  selector:\n    app: coffee\nEOF\n```\n\n----------------------------------------\n\nTITLE: Remove TCP Ports from SELinux Context\nDESCRIPTION: Removes the association of specified TCP ports with the `nms_t` SELinux context. This is typically done when uninstalling NGINX Instance Manager or when the ports are no longer used. Requires `semanage` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-selinux.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo semanage port -d -t nms_t 10000\nsudo semanage port -d -t nms_t 11000\n```\n\n----------------------------------------\n\nTITLE: Describe Tea HTTPRoute - Kubernetes Shell\nDESCRIPTION: This snippet uses kubectl to describe the 'tea' HTTPRoute resource.  This is used to verify the proper configuration, especially the conditions that reflect the acceptance and resolution of referenced resources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe httproutes.gateway.networking.k8s.io tea\n```\n\n----------------------------------------\n\nTITLE: Usage Information for Signature Converter Tool\nDESCRIPTION: This output shows the usage information for the `convert-signatures` tool, including required and optional arguments such as input and output file paths, signature tags, and output formats. The environment variables that can be used instead of command-line arguments are also listed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_25\n\nLANGUAGE: shell\nCODE:\n```\nUSAGE:\n    /opt/app_protect/bin/convert-signatures\n\nRequired arguments:\n    --outfile|o='/path/to/signatures.json'\n        File name to write JSON format export\n        Can also be set via an environment variable: EXPORT_FILE\n    --infile|i='/path/to/signatures.xml'\n        Advanced WAF/ASM User Defined Signatures file to Convert\n        Can also be set via an environment variable: IMPORT_FILE\n\nOptional arguments:\n    --tag|t='mytag'\n        Signature Tag to associate with User Defined Signatures.\n        If no tag is specified in the XML file, a default tag of 'user-defined-signatures' will be assigned.\n        Can also be set via an environment variable: TAG\n    --format|f='json'\n        Desired output format for signature file. Default 'json'\n        Supported formats: 'json'\n\nOptionally, using --help will issue this help message.\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Plus for Instance Tracking\nDESCRIPTION: This Nginx configuration snippet allows tracking NGINX Plus instances using HTTP health checks without requiring NGINX Agent.  It configures a key-value store for the instance UUID, sets up an upstream to the NGINX Instance Manager, defines server locations for health checks and UUID retrieval, and establishes an upstream for communication with the self server. The configuration requires updating the `NMS_FQDN` with the correct IP/hostname and optionally configuring SSL certificates and Nginx App Protect status. Ensure that if Nginx Agent is later installed, this configuration is removed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/usage-tracking/http-health-check.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\n### F5 / NGINX Required Configuration Code ###\n### Insert the following into the http {} block of your NGINX configuration file ###\n\nkeyval_zone zone=uuid:32K state=/var/lib/nginx/state/instance_uuid.json;\nkeyval 1 $nginx_uuid zone=uuid;\n\nupstream receiver {\n    zone receiver 64k;\n\n    # REQUIRED: Update NMS_FQDN with NGINX Instance Manager IP Address or hostname.\n    # If configuring with hostname, please ensure to uncomment the resolver\n    # directive below and define a DNS server that can resolve the hostname.\n    server NMS_FQDN:443;\n\n    # OPTIONAL: Update DNS_UP with DNS server IP address that can resolve\n    # the hostname defined above.\n    #resolver DNS_IP;\n}\n\nmap CERT $repo_crt {\n    # OPTIONAL: Location of client certificate\n    #default /etc/ssl/nginx/nginx-client.crt;\n}\n\nmap KEY $repo_key {\n    # OPTIONAL: Location of client certificate private key\n    #default /etc/ssl/nginx/nginx-client.key;\n}\n\nserver {\n    location @ngx_usage_https {\n        # OPTIONAL: Configure scheme (http|https) here\n        proxy_pass https://receiver;\n\n        # REQUIRED: If using NGINX APP PROTECT (NAP) on this instance, set nap=active on the following line:\n        proxy_set_header Nginx-Usage \"Version=$nginx_version;Hostname=$hostname;uuid=$nginx_uuid;nap=inactive\";\n\n        health_check uri=/api/nginx-usage interval=1800s;       # DO NOT MODIFY\n        proxy_ssl_certificate     $repo_crt;                    # DO NOT MODIFY\n        proxy_ssl_certificate_key $repo_key;                    # DO NOT MODIFY\n    }\n\n    location @self {\n        health_check uri=/_uuid interval=1d;\n        proxy_pass http://self;\n    }\n\n    location = /_uuid {\n        if ($nginx_uuid !~ .) {\n            set $nginx_uuid $request_id;\n        }\n        return 204;\n    }\n\n    listen unix:/tmp/ngx_usage.sock;\n}\n\nupstream self {\n    zone self 64k;\n    server unix:/tmp/ngx_usage.sock;\n}\n\n### End of F5 / NGINX Required Configuration Code ###\n```\n\n----------------------------------------\n\nTITLE: NGINX WAF Location Block Configuration\nDESCRIPTION: This NGINX configuration snippet demonstrates how to enable the NGINX App Protect WAF module and specify the path to the security policy bundle. It requires the `app_protect` module to be installed and configured within the Nginx server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/overview-nap-waf-config-management.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    app_protect_enable on;\n    app_protect_policy_file /etc/app_protect/policies/policy_bundle.tgz;\n}\n```\n\n----------------------------------------\n\nTITLE: Enable REST Interface (nginx-agent.conf)\nDESCRIPTION: Configures the NGINX Agent to enable the REST interface. This involves setting the host and port in the `nginx-agent.conf` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\napi:\n  host: 0.0.0.0\n  port: 8038\n```\n\n----------------------------------------\n\nTITLE: Configure App Protect DoS Monitor in Nginx Server Block\nDESCRIPTION: This configuration snippet demonstrates how to configure the `app_protect_dos_monitor` directive within a server block.  It is important to set the correct port to avoid false attack declarations. The example shows setting it to `myservice.com:8080`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-3.0.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 8080;\n    location / {  app_protect_dos_monitor \"myservice.com:8080\";  }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure SQLite for Developer Portal\nDESCRIPTION: Configures the Developer Portal to use SQLite by setting the `DB_TYPE` and `DB_PATH` variables in `/etc/nginx-devportal/devportal.conf`. It uses `echo` and `tee` to append the configuration to the file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\necho 'DB_TYPE=\"sqlite\"' | sudo tee -a /etc/nginx-devportal/devportal.conf\necho 'DB_PATH=\"/var/lib/nginx-devportal\"' | sudo tee -a /etc/nginx-devportal/devportal.conf\n```\n\n----------------------------------------\n\nTITLE: Get Linux shared memory dump (Shell)\nDESCRIPTION: This command retrieves a dump of the Linux shared memory segments using the `ipcs` utility and saves it to `linux_shmem.txt`.  This captures information about the shared memory being used by the system.  This is part of the process of collecting troubleshooting information to send to customer support.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/troubleshooting-guide/how-to-troubleshoot.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nipcs -m > linux_shmem.txt\n```\n\n----------------------------------------\n\nTITLE: Create nginx-agent Group\nDESCRIPTION: This command uses `groupadd` with `sudo` to create the `nginx-agent` group if it doesn't already exist. It's a necessary step when setting up the NGINX Agent permissions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configure-nginx-agent-group.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo groupadd nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Backing Up NGINX Controller Database (Bash)\nDESCRIPTION: This script backs up the NGINX Controller database. It creates a directory named `pgbackup_<timestamp>`, then iterates through the databases (common, data, system, vault) and uses `pg_dump` to create a compressed backup file for each one in the created directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-external-config-db.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nDATE=$(date +\"%Y%m%d%H%M\")\nmkdir ~/pgbackup_${DATE}\n\nfor db in common data system vault; do\n  pg_dump -w -E utf8 ${db} -F c -f ~/pgbackup_${DATE}/${db}-${DATE}.backup\ndone\n```\n\n----------------------------------------\n\nTITLE: Launching Nginx Plus Docker Container with Agent\nDESCRIPTION: This command starts a Docker container for NGINX Plus with NGINX Agent, configured to connect to NGINX Instance Manager.  It sets environment variables for the Agent's gRPC port, Instance Manager host, and TLS settings.  Replace `<my-docker-registry>` and `<my-version-tag>` with the appropriate values for your private registry and image version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-plus-and-agent-docker.md#_snippet_7\n\nLANGUAGE: Shell\nCODE:\n```\nsudo docker run \\\n--env=NGINX_AGENT_SERVER_GRPCPORT=443 \\\n--env=NGINX_AGENT_SERVER_HOST=127.0.0.1 \\\n--env=NGINX_AGENT_TLS_ENABLE=true \\\n--env=NGINX_AGENT_TLS_SKIP_VERIFY=false \\\n--restart=always \\\n--runtime=runc \\\n-d <my-docker-registry>/nginx-plus/agent:<my-version-tag>\n```\n\n----------------------------------------\n\nTITLE: Restart Controller Agent - Bash\nDESCRIPTION: This command restarts the Controller Agent service. This is required after updating the `api_url` value in the agent's configuration file so the agent uses the new FQDN to communicate with NGINX Controller. It requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/resilient-cluster-private-cloud.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo service controller-agent restart\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Instance Manager Deployment with Helm\nDESCRIPTION: This command upgrades the NGINX Instance Manager deployment using Helm. It sets the admin password hash, specifies the values.yaml file, and sets the chart version. Replace `<path-to-your-values.yaml>` with the path to your values file and `<chart-version>` with the desired chart version (1.15.0 or lower).  The password must include uppercase and lowercase letters, numbers, and special characters.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_21\n\nLANGUAGE: bash\nCODE:\n```\nhelm upgrade -n nms \\\n    --set nms-hybrid.adminPasswordHash=$(openssl passwd -6 'YourPassword123#') \\\n    nms nginx-stable/nms \\\n    -f <path-to-your-values.yaml> \\\n    --version <chart-version> \\\n    --wait\n```\n\n----------------------------------------\n\nTITLE: Apreload Logs - Shell\nDESCRIPTION: These commands are used to view the logs generated by the apreload process. The first command uses `kubectl` to retrieve logs from the `config-mgr` container. The second uses `sudo docker logs` to retrieve the logs from the `waf-config-mgr` container. Assumes appropriate permissions to run `kubectl` and `docker`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n [namespace] logs [podname] -c config-mgr\n```\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker logs waf-config-mgr\n```\n\n----------------------------------------\n\nTITLE: Run Mock Control Plane - Go\nDESCRIPTION: This command starts the mock control plane which NGINX Agent reports to. It is written in Go and listens on specified ports for HTTP and gRPC connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/getting-started.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ngo run sdk/examples/server.go\n\n# Command Output\nINFO[0000] http listening at 54790 # mock control plane port\nINFO[0000] grpc listening at 54789 # grpc control plane port which NGINX Agent will report to\n```\n\n----------------------------------------\n\nTITLE: Base64 Encode NGINX Configuration File (Shell)\nDESCRIPTION: This command uses `base64` to encode an NGINX configuration file. The encoded output is used in a subsequent step to deploy the updated configuration through the NGINX Instance Manager API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_25\n\nLANGUAGE: shell\nCODE:\n```\nbase64 -i /etc/nginx/nginx.conf\n```\n\n----------------------------------------\n\nTITLE: Restarting Nginx\nDESCRIPTION: This command restarts the Nginx service to apply the changes made to the configuration file (nginx.conf). This is required after loading the module and enabling App Protect WAF. Requires sudo and systemctl.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Configuring User-Defined HTTP Headers in JSON\nDESCRIPTION: This JSON snippet shows how to configure user-defined HTTP headers within an NGINX App Protect policy. It defines a custom header named 'MyHeader' and configures its properties, such as allowing repeated occurrences, disabling attack signature checks, and marking it as optional.  It also enables 'VIOL_MANDATORY_HEADER' in blocking mode.  These headers are configured within the 'headers' section of the declarative policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/policy-authoring-and-tuning.md#_snippet_7\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"user_headers_blocking_policy\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_MANDATORY_HEADER\",\n                    \"block\": true\n                }\n            ]\n        },\n        \"headers\": [\n            {\n                \"name\": \"MyHeader\",\n                \"type\": \"explicit\",\n                \"decodeValueAsBase64\": \"disabled\",\n                \"htmlNormalization\": false,\n                \"mandatory\": false,\n                \"allowRepeatedOccurrences\": true,\n                \"checkSignatures\": false\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing GeoIP2 Module on Debian/Ubuntu\nDESCRIPTION: This command updates the package manager and installs the `nginx-plus-module-geoip2` package on Debian and Ubuntu systems. It enables using MaxMind GeoIP2 databases to get geolocation data from IP addresses within Nginx Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip2.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-geoip2\n```\n\n----------------------------------------\n\nTITLE: Disabling App Protect for DoS API Location - Nginx\nDESCRIPTION: This configuration snippet disables NGINX App Protect WAF for the DoS Live Activity Monitoring API location. This is necessary to avoid conflicts between the two modules when both are installed. The `app_protect_enable off;` directive disables the WAF, while `app_protect_dos_api;` enables the DoS API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-4.0.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /api {\n    app_protect_enable off;\n    app_protect_dos_api;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring JWT Authentication with Key File and Request in NGINX\nDESCRIPTION: This NGINX configuration snippet sets up a location block that enables JWT authentication. It defines the authentication realm, specifies the path to a local JWK file, and configures a subrequest to fetch keys from a remote service. The `subrequest_output_buffer_size` is increased to accommodate the Microsoft Entra signing keys.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/jwt.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n   listen 80;\n\n   location / {\n      auth_jwt \"API\";\n      auth_jwt_key_file /srv/key.jwk;\n      auth_jwt_key_request /_jwks_uri;\n   }\n\n   location = /_jwks_uri {\n      proxy_pass https://login.microsoftonline.com/common/discovery/keys;\n      subrequest_output_buffer_size 12k;\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration Logging Profile\nDESCRIPTION: This code snippet shows how to configure the NGINX App Protect security log using a default logging profile. It replaces the .json reference with a default constant, eliminating the need to compile the logging profile into a bundle. The logging profile is set to log_all and directs the output to /log_volume/security.log.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/overview.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log log_all /log_volume/security.log;\n```\n\n----------------------------------------\n\nTITLE: Update Proxy with Introspection Policy Configuration (PUT)\nDESCRIPTION: This code snippet shows how to update a proxy configuration with an OAuth2 Introspection policy. The policy is configured to forward specific claims from the token introspection response as headers to the backend service. It demonstrates the use of nested claim paths (e.g., `resource_access.account.roles`) and the inclusion of a non-existent claim to illustrate error handling.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_47\n\nLANGUAGE: bash\nCODE:\n```\nPUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy\n```\n\n----------------------------------------\n\nTITLE: Configure DNS Resolver in NGINX\nDESCRIPTION: This snippet configures the DNS resolver within the `http` context of the NGINX configuration file. It specifies the DNS server IP address and sets the validity period for DNS record resolution. This is required for NGINX to resolve the AD FS issuer URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/active-directory-federation-services.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: JSON Schema for Reverse Proxy Augmentation\nDESCRIPTION: This JSON schema defines the structure for configuring a reverse proxy augment in Nginx.  It specifies properties for defining locations, including a target label and upstream name.  The schema is used to ensure that the system can properly inject a reverse proxy directive targeting the specified upstream into the correct location block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/tutorials/round-robin-reverse-proxy.md#_snippet_5\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"title\": \"Reverse Proxy Augment\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"templateInput\": {\n      \"type\": [\n        \"object\",\n        \"null\"\n      ],\n      \"properties\": {\n        \"locations\": {\n          \"type\": \"array\",\n          \"title\": \"Locations\",\n          \"description\": \"To configure each location, the 'Label' you enter below must exactly match a 'Label' in the base template. This ensures the system can properly inject a reverse proxy directive targeting the specified upstream.\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"targetLabel\": {\n                \"title\": \"Target Location Label\",\n                \"type\": \"string\",\n                \"description\": \"Enter the label for this configuration's target location. It must exactly match the 'Location Label' from a base template location to ensure the system correctly injects the augment inputs into the configuration.\",\n                \"examples\": [\n                  \"Main Location\"\n                ]\n              },\n              \"upstreamName\": {\n                \"type\": \"string\",\n                \"title\": \"Upstream Name\",\n                \"description\": \"Name of the target upstream. Must match exactly.\",\n                \"examples\": [\n                  \"upstream_1\"\n                ]\n              }\n            },\n            \"required\": [\"targetId\", \"upstreamName\"]\n          }\n        }\n      },\n      \"required\": [\"locations\"]\n    }\n  },\n  \"required\": []\n}\n```\n\n----------------------------------------\n\nTITLE: Enable Base64 Detection in NGINX App Protect WAF Policy (JSON)\nDESCRIPTION: This JSON snippet configures an NGINX App Protect WAF policy to enable the detection and decoding of Base64 encoded strings in gRPC payloads.  It includes setting `decodeStringValuesAsBase64` to `enabled` within a gRPC profile configuration. The configuration also specifies the application language, policy name, template and the IDL file to be used.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/detect-base64-string-values.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"applicationLanguage\": \"utf-8\",\n        \"name\": \"valid_string_encoding_policy\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"idl-files\": [\n            {\n                \"fileName\": \"valid_string.proto\",\n                \"link\": \"file:///tmp/grpc/valid_string.proto\"\n            }\n        ],\n        \"grpc-profiles\": [\n            {\n                \"name\": \"base64_decode_strings\",\n                \"description\": \"My first profile\",\n                \"idlFiles\": [\n                    {\n                        \"idlFile\": {\n                            \"fileName\": \"valid_string.proto\"\n                        }\n                    }],\n                \"decodeStringValuesAsBase64\": \"enabled\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX: Protect Location with OIDC\nDESCRIPTION: This configures the `location /` block to be protected by Keycloak OIDC by using the `auth_oidc` directive. It points to the `keycloak` provider defined in the `oidc_provider` context. Any request to this location will require authentication via Keycloak.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/keycloak.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc keycloak;\n\n     # ...\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Define Stop Signal\nDESCRIPTION: This sets the stop signal to SIGQUIT, which is a more graceful way to shut down Nginx compared to SIGTERM or SIGKILL.  This allows Nginx to finish processing requests before exiting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-ubuntu.md#_snippet_2\n\nLANGUAGE: dockerfile\nCODE:\n```\nSTOPSIGNAL SIGQUIT\n```\n\n----------------------------------------\n\nTITLE: Configuring Custom Headers in Nginx\nDESCRIPTION: This snippet adds a custom header to the response using the add_header directive. Replace `<custom-header-name>` with the name of the custom header and `<custom-header-value>` with the desired value. The '[always]' option ensures the header is always added, regardless of the response code.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-response-headers.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nadd_header `<custom-header-name> <custom-header-value> [always]`\n```\n\n----------------------------------------\n\nTITLE: Download Nginx Plus Status Configuration File\nDESCRIPTION: This code snippet shows how to download the status.conf file from the Nginx website using curl. This file is used to configure the live activity monitoring dashboard.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_52\n\nLANGUAGE: none\nCODE:\n```\n# cd /etc/nginx/conf.d\n# curl https://www.nginx.com/resource/conf/status.conf > status.conf\n```\n\n----------------------------------------\n\nTITLE: Configuring Virtual Server for IMAP Traffic (Nginx)\nDESCRIPTION: This snippet configures a virtual server to proxy IMAP traffic on port 993 to the 'exchange-imaps' upstream group. The `status_zone` directive enables monitoring for this virtual server. This configuration belongs inside the 'stream' block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_27\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'stream' block\nserver {\n    listen 993;\n    status_zone exchange-imaps;\n    proxy_pass exchange-imaps;\n}\n```\n\n----------------------------------------\n\nTITLE: Update and Install NGINX App Protect WAF - Ubuntu\nDESCRIPTION: These commands update the apt package lists and install the latest NGINX App Protect WAF package. `sudo apt-get update` refreshes the package lists from the configured repositories. `sudo apt-get install app-protect` installs the NGINX App Protect WAF package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_36\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get update\nsudo apt-get install app-protect\n```\n\n----------------------------------------\n\nTITLE: Define IAM Role for Multi-Node AWS Installation (JSON)\nDESCRIPTION: Defines an IAM role with specific permissions required for a multi-node NGINX Controller installation on AWS, including autoscaling, EC2, IAM, KMS, and Elastic Load Balancing (ELB) actions. This role expands upon the single-node permissions to include ELB actions, allowing for load balancing across multiple nodes.  It's essential for resilient cluster setups.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/nginx-controller-tech-specs.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"autoscaling:DescribeAutoScalingGroups\",\n        \"autoscaling:DescribeLaunchConfigurations\",\n        \"autoscaling:DescribeTags\",\n        \"ec2:DescribeInstances\",\n        \"ec2:DescribeRegions\",\n        \"ec2:DescribeRouteTables\",\n        \"ec2:DescribeSecurityGroups\",\n        \"ec2:DescribeSubnets\",\n        \"ec2:DescribeVolumes\",\n        \"ec2:CreateSecurityGroup\",\n        \"ec2:CreateTags\",\n        \"ec2:CreateVolume\",\n        \"ec2:ModifyInstanceAttribute\",\n        \"ec2:ModifyVolume\",\n        \"ec2:AttachVolume\",\n        \"ec2:AuthorizeSecurityGroupIngress\",\n        \"ec2:CreateRoute\",\n        \"ec2:DeleteRoute\",\n        \"ec2:DeleteSecurityGroup\",\n        \"ec2:DeleteVolume\",\n        \"ec2:DetachVolume\",\n        \"ec2:RevokeSecurityGroupIngress\",\n        \"ec2:DescribeVpcs\",\n        \"elasticloadbalancing:AddTags\",\n        \"elasticloadbalancing:AttachLoadBalancerToSubnets\",\n        \"elasticloadbalancing:ApplySecurityGroupsToLoadBalancer\",\n        \"elasticloadbalancing:CreateLoadBalancer\",\n        \"elasticloadbalancing:CreateLoadBalancerPolicy\",\n        \"elasticloadbalancing:CreateLoadBalancerListeners\",\n        \"elasticloadbalancing:ConfigureHealthCheck\",\n        \"elasticloadbalancing:DeleteLoadBalancer\",\n        \"elasticloadbalancing:DeleteLoadBalancerListeners\",\n        \"elasticloadbalancing:DescribeLoadBalancers\",\n        \"elasticloadbalancing:DescribeLoadBalancerAttributes\",\n        \"elasticloadbalancing:DetachLoadBalancerFromSubnets\",\n        \"elasticloadbalancing:DeregisterInstancesFromLoadBalancer\",\n        \"elasticloadbalancing:ModifyLoadBalancerAttributes\",\n        \"elasticloadbalancing:RegisterInstancesWithLoadBalancer\",\n        \"elasticloadbalancing:SetLoadBalancerPoliciesForBackendServer\",\n        \"elasticloadbalancing:AddTags\",\n        \"elasticloadbalancing:CreateListener\",\n        \"elasticloadbalancing:CreateTargetGroup\",\n        \"elasticloadbalancing:DeleteListener\",\n        \"elasticloadbalancing:DeleteTargetGroup\",\n        \"elasticloadbalancing:DescribeListeners\",\n        \"elasticloadbalancing:DescribeLoadBalancerPolicies\",\n        \"elasticloadbalancing:DescribeTargetGroups\",\n        \"elasticloadbalancing:DescribeTargetHealth\",\n        \"elasticloadbalancing:ModifyListener\",\n        \"elasticloadbalancing:ModifyTargetGroup\",\n        \"elasticloadbalancing:RegisterTargets\",\n        \"elasticloadbalancing:DeregisterTargets\",\n        \"elasticloadbalancing:SetLoadBalancerPoliciesOfListener\",\n        \"iam:CreateServiceLinkedRole\",\n        \"kms:DescribeKey\"\n      ],\n      \"Resource\": [\n        \"*\"\n      ]\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Verifying Signing Key Fingerprint\nDESCRIPTION: Verifies the NGINX signing key fingerprint to ensure the key is valid and hasn't been tampered with.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-debian.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ngpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Instance Manager\nDESCRIPTION: This command restarts the NGINX Instance Manager service (`nms`) to apply configuration changes, such as switching to or from Vault for secret storage.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-vault.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nms\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Amplify Agent using Install Script (Bash)\nDESCRIPTION: Downloads and executes the installation script for NGINX Amplify Agent. The API key is required to associate the agent with the Amplify account. Replace YOUR_API_KEY with the actual API key obtained from the Amplify web interface.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ncurl -sS -L -O \\\nhttps://github.com/nginxinc/nginx-amplify-agent/raw/master/packages/install.sh && \\\nAPI_KEY='YOUR_API_KEY' sh ./install.sh\n```\n\n----------------------------------------\n\nTITLE: Loading Docker Images from Tar Archives (Shell)\nDESCRIPTION: Loads Docker images from tar archives into the local Docker environment. It utilizes the `docker load` command with the `-i` option to specify the input tar file. This command is typically used in offline environments to import images that were previously saved from another Docker installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_15\n\nLANGUAGE: Shell\nCODE:\n```\ndocker load -i nginx-app-protect-5.tar\ndocker load -i waf-enforcer.tar\ndocker load -i waf-config-mgr.tar\n```\n\n----------------------------------------\n\nTITLE: Configuring nginx-ha-notify Variables\nDESCRIPTION: This snippet shows the user-defined variables that need to be configured in the nginx-ha-notify script. The user must replace the <value> placeholder with the correct AWS credentials, region, internal DNS names of the Nginx Plus instances, and the Elastic IP allocation ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-keepalived.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\nexport AWS_ACCESS_KEY_ID=<value>\nexport AWS_SECRET_ACCESS_KEY=<value>\nexport AWS_DEFAULT_REGION=<value>\nHA_NODE_1=<value>\nHA_NODE_2=<value>\nALLOCATION_ID=<value>\n```\n\n----------------------------------------\n\nTITLE: Creating Azure Integration with NGINX Controller API in JSON\nDESCRIPTION: This JSON configuration creates an Azure Integration in NGINX Controller, enabling the controller to manage NGINX instances on Azure.  It requires the clientID, tenantID, and clientSecret obtained from Azure app registration. The `type` is set to `AZURE_SERVICE_PRINCIPAL` and `AZURE_INTEGRATION` respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/add-azure-instance.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"metadata\": {\n    \"name\": \"azure\"\n  },\n  \"desiredState\": {\n    \"credential\": {\n      \"type\": \"AZURE_SERVICE_PRINCIPAL\",\n      \"clientID\": \"...\",\n      \"clientSecret\": \"...\",\n      \"tenantID\": \"...\"\n    },\n    \"type\": \"AZURE_INTEGRATION\"\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Checking PHP-FPM Socket Permissions (Bash)\nDESCRIPTION: This command lists the details of the PHP-FPM socket file, including permissions, owner, and group. This is important to verify the correct permissions are set to allow NGINX Amplify Agent to access the PHP-FPM status.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/other-metrics.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nls -la /var/run/php/php7.0-fpm.sock\n```\n\nLANGUAGE: text\nCODE:\n```\nsrw-rw---- 1 www-data www-data 0 May 18 14:02 /var/run/php/php7.0-fpm.sock\n```\n\n----------------------------------------\n\nTITLE: Adding Nginx App Protect WAF Repository (Shell)\nDESCRIPTION: Adds the Nginx App Protect WAF v5 repository to the APT sources, enabling the installation of the App Protect module. This command constructs the repository URL using the base URL, distribution information, and repository name. It then appends this information to the App Protect APT source list file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-debian.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\nhttps://pkgs.nginx.com/app-protect-x-oss/debian `lsb_release -cs` nginx-plus\\n\" | \\\nsudo tee /etc/apt/sources.list.d/nginx-app-protect.list\n```\n\n----------------------------------------\n\nTITLE: Updating Ubuntu Repository Information\nDESCRIPTION: This command updates the package lists for upgrades and new package installations from the Ubuntu repositories using the apt-get package manager. It is a necessary first step to ensure you have the latest information about available packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get update\n```\n\n----------------------------------------\n\nTITLE: Kubectl Create Docker Registry Secret\nDESCRIPTION: Creates a Kubernetes secret named 'regcred' containing Docker registry credentials. This allows Kubernetes to authenticate and pull images from the specified private registry. Replace <namespace> with the target Kubernetes namespace and <JWT Token> with your actual JWT.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-helm.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nkubectl create secret docker-registry regcred -n <namespace> \\\n    --docker-server=private-registry.nginx.com \\\n    --docker-username=<JWT Token> \\\n    --docker-password=none\n```\n\n----------------------------------------\n\nTITLE: Backup Nginx configuration\nDESCRIPTION: Backs up existing Nginx configuration and log files before installing or upgrading Nginx App Protect. This ensures that you can revert to your previous configuration if needed. The backup is created in the /etc/nginx-plus-backup and /var/log/nginx-plus-backup directories.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo cp -a /etc/nginx /etc/nginx-plus-backup\nsudo cp -a /var/log/nginx /var/log/nginx-plus-backup\n```\n\n----------------------------------------\n\nTITLE: Referenced File Content (modifications.txt) for Local Ref JSON\nDESCRIPTION: This JSON specifies the modifications to the attack signatures loaded from the local file system.  In this example, it disables a specific signature by its ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-references.md#_snippet_7\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"modifications\": [\n        {\n            \"entityChanges\": {\n                \"enabled\": false\n            },\n            \"entity\": {\n                \"signatureId\": 200001834\n            },\n            \"entityType\": \"signature\",\n            \"action\": \"add-or-update\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Setting Up a Proxy\nDESCRIPTION: Explains how to manually define an HTTPS proxy in the agent.conf file. This is necessary if the system is in a DMZ environment without direct access to the Internet. The agent will use common Linux environment variables if available.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/configuring-amplify-agent.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\n[proxies]\nhttps = https://10.20.30.40:3030\n..\n```\n\n----------------------------------------\n\nTITLE: NGINX Agent Logrotate Configuration in YAML\nDESCRIPTION: This YAML snippet shows the default logrotate configuration used by NGINX Agent for log rotation, including daily rotation, size limits, and compression settings. It is located at `/etc/logrotate.d/nginx-agent`. It demonstrates how logs are rotated daily if they exceed 5MB, are truncated after copying, and are compressed, with a maximum age of 10 days and 10 rotations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configuration-overview.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\n/var/log/nginx-agent/*.log\n{\n   # log files are rotated every day\n   daily\n   # log files are rotated if they grow bigger than 5M\n   size 5M\n   # truncate the original log file after creating a copy\n   copytruncate\n   # remove rotated logs older than 10 days\n   maxage 10\n   # log files are rotated 10 times before being removed\n   rotate 10\n   # old log files are compressed\n   compress\n   # if the log file is missing it will go on to the next one without issuing an error message\n   missingok\n   # do not rotate the log if it is empty\n   notifempty\n}\n```\n\n----------------------------------------\n\nTITLE: Example: Enabling Logging for All Modules\nDESCRIPTION: This snippet shows an example of enabling logging for ALL modules, specifying the log levels as `TS_ERR`, `TS_CRIT`, `TS_WARNING`, and `TS_NOTICE`. Log messages will be written to file number 2 (errors.log).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/debug-logs.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\nMODULE = ALL;\nLOG_LEVEL = TS_ERR | TS_CRIT | TS_WARNING | TS_NOTICE;\nFILE=2;\n```\n\n----------------------------------------\n\nTITLE: Install OpenTracing Module on Debian and Ubuntu\nDESCRIPTION: This shell script updates the package repository and installs the `nginx-plus-module-opentracing` package using apt. This enables the OpenTracing module within Nginx Plus. It is compatible with Debian and Ubuntu.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentracing.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-opentracing\n```\n\n----------------------------------------\n\nTITLE: Verify redirect with query parameters for tea with type (Shell)\nDESCRIPTION: This `curl` command sends a request to `http://cafe.example.com/tea/type?test=v1` and includes the response headers to verify the redirect. The `--resolve` option resolves the hostname to the specified IP and Port, and the `--include` option displays the headers, enabling verification of the `Location` header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/tea/type\\?test\\=v1 --include\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Pod Log Collection Script\nDESCRIPTION: A script to collect logs from all pods and containers within a specified Kubernetes namespace. This script iterates through each pod, identifies the containers, and saves their logs to separate files in a timestamped directory.  It requires kubectl to be configured to connect to the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/troubleshooting-guide/troubleshooting.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\n#!/bin/bash\n\nset -x\n\n# Define the namespace variable\nNAMESPACE=\"default\"\n\n# Define a directory to store log files\nlog_dir=\"k8s_logs_$(date +%Y%m%d_%H%M%S)\"\nmkdir -p \"$log_dir\"\n\n# Loop through all pods and containers, saving logs to the defined directory\nfor pod in $(kubectl get pods -n $NAMESPACE -o=name | sed 's|pod/||g'); do\n    for container in $(kubectl get pod/$pod -n $NAMESPACE -o=jsonpath='{.spec.containers[*].name}'); do\n        kubectl logs $pod -c $container -n $NAMESPACE > \"${log_dir}/${pod}_${container}_logs.txt\"\n    done\ndone\n\necho \"Logs collected and archived in ${log_dir}.tar.gz\"\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Signing Key (Debian - Shell)\nDESCRIPTION: This command downloads and adds the NGINX signing key to the apt keyring. This allows apt to verify the authenticity of NGINX packages downloaded from the NGINX repository. `wget` is used to download the key and `apt-key add` adds the key to the keyring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget https://cs.nginx.com/static/keys/nginx_signing.key && sudo apt-key add nginx_signing.key\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Plus OpenTelemetry Module on Alpine (Shell)\nDESCRIPTION: This command updates the package repositories and installs the `nginx-plus-module-otel` package on Alpine systems. This installs the OpenTelemetry module for NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nsudo apk update  && \\\nsudo apk add nginx-plus-module-otel\n```\n\n----------------------------------------\n\nTITLE: Verifying Kubernetes Resources\nDESCRIPTION: This shell command retrieves all pods and services running in the current Kubernetes namespace.  It's used to verify the successful creation of the secure-app resources and their status after deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/securing-backend-traffic.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get pods,svc\n```\n\n----------------------------------------\n\nTITLE: Check UDP Listener Pod Status\nDESCRIPTION: This command checks the status of the Pods created for the `udp-listener` application. It uses `kubectl` to query the Kubernetes cluster and displays the status of each Pod, including its readiness, status, restarts, and age. The expected status is 'Running' with 2/2 containers ready.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-udp-walkthrough.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get pod\nNAME                            READY   STATUS    RESTARTS   AGE\nudp-listener-59665d7ffc-drzh2   2/2     Running   0          4s\n```\n\n----------------------------------------\n\nTITLE: Apply ObservabilityPolicy YAML for HTTPRoute - Kubernetes\nDESCRIPTION: This YAML configuration defines an ObservabilityPolicy named 'coffee' that targets the 'coffee' HTTPRoute. It enables tracing with a sampling ratio of 75% and adds a custom span attribute 'coffee-key' with the value 'coffee-value'. This policy enables tracing for the targeted routes, sampling a set percentage of traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_13\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.nginx.org/v1alpha2\nkind: ObservabilityPolicy\nmetadata:\n  name: coffee\nspec:\n  targetRefs:\n  - group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: coffee\n  tracing:\n    strategy: ratio\n    ratio: 75\n    spanAttributes:\n    - key: coffee-key\n      value: coffee-value\nEOF\n```\n\n----------------------------------------\n\nTITLE: Running NGINX Controller helper script with options\nDESCRIPTION: This command allows installing specific prerequisites (base, docker, or nfs) for NGINX Controller after the initial installation.  It uses the helper script located in `/opt/nginx-controller/` and the `prereqs` option followed by the desired component to install.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/controller/helper-script-prereqs.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh prereqs [base|docker|nfs]\n```\n\n----------------------------------------\n\nTITLE: Fine-Tune Active Health Checks\nDESCRIPTION: Fine-tunes the active health check behavior using the `interval`, `passes`, and `fails` parameters of the `health_check` directive.  `interval` defines how often health check requests are sent, `passes` the number of consecutive successful checks to consider the server healthy, and `fails` the number of consecutive failures to consider it unhealthy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    server {\n        listen       12345;\n        proxy_pass   stream_backend;\n        health_check interval=10 passes=2 fails=3;\n    }\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Installing libmaxminddb-devel on Amazon Linux, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: Installs the libmaxminddb-devel package using yum. This package provides the necessary libraries and headers for working with MaxMind databases.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nyum install libmaxminddb-devel\n```\n\n----------------------------------------\n\nTITLE: Commenting Out Basic Auth Sections\nDESCRIPTION: This YAML snippet shows the configuration to comment out in `nms-http.conf` to disable Basic Auth. This is necessary when switching to OIDC authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_11\n\nLANGUAGE: yaml\nCODE:\n```\n## For use with basic auth\n#auth_basic_user_file /etc/nms/nginx/.htpasswd;\n## auth type indication to the client\n#add_header Nginx-Management-Suite-Auth \"Basic\";\n```\n\n----------------------------------------\n\nTITLE: Enabling Shared Session Cache\nDESCRIPTION: This snippet shows how to enable the shared session cache and disable the built-in session cache using the `ssl_session_cache` directive. This can improve performance by reusing SSL/TLS sessions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nworker_processes auto;\n\n    mail {\n        #...\n        ssl_session_cache shared:SSL:10m;\n        #...\n    }\n```\n\n----------------------------------------\n\nTITLE: Creating Nginx App Protect Repository File on Amazon Linux 2\nDESCRIPTION: This code creates a yum repository configuration file for Nginx App Protect on Amazon Linux 2. It specifies the repository name, base URL, SSL client certificate and key, GPG check, and enabled status.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_14\n\nLANGUAGE: none\nCODE:\n```\n[app-protect-x-oss]\nname=nginx-app-protect repo\nbaseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/7/$basearch/\nsslclientcert=/etc/ssl/nginx/nginx-repo.crt\nsslclientkey=/etc/ssl/nginx/nginx-repo.key\ngpgcheck=0\nenabled=1\n```\n\n----------------------------------------\n\nTITLE: Update CA Trust (RHEL/CentOS - Shell)\nDESCRIPTION: This command updates the system's trusted CA certificates on RHEL/CentOS systems. It updates the trust store based on the files in `/etc/ssl/certs/`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-forward-proxy.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nsudo update-ca-trust\n```\n\n----------------------------------------\n\nTITLE: Docker Compose Configuration for Air-Gapped NGINX App Protect (YAML)\nDESCRIPTION: Defines a Docker Compose configuration for NGINX with App Protect in an air-gapped environment. It specifies the Nginx, waf-enforcer, and waf-config-mgr services, along with volume mounts, network configurations, and dependencies. The image versions are explicitly defined, and the Enforcer port is set via an environment variable.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_19\n\nLANGUAGE: YAML\nCODE:\n```\nservices:\n  nginx:\n    container_name: nginx\n    image: nginx-app-protect-5\n    volumes:\n      - app_protect_bd_config:/opt/app_protect/bd_config\n      - app_protect_config:/opt/app_protect/config\n      - app_protect_etc_config:/etc/app_protect/conf\n      - /conf/nginx.conf:/etc/nginx/nginx.conf # based on the provided example\n      - /conf/default.conf:/etc/nginx/conf.d/default.conf # based on the provided example\n    networks:\n      - waf_network\n    ports:\n      - \"80:80\"\n\n  waf-enforcer:\n    container_name: waf-enforcer\n    image: \"private-registry.nginx.com/nap/waf-enforcer:5.4.0\"\n    environment:\n      - ENFORCER_PORT=50000\n    volumes:\n      - app_protect_bd_config:/opt/app_protect/bd_config\n    networks:\n      - waf_network\n    restart: always\n\n  waf-config-mgr:\n    container_name: waf-config-mgr\n    image: \"private-registry.nginx.com/nap/waf-config-mgr:5.4.0\"\n    volumes:\n      - app_protect_bd_config:/opt/app_protect/bd_config\n      - app_protect_config:/opt/app_protect/config\n      - app_protect_etc_config:/etc/app_protect/conf\n    restart: always\n    network_mode: none\n    depends_on:\n      waf-enforcer:\n        condition: service_started\n\nnetworks:\n  waf_network:\n    driver: bridge\n\nvolumes:\n  app_protect_bd_config:\n  app_protect_config:\n  app_protect_etc_config:\n```\n\n----------------------------------------\n\nTITLE: Building NGINX Plus with App Protect Dockerfile\nDESCRIPTION: This Dockerfile sets up NGINX Plus with App Protect on Oracle Linux 8. It installs necessary packages, configures the NGINX repository using secrets for SSL certificates, installs the App Protect module, and configures logging. It also exposes port 80 and defines the stop signal and default command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-plus/build-oracle.md#_snippet_0\n\nLANGUAGE: dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Base image\nFROM oraclelinux:8\n\n# Install NGINX Plus and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    dnf -y install wget ca-certificates yum-utils \\\n    && wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-8.repo \\\n    && echo \"[app-protect-x-plus]\" > /etc/yum.repos.d/app-protect-8-x-plus.repo \\\n    && echo \"name=nginx-app-protect repo\" >> /etc/yum.repos.d/app-protect-8-x-plus.repo \\\n    && echo \"baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/8/\\$basearch/\" >> /etc/yum.repos.d/app-protect-8-x-plus.repo \\\n    && echo \"sslclientcert=/etc/ssl/nginx/nginx-repo.crt\" >> /etc/yum.repos.d/app-protect-8-x-plus.repo \\\n    && echo \"sslclientkey=/etc/ssl/nginx/nginx-repo.key\" >> /etc/yum.repos.d/app-protect-8-x-plus.repo \\\n    && echo \"gpgcheck=0\" >> /etc/yum.repos.d/app-protect-8-x-plus.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/app-protect-8-x-plus.repo \\\n    && dnf clean all \\\n    && dnf -y install app-protect-module-plus \\\n    && dnf clean all \\\n    && rm -rf /var/cache/dnf \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log\n\n# Expose port\nEXPOSE 80\n\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Remove NGINX Service Mesh from default namespace\nDESCRIPTION: This command removes the NGINX Service Mesh from the default namespace (nginx-mesh). It requires manual cleanup of all Deployments with injected proxies.  The command assumes the user has appropriate permissions to remove resources from the cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl remove\n```\n\n----------------------------------------\n\nTITLE: Removing NGINX Repository Configurations\nDESCRIPTION: Removes previous NGINX repository configuration files, including list files and apt configuration files, to ensure a clean setup.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-debian.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo rm /etc/apt/sources.list.d/nginx*.list\nsudo rm /etc/apt/sources.list.d/*app-protect*.list\nsudo rm /etc/apt/apt.conf.d/90pkgs-nginx\n```\n\n----------------------------------------\n\nTITLE: Request to Echo Server with Forwarded JWT\nDESCRIPTION: This snippet displays the request received by the echo server after the JWT has been forwarded.  Note the `Authorization` header containing the Bearer token, which is the forwarded JWT.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_60\n\nLANGUAGE: shell\nCODE:\n```\nRequest served by echo-host\n\nHTTP/1.0 POST /my/test/api\n\nHost: default_http_07b28d26-9641-4a67-a422-0c4e14f27b03\nAccept: */*\nAccept-Encoding: gzip, deflate, br\nAuthorization: Bearer <access token>\nCache-Control: no-cache\nConnection: close\nContent-Length: 30\nContent-Type: application/json\nX-Correlation-Id: 00342cadec0651b6643fcf092246535f\n```\n\n----------------------------------------\n\nTITLE: Install SQLite on Debian, Ubuntu, and Deb-based distributions\nDESCRIPTION: Installs SQLite on Debian and Ubuntu-based Linux distributions using the apt package manager.  It first updates the package lists and then installs the sqlite3 package. This is suitable for systems excluding Debian (buster/sid) and Ubuntu 18.04.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/sqlite-installation.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get update\nsudo apt-get install -y sqlite3\n```\n\n----------------------------------------\n\nTITLE: Enable and start NGINX Agent\nDESCRIPTION: This command enables the NGINX Agent service to start on boot and starts it immediately. `sudo` is used for elevated privileges, `systemctl enable` configures the service to start on boot, and `--now` starts the service immediately.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl enable nginx-agent --now\n```\n\n----------------------------------------\n\nTITLE: Check Policy Publication Status (GET) - Shell\nDESCRIPTION: This code snippet shows how to check the deployment status for a specific policy using a GET request to the Security Deployments Associations API. It requires the policy name to be included in the URL. Requires `curl`, a valid access token, and the policy name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_25\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET \"https://{{NIM_FQDN}}/api/platform/v1/security/deployments/associations/ignore-xss\" \\\n    -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Install Prerequisites for NGINX Plus on Debian\nDESCRIPTION: Installs the necessary prerequisite packages for installing NGINX Plus on Debian-based systems. These packages include apt-transport-https, lsb-release, ca-certificates, wget, gnupg2, and debian-archive-keyring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update\nsudo apt install apt-transport-https lsb-release ca-certificates wget gnupg2 debian-archive-keyring\n```\n\n----------------------------------------\n\nTITLE: Set Default Command in Dockerfile\nDESCRIPTION: This snippet sets the default command for the Docker container to start Nginx in the foreground. The `-g \"daemon off;\"` configuration ensures that Nginx runs in the foreground and doesn't daemonize.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-plus/build-debian.md#_snippet_3\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Check Log Profile Publication Status (GET) - Shell\nDESCRIPTION: This code snippet shows how to check the deployment status for a specific security log profile using a GET request to the Security Deployments Log Profiles Associations API. It requires the log profile name to be included in the URL. Requires `curl`, a valid access token, and the log profile name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_26\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET \"https://{{NIM_FQDN}}/api/platform/v1/security/deployments/logprofiles/associations/default-log\" \\\n    -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Install GeoIP Module on Alpine\nDESCRIPTION: This shell command installs the nginx-plus-module-geoip package using apk. It's specific to Alpine.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-geoip\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx Configuration\nDESCRIPTION: These commands reload the Nginx configuration without restarting the server.  This allows Nginx to start using the new configuration changes immediately.  The first command uses the `nginx` executable, while the second uses the `service` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_11\n\nLANGUAGE: none\nCODE:\n```\nroot# nginx -s reload\n```\n\nLANGUAGE: none\nCODE:\n```\nroot# service nginx reload\n```\n\n----------------------------------------\n\nTITLE: Test service with curl\nDESCRIPTION: This curl command tests the 'coffee' service using local port forwarding. The `--resolve` option maps the hostname cafe.example.com to 127.0.0.1:8080. This sends an HTTP GET request to /coffee to verify the service is reachable and returns the expected response.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:8080:127.0.0.1 http://cafe.example.com:8080/coffee\n```\n\n----------------------------------------\n\nTITLE: Configure Access Control Lists in Nginx\nDESCRIPTION: This snippet demonstrates configuring IP address-based access control lists (ACLs) to restrict access to the monitoring dashboard. It allows traffic from a specific network (10.0.0.0/8) and denies all other traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_54\n\nLANGUAGE: nginx\nCODE:\n```\nallow 10.0.0.0/8;\ndeny all;\n```\n\n----------------------------------------\n\nTITLE: Pull NGINX Plus Image (Docker)\nDESCRIPTION: This command pulls the NGINX Plus image from the NGINX private registry.  It requires a version tag, such as `alpine`, `debian`, or `ubi`. The `latest` tag is not supported. Replace `VERSION_TAG` with the desired version tag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/containers/connect-nginx-plus-container-images-to-nginx-one.md#_snippet_1\n\nLANGUAGE: sh\nCODE:\n```\nsudo docker pull private-registry.nginx.com/nginx-plus/agent:VERSION_TAG\n```\n\n----------------------------------------\n\nTITLE: Configure Cognito OIDC Provider Details\nDESCRIPTION: This snippet configures the specifics of the Cognito OIDC provider, including the issuer URL, client ID, and client secret.  The issuer URL points to the Cognito User Pool's OIDC endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/cognito.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider cognito {\n        issuer        https://cognito-idp.us-east-2.amazonaws.com/us-east-2_abCdEfGhI;\n        client_id     <client_id>;\n        client_secret <client_secret>;\n    }\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Defining a Connection Limit Zone in Nginx\nDESCRIPTION: This snippet defines a shared memory zone named 'addr' of 10MB to store the number of connections per client IP address. The `$binary_remote_addr` variable is used as the key for tracking connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nlimit_conn_zone $binary_remote_addr zone=addr:10m;\n```\n\n----------------------------------------\n\nTITLE: Refresh and install module (SLES)\nDESCRIPTION: Refreshes the package index and installs a specified NGINX module using zypper.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_30\n\nLANGUAGE: Shell\nCODE:\n```\nzypper refresh\nzypper install <MODULE-NAME>\n```\n\n----------------------------------------\n\nTITLE: Help Message - Bash\nDESCRIPTION: This section defines the help message for the script. It explains the usage of the script and its available options, including JWT file path, NIM IP address, username, password, output zip file, and step (initial or telemetry). It also provides example commands for licensing and usage reporting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nif [ \"$1\" = \"-h\" ] || [ \"$1\" = \"--help\" ]; then\n  echo\n  echo \"Usage: $0 -j <path-to-JWT> -i <NIM-IP> -u <username> -p <password> -o <output zip file> -s <step>\"\n  echo\n  echo \"This script allows you to license NGINX Instance Manager and submit usage reports to F5 in a disconnected environment.\"\n  echo \"It needs to be run on a system that can reach NGINX Instance Manager and the following endpoint on port 443: https://product.apis.f5.com/\"\n  echo\n  echo \"If NGINX Instance Manager is connected to the internet (Connected Mode), please use the UI.\"\n  echo \"This script is only necessary if NGINX Instance Manager is set to Disconnected Mode.\"\n  echo\n  echo \"For Licensing in Disconnected Mode:\"\n  echo \"$0 -j my-jwt.jwt -i <NIM-IP> -u admin -p <password> -o report.zip -s initial\"\n  echo \n  echo \"For Usage Reporting in Disconnected Mode:\"\n  echo \"$0 -j my-jwt.jwt -i <NIM-IP> -u admin -p <password> -o report.zip -s telemetry\"\n  echo \n  echo \"Note: Since NGINX Instance Manager comes with self-signed certificates by default, the --insecure flag is set in this script to run specific Curl commands.\" \n  echo \"You can alter this script if you wish to change from self-signed to verified certificates in Instance Manager.\"\n  echo \n  exit 1\nfi\n```\n\n----------------------------------------\n\nTITLE: Configuring Resolver Status Zone in NGINX\nDESCRIPTION: This snippet demonstrates how to configure a status zone for the resolver using the `resolver` directive in NGINX. This enables statistics collection for DNS resolution, allowing it to be monitored in the live activity monitoring dashboard. The `status_zone` parameter defines the shared memory zone for storing resolver status.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nresolver 192.168.33.70 status_zone=resolver-zone1;\n\nserver {\n    # ...\n    }\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX Signing Key on Alpine (Shell)\nDESCRIPTION: This command downloads the NGINX signing key and saves it in the `/etc/apk/keys/nginx_signing.rsa.pub` file on Alpine systems. This key is used to verify the authenticity of packages from the NGINX repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub\n```\n\n----------------------------------------\n\nTITLE: Including HTTP Configuration Files - Nginx\nDESCRIPTION: This Nginx configuration block includes all HTTP configuration files in the `conf.d` directory that match the pattern `*-http.conf`.  It should be placed inside the `http` block within the main `nginx.conf` file.  This allows for modular configuration of HTTP-related settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    include conf.d/*-http.conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Query Events API for All Events with Bearer Token (curl)\nDESCRIPTION: This example demonstrates how to query the Events API to retrieve all events. It uses a GET request to the `/api/platform/v1/analytics/events` endpoint and includes an Authorization header with a Bearer token for authentication. Replace `<NMS_FQDN>` with the fully qualified domain name of the NGINX Management Suite instance and `<access token>` with a valid access token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"https://<NMS_FQDN>/api/platform/v1/analytics/events\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Apply Rate Limit Configuration\nDESCRIPTION: This command applies the rate limit configuration defined in the 'ratelimit-rules.yaml' file using kubectl. This assumes the 'ratelimit-rules.yaml' file contains the RateLimit resource definition.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f ratelimit-rules.yaml\n```\n\n----------------------------------------\n\nTITLE: NGINX Gateway Fabric values.yaml for tracing configuration\nDESCRIPTION: Defines a `values.yaml` file for configuring NGINX Gateway Fabric with global tracing settings. It configures the OpenTelemetry exporter endpoint and adds a span attribute to all traces.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\ncat <<EOT > values.yaml\nnginx:\n  config:\n    telemetry:\n      exporter:\n        endpoint: otel-collector.tracing.svc:4317\n      spanAttributes:\n      - key: cluster-attribute-key\n        value: cluster-attribute-value\nEOT\n```\n\n----------------------------------------\n\nTITLE: Configuring Proxy Cache in Nginx Location Block (Server block)\nDESCRIPTION: This location block configures proxy caching for a specific URL path. It enables caching using the 'backcache' zone, proxies requests to the 'weblogic' upstream, and enables cache purging based on the '$purge_method' variable. The directives are configured within the server block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_36\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /weblogic-app/ {\n    proxy_cache backcache;\n    proxy_pass http://weblogic;\n    proxy_cache_purge $purge_method;\n}\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration\nDESCRIPTION: This command reloads the Nginx configuration without downtime, applying the changes made to the configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/cognito.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Update Terraform AzureRM provider for NGINXaaS\nDESCRIPTION: This Terraform configuration snippet updates the AzureRM provider to version 4.6.0 or above. This is a prerequisite for migrating to the Standard V2 plan. It specifies the required version of Terraform and the AzureRM provider.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/troubleshooting/migrate-from-standard.md#_snippet_0\n\nLANGUAGE: Terraform\nCODE:\n```\nterraform {\n  required_version = \"~> 1.3\"\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"~> 4.6.0\"\n    }\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Gateway Fabric from Source (NGINX OSS)\nDESCRIPTION: This command installs NGINX Gateway Fabric from local source code into the 'nginx-gateway' namespace using Helm.  It creates the namespace if it does not already exist.  Requires Helm 3.0+, kubectl, and local access to the Helm chart.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nhelm install ngf . --create-namespace -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Test NGINX Configuration\nDESCRIPTION: This shell command tests the NGINX configuration file for syntax errors and general validity. It is used to verify the configuration before reloading NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/perl.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration with Basic Caching\nDESCRIPTION: This Nginx configuration file shows the changes made by NGINX Controller after applying the basic caching configuration. It adds a `proxy_cache_path` directive in the http context and a `proxy_cache` directive in the location block. The `hl_lines` attribute is used to highlight the lines that are added or modified by the API request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-caching.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /tmp/cache-1/app_centric_example-env|example-app-1|example-app-component| max_size=5G min_free=10k keys_zone=app_centric_example-env|example-app-1|example-app-component|/tmp/cache-1:500M purger=off;\n\nserver {\n    server_name test.example.com;\n    listen 80;\n    status_zone server_5ae404e8-005d-38e8-b355-6d54cb219730;\n    set $f5_gateway example-gw;\n    f5_metrics_marker gateway $f5_gateway;\n    set $f5_environment example-env;\n    f5_metrics_marker environment $f5_environment;\n    location / {\n        error_log /dev/null;\n        access_log off;\n        proxy_cache app_centric_example-env|example-app-1|example-app-component|/tmp/cache-1;\n        set $f5_app example-app-1;\n        f5_metrics_marker app $f5_app;\n        set $f5_component example-app-component;\n        f5_metrics_marker component $f5_component;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_set_header Host $host;\n        proxy_set_header Connection '';\n        proxy_http_version 1.1;\n        proxy_pass http://wg-example_http_b4859463-b3bd-4ccb-8442-e21253a50da7;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Update license configuration - NGINX Instance Manager REST API (curl)\nDESCRIPTION: This `curl` command updates the license configuration on the NGINX Instance Manager using a PUT request. It specifies the license type as JWT and defines features with limits.  The `-k` flag skips SSL verification. <NIM-FQDN> and <base64-encoded-credentials> are placeholders.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\ncurl -k --location --request PUT \"https://<NIM-FQDN>/api/platform/v1/license?telemetry=true\" \\\n--header \"Origin: https://<NIM-FQDN>\" \\\n--header \"Referer: https://<NIM-FQDN>/ui/settings/license\" \\\n--header \"Content-Type: application/json\" \\\n--header \"Authorization: Basic <base64-encoded-credentials>\" \\\n--data '{\n  \"desiredState\": {\n    \"content\": \"\",\n    \"type\": \"JWT\",\n    \"features\": [\n      {\"limit\": 0, \"name\": \"NGINX_NAP_DOS\", \"valueType\": \"\"},\n      {\"limit\": 0, \"name\": \"IM_INSTANCES\", \"valueType\": \"\"},\n      {\"limit\": 0, \"name\": \"TM_INSTANCES\", \"valueType\": \"\"},\n      {\"limit\": 0, \"name\": \"DATA_PER_HOUR_GB\", \"valueType\": \"\"},\n      {\"limit\": 0, \"name\": \"NGINX_INSTANCES\", \"valueType\": \"\"},\n      {\"limit\": 0, \"name\": \"NGINX_NAP\", \"valueType\": \"\"},\n      {\"limit\": 0, \"name\": \"SUCCESSFUL_API_CALLS_MILLIONS\", \"valueType\": \"\"},\n      {\"limit\": 0, \"name\": \"IC_PODS\", \"valueType\": \"\"},\n      {\"limit\": 0, \"name\": \"IC_K8S_NODES\", \"valueType\": \"\"}\n    ]\n  },\n  \"metadata\": {\n    \"name\": \"license\"\n  }\n}'\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Configuration Files\nDESCRIPTION: These commands download pre-configured NGINX configuration files for either basic or enhanced Exchange load balancing from the NGINX website.  The files are saved to the /etc/nginx/conf.d directory.  `curl` is the required dependency.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_17\n\nLANGUAGE: none\nCODE:\n```\nroot# cd /etc/nginx/conf.d\nroot# curl https://www.nginx.com/resource/conf/exchange-basic.conf > exchange-basic.conf\n```\n\n----------------------------------------\n\nTITLE: Install SPNEGO Auth Module (FreeBSD)\nDESCRIPTION: Installs the `nginx-plus-module-auth-spnego` package using pkg on FreeBSD. It first updates the package repository and then installs the specified module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/spnego.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-auth-spnego\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Agent with Data Plane Key (Bash)\nDESCRIPTION: This command downloads and executes a script to install NGINX Agent along with its dependencies and packages. The `DATA_PLANE_KEY` environment variable is used to provide the necessary authentication for the agent to connect to NGINX One Console. The `-y` flag automatically answers yes to any prompts during the installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/nginx-configs/add-instance.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ncurl https://agent.connect.nginx.com/nginx-agent/install | DATA_PLANE_KEY=\"<data_plane_key>\" sh -s -- -y\n```\n\n----------------------------------------\n\nTITLE: Verify Coffee Application Deployment\nDESCRIPTION: This command retrieves the status of the pods and service created by the previous deployment. It verifies that the coffee pods are running and the coffee service has been created.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/routing-traffic-to-your-app.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get pods,svc\n```\n\n----------------------------------------\n\nTITLE: Policy Converter Help Output\nDESCRIPTION: This snippet shows the help message output by the `convert-policy` tool when run without the required arguments. It details the required and optional arguments, including input and output file paths, format, and options for handling the configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nUSAGE:\n    /opt/app_protect/bin/convert-policy\n\nRequired arguments:\n    --outfile|o='/path/to/policy.json'\n        File name for where to write exported policy.\n        Can also be set via an environment variable: EXPORT_FILE\n    --infile|i='/path/to/policy.xml'\n        Advanced WAF/ASM Security Policy file to convert\n        Can also be set via an environment variable: IMPORT_FILE\n\nOptional arguments:\n    --format|f='json'\n        Desired output format for signature file. Default 'json'\n        Supported formats: 'json'\n    --keep-full-configuration\n        By default the exported policy will only contain elements that are valid for the environment in which this tool is run.\n        If keep-full-configuration is enabled then the full configuration is retained, including elements that are not supported in NGINX App Protect WAF.\n    --full-export\n        By default the exported policy will only contain elements that are different from the default policy template.\n        If full-export is enabled then all policy elements are included in the export file.\n        When this option is selected, no warnings are generated when removing unsupported elements from the exported policy.\n\nOptionally, using --help will issue this help message.\n```\n\n----------------------------------------\n\nTITLE: Verifying Nginx App Protect DoS Version\nDESCRIPTION: This command is used to verify that the latest version of Nginx App Protect DoS is installed on the EC2 machine. It compares the installed version with the latest release available on the Nginx website. Requires the `admd` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nadmd -v\n```\n\n----------------------------------------\n\nTITLE: CORS Policy Configuration via REST API - JSON Request\nDESCRIPTION: This JSON payload demonstrates how to configure a CORS policy using the NGINX Management Suite API Connectivity Manager REST API. It specifies various CORS settings such as allowed credentials, methods, origins, exposed headers, and maximum age. The request should be sent as part of a `PUT` request to the Proxies endpoint (`/services/workspaces/{SERVICE_WORKSPACE_NAME}/proxies`).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/cors.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n    \"cors\": [\n      {\n        \"action\": {\n          \"allowCredentials\": true,\n          \"allowMethods\": [\n            \"GET\", \"HEAD\", \"PUT\", \"PATCH\", \"POST\"\n          ],\n          \"allowOrigins\": [\n            {\n              \"exact\": \"example.com\"\n            }\n          ],\n          \"exposedHeaders\": [\n            \"header-name\", \"x-correlation-id\"\n          ],\n          \"maxAge\": 30000\n        }\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Amplify Agent Repository (CentOS/RHEL - Bash)\nDESCRIPTION: Creates a repository configuration file for NGINX Amplify Agent on CentOS and Red Hat Linux.  It defines the repository name, base URL, GPG check status, and enablement status, which is then written to `/etc/yum.repos.d/nginx-amplify.repo`. The `release` variable must be properly defined to match the OS version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nrelease=\"7\" && \\\nprintf \"[nginx-amplify]\\nname=nginx amplify repo\\nbaseurl=https://packages.amplify.nginx.com/py3/centos/${release}/\\$basearch\\ngpgcheck=1\\nenabled=1\\n\" > \\\n/etc/yum.repos.d/nginx-amplify.repo\n```\n\n----------------------------------------\n\nTITLE: NGINX Error Log with SSL Handshake Failure (SNI Disabled)\nDESCRIPTION: This log snippet demonstrates the error messages that appear in the NGINX error logs on the data plane proxy host when SNI is required by the Authorization Server but not enabled in NGINX. It shows upstream server temporarily disabled due to SSL handshaking issues and SSL alert handshake failure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/introspection.md#_snippet_2\n\nLANGUAGE: log\nCODE:\n```\n2022/12/04 15:24:43 [warn] 9501#9501: *73 upstream server temporarily disabled while SSL\nhandshaking to upstream, client: 10.0.0.1, server: api.io,\nrequest: \"GET /api HTTP/1.1\", subrequest: \"/_oauth2_send_introspection_request_0a2f6842_default\",\nupstream: \"https://test.oauth.com:443/test/oauth2/introspect\", host: \"api.io\"\n\n2022/12/04 15:24:43 [error] 9501#9501: *73 js: OAuth unexpected response from introspection server\n(HTTP 502): {\"message\":\"Bad Gateway\",\"status\":\"502\"}\n\n2022/12/04 15:25:27 [error] 9500#9500: *79 SSL_do_handshake() failed (SSL: error:14094410:SSL\nroutines:ssl3_read_bytes:sslv3 alert handshake failure:SSL alert number 40) while SSL handshaking\nto upstream, client: 10.0.0.1, server: api.io, request: \"GET /api HTTP/1.1\",\nsubrequest: \"/_oauth2_send_introspection_request_0a2f6842_default\",\nupstream: \"https://test.oauth.com:443/test/oauth2/introspect\", host: \"api.io\"\n```\n\n----------------------------------------\n\nTITLE: Configure Access Control Routing Policy via API\nDESCRIPTION: This JSON snippet demonstrates how to define an access control routing policy using the API Connectivity Manager's REST API. It shows how to specify conditions based on JWT claims ('token.role' and 'token.sub') to allow access to the API's GET method. Requests must satisfy all conditions to be granted access. The `matchType` field defines how the values will be compared.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/access-control-routing.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n\"policies\": {\n    \"access-control-routing\": [\n            {\n                \"action\": {\n                    \"conditions\": [\n                        {\n                            \"allowAccess\": {\n                                \"httpMethods\": [\"GET\"]\n                            },\n                            \"when\": [\n                                {\n                                    \"key\": \"token.role\",\n                                    \"matchType\": \"STRING\",\n                                    \"matchOneOf\": {\n                                        \"values\": [\n                                            \"admin\"\n                                        ]\n                                    }\n                                },\n                                {\n                                    \"key\": \"token.sub\",\n                                    \"matchType\": \"REGEX\",\n                                    \"matchOneOf\": {\n                                        \"values\": [\n                                            \"^.*test.com\"\n                                        ]\n                                    }\n                                }\n                            ]\n                        }\n                    ]\n                }\n            }\n        ]\n}\n```\n\n----------------------------------------\n\nTITLE: Determine Site Returned by NS1 After Threshold Exceeded\nDESCRIPTION: This snippet uses the `nslookup` command to determine which IP address NS1 is returning for a given domain after the connection threshold has been exceeded. This verifies that NS1 has shifted traffic to a different NGINX Plus instance. It queries a DNS server to resolve the domain name and outputs the corresponding IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\n$ nslookup nginxgslb.cf\n\nServer:     10.10.100.102\nAddress:    10.10.100.102#53\n\nNon-authoritative answer:\nName:\tnginxgslb.cf\nAddress: 10.10.10.2\n```\n\n----------------------------------------\n\nTITLE: Generating a Certificate Signing Request (CSR)\nDESCRIPTION: This command creates a Certificate Signing Request (CSR) using OpenSSL. The CSR includes the public key and other information that is submitted to a Certificate Authority (CA) to request a signed certificate. It uses the private key generated in the previous step.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl req -new -sha256 -key ~/example.com.key -out ~/example.com.csr\n```\n\n----------------------------------------\n\nTITLE: Restarting nms-integrations service - Shell\nDESCRIPTION: This command restarts the `nms-integrations` service. This is often necessary after making configuration changes related to NGINX App Protect certificates and keys. It ensures that the changes are applied correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/known-issues.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nms-integrations\n```\n\n----------------------------------------\n\nTITLE: Enable ACM Module in values.yaml\nDESCRIPTION: This YAML snippet configures the `values.yaml` file for enabling the API Connectivity Manager module, specifying the image repository, tag, and image pull secrets.  Replace `<my-docker-registry:port>` with the address and port of your private Docker registry and `<version>` with the version tag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/deploy-api-connectivity-manager.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\n# values.yaml\nglobal:\n    nmsModules:\n        nms-acm:\n            enabled: true\nnms-acm:\n    imagePullSecrets:\n    - name: regcred\n    acm:\n        image:\n            repository: <my-docker-registry:port>/nms-acm\n            tag: <version>\n```\n\n----------------------------------------\n\nTITLE: Generating RSA Key Pair\nDESCRIPTION: This command generates an RSA private key pair in PEM format, encrypting the private key with the DES3 algorithm. It requires the openssl software to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl genrsa -des3 -out ~/private-key.pem 2048\nGenerating RSA private key  ...\nEnter pass phrase for private-key.pem:\n```\n\n----------------------------------------\n\nTITLE: Get All Services using kubectl\nDESCRIPTION: This command retrieves a list of all services across all namespaces in the Kubernetes cluster. It's used to verify that the expected services (coffee, tea, nginx-gateway) are running and accessible.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get service --all-namespaces\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Amplify Agent (CentOS/RHEL/Amazon Linux - Bash)\nDESCRIPTION: Installs the NGINX Amplify Agent using `yum install`. This command installs the Nginx Amplify Agent package and any required dependencies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\nyum install nginx-amplify-agent\n```\n\n----------------------------------------\n\nTITLE: Installing Lua module on FreeBSD\nDESCRIPTION: These commands update the package repository and install the `nginx-plus-module-lua` package using `pkg`. This assumes that the nginx-plus repository is configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/lua.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-lua\n```\n\n----------------------------------------\n\nTITLE: Including Status Configuration File in Nginx\nDESCRIPTION: This snippet shows how to include the `status.conf` file in the Nginx configuration to enable live activity monitoring. The `include` directive is used within the `http` block to read the configuration from the specified file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_35\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block in nginx.conf\ninclude conf.d/status.conf;\n```\n\n----------------------------------------\n\nTITLE: Add Docker Repository on RHEL 8\nDESCRIPTION: This command adds the official Docker CE repository to the yum configuration. This allows the system to download and install Docker packages directly from Docker's repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo\n```\n\n----------------------------------------\n\nTITLE: Upgrade API Connectivity Manager Package (RPM)\nDESCRIPTION: This command upgrades the API Connectivity Manager package on RPM-based systems like CentOS and RHEL. It uses the `rpm` command with the `-Uvh` option to upgrade the package while skipping signature verification. Replace `<version>` with the actual ACM version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm-offline.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo rpm -Uvh --nosignature /home/user/nms-api-connectivity-manager_<version>.x86_64.rpm\n```\n\n----------------------------------------\n\nTITLE: Disable App Protect for DoS API Location - Shell\nDESCRIPTION: This configuration snippet demonstrates how to disable NGINX App Protect WAF for the location of the DoS Live Activity Monitoring API.  This is necessary if NGINX App Protect WAF is also installed to prevent conflicts. The `app_protect_enable off;` directive disables WAF for the specified location, while `app_protect_dos_api;` enables the DoS API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-3.1.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nlocation /api {\n    app_protect_enable off;\n    app_protect_dos_api;\n    }\n```\n\n----------------------------------------\n\nTITLE: Scanning NGINX Instances via API (Shell)\nDESCRIPTION: This shell command initiates a scan for NGINX instances using the NGINX Instance Manager API. It sends a POST request to the scan endpoint with the CIDR block and the port ranges to scan.  It requires a valid access token for authorization and uses the application/json content type. It defaults to ICMP host discovery if hostDiscovery parameter is omitted.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/scan-instances.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ncurl --request POST \\\n  --url https://<NGINX-INSTANCE-MANAGER-FQDN>/api/platform/v1/servers/scan \\\n  --header 'Authorization: Bearer <access token>' \\\n  --header 'content-type: application/json' \\\n  --data '{\"cidr\": \"192.0.2.0/24\",\"portRanges\": [\"80\",\"443\"]}'\n```\n\n----------------------------------------\n\nTITLE: Configuring Location for Caching\nDESCRIPTION: This configuration snippet configures a specific location block to utilize the previously defined cache, proxying requests to the backend WebLogic server and utilizing the 'backcache' cache zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_22\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /weblogic-app/ {\n    proxy_pass http://weblogic;\n    proxy_cache backcache;\n}\n```\n\n----------------------------------------\n\nTITLE: Synchronizing Shared Memory Zones with limit_req_zone in NGINX\nDESCRIPTION: This code snippet demonstrates how to configure the `limit_req_zone` directive to synchronize shared memory zones across multiple NGINX instances. It sets a rate limit of 1 request per second for each client IP address and enables synchronization of the zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n    limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s sync;\n}\n```\n\n----------------------------------------\n\nTITLE: Apply ClientSettingsPolicy to HTTPRoute\nDESCRIPTION: This snippet applies a ClientSettingsPolicy to the tea HTTPRoute, setting the client_max_body_size to 75 bytes. This overrides the gateway-level policy for this specific route.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_15\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.nginx.org/v1alpha1\nkind: ClientSettingsPolicy\nmetadata:\n  name: tea-client-settings\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: tea\n  body:\n    maxSize: \"75\" # sizes without a unit are bytes.\nEOF\n```\n\n----------------------------------------\n\nTITLE: Description of system.net.drops_in.count and system.net.drops_out.count metrics\nDESCRIPTION: Provides the type and description for the system.net.drops_in.count and system.net.drops_out.count metrics which is a counter in integer representing Network I/O statistics. Total number of inbound or outbound packets dropped, per network interface.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_9\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Network I/O statistics. Total number of inbound or outbound packets\n               dropped, per network interface.\n```\n\n----------------------------------------\n\nTITLE: Configuring SSL/TLS Protocols and Ciphers\nDESCRIPTION: This configuration snippet demonstrates how to configure the SSL/TLS protocols and ciphers used by the mail proxy. It uses the `ssl_protocols` and `ssl_ciphers` directives to specify the allowed protocols and ciphers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nmail {\n        #...\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        ssl_ciphers   HIGH:!aNULL:!MD5;\n    }\n```\n\n----------------------------------------\n\nTITLE: Define Backup Location for Security Event Logs in NGINX\nDESCRIPTION: This snippet demonstrates how to define a local backup location for NGINX App Protect security event logs using the `app_protect_security_log` directive within a URI Snippet.  It shows how to configure the Component's `configSnippets` to include the directive and specify the log file locations. The snippet is intended for use with NGINX Controller and NGINX App Protect WAF and requires that WAF is enabled on the component.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/concepts/extend-app-security-snippets.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"<component-name>\"\n    },\n    \"desiredState\": {\n        \"ingress\": {\n            \"uris\": {\n                \"/\": {\n                }\n            },\n            \"gatewayRefs\": [\n                    {\n                        \"ref\": \"/services/environments/environment-name/gateways/<gateway-name>\"\n                    }\n                ]\n        },\n        \"security\": {\n            \"strategyRef\": {\n                \"ref\": \"/security/strategies/balanced_default\"\n            },\n            \"waf\": {\n                \"isEnabled\": true\n            }\n        },\n        \"backend\": {\n            \"workloadGroups\": {\n                \"servers\": {\n                    \"uris\": {\n                        \"https://test-01.example.com\": {\n                        },\n                        \"https://test-02.example.com\": {\n                        }\n                    }\n                }\n            }\n        },\n        \"configSnippets\": {\n            \"uriSnippets\": [\n                {\n                    \"directives\": [\n                        {\n                            \"directive\":\"app_protect_security_log\",\n                            \"args\": [\"/etc/controller-agent/configurator/auxfiles/log-default.json\", \"/var/log/app_protect/security.log\"]\n                        }\n                    ]\n                }\n            ]\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Restart Nginx Agent\nDESCRIPTION: Restarts the Nginx Agent service using `systemctl restart nginx-agent`. This command ensures that the Nginx Agent applies the latest configuration changes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP Server Status Zone in NGINX\nDESCRIPTION: This snippet demonstrates how to configure a `status_zone` directive within a `server` block in NGINX to enable statistics collection for HTTP servers and locations.  This allows the HTTP server and specific location to appear in the live activity monitoring dashboard. Requires Nginx Plus R19 or later to enable location level monitoring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    # ...\n    status_zone status_page;\n    location / {\n        proxy_pass http://backend;\n        status_zone location_zone;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Update Proxy with Token Cache Duration - JSON\nDESCRIPTION: This JSON payload defines the proxy configuration with an Introspection policy.  It sets the `cacheIntrospectionResponse` value to \"10s\", enabling token caching for 10 seconds.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_38\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"test-proxy\",\n   \"version\": \"v1\",\n   \"proxyConfig\": {\n      \"hostname\": \"data-host\",\n      \"ingress\": {\n         \"basePath\": \"/\",\n         \"basePathVersionAppendRule\": \"NONE\"\n      },\n      \"backends\": [\n         {\n            \"serviceName\": \"backend-echo-svc\",\n            \"serviceTargets\": [\n               {\n                  \"hostname\": \"192.0.2.4\",\n                  \"listener\": {\n                     \"enableTLS\": false,\n                     \"port\": 10000,\n                     \"transportProtocol\": \"HTTP\"\n                  }\n               }\n            ]\n         }\n      ],\n      \"policies\": {\n         \"oauth2-introspection\": [\n            {\n               \"action\": {\n                  \"introspectionEndpoint\": \"http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect\",\n                        \"cacheIntrospectionResponse\": \"10s\"\n\n               },\n               \"data\": [\n                  {\n                     \"clientAppID\": \"nginx-plus\",\n                     \"clientSecret\": \"<client secret>\"\n                  }\n               ]\n            }\n         ]\n      }\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Generate Private Key OpenSSL\nDESCRIPTION: This command generates a 2048-bit RSA private key using OpenSSL and saves it to a file. The private key is used for creating SSL/TLS certificates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_11\n\nLANGUAGE: Shell\nCODE:\n```\nroot# openssl genrsa -out ~/company.com.key 2048\n```\n\n----------------------------------------\n\nTITLE: Verify nginx signing key\nDESCRIPTION: This command checks the downloaded nginx signing key to ensure it is correct. It displays the fingerprint of the key, which should be compared against the official fingerprint. If the fingerprint is different, the file should be removed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\ngpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Instance Manager with Helm\nDESCRIPTION: This command installs NGINX Instance Manager using Helm.  It sets the admin password hash, specifies the chart, creates the namespace, uses a custom values.yaml file, and waits for the deployment to complete.  It's a crucial step in deploying NGINX Instance Manager in a Kubernetes environment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nhelm install -n nms \\\n--set adminPasswordHash=$(openssl passwd -6 'YourPassword123#') \\\nnms nginx-stable/nms-hybrid \\\n--create-namespace \\\n-f <path-to-your-values.yaml> \\\n[--version <chart-version>] \\\n--wait\n```\n\n----------------------------------------\n\nTITLE: Adding status_zone for Monitoring\nDESCRIPTION: This adds a status zone named 'tomcat' to the 'server' block for HTTPS traffic. The `status_zone` directive allows the monitoring module to collect and display metrics for the specified zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_39\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nstatus_zone tomcat;\n```\n\n----------------------------------------\n\nTITLE: Planning Terraform Deployment\nDESCRIPTION: This command creates an execution plan that shows the changes Terraform will make to your infrastructure. It compares the current state with the desired state defined in your Terraform configuration. Reviewing the plan is crucial before applying any changes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/create-deployment/deploy-terraform.md#_snippet_1\n\nLANGUAGE: Bash\nCODE:\n```\nterraform plan\n```\n\n----------------------------------------\n\nTITLE: Backing Up the Private Key\nDESCRIPTION: This command copies the generated private key to a secure directory for backup. Losing the private key renders the certificate unusable, making a secure backup essential. Replace `<SECURE-DIR>` with the actual path to your secure backup directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nroot# cp ~/example.com.key <SECURE-DIR>/example.com.key.backup\n```\n\n----------------------------------------\n\nTITLE: Fetching OpenID Configuration from AD FS\nDESCRIPTION: This command uses `curl` to retrieve the OpenID Connect configuration from an AD FS server. The output is then piped to `python -m json.tool` for pretty printing and easy readability. This configuration contains important endpoints like the authorization, token, and JWK endpoints.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/active-directory-federation-services.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\n$ curl https://<ADFS-server-address>/oidc/adfs/.well-known/openid-configuration | python -m json.tool\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX from Ubuntu Repository\nDESCRIPTION: This command installs the NGINX web server package from the Ubuntu repositories using the apt-get package manager. It downloads and installs the package along with its dependencies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get install nginx\n```\n\n----------------------------------------\n\nTITLE: Check Nginx Plus Status\nDESCRIPTION: This command checks the status of the NGINX Plus server after the virtual machine launches. It requires access to the virtual machine's command line.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus-microsoft-azure.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\n/etc/init.d/nginx status\n```\n\n----------------------------------------\n\nTITLE: Extract Private Key from PFX OpenSSL\nDESCRIPTION: This command extracts the private key from a .pfx file (PKCS#12 archive) using OpenSSL. It prompts for the .pfx file password and then prompts for a password to encrypt the extracted key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_13\n\nLANGUAGE: Shell\nCODE:\n```\nroot# openssl pkcs12 -in exported-certs.pfx -nocerts -out company.com.key.encrypted\n```\n\n----------------------------------------\n\nTITLE: Configuring User-Defined Browsers to Block All Except Specific Ones in Nginx\nDESCRIPTION: This JSON snippet demonstrates how to configure user-defined browsers and set up a policy to block all browsers except for those with a 'detect' or 'alarm' action. It showcases the use of `minVersion` and `maxVersion` to specify version ranges for applying actions to specific factory browsers. The 'unknown' class is configured to block requests if no browser is detected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/user-defined-browser-control.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"applicationLanguage\": \"utf-8\",\n        \"name\": \"example_2\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"browser-definitions\": [\n            {\n                \"name\": \"FunkyBrowserV3\",\n                \"matchString\": \"FunkyBrowser/1.3.1\",\n            },\n            {\n                \"name\": \"SmartBrowser4\",\n                \"matchRegex\": \"smartbrowser/([\\\\d.]+)\",\n            }\n        ],\n        \"bot-defense\": {\n            \"settings\" : {\n                \"isEnabled\": true\n            },\n            \"mitigations\": {\n                \"classes\": [\n                    {\n                        \"name\": \"browser\",\n                        \"action\": \"block\"\n                    },\n                    {\n                        \"name\": \"unknown\",\n                        \"action\": \"block\"\n                    }\n                ],\n                \"browsers\": [\n                    {\n                        \"name\": \"safari\",\n                        \"action\": \"detect\"\n                    },\n                    {\n                        \"name\": \"chrome\",\n                        \"minVersion\": 77,\n                        \"action\": \"alarm\"\n                    },\n                    {\n                        \"name\": \"firefox\",\n                        \"minVersion\": 45,\n                        \"maxVersion\": 60,\n                        \"action\": \"detect\"\n                    },\n                    {\n                        \"name\": \"FunkyBrowserV3\",\n                        \"action\": \"detect\"\n                    }\n                ]\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Agent with Instance Group (Bash)\nDESCRIPTION: This command installs the NGINX Agent and specifies the instance group during installation using the `--instance-group` flag. This allows assigning the instance to an instance group during installation. Requires `sudo` privileges and the previously downloaded `install.sh` script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/manage-instance-groups.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo sh ./install.sh --instance-group <group name>\n```\n\nLANGUAGE: bash\nCODE:\n```\nsudo sh install.sh --instance-group nginx-01\n```\n\n----------------------------------------\n\nTITLE: Create NGINX Controller Support Package\nDESCRIPTION: This command creates a support package for NGINX Controller. It allows specifying the output file name, skipping the database dump, and adjusting the timeseries data included. It is crucial for diagnosing issues and required for opening a ticket with NGINX Support.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-controller.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh supportpkg [-o|--output <file name>] [-s|--skip-db-dump] [-t|--timeseries-dump <hours>]\n```\n\n----------------------------------------\n\nTITLE: Installing ca-certificates Dependency\nDESCRIPTION: This snippet shows how to install the 'ca-certificates' dependency using the 'dnf' package manager. First, the system is updated using 'sudo dnf update', and then the 'ca-certificates' package is installed using 'sudo dnf install ca-certificates'. This ensures that the system trusts the Certificate Authorities used by websites.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/install-ca-certificates-dependency-dnf.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\nsudo dnf update\nsudo dnf install ca-certificates\n```\n\n----------------------------------------\n\nTITLE: Updating and Installing Packages on Debian (Shell)\nDESCRIPTION: This command updates the package repositories and installs the necessary packages (apt-transport-https, lsb-release, ca-certificates, wget, gnupg2, debian-archive-keyring) on Debian systems.  These packages are required for accessing HTTPS repositories and managing packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install apt-transport-https \\\n                     lsb-release \\\n                     ca-certificates \\\n                     wget \\\n                     gnupg2 \\\n                     debian-archive-keyring\n```\n\n----------------------------------------\n\nTITLE: Creating Azure Instance Template (Custom Image) in JSON\nDESCRIPTION: This JSON configuration creates an Azure Instance Template using a custom image. It needs the resource ID for the Azure image and the ID for the Azure network interface.  It defines the type as `AZURE_IMAGE_ID` and `AZURE_NIC_ID` for the image and network interface, respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/add-azure-instance.md#_snippet_3\n\nLANGUAGE: JSON\nCODE:\n```\n{\n      \"metadata\": {\n      \"name\": \"my-azure-template-for-standard-A1\",\n      },\n      \"desiredState\": {\n        \"type\": \"AZURE_INSTANCE_TEMPLATE\",\n        \"image\": {\n          \"type\": \"AZURE_IMAGE_ID\",\n          \"imageID\": \"<the resource ID for the Azure image>\"\n        },\n        \"instanceType\": \"Standard_A1\",\n        \"adminUser\": \"azureuser\",\n        \"publicKey\": \"<the complete ssh-rsa string>\",\n        \"networkInterface\": {\n          \"type\": \"AZURE_NIC_ID\",\n          \"nicID\": \"<the ID for the Azure network interface>\"\n        }\n      }\n    }\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisites on Amazon Linux 2023\nDESCRIPTION: This command installs the necessary prerequisites for installing NGINX Agent on Amazon Linux 2023. It installs yum-utils and procps-ng using the dnf package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_29\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf install yum-utils procps-ng\n```\n\n----------------------------------------\n\nTITLE: Signature Report JSON Output Example\nDESCRIPTION: This JSON represents an example of the signature report output, containing information about various attack signatures. Each signature object includes details such as `isUserDefined`, `attackType`, `name`, `hasCve`, `systems`, `references`, `signatureId`, `signatureType`, `risk` and `accuracy`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_24\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"signatures\": [\n        {\n            \"isUserDefined\": false,\n            \"attackType\": {\n                \"name\": \"Detection Evasion\"\n            },\n            \"name\": \"Unicode Fullwidth ASCII variant\",\n            \"hasCve\": false,\n            \"systems\": [\n                {\n                    \"name\": \"IIS\"\n                }\n            ],\n            \"references\": [\n                {\n                    \"value\": \"infosecauditor.wordpress.com/2013/05/27/bypassing-asp-net-validaterequest-for-script-injection-attacks/\",\n                    \"type\": \"url\"\n                }\n            ],\n            \"signatureId\": 299999999,\n            \"signatureType\": \"request\",\n            \"risk\": \"low\",\n            \"accuracy\": \"low\"\n        },\n        {\n            \"isUserDefined\": false,\n            \"attackType\": {\n                \"name\": \"Predictable Resource Location\"\n            },\n            \"name\": \"IIS Web Server log dir access (/W3SVC..)\",\n            \"hasCve\": false,\n            \"systems\": [\n                {\n                    \"name\": \"IIS\"\n                }\n            ],\n            \"references\": [\n                {\n                    \"value\": \"www.webappsec.org/projects/threat/classes/predictable_resource_location.shtml\",\n                    \"type\": \"url\"\n                }\n            ],\n            \"signatureId\": 200000001,\n            \"signatureType\": \"request\",\n            \"risk\": \"low\",\n            \"accuracy\": \"high\"\n        },\n        {\n            \"isUserDefined\": false,\n            \"name\": \"WEB-INF dir access (/WEB-INF/)\",\n            \"attackType\": {\n                \"name\": \"Predictable Resource Location\"\n            },\n            \"hasCve\": true,\n            \"systems\": [\n                {\n                    \"name\": \"Java Servlets/JSP\"\n                },\n                {\n                    \"name\": \"Macromedia JRun\"\n                },\n                {\n                    \"name\": \"Jetty\"\n                }\n            ],\n            \"references\": [\n                {\n                    \"value\": \"www.webappsec.org/projects/threat/classes/predictable_resource_location.shtml\",\n                    \"type\": \"url\"\n                },\n                {\n                    \"value\": \"CVE-2016-4800\",\n                    \"type\": \"cve\"\n                },\n                {\n                    \"value\": \"CVE-2007-6672\",\n                    \"type\": \"cve\"\n                }\n            ],\n            \"signatureType\": \"request\",\n            \"risk\": \"low\",\n            \"signatureId\": 200000018\n        }\n    ],\n    \"revisionDatetime\": \"2019-07-16T12:21:31Z\"\n}\n```\n\n----------------------------------------\n\nTITLE: SELinux Module Installation and Policy Loading for nginx-agent (Bash)\nDESCRIPTION: These commands install a custom SELinux module for nginx-agent, load the SELinux policy, and restore the file context for the nginx-agent binaries, logs, and configuration files. This is necessary to allow nginx-agent to operate correctly under SELinux.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/installation/agent-selinux.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo semodule -n -i /usr/share/selinux/packages/nginx_agent.pp\nsudo /usr/sbin/load_policy\nsudo restorecon -R /usr/bin/nginx-agent\nsudo restorecon -R /var/log/nginx-agent\nsudo restorecon -R /etc/nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Send Traffic to HTTPRoute - Shell\nDESCRIPTION: This command sends an HTTP request to the '/coffee' endpoint of the 'cafe.example.com' domain, resolving the domain name to a specified IP address and port using the `--resolve` flag.  The `$GW_PORT` and `$GW_IP` environment variables need to be properly set for this command to execute successfully. Multiple runs of this command trigger the configured tracing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee\n```\n\n----------------------------------------\n\nTITLE: Checking NGINX Plus Version\nDESCRIPTION: This command checks the installed version of NGINX Plus. It's a prerequisite to ensure that the version is Release 34 or later to support the OpenID Connect module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/okta.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nnginx -v\n```\n\n----------------------------------------\n\nTITLE: Simulating LB Instance Failure with iptables\nDESCRIPTION: This command uses iptables to drop all incoming TCP traffic on port 80 to simulate an NGINX Plus Load Balancer instance going offline.  It is used to test the failover capabilities of the GCE network load balancer.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\niptables -A INPUT -p tcp --destination-port 80 -j DROP\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Public Key (Ubuntu/Debian - Bash - Alternative)\nDESCRIPTION: An alternative method to add the NGINX public key to the system's trusted keys using wget, enabling verification of packages from the NGINX repository. It uses `wget` and `apt-key` to retrieve and add the key. The key is required for installing Nginx Amplify Agent on Debian based systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nwget -q -O - \\\nhttps://nginx.org/keys/nginx_signing.key | apt-key add -\n```\n\n----------------------------------------\n\nTITLE: Verify Virtual IP Assignment\nDESCRIPTION: This snippet verifies if the virtual IP address is assigned to the secondary server after a failover. It uses `ip a` to display network interfaces and filters for the virtual IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nip a | grep <VIRTUAL_IP_ADDRESS>\n```\n\n----------------------------------------\n\nTITLE: Install Traffic Control Utility\nDESCRIPTION: Installs the `iproute-tc` package using yum. This package provides utilities for traffic control, which is necessary for Kubernetes networking.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum install iproute-tc\n```\n\n----------------------------------------\n\nTITLE: Install PostgreSQL (Debian, Ubuntu, Deb-based)\nDESCRIPTION: Installs PostgreSQL on Debian, Ubuntu, or other Deb-based systems using `apt-get`. It installs the `postgresql` package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get install -y postgresql\n```\n\n----------------------------------------\n\nTITLE: Configuring TLS Policies via API using JSON\nDESCRIPTION: This JSON configuration defines the TLS policies for securing communication between the Developer Portal and API Connectivity Manager. It specifies the environment name, functions, proxies, listeners, and policies, including TLS inbound and TLS backend configurations.\nDependencies: Requires the tlsServerKey, tlsServerCert, caCert, tlsClientKey, and tlsClientCert variables to be defined.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/tls-policies.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"{{environmentName}}\",\n    \"functions\": [\n        \"DEVPORTAL\"\n    ],\n    \"proxies\": [\n        {\n            \"proxyClusterName\": \"{{portalInstanceGName}}\",\n            \"hostnames\": [\n                \"acm.{{portalEnvironmentHostname}}\"\n            ],\n            \"runtime\": \"PORTAL-PROXY\",\n            \"listeners\": [\n                {\n                    \"transportProtocol\": \"HTTP\",\n                    \"port\": 443,\n                    \"tlsEnabled\": true,\n                    \"ipv6\": false\n                }\n            ],\n            \"policies\": {\n                \"tls-inbound\": [\n                    {\n                        \"action\": {\n                            \"cipher\": \"ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5\",\n                            \"protocols\": [\n                                \"TLSv1.2\"\n                            ],\n                            \"sessionCache\": {\n                                \"enable\": \"on\",\n                                \"size\": \"10M\",\n                                \"type\": \"shared\"\n                            },\n                            \"sessionTimeout\": \"5m\",\n                            \"enableMTLS\": {\n                               \"certVerify\": true,\n                               \"certChainVerifyDepth\": 2\n                            }\n                        },\n                        \"data\": {\n                            \"serverCerts\": [\n                                {\n                                    \"key\": {{tlsServerKey}},\n                                    \"cert\": {{tlsServerCert}}\n                                }\n                            ],\n                            \"clientCerts\": [\n                               {\n                                  \"clientId\": \"client-1\",\n                                  \"cert\": {{caCert}},\n                               }\n                            ]\n                        }\n                    }\n                ],\n                \"tls-backend\": [\n                    {\n                        \"action\": {\n                            \"cipher\": \"HIGH:!aNULL:!MD5\",\n                            \"sessionReuse\": false,\n                            \"proxyServerName\": false,\n                            \"protocols\": [\n                                \"TLSv1.2\"\n                            ]\n                        },\n                        \"data\": {\n                            \"clientCerts\": [\n                                {\n                                    \"key\": {{tlsClientKey}},\n                                    \"cert\": {{tlsClientCert}}\n                                }\n                            ]\n                        }\n                    }\n                ]\n            }\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Enable gRPC Interface - YAML\nDESCRIPTION: This YAML configuration snippet configures the NGINX Agent to communicate with the mock control plane via gRPC. It specifies the host and port of the control plane.  TLS is disabled in this example, which is not recommended for production.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/getting-started.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\nserver:\n  host: 127.0.0.1 # mock control plane host\n  grpcPort: 54789 # mock control plane gRPC port\n\n# gRPC TLS options - DISABLING TLS IS NOT RECOMMENDED FOR PRODUCTION\ntls:\n  enable: false\n  skip_verify: true\n```\n\n----------------------------------------\n\nTITLE: Restart Kubernetes Deployment\nDESCRIPTION: This shell command triggers a rolling restart of a specified Kubernetes deployment. It is used to apply configuration changes or updates to the deployment without downtime.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nkubectl rollout restart deployment.apps/nap5-deployment\n```\n\n----------------------------------------\n\nTITLE: Create NGINX Configuration with Protected Files - Azure CLI\nDESCRIPTION: This command creates an NGINX configuration with both regular and protected files. Protected files are encrypted, requiring integration with Azure Key Vault and a managed identity. The `--protected-files` argument accepts a JSON array, similar to `--files`, defining the content and virtual paths of the protected files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configuration-azure-cli.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment configuration create --name default \\\n      --deployment-name 0102242023test --resource-group azclitest-geo \\\n      --root-file /etc/nginx/nginx.conf \\\n      --files \"[{'content':'aHR0cCB7CiAgICB1cHN0cmVhbSBhcHAgewogICAgICAgIHpvbmUg \n      YXBwIDY0azsKICAgICAgICBsZWFzdF9jb25uOwogICAgICAgIHNlcnZlciAxMC4wLjEu \n      NDo4MDAwOwogICAgfQoKICAgIHNlcnZlciB7CiAgICAgICAgbGlzdGVuIDgwOwogICAg \n      ICAgIHNlcnZlcl9uYW1lICouZXhhbXBsZS5jb207CgogICAgICAgIGxvY2F0aW9uIC8g \n      ewogICAgICAgICAgICBpbmNsdWRlIC9ldGMvbmdpbngvY29uZi5kL3Byb3h5LmNvbmY7 \n      CiAgICAgICAgICAgIHByb3h5X3Bhc3MgaHR0cDovL2FwcDsKICAgICAgICAgICAgaGVh \n      bHRoX2NoZWNrOwogICAgICAgIH0KICAgICAgICAKICAgIH0KfQ==', \\\n      'virtual-path':'/etc/nginx/nginx.conf'}, \\\n      {'content':'cHJveHlfc2V0X2hlYWRlciBIb3N0ICRob3N0Owpwcm94eV9zZXRfaGVhZGVy \n      IFgtUmVhbC1JUCAkcmVtb3RlX2FkZHI7CnByb3h5X3NldF9oZWFkZXIgWC1Qcm94eS1B \n      cHAgYXBwOwpwcm94eV9zZXRfaGVhZGVyIEdpdGh1Yi1SdW4tSWQgMDAwMDAwOwpwcm94 \n      eV9idWZmZXJpbmcgb247CnByb3h5X2J1ZmZlcl9zaXplIDRrOwpwcm94eV9idWZmZXJz \n      IDggOGs7CnByb3h5X3JlYWRfdGltZW91dCA2MHM7', \\\n      'virtual-path':'/etc/nginx/conf.d/proxy.conf'}]\" \\\n      --protected-files \"[{'content':'aHR0cCB7CiAgICB1cHN0cmVhbSBhcHAgewogICAgICAgIHpvbmUg \n      YXBwIDY0azsKICAgICAgICBsZWFzdF9jb25uOwogICAgICAgIHNlcnZlciAxMC4wLjEu \n      NDo4MDAwOwogICAgfQoKICAgIHNlcnZlciB7CiAgICAgICAgbGlzdGVuIDgwOwogICAg \n      ICAgIHNlcnZlcl9uYW1lICouZXhhbXBsZS5jb207CgogICAgICAgIGxvY2F0aW9uIC8g \n      ewogICAgICAgICAgICBpbmNsdWRlIC9ldGMvbmdpbngvY29uZi5kL3Byb3h5LmNvbmY7 \n      CiAgICAgICAgICAgIHByb3h5X3Bhc3MgaHR0cDovL2FwcDsKICAgICAgICAgICAgaGVh \n      bHRoX2NoZWNrOwogICAgICAgIH0KICAgICAgICAKICAgIH0KfQ==', \\\n      'virtual-path':'/etc/nginx/nginxprot.conf'}, \\\n      {'content':'cHJveHlfc2V0X2hlYWRlciBIb3N0ICRob3N0Owpwcm94eV9zZXRfaGVhZGVy \n      IFgtUmVhbC1JUCAkcmVtb3RlX2FkZHI7CnByb3h5X3NldF9oZWFkZXIgWC1Qcm94eS1B \n      cHAgYXBwOwpwcm94eV9zZXRfaGVhZGVyIEdpdGh1Yi1SdW4tSWQgMDAwMDAwOwpwcm94 \n      eV9idWZmZXJpbmcgb247CnByb3h5X2J1ZmZlcl9zaXplIDRrOwpwcm94eV9idWZmZXJz \n      IDggOGs7CnByb3h5X3JlYWRfdGltZW91dCA2MHM7', \\\n      'virtual-path':'/etc/nginx/conf.d/proxyprot.conf'}]\"\n```\n\n----------------------------------------\n\nTITLE: Download and add Nginx signing key\nDESCRIPTION: Downloads the NGINX signing key from the official NGINX website and adds it to the system's keyring. This key is used to verify the authenticity of NGINX packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-ubuntu.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nwget -qO - https://cs.nginx.com/static/keys/nginx_signing.key | gpg --dearmor | \\\nsudo tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null\n```\n\n----------------------------------------\n\nTITLE: Setting ha_primary based on hostname in Chef (Ruby)\nDESCRIPTION: This code snippet shows how to set the `ha_primary` attribute in Chef based on the hostname. It checks if the hostname includes 'primary' or 'standby' and sets `ha_primary` to 'true' or 'false' accordingly. It also installs the nginx-ha-keepalived package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_15\n\nLANGUAGE: ruby\nCODE:\n```\norigip = \"#{node[:network][:interfaces][:eth1][:addresses].detect{|k,v| v[:family] == 'inet'}.first}\"\nsearch(:node, \"role:nginx_plus_ha AND enable_ha_mode:#{node.nginx.enable_ha_mode} NOT name:#{node.name}\") do |nodes|\n  nodes[\"network\"][\"interfaces\"][\"eth1\"][\"addresses\"].each_pair do |address,value|\n    ha_pair_ips << address if value.has_key?(\"broadcast\")\n  end\nend\n\nif node['name'].include? \"primary\"\n  ha_primary = \"true\"\nelsif    node['name'].include? \"standby\"\n  ha_primary = \"false\"\nend\npackage 'nginx-ha-keepalived' do\n  action :install\nend\n```\n\n----------------------------------------\n\nTITLE: Configuring NMS Server Certificate Verification\nDESCRIPTION: This snippet shows how to configure the verification of the NMS (NGINX Management Suite) server certificate to validate its authenticity using `ssl_trusted_certificate`, `ssl_verify`, and `ssl_verify_depth` directives. This setup is crucial for secure communication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/usage-tracking/agentless-reporting.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n    #...\n    ssl_trusted_certificate  trusted_ca_cert.crt;\n    ssl_verify               on;\n    ssl_verify_depth         2;\n}\n```\n\n----------------------------------------\n\nTITLE: Disable App Protect for gRPC Reflection in Nginx\nDESCRIPTION: This Nginx configuration snippet disables App Protect for the /grpc.reflection URI. This allows gRPC Server Reflection to function correctly by bypassing App Protect's security policies for that specific location.  It requires a configured grpc_backend upstream to proxy requests to the gRPC server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/grpc-server-reflection.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    location /grpc.reflection {\n        app_protect_enable off;\n        grpc_pass grpc://grpc_backend;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Add License via NGINX Controller REST API\nDESCRIPTION: This snippet describes how to add a license to NGINX Controller using the REST API. It requires sending a PUT request to the `/platform/license` endpoint with the customer Association Token (CAT) or NGINX Controller license as a base64-encoded string in the JSON request body.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/licensing-controller.md#_snippet_0\n\n\n\n----------------------------------------\n\nTITLE: Prometheus Query for Active Connections\nDESCRIPTION: This Prometheus query finds all active connections for the NGINX Plus Ingress Controller. It utilizes the `nginxplus_connections_active` metric and filters by the `job` label, set to `nginx-plus-ingress`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_13\n\nLANGUAGE: promQL\nCODE:\n```\nnginxplus_connections_active{job=\"nginx-plus-ingress\"}\n```\n\n----------------------------------------\n\nTITLE: Setting up Repository Pinning (Shell)\nDESCRIPTION: Configures APT pinning to prioritize packages from the Nginx repository over those provided by the distribution. This prevents conflicts and ensures that the intended Nginx versions are used. The configuration assigns a high priority (900) to packages originating from nginx.org, ensuring they are preferred during installation and upgrades.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-debian.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\necho -e \"Package: *\\nPin: origin nginx.org\\nPin: release o=nginx\\nPin-Priority: 900\\n\" | \\\nsudo tee /etc/apt/preferences.d/99nginx\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration: Referencing SSL/TLS Certificates\nDESCRIPTION: This code snippet demonstrates how to reference SSL/TLS certificate and key file paths within an NGINX configuration file. It assumes the certificate and key files are located in the `/etc/nginx/certs/` directory. This is a basic configuration showing the use of `ssl_certificate` and `ssl_certificate_key` directives within an `http` block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n   server {\n      listen 443 ssl;\n      ssl_certificate /etc/nginx/certs/mycert.cert;\n      ssl_certificate_key /etc/nginx/certs/mycert.key;\n      # ...\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Base64 Encode PKCS12 Certificate (bash)\nDESCRIPTION: This command encodes a PKCS12 certificate file in base64 format. This is a prerequisite for uploading a PKCS12 certificate to NGINX Instance Manager via the web interface or API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/manage-certificates.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ncat <filename>.pkcs12 | base64 > <new-filename>.pkcs12\n```\n\n----------------------------------------\n\nTITLE: Log Egress Driver\nDESCRIPTION: This command streams the logs from the `egress-driver` pod. This is used to verify that traffic is being sent and routed correctly through NGINX Ingress Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\nkubectl logs -f -c egress-driver <EGRESS_DRIVER_POD>\n```\n\n----------------------------------------\n\nTITLE: Saving Docker Images as Tar Archives (Shell)\nDESCRIPTION: Saves the specified Docker images to tar archive files for transfer to an offline environment. It employs the `docker save` command, specifying the output file name and the image name. This process prepares the images for loading into a Docker environment without internet access.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_14\n\nLANGUAGE: Shell\nCODE:\n```\ndocker save -o nginx-app-protect-5.tar nginx-app-protect-5\n\n```\n\nLANGUAGE: Shell\nCODE:\n```\ndocker save -o waf-enforcer.tar private-registry.nginx.com/nap/waf-enforcer:5.4.0\n\n```\n\nLANGUAGE: Shell\nCODE:\n```\ndocker save -o waf-config-mgr.tar private-registry.nginx.com/nap/waf-config-mgr:5.4.0\n```\n\n----------------------------------------\n\nTITLE: Manual Sidecar Injection Example - Bash\nDESCRIPTION: This command provides a specific example of manually injecting the sidecar proxy. It reads the `resource.yaml` file, injects the sidecar, and writes the updated configuration to `resource-injected.yaml`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/inject-sidecar-proxy.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl inject < resource.yaml > resource-injected.yaml\n```\n\n----------------------------------------\n\nTITLE: Security Policy Bundle Response - JSON\nDESCRIPTION: This is an example JSON response received when retrieving a specific security policy bundle. The response includes metadata such as creation and modification timestamps, App Protect WAF version, policy UID, attack signature and threat campaign versions, a unique bundle UID, the base64 encoded content of the bundle, and the compilation status.  The `content` field contains the base64 encoded `.tgz` archive data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_14\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"metadata\": {\n    \"created\": \"2023-10-04T23:19:58.502Z\",\n    \"modified\": \"2023-10-04T23:19:58.502Z\",\n    \"appProtectWAFVersion\": \"4.457.0\",\n    \"policyUID\": \"<policy-uid>\",\n    \"attackSignatureVersionDateTime\": \"2023.08.10\",\n    \"threatCampaignVersionDateTime\": \"2023.08.09\",\n    \"uid\": \"<bundle-uid>\"\n  },\n  \"content\": \"ZXZlbnRzIHt9Cmh0dHAgeyAgCiAgICBzZXJ2ZXIgeyAgCiAgICAgICAgbGlzdGVuIDgwOyAgCiAgICAgICAgc2VydmVyX25hbWUgXzsKCiAgICAgICAgcmV0dXJuIDIwMCAiSGVsbG8iOyAgCiAgICB9ICAKfQ==\",\n  \"compilationStatus\": {\n    \"status\": \"compiled\",\n    \"message\": \"\"\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Example Usage of Metric Selectors\nDESCRIPTION: This is an example showing how to use selectors to refine the metrics data.  It demonstrates the use of 'names', 'excluded_names', and 'filter' parameters for selecting and excluding metrics based on names and conditions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/forwarders/forward-analytics-to-otlp.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\n\"names=nginx.*&excluded_names=nginx.upstream.*&filter=app='myapp'\"\n```\n\n----------------------------------------\n\nTITLE: Obtaining the NGINX App Protect Strict Policy using Docker\nDESCRIPTION: This command retrieves the NginxStrictPolicy.json file from the private-registry.nginx.com/nap/waf-compiler docker image. It mounts the current working directory to the container and uses 'cat' to output the policy file contents. Ensure to replace '1.0.0' with the correct release version of the compiler.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/concept/strict-policy.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\nsudo docker run --rm -v $(pwd):$(pwd) --entrypoint='' private-registry.nginx.com/nap/waf-compiler:1.0.0 cat /etc/app_protect/conf/NginxStrictPolicy.json\n```\n\n----------------------------------------\n\nTITLE: Nginx Static Content Server Configuration\nDESCRIPTION: This configuration sets up Nginx to serve static content from the '/usr/share/nginx/html' directory. It listens on port 8080 for requests to 'localhost' and serves 'index.html' or 'index.htm' files. It also defines an error page for 500, 502, 503, and 504 errors, redirecting to a static '/50x.html' page.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/default-conf-localhost.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 8080;\n    server_name localhost;\n\n\n    location / {\n        root /usr/share/nginx/html;\n        index index.html index.htm;\n    }\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page 500 502 503 504 /50x.html;\n    location = /50x.html {\n        root /usr/share/nginx/html;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisites for NGINX on Amazon Linux using yum\nDESCRIPTION: This command uses the yum package manager to install the yum-utils package, which provides utilities for managing yum repositories and packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_45\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install yum-utils\n```\n\n----------------------------------------\n\nTITLE: Copying NGINX Certificates (Alpine Linux)\nDESCRIPTION: Copies the nginx-repo.key and nginx-repo.crt files to the /etc/apk/ directory on Alpine Linux. This step is essential for setting up the repository for NGINX Agent installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\nsudo cp nginx-repo.key /etc/apk/cert.key\nsudo cp nginx-repo.crt /etc/apk/cert.pem\n```\n\n----------------------------------------\n\nTITLE: Pass Request to Upstream Server in Nginx\nDESCRIPTION: This snippet configures a server block that listens on port 12346 and passes the request to an upstream server group determined by the `$nearest_server` variable.  The `proxy_pass` directive is used to forward the request to the dynamically chosen upstream.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 12346;\n    proxy_pass http://$nearest_server;\n}\n```\n\n----------------------------------------\n\nTITLE: Tagging NGINX Plus Image for Private Registry\nDESCRIPTION: This command tags the NGINX Plus image with a new name and tag for your private registry.  Replace `<my-docker-registry>` with your registry’s path and `<my-version-tag>` with your desired version tag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-plus-and-agent-docker.md#_snippet_5\n\nLANGUAGE: Shell\nCODE:\n```\ndocker tag private-registry.nginx.com/nginx-plus/agent:<version-tag> <my-docker-registry>/nginx-plus/agent:<my-version-tag>\n```\n\n----------------------------------------\n\nTITLE: Verifying NGINX Signing Key Fingerprint on SUSE\nDESCRIPTION: This command displays the fingerprint of the downloaded NGINX signing key, allowing you to verify its authenticity. It uses the gpg command with the --with-fingerprint option to show the key's fingerprint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_34\n\nLANGUAGE: shell\nCODE:\n```\ngpg --with-fingerprint /tmp/nginx_signing.key\n```\n\n----------------------------------------\n\nTITLE: Install NGINX OSS and App Protect WAF\nDESCRIPTION: This snippet installs NGINX OSS and the NGINX App Protect WAF v5 module within a Docker container. It mounts secrets for repository authentication, updates package lists, adds NGINX repositories, installs necessary packages like `apt-transport-https`, `lsb-release`, `ca-certificates`, `wget`, `gnupg2`, and `ubuntu-keyring`, and configures the NGINX and App Protect repositories.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-ubuntu.md#_snippet_0\n\nLANGUAGE: dockerfile\nCODE:\n```\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    apt-get update \\\n    && apt-get install -y \\\n      apt-transport-https \\\n      lsb-release \\\n      ca-certificates \\\n      wget \\\n      gnupg2 \\\n      ubuntu-keyring \\\n    && wget -qO - https://nginx.org/keys/nginx_signing.key | gpg --dearmor | \\\n      tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null \\\n    && gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg \\\n    && printf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n      http://nginx.org/packages/mainline/ubuntu `lsb_release -cs` nginx\\n\" | \\\n      tee /etc/apt/sources.list.d/nginx.list \\\n    && wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key | gpg --dearmor | \\\n      tee /usr/share/keyrings/nginx-static-archive-keyring.gpg >/dev/null \\\n    && gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-static-archive-keyring.gpg \\\n    && printf \"deb [signed-by=/usr/share/keyrings/nginx-static-archive-keyring.gpg] \\\n      https://pkgs.nginx.com/app-protect-x-oss/ubuntu `lsb_release -cs` nginx-plus\\n\" | \\\n      tee /etc/apt/sources.list.d/nginx-app-protect.list \\\n    && wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx \\\n    && apt-get update \\\n    && DEBIAN_FRONTEND=\"noninteractive\" apt-get install -y nginx=1.25.5-1~`lsb_release -cs` app-protect-module-oss \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log \\\n    && apt-get clean \\\n    && rm -rf /var/lib/apt/lists/*\n```\n\n----------------------------------------\n\nTITLE: Example JSON Response with Specified Dimensions\nDESCRIPTION: This JSON response shows the format of metric data when a dimension (e.g., 'environment') is specified in the query.  It includes the aggregation type (aggr), metric name (name), and a series of data points. Each data point includes dimension values, timestamps, and corresponding metric values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_19\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"metrics\":[\n      {\n         \"aggr\": \"SUM\",\n         \"name\":\"http.request.count\",\n         \"series\":[\n            {\n               \"dimensions\":{\n                  \"environment\":\"prod\"\n               },\n               \"timestamps\":[\n                  \"2020-07-01T12:00:00Z\"\n               ],\n               \"values\":[\n                  1000\n               ]\n            },\n            {\n               \"dimensions\":{\n                  \"environment\":\"prod\"\n               },\n               \"timestamps\":[\n                  \"2020-07-01T12:00:00Z\"\n               ],\n               \"values\":[\n                  2000\n               ]\n            }\n         ]\n      }\n   ],\n   \"queryMetadata\":{\n      \"endTime\":\"2020-07-01T12:00:00.970106672Z\"\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Verify redirect with curl for soda with pepsi and query parameters (Shell)\nDESCRIPTION: This `curl` command sends a request to `http://cafe.example.com/soda/pepsi?test=v1` and includes the response headers to verify the redirect. The `--resolve` resolves the hostname to specified IP and port, and `--include` displays the headers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/soda/pepsi\\?test\\=v1 --include\n```\n\n----------------------------------------\n\nTITLE: Install apt prerequisites for Nginx Agent on Ubuntu\nDESCRIPTION: This command installs the required packages for managing repositories and verifying package authenticity on Ubuntu systems, in preparation for installing the Nginx Agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt install curl gnupg2 ca-certificates lsb-release ubuntu-keyring\n```\n\n----------------------------------------\n\nTITLE: Including Status Configuration File in NGINX Configuration\nDESCRIPTION: This snippet shows how to include the downloaded status configuration file in the main NGINX configuration file (nginx.conf). This step enables the live activity monitoring dashboard. It requires the `status.conf` file to be present in the `/etc/nginx/conf.d` directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_30\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block in nginx.conf\ninclude conf.d/status.conf;\n```\n\n----------------------------------------\n\nTITLE: Changing Debug Log Level for NGINX App Protect DoS\nDESCRIPTION: This command allows you to dynamically change the debug log level for NGINX App Protect DoS. It utilizes the `admd` command-line tool and the `-l` flag to set the desired log level. The log level is specified as DEBUG_LEVEL, which can be error, warning, info, or debug.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/types-of-logs.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nadmd -l DEBUG_LEVEL\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Plus Repository (Debian - Shell)\nDESCRIPTION: This command adds the NGINX Plus repository to the system's apt sources list. It uses `printf` and `tee` to write the repository definition to `/etc/apt/sources.list.d/nginx-plus.list`. The `lsb_release -cs` command is used to dynamically determine the Debian release codename.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb https://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-plus.list\n```\n\n----------------------------------------\n\nTITLE: NGINX ConfigMap Configuration YAML\nDESCRIPTION: This ConfigMap defines the NGINX configuration, setting the listen port to 55555. The configuration uses an inline NGINX configuration snippet (`nginx.conf`) to define the server and location blocks. The NGINX configuration is defined within the `.data.nginx.conf` field.  This configures NGINX to listen on the specified port and return a simple response.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_18\n\nLANGUAGE: YAML\nCODE:\n```\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: dest-svc\ndata:\n  nginx.conf: |-\n    events {}\n    http {\n      server {\n        listen 55555;\n        location / {\n          return 200 \"destination service\\n\";\n        }\n      }\n    }\n```\n\n----------------------------------------\n\nTITLE: Create HTTP Environment with NGINX Management Suite API (JSON)\nDESCRIPTION: This JSON payload creates an HTTP-based Environment in NGINX Management Suite. It defines the environment name, assigns the `API-GATEWAY` function, and specifies a proxy cluster with its name, hostname, and runtime. The `proxyClusterName` is set using the `{{instanceGroupName}}` placeholder, and `hostnames` uses `{{environmentHostname}}`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/add-api-gateway.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"{{environmentName}}\",\n    \"functions\": [\n        \"API-GATEWAY\"\n    ],\n    \"proxies\": [\n        {\n            \"proxyClusterName\": \"{{instanceGroupName}}\",\n            \"hostnames\": [\n                \"{{environmentHostname}}\"\n            ],\n            \"runtime\": \"GATEWAY-PROXY\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Example of setting user password with bash script\nDESCRIPTION: Example of using the `basic_passwords.sh` script to set the password for the user `johndoe`.  The script requires the username and the new password enclosed in single quotes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/basic-auth/set-up-basic-authentication.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo bash /etc/nms/scripts/basic_passwords.sh johndoe '<password>'\n```\n\n----------------------------------------\n\nTITLE: Accessing WAF Config Manager Logs with Docker\nDESCRIPTION: This command retrieves logs from the `waf-config-mgr` container using Docker. This container is related to internal components of NGINX App Protect 5.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/logging-overview/logs-overview.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ndocker logs waf-config-mgr\n```\n\n----------------------------------------\n\nTITLE: Loading Nginx App Protect Module\nDESCRIPTION: This Nginx configuration snippet loads the Nginx App Protect WAF v5 module at the main context.  It is necessary to load the module before it can be configured and used. Ensure the path to the module `.so` file is correct.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_18\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n```\n\n----------------------------------------\n\nTITLE: Proxy Configuration JSON with OAuth2 Introspection Policy\nDESCRIPTION: This JSON payload defines the proxy configuration, including the OAuth2 Introspection policy.  It specifies the introspection endpoint, the expected response type, and the claims to be forwarded as headers to the backend. The `forwardedClaimsInProxyHeader` array lists the claims, including nested claims and a non-existent claim to demonstrate error handling.  The `clientAppID` and `clientSecret` are used for authenticating with the introspection endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_48\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"test-proxy\",\n    \"version\": \"v1\",\n    \"proxyConfig\": {\n        \"hostname\": \"data-host\",\n        \"ingress\": {\n            \"basePath\": \"/\",\n            \"basePathVersionAppendRule\": \"NONE\"\n        },\n        \"backends\": [\n            {\n                \"serviceName\": \"backend-echo-svc\",\n                \"serviceTargets\": [\n                    {\n                        \"hostname\": \"192.0.2.4\",\n                        \"listener\": {\n                            \"enableTLS\": false,\n                            \"port\": 10000,\n                            \"transportProtocol\": \"HTTP\"\n                        }\n                    }\n                ]\n            }\n        ],\n        \"policies\": {\n            \"oauth2-introspection\": [\n                {\n                    \"action\": {\n                        \"introspectionEndpoint\": \"http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect\",\n                        \"introspectionResponse\": \"application/json\",\n                        \"forwardedClaimsInProxyHeader\": [\n                            \"username\",\n                            \"exp\",\n                            \"scope\",\n                            \"iss\",\n                            \"client-id\",\n                            \"resource_access.account.roles\",\n                            \"fake-claim\"\n                        ]\n                    },\n                    \"data\": [\n                        {\n                            \"clientAppID\": \"nginx-plus\",\n                            \"clientSecret\": \"<client secret>\"\n                        }\n                    ]\n                }\n            ]\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Download and Add NGINX Signing Key - Ubuntu\nDESCRIPTION: These commands download and add the NGINX signing key to the system's apt keyring. This key is used to verify the authenticity of NGINX packages.  `sudo wget https://cs.nginx.com/static/keys/nginx_signing.key` downloads the signing key. `sudo apt-key add nginx_signing.key` adds the key to the apt keyring, allowing apt to trust packages signed with this key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_32\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget https://cs.nginx.com/static/keys/nginx_signing.key && sudo apt-key add nginx_signing.key\n```\n\n----------------------------------------\n\nTITLE: Enable Dynamic Loading of NDK and Set-Misc Modules\nDESCRIPTION: This snippet demonstrates how to enable the dynamic loading of NDK and Set-Misc modules in the NGINX configuration file (nginx.conf).  The `load_module` directives are placed within the top-level (\"main\") context.  The order of the directives is important; NDK must be loaded before Set-Misc.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/set-misc.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ndk_http_module.so;\nload_module modules/ngx_http_set_misc_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Timeout Settings (Nginx)\nDESCRIPTION: This snippet sets the `keepalive_timeout` and `proxy_read_timeout` to 3 hours each within the 'http' block. This configuration is used to support HTTP long polling by Exchange clients. The timeout values are specified using the 'h' suffix to indicate hours.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_30\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nkeepalive_timeout 3h;\nproxy_read_timeout 3h;\n```\n\n----------------------------------------\n\nTITLE: Active Directory Group Search Filter (Exclusion)\nDESCRIPTION: This snippet demonstrates a group search filter that excludes entities using the exclamation point (!). The example finds all Seattle groups except those with a Fremont OU component. Used during the setup of AD group filtering inside the NGINX Controller configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_9\n\nLANGUAGE: none\nCODE:\n```\n(&(objectClass=group)(&(ou:dn:=Seattle)(!(ou:dn:=Fremont))))\n```\n\n----------------------------------------\n\nTITLE: Security Policy Bundles Response - JSON\nDESCRIPTION: This is an example JSON response received after creating security policy bundles. It includes metadata such as creation and modification timestamps, the `appProtectWAFVersion`, the linked `policyName`, `policyUID`, the versions of attack signatures and threat campaigns, a unique ID for the bundle (`uid`), content information, and compilation status. The response provides information about the created bundles and their current state.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_9\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"items\": [{\n      \"metadata\": {\n        \"created\": \"2023-10-04T23:19:58.502Z\",\n        \"modified\": \"2023-10-04T23:19:58.502Z\",\n        \"appProtectWAFVersion\": \"4.457.0\",\n        \"policyName\": \"default-enforcement\",\n        \"policyUID\": \"<policy-uid>\",\n        \"attackSignatureVersionDateTime\": \"2023.06.20\",\n        \"threatCampaignVersionDateTime\": \"2023.07.18\",\n        \"uid\": \"<bundle-uid>\"\n      },\n      \"content\": \"\",\n      \"compilationStatus\": {\n        \"status\": \"compiling\",\n        \"message\": \"\"\n      }\n    },\n    {\n      \"metadata\": {\n        \"created\": \"2023-10-04T23:19:58.502Z\",\n        \"modified\": \"2023-10-04T23:19:58.502Z\",\n        \"appProtectWAFVersion\": \"4.279.0\",\n        \"policyName\": \"default-enforcement\",\n        \"policyUID\": \"<policy-uid>\",\n        \"attackSignatureVersionDateTime\": \"2023.08.10\",\n        \"threatCampaignVersionDateTime\": \"2023.08.09\",\n        \"uid\": \"<bundle-uid>\"\n      },\n      \"content\": \"\",\n      \"compilationStatus\": {\n        \"status\": \"compiling\",\n        \"message\": \"\"\n      }\n    },\n    {\n      \"metadata\": {\n        \"created\": \"2023-10-04T23:19:58.502Z\",\n        \"modified\": \"2023-10-04T23:19:58.502Z\",\n        \"appProtectWAFVersion\": \"4.457.0\",\n        \"policyName\": \"ignore-xss\",\n        \"policyUID\": \"<policy-uid>\",\n        \"attackSignatureVersionDateTime\": \"2023.08.10\",\n        \"threatCampaignVersionDateTime\": \"2023.08.09\",\n        \"uid\": \"<bundle-uid>\"\n      },\n      \"content\": \"\",\n      \"compilationStatus\": {\n        \"status\": \"compiling\",\n        \"message\": \"\"\n      }\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Service Startup Error\nDESCRIPTION: This text provides an example of an error message that may appear in the logs when the NGINX service fails to start, particularly after an upgrade.  The \"Address already in use\" error indicates a port conflict that must be resolved.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/troubleshooting.md#_snippet_6\n\nLANGUAGE: text\nCODE:\n```\nJob for nginx.service failed because the control process exited with error code.\n```\n\n----------------------------------------\n\nTITLE: Upgrading NGINX Instance Manager on Debian/Ubuntu/Deb\nDESCRIPTION: These shell commands upgrade NGINX Instance Manager on Debian, Ubuntu, and Deb-based systems. They use `apt-get` to install the package, fixing any dependency issues, and then restart the `nms` and `nginx` services.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide.md#_snippet_4\n\nLANGUAGE: Shell Script\nCODE:\n```\nsudo apt-get -y install -f /home/user/nms-instance-manager_<version>_amd64.deb\nsudo systemctl restart nms\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Copying nms-http.conf\nDESCRIPTION: This command copies the `nms-http.conf` file to the `/tmp` directory. This is done to safely modify the configuration file before copying it back to its original location. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo cp /etc/nginx/conf.d/nms-http.conf /tmp/nms-http.conf\n```\n\n----------------------------------------\n\nTITLE: Testing Nginx Configuration Syntax - Shell\nDESCRIPTION: This command tests the Nginx configuration file for syntactic validity. It is recommended to run this command after making changes to the configuration. The output indicates whether the configuration file is syntactically correct and if the test was successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_13\n\nLANGUAGE: none\nCODE:\n```\nroot# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n```\n\n----------------------------------------\n\nTITLE: Retrieve NGINXaaS data plane API endpoint using Azure CLI\nDESCRIPTION: This snippet retrieves the data plane API endpoint for the NGINXaaS deployment using the Azure CLI. It queries the deployment properties and extracts the `dataplaneApiEndpoint` value, storing it in the `dataplaneAPIEndpoint` variable.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/loadbalancer-kubernetes.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ndataplaneAPIEndpoint=$(az nginx deployment show -g \"$nginxGroup\" -n \"$nginxName\" --query properties.dataplaneApiEndpoint -o tsv)\n```\n\n----------------------------------------\n\nTITLE: App Protect Disconnected Log Event JSON\nDESCRIPTION: This JSON object represents an engine disconnection from a worker (socket closed). The 'mode' attribute indicates the failure status. The log level is Error.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/operation-logs.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"event\": \"waf_disconnected\",\n    \"bd_thread_id\": 3,\n    \"worker_pid\": 4928,\n    \"mode\": \"failure\",\n    \"mode_changed\": true\n}\n```\n\n----------------------------------------\n\nTITLE: Send traffic to Headers application - Shell\nDESCRIPTION: Sends a curl request to the headers application, including custom headers in the request. The --resolve option is used to map the hostname to the gateway's IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ncurl -s --resolve echo.example.com:$GW_PORT:$GW_IP http://echo.example.com:$GW_PORT/headers -H \"My-Cool-Header:my-client-value\" -H \"My-Overwrite-Header:dont-see-this\"\n```\n\n----------------------------------------\n\nTITLE: Filter Events by Relative Start Time (curl)\nDESCRIPTION: This example demonstrates filtering events based on a relative start time using the `now` keyword. The example retrieves events that occurred within the last 3 hours. Replace `<NMS_FQDN>` and `<access token>` accordingly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"https://<NMS_FQDN>/api/platform/v1/analytics/events?startTime=now-3h\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Extracting Private Key from PFX OpenSSL\nDESCRIPTION: This snippet extracts the private key from a .pfx file using OpenSSL.  The command prompts for the .pfx file's password and then prompts for a password to encrypt the newly created private key. `-nocerts` option prevents extracting the certificates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl pkcs12 -in exported-certs.pfx -nocerts -out company.com.key.encrypted\n```\n\n----------------------------------------\n\nTITLE: JSON Policy Conversion Output\nDESCRIPTION: This snippet shows the JSON output of a converted policy, including warnings about unsupported elements and metadata such as file size and successful completion. This is an example of what the command `/opt/app_protect/bin/convert-policy -i /path/to/policy.xml -o /path/to/policy.json | jq` might produce.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_14\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"warnings\": [\n        \"Traffic Learning, Policy Building, and staging are unsupported\",\n        \"Element '/plain-text-profiles' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_ASM_COOKIE_HIJACKING' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_BLOCKING_CONDITION' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_BRUTE_FORCE' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_CONVICTION' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_CROSS_ORIGIN_REQUEST' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_CSRF' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_CSRF_EXPIRED' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_DYNAMIC_SESSION' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_FLOW' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_FLOW_DISALLOWED_INPUT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_FLOW_ENTRY_POINT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_FLOW_MANDATORY_PARAMS' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_GEOLOCATION' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_GRPC_FORMAT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_GRPC_METHOD' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_GWT_FORMAT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_GWT_MALFORMED' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_HOSTNAME_MISMATCH' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_LOGIN_URL_BYPASSED' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_LOGIN_URL_EXPIRED' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_MALICIOUS_DEVICE' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_MALICIOUS_IP' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_PARAMETER_DYNAMIC_VALUE' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_PLAINTEXT_FORMAT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_REDIRECT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_SESSION_AWARENESS' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_VIRUS' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_BAD_REQUEST' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_BINARY_MESSAGE_LENGTH' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_BINARY_MESSAGE_NOT_ALLOWED' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_EXTENSION' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_FRAMES_PER_MESSAGE_COUNT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_FRAME_LENGTH' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_FRAME_MASKING' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_FRAMING_PROTOCOL' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_TEXT_MESSAGE_NOT_ALLOWED' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_WEBSOCKET_TEXT_NULL_VALUE' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_XML_SCHEMA' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_XML_SOAP_ATTACHMENT' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_XML_SOAP_METHOD' is unsupported.\",\n        \"/blocking-settings/violations/name value 'VIOL_XML_WEB_SERVICES_SECURITY' is unsupported.\",\n        \"/blocking-settings/http-protocols/description value 'Unparsable request content' is unsupported.\",\n        \"/general/enableEventCorrelation must be 'false' (was 'true').\",\n        \"Element '/websocket-urls' is unsupported.\",\n        \"/protocolIndependent must be 'true' (was 'false').\",\n        \"Element '/redirection-protection' is unsupported.\",\n        \"Element '/gwt-profiles' is unsupported.\",\n        \"/signature-sets/learn value true is unsupported\"\n    ],\n    \"file_size\": 24227,\n    \"completed_successfully\": true,\n    \"filename\": \"/path/to/policy.json\"\n}\n```\n\n----------------------------------------\n\nTITLE: Create Cluster Zone Sync Policy - With DNS Resolver - JSON\nDESCRIPTION: This JSON payload defines a Cluster Zone Sync policy with DNS resolver configuration. It specifies the resolver settings, including IPv6 enablement, validation time, timeout, and server hostname, along with a TCP server listener and the zone sync server details.  This uses DNS to resolve zone sync server names.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/cluster-zone-sync.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"cluster-zone-sync\": [\n    {\n      \"action\": {\n        \"tcpServer\": {\n          \"listeners\": [\n            {\n              \"port\": 12345\n            }\n          ],\n        },\n        \"resolver\": {\n          \"enableIPv6\": false,\n          \"valid\": \"30s\",\n          \"timeout\": \"5s\",\n          \"servers\": [\n            {\n              \"hostname\": \"192.0.2.0\"\n            }\n          ]\n        },\n        \"zoneSyncServers\": [\n          {\n            \"name\": \"nginx-cluster.com\",\n            \"port\": 12345\n          }\n        ]\n      }\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Renaming Nginx Default Configuration File\nDESCRIPTION: This shell command renames the default Nginx configuration file (default.conf) to default.conf.bak. This prevents Nginx from loading the default configuration, ensuring that only the specified configurations for the all-active deployment are used. It requires root privileges and assumes the current directory contains default.conf.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nmv default.conf default.conf.bak\n```\n\n----------------------------------------\n\nTITLE: Remove Previous NGINX Plus Apt Config (Shell)\nDESCRIPTION: These commands remove any previous NGINX Plus repository and apt configuration files from the system. This ensures a clean slate for adding the new repository. It removes the nginx-plus.list file from /etc/apt/sources.list.d and the 90nginx file from /etc/apt/apt.conf.d.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\nsudo rm /etc/apt/sources.list.d/nginx-plus.list\nsudo rm /etc/apt/apt.conf.d/90nginx\n```\n\n----------------------------------------\n\nTITLE: Test Configuration (Path '/some/path')\nDESCRIPTION: This curl command tests the configuration by sending a request to the 'cafe.example.com' hostname with a different specific path. This confirms that the path prefix matching is working as expected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/routing-traffic-to-your-app.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/some/path\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent on RHEL/CentOS/Amazon Linux/Oracle Linux with yum\nDESCRIPTION: This command utilizes the `yum` package manager for installing the NGINX Agent package on RHEL, CentOS, Amazon Linux, and Oracle Linux distributions. It requires `sudo` privileges for installation. The `<agent-version>` placeholder should be replaced with the actual version of the downloaded package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-github.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\nsudo yum localinstall nginx-agent-<agent-version>.rpm\n```\n\n----------------------------------------\n\nTITLE: Example JWT Payload - JSON\nDESCRIPTION: This is an example of the JWT payload received after decoding the access token. It contains various claims like audience, issuer, issued at, expiration, app ID, object ID, tenant ID, and roles.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/microsoft-entra-automation.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"aud\": \"api://f834b49c-a56e-4fde-9caa-641-bOc26fb8a\",\n    \"iss\": \"https://sts.windows.net/d3dfd2f-6a3b-40d1-9beO-b8f327d81c50/\",\n    \"iat\": 1593640000,\n    \"nbf\": 1593640000,\n    \"exp\": 1593643600,\n    \"aio\": \"42+E2ZYHBXei7VKmxxHzn7h1\",\n    \"appid\": \"374cc05e-aaa1-408f-9348-a83d6b4d8ea6\",\n    \"appidacr\": \"1\",\n    \"idp\": \"https://sts.windows.net/d3dfd2f-6a3b-40d1-9beO-b8f327d81c5/\",\n    \"oid\": \"2db3db56-f58b-455a-9ff5-4e1e8b17a171\",\n    \"rh\": \"0.AQABA_893Ttq0UCb4L0QwQ-DJ9QgcILmngha-4Q\",\n    \"roles\":    [\n        \"28a3143e-4217-485e-9fOf-092abc01239b01\"\n    ],\n    \"sub\": \"2db3db56-f58b-455a-9ff5-4e1e8b17a1a71\",\n    \"tid\": \"dd3dfd2f-6a3b-40d1-9bee-bfaqw27d81c5e\",\n    \"uti\": \"EmqiFiTC-kACZqN5vrKd8AQ\" ,\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Numeric Parameter with Range Validation in NGINX App Protect\nDESCRIPTION: This JSON snippet demonstrates how to configure a user-defined parameter named \"number\" that accepts only integer values between 9 and 99 (exclusive).  It enables the VIOL_PARAMETER_DATA_TYPE violation to block non-integer inputs and VIOL_PARAMETER_NUMERIC_VALUE for out-of-range values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/do-nothing-and-user-defined-parameters.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"user_defined_parameters_data_types\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_PARAMETER_NUMERIC_VALUE\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_VALUE_LENGTH\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_STATIC_VALUE\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_DATA_TYPE\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"parameters\": [\n            {\n                \"name\": \"number\",\n                \"type\": \"explicit\",\n                \"parameterLocation\": \"any\",\n                \"mandatory\": false,\n                \"allowEmptyValue\": false,\n                \"allowRepeatedParameterName\": false,\n                \"sensitiveParameter\": false,\n                \"valueType\": \"user-input\",\n                \"dataType\": \"integer\",\n                \"checkMinValue\": true,\n                \"checkMaxValue\": true,\n                \"minimumValue\": 9,\n                \"maximumValue\": 99,\n                \"exclusiveMin\": true,\n                \"exclusiveMax\": true\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: WebSocket Proxy Configuration in Nginx\nDESCRIPTION: This configuration block defines a location for handling WebSocket traffic. It sets up the necessary proxy settings to forward WebSocket connections to a backend Node.js server. The `proxy_set_header` directives ensure that the `Upgrade` and `Connection` headers are correctly passed to the backend.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_19\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /wstunnel/ {\n    proxy_pass http://nodejs;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection $connection_upgrade;\n}\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Plus Package - Alpine\nDESCRIPTION: Installs the NGINX Plus package using the apk package manager. This command is applicable for Alpine Linux distributions. The <apk_package_name> placeholder should be replaced with the actual name of the APK package file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_49\n\nLANGUAGE: shell\nCODE:\n```\napk add <apk_package_name>\n```\n\n----------------------------------------\n\nTITLE: Bash Script to Prepare and Publish NGINX Configuration (Bash)\nDESCRIPTION: This bash script prepares a payload containing NGINX configuration files (`nginx.conf` and `mime.types`) and sends it to NGINX Instance Manager via a `POST` request. It requires environment variables for the NGINX Instance Manager IP address, authorization token, system UID, and NGINX UID. The script encodes the file contents using base64, constructs a JSON payload, and uses `curl` to send the payload to the specified API endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/publish-configs-version-control.md#_snippet_2\n\nLANGUAGE: Bash\nCODE:\n```\n#!/bin/bash\nset  -o  pipefail\n\nDEFAULT_INSTANCE_CONFIG_FILE_PATH=\"./instance/nginx.conf\"\nDEFAULT_MIME_TYPES_FILE_PATH=\"./instance/mime.types\"\n\npublish_config_to_instance() {\n\tlocal ctrl_ip=$1\n\tlocal auth_token=$2\n\tlocal system_uid=$3\n\tlocal nginx_uid=$4\n\n\tif [ -z \"${ctrl_ip}\" ] || [ -z \"${auth_token}\" ] || [ -z \"${system_uid}\" ] || [ -z \"${nginx_uid}\" ]; then\n\t\techo \"Missing required variable\"\n\t\texit 1\n\tfi\n\n\tic_base64=$(base64 < \"${DEFAULT_INSTANCE_CONFIG_FILE_PATH}\" | tr -d '\\n')\n\tmime_base64=$(base64 < \"${DEFAULT_MIME_TYPES_FILE_PATH}\" | tr -d '\\n')\n\tupdate_time=$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")\n\tversion_hash=\"${CI_COMMIT_SHA}\"\n\n\tpayload=$(jq -n --arg versionHash \"${version_hash}\" --arg updateTime \"${update_time}\" --arg config \"${ic_base64}\" --arg mime \"${mime_base64}\" '{\n\t\t\"auxFiles\": { \"files\": [], \"rootDir\": \"/\" },\n\t\t\"configFiles\": {\n\t\t\t\"rootDir\": \"/etc/nginx\",\n\t\t\t\"files\": [\n\t\t\t\t{ \"contents\": $config, \"name\": \"/etc/nginx/nginx.conf\" },\n\t\t\t\t{ \"contents\": $mime, \"name\": \"/etc/nginx/mime.types\" }\n\t\t\t]\n\t\t},\n\t\t\"updateTime\": $updateTime,\n\t\t\"externalId\": $versionHash,\n\t\t\"externalIdType\": \"git\"\n\t}')\n\n\techo \"${payload}\" | curl -k -H 'Content-Type: application/json' -H \"Authorization: Bearer <access token>\" --data-binary @- -X POST \"https://$ctrl_ip/api/platform/v1/systems/$system_uid/instances/$nginx_uid/config\"\n}\n\npublish_config_to_instance \"$@\"\n```\n\n----------------------------------------\n\nTITLE: Updating Trusted Certificates on Debian/Ubuntu\nDESCRIPTION: This command updates the system's trusted certificates on Debian or Ubuntu systems. It requires sudo privileges and scans the /usr/local/share/ca-certificates directory for new certificates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/system-configuration/trust-proxy-ca-certificates.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo update-ca-certificates\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Management Suite platform services\nDESCRIPTION: This command restarts the main NGINX Management Suite platform services, which is essential for applying changes after an upgrade. This ensures the core functionality of the suite is refreshed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nms\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration\nDESCRIPTION: This command reloads the Nginx configuration without downtime. It's necessary to apply any changes made to the nginx.conf file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/proxy-setup/set-up-nginx-proxy-for-nginx-one.md#_snippet_1\n\nLANGUAGE: sh\nCODE:\n```\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Creating Certificate Signing Request (CSR)\nDESCRIPTION: Generates a Certificate Signing Request (CSR) using the private key. The CSR is required when requesting a certificate from a Certificate Authority (CA).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl req -new -sha256 -key ~/example.com.key -out ~/example.com.csr\n```\n\n----------------------------------------\n\nTITLE: Pulling the Latest NGINX Plus Agent Image for Debian/Ubuntu\nDESCRIPTION: This command pulls the latest version of the NGINX Plus image bundled with NGINX Agent specifically built for Debian or Ubuntu. It utilizes the `debian` tag, ensuring compatibility with Debian-based systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-plus-and-agent-docker.md#_snippet_3\n\nLANGUAGE: Shell\nCODE:\n```\nsudo docker pull private-registry.nginx.com/nginx-plus/agent:debian\n```\n\n----------------------------------------\n\nTITLE: Check NGINX Agent Status - Bash\nDESCRIPTION: This command checks if the NGINX Agent is running on the data plane host. It uses `ps aux` to list all running processes and filters the output using `grep` to find any processes containing \"nginx-agent\".\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-plus-advanced-metrics.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nps aux | grep nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Send POST request to tea within HTTPRoute limit\nDESCRIPTION: This snippet sends a POST request to the tea application with a body size between 50 and 75 bytes, confirming that the HTTPRoute-level policy is in effect. The gateway-level policy is 50 bytes, and the route-level is 75.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/tea -X POST --data \"this payload is greater than fifty bytes but less than seventy five\"\n```\n\n----------------------------------------\n\nTITLE: Installing libmaxminddb-dev on Debian and Ubuntu\nDESCRIPTION: Installs the libmaxminddb-dev package using apt-get. This package provides the necessary libraries and headers for working with MaxMind databases.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\napt-get install libmaxminddb-dev\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Agent - Zypper - Shell\nDESCRIPTION: Installs the nginx-agent package using the zypper package manager on SLES systems. This command assumes that the Nginx Agent repository has been properly configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper install nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Agent Service (Bash)\nDESCRIPTION: This command restarts the NGINX Agent service. It's typically used after modifying the agent's configuration file to apply the changes, such as adding tags to an instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/add-tags.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Configure SSL passphrase file in NGINX\nDESCRIPTION: This snippet demonstrates how to specify a file containing the passphrase for the SSL key using the `proxy_ssl_password_file` directive. This is needed if the private key is encrypted with a passphrase.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/securing-upstream-traffic.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /upstream {\n    proxy_pass                https://backend.example.com;\n    proxy_ssl_certificate     /etc/nginx/client.pem;\n    proxy_ssl_certificate_key /etc/nginx/client.key;\n    proxy_ssl_password_file pswd.txt;\n}\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Agent (Deb-based)\nDESCRIPTION: This snippet shows how to upgrade NGINX Agent on Debian, Ubuntu, and other Deb-based systems using apt-get. It first updates the package list and then upgrades the nginx-agent package, forcing the configuration file to be preserved. The -y flag automatically answers yes to any prompts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/upgrade.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get update\nsudo apt-get install -y --only-upgrade nginx-agent -o Dpkg::Options::=\"--force-confold\"\n```\n\n----------------------------------------\n\nTITLE: Build and Run NGINX Agent (Bash)\nDESCRIPTION: These commands build and run the NGINX Agent from source code. `make build` compiles the agent, and `sudo make run` executes the built binary with appropriate permissions.  Building and running the agent are the final steps in the development environment setup.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/contribute/dev-environment-setup.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nmake build\n```\n\nLANGUAGE: bash\nCODE:\n```\nsudo make run\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Signing Key - Shell\nDESCRIPTION: Downloads the Nginx signing key from cs.nginx.com and adds it to the apt keyring, enabling the system to verify the authenticity of Nginx packages. It uses wget, gpg, and tee to accomplish this securely.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nwget -qO - https://cs.nginx.com/static/keys/nginx_signing.key | gpg --dearmor | sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null\n```\n\n----------------------------------------\n\nTITLE: Configuration Load Start Log Event JSON\nDESCRIPTION: This JSON object signifies the start of the App Protect configuration loading process.  It includes the path to the configuration set file. The log level is Notice. This event is generated only on configuration reload.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/operation-logs.md#_snippet_6\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"event\": \"configuration_load_start\",\n    \"configSetFile\": \"/opt/app_protect/share/config_set.json\"\n}\n```\n\n----------------------------------------\n\nTITLE: Install ClickHouse server and client (CentOS, RHEL)\nDESCRIPTION: Installs the ClickHouse server and client packages using yum. This command installs the necessary components for running the ClickHouse database, which NGINX Instance Manager uses for storing metrics, events, alerts, and configuration settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum install -y clickhouse-server clickhouse-client\n```\n\n----------------------------------------\n\nTITLE: Query Top URIs with SeriesLimit and OrderSeriesBy - cURL\nDESCRIPTION: This cURL command retrieves the top 5 URIs with the highest number of bytes received for a specific application (`app1`) and environment (`qa`) using `seriesLimit`, `orderSeriesBy`, and `filter`.  The results are ordered by the MAX value in descending order.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_17\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=SUM(http.request.bytes_rcvd)&startTime=now-1h&filter=app='app1' AND environment='qa'&groupBy=http.uri&seriesLimit=5&orderSeriesBy=MAX DESC\"\n```\n\n----------------------------------------\n\nTITLE: Update and install module (Debian, Ubuntu)\nDESCRIPTION: Updates the package index and installs a specified NGINX module using apt.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_28\n\nLANGUAGE: Shell\nCODE:\n```\napt update\napt install <MODULE-NAME>\n```\n\n----------------------------------------\n\nTITLE: Example User-Defined Signatures Policy JSON\nDESCRIPTION: Demonstrates how to integrate user-defined signatures into an NGINX App Protect WAF policy. It showcases how to specify signature requirements (tags and revisions), enable specific signatures, and configure signature sets with actions like blocking and alarming.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/user-defined-signatures.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"user_defined_single_signature\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"signature-requirements\": [\n            {\n                \"tag\": \"Fruits\",\n                \"minRevisionDatetime\": \"2020-01-20T18:32:02Z\",\n                \"maxRevisionDatetime\": \"2020-01-23T18:32:02Z\"\n            }\n        ],\n        \"signatures\": [\n            {\n                \"name\": \"Apple_medium_acc\",\n                \"tag\": \"Fruits\"\n            }\n        ],\n        \"signature-sets\": [\n            {\n                \"name\": \"Fruit_signature_set\",\n                \"block\": true,\n                \"alarm\": true,\n                \"signatureSet\": {\n                    \"filter\": {\n                        \"tagValue\": \"Fruits\",\n                        \"tagFilter\": \"eq\"\n                    }\n                }\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: JSON Profile for Parameter Parsing in Nginx\nDESCRIPTION: This JSON snippet defines a policy that parses JSON values as parameters and enforces Base64 encoding for a specific field in the JSON registration.  The `handleJsonValuesAsParameters` property is set to `true` in the JSON profile, and the `decodeValueAsBase64` property is set to `required` for the parameter. This configuration ensures that the specified JSON value is treated as a parameter and is expected to be Base64 encoded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/handling-xml-and-json-content.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"json_parse_param_policy\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"caseInsensitive\": false,\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_PARAMETER_VALUE_BASE64\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"parameters\": [\n            {\n                \"name\": \"*\",\n                \"type\": \"wildcard\",\n                \"parameterLocation\": \"any\",\n                \"valueType\": \"user-input\",\n                \"dataType\": \"alpha-numeric\",\n                \"decodeValueAsBase64\": \"required\"\n            }\n        ],\n        \"json-profiles\": [\n            {\n                \"name\": \"Default\",\n                \"defenseAttributes\": {\n                    \"tolerateJSONParsingWarnings\": true\n                },\n                \"handleJsonValuesAsParameters\": true,\n                \"validationFiles\": []\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Cloning NGINX Hello World Module\nDESCRIPTION: This command clones the `nginx-hello-world-module` repository from GitHub using `git`. The module source code will be used as an example dynamic module to be compiled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_35\n\nLANGUAGE: shell\nCODE:\n```\ngit clone https://github.com/perusio/nginx-hello-world-module.git\n```\n\n----------------------------------------\n\nTITLE: Get API Count Response (JSON)\nDESCRIPTION: This snippet demonstrates the JSON response returned from the `/infrastructure/workspaces/infra-ws/environments/demo-env/api-count` endpoint when querying the count of active proxies in an environment.  The response is a simple integer value representing the proxy count.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/enable-metrics.md#_snippet_10\n\nLANGUAGE: json\nCODE:\n```\n1\n```\n\n----------------------------------------\n\nTITLE: Install Protoc (Bash)\nDESCRIPTION: This command installs the Protocol Buffers compiler (`protoc`) using the `apt` package manager on Ubuntu.  `protoc` is used to generate Go code from `.proto` definition files.  It is a necessary tool for building NGINX Agent, which uses Protocol Buffers for data serialization.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/contribute/dev-environment-setup.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt install -y protobuf-compiler\n```\n\n----------------------------------------\n\nTITLE: Create NGINX SSL Directory - Shell\nDESCRIPTION: Creates the /etc/ssl/nginx directory to store the NGINX Plus certificate and key files.  This directory is a prerequisite for configuring the Nginx Agent repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/ssl/nginx\n```\n\n----------------------------------------\n\nTITLE: Adding Session Cookie Configuration via API (JSON)\nDESCRIPTION: This snippet shows how to configure session cookies for an API proxy using a POST request with a JSON payload. It includes settings like cookie name, path, expiration, domain, and security attributes. The configuration is applied through the `backend-config` policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/http-backend-configuration.md#_snippet_9\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"policies\" : {\n      \"backend-config\" : [\n         {\n            \"action\" : {\n               \"sessionCookie\" : {\n                  \"name\"       : \"auth_cookie\",\n                  \"path\"       : \"/path/to/set\",\n                  \"expiresIn\"  : \"1h\",\n                  \"domainName\" : \".example.com\",\n                  \"httpOnly\"   : true,\n                  \"secure\"     : true,\n                  \"sameSite\"   : \"STRICT\"\n               }\n            }\n         }\n      ]\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Start Nginx Service (systemctl)\nDESCRIPTION: This command starts the nginx.service using systemctl.  It's used to restart the Nginx web server if it's found to be stopped, potentially resolving a failed NGINX Controller instance. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-instances.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start nginx.service\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Plus APT Configuration\nDESCRIPTION: Downloads the nginx-plus apt configuration file and saves it to the /etc/apt/apt.conf.d directory. This file likely contains settings specific to the NGINX Plus repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx\n```\n\n----------------------------------------\n\nTITLE: Compile Policy with Global Settings, Source Inclusion and Full Export\nDESCRIPTION: This command compiles a security policy using the NGINX App Protect WAF compiler, incorporating global settings from a JSON file, including the source, and exporting the full policy. It mounts the current directory as a volume and specifies the global settings file, policy file, and output bundle file. The `-rm` flag ensures the container is removed after execution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\ndocker run --rm \\\n -v $(pwd):$(pwd) \\\n waf-compiler-1.0.0:custom \\\n -include-source -full-export -g $(pwd)/global_settings.json -p $(pwd)/policy.json -o $(pwd)/compiled_policy.tgz\n```\n\n----------------------------------------\n\nTITLE: Configuring Hash Session Persistence Nginx\nDESCRIPTION: This snippet configures Hash session persistence for the 'nodejs' upstream group using the client IP address.  The `hash $remote_addr` directive ensures requests from the same client IP address are consistently routed to the same backend server. This is added to the upstream block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_17\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream nodejs {\n    hash $remote_addr;\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: Installing Image-Filter Module on Debian and Ubuntu\nDESCRIPTION: This shell script updates the apt package manager and installs the `nginx-plus-module-image-filter` package. This will install the image filter module for NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/image-filter.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-image-filter\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Instance Manager with Helm\nDESCRIPTION: This command uninstalls the NGINX Instance Manager deployment from the Kubernetes cluster using Helm. It removes the `nms` application and all associated Kubernetes resources, effectively cleaning up the deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nhelm uninstall --namespace nms nms\n```\n\n----------------------------------------\n\nTITLE: Expose Port and Define Stop Signal for Nginx\nDESCRIPTION: This Dockerfile snippet exposes port 80 for Nginx and defines the SIGQUIT signal as the stop signal for the container. It also sets the default command to start Nginx in the foreground.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-amazon.md#_snippet_1\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# Expose port\nEXPOSE 80\n\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Viewing Staged Config with Commit Hash (GET)\nDESCRIPTION: This JSON response shows the structure of a staged configuration retrieved via a GET request to the `/configs/{config_uid}` endpoint, including the associated Git commit hash (`externalId`) and its type (`externalIdType`) if version control is enabled. The response includes details about the configuration files and auxiliary files associated with the staged config.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/stage-configs.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"configName\": \"test-staged\",\n  \"configFiles\": {\n    \"rootDir\": \"/etc/nginx\",\n    \"files\": [\n      {\n        \"contents\": \"base64_encoded_contents\",\n        \"name\": \"/etc/nginx/nginx.conf\"\n      }\n    ]\n  },\n  \"auxFiles\": {\n    \"rootDir\": \"/etc/nginx/aux\",\n    \"files\": []\n  },\n  \"externalId\": \"8acf5aed9d2872b266d2f880cab23a4aa5791d1b\",\n  \"externalIdType\": \"git\"\n}\n```\n\n----------------------------------------\n\nTITLE: Verify Nginx Agent installation on SLES\nDESCRIPTION: This command checks the version of the installed Nginx Agent to verify that the installation was successful on SLES.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_21\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx-agent -v\n```\n\n----------------------------------------\n\nTITLE: Delete NGINX Certificate Example - Azure CLI\nDESCRIPTION: This example demonstrates deleting a specific NGINX certificate named `myCertificate` from the `myDeployment` deployment within the `myResourceGroup` resource group using the Azure CLI.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-azure-cli.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment certificate delete --certificate-name myCertificate \\\n      --deployment-name myDeployment --resource-group myResourceGroup\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTPRoute for Coffee Application (YAML)\nDESCRIPTION: This YAML manifest configures an HTTPRoute for the coffee application.  It defines routing rules that direct traffic to the coffee service when the path prefix `/coffee` is matched on the hostname `cafe.example.com`. The `parentRefs` section links this route to the 'https' listener on a Gateway resource named 'gateway'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/integrating-cert-manager.md#_snippet_6\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: coffee\nspec:\n  parentRefs:\n  - name: gateway\n    sectionName: https\n  hostnames: # Update the hostname to match what is configured in the Gateway resource\n  - \"cafe.example.com\"\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /coffee\n    backendRefs:\n    - name: coffee\n      port: 80\n```\n\n----------------------------------------\n\nTITLE: Run Kubernetes support package script (Bash)\nDESCRIPTION: This snippet executes the `k8s-support-package.sh` script located within the extracted Helm chart. The script collects system and service information and packages it into a tar archive. Refer to the arguments section for available options to customize the script's behavior. The support package is saved in the directory where the script is run.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/support/k8s-support-package.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nbash ./nms/charts/nms-hybrid/support-package/k8s-support-package.sh\n```\n\n----------------------------------------\n\nTITLE: Test API Endpoint with Token - Bash\nDESCRIPTION: This snippet illustrates the POST request used to test the API endpoint with a valid access token in the Authorization header. The token is passed as a Bearer token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_27\n\nLANGUAGE: bash\nCODE:\n```\nPOST https://192.0.2.4/my/test/api\n   HEADERS:\n     Authorization: 'Bearer <JWT_token>'\n```\n\n----------------------------------------\n\nTITLE: Install Cookie-Flag Module on Debian and Ubuntu\nDESCRIPTION: This shell script updates the system and installs the nginx-plus-module-cookie-flag package using apt.  It assumes that the apt package manager is available and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/cookie-flag.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-cookie-flag\n```\n\n----------------------------------------\n\nTITLE: Making a POST Request to the ACM API using curl\nDESCRIPTION: This snippet demonstrates how to make a POST request to the API Connectivity Manager (ACM) API to create a workspace. It requires the `nms-fqdn`, `workspaceName` and access token. The request includes headers for accepting JSON, specifying content type, and providing authorization.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/overview.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ncurl --location --request POST 'https://{{nms-fqdn}}/api/acm/v1/services/workspaces/{{workspaceName}}' \\\n--header 'Accept: application/json' \\\n--header 'Content-Type: application/json' \\\n--header 'Authorization: Bearer <access token>' \\\n--data-raw ''\n```\n\n----------------------------------------\n\nTITLE: Restarting PHP-FPM Service\nDESCRIPTION: This command restarts the PHP-FPM service after making configuration changes. This ensures that the new configuration is loaded and applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nservice php5-fpm restart\n```\n\n----------------------------------------\n\nTITLE: Defining Virtual Servers in Nginx\nDESCRIPTION: This snippet demonstrates the basic structure for defining virtual servers within the http context in Nginx. It shows how to use the `server` directive to create a virtual server block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    server {\n        # Server configuration\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Test NGINX Configuration\nDESCRIPTION: This snippet provides the command to test the NGINX configuration file for syntax errors before reloading. It is essential to ensure that the configuration is valid before applying any changes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/set-misc.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Installing Image-Filter Module on SLES\nDESCRIPTION: This shell script refreshes the zypper package manager and installs the `nginx-plus-module-image-filter` package. This installs the image filter module for NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/image-filter.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-image-filter\n```\n\n----------------------------------------\n\nTITLE: View logs of proxy container (Bash)\nDESCRIPTION: This command tails the logs of the `nginx-mesh-sidecar` container within the specified Pod. It filters the output for the string \"Enabling default egress route\" to confirm if the default egress route is correctly configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nkubectl logs -f <EGRESS_DRIVER_POD> -c nginx-mesh-sidecar | grep \"Enabling default egress route\"\n```\n\n----------------------------------------\n\nTITLE: Configure Forward Proxy in nms.conf (YAML)\nDESCRIPTION: This snippet shows the YAML configuration for setting up a forward proxy in the `/etc/nms/nms.conf` file for NGINX Instance Manager. It includes parameters for enabling the proxy, specifying the host, port, protocol, authentication requirements, and SSL verification settings. The snippet demonstrates how to configure both HTTP and HTTPS proxies, as well as how to configure authentication credentials if the proxy requires them.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-forward-proxy.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nproxy_config:\n    proxy_enable: true\n    proxy_host: <proxy-ip>\n    proxy_port: <proxy-port>\n    proxy_protocol: [http|https]\n    proxy_auth_required: [true|false]\n    proxy_ssl_verify: [true|false]\n```\n\nLANGUAGE: yaml\nCODE:\n```\nproxy_username: \"<username>\"\nproxy_password: \"<password>\"\n```\n\n----------------------------------------\n\nTITLE: Cache Zone Metrics\nDESCRIPTION: Describes various statistics about NGINX Plus cache usage, including bypass, expired, hit, miss, revalidated, size, stale, and updating metrics for both counts and bytes. These metrics collectively monitor the performance and efficiency of the NGINX Plus cache.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_17\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer; counter, bytes\nDescription: Various statistics about NGINX Plus cache usage.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Gateway Fabric (Azure)\nDESCRIPTION: This command deploys NGINX Gateway Fabric with NGINX OSS on Azure, using a specific deployment manifest that includes `nodeSelector` to deploy on Linux nodes. It's necessary for environments with mixed OS node pools. It uses `kubectl apply` to apply the configurations defined in the remote YAML file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/deploy/azure/deploy.yaml\n```\n\n----------------------------------------\n\nTITLE: NGINX Error Log with Incorrect proxyTLSName (SNI Enabled)\nDESCRIPTION: This log snippet shows an example of an error message that appears in the NGINX error logs when `action.proxyTLSName` is configured with an incorrect value. This leads to a 403 Forbidden response from the Authorization Server due to SSL handshake failure with incorrect SNI name, which in turn causes the data plane proxy to return a 403 Forbidden response to the end user.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/introspection.md#_snippet_4\n\nLANGUAGE: log\nCODE:\n```\n2022/12/04 15:27:12 [error] 7477#7477: *50 js: OAuth unexpected response from\nintrospection server (HTTP 403): Forbidden\n```\n\n----------------------------------------\n\nTITLE: Apply Bookinfo Manifest\nDESCRIPTION: Applies the `bookinfo.yaml` manifest file to deploy the Bookinfo example application in the Kubernetes cluster. This creates the necessary services, deployments, and pods for the application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-walkthrough.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f bookinfo.yaml\n```\n\n----------------------------------------\n\nTITLE: Retrieve Events for a Specific Page (curl)\nDESCRIPTION: This example shows how to retrieve events for a specific page using the `page` query parameter. The example retrieves events from the third page. Replace `<NMS_FQDN>` and `<access token>` accordingly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"https://<NMS_FQDN>/api/platform/v1/analytics/events?page=3\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Create TLSRoute for secure-app\nDESCRIPTION: This YAML configuration creates a TLSRoute resource that attaches to the Gateway and routes requests for `app.example.com` to the `secure-app` Service on port 8443. The parentRefs specifies the Gateway the route is associated with, and the backendRefs defines the target service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/tls-passthrough.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1alpha2\nkind: TLSRoute\nmetadata:\n  name: tls-secure-app-route\n  namespace: default\nspec:\n  parentRefs:\n  - name: gateway\n    namespace: default\n  hostnames:\n  - \"app.example.com\"\n  rules:\n  - backendRefs:\n    - name: secure-app\n      port: 8443\nEOF\n```\n\n----------------------------------------\n\nTITLE: Configuring Global NGINX Settings\nDESCRIPTION: This snippet shows the recommended global settings for the main NGINX configuration file.  These settings define the user, worker processes, error logging, process ID file, and event handling. These are core Nginx settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_24\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nworker_processes auto;\nerror_log /var/log/nginx/error.log info;\npid /var/run/nginx.pid;\n\nevents {\n    worker_connections 1024;\n}\n\n# If using the standard configuration scheme, the 'http' and 'stream' blocks are\n# usually placed here and enclose 'include' directives that refer to files in\n# the conf.d directory.\n```\n\n----------------------------------------\n\nTITLE: Get NGINX Controller API Session Status\nDESCRIPTION: This curl command uses the session cookie from `cookie.txt` to get the session status from the NGINX Controller API. Replace `198.51.100.10` with the actual controller IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ncurl -b cookie.txt -c cookie.txt -X GET --url 'https://198.51.100.10/api/v1/platform/login'\n```\n\n----------------------------------------\n\nTITLE: Copy JWT License File to Nginx Directory\nDESCRIPTION: This command copies the downloaded JWT license file to the /etc/nginx/ directory.  It requires root privileges (sudo).  The <downloaded-file-name>.jwt should be replaced with the actual name of the downloaded file. It ensures that Nginx can access the license.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/copy-jwt-to-etc-nginx-dir.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo cp <downloaded-file-name>.jwt /etc/nginx/license.jwt\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX ModSecurity WAF on Alpine\nDESCRIPTION: This snippet shows how to install the NGINX ModSecurity WAF module package on Alpine using the `apk` package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginx-waf.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-modsecurity\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP to HTTPS Redirection\nDESCRIPTION: Configures a virtual server to listen for HTTP traffic on port 80 and redirect all requests to the HTTPS server defined in the previous step. This ensures that all traffic is secured using SSL/TLS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nserver {\n    listen 80;\n    server_name example.com;\n\n    # Redirect all HTTP requests to HTTPS\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install NDK Module on FreeBSD\nDESCRIPTION: This shell command updates the package repository and installs the nginx-plus-module-ndk package on FreeBSD systems. This ensures that the package manager has the latest information before attempting the installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/ndk.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-ndk\n```\n\n----------------------------------------\n\nTITLE: Get Session Status from Nginx Controller API with curl\nDESCRIPTION: This snippet shows how to use a session cookie to authenticate with the NGINX Controller API and retrieve the session status. It sends a GET request to the login endpoint and uses the `-b` flag to include the session cookie from `cookie.txt`. The `-c` flag updates the cookie file with the latest session information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/api/overview.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ncurl -b cookie.txt -c cookie.txt -X GET --url 'https://198.51.100.10/api/v1/platform/login'\n```\n\n----------------------------------------\n\nTITLE: Adding a Server to Upstream Group via API with POST Method (Shell)\nDESCRIPTION: This command adds a new server to the specified upstream group using the POST method via curl. It configures various server parameters such as server address, weight, connection limits, failover settings, and backup/down status.  The request body is in JSON format.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_21\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X POST -d '{ \\\n   \"server\": \"10.0.0.1:8089\", \\\n   \"weight\": 4, \\\n   \"max_conns\": 0, \\\n   \"max_fails\": 0, \\\n   \"fail_timeout\": \"10s\", \\\n   \"slow_start\": \"10s\", \\\n   \"backup\": true, \\\n   \"down\": true \\\n }' -s 'http://192.168.1.23/api/9/http/upstreams/appservers/servers'\n```\n\n----------------------------------------\n\nTITLE: Configuring Explicit gRPC Profile URL Association (JSON)\nDESCRIPTION: This JSON snippet demonstrates how to explicitly associate a gRPC content profile with a custom URL. The `associateUrls` property is set to `false`, disabling automatic URL association. The profile is then associated with the URL `/services/unique/special/*` using the `urlContentProfiles` array. This allows for mapping gRPC services to URLs that are different from the ones implied by the service name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/associating-profiles-urls.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"my-special-grpc-service-policy\",\n        \"grpc-profiles\": [\n            {\n                \"name\": \"special_service_profile\",\n                \"associateUrls\": false,\n                \"defenseAttributes\": {\n                    \"maximumDataLength\": \"any\",\n                    \"allowUnknownFields\": true\n                },\n                \"attackSignaturesCheck\": true,\n                \"idlFiles\": [\n                    {\n                        \"idlFile\": {\n                            \"$ref\": \"file:///grpc_files/special_service.proto\"\n                        },\n                        \"isPrimary\": true\n                    }\n                ]\n            }\n        ],\n        \"urls\": [\n            {\n                \"name\": \"/services/unique/special/*\",\n                \"method\": \"POST\",\n                \"type\": \"wildcard\",\n                \"isAllowed\": true,\n                \"urlContentProfiles\": [\n                    {\n                        \"contentProfile\": {\n                            \"name\": \"special_service_profile\"\n                        },\n                        \"headerName\": \"*\",\n                        \"headerOrder\": \"default\",\n                        \"headerValue\": \"*\",\n                        \"type\": \"grpc\"\n                    }\n                ]\n            },\n            {\n                \"name\": \"*\",\n                \"type\": \"wildcard\",\n                \"method\": \"*\",\n                \"$action\": \"delete\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring keepalived for Active-Active-Passive HA\nDESCRIPTION: This keepalived configuration defines the passive node for an active-active-passive setup. It uses two vrrp_instance blocks to handle two virtual IP addresses. The lower priority (99) ensures that this node remains passive until one of the active nodes fails. The configuration includes a script to check the nginx service status.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived-nodes.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\nvrrp_script chk_nginx_service {\n    script   \"/usr/lib/keepalived/nginx-ha-check\"\n    interval 3\n    weight   50\n}\n\nvrrp_instance VI_1 {\n    interface         eth0\n    state             BACKUP\n    priority          99\n    virtual_router_id 51\n    advert_int        1\n    accept\n    unicast_src_ip    192.168.10.12\n\n    unicast_peer {\n        192.168.10.10\n        192.168.10.11\n    }\n\n    virtual_ipaddress {\n        192.168.10.100\n    }\n\n    track_script {\n        chk_nginx_service\n    }\n\n    notify \"/usr/lib/keepalived/nginx-ha-notify\"\n}\n\nvrrp_instance VI_2 {\n    interface         eth0\n    state             BACKUP\n    priority          99\n    virtual_router_id 61\n    advert_int        1\n    accept\n    unicast_src_ip    192.168.10.12\n\n    unicast_peer {\n        192.168.10.10\n        192.168.10.11\n    }\n\n    virtual_ipaddress {\n        192.168.10.101\n    }\n\n    track_script {\n        chk_nginx_service\n    }\n\n    notify \"/usr/lib/keepalived/nginx-ha-notify\"\n}\n```\n\n----------------------------------------\n\nTITLE: Send POST request exceeding body size limit\nDESCRIPTION: This snippet sends a POST request with a body exceeding the configured `client_max_body_size` to the coffee application. This will demonstrate the enforced limit by NGINX Gateway Fabric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee -X POST --data \"this payload is greater than fifty bytes by four bytes\"\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Plus Dependencies (RPM-Based) - Bash\nDESCRIPTION: Extracts and installs NGINX Plus dependencies from a `tar.gz` archive on RPM-based systems (CentOS, RHEL). It uses `yum localinstall` to install the RPM packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-devportal-offline.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ntar -kzxvf acm-dataplane-dependencies-<linux-distribution>.tar.gz\nsudo yum localinstall *.rpm\n```\n\n----------------------------------------\n\nTITLE: Listing NGINX One Data Plane Keys with curl\nDESCRIPTION: This snippet demonstrates how to list all NGINX One 'data-plane-key' objects in the 'default' namespace using curl with API token authentication. Replace <tenant> with your tenant name and <token-value> with your API token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/api/authentication.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://<tenant>.console.ves.volterra.io/api/nginx/one/namespaces/default/data-plane-keys \\\n-H \"Authorization: APIToken <token-value>\"\n```\n\n----------------------------------------\n\nTITLE: Defining Match Block for Health Checks in Nginx\nDESCRIPTION: This code snippet shows how to define a `match` block within the `http` block to specify custom conditions for health checks. The `match` block is later referenced by the `health_check` directive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-health-check.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n    match server_ok {\n        # tests are here\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Open Source (Amazon Linux 2)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Open Source package from Amazon Linux 2 using both yum and apt-get package managers for different Nginx versions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_50\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum remove app-protect-module-oss\nsudo apt-get remove nginx=1.25.5-1~`lsb_release -cs` app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Example output of NGINX configuration test\nDESCRIPTION: This shell output indicates a successful Nginx configuration test. It shows that the syntax is ok and the configuration file is successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/fips.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Defining a JSON Schema for Person Object (JSON)\nDESCRIPTION: This JSON schema defines the structure and validation rules for a 'Person' object, including properties like 'firstName', 'lastName', and 'age'.  It specifies data types, descriptions, and constraints such as a minimum age of 0.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/handling-xml-and-json-content.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"title\": \"Person\",\n    \"type\": \"object\",\n    \"additionalProperties\": false,\n    \"properties\": {\n        \"firstName\": {\n            \"type\": \"string\",\n            \"description\": \"The person's first name.\"\n        },\n        \"lastName\": {\n            \"type\": \"string\",\n            \"description\": \"The person's last name.\"\n        },\n        \"age\": {\n            \"description\": \"Age in years which must be equal to or greater than zero.\",\n            \"type\": \"integer\",\n            \"minimum\": 0\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Array Field JSON Schema Example\nDESCRIPTION: This JSON schema defines an array field named 'headers' containing objects with 'name' and 'value' properties, both of which are strings. The array allows for a list of headers with name-value pairs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/reference/json-schema-reference.md#_snippet_9\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"headers\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"name\": { \"type\": \"string\" },\n          \"value\": { \"type\": \"string\" }\n        },\n        \"required\": []\n      }\n    }\n  }\n```\n\n----------------------------------------\n\nTITLE: Starting NGINX Controller (Bash)\nDESCRIPTION: This script starts the NGINX Controller service. It uses the `helper.sh` script located in `/opt/nginx-controller/` with the `controller start` command. This is required after backup or restore to bring the controller back online.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-external-config-db.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh controller start\n```\n\n----------------------------------------\n\nTITLE: NGINX meta.json example\nDESCRIPTION: This JSON snippet represents the structure and content of a `meta.json` file required for importing config templates from an archive into NGINX Instance Manager.  It defines metadata about the template, including name, description, author, type (base or augment), and a unique identifier (UID).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/how-to/manage-nginx-configs-with-templates.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"meta_version_num\": 1,\n  \"name\": \"example_template\",\n  \"description\": \"This is an example NGINX template.\",\n  \"author\": \"Your Name\",\n  \"type\": \"base\",  // Could be \"base\" or \"augment\"\n  \"uid\": \"unique-identifier-uuid-goes-here\"\n}\n```\n\n----------------------------------------\n\nTITLE: Onboard NGINX Plus Instance via Shell Command\nDESCRIPTION: This bash command installs the NGINX Agent on a data plane host and configures it to connect to the NGINX Management Suite. The script downloads the installation script using `curl`, executes it with `sh`, passing the cluster name using the `-g` flag.  The `{{nms-fqdn}}` placeholder should be replaced with the actual FQDN or IP address of the NGINX Management Suite management plane host, and `{{clusterName}}` with the name of your API Gateway cluster.  The `--insecure` flag is used with curl, indicating that certificate validation is skipped (usually for testing purposes).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/add-api-gateway.md#_snippet_4\n\nLANGUAGE: Bash\nCODE:\n```\ncurl --insecure https://{{nms-fqdn}}/install/nginx-agent > install.sh && \\\nsudo sh install.sh -g {{clusterName}} && sudo systemctl start nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Configuring Enforcer Cookie Attributes in NGINX App Protect WAF\nDESCRIPTION: This JSON configuration demonstrates how to modify the attributes of the Enforcer Cookies generated by NGINX App Protect WAF. It sets the `httpOnlyAttribute` to `true`, `secureAttribute` to `never`, and `sameSiteAttribute` to `strict`. These settings control the security and accessibility of the Enforcer Cookies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/enforcer-cookie-settings.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"cookie_attrs_configured\",\n        \"template\": { \"name\":\"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"enforcer-settings\": {\n            \"enforcerStateCookies\": {\n                \"httpOnlyAttribute\": true,\n                \"secureAttribute\": \"never\",\n                \"sameSiteAttribute\": \"strict\"\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX on Alpine\nDESCRIPTION: This command installs the NGINX web server package using the apk package manager. It downloads and installs the package along with its dependencies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_43\n\nLANGUAGE: shell\nCODE:\n```\nsudo apk add nginx\n```\n\n----------------------------------------\n\nTITLE: Unzipping nginx-meshctl binary on Linux\nDESCRIPTION: This command extracts the nginx-meshctl binary from the downloaded tar.gz archive. This is a necessary step to access the executable after downloading it.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ntar -xvf nginx-meshctl_<version>_linux_amd64.tar.gz nginx-meshctl\n```\n\n----------------------------------------\n\nTITLE: Configuring Error Log for Debugging to Memory\nDESCRIPTION: This NGINX configuration directive sets the error logging to `debug` and directs the output to a memory buffer of 32MB. This provides a performance-friendly alternative to file-based debug logging.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nerror_log memory:32m debug;\n...\nhttp {\n    ...\n}\n```\n\n----------------------------------------\n\nTITLE: Setting Maximum Client Body Size (Nginx)\nDESCRIPTION: This snippet increases the default file upload size to 2GB within the 'server' block for HTTPS traffic. This is required for Microsoft RPC Over HTTP and is set using the `client_max_body_size` directive with the 'G' suffix to indicate gigabytes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_33\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nclient_max_body_size 2G;\n```\n\n----------------------------------------\n\nTITLE: Configuring SSL Session Timeout\nDESCRIPTION: This snippet demonstrates how to configure the SSL session timeout.  The `ssl_session_timeout` directive specifies the duration for which cached session parameters are retained. Increasing this value can improve performance but requires a larger cache size.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-tcp.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nssl_session_timeout 4h;\n```\n\n----------------------------------------\n\nTITLE: Disabling WAF with JSON Payload in NGINX Controller\nDESCRIPTION: This JSON payload is used in a POST or PUT request to the Components endpoint of the NGINX Controller API to disable the Web Application Firewall (WAF) for a specific component. The `isEnabled` property within the `waf` object is set to `false`, effectively deactivating WAF. This configuration change requires the appropriate permissions to modify component settings in NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/add-app-security-with-waf.md#_snippet_5\n\nLANGUAGE: JSON\nCODE:\n```\n{\n        \"security\": {\n            \"waf\": {\n                \"isEnabled\": false\n            }\n        }\n}\n```\n\n----------------------------------------\n\nTITLE: Test Reverse Proxy\nDESCRIPTION: This command uses curl to test the reverse proxy. It sends an HTTP request to localhost and verifies that the request is correctly proxied to the demo application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_11\n\nLANGUAGE: none\nCODE:\n```\n$ curl -D - http://localhost\nHTTP/1.1 200 OK\nServer: nginx/1.17.10\nDate: Wed, 6 May 2020 08:58:02 GMT\nContent-Type: text/plain\nContent-Length: 27\nConnection: keep-alive\n\nThank you for requesting /\n```\n\n----------------------------------------\n\nTITLE: Install GeoIP Module on Debian and Ubuntu\nDESCRIPTION: This shell command updates the package manager and installs the nginx-plus-module-geoip package using apt. It's specific to Debian and Ubuntu distributions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-geoip\n```\n\n----------------------------------------\n\nTITLE: Configure Nginx Location Block for Devportal Credentials API\nDESCRIPTION: This snippet shows the configuration of a location block in Nginx to handle requests to the /api/v1/devportal/credentials endpoint. It disables authentication for this location and enforces mTLS client verification. The requests are then proxied to the acm-api-service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/infrastructure/enable-create-credentials.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\n# Deployment of resource credentials from the devportal\n# Uncomment this block when using devportal. Authentication is disabled\n# for this location. This location block will mutually\n# verify the client trying to access the credentials API.\nlocation = /api/v1/devportal/credentials {\n        # OIDC authentication (uncomment to disable)\n        #auth_jwt off;\n        auth_basic off;\n        error_page 401 /401_certs.json;\n        if ($ssl_client_verify != SUCCESS) {\n          return 401;\n        }\n        proxy_pass http://acm-api-service/api/acm/v1/devportal/credentials;\n}\n```\n\n----------------------------------------\n\nTITLE: Restore NGINX Controller Config DB from Latest Backup (Bash)\nDESCRIPTION: This command restores the embedded NGINX Controller config database from the most recent automated backup. It utilizes the helper script included with NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-embedded-config-db.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh backup restore\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Gateway Fabric CRDs (Stable)\nDESCRIPTION: This command deploys the NGINX Gateway Fabric Custom Resource Definitions (CRDs) using a stable release manifest from the nginx-gateway-fabric repository. Applying these CRDs is a prerequisite for deploying NGINX Gateway Fabric itself. It utilizes `kubectl apply` to apply the configurations defined in the remote YAML file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/deploy/crds.yaml\n```\n\n----------------------------------------\n\nTITLE: Describe ClientSettingsPolicy\nDESCRIPTION: This snippet describes the created ClientSettingsPolicy using kubectl, allowing verification of its status and configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe clientsettingspolicies.gateway.nginx.org gateway-client-settings\n```\n\n----------------------------------------\n\nTITLE: Run the NGINX Controller update script\nDESCRIPTION: This command executes the NGINX Controller update script in passive mode, which is a step in restoring functionality after a failed upgrade.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/update.sh --passive\n```\n\n----------------------------------------\n\nTITLE: Modify Server Parameter - Shell\nDESCRIPTION: This `curl` command modifies the `down` parameter of the first server (ID `0`) in the `appservers` upstream group using the Nginx Plus API. It sends a PATCH request with a JSON payload to the API endpoint, setting the `down` parameter to `true`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/dynamic-configuration-api.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X PATCH -d '{ \"down\": true }' -s 'http://127.0.0.1/api/9/http/upstreams/appservers/servers/0'\n```\n\n----------------------------------------\n\nTITLE: Install Keycloak Prerequisites\nDESCRIPTION: This shell script updates the apt package list and installs OpenJDK 11 JRE, a necessary prerequisite for running Keycloak.  It ensures that the system has the required Java runtime environment.  Requires root privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_2\n\nLANGUAGE: Shell\nCODE:\n```\nsudo apt-get update\nsudo apt-get -y install openjdk-11-jre\n```\n\n----------------------------------------\n\nTITLE: Add Gateway API Resources with Kubectl\nDESCRIPTION: This command uses `kubectl` to apply Kubernetes API resources defined by the Gateway API, specifically for NGINX Gateway Fabric.  It fetches the standard Gateway API CRDs from the nginx-gateway-fabric GitHub repository using kustomize and then applies them to the cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nkubectl kustomize \"https://github.com/nginx/nginx-gateway-fabric/config/crd/gateway-api/standard?ref=v{{< version-ngf >}}\" | kubectl apply -f -\n```\n\n----------------------------------------\n\nTITLE: Enable CSRF Protection Globally in Block Mode - JSON\nDESCRIPTION: This JSON snippet enables CSRF protection globally in NGINX App Protect WAF, setting the violation to 'Block' mode. This configuration requires both `VIOL_CSRF` and `csrf-protection` to be enabled for CSRF protection to be active. No custom hostnames or URLs are defined in this configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/csrf-protection.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"applicationLanguage\": \"utf-8\",\n        \"name\": \"csrf_default\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_CSRF\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"csrf-protection\": {\n            \"enabled\": true\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx Configuration - Shell\nDESCRIPTION: These commands reload the Nginx configuration, instructing Nginx to start using the new configuration settings without restarting the server. The first option uses the `nginx` command with the `-s reload` option, and the second option uses the `service` command. Both achieve the same result.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_14\n\nLANGUAGE: none\nCODE:\n```\nroot# nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Port Forward Grafana Dashboard\nDESCRIPTION: This command uses `kubectl port-forward` to create a local port forwarding to the Grafana service running in the `nsm-monitoring` namespace. This allows access to the Grafana dashboard through a local port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/observability.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nkubectl -n nsm-monitoring port-forward svc/grafana 3000\n```\n\n----------------------------------------\n\nTITLE: Configure Cert-Manager Upstream Authority in YAML\nDESCRIPTION: This YAML configuration allows SPIRE to use a cert-manager instance running in Kubernetes to request intermediate signing certificates. The namespace and issuer name must be configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/secure-traffic-mtls.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: \"v1\"\nupstreamAuthority: \"cert-manager\"\nconfig:\n  namespace: \"my-cert-namespace\"\n  issuer_name: \"my-spire-issuer-name\"\n```\n\n----------------------------------------\n\nTITLE: Redeploying NGINX Service Mesh using nginx-meshctl\nDESCRIPTION: This snippet provides the commands to redeploy NGINX Service Mesh as a workaround for TLS errors.  The commands first remove the existing deployment using `nginx-meshctl remove` and then redeploy the mesh using `nginx-meshctl deploy`. The snippet shows the exact sequence of commands required to resolve the TLS issue by re-establishing the certificate authority.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.9.0.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl remove\nnginx-meshctl deploy ...\n```\n\n----------------------------------------\n\nTITLE: Traffic Metrics with nginx-meshctl\nDESCRIPTION: This command retrieves traffic metrics for the `egress-driver` deployment. It shows the success rate, latency, and number of requests for traffic between the `egress-driver` and `nginx-ingress` deployments. Requires `nginx-meshctl` to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_15\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl top deploy/egress-driver\n```\n\n----------------------------------------\n\nTITLE: Accept Forward Traffic in Iptables\nDESCRIPTION: This command configures iptables to accept all forwarded traffic. This is necessary because Docker installation on RHEL 8 can reset the FORWARD rules in iptables, potentially blocking traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nsudo iptables -P FORWARD ACCEPT\n```\n\n----------------------------------------\n\nTITLE: Get NGINX Service Mesh config (Bash)\nDESCRIPTION: This command retrieves the current configuration of NGINX Service Mesh.  It's used to verify that the mTLS mode is set to `strict` after deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl config\n```\n\n----------------------------------------\n\nTITLE: Verifying NGINX Agent Installation\nDESCRIPTION: Verifies the successful installation of the NGINX Agent by checking its version. This command confirms that the agent is installed and functioning correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_26\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx-agent -v\n```\n\n----------------------------------------\n\nTITLE: Configuring Nginx as a Mail Proxy Server\nDESCRIPTION: This configuration sets up Nginx as a mail proxy, handling SMTP, POP3, and IMAP protocols. It includes SSL/TLS configuration, authentication methods, and settings like worker processes and proxy pass error messages. The configuration relies on external SSL certificates and keys, and uses an HTTP authentication server at localhost:9000/cgi-bin/nginxauth.cgi for authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\nworker_processes auto;\n\nmail {\n    server_name mail.example.com;\n    auth_http   localhost:9000/cgi-bin/nginxauth.cgi;\n\n    proxy_pass_error_message on;\n\n    ssl                 on;\n    ssl_certificate     /etc/ssl/certs/server.crt;\n    ssl_certificate_key /etc/ssl/certs/server.key;\n    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers         HIGH:!aNULL:!MD5;\n    ssl_session_cache   shared:SSL:10m;\n    ssl_session_timeout 10m;\n\n    server {\n        listen     25;\n        protocol   smtp;\n        smtp_auth  login plain cram-md5;\n    }\n\n    server {\n        listen    110;\n        protocol  pop3;\n        pop3_auth plain apop cram-md5;\n}\n\n     server {\n        listen   143;\n        protocol imap;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Get NGINX App Protect DoS version (Shell)\nDESCRIPTION: This command retrieves the version of NGINX App Protect DoS and saves it to a file named `package_versions.txt`.  This is part of the process of collecting troubleshooting information to send to customer support.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/troubleshooting-guide/how-to-troubleshoot.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\n/usr/bin/admd -v > package_versions.txt\n```\n\n----------------------------------------\n\nTITLE: Update Package Manager on Ubuntu/Debian\nDESCRIPTION: This command updates the package manager's view of the NGINX Plus repository on Ubuntu and Debian systems.  It cleans the apt cache and updates the package lists.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nsudo apt-get clean ; sudo apt-get update\n```\n\n----------------------------------------\n\nTITLE: Add TCP Ports to NGINX Instance Manager SELinux Context\nDESCRIPTION: Adds specified TCP ports to the `nms_port_t` SELinux context, allowing NGINX Instance Manager to use these ports for communication. This is required for using non-default ports. Requires `semanage` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-selinux.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo semanage port -a -t nms_port_t -p tcp 10000\nsudo semanage port -a -t nms_port_t -p tcp 11000\n```\n\n----------------------------------------\n\nTITLE: Generate Kubelet Server Certificate - Bash\nDESCRIPTION: This script generates a new kubelet server certificate. It includes generating a private key, creating a certificate signing request, and signing the request with the Kubernetes CA. It requires openssl to be installed. Important: ensure the script is executed as root, or with sudo, due to permissions on `/var/lib/kubelet/pki` and `/etc/kubernetes/pki`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\n#!/bin/bash\n\nfunction join_by { local IFS=\"$1\"; shift; echo \"$*\"; }\n\nusrmask=$(umask)\n\nmapfile -t altnames < <(awk '/32 host/ { print \"IP:\"f } {f=$2}' /proc/net/fib_trie | sort -u)\n\numask u=rwx,go=\n\nsudo openssl genrsa -out /var/lib/kubelet/pki/server.key 2048\nsudo openssl req -new -key /var/lib/kubelet/pki/server.key \\\n  -subj \"/C=US/ST=Washington/L=Seattle/O=F5, Inc./OU=Controller/CN=kubelet\" \\\n  -out /var/lib/kubelet/pki/server.csr\nsudo bash -c \"openssl x509 -req -in /var/lib/kubelet/pki/server.csr \\\n  -extfile <(printf \\\"subjectAltName=$(join_by , \\\"${altnames[@]}\\\")\\\") \\\n  -CA /etc/kubernetes/pki/ca.crt \\\n  -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial \\\n  -out /var/lib/kubelet/pki/server.pem -days 365 -sha256\"\n\numask \"$usrmask\"\n```\n\n----------------------------------------\n\nTITLE: Configuring String Parameter with Length Validation in NGINX App Protect\nDESCRIPTION: This JSON snippet demonstrates how to configure a user-defined parameter named \"text\" that accepts alphanumeric strings with a length between 4 and 8 characters. It also shows how to override a specific signature (200002835) to avoid false positives for the 'query' parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/do-nothing-and-user-defined-parameters.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"user_defined_parameters_data_types\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_PARAMETER_VALUE_LENGTH\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"parameters\": [\n            {\n                \"name\": \"text\",\n                \"type\": \"explicit\",\n                \"parameterLocation\": \"any\",\n                \"mandatory\": false,\n                \"allowEmptyValue\": false,\n                \"allowRepeatedParameterName\": false,\n                \"sensitiveParameter\": false,\n                \"valueType\": \"user-input\",\n                \"dataType\": \"alpha-numeric\",\n                \"checkMinValueLength\": true,\n                \"checkMaxValueLength\": true,\n                \"minimumLength\": 4,\n                \"maximumLength\": 8\n            },\n            {\n                \"name\": \"query\",\n                \"type\": \"explicit\",\n                \"valueType\": \"user-input\",\n                \"dataType\": \"alpha-numeric\",\n                \"signatureOverrides\": [\n                    {\n                        \"enabled\": false,\n                        \"signatureId\": 200002835\n                    }\n                ]\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create Group Response with SCIM\nDESCRIPTION: This JSON response represents the result of successfully creating a group in NGINX Instance Manager via the SCIM API.  It contains the group's display name, external ID, unique ID, members, metadata (creation and modification timestamps, location, resource type), and schemas. Requires a successful POST request to the `/api/scim/v2/Groups` endpoint with a valid group creation request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/scim-provisioning.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"displayName\": \"Example Group\",\n  \"externalId\": \"7fcb12f4-af71-4f7d-a987-6c1a91cb838a\",\n  \"id\": \"e023964d-8a63-44f8-aa85-51ffa6aaa8f1\",\n  \"members\": [\n    {\n      \"type\": \"User\",\n      \"value\": \"dc898740-4e9c-41a4-912c-1f3a20edf66e\"\n    }\n  ],\n  \"meta\": {\n    \"created\": \"2022-06-17T21:06:46.774Z\",\n    \"lastModified\": \"2022-06-17T21:06:46.774Z\",\n    \"location\": \"/api/scim/v2/Groups/e023964d-8a63-44f8-aa85-51ffa6aaa8f1\",\n    \"resourceType\": \"Group\"\n  },\n  \"schemas\": [\n    \"urn:ietf:params:scim:schemas:core:2.0:Group\"\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Authorization Rules in URLs (JSON)\nDESCRIPTION: This JSON configuration snippet illustrates how to define authorization rules within URL settings for JWT validation in NGINX App Protect WAF. The example demonstrates setting up conditions based on JWT claims, such as checking for specific scopes (e.g., 'pet:read', 'pet:write'), roles (e.g., 'admin', 'inventory-manager'), and email domain (e.g., ending with 'petshop.com'). This configuration allows for fine-grained access control based on claims embedded within the JWT.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_4\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"urls\": [\n        {\n            \"name\": \"/api/v3/shops/items/*\",\n            \"accessProfile\": {\n                \"name\": \"my_jwt\"\n            },\n            \"authorizationRules\": [\n                {\n                    \"condition\": \"claims['scope'].contains('pet:read') and claims['scope'].contains('pet:write')\",\n                    \"name\": \"auth_scope\"\n                },\n                {\n                    \"condition\": \"claims['roles'].contains('admin') or claims['roles'].contains('inventory-manager')\",\n                    \"name\": \"auth_roles\"\n                },\n                {\n                    \"condition\": \"claims['email'].endsWith('petshop.com')\",\n                    \"name\": \"auth_email\"\n                }\n            ]\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Tolerations Configuration\nDESCRIPTION: This YAML snippet demonstrates how to configure tolerations for NGINX Instance Manager deployments in Kubernetes. It shows an example of tolerating 'NoExecute' effects for unreachable or network-unavailable nodes. These tolerations ensure that pods are not immediately evicted from tainted nodes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/helm-config-settings.md#_snippet_4\n\nLANGUAGE: YAML\nCODE:\n```\ntolerations:\n  - key: \"node.kubernetes.io/unreachable\"\n    operator: \"Exists\"\n    effect: \"NoExecute\"\n    tolerationSeconds: 60\n  - key: \"node.kubernetes.io/network-unavailable\"\n    operator: \"Exists\"\n    effect: \"NoExecute\"\n    tolerationSeconds: 60\n```\n\n----------------------------------------\n\nTITLE: Defining Allowed Response Codes - JSON\nDESCRIPTION: This example shows how to configure allowed HTTP response codes in an NGINX App Protect policy. It enables the `VIOL_HTTP_RESPONSE_STATUS` violation to block disallowed response codes and specifies a list of acceptable response codes. Any response code not in this list will be treated as illegal and blocked.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/filetypes-and-responses.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"allowed_response\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_HTTP_RESPONSE_STATUS\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"general\": {\n            \"allowedResponseCodes\": [\n                400,\n                401,\n                403,\n                404,\n                502,\n                499\n            ]\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Update APT Repository Information\nDESCRIPTION: Updates the APT package lists to include the newly added NGINX Plus repository. This ensures that the system is aware of the available NGINX Plus packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update\n```\n\n----------------------------------------\n\nTITLE: Dockerfile for NGINX OSS on Amazon Linux 2023\nDESCRIPTION: This Dockerfile installs NGINX OSS and NGINX App Protect WAF v5 module on Amazon Linux 2023. It configures the necessary repositories, installs the required packages, and sets up logging.  The image exposes port 80 and starts Nginx in daemon off mode.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_0\n\nLANGUAGE: dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Base image\nFROM amazonlinux:2023\n\n# Install NGINX OSS and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    yum -y install wget ca-certificates shadow-utils yum-utils \\\n    && echo \"[nginx-mainline]\" > /etc/yum.repos.d/nginx.repo \\\n    && echo \"name=nginx mainline repo\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"baseurl=http://nginx.org/packages/mainline/amzn/2023/$basearch/\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"gpgcheck=1\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"gpgkey=https://nginx.org/keys/nginx_signing.key\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"module_hotfixes=true\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"priority=9\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"[app-protect-x-oss]\" > /etc/yum.repos.d/app-protect-oss.repo \\\n    && echo \"name=nginx-app-protect repo\" >> /etc/yum.repos.d/app-protect-oss.repo \\\n    && echo \"baseurl=https://pkgs.nginx.com/app-protect-x-oss/amzn/2023/$basearch/\" >> /etc/yum.repos.d/app-protect-oss.repo \\\n    && echo \"sslclientcert=/etc/ssl/nginx/nginx-repo.crt\" >> /etc/yum.repos.d/app-protect-oss.repo \\\n    && echo \"sslclientkey=/etc/ssl/nginx/nginx-repo.key\" >> /etc/yum.repos.d/app-protect-oss.repo \\\n    && echo \"gpgcheck=0\" >> /etc/yum.repos.d/app-protect-oss.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/app-protect-oss.repo \\\n    && yum -y install app-protect-module-oss \\\n    && yum clean all \\\n    && rm -rf /var/cache/yum \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log\n\n# Expose port\nEXPOSE 80\n\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Run Support Package Script with sudo\nDESCRIPTION: This command executes the support-package.sh script with root privileges using sudo.  This allows the script to gather necessary system information for debugging and troubleshooting the NGINX Developer Portal. The script is located in the /etc/nginx-devportal/scripts/ directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/devportal-support-package.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo bash /etc/nginx-devportal/scripts/support-package.sh\n```\n\n----------------------------------------\n\nTITLE: Create Azure Subnet for Private Endpoint - Azure CLI\nDESCRIPTION: Creates a new subnet within a virtual network for the private endpoint. It requires specifying the address prefix for the new subnet.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/private-link-to-upstreams.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\n$ az network vnet subnet create \\\n  --resource-group $DEP_RESOURCE_GROUP \\\n  --vnet-name $DEP_VNET_NAME \\\n  --name subnet-priv-endpoint \\\n  --address-prefix $PRIVATE_ENDPOINT_SUBNET_ADDRESS_SPACE\n```\n\n----------------------------------------\n\nTITLE: JSON Log for 'login_page' Override Rule (JSON)\nDESCRIPTION: This JSON snippet shows the structure of the `overrideRule` block in the `json_log` when the 'login_page' override rule is matched.  It includes the 'name' of the rule and the 'originalPolicyName'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/override-rules-logging-reporting.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    ...\\n    \"overrideRule\": {\n        \"name\": \"login_page\",\n        \"originalPolicyName\": \"override_rule_example\"\n}\n    ...\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Plus (RHEL 8.1+)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Plus package from RHEL 8.1 and later. It uses the `dnf remove` command to remove the `app-protect-module-plus` package. Requires root privileges and the dnf package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_63\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf remove app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Update NGINXaaS Deployment Tags and Diagnostics (Azure CLI)\nDESCRIPTION: This example demonstrates updating an NGINXaaS deployment by adding tags and enabling diagnostics support. It specifies the deployment name, resource group, location, and the tags to be added. The `--enable-diagnostics` flag activates diagnostic logging for the deployment. The specified resource group and deployment must exist for this command to succeed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/create-deployment/deploy-azure-cli.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment update --name myDeployment --resource-group \\\n   myResourceGroup --location eastus2 --tags tag1=\"value1\" \\\n   tag2=\"value2\" --enable-diagnostics\n```\n\n----------------------------------------\n\nTITLE: Add NGINX repository on Alpine\nDESCRIPTION: This command adds the NGINX Plus repository to the /etc/apk/repositories file. It dynamically determines the Alpine version and constructs the repository URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_23\n\nLANGUAGE: Shell\nCODE:\n```\nprintf \"https://pkgs.nginx.com/plus/alpine/v`egrep -o '^[0-9]+\\.[0-9]+' /etc/alpine-release`/main\\n\" \\\n| sudo tee -a /etc/apk/repositories\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Amplify Agent Status (Bash)\nDESCRIPTION: Verifies that the NGINX Amplify Agent is running by listing the processes and filtering for 'amplify-'. It uses `ps` and `grep` commands. The expected output is a line containing `amplify-agent` and its process ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_19\n\nLANGUAGE: bash\nCODE:\n```\nps ax | grep -i 'amplify\\-'\n2552 ?        S      0:00 amplify-agent\n```\n\n----------------------------------------\n\nTITLE: Stop NGINX Agent - Bash\nDESCRIPTION: This command stops the NGINX Agent service. It uses `sudo systemctl stop` to stop the `nginx-agent` service, requiring sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-plus-advanced-metrics.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl stop nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Agent using zypper on SLES\nDESCRIPTION: This command installs the Nginx Agent package using the zypper package manager on SLES systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_20\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper install nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Apply Kubernetes manifest for example applications\nDESCRIPTION: This snippet applies a Kubernetes manifest to create example applications (coffee and tea) using kubectl. It fetches the manifest from a remote GitHub URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/examples/client-settings-policy/app.yaml\n```\n\n----------------------------------------\n\nTITLE: Clean Yum Cache (Shell)\nDESCRIPTION: This command cleans up the package manager cache information using `yum clean all`. This removes any cached package headers and metadata, ensuring that the system retrieves the latest information from the configured repositories.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum clean all\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration\nDESCRIPTION: Command to reload the NGINX Plus configuration to apply the changes made to the CRS rules. This ensures that the revised rule set is active.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_13\n\nLANGUAGE: none\nCODE:\n```\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: gRPC health check based on status code in Nginx\nDESCRIPTION: Configures a health check that expects a specific gRPC error response code. This is used for gRPC services that do not implement the health checking protocol. The `grpc_status` parameter specifies the expected gRPC status code; a response with that code is considered healthy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/grpc-health-check.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    grpc_pass    grpc://grpc_backend;\n    health_check type=grpc grpc_status=12; # 12=unimplemented\n}\n```\n\n----------------------------------------\n\nTITLE: JWKS Example for UI Configuration\nDESCRIPTION: This JSON snippet shows an example JSON Web Key Set (JWKS) configuration for use when setting up an OAuth2 JWT Assertion policy through the API Connectivity Manager user interface.  It provides the keys required to verify JWT signatures. The parameters include the key (k), the key ID (kid) and the key type (kty).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/jwt-assertion.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n        \"keys\": [\n            {\n                \"k\": \"bXlzZWNyZXQ\",\n                \"kid\": \"0001\",\n                \"kty\": \"oct\"\n            }\n        ]\n    }\n```\n\n----------------------------------------\n\nTITLE: Install njs module on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This snippet demonstrates how to install the `nginx-plus-module-njs` package on Amazon Linux 2, CentOS, Oracle Linux, and RHEL using the `yum` package manager. The command updates the package list and then installs the specified module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginscript.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Conditional Logging of SSL Parameters (NGINX)\nDESCRIPTION: This snippet configures a server block to conditionally log SSL parameters based on the uniqueness of the client's IP address and User-Agent. It defines a key-value variable `$seen` and logs only when a client's combination is encountered for the first time.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/logging.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nkeyval $remote_addr:$http_user_agent $seen zone=clients;\n\n   server {\n       listen 443 ssl;\n\n       ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n       ssl_ciphers   HIGH:!aNULL:!MD5;\n\n       if ($seen = \"\") {\n           set $seen  1;\n           set $logme 1;\n       }\n       access_log  /tmp/sslparams.log sslparams if=$logme;\n\n       # ...\n   }\n```\n\n----------------------------------------\n\nTITLE: Configuring Secrets Storage in NGINX Instance Manager\nDESCRIPTION: This YAML snippet configures the secrets storage for NGINX Instance Manager. It defines the storage name, an optional existing persistent volume claim, storage size, and access mode. This configuration is part of the `nms-hybrid.core.persistence.claims` parameter in the Helm chart.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/helm-config-settings.md#_snippet_2\n\nLANGUAGE: YAML\nCODE:\n```\n  - name: secrets\n    existingClaim:\n    size: 128Mi\n    accessMode: ReadWriteOnce\n```\n\n----------------------------------------\n\nTITLE: Initializing Terraform\nDESCRIPTION: This command initializes the Terraform working directory. It downloads the necessary plugins and sets up the Terraform state file. This is the first step required to use Terraform for NGINXaaS deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/create-deployment/deploy-terraform.md#_snippet_0\n\nLANGUAGE: Bash\nCODE:\n```\nterraform init\n```\n\n----------------------------------------\n\nTITLE: Provider URI Example for Microsoft Entra OIDC\nDESCRIPTION: This example shows the format of the Provider URI required when configuring Microsoft Entra authentication via OIDC in NGINX Controller. The URI includes the tenant ID, which is a unique identifier for your Microsoft Entra tenant. Ensure that the tenant ID matches the one created in Azure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\n\"https://login.microsoftonline.com/12345678-90ab-cdef-1234-567890abcdef/v2.0\"\n```\n\n----------------------------------------\n\nTITLE: Configuring Custom Log Format Nginx\nDESCRIPTION: Configures a custom log format within the 'http' block to include the upstream server address ('$upstream_addr') in addition to other standard variables. This provides more detailed information for troubleshooting load-balancing deployments. Additionally, it shows how to specify the access log path and the chosen format.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_31\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nlog_format main '$remote_addr - $remote_user [$time_local]\n                \"$request\" $status $body_bytes_sent \"$http_referer\"\n                \"$http_user_agent\" $upstream_addr';\naccess_log /var/log/nginx/access.log main;\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Plus (Debian 12)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Plus package from Debian 12. It uses the `apt-get remove` command to remove the `app-protect-module-plus` package. Requires root privileges and the apt package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_57\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get remove app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisites (Amazon Linux 2023)\nDESCRIPTION: Installs the necessary prerequisites such as yum-utils, procps-ng, and ca-certificates on Amazon Linux 2023 using the dnf package manager. These packages are required for repository management and certificate handling.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_29\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf install yum-utils procps-ng ca-certificates\n```\n\n----------------------------------------\n\nTITLE: Azure CLI Login\nDESCRIPTION: This command initiates the Azure CLI login process, opening the default browser for authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/entra-id.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\naz login\n```\n\n----------------------------------------\n\nTITLE: Protect Location with OIDC (Nginx)\nDESCRIPTION: This snippet protects the `/` location with Ping Identity OIDC by using the `auth_oidc` directive. It references the `ping` configuration defined in the `oidc_provider` context. It also includes the `proxy_pass` directive to forward requests to the backend application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/ping-identity.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc ping;\n\n     # ...\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: NGINX Agent Configuration - YAML\nDESCRIPTION: This YAML configuration file defines the settings for the NGINX Agent, including monitored directories, enabled extensions for NGINX App Protect, reporting intervals, and buffer sizes for monitoring log entries.  It specifies where the agent should look for configuration files and sets up monitoring for NGINX App Protect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_34\n\nLANGUAGE: yaml\nCODE:\n```\n# List of directories the agent monitors for config files\nconfig_dirs: \"/etc/nginx:/usr/local/etc/nginx:/usr/share/nginx/modules:/etc/nms:/etc/app_protect\"\n\n# Enable necessary NGINX App Protect extensions\nextensions:\n  - nginx-app-protect\n  - nap-monitoring\n\nnginx_app_protect:\n  # Report interval for NGINX App Protect details — how often the agent checks for changes\n  report_interval: 15s\n  # Set to true to publish precompiled policies and log profiles from NGINX Instance Manager\n  precompiled_publication: true\n\nnap_monitoring:\n  # Buffer size for the collector — holds log lines and parsed entries\n  collector_buffer_size: 50000\n  # Buffer size for the processor — processes log lines from the buffer\n  processor_buffer_size: 50000\n  # IP address where the agent listens for syslog messages\n  syslog_ip: \"127.0.0.1\"\n  # Port number for receiving syslog messages\n  syslog_port: 514\n```\n\n----------------------------------------\n\nTITLE: Setting PostgreSQL Environment Variables (Bash)\nDESCRIPTION: This snippet sets environment variables required for connecting to the PostgreSQL database used by NGINX Controller. It uses the 'export' command to define PGHOST, PGPORT, PGUSER, and PGPASSWORD based on the actual credentials of the PostgreSQL database.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-external-config-db.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nexport PGHOST=<postgres host>\nexport PGPORT=5432\nexport PGUSER=<postgres user>\nexport PGPASSWORD=<postgres password>\n```\n\n----------------------------------------\n\nTITLE: Install NGINX RTMP Module on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This shell script updates the system and installs the nginx-plus-module-rtmp package using yum.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/rtmp.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-rtmp\n```\n\n----------------------------------------\n\nTITLE: Downloading and Extracting NGINX Mainline Source Code\nDESCRIPTION: These commands download and extract the source code for the latest NGINX mainline version. This allows for compiling NGINX from source.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_51\n\nLANGUAGE: shell\nCODE:\n```\nwget https://nginx.org/download/nginx-1.27.4.tar.gz\ntar zxf nginx-1.27.4.tar.gz\ncd nginx-1.27.4\n```\n\n----------------------------------------\n\nTITLE: Installing Prometheus Module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This command installs the nginx-plus-module-prometheus package using the dnf package manager.  This is appropriate for systems like Amazon Linux 2023, AlmaLinux, and Rocky Linux. The command requires sudo privileges to install software packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf install nginx-plus-module-prometheus\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisites (Amazon Linux 2)\nDESCRIPTION: Installs the necessary prerequisites such as yum-utils, procps, and ca-certificates on Amazon Linux 2 using the yum package manager. These packages are required for repository management and certificate handling.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_32\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install yum-utils procps ca-certificates\n```\n\n----------------------------------------\n\nTITLE: Install ModSecurity Module on Ubuntu/Debian\nDESCRIPTION: This command uses the apt-get package manager to install the NGINX ModSecurity dynamic module from the NGINX Plus module repository on Ubuntu and Debian systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\nsudo apt-get install nginx-plus-module-modsecurity\n```\n\n----------------------------------------\n\nTITLE: Check Pod Status\nDESCRIPTION: Retrieves the status of the pods in the Kubernetes cluster. The output shows the readiness, status, restarts, and age of each pod. This command verifies that all Bookinfo pods are running and ready.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-walkthrough.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get pods\n\nNAME                              READY   STATUS    RESTARTS   AGE\ndetails-v1-74f858558f-khg8t       2/2     Running   0          25s\nproductpage-v1-8554d58bff-n4r85   2/2     Running   0          24s\nratings-v1-7855f5bcb9-zswkm       2/2     Running   0          25s\nreviews-v1-59fd8b965b-kthtq       2/2     Running   0          24s\nreviews-v2-d6cfdb7d6-h62cb        2/2     Running   0          24s\nreviews-v3-75699b5cfb-9jtvq       2/2     Running   0          24s\n\n```\n\n----------------------------------------\n\nTITLE: Shell: Upload Threat Campaigns via REST API\nDESCRIPTION: This curl command uploads the threat campaigns bundle to NGINX Instance Manager using the REST API. It uses a POST request with the filename and revisionTimestamp as form data. Replace `<access token>` and `{{NIM_FQDN}}` with the actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_6\n\nLANGUAGE: Shell\nCODE:\n```\ncurl -X POST 'https://{{NIM_FQDN}}/api/platform/v1/security/threat-campaigns' \\\n  --header \"Authorization: Bearer <access token>\" \\\n  --form 'revisionTimestamp=\"2022.11.15\"' \\\n  --form 'filename=@\"/threat-campaigns.tgz\"'\n```\n\n----------------------------------------\n\nTITLE: Uninstall Dynamic Module on Amazon Linux 2, CentOS, Oracle Linux, RHEL\nDESCRIPTION: This command uninstalls the specified dynamic module using the yum package manager. It requires sudo privileges and the correct dynamic module name. The command removes the module package from the system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/uninstall.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum remove <dynamic_module_name>\n```\n\n----------------------------------------\n\nTITLE: Including Configuration Files in nginx.conf\nDESCRIPTION: Includes the downloaded configuration files (jboss-basic.conf or jboss-enhanced.conf) in the main nginx.conf file using the `include` directive within the `http` block. This allows for modular configuration management.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    include conf.d/jboss-(basic|enhanced).conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Enable SSL/TLS for Runtime State Sharing Connections\nDESCRIPTION: This code snippet enables SSL/TLS for connections between cluster instances by adding the `zone_sync_ssl` directive along with the `zone_sync` directive within the `stream` block. It includes `ssl_certificate` and `ssl_certificate_key` directives, which can reference Key Vault certificates.  Dependencies: Requires a valid SSL certificate and key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/runtime-state-sharing.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n  resolver 127.0.0.1:49153 valid=20s;\n\n  server {\n    listen 9000 ssl;\n\n    ssl_certificate     /opt/ssl/server.crt;\n    ssl_certificate_key /opt/ssl/server.key;\n\n    zone_sync;\n    zone_sync_server internal.nginxaas.nginx.com:9000 resolve;\n    zone_sync_ssl    on;\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Example JSON Response for Systems API\nDESCRIPTION: This JSON response shows the format of the data returned by the `/api/platform/v1/systems` endpoint. It includes information about the installed NGINX App Protect WAF version, attack signature version, threat campaign version, and status.  This endpoint is used to verify that NGINX App Protect WAF is installed and active.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_12\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"count\": 3,\n  \"items\": [\n    {\n      \"appProtect\": {\n        \"attackSignatureVersion\": \"2022.11.16\",\n        \"status\": \"active\",\n        \"threatCampaignVersion\": \"2022.11.15\",\n        \"version\": \"build-3.954.0\"\n      }\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Translating to a Full JSON Policy with Defaults\nDESCRIPTION: Example command to translate a valid NGINX App Protect WAF JSON policy into a full JSON policy, including elements from the default policy template. The `--full-export` flag enables this behavior.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker run --rm \\\n -v $(pwd):$(pwd) \\\n --entrypoint=/opt/app_protect/bin/convert-policy \\\n waf-compiler-<version-tag>:custom \\\n -i $(pwd)/policy1.json -o $(pwd)/policy1.json --full-export\n```\n\n----------------------------------------\n\nTITLE: Create file with VI editor (Shell)\nDESCRIPTION: This command opens the VI editor to create a new file named logs.txt. This is part of the steps of creating a tarball to send to customer support.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/troubleshooting-guide/how-to-troubleshoot.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nvi logs.txt\n```\n\n----------------------------------------\n\nTITLE: Navigating to NGINX Instance Manager Script Directory (cd)\nDESCRIPTION: This command navigates to the directory containing the backup and restore scripts for NGINX Instance Manager. It is a prerequisite for making the scripts executable and running them. The path assumes a standard NGINX Instance Manager installation location.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ncd /etc/nms/scripts\n```\n\n----------------------------------------\n\nTITLE: Create Instance Group via NGINX Controller REST API (JSON)\nDESCRIPTION: This snippet demonstrates how to create an instance group using the NGINX Controller REST API.  It sends a PUT request to the instance-groups API endpoint with metadata and desired state.  Replace `{{controllerIP}}` with the actual IP address of the NGINX Controller.  This snippet requires the API Management module to be installed in NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-containerized-instances.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"k8s-nginx-deploy\",\n        \"displayName\": \"K8S NGINX+ deployment\",\n        \"description\": \"k8s-nginx-deploy\"\n    },\n    \"desiredState\": {}\n}\n```\n\n----------------------------------------\n\nTITLE: Downloading Single Web Entry Point Configuration - Shell\nDESCRIPTION: These commands download a complete NGINX configuration file for a single web entry point into the `/etc/nginx/conf.d` directory using `curl`. The first command changes the current directory to `/etc/nginx/conf.d`, and the second command downloads the configuration file from the specified URL and saves it as `oracle-single-entry-point.conf`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_9\n\nLANGUAGE: none\nCODE:\n```\nroot# cd /etc/nginx/conf.d\nroot# curl https://www.nginx.com/resource/conf/oracle-single-entry-point.conf > oracle-single-entry-point.conf\n```\n\n----------------------------------------\n\nTITLE: Update Package Repository (Debian, Ubuntu) - Bash\nDESCRIPTION: This command updates the package repository using `apt update` and installs the `nginx-plus-module-metrics` package. This command is suitable for Debian and Ubuntu based systems. It requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-plus-advanced-metrics.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt update\nsudo apt install nginx-plus-module-metrics\n```\n\n----------------------------------------\n\nTITLE: Kubectl Get Services\nDESCRIPTION: Retrieves a list of services within a given Kubernetes namespace. Replace <namespace> with the actual Kubernetes namespace.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-helm.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get svc -n <namespace>\n```\n\n----------------------------------------\n\nTITLE: Verify downloaded Nginx signing key\nDESCRIPTION: Verifies the integrity of the downloaded NGINX signing key. This command checks that the key fingerprint matches the expected value.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-ubuntu.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ngpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg\n```\n\n----------------------------------------\n\nTITLE: Setting KUBECONFIG Environment Variable - Shell\nDESCRIPTION: This command sets the `KUBECONFIG` environment variable to the location of the Kubernetes configuration file. This is necessary if the root user does not have default access to the Kubernetes API.  It depends on knowing the correct path to the Kubernetes configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nKUBECONFIG=/etc/kubernetes/admin.conf\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Service Mesh Release via Helm Repository\nDESCRIPTION: This snippet updates the Helm repository and upgrades the NGINX Service Mesh release named `nsm` in the `nginx-mesh` namespace.  The `--wait` flag ensures the upgrade operation waits until all resources are ready.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade-with-helm.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nhelm repo update\nhelm upgrade nsm nginx-stable/nginx-service-mesh  --namespace nginx-mesh --wait\n```\n\n----------------------------------------\n\nTITLE: Example API response (JSON)\nDESCRIPTION: This JSON snippet shows an example response from the `/protected_objects` API endpoint.  It provides various statistics for each protected object such as attack status, health, request rates, and mitigation details.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/live-activity-monitoring.md#_snippet_7\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"po_1\": {\n        \"attack\": false,\n        \"health\": 0.50,\n        \"rps\": 12,\n        \"mps\": 0,\n        \"requests\": 500123,\n        \"passthrough\": 260023,\n        \"mitigations\": 240100,\n        \"learning\": \"ready\",\n        \"protocol\": \"http1\",\n        \"mode\": \"standard\",\n        \"sig\": true,\n        \"ba\": true,\n        \"auto_tools\": true,\n        \"tls_fp\": true\n    },\n    \"po_http2\": {\n        \"attack\": false,\n        \"health\": 0.50,\n        \"rps\": 20,\n        \"mps\": 0,\n        \"requests\": 500123,\n        \"passthrough\": 260023,\n        \"mitigations\": 240100,\n        \"learning\": \"not_ready\",\n        \"protocol\": \"http2\",\n        \"mode\": \"conservative\",\n        \"sig\": true,\n        \"ba\": true,\n        \"auto_tools\": true,\n        \"tls_fp\": true\n    },\n    \"po_grpc\": {\n        \"attack\": false,\n        \"health\": 0.50,\n        \"rps\": 25,\n        \"mps\": 0,\n        \"requests\": 6000123,\n        \"passthrough\": 2599123,\n        \"mitigations\": 3401000,\n        \"learning\": \"ready\",\n        \"protocol\": \"grpc\",\n        \"mode\": \"standard\",\n        \"sig\": true,\n        \"ba\": true,\n        \"auto_tools\": true,\n        \"tls_fp\": true\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create a Developer Portal Environment (HTTP) - JSON\nDESCRIPTION: This snippet shows the JSON payload for creating a Developer Portal environment using HTTP. It defines the environment name, function as DEVPORTAL, and proxy details including the cluster name, hostnames, and runtime.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/add-devportal.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"{{environmentName}}\",\n    \"functions\": [\n        \"DEVPORTAL\"\n    ],\n    \"proxies\": [\n        {\n            \"proxyClusterName\": \"{{portalInstanceGroupName}}\",\n            \"hostnames\": [\n                \"{{portalClusterHostname}}\"\n            ],\n            \"runtime\": \"PORTAL-PROXY\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Enable WAF with Default Security Strategy (JSON)\nDESCRIPTION: This JSON snippet shows how to enable WAF for a component using the default security strategy in NGINX Controller. It should be included in a PUT or POST request to the Components endpoint. Requires READ access to the `/security/strategies/` API path.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/add-app-security-with-waf.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"security\": {\n        \"waf\": {\n            \"isEnabled\": true\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Setting up Mainline NGINX Alpine Repository\nDESCRIPTION: This shell snippet sets up the Alpine package repository for mainline NGINX packages. It constructs the repository URL by extracting the Alpine version from `/etc/alpine-release` and concatenating it with the base URL and `/main`. The resulting URL is then appended to `/etc/apk/repositories` using `tee` with sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-alpine.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"%s%s%s\\n\" \\\n\"http://nginx.org/packages/mainline/alpine/v\" \\\n`egrep -o '^[0-9]+\\.[0-9]+' /etc/alpine-release` \\\n\"/main\" \\\n| sudo tee -a /etc/apk/repositories\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent (FreeBSD)\nDESCRIPTION: Installs the nginx-agent package on FreeBSD using the pkg package manager. This command installs the NGINX Agent software on the system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_38\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg install nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Hiding Nginx Version in Server Header\nDESCRIPTION: This snippet disables the `server_tokens` directive in the Nginx configuration, which prevents the Nginx version from being included in the Server header of the HTTP response. This can help to improve security by obscuring the Nginx version from potential attackers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-response-headers.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nserver_tokens off\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent on Debian/Ubuntu\nDESCRIPTION: This command uses the `dpkg` package manager to install the NGINX Agent package on Debian and Ubuntu-based systems. It requires `sudo` privileges to install the package system-wide. The `<agent-version>` placeholder should be replaced with the actual version of the downloaded package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-github.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\nsudo dpkg -i nginx-agent-<agent-version>.deb\n```\n\n----------------------------------------\n\nTITLE: Vault Policy Configuration for NGINX Instance Manager\nDESCRIPTION: This Vault policy grants the necessary permissions for NGINX Instance Manager to create, read, update, delete, and list secrets within the 'secret/*' path. This policy is named 'nms_secrets' and is assigned to a Vault token used by NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-vault.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\npath \"secret/*\" {\n  capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"]\n}\n```\n\n----------------------------------------\n\nTITLE: Extracting Certificate from PFX OpenSSL\nDESCRIPTION: This snippet extracts the certificate from a .pfx file using OpenSSL. The command prompts for the .pfx file's password. The `-clcerts` option ensures that client certificates are extracted, and `-nokeys` prevents the extraction of any private keys.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl pkcs12 -in exported-cert.pfx -clcerts -nokeys -out company.com.crt\n```\n\n----------------------------------------\n\nTITLE: Copying and Modifying OpenID Configuration\nDESCRIPTION: This snippet copies the OpenID configuration file to `/tmp` and uses `sed` to replace placeholders with the values of environment variables. This allows for dynamic configuration of the OIDC settings. Requires sudo privileges and the `sed` utility.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo cp /etc/nms/nginx/oidc/openid_configuration.conf /tmp/openid_configuration.conf\nsudo sed -i'.bak' \\\n-e \"s%OIDC_CLIENT_ID%${KEYCLOAK_CLIENT_ID}%\"  \\\n-e \"s%SERVER_FQDN%${NIM_IP}%\"  \\\n-e \"s%OIDC_AUTH_ENDPOINT%${KEYCLOAK_AUTH_ENDPOINT}%\"  \\\n-e \"s%OIDC_TOKEN_ENDPOINT%${KEYCLOAK_TOKEN_ENDPOINT}%\" \\\n-e \"s%OIDC_KEYS_ENDPOINT%${KEYCLOAK_KEYS_ENDPOINT}%\"  \\\n-e \"s%OIDC_CLIENT_SECRET%${KEYCLOAK_CLIENT_SECRET}%\" \\\n-e \"s%OIDC_HMAC_KEY%${HMAC_KEY}%\" \\\n/tmp/openid_configuration.conf\n```\n\n----------------------------------------\n\nTITLE: Displaying Node State using cat (Backup)\nDESCRIPTION: This command displays the current state (MASTER or BACKUP) of the node by reading the contents of the `/var/run/nginx-ha-keepalived.state` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ncentos7-2 $ cat /var/run/nginx-ha-keepalived.state\n```\n\n----------------------------------------\n\nTITLE: Create vSphere Instance Template with NGINX Controller API (JSON)\nDESCRIPTION: This JSON payload defines an Instance Template, which specifies the parameters to use when creating NGINX instances on vSphere using NGINX Controller.  It includes details such as the VM image to use, compute resources, datastore, network configuration, CPU count, and memory allocation.  Replace v_orch_test/nginxplus-template, cluster1, vsanDatastore, and VLAN-1234 with actual values from your vSphere environment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/add-vsphere-instance.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"metadata\": {\n    \"name\": \"my-v-template\"\n  },\n  \"desiredState\": {\n    \"type\": \"VSPHERE_INSTANCE_TEMPLATE\",\n    \"image\": \"v_orch_test/nginxplus-template\",\n    \"computeResource\": \"cluster1\",\n    \"datastore\": [\"vsanDatastore\"],\n    \"network\": [\"VLAN-1234\"],\n    \"numCPUs\": 1,\n    \"memoryMB\": 4096\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Amplify Agent on Ubuntu/Debian\nDESCRIPTION: This command uninstalls the NGINX Amplify Agent from Ubuntu or Debian based systems using the apt-get package manager. The command removes the package and its configuration files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/uninstalling-amplify-agent.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\napt-get remove nginx-amplify-agent\n```\n\n----------------------------------------\n\nTITLE: Get KubeDNS/CoreDNS Service Information (Bash)\nDESCRIPTION: This bash command retrieves service information from the kube-system namespace, which is typically where KubeDNS or CoreDNS is deployed. The output will contain the service name and IP address, which are necessary for configuring DNS service discovery in NGINX Controller.  Requires `kubectl` to be installed and configured to connect to the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-containerized-instances.md#_snippet_5\n\nLANGUAGE: Bash\nCODE:\n```\nkubectl get svc --namespace=kube-system\n```\n\n----------------------------------------\n\nTITLE: Describe HTTPRoute tea with kubectl\nDESCRIPTION: This command retrieves and displays the status of a Kubernetes HTTPRoute resource named 'tea'. The output includes information about parent references, conditions (Accepted, ResolvedRefs), and controller name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe httproute tea\n```\n\n----------------------------------------\n\nTITLE: Configuring GraphQL Violations in NGINX App Protect (JSON)\nDESCRIPTION: This JSON configuration shows how to define a policy named 'graphql_policy' with specific blocking settings for GraphQL violations.  It sets the 'alarm' to true and 'block' to false for `VIOL_GRAPHQL_FORMAT`, `VIOL_GRAPHQL_MALFORMED`, `VIOL_GRAPHQL_INTROSPECTION_QUERY`, and `VIOL_GRAPHQL_ERROR_RESPONSE`. This ensures that the App Protect WAF detects these violations but does not immediately block the requests, contributing instead to the violation rating.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/graphql-violations.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"graphql_policy\",\n    \"template\": {\n        \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"applicationLanguage\": \"utf-8\",\n    \"caseInsensitive\": false,\n    \"enforcementMode\": \"blocking\",\n    \"blocking-settings\": {\n        \"violations\": [\n            {\n                \"name\": \"VIOL_GRAPHQL_FORMAT\",\n                \"alarm\": true,\n                \"block\": false\n            },\n            {\n                \"name\": \"VIOL_GRAPHQL_MALFORMED\",\n                \"alarm\": true,\n                \"block\": false\n            },\n            {\n                \"name\": \"VIOL_GRAPHQL_INTROSPECTION_QUERY\",\n                \"alarm\": true,\n                \"block\": false\n            },\n            {\n                \"name\": \"VIOL_GRAPHQL_ERROR_RESPONSE\",\n                \"alarm\": true,\n                \"block\": false\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Complete NGINX Configuration Example\nDESCRIPTION: This example shows a complete Nginx configuration with the stream module for mTLS, basic HTTP configuration, and App Protect integration. It defines the user, worker processes, modules, logging, events, and the server configurations for both stream and HTTP traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_17\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\n    worker_processes auto;\n    worker_shutdown_timeout 10s; # NGINX gives worker processes 10 seconds to gracefully terminate before it will actively close connections\n    load_module modules/ngx_http_app_protect_module.so;\n    error_log /var/log/nginx/error.log notice;\n\n    events {\n            worker_connections 65536;\n        }\n\n    stream {\n    upstream enforcer {\n        server 127.0.0.1:4431;\n    }\n\n    server {\n        listen 5000;\n        proxy_pass enforcer;\n        proxy_ssl_server_name on;\n        proxy_timeout 60m;\n        proxy_ssl on;\n        proxy_ssl_certificate /etc/ssl/certs/app_protect_client.crt;\n\t    proxy_ssl_certificate_key /etc/ssl/certs/app_protect_client.key;\n\t    proxy_ssl_trusted_certificate /etc/ssl/certs/app_protect_server_ca.crt;\n    }\n\n    http {\n        include /etc/nginx/mime.types;\n        default_type application/octet-stream;\n        sendfile on;\n        keepalive_timeout 65;\n\n        app_protect_enforcer_address 127.0.0.1:5000;\n\n        server {\n            listen 80;\n            server_name localhost;\n            proxy_http_version 1.1;\n\n            app_protect_enable on;\n            app_protect_policy_file app_protect_default_policy;\n            app_protect_security_log_enable on;\n            app_protect_security_log log_all syslog:server=127.0.0.1:514;\n\n            location / {\n                client_max_body_size 0;\n                default_type text/html;\n                # Pass traffic to backend\n                proxy_pass http://127.0.0.1:8080/;\n            }\n        }\n    }\n    \n```\n\n----------------------------------------\n\nTITLE: Install NGINX App Protect WAF module with Dockerfile\nDESCRIPTION: This Dockerfile installs the NGINX App Protect WAF v5 module within a Docker container. It fetches necessary keys, adds the NGINX App Protect repository, and installs the module using apt-get.  It uses secrets for repository authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/build-from-official-nginx-image.md#_snippet_0\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Base image\nFROM nginx:1.25.5-bookworm\n\n# Install NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    apt-get update \\\n    && apt-get install --no-install-recommends --no-install-suggests -y \\\n       apt-transport-https \\\n       lsb-release \\\n       ca-certificates \\\n       wget \\\n       gnupg \\\n    && wget https://cs.nginx.com/static/keys/nginx_signing.key \\\n    && gpg --no-default-keyring --keyring gnupg-ring:/etc/apt/trusted.gpg.d/nginx.gpg \\\n       --import nginx_signing.key \\\n    && chmod 644 /etc/apt/trusted.gpg.d/nginx.gpg \\\n    && printf \"deb https://pkgs.nginx.com/app-protect-x-oss/debian `lsb_release -cs` nginx-plus\\n\" | \\\n       tee /etc/apt/sources.list.d/nginx-app-protect.list \\\n    && wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx \\\n    && apt-get update \\\n    && apt-get install --no-install-recommends --no-install-suggests -y nginx=1.25.5-1~bookworm app-protect-module-oss  \\\n    && apt-get remove --purge --auto-remove -y apt-transport-https lsb-release gnupg wget \\\n    && rm -rf /var/lib/apt/lists/* /etc/apt/sources.list.d/nginx-app-protect.list\n```\n\n----------------------------------------\n\nTITLE: Base Template Configuration with Go Template\nDESCRIPTION: Defines the structure of the NGINX configuration file, using Go's text/template module to dynamically inject content and establish augmentation points for various NGINX contexts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/tutorials/round-robin-reverse-proxy.md#_snippet_0\n\nLANGUAGE: go\nCODE:\n```\n{{/*\n    A simple base template that provides augment injection points for\n    the main context, the http context, upstreams, servers, and locations.\n*/}}\n{{ $input := .}}\n{{ $baseData := .Data.V1}}\n\n{{/* Inject augments targeting the main context here */}}\n{{ $input.ExecTemplateAugments \"main\" }}\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    {{/* Inject augments targeting the http context here */}}\n    {{ $input.ExecTemplateAugments \"http\" }}\n    {{ range $upstreamIndex, $upstream := $baseData.http.upstreams }}\n          upstream {{$upstream.templateInput.nameInConfig}} {\n              {{$upstreamTemplateInput := $upstream.templateInput}}\n              {{range $serverIndex, $upstreamServer := $upstreamTemplateInput.servers}}\n                  {{$port := \"\"}}\n                  {{if $upstreamServer.port}}\n                      {{$port = (printf \":%0.f\" $upstreamServer.port)}}\n                  {{end}}\n                  server {{$upstreamServer.address}}{{$port}};\n              {{end}}\n\n              {{/* Inject augments targeting this $upstream here */}}\n              {{ $input.ExecTemplateAugments \"http-upstream\" $upstream }}\n          }\n    {{end}}\n\n    {{ range $serverIndex, $server := $baseData.http.servers}}\n        server {\n            server_name {{$server.templateInput.serverNameInConfig}};\n            {{ range $locationIndex, $location := $server.locations}}\n                location {{$location.templateInput.locationMatchExpression}} {\n                  {{/* Inject augments targeting this $location here */}}\n                  {{ $input.ExecTemplateAugments \"location\" $location $server }}\n                }\n            {{end}}\n\n            {{/* Inject augments targeting this $server here */}}\n            {{ $input.ExecTemplateAugments \"http-server\" $server }}\n        }\n    {{end}}\n}\n\n```\n\n----------------------------------------\n\nTITLE: Configuring X-Client-Original-IP header in Nginx\nDESCRIPTION: This snippet adds the X-Client-Original-IP header to the response, indicating the client's original IP address. The $realip_remote_addr variable represents the client's IP address, typically obtained from the realip module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-response-headers.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nadd_header X-Client-Original-IP $realip_remote_addr [always]\n```\n\n----------------------------------------\n\nTITLE: Configure Rate Limiting with Burst (YAML)\nDESCRIPTION: This YAML configuration defines a RateLimit resource with a burst setting for traffic from a specific source deployment. It allows a burst of 10 requests to get through to the `dest-svc` only if the requests are from `bursty-src`. All other requests will be limited according to a default rate limit policy if present.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/smi-traffic-policies.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi.nginx.com/v1alpha2\nkind: RateLimit\nmetadata:\n  name: dest-svc-bursty\n  namespace: default\nspec:\n  destination:\n    kind: Service\n    name: dest-svc\n    namespace: default\n  sources:\n    kind: Deployment\n    name: bursty-src\n    namespace: default\n  name: 10rs\n  rate: 10r/s\n  burst: 10\n```\n\n----------------------------------------\n\nTITLE: Edit NGINX Agent Configuration (Bash)\nDESCRIPTION: Opens the NGINX Agent configuration file using the vim editor with sudo privileges, allowing modification of the agent's settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configure-nginx-agent-features.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo vim /etc/nginx-agent/nginx-agent.conf\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Developer Portal (Deb-Based) - Bash\nDESCRIPTION: Installs the NGINX Developer Portal and UI packages on Debian-based systems (Ubuntu) using `apt-get`. The `-f` option is used to fix broken dependencies if necessary.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-devportal-offline.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get -y install -f /home/user/nginx-devportal_<version>_amd64.deb\nsudo apt-get -y install -f /home/user/nginx-devportal-ui_<version>_amd64.deb\n```\n\n----------------------------------------\n\nTITLE: Restart Pods After Injection Configuration - Bash\nDESCRIPTION: This command restarts Kubernetes Pods to apply changes to sidecar injection configurations. The `<resource type>` and `<resource name>` placeholders should be replaced with the actual resource type (e.g., deployment) and name (e.g., frontend).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/inject-sidecar-proxy.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nkubectl rollout restart <resource type>/<resource name>\n```\n\n----------------------------------------\n\nTITLE: Enforcing Secure Connection for NGINX Agent Installation using curl\nDESCRIPTION: This code snippet enforces a secure connection during the installation of the NGINX Agent using curl by setting the `--skip-verify` flag to false.  It downloads, makes executable, and runs install.sh\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/agent/installation/install-agent-api.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://<NIM_FQDN>/install/nginx-agent -o install.sh\nchmod u+x install.sh\nsudo ./install.sh --skip-verify false\n```\n\n----------------------------------------\n\nTITLE: Create coffee application deployment and service\nDESCRIPTION: Creates a basic 'coffee' application deployment and service in Kubernetes. The deployment uses the 'nginxdemos/nginx-hello:plain-text' image, and the service exposes the application on port 80.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_10\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: coffee\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: coffee\n  template:\n    metadata:\n      labels:\n        app: coffee\n    spec:\n      containers:\n      - name: coffee\n        image: nginxdemos/nginx-hello:plain-text\n        ports:\n        - containerPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: coffee\nspec:\n  ports:\n  - port: 80\n    targetPort: 8080\n    protocol: TCP\n    name: http\n  selector:\n    app: coffee\nEOF\n```\n\n----------------------------------------\n\nTITLE: Configuring Enforcer Address (Nginx)\nDESCRIPTION: Configures the address of the App Protect Enforcer in the Nginx configuration. It uses the `app_protect_enforcer_address` directive within the `http` context. This setting specifies the hostname and port that Nginx will use to communicate with the Enforcer.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_17\n\nLANGUAGE: Nginx\nCODE:\n```\napp_protect_enforcer_address waf-enforcer:50000;\n```\n\n----------------------------------------\n\nTITLE: Enable REST Interface - YAML\nDESCRIPTION: This YAML configuration snippet configures the NGINX Agent to expose its REST interface. It specifies the host, port, and TLS parameters.  Setting a secure port and configuring TLS is recommended to prevent information leaks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/getting-started.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\napi:\n  # Set API address to allow remote management\n  host: 127.0.0.1\n  # Set this value to a secure port number to prevent information leaks\n  port: 8038\n  # REST TLS parameters\n  cert: \"<TLS-CERTIFICATE>.crt\"\n  key: \"<PRIVATE-KEY>.key\"\n```\n\n----------------------------------------\n\nTITLE: Grouping Nginx Metrics by Dimension\nDESCRIPTION: This code snippet demonstrates how to group Nginx metrics by a specified dimension using the `groupBy` parameter. It groups the `nginx.http.request.count` metric by `nginx_id` for the last 12 hours.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/metrics?names=SUM(nginx.http.request.count)&groupBy=nginx_id&startTime=now-12h\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Harden Security using Fail-Closed in NGINX\nDESCRIPTION: This snippet demonstrates how to set NGINX App Protect to 'fail-closed' by adding HTTP Snippets to the Gateway. It configures the `app_protect_failure_mode_action`, `app_protect_compressed_requests_action`, and `app_protect_request_buffer_overflow_action` directives to `drop`. This will cause the application to drop traffic when certain conditions are met, providing increased security.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/concepts/extend-app-security-snippets.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"gateway-name\"\n    },\n    \"desiredState\": {\n        \"configSnippets\": {\n            \"httpSnippet\": {\n                \"directives\": [\n                    {\n                        \"directive\": \"app_protect_failure_mode_action\",\n                        \"args\": [\"drop\"]\n                    },\n                    {\n                        \"directive\": \"app_protect_compressed_requests_action\",\n                        \"args\": [\"drop\"]\n                    },\n                    {\n                        \"directive\": \"app_protect_request_buffer_overflow_action\",\n                        \"args\": [\"drop\"]\n                    }\n                ]\n            }\n        },\n        \"ingress\": {\n            \"uris\": {\n                \"http://example.com:8000\": {}\n            },\n            \"placement\":  {\n                \"instanceRefs\": [\n                    {\n                        \"ref\": \"/infrastructure/locations/unspecified/instances/<instance-name>\"\n                    }\n                ]\n            }\n        }\n    }\n}\n\n```\n\n----------------------------------------\n\nTITLE: Setting SELinux Context for Nginx License\nDESCRIPTION: This command sets the SELinux security context for the Nginx Plus license file. It is necessary when running a Linux distribution with SELinux enabled to ensure that the Nginx process can access the license file. The command uses `chcon` to change the file's security context to `httpd_config_t`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/licensing-and-reporting/apply-jwt.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nchcon -t httpd_config_t /etc/nginx/license.jwt\n```\n\n----------------------------------------\n\nTITLE: Configuring gRPC Response Page in Policy (JSON)\nDESCRIPTION: This JSON snippet configures a custom gRPC response page within a security policy. It sets the `grpcStatusCode` to `INVALID_ARGUMENT` and defines a custom `grpcStatusMessage` including the request ID. The `responsePageType` is set to `grpc`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/grpc-response-pages.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"my-special-grpc-service-policy\",\n        \"response-pages\": [\n            {\n                \"responsePageType\": \"grpc\",\n                \"grpcStatusCode\": \"INVALID_ARGUMENT\",\n                \"grpcStatusMessage\": \"Operation does not comply with the service requirements. Please contact your administrator with the following number: <%TS.request.ID()%>\n\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install NDK Module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This shell command updates the package manager and installs the nginx-plus-module-ndk package on Amazon Linux 2023, AlmaLinux, and Rocky Linux distributions. It updates the package list and then proceeds with the installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/ndk.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-ndk\n```\n\n----------------------------------------\n\nTITLE: Send Traffic with Backend TLS (Shell)\nDESCRIPTION: This `curl` command sends an HTTP request to the `secure-app.example.com` service through the Kubernetes Gateway. The `--resolve` option is used to map the hostname to the Gateway's IP address and port. This verifies that TLS termination is configured correctly and traffic can be sent securely.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/securing-backend-traffic.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve secure-app.example.com:$GW_PORT:$GW_IP http://secure-app.example.com:$GW_PORT/\n```\n\n----------------------------------------\n\nTITLE: Enabling SSL/TLS for Mail Proxy\nDESCRIPTION: This configuration snippet shows how to enable SSL/TLS for the mail proxy using the `ssl` directive. It can be specified within the `mail` context to enable SSL/TLS for all mail proxy servers.  Alternatively, you can enable STLS and STARTTLS with the `starttls` directive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nssl on;\n```\n\n----------------------------------------\n\nTITLE: Install Headers-More Module on FreeBSD\nDESCRIPTION: This shell script updates the package repositories and installs the `nginx-plus-module-headers-more` package using pkg. It is specific to FreeBSD operating system. It assumes that the user has sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/headers-more.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-headers-more\n```\n\n----------------------------------------\n\nTITLE: Creating directories for NGINX App Protect WAF services\nDESCRIPTION: This snippet creates the necessary directories for NGINX App Protect WAF v5 services: /opt/app_protect/config and /opt/app_protect/bd_config. These directories are used for storing configuration and big data files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_37\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /opt/app_protect/config /opt/app_protect/bd_config\n```\n\n----------------------------------------\n\nTITLE: Install XSLT Module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This shell command updates the package manager and installs the `nginx-plus-module-xslt` package on Amazon Linux 2023, AlmaLinux, and Rocky Linux systems. It uses `dnf` as the package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/xslt.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-xslt\n```\n\n----------------------------------------\n\nTITLE: Enabling Tcp_nodelay in Nginx\nDESCRIPTION: This snippet demonstrates enabling the `tcp_nodelay` directive for keepalive connections, which disables Nagle's algorithm and allows data to be sent immediately regardless of the packet size.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /mp3  {\n    tcp_nodelay       on;\n    keepalive_timeout 65;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Stop Keepalived Service\nDESCRIPTION: This command stops the keepalived service. This is done after verifying its functionality before the NGINX Controller Agent takes over configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/ha-data-plane.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl stop keepalived\n```\n\n----------------------------------------\n\nTITLE: Defining a named match block in Nginx stream\nDESCRIPTION: This code snippet demonstrates how to define a `match` block within the `stream` context in Nginx configuration. The `match` block is named `tcp_test` and will contain the tests that are run as part of the health check.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    match tcp_test {\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install NGINX App Protect WAF v5 Package using DNF\nDESCRIPTION: This command uses the DNF package manager to install the `app-protect-module-plus` package. The `sudo` command is used to execute the command with administrative privileges. This installs the NGINX App Protect WAF v5 module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-centos.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\nsudo dnf install app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Traffic Splitting with HTTPRouteGroup Matches in SMI - YAML\nDESCRIPTION: This example shows how to configure traffic splitting based on HTTPRouteGroup matches using the SMI TrafficSplit and HTTPRouteGroup specifications. It allows splitting traffic based on the path, HTTP methods, and headers of a request, enabling A/B testing or canary deployments. The code defines a TrafficSplit resource named 'target' that distributes traffic to different service versions based on matches defined in 'target-route-group'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/smi-traffic-policies.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: split.smi-spec.io/v1alpha3\nkind: TrafficSplit\nmetadata:\n  name: target\nspec:\n  service: target-svc\n  backends:\n  - service: target-v1\n    weight: 0\n  - service: target-v2\n    weight: 1\n  - service: target-v3\n    weight: 0\n  matches:\n  - kind: HTTPRouteGroup\n    name: target-route-group\n---\napiVersion: specs.smi-spec.io/v1alpha3\nkind: HTTPRouteGroup\nmetadata:\n  name: target-route-group\n  namespace: default\nspec:\n  matches:\n  - name: metrics\n    pathRegex: \"/metrics\"\n    methods:\n    - GET\n  - name: test-header\n    headers:\n      x-test: \"^true$\"\n```\n\n----------------------------------------\n\nTITLE: Including HTTP and Stream Config Files in nginx.conf\nDESCRIPTION: This snippet demonstrates how to include separate configuration files for HTTP and TCP (stream) traffic within the main nginx.conf file.  This promotes modularity and easier management of different NGINX functions. The `include` directive is part of the core Nginx module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_19\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    include conf.d/exchange-http.conf;\n}\n\nstream {\n    include conf.d/exchange-stream.conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Renaming Configuration File in Shell\nDESCRIPTION: Renames the default NGINX configuration file to create a backup. This prevents NGINX from using the default configuration and allows for a clean configuration using a custom file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/setting-up-nginx-demo-environment.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nmv default.conf default.conf.bak\n```\n\n----------------------------------------\n\nTITLE: Expected output of NGINX configuration test command\nDESCRIPTION: This snippet shows the expected output after testing the nginx configuration file with the \"nginx -t\" command.  This output indicates that the configuration file syntax is correct and the configuration file loading is successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/set-misc.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Apply Gateway Resources with Kubectl\nDESCRIPTION: This command applies the gateway resources defined in the gateway.yaml file to the Kubernetes cluster, creating a Gateway resource. This configures the entrypoint for traffic to the example application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f gateway.yaml\n```\n\n----------------------------------------\n\nTITLE: Terraform Apply Failure with \"Failed\" Resources\nDESCRIPTION: This snippet demonstrates a Terraform error that occurs when creating an Nginx Deployment in Azure. The error indicates a validation issue (e.g., CapacityOutOfRange) that's caught late in the creation process, leaving behind \"Failed\" resources.  The suggested workaround involves manually deleting the failed resource via the Azure portal.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/known-issues.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\n$ terraform apply\n<output omitted for brevity>\n│ Error: creating Nginx Deployment (Subscription: \"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n│ Resource Group Name: \"XXXXXXXX\"\n│ Nginx Deployment Name: \"XXXXXXXX\"): polling after DeploymentsCreateOrUpdate: polling failed: the Azure API returned the following\n│ error:\n│\n│ Status: \"Failed\"\n│ Code: \"NginxSaaSError\"\n│ Message: \"{\\\"Content\\\":\\\"{\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"CapacityOutOfRange\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"The deployment's capacity must\n│ be between 10 and 500 inclusive for marketplace plan standard. For more information about setting capacity see\n│ https://docs.nginx.com/nginxaas/azure/quickstart/scaling/.\\\\\\\"}}\\\\n\\\",\\\"StatusCode\\\":400}\"\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTPS Virtual Server with IP - Nginx\nDESCRIPTION: This Nginx configuration defines a virtual server that listens for HTTPS requests on a specific IP address (10.210.15.20) and port 443.  The `ssl` parameter indicates that it is an HTTPS server. This example shows restricting listening to a specific IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_18\n\nLANGUAGE: nginx\nCODE:\n```\nlisten 10.210.15.20:443 ssl;\n```\n\n----------------------------------------\n\nTITLE: Installing Encrypted Session module on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This shell script updates the package manager and installs the `nginx-plus-module-encrypted-session` package using yum.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/encrypted-session.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-encrypted-session\n```\n\n----------------------------------------\n\nTITLE: Create Network Security Perimeter - Azure CLI\nDESCRIPTION: This snippet creates a network security perimeter using the Azure CLI. It requires setting the `NSP_NAME` and `NSP_RESOURCE_GROUP` environment variables before execution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\naz network perimeter create --name $NSP_NAME --resource-group $NSP_RESOURCE_GROUP\n```\n\n----------------------------------------\n\nTITLE: Capturing VRRP Packets with tcpdump (Shell)\nDESCRIPTION: This command captures VRRP packets on the eth0 interface. It is useful for debugging VRRP communication issues between nodes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\ntcpdump -vvv -ni eth0 proto vrrp\n```\n\n----------------------------------------\n\nTITLE: Updating App Protect WAF (RedHat/CentOS)\nDESCRIPTION: These commands are used to update the App Protect WAF solution on RedHat or CentOS based systems. It stops the Nginx service, installs the app-protect package using yum, and then starts the Nginx service. Requires `sudo`, `service`, `yum`, and `systemctl`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nsudo service nginx stop\nsudo yum install app-protect\nsudo systemctl start nginx\n```\n\n----------------------------------------\n\nTITLE: Manual Injection with Port Ignoring - Bash\nDESCRIPTION: This command manually injects the sidecar proxy while specifying ports to ignore for incoming and outgoing traffic. The `--ignore-incoming-ports` and `--ignore-outgoing-ports` flags are used with comma-separated lists of port numbers.  Placeholders `port1`, `port2`, etc. must be replaced with actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/inject-sidecar-proxy.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl inject --ignore-incoming-ports \"port1,port2,...,portN\", --ignore-outgoing-ports \"port1,port2,...,portN\" < resource.yaml > resource-injected.yaml\n```\n\n----------------------------------------\n\nTITLE: Create Placeholder License File (Bash)\nDESCRIPTION: This command creates a placeholder file at the default license path. This is required before upgrading to R33 if you plan to use a custom license path.  This ensures the upgrade process doesn't encounter errors due to missing files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/licensing-and-reporting/custom-paths-jwt.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ntouch /etc/nginx/license.jwt\n```\n\n----------------------------------------\n\nTITLE: Making the Unprivileged Installation Script Executable\nDESCRIPTION: This command makes the `ngxunprivinst.sh` script executable using `chmod +x`. This allows the script to be executed as a program.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_42\n\nLANGUAGE: shell\nCODE:\n```\nchmod +x ngxunprivinst.sh\n```\n\n----------------------------------------\n\nTITLE: Update CA Certificates (Debian/Ubuntu - Shell)\nDESCRIPTION: This command updates the system's trusted CA certificates on Debian/Ubuntu systems. It scans `/usr/local/share/ca-certificates/` and updates the `ca-certificates.crt` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-forward-proxy.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo update-ca-certificates\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Controller - Bash\nDESCRIPTION: This command uninstalls NGINX Controller from a node. It's used when removing a node from the cluster or before re-adding a previously deleted node. It ensures a clean slate for re-installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/resilient-cluster-aws.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/uninstall.sh\n```\n\n----------------------------------------\n\nTITLE: Applying Bursty Client Configuration using Kubectl\nDESCRIPTION: This command applies the bursty-client.yaml file to create a bursty client deployment and configmap within the Kubernetes cluster. This setup is used to simulate a client that sends requests in bursts to test rate limiting configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_17\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f bursty-client.yaml\n```\n\n----------------------------------------\n\nTITLE: Running Nginx Open Source Container (Shell)\nDESCRIPTION: This snippet demonstrates how to launch an Nginx Open Source instance in a Docker container. It maps port 80 on the host to port 80 in the container and runs the container in detached mode.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\ndocker run --name mynginx1 -p 80:80 -d nginx\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Agent on Data Plane Host\nDESCRIPTION: This shell script installs the NGINX Agent on the data plane host, creates a new Instance Group called `test-ig`, and adds the host to it.  It downloads the installation script from the NGINX Management Suite host, executes it, and starts the NGINX Agent service. Requires network access to the NGINX Management Suite host.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\ncurl --insecure https://192.0.2.2/install/nginx-agent > install.sh \\\n&& sudo sh install.sh -g test-ig \\\n&& sudo systemctl start nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Configure Backend Workload Group URI (JSON)\nDESCRIPTION: This snippet configures the backend workload group URI using the Kubernetes service name. It shows how to specify the URI for a Kubernetes service, including the service name, namespace, and cluster domain suffix. It also demonstrates how to configure DNS service discovery, including the DNS server IP, TTL, and timeout.  It requires a running Kubernetes cluster with CoreDNS or KubeDNS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-containerized-instances.md#_snippet_3\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"workloadGroups\": {\n        \"serverGrp12345\": {\n            \"uris\": {\n                \"http://my-k8s-service:8080\": {}\n            }\n        }\n    }\n\n    }\n```\n\n----------------------------------------\n\nTITLE: Stop Nginx Controller Agent\nDESCRIPTION: This command stops the Nginx Controller Agent service on the Nginx Plus system. It uses the `service` command to manage the agent's lifecycle, specifically stopping the service. Requires the controller-agent service to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-controller.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nservice controller-agent stop\n```\n\n----------------------------------------\n\nTITLE: AWS IAM User Roles Configuration\nDESCRIPTION: This JSON snippet defines the necessary EC2 instance and tag roles for an AWS IAM user to allow NGINX Controller to deploy and manage NGINX instances on AWS.  It should be configured within the AWS IAM console.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/add-aws-instance.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"ec2:*Instance*\": \"\",\n  \"ec2:*Tags*\": \"\"\n}\n```\n\n----------------------------------------\n\nTITLE: Starting and Checking Keepalived Service (bash)\nDESCRIPTION: This snippet starts the `keepalived` service and checks its status. This is done after maintenance to bring the node back online and ensure proper failover functionality.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/ha-data-plane.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start keepalived\nsudo systemctl status keepalived\n```\n\n----------------------------------------\n\nTITLE: Referenced File Content (file-types.txt) JSON\nDESCRIPTION: This JSON defines the content of the file referenced in the previous policy configuration. It specifies allowed and disallowed file types, along with associated configurations like post data length and URL length.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-references.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n[\n    {\n        \"name\": \"*\",\n        \"type\": \"wildcard\",\n        \"allowed\": true,\n        \"checkPostDataLength\": false,\n        \"postDataLength\": 4096,\n        \"checkRequestLength\": false,\n        \"requestLength\": 8192,\n        \"checkUrlLength\": true,\n        \"urlLength\": 2048,\n        \"checkQueryStringLength\": true,\n        \"queryStringLength\": 2048,\n        \"responseCheck\": false\n    },\n    {\n        \"name\": \"pat\",\n        \"allowed\": false\n    },\n    {\n        \"name\": \"mat\",\n        \"allowed\": false\n    }\n]\n```\n\n----------------------------------------\n\nTITLE: Docker Login to NGINX Private Registry\nDESCRIPTION: Logs into the NGINX private registry using a JSON Web Token (JWT) for authentication. This command is a prerequisite for pulling NGINX Docker images from the private registry and requires replacing `YOUR_JWT_HERE` with the actual JWT obtained from MyF5.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/nginx-configs/manage-config-sync-groups.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker login private-registry.nginx.com --username=YOUR_JWT_HERE --password=none\n```\n\n----------------------------------------\n\nTITLE: Traffic Statistics After Access Control\nDESCRIPTION: This command shows the traffic statistics after access controls have been applied. The disallowed driver now has a 0% success rate, indicating that its traffic is being blocked.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl top\nDeployment         Incoming Success  Outgoing Success  NumRequests\ndriver-allowed                       100.00%           15\ndriver-disallowed                    0.00%             15\ndest-svc           100.00%                             30\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent (Amazon Linux 2023)\nDESCRIPTION: Installs the nginx-agent package on Amazon Linux 2023 using the dnf package manager. This command installs the NGINX Agent software on the system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_31\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf install nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Traffic Statistics\nDESCRIPTION: This command uses nginx-meshctl to display traffic statistics, showing the success rate and number of requests between deployments.  This is used to verify traffic flow after each configuration change.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl top\nDeployment         Incoming Success  Outgoing Success  NumRequests\ndriver-allowed                       100.00%           15\ndest-svc           100.00%                             15\n```\n\n----------------------------------------\n\nTITLE: Configure IAM Role for NGINX Controller on AWS\nDESCRIPTION: This JSON snippet defines an IAM role for NGINX Controller when installed on AWS EC2 instances, allowing the use of EBS volumes for analytics and/or config databases. It grants permissions for automatic creation of Elastic Load Balancers (ELBs) and requires EC2 instances to be tagged with `kubernetes.io/cluster/NGINX-CONTROLLER : owned` for successful ELB creation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/resilient-cluster-aws.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"autoscaling:DescribeAutoScalingGroups\",\n        \"autoscaling:DescribeLaunchConfigurations\",\n        \"autoscaling:DescribeTags\",\n        \"ec2:DescribeInstances\",\n        \"ec2:DescribeRegions\",\n        \"ec2:DescribeRouteTables\",\n        \"ec2:DescribeSecurityGroups\",\n        \"ec2:DescribeSubnets\",\n        \"ec2:DescribeVolumes\",\n        \"ec2:CreateSecurityGroup\",\n        \"ec2:CreateTags\",\n        \"ec2:CreateVolume\",\n        \"ec2:ModifyInstanceAttribute\",\n        \"ec2:ModifyVolume\",\n        \"ec2:AttachVolume\",\n        \"ec2:AuthorizeSecurityGroupIngress\",\n        \"ec2:CreateRoute\",\n        \"ec2:DeleteRoute\",\n        \"ec2:DeleteSecurityGroup\",\n        \"ec2:DeleteVolume\",\n        \"ec2:DetachVolume\",\n        \"ec2:RevokeSecurityGroupIngress\",\n        \"ec2:DescribeVpcs\",\n        \"elasticloadbalancing:AddTags\",\n        \"elasticloadbalancing:AttachLoadBalancerToSubnets\",\n        \"elasticloadbalancing:ApplySecurityGroupsToLoadBalancer\",\n        \"elasticloadbalancing:CreateLoadBalancer\",\n        \"elasticloadbalancing:CreateLoadBalancerPolicy\",\n        \"elasticloadbalancing:CreateLoadBalancerListeners\",\n        \"elasticloadbalancing:ConfigureHealthCheck\",\n        \"elasticloadbalancing:DeleteLoadBalancer\",\n        \"elasticloadbalancing:DeleteLoadBalancerListeners\",\n        \"elasticloadbalancing:DescribeLoadBalancers\",\n        \"elasticloadbalancing:DescribeLoadBalancerAttributes\",\n        \"elasticloadbalancing:DetachLoadBalancerFromSubnets\",\n        \"elasticloadbalancing:DeregisterInstancesFromLoadBalancer\",\n        \"elasticloadbalancing:ModifyLoadBalancerAttributes\",\n        \"elasticloadbalancing:RegisterInstancesWithLoadBalancer\",\n        \"elasticloadbalancing:SetLoadBalancerPoliciesForBackendServer\",\n        \"elasticloadbalancing:AddTags\",\n        \"elasticloadbalancing:CreateListener\",\n        \"elasticloadbalancing:CreateTargetGroup\",\n        \"elasticloadbalancing:DeleteListener\",\n        \"elasticloadbalancing:DeleteTargetGroup\",\n        \"elasticloadbalancing:DescribeListeners\",\n        \"elasticloadbalancing:DescribeLoadBalancerPolicies\",\n        \"elasticloadbalancing:DescribeTargetGroups\",\n        \"elasticloadbalancing:DescribeTargetHealth\",\n        \"elasticloadbalancing:ModifyListener\",\n        \"elasticloadbalancing:ModifyTargetGroup\",\n        \"elasticloadbalancing:RegisterTargets\",\n        \"elasticloadbalancing:DeregisterTargets\",\n        \"elasticloadbalancing:SetLoadBalancerPoliciesOfListener\",\n        \"iam:CreateServiceLinkedRole\",\n        \"kms:DescribeKey\"\n      ],\n      \"Resource\": [\n        \"*\"\n      ]\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Backup Key File\nDESCRIPTION: Creates a backup of the generated key file to a secure location. This is important in case the original key file is lost or corrupted.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nroot# cp ~/company.com.key secure-dir/example.com.key.backup\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration\nDESCRIPTION: This shell command reloads the Nginx configuration. This is necessary after modifying the configuration file to apply the changes without restarting the Nginx server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/xslt.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Install EPEL Repository and Xerces-C\nDESCRIPTION: This command installs the EPEL (Extra Packages for Enterprise Linux) repository and the xerces-c package. EPEL provides additional packages not available in the standard RHEL repositories, and xerces-c is a dependency for the NGINX Controller Agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm\n```\n\nLANGUAGE: bash\nCODE:\n```\nsudo dnf install -y xerces-c\n```\n\n----------------------------------------\n\nTITLE: Edit GatewayClass\nDESCRIPTION: Opens the GatewayClass resource named 'nginx' for editing. This allows manually linking the GatewayClass to the NginxProxy resource by modifying the `parametersRef` field.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nkubectl edit gatewayclasses.gateway.networking.k8s.io nginx\n```\n\n----------------------------------------\n\nTITLE: Compiling NGINX Dynamic Module\nDESCRIPTION: This command configures the NGINX build with the `--with-compat` option to establish binary compatibility and then adds the specified dynamic module using `--add-dynamic-module`. Finally it compiles the modules.  Replace `<MODULE-SOURCES>` with the relative path to the dynamic module's source directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_36\n\nLANGUAGE: shell\nCODE:\n```\ncd nginx-1.27.4/\n./configure --with-compat --add-dynamic-module=../<MODULE-SOURCES>\nmake modules\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Amplify Agent Repository (Ubuntu/Debian - Bash)\nDESCRIPTION: Configures the APT repository for NGINX Amplify Agent by creating a new entry in the `/etc/apt/sources.list.d/` directory.  It uses `lsb_release` to determine the OS codename and type, and then creates a `.list` file with the appropriate repository URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\ncodename=`lsb_release -cs` && \\\nos=`lsb_release -is | tr '[:upper:]' '[:lower:]'` && \\\necho \"deb https://packages.amplify.nginx.com/py3/${os} ${codename} amplify-agent\" > \\\n/etc/apt/sources.list.d/nginx-amplify.list\n```\n\n----------------------------------------\n\nTITLE: Verifying NGINX Signing Key\nDESCRIPTION: Verifies the downloaded NGINX signing key using openssl to ensure its integrity. The output should contain a specific modulus to confirm the key's validity.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_23\n\nLANGUAGE: shell\nCODE:\n```\nopenssl rsa -pubin -in /tmp/nginx_signing.rsa.pub -text -noout\n```\n\n----------------------------------------\n\nTITLE: Updating CVE List Manually\nDESCRIPTION: These shell commands manually update the CVE list in an air-gapped environment.  It changes permissions on the cve.xml file, downloads the latest security advisories, overwrites the existing file, restores permissions, and restarts the Data Plane Manager service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide.md#_snippet_5\n\nLANGUAGE: Shell Script\nCODE:\n```\nsudo chmod 777 /usr/share/nms/cve.xml && \\\nsudo curl -s http://hg.nginx.org/nginx.org/raw-file/tip/xml/en/security_advisories.xml > /usr/share/nms/cve.xml && \\\nsudo chmod 644 /usr/share/nms/cve.xml && \\\nsudo systemctl restart nms-dpm\n```\n\n----------------------------------------\n\nTITLE: Update Package Metadata (CentOS/RHEL/Amazon Linux - Bash)\nDESCRIPTION: Updates the YUM package metadata cache.  It uses the `yum makecache` command to rebuild the cache. This operation is necessary before installing any new package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nyum makecache\n```\n\n----------------------------------------\n\nTITLE: Defining Location Blocks using JSON Schema\nDESCRIPTION: This JSON schema defines the structure for configuring location blocks in Nginx. It includes properties for a location label (`nameExpression`) and a match expression (`locationMatchExpression`). This schema is used to create a user interface for defining multiple location blocks and is essential for linking augment template input to specific location blocks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/tutorials/round-robin-reverse-proxy.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n \"title\": \"Locations\",\n \"type\": \"object\",\n \"properties\": {\n   \"templateInput\": {\n     \"type\": [\n       \"object\",\n       \"null\"\n     ],\n     \"properties\": {\n        \"nameExpression\": {\n          \"title\": \"Location Label\",\n          \"type\": \"string\",\n          \"description\": \"Enter a unique label for the location. This label is displayed in the user interface and acts as a key for matching and applying augment input to the specific location.\",\n          \"examples\": [\n            \"Users Endpoint\"\n          ]\n        },\n       \"locationMatchExpression\": {\n         \"title\": \"Match Expression\",\n         \"type\": \"string\",\n         \"description\": \"The prefix to match request paths by.\",\n         \"examples\": [\n           \"/users\"\n         ]\n       }\n     },\n     \"required\": [\n       \"nameExpression\",\n       \"locationMatchExpression\"\n     ]\n   }\n },\n \"required\": []\n}\n```\n\n----------------------------------------\n\nTITLE: Enable XSLT Module in Nginx Configuration\nDESCRIPTION: This code snippet demonstrates how to enable the XSLT module in the Nginx configuration file (`nginx.conf`). The `load_module` directive is used within the `main` context to dynamically load the module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/xslt.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_xslt_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Instance Manager Repository (Debian)\nDESCRIPTION: Adds the NGINX Instance Manager repository to the Debian system's APT sources and downloads a configuration file. The first command uses printf and tee to add a new repository entry to /etc/apt/sources.list.d/nms.list. The second command downloads a configuration file using wget and saves it to /etc/apt/apt.conf.d/90pkgs-nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/installation/add-nms-repo.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/nms/debian `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nms.list\nsudo wget -q -O /etc/apt/apt.conf.d/90pkgs-nginx https://cs.nginx.com/static/files/90pkgs-nginx\n```\n\n----------------------------------------\n\nTITLE: Test Configuration (Incorrect Hostname)\nDESCRIPTION: This curl command tests the configuration by sending a request to a different hostname 'pub.example.com'.  It verifies that the traffic is not routed to the coffee application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/routing-traffic-to-your-app.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve pub.example.com:$GW_PORT:$GW_IP http://pub.example.com:$GW_PORT/\n```\n\n----------------------------------------\n\nTITLE: Test API Endpoint without Token - Bash\nDESCRIPTION: This snippet shows the POST request to test the API endpoint without an access token after the OAuth2 Introspection policy has been applied. This request is expected to be blocked.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_25\n\nLANGUAGE: bash\nCODE:\n```\nPOST https://192.0.2.4/my/test/api\n```\n\n----------------------------------------\n\nTITLE: Updating NGINX Plus Yum Repo URL\nDESCRIPTION: This snippet shows how to update the base URL in the `/etc/yum.repos.d/nginx-plus-7.4.repo` file to pin NGINX Plus to version R32. This change ensures that the yum package manager only fetches packages from the specified version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/pin-to-version/pin-rhel7-R32.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nbaseurl=https://pkgs.nginx.com/plus/R32/centos/7/$basearch/\n```\n\n----------------------------------------\n\nTITLE: Enabling Server-Side TLS with Self-Signed Certificate - Bash\nDESCRIPTION: This snippet demonstrates how to enable server-side TLS with a self-signed certificate. It sets the `tls.enable` option to `true` and the `tls.skip_verify` option to `true` to disable hostname validation. This configuration is not recommended for production environments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/encrypt-communication.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\ntls:\n  enable: true\n  skip_verify: true\n```\n\n----------------------------------------\n\nTITLE: Adding Azure NGINX Instance to NGINX Controller in JSON\nDESCRIPTION: This JSON configuration adds an Azure NGINX instance to NGINX Controller. It references the Instance Template created earlier. The `templateRef` parameter points to the location of the Instance Template within the Controller's infrastructure hierarchy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/add-azure-instance.md#_snippet_4\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"metadata\": {\n    \"name\": \"azure1\"\n  },\n  \"desiredState\": {\n    \"type\": \"AZURE_INSTANCE\",\n    \"templateRef\": {\n      \"ref\": \"/infrastructure/locations/washington/instance-templates/us-west-azure\"\n    }\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Check Operating System FIPS Flag (Shell)\nDESCRIPTION: This command checks if the operating system is running in FIPS mode by querying the sysctl settings and filtering for the crypto.fips_enabled flag. A value of 1 indicates that FIPS mode is enabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/fips-compliance-nginx-plus.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo sysctl –a | grep fips\ncrypto.fips_enabled = 1\n```\n\n----------------------------------------\n\nTITLE: Compile Logging Profile with NGINX App Protect WAF Compiler\nDESCRIPTION: This command compiles a logging profile from a JSON file into a bundle using the NGINX App Protect WAF compiler. It mounts the current directory as a volume and specifies the logging profile file and output bundle file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\ndocker run \\\n -v $(pwd):$(pwd) \\\n waf-compiler-<version-tag>:custom \\\n -l $(pwd)/log_01.json -o $(pwd)/log01.tgz\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Controller with Join Key - Bash\nDESCRIPTION: This command installs NGINX Controller on a new node and joins it to the existing cluster using the provided join key.  The join key is required for authentication and ensures the new node is properly configured within the cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/resilient-cluster-aws.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./install.sh --join-key <long-value>\n```\n\n----------------------------------------\n\nTITLE: Install yum-utils for Nginx repository setup\nDESCRIPTION: This command installs the yum-utils package, which provides a collection of useful tools for managing yum repositories. It's required for enabling specific yum repositories, such as the Nginx mainline repository. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install yum-utils\n```\n\n----------------------------------------\n\nTITLE: Query Metrics with GroupBy - cURL\nDESCRIPTION: This cURL command uses the `groupBy` parameter to gather results according to the `app` and `alias` dimensions. It returns aggregated metric values for the last three hours. An aggregate function (SUM) and a time window (startTime) are required.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_13\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=SUM(http.request.count)&groupBy=app,alias&startTime=now-3h\"\n```\n\n----------------------------------------\n\nTITLE: Create Coffee and Tea Deployments and Services (YAML)\nDESCRIPTION: This YAML configuration creates two deployments and services: `coffee` and `tea`. Each deployment runs a single replica of the `nginxdemos/nginx-hello:plain-text` image, exposing port 8080.  The services expose these deployments on port 80.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: coffee\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: coffee\n  template:\n    metadata:\n      labels:\n        app: coffee\n    spec:\n      containers:\n      - name: coffee\n        image: nginxdemos/nginx-hello:plain-text\n        ports:\n        - containerPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: coffee\nspec:\n  ports:\n  - port: 80\n    targetPort: 8080\n    protocol: TCP\n    name: http\n  selector:\n    app: coffee\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: tea\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: tea\n  template:\n    metadata:\n      labels:\n        app: tea\n    spec:\n      containers:\n      - name: tea\n        image: nginxdemos/nginx-hello:plain-text\n        ports:\n        - containerPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: tea\nspec:\n  ports:\n  - port: 80\n    targetPort: 8080\n    protocol: TCP\n    name: http\n  selector:\n    app: tea\nEOF\n```\n\n----------------------------------------\n\nTITLE: Configure State File for Upstream - Nginx\nDESCRIPTION: This Nginx configuration snippet demonstrates how to configure a state file for an upstream group.  The `state` directive specifies the path to the file where the server state will be stored, ensuring persistence across reloads. The server directives within the upstream are commented out, as the server list is managed in the state file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/dynamic-configuration-api.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    upstream appservers {\n        zone appservers 64k;\n        state /var/lib/nginx/state/appservers.conf;\n\n        # All servers are defined in the state file\n        # server appserv1.example.com      weight=5;\n        # server appserv2.example.com:8080 fail_timeout=5s;\n        # server reserve1.example.com:8080 backup;\n        # server reserve2.example.com:8080 backup;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: YAML Configuration for Docker Compose with NGINX App Protect WAF\nDESCRIPTION: This YAML snippet shows the modified `docker-compose.yaml` file for NGINX App Protect WAF v5 to work with NGINX Instance Manager.  It includes the addition of the `user: 101:<group-id>` line to both the `waf-enforcer` and `waf-config-mgr` services. Also the `/etc/nms` volume is added to the volumes maps for both services to allow access to the policy and log profile bundles written by NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_15\n\nLANGUAGE: yaml\nCODE:\n```\nversion: \"3.9\"\n\nservices:\n  waf-enforcer:\n    container_name: waf-enforcer\n    image: private-registry.nginx.com/nap/waf-enforcer:5.2.0\n    user: 101:1002\n    environment:\n      - ENFORCER_PORT=50000\n    ports:\n      - \"50000:50000\"\n    volumes:\n      - /opt/app_protect/bd_config:/opt/app_protect/bd_config\n      - /etc/nms:/etc/nms\n    networks:\n      - waf_network\n    restart: always\n\n  waf-config-mgr:\n    container_name: waf-config-mgr\n    image: private-registry.nginx.com/nap/waf-config-mgr:5.2.0\n    user: 101:1002\n    volumes:\n      - /opt/app_protect/bd_config:/opt/app_protect/bd_config\n      - /opt/app_protect/config:/opt/app_protect/config\n      - /etc/app_protect/conf:/etc/app_protect/conf\n      - /etc/nms:/etc/nms\n    restart: always\n    network_mode: none\n    depends_on:\n      waf-enforcer:\n        condition: service_started\n\nnetworks:\n  waf_network:\n    driver: bridge\n```\n\n----------------------------------------\n\nTITLE: Enable Metrics in ACM Configuration (bash)\nDESCRIPTION: This snippet demonstrates how to enable metrics collection within the API Connectivity Manager configuration file. By uncommenting and setting the `enable_metrics` property to `true` in `/etc/nms/acm.conf`, the system will begin tracking and exposing metrics. Restarting the `nms-acm` service is then required to apply the change.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/enable-metrics.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n# set to true to enable metrics markers from the acm code\nenable_metrics = true\n```\n\n----------------------------------------\n\nTITLE: gRPC Bidirectional Stream Definition (protobuf)\nDESCRIPTION: Defines a gRPC service method where both the client and server send and receive streams of messages. The client and server can send messages independently. This uses the protobuf syntax.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/how-to/bidirectional-configuration.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nrpc BidiHello(stream HelloRequest) returns (stream HelloResponse);\n```\n\n----------------------------------------\n\nTITLE: View Installation Script Parameters\nDESCRIPTION: This command executes the `install-nim-bundle.sh` script with the `-h` flag, which displays the available command-line parameters and options that can be used to customize the installation process. This is useful for troubleshooting and understanding advanced configuration options.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nbash install-nim-bundle.sh -h\n```\n\n----------------------------------------\n\nTITLE: Install Go (Bash)\nDESCRIPTION: This command installs the Go programming language using the `apt` package manager on Ubuntu. NGINX Agent is written in Go, so the Go compiler and related tools are required to build the agent. This step assumes the user has not already installed Go.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/contribute/dev-environment-setup.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt install golang-go\n```\n\n----------------------------------------\n\nTITLE: Policy Configuration with Signature Modification Reference JSON\nDESCRIPTION: This JSON defines an App Protect policy that references an external file containing signature modifications using a URL. It configures attack signatures and references a file to exclude specific signatures.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-references.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"external_resources_signature_modification\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"signature-sets\": [\n            {\n                \"name\": \"All Signatures\",\n                \"block\": true,\n                \"alarm\": true\n            }\n        ]\n    },\n    \"modificationsReference\": {\n        \"link\": \"http://my-domain.com:8081/modifications.txt\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: kubectl describe ObservabilityPolicy\nDESCRIPTION: This command uses kubectl to describe an ObservabilityPolicy named 'foo' in the 'default' namespace. It's used to check the status of a policy in NGINX Gateway Fabric and see if it has been accepted.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/custom-policies.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe observabilitypolicies.gateway.nginx.org foo -n default\n```\n\n----------------------------------------\n\nTITLE: Install Yum Prerequisites - Shell\nDESCRIPTION: Installs the necessary packages (yum-utils and procps) on RHEL, CentOS, Rocky Linux, AlmaLinux, and Oracle Linux systems to manage yum repositories and processes. These utilities are needed to configure and use the Nginx Agent repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install yum-utils procps\n```\n\n----------------------------------------\n\nTITLE: Testing NGINX configuration with curl (path prefix)\nDESCRIPTION: This curl command tests the configuration by sending a request to the '/coffee/hello' path. It demonstrates how the request is routed to the backend server when the path matches the prefix defined in the HTTPRoute.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee/hello\n```\n\n----------------------------------------\n\nTITLE: Setting KUBECONFIG environment variable\nDESCRIPTION: This command sets the KUBECONFIG environment variable to point to the user's .kube/config file.  This tells kubectl where to find the Kubernetes configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_17\n\nLANGUAGE: bash\nCODE:\n```\nexport KUBECONFIG=.kube/config\n```\n\n----------------------------------------\n\nTITLE: Get Control Plane Container Logs\nDESCRIPTION: This command retrieves logs from the `nginx-gateway` container of a specified pod in the `nginx-gateway` namespace using `kubectl logs`.  Replace `<ngf-pod-name>` with the actual name of the NGINX Gateway Fabric pod.  These logs can reveal errors and other information related to the control plane's operation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n nginx-gateway logs <ngf-pod-name> -c nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Decompress GZIP Archive\nDESCRIPTION: This command decompresses the downloaded gzip archive containing the NGINX Plus certificate and key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\ngunzip nginx-plus-certs.gz\n```\n\n----------------------------------------\n\nTITLE: Downloading Basic Tomcat Configuration (Shell)\nDESCRIPTION: These commands change the directory and then use curl to download the basic tomcat configuration from the nginx.com website and save it as tomcat-basic.conf.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\nroot# cd /etc/nginx/conf.d\nroot# curl https://www.nginx.com/resource/conf/tomcat-basic.conf > tomcat-basic.conf\n```\n\n----------------------------------------\n\nTITLE: User Defined Signatures JSON Output Example\nDESCRIPTION: This JSON represents an example of the output file generated by the `convert-signatures` tool, showing the structure and contents of the JSON file representing user defined signatures. The signatures array contains individual signature objects with details such as attack type, name, rule, and risk.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_21\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"signatures\": [\n        {\n            \"attackType\": {\n                \"name\": \"Buffer Overflow\"\n            },\n            \"name\": \"my_first_sig\",\n            \"lastUpdateMicros\": 1606014750000000,\n            \"rule\": \"content:\\\"first_sig\\\"; nocase;\",\n            \"description\": \"This is the first user defined signature\",\n            \"revision\": \"1\",\n            \"systems\": [\n                {\n                    \"name\": \"Microsoft Windows\"\n                }\n            ],\n            \"accuracy\": \"low\",\n            \"signatureId\": \"300000002\",\n            \"signatureType\": \"request\",\n            \"risk\": \"low\"\n        },\n        {\n            \"attackType\": {\n                \"name\": \"Command Execution\"\n            },\n            \"name\": \"my_second_sig\",\n            \"lastUpdateMicros\": 1606014818000000,\n            \"rule\": \"uricontent:\\\"second_sig\\\"; nocase; objonly;\",\n            \"description\": \"Short description of the signature\",\n            \"revision\": \"1\",\n            \"systems\": [\n                {\n                    \"name\": \"Unix/Linux\"\n                }\n            ],\n            \"accuracy\": \"medium\",\n            \"signatureId\": \"300000003\",\n            \"signatureType\": \"request\",\n            \"risk\": \"medium\"\n        }\n    ],\n    \"tag\": \"user-defined-signatures\"\n}\n```\n\n----------------------------------------\n\nTITLE: Install Dependencies for NGINX (Shell)\nDESCRIPTION: Installs the `ca-certificates` and `wget` packages using the `dnf` package manager. Requires `sudo` privileges.  These packages are necessary for secure communication and downloading files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-amazon.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf install ca-certificates wget\n```\n\n----------------------------------------\n\nTITLE: Updating App Protect DoS (Debian/Ubuntu)\nDESCRIPTION: These commands are used to update the App Protect DoS solution on Debian or Ubuntu based systems. It stops the Nginx service, updates the apt-get package list, installs the app-protect-dos package using apt-get, and then starts the Nginx service. Requires `sudo`, `service`, `apt-get`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo service nginx stop\nsudo apt-get update\nsudo apt-get install app-protect-dos\nsudo service nginx start\n```\n\n----------------------------------------\n\nTITLE: Active Directory Group Member Attribute\nDESCRIPTION: This code snippet represents an LDAP attribute identifying a user as a member of an Active Directory group. This attribute is crucial for mapping users to their respective groups within NGINX Controller. The attribute should be provided without parentheses.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_10\n\nLANGUAGE: none\nCODE:\n```\nmemberOf\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX FIPS module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This shell command sequence updates the package list and installs the nginx-plus-module-fips-check package using the dnf package manager on Amazon Linux 2023, AlmaLinux, and Rocky Linux.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/fips.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-fips-check\n```\n\n----------------------------------------\n\nTITLE: Generating Certificate Request OpenSSL\nDESCRIPTION: This snippet generates a private key to be packaged in the certificate using OpenSSL. The `-out` parameter is the output file where the key will be stored. This is the first step towards generating a Certificate Signing Request (CSR).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl genrsa -out ~/company.com.key 2048\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect Policy with openApiFileReference (JSON)\nDESCRIPTION: This JSON snippet shows an NGINX App Protect policy that uses the `openApiFileReference` property to link to a file containing an array of OpenAPI file references. This demonstrates an alternative way to reference OpenAPI files, using a file that itself contains references to other OpenAPI files. The linked file (`ref.txt`) must contain a valid JSON array of OpenAPI file references.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-openapi-references.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"openapifilereference-yaml\",\n    \"template\": {\n        \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"openApiFileReference\": {\n        \"link\": \"http://127.0.0.1:8088/ref.txt\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Example Test Application\nDESCRIPTION: This snippet shows an example test application that simply returns the user's full name, email, and subject identifier, which are passed as HTTP headers by NGINX after successful authentication. The application listens on port 8080.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/okta.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nserver {\n    listen 8080;\n\n    location / {\n        return 200 \"Hello, $http_name!\\nEmail: $http_email\\nSub: $http_sub\\n\";\n        default_type text/plain;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Copying the k8s-backup.sh Script - Shell\nDESCRIPTION: This command copies the `k8s-backup.sh` script from the extracted NGINX Management Suite Helm chart to the current working directory.  This script is used to back up NGINX Management Suite deployed in a Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ncp nms-<version>/charts/nms-hybrid/backup-restore/k8s-backup.sh .\n```\n\n----------------------------------------\n\nTITLE: List Installed Packages (Debian/Ubuntu)\nDESCRIPTION: Lists installed Nginx and App Protect packages on Debian or Ubuntu systems.  The output is saved to a text file for documentation when opening a support ticket.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/troubleshooting-guide/troubleshooting.md#_snippet_3\n\nLANGUAGE: Shell\nCODE:\n```\napt list --installed | grep -E 'nginx|app-protect' > package_versions.txt\n```\n\n----------------------------------------\n\nTITLE: Configure Nginx Agent to use proxy\nDESCRIPTION: This YAML configuration configures the Nginx Agent to use a proxy instance to connect to Nginx One.  Replace `YOUR_DATA_PLANE_KEY_HERE` with the actual data plane key and `YOUR_PROXY_IP_ADDRESS_HERE` with the proxy's IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/proxy-setup/set-up-nginx-proxy-for-nginx-one.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\nserver:\n  # Replace YOUR_DATA_PLANE_KEY_HERE with your NGINX One Data Plane Key.\n  token: \"YOUR_DATA_PLANE_KEY_HERE\"\n  # Replace YOUR_PROXY_IP_ADDRESS_HERE with the IP address of the NGINX proxy instance.\n  host: YOUR_PROXY_IP_ADDRESS_HERE\n  grpcPort: 5000\n  command: agent.connect.nginx.com\n  metrics: agent.connect.nginx.com\ntls:\n  enable: true\n  skip_verify: false\n```\n\n----------------------------------------\n\nTITLE: Deploy Gateway Resource\nDESCRIPTION: Deploys the gateway resource using `kubectl apply`. This gateway defines a single HTTP listener on port 80, which matches all hostnames since no hostname is specified.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nmetadata:\n  name: cafe\nspec:\n  gatewayClassName: nginx\n  listeners:\n  - name: http\n    port: 80\n    protocol: HTTP\n```\n\n----------------------------------------\n\nTITLE: Check Kubernetes Pods\nDESCRIPTION: This shell command retrieves a list of pods in the Kubernetes cluster and displays their status. It is used to verify if the pods are running correctly and if any errors are occurring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get pods\n```\n\n----------------------------------------\n\nTITLE: Get OS Information\nDESCRIPTION: Collects operating system information including the OS release, kernel version, and full version details. This information is useful for troubleshooting and is saved to a text file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/troubleshooting-guide/troubleshooting.md#_snippet_5\n\nLANGUAGE: Shell\nCODE:\n```\ncat /etc/os-release > system_version.txt && uname -r >> system_version.txt && cat /proc/version >> system_version.txt\n```\n\n----------------------------------------\n\nTITLE: Complete NGINX OIDC Configuration Example\nDESCRIPTION: This is a complete example configuration that includes the resolver, oidc provider setup, and test application. It provides a functional configuration file that can be adapted to work with any Identity provider.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-oidc.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # Use a public DNS resolver for Issuer discovery, etc.\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider my_idp {\n        # The 'issuer' typically matches your IdP's base URL\n        issuer https://<idp-server>/idp;\n\n        # Provide a CA bundle for certificate validation\n        ssl_trusted_certificate /etc/ssl/certs/ca-certificates.crt;\n\n        # Replace with your actual IdP's client_id and secret\n        client_id <client_id>;\n        client_secret <client_secret>;\n\n        # If the .well-known endpoint cannot be derived automatically,\n        # specify config_url:\n        # config_url https://<idp-server>/auth/realms/main/.well-known/openid-configuration;\n    }\n\n    server {\n        listen 443 ssl;\n        server_name demo.example.com;\nx\n        ssl_certificate     /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n            # Protect this location with OIDC\n            auth_oidc my_idp;\n\n            # Forward OIDC claims as headers if desired\n            proxy_set_header sub   $oidc_claim_sub;\n            proxy_set_header email $oidc_claim_email;\n            proxy_set_header name  $oidc_claim_name;\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n\n    server {\n        # simple test oidc-protected application\n        listen 8080;\n\n        location / {\n            return 200 \"Hello, $http_name!\\nEmail: $http_email\\nIdP sub: $http_sub\\n\";\n            default_type text/plain;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Access Log Event Example YAML\nDESCRIPTION: This is an example of an NGINX access log event written to an Azure Storage account.  It showcases the structure of the log data and includes information like the category, location, operation name, properties (message, filePath), resource ID, and timestamp. The message field contains the actual log line, while filePath indicates the log file the event originated from.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginxaas-azure/logging-analysis-azure-storage.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\n{\n\t\"category\": \"NginxLogs\",\n\t\"location\": \"westcentralus\",\n\t\"operationName\": \"NGINX.NGINXPLUS/NGINXDEPLOYMENTS/LOG\",\n\t\"properties\": {\n\t\t\"message\": \"172.92.129.50 - \\\"-\\\" [18/Jan/2024:17:59:00 +0000] \\\"GET / HTTP/1.1\\\" 200 11232 \\\"-\\\" \\\"curl/8.4.0\\\" \\\"-\\\" \\\"20.69.58.179\\\" sn=\\\"localhost\\\" rt=0.000 ua=\\\"-\\\" us=\\\"-\\\" ut=\\\"-\\\" ul=\\\"-\\\" cs=\\\"-\\\" \",\n\t\t\"filePath\": \"/var/log/nginx/access.log\"\n\t},\n\t\"resourceId\": \"/SUBSCRIPTIONS/FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF/RESOURCEGROUPS/RESOURCEGROUP1/PROVIDERS/NGINX.NGINXPLUS/NGINXDEPLOYMENTS/TEST1\",\n\t\"time\": \"2024-01-18T17:59:00.363956795Z\"\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstall Gateway API (Experimental Channel) - Shell\nDESCRIPTION: This command uninstalls the Gateway API resources from the experimental channel. It is similar to the standard channel uninstallation, but fetches the resource definitions from the experimental channel's GitHub repository. It uses `kubectl kustomize` to fetch the resource definitions from the specified GitHub repository and then uses `kubectl delete` to remove them from the cluster. This will remove all custom resources in the entire cluster, across all namespaces. Double-check to make sure you don't have any custom resources you need to keep, and confirm that there are no other Gateway API implementations active in your cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/uninstall-gateway-api-resources.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl kustomize \"https://github.com/nginx/nginx-gateway-fabric/config/crd/gateway-api/experimental?ref=v{{< version-ngf >}}\" | kubectl delete -f -\n```\n\n----------------------------------------\n\nTITLE: Download NGINX signing key on Alpine\nDESCRIPTION: This command downloads the NGINX signing public key and places it in the /etc/apk/keys directory. This key is used to verify the integrity of the NGINX packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_22\n\nLANGUAGE: Shell\nCODE:\n```\nsudo wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub\n```\n\n----------------------------------------\n\nTITLE: Querying Nginx Plus API for Upstream Status (unhealthy)\nDESCRIPTION: This code snippet queries the Nginx Plus API after the upstream servers have been taken down. It verifies that the Nginx Plus API now reports the status as 'unhealthy'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\n$ curl -X GET \"127.0.0.1:8000/api/<version>/http/upstreams/my_backend/\" -H \"accept: application/json\" | python -m json.tool | grep state\n\n\"state\": \"unhealthy\",\n```\n\n----------------------------------------\n\nTITLE: Start Nginx\nDESCRIPTION: Starts the NGINX web server. This command initiates the NGINX process, which begins listening for incoming HTTP requests.  Ensure that the NGINX configuration is valid before running this command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx\n```\n\n----------------------------------------\n\nTITLE: Verify Headers app deployment (Response Mod) - Shell\nDESCRIPTION: Verifies that the headers application's pod and service were created after deployment, ensuring the application is running before header modification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get pods,svc\n```\n\n----------------------------------------\n\nTITLE: Starting keepalived Service\nDESCRIPTION: This command starts the keepalived daemon on both Nginx Plus instances. Keepalived is used to monitor the health of the instances and trigger a failover if one instance becomes unavailable. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-keepalived.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nsudo service keepalived start\n```\n\n----------------------------------------\n\nTITLE: Default Logging Content\nDESCRIPTION: This JSON configuration specifies the default logging content, filtering for illegal requests and using the default format with size limits for the request and message. This configuration is used when `app_protect_security_log_enabled on` is set, but `app_protect_security_log` is not.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/security-log.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filter\": {\n        \"request_type\": \"illegal\"\n    },\n    \"content\": {\n        \"format\": \"default\",\n        \"max_request_size\": \"2k\",\n        \"max_message_size\": \"5k\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Disable Swap Memory\nDESCRIPTION: This command disables swap memory on the system.  Disabling swap is often recommended for Kubernetes environments to improve performance and prevent unpredictable behavior.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nsudo swapoff -a\n```\n\n----------------------------------------\n\nTITLE: Check Server Certificate Expiration - Bash\nDESCRIPTION: This command checks the expiration date of the kubelet server certificate using `openssl`. It helps determine if the server cert has expired.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nopenssl x509 -in /var/lib/kubelet/server.pem -text -noout\n```\n\n----------------------------------------\n\nTITLE: Port-forward Prometheus Dashboard\nDESCRIPTION: This command sets up port forwarding to access the Prometheus dashboard. It forwards port 9090 on the local machine to port 80 of the prometheus-server service in the monitoring namespace.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/prometheus.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl port-forward -n monitoring svc/prometheus-server 9090:80 &\n```\n\n----------------------------------------\n\nTITLE: Download Enhanced Load Balancing Configuration\nDESCRIPTION: Downloads the enhanced weblogic load balancing configuration file from a specified URL. Requires curl to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_8\n\nLANGUAGE: none\nCODE:\n```\nroot# curl https://www.nginx.com/resource/conf/weblogic-enhanced.conf > weblogic-enhanced.conf\n```\n\n----------------------------------------\n\nTITLE: Describing Nginx Ingress Service\nDESCRIPTION: This command retrieves the DNS name of the NGINX Ingress Controller service. The DNS name is located in the \"LoadBalancer Ingress\" field of the output. Requires the nginx-ingress namespace.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_8\n\nLANGUAGE: Shell\nCODE:\n```\nkubectl describe svc nginx-ingress --namespace=nginx-ingress\n```\n\n----------------------------------------\n\nTITLE: Deleting a Signature Set using $action - JSON\nDESCRIPTION: This snippet demonstrates how to completely remove a signature set (XPath Injection Signatures) from the policy using the `$action` meta-property set to `delete`. This is the preferred method for removing signature sets for performance reasons.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/signature-sets.md#_snippet_7\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"no_xpath_policy\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"signature-sets\": [\n            {\n                 \"name\": \"XPath Injection Signatures\",\n                 \"$action\": \"delete\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing Brotli Module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This command updates the package repositories and installs the nginx-plus-module-brotli package using the dnf package manager. This is used on more modern systems and installs the Brotli module for Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/brotli.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-brotli\n```\n\n----------------------------------------\n\nTITLE: Manual Sidecar Injection - Bash\nDESCRIPTION: This command manually injects the sidecar proxy into a Kubernetes resource definition file using the `nginx-meshctl inject` command. It takes an input resource file (`<resource-file>`) and writes the injected configuration to a new file (`<new-resource-file>`).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/inject-sidecar-proxy.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl inject < <resource-file> > <new-resource-file>\n```\n\n----------------------------------------\n\nTITLE: Testing NGINX Configuration\nDESCRIPTION: Tests the NGINX configuration file for syntactic validity using the `nginx -t` command. This ensures that the configuration is error-free before reloading or restarting NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_10\n\nLANGUAGE: none\nCODE:\n```\nroot# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n```\n\n----------------------------------------\n\nTITLE: Installing HTTP Substitutions Filter on SLES\nDESCRIPTION: This shell command refreshes the package repositories and installs the `nginx-plus-module-subs-filter` package using the `zypper` package manager. This is for SLES distributions. It requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/http-substitutions-filter.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-subs-filter\n```\n\n----------------------------------------\n\nTITLE: Tomcat Engine Configuration (Sticky Route)\nDESCRIPTION: This code snippet shows the configuration to be added to the Tomcat server configurations to append an identifier based on the `jvmRoute` attribute to the end of the `JSESSIONID` cookie value.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_27\n\nLANGUAGE: none\nCODE:\n```\n# On host 10.100.100.11\n<Engine name=\"Catalina\" defaultHoast=\"www.example.com\" jvmRoute=\"a\">\n# On host 10.100.100.12\n<Engine name=\"Catalina\" defaultHoast=\"www.example.com\" jvmRoute=\"b\">\n```\n\n----------------------------------------\n\nTITLE: Stream Bytes Sent and Received Metrics\nDESCRIPTION: Describes the 'plus.stream.bytes_rcvd' and 'plus.stream.bytes_sent' metrics, which are counters for bytes received from clients and bytes sent. These metrics monitor data transfer within the stream processing module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_22\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Number of bytes received from clients, and bytes sent.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Querying Rejected or Flagged Security Violation Events for a Specific App Component\nDESCRIPTION: This example shows how to retrieve security violation events (rejected or flagged) for a specific App Component (shopping, prod environment, app-component) using the NGINX Controller REST API. The startTime is set to 0 and endTime to now.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/view-app-security-analytics.md#_snippet_7\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n                category='security violation' and\n                request_outcome_reason in ('SECURITY_WAF_VIOLATION','SECURITY_WAF_FLAGGED') and\n                app='shopping' and\n                environment='prod' and\n                component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Complete NGINX Configuration Example\nDESCRIPTION: This is a complete NGINX configuration example that combines all the steps outlined in the document. It includes the DNS resolver, OIDC provider definition, server configuration with SSL, and proxy settings for the application. It assumes the existence of SSL certificates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/entra-id.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # Use a public DNS resolver for Issuer discovery, etc.\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider entra {\n        # The issuer is typically something like:\n        # https://login.microsoftonline.com/<tenant_id>/v2.0\n        issuer https://login.microsoftonline.com/<tenant_id>/v2.0;\n\n        # Replace with your actual Entra client_id and client_secret\n        client_id <client_id>;\n        client_secret <client_secret>;\n    }\n\n    server {\n        listen 443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n            # Protect this location with Entra OIDC\n            auth_oidc entra;\n\n            # Forward OIDC claims as headers if desired\n            proxy_set_header sub $oidc_claim_sub;\n            proxy_set_header email $oidc_claim_email;\n            proxy_set_header name $oidc_claim_name;\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n\n    server {\n        listen 8080;\n\n        location / {\n            return 200 \"Hello, $http_username!\\n Your email is $http_email\\n Your unique id is $http_sub\\n\";\n            default_type text/plain;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Specify IDL Files via Tarball\nDESCRIPTION: Specifies IDL files for a gRPC content profile using a tarball (`album_service_files.tgz`).  The `primaryIdlFileName` property indicates which file within the tarball is the primary IDL file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/grpc-content-profiles.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n\"idlFiles\": [{\n    \"idlFile\": {\n        \"$ref\": \"file:///grpc_files/album_service_files.tgz\"\n    },\n    \"primaryIdlFileName\": \"album_service.proto\"\n}]\n```\n\n----------------------------------------\n\nTITLE: Install Cookie-Flag Module on SLES\nDESCRIPTION: This shell script refreshes the system and installs the nginx-plus-module-cookie-flag package using zypper. It assumes that the zypper package manager is available and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/cookie-flag.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-cookie-flag\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Signing Key on Alpine\nDESCRIPTION: This command downloads the official NGINX signing key from the nginx.org website and saves it to /tmp/nginx_signing.rsa.pub. This key is used to verify the authenticity of NGINX packages before installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_40\n\nLANGUAGE: shell\nCODE:\n```\ncurl -o /tmp/nginx_signing.rsa.pub https://nginx.org/keys/nginx_signing.rsa.pub\n```\n\n----------------------------------------\n\nTITLE: Kubernetes NginxGateway Invalid Status\nDESCRIPTION: An example status output of an invalid NginxGateway resource, showing that the resource has failed validation. The `Message` field provides details about the validation failure, and the `Status` field is set to `False` for the `Valid` condition.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/resource-validation.md#_snippet_10\n\nLANGUAGE: text\nCODE:\n```\nStatus:\n  Conditions:\n    Last Transition Time:  2023-12-15T21:02:30Z\n    Message:               Failed to update control plane configuration: logging.level: Unsupported value: \"some-level\": supported values: \"info\", \"debug\", \"error\"\n    Observed Generation:   1\n    Reason:                Invalid\n    Status:                False\n    Type:                  Valid\n```\n\n----------------------------------------\n\nTITLE: Adding URI Snippet in NGINX Controller\nDESCRIPTION: This snippet demonstrates how to add a custom URI snippet to an Nginx configuration. This example sets the `proxy_set_header` directive within the component's server block. The snippet allows for direct modification of the Nginx configuration, but it requires careful verification before deployment to avoid configuration errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/manage-apps.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_set_header Host $proxy_host;\n```\n\n----------------------------------------\n\nTITLE: Install OpenTracing Module on SLES\nDESCRIPTION: This shell script refreshes the package repository and installs the `nginx-plus-module-opentracing` package using zypper. This enables the OpenTracing module within Nginx Plus. It is compatible with SUSE Linux Enterprise Server (SLES).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentracing.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-opentracing\n```\n\n----------------------------------------\n\nTITLE: Deploying NGINX Service Mesh\nDESCRIPTION: This command deploys NGINX Service Mesh using the default settings.  It assumes that the user has kubectl configured and is connected to a Kubernetes cluster.  The command creates the namespace for the NGINX Service Mesh control plane. It is important that this namespace not be used for anything else.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy\n```\n\n----------------------------------------\n\nTITLE: Restrict Access to Swagger UI\nDESCRIPTION: This snippet restricts access to the Swagger UI location to a specific network.  It uses the `allow` and `deny` directives to control which IP addresses can access the UI.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_26\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /swagger-ui {\n    root   /usr/share/nginx/html;\n    allow  192.168.1.0/24;\n    deny   all;\n}\n```\n\n----------------------------------------\n\nTITLE: Slab Zone Pages Used Metric\nDESCRIPTION: Describes the 'plus.slab.pages.used' metric, which is a gauge representing the current number of used memory pages in the slab zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_33\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, integer\nDescription: Сurrent number of used memory pages.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Run Support Package Script with Config Flag\nDESCRIPTION: This command executes the support-package.sh script with root privileges and a specified configuration file path using the -c flag.  The script uses the provided config file to determine database settings and other configurations.  It requires the config file to be a valid NGINX Developer Portal configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/devportal-support-package.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo bash /etc/nginx-devportal/scripts/support-package.sh -c /your/config.conf\n```\n\n----------------------------------------\n\nTITLE: Cloning nginx-openid-connect repository with Git\nDESCRIPTION: This command clones the nginx-openid-connect GitHub repository to the local machine. This repository contains the necessary configuration files and scripts for integrating NGINX Plus with OpenID Connect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/ping-identity.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ngit clone https://github.com/nginxinc/nginx-openid-connect\n```\n\n----------------------------------------\n\nTITLE: Error Log Example - Bash\nDESCRIPTION: This snippet shows example error log entries from the data host. It indicates reasons for a 403 Forbidden response, such as a missing or inactive access token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_30\n\nLANGUAGE: bash\nCODE:\n```\ncat /var/log/nginx/data-host-error.log\n2022/10/17 10:23:11 [error] 35643#35643: *15 js: OAuth introspection access_token not provided.\n2022/10/17 11:24:30 [error] 39542#39542: *49 js: OAuth token introspection found inactive token.\n```\n\n----------------------------------------\n\nTITLE: Example of Correct Integration Reference Path Format\nDESCRIPTION: This JSON snippet shows the correct format for referencing integrations in NGINX Controller configurations. All references should use the following relative format.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-forwarders.md#_snippet_5\n\nLANGUAGE: JSON\nCODE:\n```\n/platform/integrations/{integrationName}\n```\n\n----------------------------------------\n\nTITLE: Introspect User Access Token Example\nDESCRIPTION: This command introspects a user access token using the Keycloak token introspection endpoint. It requires providing the access token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ncurl -L -X POST 'http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect' \\\n   -H \"Authorization: Bearer <access token>\" \\\n   -H \"Accept: application/json\" \\\n   -H \"Content-Type: application/x-www-form-urlencoded\" \\\n   --data-urlencode 'token=<JWT_token>' \\\n   | jq\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP/2 Monitor URI in NGINX\nDESCRIPTION: This snippet showcases configuring the monitor URI for HTTP/2 over SSL using the `app_protect_dos_monitor` directive. It includes specifying the protocol as http2 and setting a timeout value. The monitor URI specifies the endpoint used for monitoring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nlisten 443 http2 reuseport ssl;\nserver_name serv;\n\nlocation / {\n    # Protected Object is defined here\n    app_protect_dos_monitor uri=https://serv:443/ protocol=http2 timeout=5;\n}\n```\n\n----------------------------------------\n\nTITLE: Querying NGINX Controller REST API using curl\nDESCRIPTION: This code snippet shows how to query the NGINX Controller REST API to find error messages related to data forwarders. It sends an HTTP GET request to the `/analytics/forwarders` endpoint, replacing placeholders with actual values for session cookie, Controller FQDN, and forwarder name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-forwarders.md#_snippet_0\n\nLANGUAGE: Bash\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{{Controller-FQDN}}/api/v1/analytics/forwarders/{forwarderName}\"\n```\n\n----------------------------------------\n\nTITLE: Testing HTTPS redirect with curl\nDESCRIPTION: This shell command uses curl to send an HTTP request to the 'coffee' service on the HTTP port, simulating an unencrypted request. The `--resolve` option maps cafe.example.com to the NGINX Gateway Fabric's IP address and HTTP port, and the `--include` option displays the response headers, allowing verification of the HTTPS redirect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/https-termination.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_HTTP_PORT:$GW_IP http://cafe.example.com:$GW_HTTP_PORT/coffee --include\n```\n\n----------------------------------------\n\nTITLE: Fixed URL encoding in Dev Portal Code Snippet (Bash)\nDESCRIPTION: This snippet shows the corrected curl command after removing the URL encoding from the path parameter. It provides a direct and usable URL to access the API endpoint with the `driverId` parameter properly formatted.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_29\n\nLANGUAGE: bash\nCODE:\n```\ncurl --request GET --url http://sportsapp.example.com/api/f1/drivers/{driverId}\n```\n\n----------------------------------------\n\nTITLE: Checking and restarting the NGINX Agent status\nDESCRIPTION: Commands to confirm the NGINX Agent is started, and to restart the NGINX agent if necessary.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl status nginx-agent\nsudo systemctl start nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Installing Prometheus Module on Alpine\nDESCRIPTION: This command installs the nginx-plus-module-prometheus package using the apk package manager, typically used on Alpine Linux distributions. It installs the module with `apk add`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-prometheus\n```\n\n----------------------------------------\n\nTITLE: Configuring values.yaml for Private Docker Registry\nDESCRIPTION: This YAML snippet demonstrates how to configure the `values.yaml` file for the NGINX Developer Portal Helm chart to pull images from a private Docker registry. It specifies the `imagePullSecrets`, image repositories, and tags for the `apigw` and `api` components. It requires replacing placeholder values for the registry, version, control plane host, and instance group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/devportal-helm-chart.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\n# values.yaml\nimagePullSecrets:\n  - name: regcred\napigw:\n  acmService:\n    enabled: true\n    type: LoadBalancer\n  image:\n    repository: <my-docker-registry>/nginx-devportal-apigw\n    tag: <version>\n  controlPlane:\n    host: <my-control-plane-host>\n    instanceGroup: <my-instance-group>\n  service:\n    type: LoadBalancer\napi:\n  image:\n    repository: <my-docker-registry>/nginx-devportal-api\n    tag: <version>\n  db:\n    type: <database-type>\n  acm:\n    client:\n      caSecret:\n        name: acm-tls\n        key: ca.crt\n```\n\n----------------------------------------\n\nTITLE: Deploy GlobalConfiguration\nDESCRIPTION: This command applies the GlobalConfiguration resource defined in `nic-global-configuration.yaml` to the Kubernetes cluster using `kubectl`. The GlobalConfiguration configures a listener to listen for UDP datagrams on a specified port for the NGINX Ingress Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-udp-walkthrough.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f nic-global-configuration.yaml\n```\n\n----------------------------------------\n\nTITLE: Add NGINX App Protect WAF repository - Debian\nDESCRIPTION: This command adds the NGINX App Protect WAF repository to the Debian system's apt sources.  It uses `printf` to generate the repository entry string, which includes the distribution codename obtained using `lsb_release -cs`, and then pipes it to `sudo tee` to write it to the `/etc/apt/sources.list.d/nginx-app-protect.list` file. This allows the system to find and install the NGINX App Protect WAF packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_20\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb https://pkgs.nginx.com/app-protect/debian `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-app-protect.list\n```\n\n----------------------------------------\n\nTITLE: Installing HTTP Substitutions Filter on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This shell command updates the package repositories and installs the `nginx-plus-module-subs-filter` package using the `yum` package manager. This is for Amazon Linux 2, CentOS, Oracle Linux, and RHEL distributions. It assumes `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/http-substitutions-filter.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-subs-filter\n```\n\n----------------------------------------\n\nTITLE: Create tarball (Shell)\nDESCRIPTION: This command creates a compressed tarball named `logs.tgz` containing the files listed in `logs.txt`. It uses the `tar` command with the `cvfz` options to create, verbose, compress, and archive the specified files.  The backticks execute the `cat logs.txt` command, which expands to the list of files to include in the tarball.  This is the final step in preparing the troubleshooting information to send to customer support.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/troubleshooting-guide/how-to-troubleshoot.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ntar cvfz logs.tgz `cat logs.txt`\n```\n\n----------------------------------------\n\nTITLE: Querying Security Violation Events by Flagged Requests\nDESCRIPTION: This shows how to get all security violation events where the request was flagged by WAF for review using the NGINX Controller REST API. The startTime is set to 0 and endTime to now.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/view-app-security-analytics.md#_snippet_5\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            request_outcome_reason='SECURITY_WAF_FLAGGED')\n```\n\n----------------------------------------\n\nTITLE: Install Set-Misc Module on Debian and Ubuntu\nDESCRIPTION: This snippet outlines the steps to install the nginx-plus-module-set-misc package on Debian and Ubuntu systems using the apt package manager. The package repositories are updated, followed by the module installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/set-misc.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-set-misc\n```\n\n----------------------------------------\n\nTITLE: Describe Kubernetes NginxGateway\nDESCRIPTION: Retrieves detailed information about an NginxGateway resource using kubectl. This command shows the resource's specification, status, and other metadata, which can be used to diagnose issues or verify its configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/resource-validation.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe nginxgateways.gateway.nginx.org nginx-gateway-config\n```\n\n----------------------------------------\n\nTITLE: Create Resource Group JSON Request - NGINX Instance Manager\nDESCRIPTION: This JSON payload is used to create a resource group via the NGINX Instance Manager REST API. It includes the group's name, description, and an array of resources. The module, name, object, and UID are specified for each resource. This example includes a single instance named 'test-instance'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/rbac/manage-resource-groups.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"name\": \"my-resource-group\",\n  \"description\": \"Group for managing test instances\",\n  \"resources\": [\n    {\n      \"module\": \"Instance Manager\",\n      \"name\": \"test-instance\",\n      \"object\": \"Systems\",\n      \"uid\": \"1234abcd-5678-90ef-ghij-klmnopqrstuv\"\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Send Traffic to Coffee v1\nDESCRIPTION: Sends a request to the coffee application using `curl`. This request is routed to the `coffee-v1` pod because it matches the path prefix `/coffee` and does not include any headers or query parameters that would route it to `coffee-v2`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee\n```\n\n----------------------------------------\n\nTITLE: Applying TrafficSplit Configuration with kubectl\nDESCRIPTION: This command applies the TrafficSplit configuration defined in `trafficsplit.yaml` to manage traffic distribution between different target services. It uses `kubectl apply` to create or update the TrafficSplit resource in the Kubernetes cluster. The file specifies how traffic should be split across different versions of the target application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f trafficsplit.yaml\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Perl Module (Amazon Linux 2023, AlmaLinux, Rocky Linux)\nDESCRIPTION: This shell script updates the package manager and installs the `nginx-plus-module-perl` package on Amazon Linux 2023, AlmaLinux, and Rocky Linux systems. It uses the `dnf` package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/perl.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-perl\n```\n\n----------------------------------------\n\nTITLE: Testing Nginx Configuration\nDESCRIPTION: This command tests the Nginx configuration file for syntax errors.  It is used to confirm that the configuration is valid before reloading Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip2.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Configure Volume Mount in Docker Compose (YAML)\nDESCRIPTION: This YAML snippet demonstrates how to mount a host directory (`/bundles`) to the same path inside the `waf-config-mgr` container using a volume mount in a `docker-compose.yml` file. This allows the container to access files located in the specified host directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/bundles-volume-mount.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\n...\nwaf-config-mgr:\n  container_name: waf-config-mgr\n  image: \"private-registry.nginx.com/nap/waf-config-mgr:1.0.0\"\n  volumes:\n    - /bundles:/bundles # Mounting the host directory to the container\n    - ... #existing volume mounts\n```\n\n----------------------------------------\n\nTITLE: Complete Nginx Stream Configuration for TCP Proxy with SSL\nDESCRIPTION: This is a complete example demonstrating how to configure Nginx as a TCP proxy with SSL/TLS encryption. It includes an upstream block defining the backend servers and a server block with the necessary proxy_ssl directives.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-tcp-traffic-upstream.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n\n    upstream backend {\n        server backend1.example.com:12345;\n        server backend2.example.com:12345;\n        server backend3.example.com:12345;\n   }\n\n    server {\n        listen     12345;\n        proxy_pass backend;\n        proxy_ssl  on;\n\n        proxy_ssl_certificate         /etc/ssl/certs/backend.crt;\n        proxy_ssl_certificate_key     /etc/ssl/certs/backend.key;\n        proxy_ssl_protocols           TLSv1 TLSv1.1 TLSv1.2;\n        proxy_ssl_ciphers             HIGH:!aNULL:!MD5;\n        proxy_ssl_trusted_certificate /etc/ssl/certs/trusted_ca_cert.crt;\n\n        proxy_ssl_verify        on;\n        proxy_ssl_verify_depth  2;\n        proxy_ssl_session_reuse on;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Plus (Ubuntu 24.04)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Plus package from Ubuntu 24.04. It uses the `apt-get remove` command to remove the `app-protect-module-plus` package. Requires root privileges and the apt package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_71\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get remove app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Setting Timeout for Zone Sync Leeway in NGINX\nDESCRIPTION: This Nginx configuration block sets a timeout value for synchronizing ID tokens between cluster nodes using the `map` directive. The timeout is specified in milliseconds and is used to handle scenarios where different nodes might process requests from the same user agent in a short period.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/oidc.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nmap $host $zone_sync_leeway {\n    # Specifies the maximum timeout for synchronizing ID tokens between cluster\n    # nodes when you use shared memory zone content sync. This option is only\n    # recommended for scenarios where cluster nodes can randomly process\n    # requests from user agents and there may be a situation where node \"A\"\n    # successfully received a token, and node \"B\" receives the next request in\n    # less than zone_sync_interval.\n    default 2000; # Time in milliseconds, e.g. (zone_sync_interval * 2 * 1000)\n}\n```\n\n----------------------------------------\n\nTITLE: Restoring NGINX Management Suite (restore.sh) - Shell\nDESCRIPTION: This command executes the `restore.sh` script as a superuser, providing the path to the backup tarball as an argument.  It assumes the user is already in the `/etc/nms/scripts` directory and that the `<DATETIME>` portion of the filename is known and has been replaced with the appropriate timestamp.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ncd /etc/nms/scripts\nsudo ./restore.sh /tmp/nms-backup-<DATETIME>.tgz\n```\n\n----------------------------------------\n\nTITLE: Install Developer Portal (CentOS, RHEL, RPM-based)\nDESCRIPTION: Installs the `nginx-devportal` and `nginx-devportal-ui` packages on CentOS, RHEL, or RPM-based systems using `yum`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum -y install nginx-devportal nginx-devportal-ui\n```\n\n----------------------------------------\n\nTITLE: Get Services and Pods (Shell)\nDESCRIPTION: This command retrieves the services and pods in the default namespace using `kubectl`. It's used to verify that the `coffee` and `tea` services and pods have been created successfully.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get svc,pod -n default\n```\n\n----------------------------------------\n\nTITLE: Downloading Basic Load Balancing Configuration\nDESCRIPTION: Downloads the complete configuration file for basic load balancing from the specified URL and saves it to the jboss-basic.conf file in the /etc/nginx/conf.d directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\nroot# cd /etc/nginx/conf.d\nroot# curl https://www.nginx.com/resource/conf/jboss-basic.conf > jboss-basic.conf\n```\n\n----------------------------------------\n\nTITLE: Port-forward Grafana Dashboard\nDESCRIPTION: This command sets up port forwarding to access the Grafana dashboard. It forwards port 3000 on the local machine to port 80 of the grafana service in the monitoring namespace.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/prometheus.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nkubectl port-forward -n monitoring svc/grafana 3000:80 &\n```\n\n----------------------------------------\n\nTITLE: Create Single File NGINX Configuration - Azure CLI\nDESCRIPTION: This command creates an NGINX configuration with a single file. It specifies the configuration name, deployment name, resource group, root file, and the content of the configuration file encoded as a base64 string. The 'files' parameter takes a JSON array containing a single object with 'content' and 'virtual-path' keys.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configuration-azure-cli.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment configuration create --name default \\\n      --deployment-name myDeployment --resource-group myResourceGroup \\\n      --root-file /etc/nginx/nginx.conf \\\n      --files \"[{content:'aHR0cCB7CiAgICB1cHN0cmVhbSBhcHAgewogICAgICAgIHpvbmUgYXBw \n      IDY0azsKICAgICAgICBsZWFzdF9jb25uOwogICAgICAgIHNlcnZlciAxMC4wLjEuNDo4 \n      MDAwOwogICAgfQoKICAgIHNlcnZlciB7CiAgICAgICAgbGlzdGVuIDgwOwogICAgICAg \n      IHNlcnZlcl9uYW1lICouZXhhbXBsZS5jb207CgogICAgICAgIGxvY2F0aW9uIC8gewog \n      ICAgICAgICAgICBwcm94eV9zZXRfaGVhZGVyIEhvc3QgJGhvc3Q7CiAgICAgICAgICAg \n      IHByb3h5X3NldF9oZWFkZXIgWC1SZWFsLUlQICRyZW1vdGVfYWRkcjsKICAgICAgICAg \n      ICAgcHJveHlfc2V0X2hlYWRlciBYLVByb3h5LUFwcCBhcHA7CiAgICAgICAgICAgIHBy \n      b3h5X3NldF9oZWFkZXIgR2l0aHViLVJ1bi1JZCAwMDAwMDA7CiAgICAgICAgICAgIHBy \n      b3h5X2J1ZmZlcmluZyBvbjsKICAgICAgICAgICAgcHJveHlfYnVmZmVyX3NpemUgNGs7 \n      CiAgICAgICAgICAgIHByb3h5X2J1ZmZlcnMgOCA4azsKICAgICAgICAgICAgcHJveHlf \n      cmVhZF90aW1lb3V0IDYwczsKICAgICAgICAgICAgcHJveHlfcGFzcyBodHRwOi8vYXBw \n      OwogICAgICAgICAgICBoZWFsdGhfY2hlY2s7CiAgICAgICAgfQogICAgICAgIAogICAg \n      fQp9',virtual-path:'/etc/nginx/nginx.conf'}]\"\n```\n\n----------------------------------------\n\nTITLE: Updating or Replacing TLS Certificates (Bash)\nDESCRIPTION: This command uses the `helper.sh` script to update or replace TLS certificates used to connect to NGINX Controller. It requires the paths to the new certificate file and key file as arguments. The script is expected to handle the certificate replacement process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh configtls <cert_file> <key_file>\n```\n\n----------------------------------------\n\nTITLE: Verify redirect with curl for soda with pepsi application (Shell)\nDESCRIPTION: This `curl` command sends a request to `http://cafe.example.com/soda/pepsi` and includes the response headers to verify the redirect.  The `--resolve` maps the hostname to the specified IP and Port, and the `--include` option displays response headers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/soda/pepsi --include\n```\n\n----------------------------------------\n\nTITLE: Creating a JSON Web Key (JWK) file\nDESCRIPTION: This snippet represents a JSON Web Key (JWK) file containing a single symmetric key. The key is base64url-encoded, and the file also specifies the key type (octet sequence) and key ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_7\n\nLANGUAGE: json\nCODE:\n```\n{\"keys\":\n    [{\n        \"k\":\"ZmFudGFzdGljand0\",\n        \"kty\":\"oct\",\n        \"kid\":\"0001\"\n    }]\n}\n```\n\n----------------------------------------\n\nTITLE: Extracting the NGINX Diagnostic Package\nDESCRIPTION: This command extracts the contents of the created `.tar.gz` archive.  The archive contains textual output of all the commands run by the script. Replace `support-pkg-1682457903.tar.gz` with the actual filename of the package generated by the `nginx-supportpkg.sh` script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/diagnostic-package.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ntar -xvf support-pkg-1682457903.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Install EPEL repository for Nginx on RHEL/CentOS\nDESCRIPTION: This command installs the EPEL (Extra Packages for Enterprise Linux) repository, which provides additional packages not available in the default RHEL/CentOS repositories. It's often a prerequisite for installing Nginx from the OS repository. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install epel-release\n```\n\n----------------------------------------\n\nTITLE: Configuring URI Matching with REGEX in Components - JSON\nDESCRIPTION: This JSON snippet demonstrates the correct way to define a URI with a REGEX match method within a component in NGINX Controller. It specifies a relative path starting with `/` or `\\/` for the URI, which is essential for the regex match to function correctly. The snippet shows the `uris` object containing a single URI definition with the `matchMethod` set to `REGEX`. This configuration is valid only for components, not gateways.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_44\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"uris\": {\n    \"/*.jpg\": {\n      \"matchMethod\": \"REGEX\"\n    }\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Plus repository URL for Ubuntu\nDESCRIPTION: Shows the repository URL for Ubuntu to pin NGINX Plus to a specific version (R33). It needs to be updated in `/etc/apt/sources.list.d/nginx-plus.list`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/pin-to-version/pin-debian-ubuntu-R32.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nhttps://pkgs.nginx.com/plus/R33/ubuntu\n```\n\n----------------------------------------\n\nTITLE: Limiting Number of Connections - Nginx\nDESCRIPTION: This snippet configures connection limiting by using the `limit_conn` directive in conjunction with the previously defined `limit_conn_zone`. It limits the number of simultaneous connections from a single IP address to 1. This is placed within the `server` block inside the `stream` context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-tcp.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    limit_conn_zone $binary_remote_addr zone=ip_addr:10m;\n\n    server {\n        #...\n        limit_conn ip_addr 1;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Start Nginx Agent (systemctl)\nDESCRIPTION: This command starts the nginx-agent service using systemctl.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/upgrade.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl start nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Downloading Basic Load Balancing Configuration\nDESCRIPTION: These commands download the basic load balancing configuration file from the nginx.com website and save it as `nodejs-basic.conf` in the `/etc/nginx/conf.d` directory. The commands first change the directory to `/etc/nginx/conf.d` and then uses `curl` to download the file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\nroot# cd /etc/nginx/conf.d\nroot# curl https://www.nginx.com/resource/conf/nodejs-basic.conf > nodejs-basic.conf\n```\n\n----------------------------------------\n\nTITLE: Querying Metrics with Specified Dimensions using cURL\nDESCRIPTION: This cURL command retrieves metrics, specifically the sum of HTTP request counts, including the 'environment' dimension.  It requires a session cookie and specifies a 3-hour startTime window. The controller IP address needs to be replaced in the URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_18\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=SUM(http.request.count)&dimensions=environment&startTime=now-3h\"\n```\n\n----------------------------------------\n\nTITLE: Start Nginx Controller Agent\nDESCRIPTION: This command starts the Nginx Controller Agent service on the Nginx Plus system.  It uses the `service` command to manage the agent's lifecycle, specifically starting the service. Requires the controller-agent service to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-controller.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nservice controller-agent start\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Instance Manager Chart (Older Version)\nDESCRIPTION: This command installs an older version (<= 1.15.0) of NGINX Instance Manager using Helm. It configures the admin password hash, specifies the chart, creates a namespace, uses a custom values.yaml file, specifies the chart version, and waits for the deployment. This command is used for deploying older versions of NGINX Instance Manager with Helm.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_20\n\nLANGUAGE: shell\nCODE:\n```\nhelm install -n nms \\\n--set nms-hybrid.adminPasswordHash=$(openssl passwd -6 'YourPassword123#') \\\nnms nginx-stable/nms \\\n--create-namespace \\\n-f <path-to-your-values.yaml> \\\n--version <chart-version> \\\n--wait\n```\n\n----------------------------------------\n\nTITLE: Enabling Accelerated Mitigation\nDESCRIPTION: This command enables the L4 accelerated mitigation feature for Nginx App Protect DoS in the http context of the nginx.conf file. This is applicable for Debian11, Ubuntu20.04 and RHEL8. Requires App Protect DoS to be enabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\napp_protect_dos_accelerated_mitigation on;\n```\n\n----------------------------------------\n\nTITLE: Install OpenTracing Module on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This shell script updates the package repository and installs the `nginx-plus-module-opentracing` package using yum. This enables the OpenTracing module within Nginx Plus. It is compatible with Amazon Linux 2, CentOS, Oracle Linux, and RHEL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentracing.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-opentracing\n```\n\n----------------------------------------\n\nTITLE: JSON Log for 'usa-only' Override Rule\nDESCRIPTION: This JSON snippet provides an example of the `json_log` when the 'usa-only' override rule is matched. It includes details about enforcement state (isBlocked, isAlarmed), violation, policy entity with the override rule name, and a description.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/override-rules-logging-reporting.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"enforcementState\": {\n        \"isBlocked\": true,\n        \"isAlarmed\": true,\n        \"rating\": 4,\n        \"attackType\": [\n            {\n                \"name\": \"ATTACK_TYPE_FORCEFUL_BROWSING\"\n            }\n        ]\n    },\n    \"violation\": {\n        \"name\": \"VIOL_RULE\"\n    },\n    \"policyEntity\": {\n        \"override-rule\": {\n            \"name\": \"usa-only\"\n        }\n    },\n    \"description\": \"Trying to access special\"\n},\n```\n\n----------------------------------------\n\nTITLE: Check Nginx Controller Agent Status\nDESCRIPTION: This command checks the status of the Nginx Controller Agent service. It uses `systemctl` to retrieve and display the current status, including whether the service is running, its process ID, and recent log entries. Requires the `systemctl` command and the controller-agent service to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-controller.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsystemctl status controller-agent\n```\n\n----------------------------------------\n\nTITLE: Install Headers-More Module on Alpine\nDESCRIPTION: This shell script installs the `nginx-plus-module-headers-more` package using apk. It is specific to Alpine Linux operating system. It doesn't explicitly require sudo as Alpine often runs as root by default.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/headers-more.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-headers-more\n```\n\n----------------------------------------\n\nTITLE: Patch Spiffeid Resources to Remove Finalizers\nDESCRIPTION: This script iterates through all namespaces and patches any `Spiffeid` resources by removing their finalizers. This is useful when a namespace is stuck in the \"Terminating\" state due to lingering Spiffeid resources. Requires `kubectl` and `awk`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/uninstall/uninstall.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nfor ns in $(kubectl get ns | awk '{print $1}' | tail -n +2)\ndo\nif [ $(kubectl get spiffeids -n $ns 2>/dev/null | wc -l) -ne 0 ]\nthen\n    kubectl patch spiffeid $(kubectl get spiffeids -n $ns | awk '{print $1}' | tail -n +2) --type='merge' -p '{\"metadata\":{\"finalizers\":null}}' -n $ns\nfi\ndone\n```\n\n----------------------------------------\n\nTITLE: Verify Custom SCC Creation in OpenShift\nDESCRIPTION: This command retrieves the YAML definition of the custom Security Context Constraint (SCC) named `nms-restricted-v2-scc` in OpenShift. It's used to verify that the SCC has been correctly created and configured, allowing NGINX Instance Manager pods to run with the necessary permissions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\noc get scc nms-restricted-v2-scc --output=yaml\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Controller (bash)\nDESCRIPTION: This script uninstalls NGINX Controller from a node. It should be run on the node that is being removed from the cluster after deleting the node from the NGINX Controller web interface.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/manage-cluster.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/uninstall.sh\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Amplify Agent Repository (Amazon Linux - Bash)\nDESCRIPTION: Creates a repository configuration file for NGINX Amplify Agent on Amazon Linux.  It defines the repository name, base URL, GPG check status, and enablement status, which is then written to `/etc/yum.repos.d/nginx-amplify.repo`. The `release` variable is set to `latest` for Amazon Linux.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nrelease=\"latest\" && \\\nprintf \"[nginx-amplify]\\nname=nginx amplify repo\\nbaseurl=https://packages.amplify.nginx.com/py3/amzn/${release}/\\$basearch\\ngpgcheck=1\\nenabled=1\\n\" > \\\n/etc/yum.repos.d/nginx-amplify.repo\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS Match Block in NGINX\nDESCRIPTION: This snippet shows how to configure the `match` block in NGINX to perform DNS health checks.  It includes the `send` directive, which contains the raw DNS query packet, and the `expect` directive, which defines the expected response from the DNS server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\nmatch dns {\n    send \\x00\\x01\\x01\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x0b\\x68\\x65\\x61\\x6c\\x74\\x68\\x63\\x68\\x65\\x63\\x6b\\x07\\x65\\x78\\x61\\x6d\\x70\\x6c\\x65\\x03\\x63\\x6f\\x6d\\x00\\x00\\x01\\x00\\x01;\n    expect  ~* \"healthy.svcs.example.com\";\n}\n```\n\n----------------------------------------\n\nTITLE: Setting Status Zone for HTTPS Traffic in Nginx (Server block)\nDESCRIPTION: This configuration adds a `status_zone` directive to the server block for HTTPS traffic. This enables collection of statistics for the virtual server which can then be viewed in the Nginx Plus dashboard. This must be within the `server` block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_42\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nstatus_zone weblogic-ssl;\n```\n\n----------------------------------------\n\nTITLE: Deploying with GKE JSON Key Authentication (CLI)\nDESCRIPTION: This command shows how to deploy NGINX Service Mesh from a GKE registry using a JSON key file for authentication. The path to the JSON key file is specified using the `--registry-key` flag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/private-registry.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --registry-server <your-gke-docker-registry> --registry-key </path/to/key.json>\n```\n\n----------------------------------------\n\nTITLE: Log All Requests with Default Format JSON\nDESCRIPTION: This JSON snippet configures the security log to log all requests (both legal and illegal) using the default log format.  The max request size is set to 2k bytes, and the max message size is 32k.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/logging-overview/security-log.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filter\": {\n        \"request_type\": \"all\"\n    },\n    \"content\": {\n        \"format\": \"default\",\n        \"max_request_size\": \"2k\",\n        \"max_message_size\": \"32k\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Setting Up Repository Pinning for NGINX (Shell)\nDESCRIPTION: This command sets up repository pinning to prioritize packages from the nginx.org repository. It defines a set of pinning rules with a high priority (900) to ensure that NGINX packages from the official repository are preferred over distribution-provided ones. Requires sudo privileges to modify the /etc/apt/preferences.d directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-ubuntu.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\necho -e \"Package: *\\nPin: origin nginx.org\\nPin: release o=nginx\\nPin-Priority: 900\\n\" | \\\nsudo tee /etc/apt/preferences.d/99nginx\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Plus packages using repotrack\nDESCRIPTION: This snippet downloads NGINX Plus packages, including all dependencies, using repotrack on Amazon Linux, Oracle Linux, and RHEL. It creates a directory, changes to that directory, and then uses repotrack to download the app-protect-module-plus package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_28\n\nLANGUAGE: script\nCODE:\n```\nsudo mkdir /etc/packages/\ncd /etc/packages/\nsudo repotrack --forcearch x86_64 app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Reloading NGINX Plus Configuration\nDESCRIPTION: This snippet shows the command to reload the NGINX Plus configuration after making changes.  The `nginx -s reload` command ensures that the new configuration is applied without interrupting service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/usage-tracking/agentless-reporting.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Docker Login with JWT\nDESCRIPTION: This command logs into the private Nginx Docker registry using a JSON Web Token (JWT) for authentication. It uses the JWT content as the username and 'none' as the password, as required by the registry's authentication mechanism. The JWT is downloaded from MyF5 and should be copied without any extra characters or spaces to avoid authentication errors. Requires Docker to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/docker/docker-registry-login.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ndocker login private-registry.nginx.com --username=<JWT_CONTENTS> --password=none\n```\n\n----------------------------------------\n\nTITLE: Building NGINX Plus with App Protect Docker Image\nDESCRIPTION: This Dockerfile builds an NGINX Plus image with the App Protect WAF module on Alpine Linux. It utilizes ARG instructions for specifying the Alpine version and RUN instructions with mounts for secure credential access. Key steps include adding the NGINX signing key, configuring package repositories, installing the app-protect-module-plus package, and setting up logging.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-plus/build-alpine.md#_snippet_0\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Supported OS_VER's are 3.16/3.17/3.19\nARG OS_VER=\"3.19\"\n\n# Base image\nFROM alpine:${OS_VER}\n\n# Install NGINX Plus and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/apk/cert.pem,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/apk/cert.key,mode=0644 \\\n    wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub \\\n    && printf \"https://pkgs.nginx.com/plus/alpine/v`egrep -o '^[0-9]+\\.[0-9]+' /etc/alpine-release`/main\\n\" | \\\n       tee -a /etc/apk/repositories \\\n    && printf \"https://pkgs.nginx.com/app-protect-x-plus/alpine/v`egrep -o '^[0-9]+\\.[0-9]+' /etc/alpine-release`/main\\n\" | \\\n       tee -a /etc/apk/repositories \\\n    && apk update \\\n    && apk add app-protect-module-plus \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log \\\n    && rm -rf /var/cache/apk/*\n\n# Expose port\nEXPOSE 80\n\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Port Forward Jaeger Dashboard\nDESCRIPTION: This command uses `kubectl port-forward` to create a local port forwarding to the Jaeger service running in the `nsm-monitoring` namespace. This allows access to the Jaeger dashboard through a local port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/observability.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nkubectl -n nsm-monitoring port-forward svc/jaeger 16686\n```\n\n----------------------------------------\n\nTITLE: Starting Nginx and WAF Services with Docker Compose\nDESCRIPTION: This command starts the Nginx and WAF services using Docker Compose. It reads the configuration from the `docker-compose.yml` file and starts the defined containers in detached mode (`-d`). `sudo` may be required depending on the Docker configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_30\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker compose up -d\n```\n\n----------------------------------------\n\nTITLE: Upstream Queue Size Metric\nDESCRIPTION: Describes the 'plus.upstream.queue.size' metric, which is a gauge representing the current number of queued requests. This metric shows the number of requests waiting to be processed by the upstream servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_15\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, integer\nDescription: Current number of queued requests.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX App Protect WAF v5 Package\nDESCRIPTION: This command installs the NGINX App Protect WAF v5 package using the Alpine package manager (`apk`). The `sudo` command is used to execute the installation with elevated privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-alpine.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apk add app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Example Docker Push Command\nDESCRIPTION: This is an example of pushing a Docker image to a specific registry. It demonstrates how to push the `nms-acm:1.5` image to the `myregistryhost:5000` registry.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/deploy-api-connectivity-manager.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ndocker push nms-acm:1.5 myregistryhost:5000/nms-acm:1.5\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX FIPS module on Alpine\nDESCRIPTION: This shell command installs the nginx-plus-module-fips-check package using the apk package manager on Alpine.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/fips.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-fips-check\n```\n\n----------------------------------------\n\nTITLE: Stopping Keepalived Service to Force State Change (Shell)\nDESCRIPTION: This command stops the Keepalived service on the primary node, triggering a failover to the backup node by sending a VRRP packet with priority 0.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nservice keepalived stop\n```\n\n----------------------------------------\n\nTITLE: Warning message about insecure connection during NGINX Agent installation\nDESCRIPTION: This snippet shows the warning message logged when an insecure connection is used during NGINX Agent installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/agent/installation/install-agent-api.md#_snippet_4\n\nLANGUAGE: text\nCODE:\n```\nWarning: An insecure connection will be used during this nginx-agent installation\n```\n\n----------------------------------------\n\nTITLE: Stopping NGINX Node Shell\nDESCRIPTION: Stops an NGINX node gracefully by sending the 'QUIT' signal. This ensures that the node finishes zone synchronization and closes open connections gracefully before exiting. The `nginx -s quit` command sends the QUIT signal to the Nginx master process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s quit\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Plus Status Configuration File\nDESCRIPTION: This snippet demonstrates how to download the sample status configuration file from the NGINX website. This file is used for setting up the live activity monitoring dashboard in NGINX Plus. It requires `curl` to be installed on the server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_29\n\nLANGUAGE: none\nCODE:\n```\n# cd /etc/nginx/conf.d\n# curl https://www.nginx.com/resource/conf/status.conf > status.conf\n```\n\n----------------------------------------\n\nTITLE: Example: Attack Signature Report Content\nDESCRIPTION: Example content of the generated signature report JSON file.  It contains an array of signatures, each with various attributes such as isUserDefined, attackType, name, hasCve, systems, references, signatureId, signatureType, risk and accuracy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_27\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"signatures\": [\n        {\n            \"isUserDefined\": false,\n            \"attackType\": {\n                \"name\": \"Detection Evasion\"\n            },\n            \"name\": \"Unicode Fullwidth ASCII variant\",\n            \"hasCve\": false,\n            \"systems\": [\n                {\n                    \"name\": \"IIS\"\n                }\n            ],\n            \"references\": [\n                {\n                    \"value\": \"infosecauditor.wordpress.com/2013/05/27/bypassing-asp-net-validaterequest-for-script-injection-attacks/\",\n                    \"type\": \"url\"\n                }\n            ],\n            \"signatureId\": 299999999,\n            \"signatureType\": \"request\",\n            \"risk\": \"low\",\n            \"accuracy\": \"low\"\n        },\n        {\n            \"isUserDefined\": false,\n            \"attackType\": {\n                \"name\": \"Predictable Resource Location\"\n            },\n            \"name\": \"IIS Web Server log dir access (/W3SVC..)\",\n            \"hasCve\": false,\n            \"systems\": [\n                {\n                    \"name\": \"IIS\"\n                }\n            ],\n            \"references\": [\n                {\n                    \"value\": \"www.webappsec.org/projects/threat/classes/predictable_resource_location.shtml\",\n                    \"type\": \"url\"\n                }\n            ],\n            \"signatureId\": 200000001,\n            \"signatureType\": \"request\",\n            \"risk\": \"low\",\n            \"accuracy\": \"high\"\n        },\n        {\n            \"isUserDefined\": false,\n            \"name\": \"WEB-INF dir access (/WEB-INF/)\",\n            \"attackType\": {\n                \"name\": \"Predictable Resource Location\"\n            },\n            \"hasCve\": true,\n            \"systems\": [\n                {\n                    \"name\": \"Java Servlets/JSP\"\n                },\n                {\n                    \"name\": \"Macromedia JRun\"\n                },\n                {\n                    \"name\": \"Jetty\"\n                }\n            ],\n            \"references\": [\n                {\n                    \"value\": \"www.webappsec.org/projects/threat/classes/predictable_resource_location.shtml\",\n                    \"type\": \"url\"\n                },\n                {\n                    \"value\": \"CVE-2016-4800\",\n                    \"type\": \"cve\"\n                },\n                {\n                    \"value\": \"CVE-2007-6672\",\n                    \"type\": \"cve\"\n                }\n            ],\n            \"signatureType\": \"request\",\n            \"risk\": \"low\",\n            \"signatureId\": 200000018\n        }\n    ],\n    \"revisionDatetime\": \"2019-07-16T12:21:31Z\"\n}\n```\n\n----------------------------------------\n\nTITLE: Update Proxy with OAuth2 Hostname - JSON\nDESCRIPTION: This JSON payload configures the proxy with a new introspection endpoint that requires hostname resolution, specifically `https://hosted.idp.com:8080/realms/nginx/protocol/openid-connect/token/introspect`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_43\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"test-proxy\",\n   \"version\": \"v1\",\n   \"proxyConfig\": {\n      \"hostname\": \"data-host\",\n      \"ingress\": {\n         \"basePath\": \"/\",\n         \"basePathVersionAppendRule\": \"NONE\"\n      },\n      \"backends\": [\n         {\n            \"serviceName\": \"backend-echo-svc\",\n            \"serviceTargets\": [\n               {\n                  \"hostname\": \"192.0.2.4\",\n                  \"listener\": {\n                     \"enableTLS\": false,\n                     \"port\": 10000,\n                     \"transportProtocol\": \"HTTP\"\n                  }\n               }\n            ]\n         }\n      ],\n      \"policies\": {\n         \"oauth2-introspection\": [\n            {\n               \"action\": {\n                  \"introspectionEndpoint\": \"https://hosted.idp.com:8080/realms/nginx/protocol/openid-connect/token/introspect\",\n                  \"introspectionResponse\": \"application/json\"\n\n               },\n               \"data\": [\n                  {\n                     \"clientAppID\": \"nginx-plus\",\n                     \"clientSecret\": \"<client secret>\"\n                  }\n               ]\n            }\n         ]\n      }\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Remove Previous NGINX Plus Repo (Shell)\nDESCRIPTION: This command removes any previously downloaded NGINX Plus repository files from the `/etc/yum.repos.d` directory. This ensures that the system uses the correct repository definition during the installation of NGINX App Protect WAF.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo rm /etc/yum.repos.d/nginx-plus-*.repo\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX FIPS module on FreeBSD\nDESCRIPTION: This shell command sequence updates the package list and installs the nginx-plus-module-fips-check package using the pkg package manager on FreeBSD.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/fips.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-fips-check\n```\n\n----------------------------------------\n\nTITLE: NGINX Policy Configuration with Signature Staging in JSON\nDESCRIPTION: This JSON snippet demonstrates the configuration of an Nginx policy, including the `stagingCertificationDatetime` property within the `signature-settings`. It shows how to specify a date and time for determining which signatures should be considered in staging mode. The `performStaging` property must be set to `true` for `stagingCertificationDatetime` to take effect. Absence of `stagingCertificationDatetime` means that all signatures are placed in staging environment if `performStaging` is true.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/time-based-sig-config.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n     \"policy\" : {\n        \"applicationLanguage\" : \"utf-8\",\n        \"description\" : \"Nginx Policy\",\n        \"enforcementMode\" : \"blocking\",\n        \"fullPath\" : \"/Common/my_test_nginx_policy\",\n        \"name\" : \"my_test_nginx_policy\",\n        \"performStaging\" : true,\n        \"signature-settings\" : {\n           \"stagingCertificationDatetime\": \"2023-06-13T14:53:24Z\",\n           \"signatureStaging\": true\n        },\n        \"template\" : {\n           \"name\" : \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"type\" : \"security\"\n    }\n   }\n```\n\n----------------------------------------\n\nTITLE: Update Proxy with Token in Query - JSON\nDESCRIPTION: This JSON snippet shows the request body for the update request to configure the proxy. It sets the `clientTokenSuppliedIn` parameter to `QUERY` to signify that the token will be passed in the query parameters and sets `clientTokenName` to `queryAuthz`. This will instruct NGINX to expect the token in the `queryAuthz` parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_35\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"test-proxy\",\n   \"version\": \"v1\",\n   \"proxyConfig\": {\n      \"hostname\": \"data-host\",\n      \"ingress\": {\n         \"basePath\": \"/\",\n         \"basePathVersionAppendRule\": \"NONE\"\n      },\n      \"backends\": [\n         {\n            \"serviceName\": \"backend-echo-svc\",\n            \"serviceTargets\": [\n               {\n                  \"hostname\": \"192.0.2.4\",\n                  \"listener\": {\n                     \"enableTLS\": false,\n                     \"port\": 10000,\n                     \"transportProtocol\": \"HTTP\"\n                  }\n               }\n            ]\n         }\n      ],\n      \"policies\": {\n         \"oauth2-introspection\": [\n            {\n               \"action\": {\n                  \"introspectionEndpoint\": \"http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect\",\n                        \"clientTokenSuppliedIn\": \"QUERY\",\n                        \"clientTokenName\": \"queryAuthz\"\n               },\n               \"data\": [\n                  {\n                     \"clientAppID\": \"nginx-plus\",\n                     \"clientSecret\": \"<client secret>\"\n                  }\n               ]\n            }\n         ]\n      }\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Example values.yaml for NGINX Instance Manager 2.18 or Lower\nDESCRIPTION: This YAML example shows a `values.yaml` file for configuring NGINX Instance Manager deployment with specific image repositories and tags. It includes settings for `imagePullSecrets` and individual component images such as `apigw`, `core`, `dpm`, `ingestion`, `integrations`, and `utility`.  This file customizes the Helm chart to use specific image versions and private registries.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_19\n\nLANGUAGE: yaml\nCODE:\n```\nnms-hybrid:\n    imagePullSecrets:\n        - name: regcred\n    apigw:\n        image:\n            repository: private-registry.nginx.com/nms/apigw\n            tag: <version>\n    core:\n        image:\n            repository: private-registry.nginx.com/nms/core\n            tag: <version>\n    dpm:\n        image:\n            repository: private-registry.nginx.com/nms/dpm\n            tag: <version>\n    ingestion:\n        image:\n            repository: private-registry.nginx.com/nms/ingestion\n            tag: <version>\n    integrations:\n        image:\n            repository: private-registry.nginx.com/nms/integrations\n            tag: <version>\n    utility:\n        image:\n            repository: private-registry.nginx.com/nms/utility\n            tag: <version>\n```\n\n----------------------------------------\n\nTITLE: Configure Autodiscover Authentication PowerShell\nDESCRIPTION: This command configures the authentication methods for the Autodiscover virtual directory using the Set-AutodiscoverVirtualDirectory cmdlet in PowerShell. It disables several authentication methods and enables Basic authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_7\n\nLANGUAGE: PowerShell\nCODE:\n```\nC:\\> Set-AutodiscoverVirtualDirectory\n-LiveIdNegotiateAuthentication 0\n-WSSecurityAuthentication 0 -LiveIdBasicAuthentication 0\n-BasicAuthentication 1 -DigestAuthentication 0\n-WindowsAuthentication 0 -OAuthAuthentication 0\n-AdfsAuthentication 0\n```\n\n----------------------------------------\n\nTITLE: Create Tarball of Logs\nDESCRIPTION: Creates a compressed tarball archive of the current directory, typically containing collected logs and configuration files, which can then be attached to a support ticket.  Run this command in the directory containing all log data and relevant configuration files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/troubleshooting-guide/troubleshooting.md#_snippet_6\n\nLANGUAGE: Shell\nCODE:\n```\ntar cvfz logs.tgz .\n```\n\n----------------------------------------\n\nTITLE: Generate Certificates using OpenSSL script\nDESCRIPTION: This script generates certificates for a Certificate Authority (CA), an intermediate CA, an NGINX Manager server, and an agent. It uses OpenSSL commands to create keys, certificate signing requests (CSRs), and certificates, configuring them for specific purposes such as server authentication and client authentication. The script creates a self-signed root CA, then an intermediate CA signed by the root CA, a server certificate signed by the intermediate CA, and an agent certificate signed by the root CA.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n#!/bin/bash\nset -e\n\nmake_ca() {\n    echo \"Creating Self-Signed Root CA certificate and key\"\n    openssl req \\\n        -new \\\n        -nodes \\\n        -x509 \\\n        -keyout ca.key \\\n        -out ca.crt \\\n        -config ca.cnf \\\n        -extensions v3_req \\\n        -days 1826  # 5 years\n}\n\nmake_int() {\n    echo \"Creating Intermediate CA certificate and key\"\n    openssl req \\\n        -new \\\n        -nodes \\\n        -keyout ca_int.key \\\n        -out ca_int.csr \\\n        -config ca-intermediate.cnf \\\n        -extensions v3_req\n    openssl req -in ca_int.csr -noout -verify\n    openssl x509 \\\n        -req \\\n        -CA ca.crt \\\n        -CAkey ca.key \\\n        -CAcreateserial \\\n        -in ca_int.csr \\\n        -out ca_int.crt \\\n        -extfile ca-intermediate.cnf \\\n        -extensions v3_req \\\n        -days 365 # 1 year\n    openssl verify -CAfile ca.crt ca_int.crt\n    echo \"Creating CA chain\"\n    cat ca_int.crt ca.crt > ca.pem\n}\n\nmake_server() {\n    echo \"Creating nginx-manager certificate and key\"\n    openssl req \\\n        -new \\\n        -nodes \\\n        -keyout server.key \\\n        -out server.csr \\\n        -config server.cnf\n    openssl req -in server.csr -noout -verify\n    openssl x509 \\\n        -req \\\n        -CA ca_int.crt \\\n        -CAkey ca_int.key \\\n        -CAcreateserial \\\n        -in server.csr \\\n        -out server.crt \\\n        -extfile server.cnf \\\n        -extensions v3_req \\\n        -days 365 # 1 year\n    openssl verify -CAfile ca.pem server.crt\n}\n\nmake_agent() {\n    echo \"Creating Agent certificate and key\"\n    openssl req \\\n        -new \\\n        -nodes \\\n        -keyout agent.key \\\n        -out agent.csr \\\n        -config agent.cnf\n    openssl req -in agent.csr -noout -verify\n    openssl x509 \\\n        -req \\\n        -CA ca.crt \\\n        -CAkey ca.key \\\n        -CAcreateserial \\\n        -in agent.csr \\\n        -out agent.crt \\\n        -extfile agent.cnf \\\n        -extensions v3_req \\\n        -days 365 # 1 year\n    openssl verify -CAfile ca.pem agent.crt\n}\n\n# MAIN\nmake_ca\nmake_int\nmake_server\nmake_agent\n```\n\n----------------------------------------\n\nTITLE: Resource Name Label for NGINX Ingress Controller Deployment (YAML)\nDESCRIPTION: This YAML snippet shows how to add a label to the NGINX Ingress Controller Deployment's Pod spec to associate metrics with the deployment resource.  The `nsm.nginx.com/deployment` label allows Prometheus to identify the Deployment that created the Pod, enabling more granular metrics analysis.  The value should be replaced with the actual name of the NGINX Ingress Controller Deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_12\n\nLANGUAGE: yaml\nCODE:\n```\nnsm.nginx.com/deployment: <name of NGINX Ingress Controller Deployment>\n```\n\n----------------------------------------\n\nTITLE: Downloading the NGINX Diagnostic Package Script\nDESCRIPTION: This command downloads the `nginx-supportpkg.sh` script from the nginx.org website. This script is used to collect diagnostic information for troubleshooting NGINX issues.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/diagnostic-package.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nwget https://nginx.org/download/nginx-supportpkg.sh\n```\n\n----------------------------------------\n\nTITLE: Modify Resource Group JSON Request - NGINX Instance Manager\nDESCRIPTION: This JSON payload is used to add a resource to an existing resource group via the NGINX Instance Manager REST API. It includes the module, name, object, and UID of the resource to be added. This example adds a single instance named 'new-instance'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/rbac/manage-resource-groups.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"module\": \"Instance Manager\",\n  \"name\": \"new-instance\",\n  \"object\": \"Systems\",\n  \"uid\": \"1a2b3c4d-5678-90ef-ghij-klmnopqrst\"\n}\n```\n\n----------------------------------------\n\nTITLE: Running NGINX Management Suite Support Script (Bash)\nDESCRIPTION: This snippet shows how to execute the support script for troubleshooting NGINX Management Suite host issues. The script gathers system information, NGINX configurations, logs, and API call outputs to aid in diagnosing problems. The script must be executed via SSH connection to the NGINX Management Suite host.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/support/contact-support.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n/usr/share/nginx-manager/support.sh\n```\n\n----------------------------------------\n\nTITLE: User-Defined Signature Structure JSON\nDESCRIPTION: Defines the structure of a single user-defined signature. This includes the signature's name, description, Snort-style rule, signature type (request or response), attack type, affected systems, risk level, and accuracy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/user-defined-signatures.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"unique_name\",\n    \"description\": \"Add your description here\",\n    \"rule\": \"content:\\\"string\\\"; nocase;\",\n    \"signatureType\": \"request\",\n    \"attackType\": {\n        \"name\": \"Buffer Overflow\"\n    },\n    \"systems\": [\n        {\n            \"name\": \"Microsoft Windows\"\n        },\n        {\n            \"name\": \"Unix/Linux\"\n        }\n    ],\n    \"risk\": \"medium\",\n    \"accuracy\": \"medium\"\n}\n```\n\n----------------------------------------\n\nTITLE: Deploying with Username/Password Authentication (CLI)\nDESCRIPTION: This command demonstrates how to deploy NGINX Service Mesh from a private registry using a username and password for authentication.  The registry server, username, and password are provided as command-line arguments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/private-registry.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --registry-server <your-docker-registry> --registry-username <your-username> --registry-password <your-password>\n```\n\n----------------------------------------\n\nTITLE: Install Headers-More Module on Amazon Linux 2, CentOS, Oracle Linux, RHEL\nDESCRIPTION: This shell script updates the package repositories and installs the `nginx-plus-module-headers-more` package using yum. It is specific to Amazon Linux 2, CentOS, Oracle Linux, and RHEL operating systems. It assumes that the user has sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/headers-more.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-headers-more\n```\n\n----------------------------------------\n\nTITLE: Querying Metrics API with Full Time Window\nDESCRIPTION: This curl command queries the Metrics API with a fully defined time window using both `startTime` and `endTime` parameters. It retrieves metrics for the specified time range.  The API returns metric values for `nginx.http.request.count` between the defined start and end times and requires a valid access token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/metrics?names=nginx.http.request.count&startTime=now-5h&endTime=2020-07-01T09:00:00Z\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Retrieving Security Violation Events (curl)\nDESCRIPTION: This query retrieves all security violation events. It uses the `category` filter to specifically target security violation events, providing a list of all identified violations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/view-app-security-analytics.md#_snippet_2\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation')\n```\n\n----------------------------------------\n\nTITLE: Defining Okta OIDC Provider in NGINX\nDESCRIPTION: This snippet defines the Okta OIDC provider within the NGINX `http` block using the `oidc_provider` context.  This is the starting point for configuring OpenID Connect authentication with Okta. No client ID or secrets are configured here, just the skeleton `oidc_provider` definition.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/okta.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider okta {\n\n        # ...\n\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: gRPC Server Stream Definition (protobuf)\nDESCRIPTION: Defines a gRPC service method where the client sends a single `HelloRequest` message to the server and receives a stream of `HelloResponse` messages in return. This example uses the protobuf syntax to define the service interface.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/how-to/bidirectional-configuration.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nrpc LotsOfReplies(HelloRequest) returns (stream HelloResponse);\n```\n\n----------------------------------------\n\nTITLE: Check App Protect Installation (RPM)\nDESCRIPTION: This command checks if NGINX App Protect WAF is installed on RPM-based systems. It's used to verify that App Protect WAF and the WAF compiler are not running on the same host.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_30\n\nLANGUAGE: shell\nCODE:\n```\nrpm -qi | grep app-protect\n```\n\n----------------------------------------\n\nTITLE: Generating a Private Key with OpenSSL\nDESCRIPTION: This command generates a 2048-bit RSA private key using OpenSSL and saves it to the specified file. It's a crucial step in creating a certificate request. The private key should be backed up securely.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl genrsa -out ~/example.com.key 2048\n```\n\n----------------------------------------\n\nTITLE: Pass OIDC Claims as Headers in NGINX\nDESCRIPTION: This snippet configures Nginx to pass OIDC claims (email, name, sub) extracted from the ID token received from Auth0 as HTTP headers to the upstream application.  This allows the application to access the authenticated user's information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/auth0.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc auth0;\n\n     proxy_set_header sub   $oidc_claim_sub;\n     proxy_set_header email $oidc_claim_email;\n     proxy_set_header name  $oidc_claim_name;\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Moving NGINX Signing Key to APK Storage\nDESCRIPTION: This command moves the downloaded NGINX signing key from the /tmp directory to the apk trusted keys storage directory. This allows apk to use the key to verify the NGINX Agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_26\n\nLANGUAGE: shell\nCODE:\n```\nsudo mv /tmp/nginx_signing.rsa.pub /etc/apk/keys/\n```\n\n----------------------------------------\n\nTITLE: Add SecurityContextConstraint to ServiceAccount (OpenShift)\nDESCRIPTION: Adds the `nginx-ingress-permissions` SecurityContextConstraint to the ServiceAccount of the NGINX Plus Ingress Controller. This grants the necessary permissions for the Ingress Controller to operate within OpenShift. The command uses the `oc` command-line tool.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\noc adm policy add-scc-to-user nginx-ingress-permissions -z nginx-ingress -n nginx-ingress\n```\n\n----------------------------------------\n\nTITLE: Restart Nginx Web Server\nDESCRIPTION: This command restarts the Nginx web server using `systemctl`. This is necessary to apply any configuration changes made during the API Connectivity Manager installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm-offline.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Setting permissions for the core dump directory\nDESCRIPTION: Sets the ownership and permissions for the `/tmp/cores` directory to allow NGINX worker process to write core dump files. Setting sticky bit prevents users from deleting files owned by other users.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\nsudo chown root:root /tmp/cores\nsudo chmod 1777 /tmp/cores\n```\n\n----------------------------------------\n\nTITLE: Verify Headers application deployment - Shell\nDESCRIPTION: Verifies that the header application's pod and service were created. Useful for confirming successful deployment before configuring routing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get pods,svc\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Amplify Agent Service (Bash)\nDESCRIPTION: Restarts the NGINX Amplify Agent service using the `service` command. It assumes the `amplify-agent` service is managed by systemd or a similar service manager. Restarting involves stopping and then starting the service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_18\n\nLANGUAGE: bash\nCODE:\n```\nservice amplify-agent restart\n```\n\n----------------------------------------\n\nTITLE: Expose Port 80 in Dockerfile\nDESCRIPTION: This snippet exposes port 80 within the Docker container.  This makes the Nginx server accessible from the host machine or other containers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-plus/build-debian.md#_snippet_1\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# Expose port\nEXPOSE 80\n```\n\n----------------------------------------\n\nTITLE: Create Local Backup Directory (Bash)\nDESCRIPTION: Creates a directory named `local_backups` within the current working directory (`/opt/nginx-controller`). This directory is used to store a copy of the backup file when restoring from an NFS volume.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-embedded-config-db.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nmkdir local_backups\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration\nDESCRIPTION: This snippet demonstrates the command to reload the NGINX configuration after making changes. This applies the updated configuration without requiring a full restart of the NGINX service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/set-misc.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Authenticate with NGINX Controller API\nDESCRIPTION: This snippet demonstrates how to authenticate with the NGINX Controller API to obtain a session cookie using a POST request to the login endpoint. The session cookie is then used to check the session status with a GET request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/get-n-plus-cert-and-key.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ncurl -c cookie.txt -X POST --url 'https://<ip address>/api/v1/platform/login' --header 'Content-Type: application/json' --data '{\"credentials\": {\"type\": \"BASIC\",\"username\": \"<username>\",\"password\": \"<password>\"}}'\n```\n\nLANGUAGE: bash\nCODE:\n```\ncurl -b cookie.txt -c cookie.txt -X GET --url 'https://<ip address>/api/v1/platform/login'\n```\n\n----------------------------------------\n\nTITLE: Example Docker Tag Command\nDESCRIPTION: This is an example of tagging a Docker image with a specific version and registry. It demonstrates how to tag the `nms-acm:1.5` image to be pushed to the `myregistryhost:5000` registry.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/deploy-api-connectivity-manager.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ndocker tag nms-acm:1.5 myregistryhost:5000/nms-acm:1.5\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Instance Manager on Ubuntu (Plus)\nDESCRIPTION: This command executes the `install-nim-bundle.sh` script to install NGINX Instance Manager on Ubuntu 24.04 using the latest version of NGINX Plus.  The command explicitly specifies the paths to the Nginx certificate and key files, the Nginx Plus version, the OS distribution, and the path to the JWT license file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo bash install-nim-bundle.sh -c /path/to/nginx-repo.crt -k /path/to/nginx-repo.key -p latest -d ubuntu24.04 -j /path/to/license.jwt\n```\n\n----------------------------------------\n\nTITLE: Install zypper prerequisites for Nginx Agent on SLES\nDESCRIPTION: This command installs the necessary packages for managing repositories and verifying package authenticity on SLES systems, in preparation for installing the Nginx Agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper install curl ca-certificates gpg2 gawk\n```\n\n----------------------------------------\n\nTITLE: Running install-nim-bundle.sh script\nDESCRIPTION: This shell command runs the `install-nim-bundle.sh` script to download necessary packages for installing NGINX Instance Manager in a disconnected environment. It requires specifying the paths to the SSL certificate and private key, setting the installation mode to `offline`, specifying the distribution and NGINX Instance Manager version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide.md#_snippet_0\n\nLANGUAGE: Shell Script\nCODE:\n```\nsudo bash install-nim-bundle.sh \\\n  -c <path/to/certificate.crt> \\\n  -k <path/to/private.key> \\\n  -m offline \\\n  -d <distribution> \\\n  -v <version>\n```\n\n----------------------------------------\n\nTITLE: RateLimit v1alpha1 YAML Configuration (Multiple Sources)\nDESCRIPTION: Illustrates how to configure rate limiting for multiple sources to a single destination service. The rate is evenly divided amongst the specified sources.  This example defines a destination named `destService` and limits requests from `source1` and `source2`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/v1alpha1-ratelimit.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\ndestination:\n  name: destService\nsources:\n- name: source1\n- name: source2\nrate: 100 r/m\n```\n\n----------------------------------------\n\nTITLE: List Resources Associated with NGINX Service Mesh\nDESCRIPTION: This command lists all Kubernetes resources associated with the NGINX Service Mesh present in the cluster. It uses `kubectl api-resources` to get a list of all resource types, then pipes that to `kubectl get` with a label selector to find resources labeled with `app.kubernetes.io/part-of=nginx-service-mesh` in all namespaces.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/uninstall/uninstall-with-helm.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nkubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get --show-kind --ignore-not-found -l app.kubernetes.io/part-of=nginx-service-mesh -A\n```\n\n----------------------------------------\n\nTITLE: Send Request to Tea (Shell)\nDESCRIPTION: This command uses `curl` to send an HTTP request to the `tea` application, similar to the coffee request. It resolves the `cafe.example.com` hostname to the NGINX Gateway Fabric's IP address and port specified by the `GW_IP` and `GW_PORT` environment variables. The request is sent to the `/tea` path.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/tea\n```\n\n----------------------------------------\n\nTITLE: OCSP Validation of Client Certificates\nDESCRIPTION: This snippet demonstrates enabling OCSP validation of SSL client certificates in Nginx. It sets `ssl_verify_client` to `on`, specifies a trusted certificate, and enables OCSP validation with `ssl_ocsp on`.  The `$ssl_client_verify` variable will then contain the results of the client certificate validation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 443 ssl;\n\n    ssl_certificate     /etc/ssl/foo.example.com.crt;\n    ssl_certificate_key /etc/ssl/foo.example.com.key;\n\n    ssl_verify_client       on;\n    ssl_trusted_certificate /etc/ssl/cachain.pem;\n    ssl_ocsp                on; # Enable OCSP validation\n\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX Controller\nDESCRIPTION: This bash command executes the uninstall script for NGINX Controller.  It's used before adding a node back to the cluster after it has been previously deleted.  It removes the existing installation to ensure a clean setup.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/manage-cluster.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/uninstall.sh\n```\n\n----------------------------------------\n\nTITLE: Configuring WebSocket Monitor URI in NGINX\nDESCRIPTION: This snippet demonstrates configuring the monitor URI for a WebSocket service using the `app_protect_dos_monitor` directive. It involves setting up WebSocket proxy settings and specifying the protocol as websocket. The monitor URI specifies the endpoint used for monitoring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nlisten 80;\nserver_name wsserv;\n\nlocation /app/ {\n    # WebSocket configuration required by NGINX\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"Upgrade\";\n    proxy_set_header Host $host;\n\n    # Protected Object is defined here\n    app_protect_dos_monitor uri=http://wsserv:80/app/ protocol=websocket;\n}\n```\n\n----------------------------------------\n\nTITLE: Downloading Load Balancer Nginx Configuration via Wget\nDESCRIPTION: This shell script navigates to the Nginx configuration directory and uses the wget command to download a specific Nginx configuration file (gce-all-active-lb.conf) for the load balancer from a remote GitHub repository.  The downloaded configuration file is saved locally with the same name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_7\n\nLANGUAGE: none\nCODE:\n```\ncd /etc/nginx/conf.d/\nwget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-lb.conf\n```\n\n----------------------------------------\n\nTITLE: Configure PostgreSQL HBA (CentOS, RHEL, RPM-based)\nDESCRIPTION: Configures the PostgreSQL host-based authentication (HBA) file on CentOS, RHEL, or RPM-based systems. It uses `cat` and `tee` to write the configuration to `/var/lib/pgsql/data/pg_hba.conf`, allowing local connections and IPv4/IPv6 connections with md5 authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncat << EOF | sudo tee /var/lib/pgsql/data/pg_hba.conf\n\n# TYPE DATABASE USER ADDRESS METHOD\n\nlocal all postgres peer\nlocal all all md5\n# IPv4 local connections:\nhost all all 127.0.0.1/32 md5\n# IPv6 local connections:\nhost all all ::1/128 md5\nEOF\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration (mTLS)\nDESCRIPTION: Reloads the Nginx configuration to apply the mTLS settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Install GeoIP Module on SLES\nDESCRIPTION: This shell command refreshes the package manager and installs the nginx-plus-module-geoip package using zypper. It's specific to SLES.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-geoip\n```\n\n----------------------------------------\n\nTITLE: Disable App Protect WAF for DoS API Location (nginx)\nDESCRIPTION: This configuration snippet disables NGINX App Protect WAF for the location of the DoS Live Activity Monitoring API. This ensures that the DoS API can function correctly without interference from the WAF.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-4.2.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /api {\n    app_protect_enable off;\n    app_protect_dos_api;\n}\n```\n\n----------------------------------------\n\nTITLE: Run NGINX Agent Docker Container with REST API\nDESCRIPTION: Runs the NGINX Agent Docker container with the updated `nginx-agent.conf` mounted and port 8038 exposed. This allows access to the NGINX Agent's REST API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_10\n\nLANGUAGE: console\nCODE:\n```\ndocker run --name nginx-agent -d \\\n  --mount type=bind,source=\"$(pwd)\"/nginx-agent.conf,target=/etc/nginx-agent/nginx-agent.conf,readonly \\\n  -p 127.0.0.1:8038:8038/tcp \\\n  nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Create vSphere Integration with NGINX Controller API (JSON)\nDESCRIPTION: This JSON payload is used to create a vSphere Integration within NGINX Controller using the Integrations API endpoint.  It defines the connection details (hostname, username, and password) for the vSphere instance, which allows NGINX Controller to manage NGINX instances deployed on vSphere. Replace xx.xx.xx.xx, vsphereUser and ***** with your actual vSphere hostname or IP, username and password respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/add-vsphere-instance.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"my-v-integration\"\n    },\n    \"desiredState\": {\n        \"type\": \"VSPHERE_INTEGRATION\",\n        \"hostname\": \"xx.xx.xx.xx\",\n        \"credential\": {\n            \"type\": \"USER_PASS\",\n            \"username\": \"vsphereUser\",\n            \"password\": \"*****\"\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Expected output after testing Nginx configuration\nDESCRIPTION: This snippet shows the expected output after running `nginx -t`, indicating that the configuration file is syntactically correct and the configuration test was successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginx-waf.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: ConfigMap for Proxy Protocol\nDESCRIPTION: This YAML snippet configures the Nginx Ingress Controller to use the PROXY protocol by setting `proxy-protocol` to `True`, specifying `proxy_protocol` as the `real-ip-header`, and allowing real IPs from all sources (`0.0.0.0/0`).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_6\n\nLANGUAGE: YAML\nCODE:\n```\nproxy-protocol: \"True\"\nreal-ip-header: \"proxy_protocol\"\nset-real-ip-from: \"0.0.0.0/0\"\n```\n\n----------------------------------------\n\nTITLE: Apply SecurityContextConstraint (OpenShift)\nDESCRIPTION: Applies the `nginx-ingress-permissions` SecurityContextConstraint using kubectl. This is necessary for running NGINX Ingress Controller in an OpenShift environment. Requires the `nic-scc.yaml` file to be present in the current directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f nic-scc.yaml\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Public Key (Ubuntu/Debian - Bash)\nDESCRIPTION: Adds the NGINX public key to the system's trusted keys, enabling verification of packages from the NGINX repository. It uses `curl` and `apt-key` to retrieve and add the key. The key is required for installing Nginx Amplify Agent on Debian based systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncurl -fs https://nginx.org/keys/nginx_signing.key | apt-key add -\n```\n\n----------------------------------------\n\nTITLE: gRPC health check configuration in Nginx\nDESCRIPTION: Enables health checks for gRPC services that support the health checking protocol. The `type=grpc` parameter specifies that the gRPC health checking protocol should be used. `mandatory` ensures traffic isn't sent until the instance passes the health check.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/grpc-health-check.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    grpc_pass    grpc://grpc_backend;\n    health_check mandatory type=grpc;\n}\n```\n\n----------------------------------------\n\nTITLE: Reloading NGINX Configuration\nDESCRIPTION: This shell command reloads the Nginx configuration. This is used to apply changes made to the configuration file without restarting the Nginx server. Requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/http-substitutions-filter.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Add Developer Portal to API Proxy using JSON\nDESCRIPTION: This JSON configuration adds the Developer Portal to an existing API Proxy.  It defines the API proxy's name, spec reference, version, proxy configuration (hostname, ingress, backends), and portal configuration (hostname).  The hostname in `portalConfig` is used to connect the Dev Portal Proxy to the Developer Portal. Variables like `{{proxyName}}`, `{{environmentHostname}}`, and `{{portalClusterHostname}}` need to be replaced with actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/publish-api-proxy.md#_snippet_9\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"{{proxyName}}\",\n    \"specRef\": \"petstore-1\",\n    \"version\": \"v1\",\n    \"proxyConfig\": {\n        \"hostname\": \"{{environmentHostname}}\",\n        \"ingress\": {\n            \"basePath\": \"/v1\"\n        },\n        \"backends\": [\n            {\n                \"serviceName\": \"petstore-api-svc\",\n                \"serviceTargets\": [\n                    {\n                        \"hostname\": \"petstore.example.com\"\n                    }\n                ]\n            }\n        ]\n    },\n    \"portalConfig\": {\n        \"hostname\": \"{{portalClusterHostname}}\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Loading Nginx JavaScript Module\nDESCRIPTION: This directive loads the NGINX JavaScript module. It must be included in the top-level (\"main\") configuration context in /etc/nginx/nginx.conf. This module is required for handling the interaction between NGINX Plus and the IdP.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/active-directory-federation-services.md#_snippet_2\n\nLANGUAGE: Nginx\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\n```\n\n----------------------------------------\n\nTITLE: Modify RateLimit to include config-v1-path\nDESCRIPTION: This YAML configuration modifies the RateLimit resource 'ratelimit-v1' to include both the 'get-only' and 'config-v1-path' matches from the 'hrg' HTTPRouteGroup. This results in requests being rate-limited if they are either GET requests or requests to the '/configuration-v1' path.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_14\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi.nginx.com/v1alpha2\nkind: RateLimit\nmetadata:\n   name: ratelimit-v1\n   namespace: default\nspec:\n   destination:\n     kind: Service\n     name: dest-svc\n     namespace: default\n   sources:\n   - kind: Deployment\n     name: client-v1\n     namespace: default\n   - kind: Deployment\n     name: client-v2\n     namespace: default\n   name: 10rm\n   rate: 10r/m\n   rules:\n   - kind: HTTPRouteGroup\n     name: hrg\n     matches:\n     - get-only\n     - config-v1-path\n```\n\n----------------------------------------\n\nTITLE: Update Database Settings with helper.sh (Bash)\nDESCRIPTION: This command updates the external config database settings for NGINX Controller using the `helper.sh` script. It sets the database address, port, username, password, SSL setting, CA certificate path, certificate path, and key path. Requires address and port. Username, password, ssl, ca, cert, and key are optional.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh configdb <address> <port> [username] [password] [ssl] [ca] [cert] [key]\n```\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh configdb 192.0.2.1 5432 user1 <password> false\n```\n\n----------------------------------------\n\nTITLE: Set PIDFile Location (Nginx)\nDESCRIPTION: This snippet shows how to set the PIDfile location for Nginx in the systemd service file when running as a non-root user on CentOS/RHEL. This ensures correct operation when running with limited privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-agent-non-root.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\n[Service]\nPIDFile=/var/tmp/nginx.pid\n```\n\n----------------------------------------\n\nTITLE: Configure Health Check for Outlook Anywhere Nginx\nDESCRIPTION: This code snippet defines a `match` block to check for HTTP Basic authentication and a `location` block to configure a health check for Outlook Anywhere clients. It directs RPC traffic away from servers that don't have HTTP Basic authentication enabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_51\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nmatch exchange-auth {\n    status 401;\n    header WWW-Authenticate ~ Basic;\n}\n\n# In the 'server' block for HTTPS traffic\nlocation /rpc/rpcproxy.dll {\n    proxy_pass https://exchange-rpc;\n    proxy_buffering off;\n    proxy_request_buffering off;\n    proxy_http_version 1.1;\n    proxy_set_header Connection \"Keep-Alive\";\n    health_check uri=/rpc/rpcproxy.dll interval=3s\n                 match=exchange-auth;\n}\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX Plus Repository (Debian)\nDESCRIPTION: This shell command adds the NGINX Plus repository to the system's apt sources.  It uses `printf` to generate the repository entry, pipes it to `sudo tee` to write the entry to the `/etc/apt/sources.list.d/nginx-plus.list` file.  It requires `lsb_release` and `sudo` to be available.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-debian.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\nhttps://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\\n\" | \\\nsudo tee /etc/apt/sources.list.d/nginx-plus.list\n```\n\n----------------------------------------\n\nTITLE: Security Policy Configuration with Override Rule (JSON)\nDESCRIPTION: This JSON snippet represents a security policy configuration with an override rule. The policy, named 'override_rule_example', is based on a template and initially set to 'blocking' mode. The override rule 'myFirstRule' changes the enforcement mode to 'transparent' when the request originates from Israel ('IL'). The 'customXffHeaders' and 'trustXff' parameters configure the handling of custom XFF headers for cross-origin requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/geolocation-override-rules.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"override_rule_example\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"enforcementMode\": \"blocking\",\n        \"general\": {\n             \"customXffHeaders\": [\"xff\"],\n             \"trustXff\": true\n         },\n         \"override-rules\": [\n            {\n                \"name\": \"myFirstRule\",\n                \"condition\": \"geolocation == 'IL'\",\n                \"actionType\": \"extend-policy\",\n                \"override\": {\n                    \"policy\": {\n                        \"enforcementMode\": \"transparent\"\n                    }\n                }\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Check Deployment Result by ID (GET) - Shell\nDESCRIPTION: This code snippet shows how to check the result of a publication using the deployment ID in a GET request. This deployment ID is generated when using the Publish API. Requires `curl`, a valid access token, and the deployment ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_28\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET \"https://{{NIM_FQDN}}/api/platform/v1/systems/instances/deployments/<deployment-id>\" \\\n    -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Configure API Gateway Image - YAML\nDESCRIPTION: This YAML snippet shows how to configure the Helm chart's `values.yaml` file to pull the NGINX Plus API Gateway image from a private Docker registry.  The `imagePullSecrets` field specifies a secret (`regcred`) used for authentication. The `apigw.image` settings point to the repository and tag of the custom-built image.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/frequently-used-helm-configs.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\n# values.yaml\nnms-hybrid:\n    imagePullSecrets:\n        - name: regcred\n    apigw:\n        image:\n            repository: <my-docker-registry>/nms-apigw-plus\n            tag: <version>\n```\n\n----------------------------------------\n\nTITLE: Sort Events by Timestamp and ID (curl)\nDESCRIPTION: This example shows how to sort events using the `orderBy` query parameter. The events are sorted by timestamp in descending order and then by ID in ascending order. Replace `<NMS_FQDN>` and `<access token>` accordingly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"https://<NMS_FQDN>/api/platform/v1/analytics/events?orderBy=timestamp DESC,id\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Configure JWT Violations in NGINX App Protect WAF\nDESCRIPTION: This JSON snippet configures JWT-specific violations in NGINX App Protect WAF's blocking settings.  It shows how to set alarm and block parameters for `VIOL_ACCESS_INVALID`, `VIOL_ACCESS_MISSING`, and `VIOL_ACCESS_MALFORMED`. The snippet requires NGINX App Protect WAF and a valid policy template. The expected output is that the WAF will alarm and/or block requests based on the configuration of these violations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/json-web-tokens-violations.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"jwt_policy\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"blocking-settings\": {\n           \"violations\": [\n            {\n               \"alarm\": true,\n               \"block\": false,\n               \"name\": \"VIOL_ACCESS_INVALID\"\n            },\n            {\n               \"alarm\": true,\n               \"block\": false,\n               \"name\": \"VIOL_ACCESS_MISSING\"\n            },\n            {\n               \"alarm\": true,\n               \"block\": false,\n               \"name\": \"VIOL_ACCESS_MALFORMED\"\n            }\n            ]\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Querying Security Violation Events\nDESCRIPTION: This example demonstrates how to query 'security violation' events using the NGINX Controller REST API. The startTime is set to 0 and endTime to now. This API call retrieves all events that are categorized as security violations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/view-app-security-analytics.md#_snippet_2\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation')\n```\n\n----------------------------------------\n\nTITLE: Applying OpenID Connect Policy via REST API with JSON Payload\nDESCRIPTION: This JSON snippet defines an OpenID Connect (OIDC) authorization policy, specifying endpoints for authorization, token, and user info services, along with URIs for login, logout, and redirect. It configures the client ID, scopes, and error handling, returning 403 for no match and 401 when data is not supplied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/openID-connect.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n    \"oidc-authz\": [\n      {\n        \"action\": {\n          \"authFlowType\": \"PKCE\",\n          \"authorizationEndpoint\": \"https://<IDP Domain>/v1/Authorize\",\n          \"jwksURI\": \"https://<IDP Domain>/v1/keys\",\n          \"logOffEndpoint\": \"https://<IDP Domain>/v1/logout\",\n          \"tokenEndpoint\": \"https://<IDP Domain>/v1/Token\",\n          \"userInfoEndpoint\": \"https://<IDP Domain>/v1/userinfo\",\n          \"uris\": {\n            \"loginURI\": \"/login\",\n            \"logoutURI\": \"/logout\",\n            \"redirectURI\": \"/_codexch\",\n            \"userInfoURI\": \"/userinfo\"\n          },\n          \"returnTokenToClientOnLogin\": \"none\",\n          \"forwardTokenToBackend\": \"access_token\",\n          \"errorReturnConditions\": {\n            \"noMatch\": {\n              \"returnCode\": 403\n            },\n            \"notSupplied\": {\n              \"returnCode\": 401\n            }\n          }\n        },\n        \"data\": [\n          {\n            \"clientID\": \"myclientID1234\",\n            \"scopes\": \"email+openid+profile\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Restore Backup from Local Copy (Bash)\nDESCRIPTION: This command restores the NGINX Controller config database from the backup file located in the `local_backups` directory. It uses the `helper.sh` script to perform the restoration. This assumes the backup file has already been copied locally.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-embedded-config-db.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh backup restore local_backups/backup_<timestamp>.tar\n```\n\n----------------------------------------\n\nTITLE: Enable App Protect Security Logging (Nginx)\nDESCRIPTION: This snippet configures Nginx App Protect WAF to enable security logging using the custom log format defined in `/etc/app_protect/conf/log_sm.json`. It uses the `app_protect_security_log_enable on;` and `app_protect_security_log` directives to enable logging and specify the log format and syslog server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/set-up-app-protect-instances.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log_enable on;\napp_protect_security_log \"/etc/app_protect/conf/log_sm.json\" syslog:server=127.0.0.1:514;\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Plus (Debian 11)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Plus package from Debian 11. It uses the `apt-get remove` command to remove the `app-protect-module-plus` package. Requires root privileges and the apt package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_55\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get remove app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: gRPC health check for specific service in Nginx\nDESCRIPTION: Specifies a particular gRPC service to monitor with the `grpc_service` parameter. This allows health checks to focus on the most important service exposed on each upstream server.  The `mandatory` parameter ensures that the health check must pass before traffic is sent on an instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/grpc-health-check.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    grpc_pass    grpc://grpc_backend;\n    health_check mandatory type=grpc grpc_service=MyStatus;\n}\n```\n\n----------------------------------------\n\nTITLE: Stream Destination Logs\nDESCRIPTION: This command streams the logs from the destination service's container, enabling real-time monitoring of incoming requests and service behavior. The `-l app=dest-svc` flag filters logs specifically for the destination service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl logs -l app=dest-svc -f -c dest-svc\n```\n\n----------------------------------------\n\nTITLE: Dockerfile Entrypoint for Signature Report Tool\nDESCRIPTION: This Dockerfile snippet sets the entrypoint for a Docker image to the `get-signatures` tool.  It allows the image to be executed directly without specifying the entrypoint in the `docker run` command. This approach simplifies the command and makes the image purpose-built for generating signature reports.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_26\n\nLANGUAGE: Dockerfile\nCODE:\n```\nENTRYPOINT /opt/app_protect/bin/get-signatures\n```\n\n----------------------------------------\n\nTITLE: YAML Configuration for NGINX Agent WAF Support\nDESCRIPTION: This YAML snippet configures the NGINX Agent to support NGINX App Protect WAF. It specifies the directories to monitor for configuration changes, enables the `nginx-app-protect` extension, and sets the report interval for security events. It also enables precompiled publication of WAF configurations from NGINX Instance Manager. This allows the agent to access NGINX App Protect WAF configuration directories and detect changes in security configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\nconfig_dirs: \"/etc/nginx:/usr/local/etc/nginx:/usr/share/nginx/modules:/etc/nms:/etc/app_protect\"\nextensions:\n  - nginx-app-protect\nnginx_app_protect:\n  report_interval: 15s\n  precompiled_publication: true\n```\n\n----------------------------------------\n\nTITLE: Updating Agent on Ubuntu/Debian\nDESCRIPTION: This shows how to update the nginx-amplify-agent package on Ubuntu/Debian systems.  It first updates the package lists using `apt-get update` and then installs the latest version of the agent using `apt-get install`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/faq/nginx-amplify-agent.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\napt-get update && \\\napt-get install nginx-amplify-agent\n```\n\n----------------------------------------\n\nTITLE: Deleting Target v2.0 (Failing Version) with kubectl\nDESCRIPTION: This command removes the deployed `target-v2.0` resources from the Kubernetes cluster using `kubectl delete`. This is performed after identifying that the v2.0 deployment is failing and redirecting traffic back to the stable v1.0 version. Removing the failing version helps to clean up resources and prevent further issues.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete -f target-v2.0-failing.yaml\n```\n\n----------------------------------------\n\nTITLE: Backup NGINX configs and logs - Ubuntu\nDESCRIPTION: These commands back up the NGINX configuration and log files before making changes.  `sudo cp -a /etc/nginx /etc/nginx-plus-backup` creates a backup of the entire `/etc/nginx` directory. `sudo cp -a /var/log/nginx /var/log/nginx-plus-backup` creates a backup of the entire `/var/log/nginx` directory. The `-a` flag ensures that permissions and other attributes are preserved during the copy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_29\n\nLANGUAGE: shell\nCODE:\n```\nsudo cp -a /etc/nginx /etc/nginx-plus-backup\nsudo cp -a /var/log/nginx /var/log/nginx-plus-backup\n```\n\n----------------------------------------\n\nTITLE: Update Repository Information\nDESCRIPTION: This snippet shows the command to update the repository information after modifying the repository configuration file. This ensures the system recognizes the changes made to the repository configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/pin-to-version/pin-rhel9-R32.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update\n```\n\n----------------------------------------\n\nTITLE: Install NDK Module on Alpine\nDESCRIPTION: This shell command adds the nginx-plus-module-ndk package on Alpine Linux.  apk add is used to install the module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/ndk.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-ndk\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Controller - Bash\nDESCRIPTION: This script is used to uninstall NGINX Controller from a node. It is typically run after deleting a node from the cluster to completely remove the NGINX Controller installation. The script is located in the `/opt/nginx-controller/` directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/resilient-cluster-private-cloud.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/uninstall.sh\n```\n\n----------------------------------------\n\nTITLE: Log State Changing Requests\nDESCRIPTION: This JSON configuration logs all requests using the default format and specifies size limits for the request and message.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/security-log.md#_snippet_5\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filter\": {\n        \"request_type\": \"all\"\n    },\n    \"content\": {\n        \"format\": \"default\",\n        \"max_request_size\": \"2k\",\n        \"max_message_size\": \"5k\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: OAuth2 Introspection Policy Configuration - JSON\nDESCRIPTION: This snippet represents the JSON payload included in the PUT request to configure the OAuth2 Introspection policy. It defines the policy's behavior, including the introspection endpoint, client credentials, and backend service details. This configuration will replace any previous policy configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_24\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"test-proxy\",\n   \"version\": \"v1\",\n   \"proxyConfig\": {\n      \"hostname\": \"data-host\",\n      \"ingress\": {\n         \"basePath\": \"/\",\n         \"basePathVersionAppendRule\": \"NONE\"\n      },\n      \"backends\": [\n         {\n            \"serviceName\": \"backend-echo-svc\",\n            \"serviceTargets\": [\n               {\n                  \"hostname\": \"192.0.2.4\",\n                  \"listener\": {\n                     \"enableTLS\": false,\n                     \"port\": 10000,\n                     \"transportProtocol\": \"HTTP\"\n                  }\n               }\n            ]\n         }\n      ],\n      \"policies\": {\n         \"oauth2-introspection\": [\n            {\n               \"action\": {\n                  \"introspectionEndpoint\": \"http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect\"\n               },\n               \"data\": [\n                  {\n                     \"clientAppID\": \"nginx-plus\",\n                     \"clientSecret\": \"<client secret>\"\n                  }\n               ]\n            }\n         ]\n      }\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: JSON Response example after creating security policy\nDESCRIPTION: This is an example of the JSON response received after successfully creating a security policy via the NGINX Instance Manager REST API.  It includes metadata about the created policy, such as the creation and modification timestamps, display name, and a unique identifier (UID).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"metadata\": {\n    \"created\": \"2022-04-10T23:19:58.502Z\",\n    \"description\": \"string\",\n    \"displayName\": \"Ignore cross-site scripting\",\n    \"modified\": \"2022-04-12T23:19:58.502Z\",\n    \"name\": \"ignore-cross-site-scripting\",\n    \"revisionTimestamp\": \"2022-04-12T23:19:58.502Z\",\n    \"uid\": \"<policy-uid>\"\n  },\n  \"selfLink\": {\n    \"rel\": \"/api/platform/v1/services/environments/prod\"\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing Logrotate on Alpine\nDESCRIPTION: This command installs the logrotate utility on Alpine Linux. Logrotate is a system utility that automates the rotation, compression, removal, and mailing of log files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/logs-overview.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apk add logrotate\n```\n\n----------------------------------------\n\nTITLE: Retrieving Signature-Based Violation Events by ID (curl)\nDESCRIPTION: This query retrieves security violation events that triggered a specific signature-based violation, filtered by signature ID and application components.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/view-app-security-analytics.md#_snippet_9\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            waf.signature_ids ='*200000098*' and\n            app='shopping' and\n            environment='prod' and\n            component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Creating a basic NginxProxy Configuration (IPv4)\nDESCRIPTION: This command creates a basic NginxProxy configuration using `kubectl apply`. It sets the IP family to `ipv4`, forcing NGINX to use IPv4 instead of the default `dual` (IPv4 and IPv6). It defines the API version, kind (NginxProxy), metadata (name), and the desired IP family within the spec.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/data-plane-configuration.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.nginx.org/v1alpha1\nkind: NginxProxy\nmetadata:\n  name: ngf-proxy-config\nspec:\n  ipFamily: ipv4\nEOF\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Instance Manager Service (Bash)\nDESCRIPTION: This Bash command restarts the NGINX Instance Manager service. This is necessary for the configuration changes made in the `/etc/nms/nms.conf` file to take effect. The command uses `sudo` to ensure that the user has the necessary permissions to restart the service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/set-mode-of-operation-disconnected.md#_snippet_1\n\nLANGUAGE: Bash\nCODE:\n```\nsudo systemctl restart nms\n```\n\n----------------------------------------\n\nTITLE: Download apt configuration for Nginx\nDESCRIPTION: Downloads the `90pkgs-nginx` configuration file from the NGINX website to `/etc/apt/apt.conf.d/`. This file configures apt to prioritize packages from the NGINX repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-ubuntu.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx\n```\n\n----------------------------------------\n\nTITLE: Making NGINX Instance Manager Scripts Executable (chmod)\nDESCRIPTION: These commands change the permissions of the backup, restore, and support package scripts to make them executable. This is a necessary step before running the scripts. It depends on the `chmod` utility being available.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo chmod +x backup.sh\n```\n\nLANGUAGE: shell\nCODE:\n```\nsudo chmod +x restore.sh\n```\n\nLANGUAGE: shell\nCODE:\n```\nsudo chmod +x support-package.sh\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Amplify Agent for PHP-FPM\nDESCRIPTION: This configuration enables the PHP-FPM extension in the NGINX Amplify Agent configuration file. Setting `phpfpm = True` under the `[extensions]` section instructs the agent to collect PHP-FPM metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/other-metrics.md#_snippet_4\n\nLANGUAGE: text\nCODE:\n```\n[extensions]\nphpfpm = True\n```\n\n----------------------------------------\n\nTITLE: Policy Configuration with URL Filetype Reference JSON\nDESCRIPTION: This JSON defines an App Protect policy that references an external file containing file types via a URL. It enables file type violation and retrieves allowed file types from the specified URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-references.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"external_resources_file_types\",\n    \"template\": {\n        \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"applicationLanguage\": \"utf-8\",\n    \"enforcementMode\": \"blocking\",\n    \"blocking-settings\": {\n        \"violations\": [\n            {\n                \"name\": \"VIOL_FILETYPE\",\n                \"alarm\": true,\n                \"block\": true\n            }\n        ]\n    },\n    \"filetypeReference\": {\n        \"link\": \"http://domain.com:8081/file-types.txt\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Publish Security Content (POST) - Shell\nDESCRIPTION: This code snippet shows how to publish security policies, log profiles, attack signatures, and threat campaigns to NGINX instances or instance groups using a POST request to the Publish API. The `-d` flag specifies the JSON payload to be sent from the `publish-request.json` file.  Requires `curl`, a valid access token, and a correctly formatted JSON request file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_22\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X POST https://{{NIM_FQDN}}/api/platform/v1/security/publish \\\n    -H \"Authorization: Bearer <access token>\" \\\n    -d @publish-request.json\n```\n\n----------------------------------------\n\nTITLE: Testing Request Rate Limit in Nginx (Dry Run Mode)\nDESCRIPTION: This snippet demonstrates the \"dry run\" mode for request rate limiting. While not actually limiting requests, it logs excessive requests to the shared memory zone and tracks them for testing purposes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n\n    limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;\n\n    server {\n        #...\n\n        location /search/ {\n            limit_req zone=one;\n            limit_req_dry_run on;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Specifying Okta OIDC Provider Details\nDESCRIPTION: This snippet configures the Okta OIDC provider details within the `oidc_provider` context. It sets the `issuer`, `client_id`, and `client_secret` directives, which are obtained from the Okta application configuration.  It also notes the use of `ssl_trusted_certificate` for cases where the Okta certificate is not in the system CA bundle.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/okta.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider okta {\n        issuer        https://dev-123456.okta.com/oauth2/default;\n        client_id     <client_id>;\n        client_secret <client_secret>;\n    }\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Checking Nginx Version\nDESCRIPTION: This snippet demonstrates how to check the installed Nginx version using the command line. It executes the `nginx -v` command, which outputs the version information to the console. This is a fundamental step in verifying that Nginx Plus is installed correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/check-nginx-binary-version.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nnginx -v\n```\n\n----------------------------------------\n\nTITLE: Backing up API Connectivity Manager Data (backup.sh) - Shell\nDESCRIPTION: This snippet from `backup.sh` checks if the API Connectivity Manager service (nms-acm) is active. If not, it displays an error message and exits. It then calls the `backup-acm.sh` script to back up the API Connectivity Manager data. The code requires `systemctl`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nACM_ACTIVE=$(systemctl is-active --quiet nms-acm)\nIS_ACM_ACTIVE=$?\nif [ $IS_ACM_ACTIVE -ne 0 ]; then\n    echo \"You need to start the required NGINX Management Suite\n        services before running the backup script.\"\n    echo \"Please ensure the following nms service is running:\"\n    echo \"nms-acm\"\n    exit 1\nfi\n```\n\nLANGUAGE: shell\nCODE:\n```\n./backup-acm.sh\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Instance Manager with Vault Token\nDESCRIPTION: These commands stop the `nms-core` service, configure NGINX Instance Manager to use the Vault token by setting the `NMS_VAULT_TOKEN` environment variable and running `nms-core secret vault-token`, and then restart the `nms-core` service.  This ensures that the new token is used when accessing secrets.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-vault.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl stop nms-core\nsudo NMS_VAULT_TOKEN=$(cat periodic_token.txt) nms-core secret vault-token\nsudo systemctl restart nms-core\n```\n\n----------------------------------------\n\nTITLE: Pulling NGINX Plus base image from the registry\nDESCRIPTION: This command pulls the NGINX Plus base image from the private NGINX registry.  The <version-tag> should be replaced with the specific version of NGINX Plus to be pulled, such as r33 or r34.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ndocker pull private-registry.nginx.com/nginx-plus/base:<version-tag>\n```\n\n----------------------------------------\n\nTITLE: Excluding a Signature using Modifications - JSON\nDESCRIPTION: This snippet demonstrates how to exclude a specific signature by ID using the `modifications` section. It sets `enabled` to `false` for signature ID 200001834 via `entityChanges` and specifies the `entityType` as \"signature\".\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/signature-sets.md#_snippet_4\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"signature_modification_entitytype\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"signature-sets\": [\n            {\n                 \"name\": \"All Signatures\",\n                 \"block\": true,\n                 \"alarm\": true\n            }\n        ]\n    },\n    \"modifications\": [\n        {\n            \"entityChanges\": {\n                \"enabled\": false\n            },\n            \"entity\": {\n                \"signatureId\": 200001834\n            },\n            \"entityType\": \"signature\",\n            \"action\": \"add-or-update\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Management Suite Platform Services\nDESCRIPTION: This command restarts the NGINX Management Suite platform services using `systemctl`.  This applies any configuration changes made during the API Connectivity Manager upgrade.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm-offline.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nms\n```\n\n----------------------------------------\n\nTITLE: Querying Rejected or Flagged Security Violation Events\nDESCRIPTION: This example retrieves all security violation events where WAF either rejected or flagged the request for review. The startTime is set to 0 and endTime to now using the NGINX Controller REST API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/view-app-security-analytics.md#_snippet_6\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            request_outcome_reason in ('SECURITY_WAF_VIOLATION','SECURITY_WAF_FLAGGED'))\n```\n\n----------------------------------------\n\nTITLE: Installing Encrypted Session module on FreeBSD\nDESCRIPTION: This shell script updates the package manager and installs the `nginx-plus-module-encrypted-session` package using pkg.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/encrypted-session.md#_snippet_5\n\nLANGUAGE: Shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-encrypted-session\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration (Shell)\nDESCRIPTION: This command reloads the Nginx configuration without downtime. It applies any changes made to the configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/ping-identity.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Missing Policy Name Example (JSON)\nDESCRIPTION: This JSON snippet shows an example of a missing policy 'name' within the 'override' section of an override rule. The 'policy' object lacks the 'name' field, which is required when the 'actionType' is 'extend-policy' or 'replace-policy'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/override-rules-errors-warnings.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"override-rules\": [\n        {\n            \"name\": \"example-rule\",\n            \"condition\": \"uri.contains('127')\",\n            \"actionType\": \"replace-policy\",\n            \"override\": {\n                \"policy\": {\n                    \"name\": \"policy_name\",\n                    \"enforcementMode\": \"transparent\"\n                }\n            }\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Setting Blocking Enforcement Mode in Policy JSON\nDESCRIPTION: This JSON snippet sets the enforcement mode to 'blocking' for a given policy. The `enforcementMode` property is set to 'blocking', meaning that any illegal or suspicious requests are logged and blocked. Requires defining a policy name and referencing the base template.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/policy-authoring-and-tuning.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"policy_name\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Disable NTP - Bash\nDESCRIPTION: This command disables NTP to allow manual setting of the system time. This is part of a workaround if the NGINX Controller host was down when the kubelet certificate expired.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo timedatectl set-ntp off\n```\n\n----------------------------------------\n\nTITLE: Configure CSRF Protection with Custom URL and Hostname - JSON\nDESCRIPTION: This JSON snippet configures CSRF protection in NGINX App Protect WAF by enabling it globally, deleting the default wildcard CSRF URL, defining a new custom CSRF URL, and defining a policy-wide hostname domain without its subdomains. It sets the violation to 'Block' mode and enforces origin validation for the specified URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/csrf-protection.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"applicationLanguage\": \"utf-8\",\n        \"name\": \"example_2\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_CSRF\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"csrf-protection\": {\n            \"enabled\": true\n        },\n        \"csrf-urls\": [\n            {\n                \"$action\": \"delete\",\n                \"method\": \"POST\",\n                \"url\": \"*\"\n            },\n            {\n                \"enforcementAction\": \"verify-origin\",\n                \"method\": \"POST\",\n                \"url\": \"/operation.aspx\"\n            }\n        ],\n        \"host-names\": [\n            {\n                \"name\": \"example.com\",\n                \"includeSubdomains\": false\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Creating Filter-Based Signature Set\nDESCRIPTION: This JSON configures a signature set named 'my-low-accuracy-signatures' using a filter-based approach. The filter is configured to include signatures that have an attack type of 'Other Application Attacks', a signature type of 'request', a high risk value, and an accuracy value less than or equal to high. This signature set will block and alarm when triggered.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/user-defined-signature-sets.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"filtered_signature_sets\",\n    \"template\": {\n        \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"applicationLanguage\": \"utf-8\",\n    \"enforcementMode\": \"blocking\",\n    \"signature-sets\": [\n        {\n            \"name\": \"my-low-accuracy-signatures\",\n            \"block\": true,\n            \"alarm\": true,\n            \"signatureSet\": {\n                \"type\": \"filter-based\",\n                \"filter\": {\n                    \"attackType\": {\n                        \"name\": \"Other Application Attacks\"\n                    },\n                    \"signatureType\": \"request\",\n                    \"riskFilter\": \"eq\",\n                    \"riskValue\": \"high\",\n                    \"accuracyFilter\": \"le\",\n                    \"accuracyValue\": \"high\"\n                }\n            }\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Adding Content Security Policy Header - Nginx Configuration\nDESCRIPTION: This configuration adds a Content-Security-Policy header to the /ui location block in the Nginx configuration. It is used to enable web analytics functionality after upgrading Instance Manager while keeping an existing nms-http.conf file. The CSP directive defines allowed sources for various content types, enhancing security by mitigating XSS attacks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/known-issues.md#_snippet_1\n\nLANGUAGE: text\nCODE:\n```\nadd_header Content-Security-Policy \"default-src 'none'; block-all-mixed-content; frame-ancestors 'self'; object-src 'none'; manifest-src 'self'; script-src 'self' https://*.walkme.com 'unsafe-inline' 'unsafe-eval'; style-src 'self' https://*.walkme.com fonts.googleapis.com 'unsafe-inline'; img-src 'self' https://*.walkme.com s3.walkmeusercontent.com d3sbxpiag177w8.cloudfront.net data:; font-src 'self' https://*.walkme.com data: https://fonts.gstatic.com; connect-src 'self' https://*.walkme.com; frame-src 'self' https://*.walkme.com blob:; worker-src 'self' blob: https://*.walkme.com;\";\n```\n\n----------------------------------------\n\nTITLE: Enable ClickHouse server to start on boot (CentOS, RHEL)\nDESCRIPTION: Enables the ClickHouse server to start automatically when the system boots. This ensures that ClickHouse is running after a server restart, which is required for NGINX Instance Manager to function correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl enable clickhouse-server\n```\n\n----------------------------------------\n\nTITLE: Deploy Headers application for Response Mod - Shell\nDESCRIPTION: Deploys the example headers application from a remote YAML file. This application adds response headers, which are modified in subsequent steps.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/examples/http-response-header-filter/headers.yaml\n```\n\n----------------------------------------\n\nTITLE: Copy Kubernetes Admin Configuration - Bash\nDESCRIPTION: This series of commands copies the Kubernetes admin configuration file to the user's home directory and adjusts permissions. This is necessary to re-establish `kubectl` access after renewing the certificates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ncd\nmv .kube/config .kube/config.old\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\nsudo chmod 777 $HOME/.kube/config\nexport KUBECONFIG=.kube/config\n```\n\n----------------------------------------\n\nTITLE: Expected output after testing NGINX configuration\nDESCRIPTION: This is the expected output after running 'nginx -t' command.  It confirms that the configuration file's syntax is correct and the configuration file is successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/passenger-open-source.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Query HTTP Unsuccessful Response Codes with Prometheus\nDESCRIPTION: This Prometheus query retrieves the number of unsuccessful HTTP response codes (3xx, 4xx, or 5xx) from upstream servers. The query uses a regular expression `3xx|4xx|5xx` to match the desired response codes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_1\n\nLANGUAGE: promQL\nCODE:\n```\nnginxplus_upstream_server_responses{code=~\"3xx|4xx|5xx\"}\n```\n\n----------------------------------------\n\nTITLE: Verify Nginx signing key on SLES\nDESCRIPTION: This command verifies the integrity of the Nginx signing key that was downloaded, by checking its fingerprint on SLES.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\ngpg --with-fingerprint --dry-run --quiet --no-keyring --import --import-options import-show /tmp/nginx_signing.key\n```\n\n----------------------------------------\n\nTITLE: Query Aggregated and Non-Aggregated Metrics\nDESCRIPTION: This cURL command combines aggregated and non-aggregated metrics in a single query. It retrieves the sum of `http.request.count` and the last recorded value of `http.request.bytes_rcvd` for the last three hours. `startTime` is needed for the aggregated metric. The API returns a single value per dimension set for the aggregated metric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=SUM(http.request.count),http.request.bytes_rcvd&startTime=now-3h\"\n```\n\n----------------------------------------\n\nTITLE: Configuration Error Log Event JSON\nDESCRIPTION: This JSON snippet represents a configuration error event in NGINX App Protect DoS. It includes details such as the event type, error message, and the line number where the error occurred in the configuration file. The error indicates an issue with the configuration directives.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/operation-log.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"event\": \"configuration_error\",\n    \"error_message\": \"unknown argument\",\n    \"line_number\": 58\n}\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx Configuration - None\nDESCRIPTION: This command reloads the Nginx configuration. It's required after modifying the ModSecurity configuration to apply the changes. This process can take some time as the rules are downloaded from the remote server. No language specified as the command is generic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-trustwave-spiderlabs-rules.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Configure Test Application Server in NGINX\nDESCRIPTION: This snippet configures a simple test application server listening on port 8080. It returns a 200 OK response with the user's name, email, and Auth0 subject (sub) if successfully authenticated. The values are derived from headers passed by the proxy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/auth0.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nserver {\n    listen 8080;\n\n    location / {\n        return 200 \"Hello, $http_name!\\nEmail: $http_email\\nAuth0 sub: $http_sub\\n\";\n        default_type text/plain;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing nginx-plus-module-geoip2 on Debian and Ubuntu\nDESCRIPTION: Installs the nginx-plus-module-geoip2 package using apt-get. This package provides the GeoIP2 dynamic module for NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\napt-get install nginx-plus-module-geoip2\n```\n\n----------------------------------------\n\nTITLE: Add Rate Limit Policy via API using JSON - NGINX\nDESCRIPTION: This code snippet demonstrates how to add a rate-limit policy to an API Proxy using a JSON payload sent via a POST request to the specified endpoint. The policy limits the request rate based on the client IP address. The 'appliedOn' field specifies whether the policy applies to inbound or outbound traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/rate-limit.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n     \"rate-limit\": [\n        {\n           \"systemMetadata\": {\n              \"appliedOn\": \"inbound\",\n              \"context\": \"proxy\"\n           },\n           \"action\": {\n              \"limits\": [\n                 {\n                    \"rate\": \"10r/s\",\n                    \"rateLimitBy\": \"client.ip\",\n                    \"zoneSize\": \"10M\"\n                 }\n              ]\n           }\n        }\n     ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Clone NGINX Agent Repository (SSH)\nDESCRIPTION: Clones the NGINX Agent GitHub repository using SSH. This repository contains the Dockerfiles and supporting scripts needed to build the NGINX Agent container images.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ngit clone git@github.com:nginx/agent.git\n```\n\n----------------------------------------\n\nTITLE: Querying Nginx Plus API for Active Connections After Increase\nDESCRIPTION: Similar to the first snippet, this retrieves the number of active connections from the NGINX Plus API, but after simulating an increase in connections. This step verifies that the API reflects the new number of active connections. The output is then filtered using `grep` to extract the value of the `active` field.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\n$ curl -X GET \"127.0.0.1:8000/api/<version>/connections\" -H \"accept: application/json\" | python -m json.tool | grep active\n\n\"active\": 5,\n```\n\n----------------------------------------\n\nTITLE: Extract NGINX Controller Installer Package - Bash\nDESCRIPTION: This command extracts the NGINX Controller installer package from the downloaded tar.gz file. It's a necessary step before running the installation helper script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ntar xzf controller-installer-<version>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Setting core dump file size limit in Nginx config\nDESCRIPTION: Defines the maximum size of the core dump file in the NGINX configuration. The `worker_rlimit_core` directive must be specified in the `main` configuration context.  Core dumps exceeding this size will not be created.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_23\n\nLANGUAGE: nginx\nCODE:\n```\nworker_rlimit_core 500M;\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX App Protect Policy File\nDESCRIPTION: Configures the path to the pre-compiled policy file for NGINX App Protect WAF. This directive specifies the location of the JSON file containing the security policies to be enforced.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/configure-waf.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_policy_file /etc/app_protect/conf/NginxDefaultPolicy.json;\n```\n\n----------------------------------------\n\nTITLE: Define HTTPRouteGroup for Rate Limiting (YAML)\nDESCRIPTION: This YAML configuration defines an HTTPRouteGroup resource, which is referenced by the RateLimit resource. It specifies two matches: 'get-only' which matches GET requests, and 'v2' which matches GET requests to the '/configuration-v2' path with the 'X-DEMO: ^true$' header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/smi-traffic-policies.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi-spec.io/v1alpha3\nkind: HTTPRouteGroup\nmetadata:\n  name: hrg\n  namespace: default\nspec:\n  matches:\n    - name: get-only\n      methods:\n        - GET\n    - name: v2\n      pathRegex: \"/configuration-v2\"\n      headers:\n        X-DEMO: \"^true$\"\n      methods:\n        - GET\n```\n\n----------------------------------------\n\nTITLE: Retrieving Signature-Based Violation Events by Name (curl)\nDESCRIPTION: This query retrieves security violation events that triggered a specific signature-based violation, filtered by signature name and application components.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/view-app-security-analytics.md#_snippet_10\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            waf.signature_names IN ('DIRECTORY_TRAVERSAL') and\n            app='shopping' and\n            environment='prod' and\n            component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Docker Compose Log Collection\nDESCRIPTION: Collects logs from Docker Compose deployments for troubleshooting NGINX App Protect WAF. This command redirects the output of `docker compose logs` to a text file for analysis.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/troubleshooting-guide/troubleshooting.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\nsudo docker compose logs > docker_compose_logs.txt\n```\n\n----------------------------------------\n\nTITLE: SSL/TLS Proxy Configuration on NGINX Plus\nDESCRIPTION: This code snippet demonstrates how to configure SSL/TLS proxy on NGINX Plus. It defines an upstream pool and a server block that listens on port 443 with SSL enabled, specifying the certificate and key files. It also configures proxy settings for SSL, including certificates, protocols, ciphers, and verification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nupstream ssl_test_pool {\n        server 10.10.10.10:443;\n   }\n\n   server {\n        listen 192.168.10.10:443 ssl;\n        ssl_certificate     /etc/nginx/ssl/test.crt;\n        ssl_certificate_key /etc/nginx/ssl/test.key;\n\n        location / {\n            proxy_pass https://ssl_test_pool;\n            proxy_ssl_certificate /etc/nginx/ssl/client.pem;\n            proxy_ssl_certificate_key /etc/nginx/ssl/client.key;\n            proxy_ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n            proxy_ssl_ciphers HIGH:!aNULL:!MD5;\n            proxy_ssl_trusted_certificate /etc/nginx/ssl/trusted_ca_cert.crt;\n            proxy_ssl_verify on;\n            proxy_ssl_verify_depth 2;\n        }\n   }\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration\nDESCRIPTION: This shell command shows how to reload the NGINX configuration after making changes to the configuration files.\nThis is necessary to apply the changes without restarting the NGINX server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/onelogin.md#_snippet_5\n\nLANGUAGE: Shell\nCODE:\n```\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Attach to Helper Container (Shell)\nDESCRIPTION: This shell command attaches to the running helper container named mynginx4_files, allowing interaction with the container's shell.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_28\n\nLANGUAGE: shell\nCODE:\n```\ndocker attach mynginx4_files\n```\n\n----------------------------------------\n\nTITLE: Describe ObservabilityPolicy - Kubernetes\nDESCRIPTION: This command retrieves and displays the details of the 'coffee' ObservabilityPolicy, including its status, ancestors, and controller. This verifies that the policy is accepted and properly associated with the targeted HTTPRoute. It requires `kubectl` to be configured and connected to the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe observabilitypolicies.gateway.nginx.org coffee\n```\n\n----------------------------------------\n\nTITLE: Add VM to Load Balancer Backend Pool - Azure CLI\nDESCRIPTION: Adds a network interface IP configuration to an Azure Load Balancer's backend address pool. This configuration is necessary to direct traffic from the load balancer to the workload virtual machine.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/private-link-to-upstreams.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\n$ az network nic ip-config address-pool add \\\n  --address-pool backend-pool \\\n  --ip-config-name $APP_IP_CONFIG_NAME \\\n  --nic-name $APP_NIC_NAME \\\n  --resource-group $APP_RESOURCE_GROUP \\\n  --lb-name load-balancer\n```\n\n----------------------------------------\n\nTITLE: Setting Nginx Error Log Path and Severity\nDESCRIPTION: This configuration snippet demonstrates how to set the error log file path to `/var/log/nginx/nginx-error.log` and the minimum severity level to `emerg`. This means only emergency messages will be logged to the specified file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginxaas-azure/logging-config-error-logs.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nerror_log /var/log/nginx/nginx-error.log emerg;\n```\n\n----------------------------------------\n\nTITLE: Upgrading NGINX Instance Manager on RHEL/RPM\nDESCRIPTION: These shell commands are used to upgrade NGINX Instance Manager on RHEL and RPM-based systems. They use `rpm` to upgrade the package, ignoring signatures, and then restart the `nms` and `nginx` services to apply the changes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide.md#_snippet_3\n\nLANGUAGE: Shell Script\nCODE:\n```\nsudo rpm -Uvh --nosignature /home/user/nms-instance-manager_<version>.x86_64.rpm\nsudo systemctl restart nms\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Add zypper repository for Nginx Agent on SLES\nDESCRIPTION: This command adds the Nginx Agent repository to the system's zypper configuration, allowing the package manager to find and install the Nginx Agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper addrepo --gpgcheck --refresh --check \\\n    'http://packages.nginx.org/nginx-agent/sles/$releasever_major' nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Retrieving Events by Remote Address (curl)\nDESCRIPTION: This query retrieves security violation events originating from a specific remote address (client IP), filtered by application components.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/view-app-security-analytics.md#_snippet_12\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            http.remote_addr='172.18.71.147' and\n            app='shopping' and\n            environment='prod' and\n            component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Building the NGINX API Gateway Docker Image\nDESCRIPTION: This bash script builds the Docker image for the NGINX API Gateway.  It exports environment variables and uses docker build with build arguments and secrets for nginx-crt and nginx-key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/devportal-helm-chart.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nexport CONTROL_PLANE_IP=<NGINX-INSTANCE-MANAGER-FQDN>\nexport NGINX_PLUS_VERSION=<NGINX-PLUS-VERSION>\nexport DEVPORTAL_UI_VERSION=<ACM-VERSION>\nexport DEVPORTAL_UI_TAG=${DEVPORTAL_UI_VERSION}-r${NGINX_PLUS_VERSION}\nexport DOCKER_BUILDKIT=1\ndocker build \\\n  -t nginx-devportal-apigw:$DEVPORTAL_UI_TAG \\\n  --build-arg CONTROL_PLANE_IP \\\n  --build-arg NGINX_PLUS_VERSION \\\n  --build-arg DEVPORTAL_UI_VERSION \\\n  --secret id=nginx-crt,src=nginx-repo.crt \\\n  --secret id=nginx-key,src=nginx-repo.key \\\n  .\n```\n\n----------------------------------------\n\nTITLE: Import Nginx signing key to rpm database on SLES\nDESCRIPTION: This command imports the Nginx signing key into the RPM database, allowing zypper/rpm to verify the authenticity of Nginx packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\nsudo rpmkeys --import /tmp/nginx_signing.key\n```\n\n----------------------------------------\n\nTITLE: Upstream Request and Response Counts\nDESCRIPTION: Describes the 'plus.upstream.request.count' and 'plus.upstream.response.count' metrics, which are counters that track the number of client requests forwarded to upstream servers and the responses received. These metrics provide insights into the volume of traffic handled by upstream servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_5\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Number of client requests forwarded to the upstream servers, and responses obtained.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Push Docker Images\nDESCRIPTION: This command pushes docker images to the specified registry. Replace `myregistry.example.com/nginx-gateway-fabric` with your container registry path. Requires Docker to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/building-the-images.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ndocker push myregistry.example.com/nginx-gateway-fabric:{{< version-ngf >}}\ndocker push myregistry.example.com/nginx-gateway-fabric/nginx:{{< version-ngf >}}\n```\n\n----------------------------------------\n\nTITLE: Upgrade Developer Portal (Debian, Ubuntu, Deb-based)\nDESCRIPTION: Upgrades the `nginx-devportal` and `nginx-devportal-ui` packages on Debian, Ubuntu, or Deb-based systems using `apt-get upgrade`. It first updates the package lists.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get update\nsudo apt-get upgrade -y nginx-devportal nginx-devportal-ui\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Controller Agent with Non-Root User (Bash)\nDESCRIPTION: This snippet demonstrates how to modify the curl or wget command to install the NGINX Controller Agent as a non-root user, including specifying the user and optional group. It utilizes API_KEY, instance name and instance location parameters for installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-agent-non-root.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ncurl -sS -L https://<controller FQDN>/install/controller-agent > install.sh && API_KEY='<API KEY>' CONTROLLER_USER='<non-root user>' CONTROLLER_GROUP='<optional group>' -i <instance name> -l <instance location>\n```\n\n----------------------------------------\n\nTITLE: Start ClickHouse server (CentOS, RHEL)\nDESCRIPTION: Starts the ClickHouse server. This command initiates the ClickHouse database service, making it available for use by NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start clickhouse-server\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration for Backend Servers\nDESCRIPTION: This Nginx configuration block defines the root directory for the web server. It sets the document root to /home/ubuntu/public_html, where the index.html file is located.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/route-53-global-server-load-balancing.md#_snippet_5\n\nLANGUAGE: Nginx\nCODE:\n```\nserver {\n    root /home/ubuntu/public_html;\n}\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Agent for App Protect Monitoring (YAML)\nDESCRIPTION: This snippet configures the `/etc/nginx-agent/nginx-agent.conf` file for NGINX Agent to enable reporting of NGINX App Protect details to the management plane, specifying the poll and report intervals, enabling event reporting, and configuring metrics collection.  It also sets up the configuration directories and syslog settings for the NGINX App Protect Monitoring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/set-up-app-protect-instances.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\ndataplane:\n   status:\n      # poll interval for data plane status - the frequency the NGINX Agent will query the data plane for changes\n      poll_interval: 30s\n      # report interval for data plane status - the maximum duration to wait before syncing data plane information if no updates have been observed\n      report_interval: 24h\nevents:\n   # report data plane events back to the management plane\n   enable: true\nmetrics:\n   # specify the size of a buffer to build before sending metrics\n   bulk_size: 20\n   # specify metrics poll interval\n   report_interval: 1m\n   collection_interval: 15s\n   mode: aggregated\n\n# OSS NGINX default config path\n# path to aux file dirs can also be added\nconfig_dirs: \"/etc/nginx:/usr/local/etc/nginx:/usr/share/nginx/modules:/etc/nms:/etc/app_protect\"\n\n# Enable reporting NGINX App Protect details to the management plane.\nextensions:\n  - nginx-app-protect\n  - nap-monitoring\n\n# Enable reporting NGINX App Protect details to the control plane.\nnginx_app_protect:\n   # Report interval for NGINX App Protect details - the frequency the NGINX Agent checks NGINX App Protect for changes.\n   report_interval: 15s\n   # Enable precompiled publication from the NGINX Instance Manager (true) or perform compilation on the data plane host (false).\n   precompiled_publication: true\n\n# NGINX App Protect Monitoring config\nnap_monitoring:\n   # Buffer size for collector. Will contain log lines and parsed log lines\n   collector_buffer_size: 50000\n   # Buffer size for processor. Will contain log lines and parsed log lines\n   processor_buffer_size: 50000\n   # Syslog server IP address the collector will be listening to\n   syslog_ip: \"127.0.0.1\"\n   # Syslog server port the collector will be listening to\n   syslog_port: 514\n```\n\n----------------------------------------\n\nTITLE: Enable /reports/ endpoint for custom role using API - JSON\nDESCRIPTION: This JSON payload demonstrates how to enable the `/reports/` endpoint for a custom role named `analyzer-reports` in the NGINX Controller using a POST request to the Roles API. It grants `READ` access to the `/reports/` endpoint, allowing users with this custom role to view the reports in the Analyzer.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/analyzer.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"desiredState\": {\n    \"permissions\": [\n      {\n        \"access\": \"READ\",\n        \"path\": \"/reports/\"\n      }\n    ]\n  },\n  \"metadata\": {\n    \"kind\": \"role\",\n    \"name\": \"analyzer-reports\"\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Handling favicon.ico Requests (Nginx)\nDESCRIPTION: This snippet configures a location block to handle requests for the `favicon.ico` file within the 'server' block for HTTPS traffic. It disables logging for these requests and serves an empty GIF image using the `empty_gif` directive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_36\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation = /favicon.ico {\n    empty_gif;\n    access_log off;\n}\n```\n\n----------------------------------------\n\nTITLE: Create Group Request with SCIM\nDESCRIPTION: This JSON payload is sent as a POST request to the `/api/scim/v2/Groups` endpoint to create a new group in NGINX Instance Manager using the SCIM API.  It includes the group's schemas, display name, external ID, and members (users assigned to the group). The `value` field within `members` references the user's ID. Requires a valid user ID to be assigned to a group. The externalId should be a valid UUID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/scim-provisioning.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"schemas\": [\n    \"urn:ietf:params:scim:schemas:core:2.0:Group\"\n  ],\n  \"displayName\": \"Example Group\",\n  \"externalId\": \"7fcb12f4-af71-4f7d-a987-6c1a91cb838a\",\n  \"members\": [\n    {\n      \"type\": \"User\",\n      \"value\": \"dc898740-4e9c-41a4-912c-1f3a20edf66e\"\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Create HTTPS Environment with NGINX Management Suite API (JSON)\nDESCRIPTION: This JSON payload creates an HTTPS-based Environment in NGINX Management Suite by defining a proxy with a TLS inbound policy.  The `policies` section includes `tls-inbound` configuration that requires a `key` and `cert` for the server, using placeholders `{{tls key}}` and `{{tls cert}}` respectively. The `environmentHostname` and `instanceGroupName` use the `{{environmentHostname}}` and `{{instanceGroupName}}` placeholders respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/add-api-gateway.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"{{environmentName}}\",\n    \"proxies\": [\n        {\n            \"proxyClusterName\": \"{{instanceGroupName}}\",\n            \"hostnames\": [\n                \"{{environmentHostname}}\"\n            ],\n            \"policies\": {\n                \"tls-inbound\": [\n                    {\n                        \"data\": {\n                            \"serverCerts\": [\n                                {\n                                    \"key\": \"{{tls key}}\",\n                                    \"cert\": \"{{tls cert}}\"\n                                }\n                            ]\n                        }\n                    }\n                ]\n            }\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Data Guard Masking Policy Configuration JSON\nDESCRIPTION: This JSON snippet demonstrates a Data Guard policy configuration for masking sensitive data. It enables Data Guard, sets the enforcement mode to 'ignore-urls-in-list', and specifies that credit card numbers and US social security numbers should be masked. The 'alarm' is set to true for 'VIOL_DATA_GUARD', but blocking is disabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/signature-sets.md#_snippet_11\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"nginx_default_policy\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_DATA_GUARD\",\n                    \"alarm\": true,\n                    \"block\": false\n                }\n            ]\n        },\n        \"data-guard\": {\n            \"enabled\": true,\n            \"maskData\": true,\n            \"creditCardNumbers\": true,\n            \"usSocialSecurityNumbers\": true,\n            \"enforcementMode\": \"ignore-urls-in-list\",\n            \"enforcementUrls\": []\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring IPv6 Whitelist IPs in NGINX App Protect Policy\nDESCRIPTION: This JSON snippet configures an Nginx App Protect policy with IPv6 whitelist IP addresses and subnets. The policy sets `blockRequests` to `never` for the specified IPv6 addresses and ranges, allowing traffic from those sources.  The configuration also demonstrates the use of an IPv6 mask to define a subnet.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/deny-allow-never-log-lists.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"allow_deny\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_BLACKLISTED_IP\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"whitelist-ips\": [\n            {\n                \"ipAddress\": \"2023::4ef3\",\n                \"ipMask\": \"ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff\",\n                \"blockRequests\": \"never\"\n            },\n            {\n                \"ipAddress\": \"2034::2300\",\n                \"ipMask\": \"ffff:ffff:ffff:ffff:ffff:ffff:ffff:ff00\",\n                \"blockRequests\": \"never\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Restricting Response Signature Checks - JSON\nDESCRIPTION: This example demonstrates how to restrict the portion of the response body that is checked for attack signatures in NGINX App Protect. It enables response checking with `responseCheck: true` and limits the check to the first 1000 bytes of the response using `responseCheckLength: 1000`. This optimizes performance by reducing the amount of data that needs to be inspected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/filetypes-and-responses.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"response_signatures_block\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"filetypes\": [\n           {\n            \"name\": \"*\",\n            \"type\": \"wildcard\",\n            \"responseCheck\": true,\n\t\t    \"responseCheckLength\": 1000\n           }\n        ],\n            \"signature-sets\": [\n          {\n                \"name\": \"All Response Signatures\",\n                \"block\": true,\n                \"alarm\": true\n           }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX HTTP and Stream PROXY Protocol Configuration Example\nDESCRIPTION: This snippet showcases a comprehensive NGINX configuration example, including HTTP and stream contexts, demonstrating how to configure the PROXY protocol.  It configures logging, SSL certificates, and sets up proxy headers to forward the client's IP address to the backend server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/using-proxy-protocol.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    log_format combined '$proxy_protocol_addr - $remote_user [$time_local] '\n                        '\"$request\" $status $body_bytes_sent '\n                        '\"$http_referer\" \"$http_user_agent\"';\n    #...\n\n    server {\n        server_name localhost;\n\n        listen 80   proxy_protocol;\n        listen 443  ssl proxy_protocol;\n\n        ssl_certificate      /etc/nginx/ssl/public.example.com.pem;\n        ssl_certificate_key  /etc/nginx/ssl/public.example.com.key;\n\n        location /app/ {\n            proxy_pass       http://backend1;\n            proxy_set_header Host            $host;\n            proxy_set_header X-Real-IP       $proxy_protocol_addr;\n            proxy_set_header X-Forwarded-For $proxy_protocol_addr;\n        }\n    }\n}\n\nstream {\n    log_format basic '$proxy_protocol_addr - $remote_user [$time_local] '\n                     '$protocol $status $bytes_sent $bytes_received '\n                     '$session_time';\n    #...\n    server {\n        listen              12345 ssl proxy_protocol;\n\n        ssl_certificate     /etc/nginx/ssl/cert.pem;\n        ssl_certificate_key /etc/nginx/ssl/cert.key;\n\n        proxy_pass          backend.example.com:12345;\n        proxy_protocol      on;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Caching JWKs - Nginx Configuration\nDESCRIPTION: This snippet shows how to configure caching for JSON Web Keys (JWKs) fetched via subrequest. The `proxy_cache_path` directive defines the cache location, key zone, and maximum size. The `proxy_cache`, `proxy_cache_valid`, and `proxy_pass` directives within the internal location (`/_jwks_uri`) control the caching behavior and the remote source from which to obtain the keys.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    proxy_cache_path /var/cache/nginx/jwk levels=1 keys_zone=jwk:1m max_size=10m;\n    #...\n\n    server {\n        listen 80;\n            #...\n\n        location = /_jwks_uri {\n            internal;\n            proxy_method      GET;\n            proxy_cache       jwk; # Cache responses\n            proxy_cache_valid 200 12h;\n            proxy_pass        https://idp.example.com/oauth2/keys; # Obtain keys from here\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Pushing Docker Images to Private Registry\nDESCRIPTION: These shell commands push the tagged Docker images to the specified private Docker registry. Replace `<my-docker-registry>` with the actual registry URL. Authentication is required before pushing images.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/devportal-helm-chart.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ndocker push <my-docker-registry>/nginx-devportal-apigw:<version>\ndocker push <my-docker-registry>/nginx-devportal-api:<version>\n```\n\n----------------------------------------\n\nTITLE: Configuring OAuth2 Introspection Policy with SNI Enabled (JSON)\nDESCRIPTION: This JSON snippet demonstrates how to configure the `oauth-introspection` policy in API Connectivity Manager to enable SNI for OAuth Introspection requests.  It sets the `action.enableSNI` value to `true` to enable SNI, and `action.proxyTLSName` to specify the server name to use for SNI, overriding the default behavior of using the host part of `action.introspectionEndpoint`. The introspectionEndpoint specifies the URL of the OAuth2 introspection endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/introspection.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policies\": {\n        \"oauth2-introspection\": [\n            {\n                \"action\": {\n                    \"introspectionEndpoint\": \"https://example.idp.com:8443/oauth/v2/oauth-introspect\",\n                    \"enableSNI\": true,\n                    \"proxyTLSName\": \"test.oauth.com\"\n                }\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Update NGINX Configuration - Azure CLI\nDESCRIPTION: This snippet provides the Azure CLI command to update an existing NGINX configuration. It supports updating the configuration using various options, including adding or removing specific properties, specifying a new root file, or using a gzipped archive package. \nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configuration-azure-cli.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment configuration update [--add]\n                                         [--configuration-name]\n                                         [--deployment-name]\n                                         [--files]\n                                         [--force-string {0, 1, f, false, n, no, t, true, y, yes}]\n                                         [--ids]\n                                         [--location]\n                                         [--no-wait {0, 1, f, false, n, no, t, true, y, yes}]\n                                         [--remove]\n                                         [--resource-group]\n                                         [--root-file]\n                                         [--set]\n                                         [--subscription]\n```\n\n----------------------------------------\n\nTITLE: Start Keepalived Service for Testing\nDESCRIPTION: These commands start the keepalived service to verify the configuration. Requires that an IP address has been added to the `keepalived.conf` file between the `#NGINX_CONTROLLER_HA_BEGIN` and `#NGINX_CONTROLLER_HA_END` markers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/ha-data-plane.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start keepalived\n```\n\n----------------------------------------\n\nTITLE: Install NGINX RTMP Module on Debian and Ubuntu\nDESCRIPTION: This shell script updates the system and installs the nginx-plus-module-rtmp package using apt.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/rtmp.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-rtmp\n```\n\n----------------------------------------\n\nTITLE: Configure Port in app_protect_dos_monitor (nginx)\nDESCRIPTION: This configuration snippet demonstrates how to configure the `app_protect_dos_monitor` directive with the correct port. The port specified should match the port the server is listening on to avoid false attack declarations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-4.2.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 8080;\n    server_name myservice.com;\n    location / {\n        app_protect_dos_monitor \"myservice.com:8080/\";\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure License Token (NGINX)\nDESCRIPTION: This snippet shows how to update the `license_token` directive within the `mgmt` block of the NGINX configuration file to point to a custom license file path.  This configuration is applied after upgrading to R33. The `<custom_path>` should be replaced with the actual path to the license file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/licensing-and-reporting/custom-paths-jwt.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n  license_token <custom_path>;\n}\n```\n\n----------------------------------------\n\nTITLE: Remove Sidecar Proxy from Deployments (kubectl)\nDESCRIPTION: This command restarts a Kubernetes resource (Deployment, DaemonSet, or StatefulSet) to remove the sidecar proxy injected by NGINX Service Mesh. It utilizes `kubectl rollout restart` to trigger a rolling update of the resource.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/uninstall/uninstall.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl rollout restart <resource type>/<resource name>\n```\n\n----------------------------------------\n\nTITLE: Docker Compose Configuration\nDESCRIPTION: Defines the Docker Compose configuration for deploying NGINX App Protect WAF services. It specifies the services (waf-enforcer and waf-config-mgr), their images, environment variables, ports, volumes, and network settings. The configuration also defines dependencies between the services.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_8\n\nLANGUAGE: yaml\nCODE:\n```\nservices:\n  waf-enforcer:\n    container_name: waf-enforcer\n    image: private-registry.nginx.com/nap/waf-enforcer:5.2.0\n    environment:\n      - ENFORCER_PORT=50000\n    ports:\n      - \"50000:50000\"\n    volumes:\n      - /opt/app_protect/bd_config:/opt/app_protect/bd_config\n    networks:\n      - waf_network\n    restart: always\n\n  waf-config-mgr:\n    container_name: waf-config-mgr\n    image: private-registry.nginx.com/nap/waf-config-mgr:5.2.0\n    volumes:\n      - /opt/app_protect/bd_config:/opt/app_protect/bd_config\n      - /opt/app_protect/config:/opt/app_protect/config\n      - /etc/app_protect/conf:/etc/app_protect/conf\n    restart: always\n    network_mode: none\n    depends_on:\n      waf-enforcer:\n        condition: service_started\n\nnetworks:\n  waf_network:\n    driver: bridge\n```\n\n----------------------------------------\n\nTITLE: Fetch Nginx signing key for SLES\nDESCRIPTION: Downloads the Nginx signing key from the official Nginx website and saves it to a temporary file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\ncurl -o /tmp/nginx_signing.key https://nginx.org/keys/nginx_signing.key\n```\n\n----------------------------------------\n\nTITLE: Updating FQDN in NGINX Controller Agent config file\nDESCRIPTION: This snippet shows how to update the `api_url` value in the `/etc/controller-agent/agent.conf` file with the new Fully Qualified Domain Name (FQDN) for Controller Agents to connect to the NGINX Controller after the FQDN has been changed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/manage-cluster.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\n[cloud]\napi_url = https://<NEW_FQDN>:8443/1.4\n```\n\n----------------------------------------\n\nTITLE: Nikto Scan Output\nDESCRIPTION: Shows the output of a Nikto scan, displaying the number of requests made and the number of items reported. Used to assess the effectiveness of the CRS rules.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_7\n\nLANGUAGE: none\nCODE:\n```\n$ perl program/nikto.pl -h localhost\n...\n+ 7531 requests: 0 error(s) and 116 item(s) reported on remote host\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX App Protect WAF v5 Package (Debian)\nDESCRIPTION: These shell commands update the apt package list and install the NGINX App Protect WAF v5 package. The `sudo apt-get update` command refreshes the package list. `sudo apt-get install app-protect-module-plus` installs the App Protect module.  It requires `apt-get` and `sudo` to be available.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-debian.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get update\nsudo apt-get install app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Example NginxGateway resource status\nDESCRIPTION: This is an example output from describing the NginxGateway resource using `kubectl`. It shows the status of the resource, including conditions such as validity, observed generation, and last transition time. It indicates whether the NginxGateway resource is considered valid by NGINX Gateway Fabric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/control-plane-configuration.md#_snippet_2\n\nLANGUAGE: text\nCODE:\n```\n...\nStatus:\n  Conditions:\n    Last Transition Time:  2024-08-13T19:22:14Z\n    Message:               NginxGateway is valid\n    Observed Generation:   1\n    Reason:                Valid\n    Status:                True\n    Type:                  Valid\n```\n\n----------------------------------------\n\nTITLE: Expected output of nginx -t command\nDESCRIPTION: This shell command is the expected output when running 'nginx -t', indicating the configuration is valid.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/encrypted-session.md#_snippet_9\n\nLANGUAGE: Shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Instance Manager with Helm\nDESCRIPTION: This command upgrades an existing NGINX Instance Manager deployment using Helm. It sets the admin password hash, specifies the chart, uses a custom `values.yaml` file, and waits for the upgrade to complete.  It's essential for keeping NGINX Instance Manager up-to-date with the latest features and security patches.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nhelm upgrade -n nms \\\n--set adminPasswordHash=$(openssl passwd -6 'YourPassword123#') \\\nnms nginx-stable/nms-hybrid \\\n-f <path-to-your-values.yaml> \\\n[--version <chart-version>] \\\n--wait\n```\n\n----------------------------------------\n\nTITLE: keepalived.conf.erb Template (Nginx Configuration)\nDESCRIPTION: This snippet shows the content of the `nginx_plus_keepalived.conf.erb` template file, used to create the `keepalived.conf` configuration. It uses variables and attributes to pass information such as IP addresses, authentication key, and virtual IP address. The `myip` variable represents the primary IP address, and `ha_pair_ip` is an array of peer host IP addresses.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nvrrp_script chk_nginx_service {\n\n     script \"/usr/lib/keepalived/nginx-ha-check\"\n\n     interval 3\n\n     weight 50\n\n}\n\nvrrp_instance VI_1 {\n\n     interface eth1\n\n     <% if node['nginx']['ha_primary'] == \"true\" %>\n\n     state MASTER\n\n     priority 151\n\n     <% end %>\n\n     <% if node['nginx']['ha_primary'] == \"false\" %>\n\n     state BACKUP\n\n     priority 150\n\n     <% end %>\n\n     virtual_router_id 51\n\n     advert_int 1\n\n     unicast_src_ip <%= @myip %>\n\n     unicast_peer {\n\n     <% @ha_pair_ip.each do |ip| %>\n\n        <% if ip != @myip %>\n\n           <%= ip %>\n\n        <% end %>\n\n     <% end %>\n\n     }\n\n     authentication {\n\n          auth_type PASS\n\n          auth_pass <%= node['nginx']['ha_keepalived_key'] %>\n\n     }\n\n     virtual_ipaddress {\n\n          <%= node['nginx']['ha_vip'] %>\n\n     }\n\n     track_script {\n\n          chk_nginx_service\n\n     }\n\n     notify \"/usr/lib/keepalived/nginx-ha-notify\"\n\n}\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Instance Manager (Debian, Ubuntu)\nDESCRIPTION: Installs the NGINX Instance Manager package on Debian/Ubuntu-based systems using apt-get. It first updates the package list and then installs the nms-instance-manager package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get update\nsudo apt-get install -y nms-instance-manager\n```\n\n----------------------------------------\n\nTITLE: Configure gRPC timeout settings in NGINX\nDESCRIPTION: Modifies the `client_body_timeout` settings within the Nginx gRPC configuration file. This adjusts the timeout duration for gRPC connections from Nginx Agents. The values shown are example values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-gateway.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\n# gRPC service for metric ingestion\nlocation /f5.nginx.agent.sdk.MetricsService {\n    # uncomment to enable mTLS with agent\n    # auth_request /check-agent-client-cert;\n    include /etc/nms/nginx/errors-grpc.loc_conf;\n    grpc_socket_keepalive on;\n    grpc_read_timeout 5m;\n    grpc_send_timeout 5m;\n    client_body_timeout 10m;\n    grpc_pass grpc://ingestion-grpc-service;\n}\n\n# gRPC service for DPM\nlocation /f5.nginx.agent.sdk.Commander {\n    # uncomment to enable mTLS with agent\n    # auth_request /check-agent-client-cert;\n    include /etc/nms/nginx/errors-grpc.loc_conf;\n    grpc_socket_keepalive on;\n    grpc_read_timeout 5m;\n    grpc_send_timeout 5m;\n    client_body_timeout 10m;\n    grpc_pass grpc://dpm-grpc-service;\n}\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX Helm Repository (helm repo add)\nDESCRIPTION: This command adds the NGINX stable Helm repository to the local Helm configuration. It allows downloading and installing NGINX Instance Manager charts. Requires Helm to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nhelm repo add nginx-stable https://helm.nginx.com/stable\n```\n\n----------------------------------------\n\nTITLE: Complete mTLS Configuration Example\nDESCRIPTION: This snippet provides a complete example of configuring mTLS within the `mgmt` block.  It sets the resolver, SSL protocols, ciphers, client certificate, private key, trusted CA certificate, and verification depth. This is a comprehensive configuration for securing communication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/usage-tracking/agentless-reporting.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n    resolver 10.0.0.1;\n\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers   DEFAULT;\n\n    ssl_certificate     client_cert.pem;\n    ssl_certificate_key client_cert.key;\n\n    ssl_trusted_certificate  trusted_ca_cert.crt;\n    ssl_verify               on;\n    ssl_verify_depth         2;\n}\n```\n\n----------------------------------------\n\nTITLE: Stopping keepalived Service\nDESCRIPTION: This command stops the keepalived daemon, simulating a failure of the primary instance. This allows testing of the failover mechanism to ensure that the backup instance takes over and the Elastic IP address is reassigned.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-keepalived.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nsudo service keepalived stop\n```\n\n----------------------------------------\n\nTITLE: Moving NGINX Signing Key\nDESCRIPTION: Moves the downloaded NGINX signing key to the /etc/apk/keys/ directory, making it trusted by the apk package manager for package verification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_24\n\nLANGUAGE: shell\nCODE:\n```\nsudo mv /tmp/nginx_signing.rsa.pub /etc/apk/keys/\n```\n\n----------------------------------------\n\nTITLE: Describe Gateways using kubectl\nDESCRIPTION: This command retrieves detailed information about Gateway resources. This is used to inspect gateway configurations, status, conditions and associated listeners. It helps verify that the gateway has been accepted, programmed and is resolving routes properly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe gateways\n```\n\n----------------------------------------\n\nTITLE: Deleting File Type from App Protect Policy (JSON)\nDESCRIPTION: This snippet demonstrates how to remove a specific file type (in this case, 'log') from the disallowed file types list in an App Protect policy using the `modifications` section.  The `entityChanges` is set to `explicit`, the `entity` specifies the file name to remove, the `action` is set to `delete` and the `entityType` is `filetype`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/modifying-configurations.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"modifying_disallowed_file_types\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\"\n    },\n    \"modifications\": [\n        {\n            \"entityChanges\": {\n                \"type\": \"explicit\"\n            },\n            \"entity\": {\n                \"name\": \"log\"\n            },\n            \"action\": \"delete\",\n            \"entityType\": \"filetype\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Querying Metrics API with Resolution\nDESCRIPTION: This curl command queries the Metrics API with a specified resolution.  The `resolution` parameter is used to define data granularity. It retrieves the sum of `nginx.http.request.count` for the last 12 hours, with a one-hour resolution.  Aggregation function and a time window (at least `startTime`) must be provided, and a valid access token is required.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/metrics?names=SUM(nginx.http.request.count)&startTime=now-12h&resolution=1h\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Check Traffic Metrics with Mesh CLI\nDESCRIPTION: This command uses the NGINX Service Mesh CLI (`nginx-meshctl`) to check the traffic metrics for the deployed services.  It displays the incoming and outgoing success rates and the number of requests for each deployment, providing a quick overview of traffic flow and potential issues.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl top\n```\n\n----------------------------------------\n\nTITLE: Port-Forwarding to Productpage Service\nDESCRIPTION: This command creates a local port forward to the `productpage` service running within the Kubernetes cluster. This allows you to access the service from your local machine via `localhost:9080`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/deploy-example-app.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nkubectl port-forward svc/productpage 9080\n```\n\n----------------------------------------\n\nTITLE: Description of system.net.bytes_rcvd and system.net.bytes_sent metrics\nDESCRIPTION: Provides the type and description for the system.net.bytes_rcvd and system.net.bytes_sent metrics which is a counter in bytes representing Network I/O statistics. Number of bytes received or sent, per network interface.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_8\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, bytes\nDescription: Network I/O statistics. Number of bytes received or sent, per network\n               interface.\n```\n\n----------------------------------------\n\nTITLE: Setting working directory in Nginx config\nDESCRIPTION: Specifies the directory where core dump files will be stored in the NGINX configuration.  The `working_directory` directive must be specified in the `main` configuration context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_22\n\nLANGUAGE: nginx\nCODE:\n```\nworking_directory /tmp/cores/;\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Service Mesh Release via Helm Source\nDESCRIPTION: This snippet upgrades the NGINX Service Mesh release `nsm` in the `nginx-mesh` namespace using the local Helm chart. The current directory is expected to contain the chart. The `--wait` flag ensures the upgrade operation waits until all resources are ready.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade-with-helm.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nhelm upgrade nsm . --namespace nginx-mesh --wait\n```\n\n----------------------------------------\n\nTITLE: Enabling the API Directive NGINX\nDESCRIPTION: This snippet adds the `api` directive within the `/api` location block. This directive enables the NGINX Plus API for handling configuration requests. It is the core directive to expose the API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    server {\n        location /api {\n            api;\n            # ...\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create Infrastructure Workspace (JSON)\nDESCRIPTION: This snippet shows the JSON payload for creating an infrastructure workspace in API Connectivity Manager. The workspace is a logical grouping for environments and proxies. The minimum configuration requires a `name` field.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/enable-metrics.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"infra-ws\"\n}\n```\n\n----------------------------------------\n\nTITLE: Example API Calls using curl\nDESCRIPTION: These curl commands demonstrate how to retrieve data from the NGINX Plus API. The `-s` option is used to suppress output of the curl progress meter, and the URL specifies the API endpoint.  The `fields` parameter can filter the displayed data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_29\n\nLANGUAGE: shell\nCODE:\n```\ncurl -s 'https://demo.nginx.com/api/9/'\ncurl -s 'https://demo.nginx.com/api/9/nginx?fields=version,build'\ncurl -s 'https://demo.nginx.com/api/9/http/caches/http_cache'\ncurl -s 'https://demo.nginx.com/api/9/http/upstreams/'\ncurl -s 'https://demo.nginx.com/api/9/http/upstreams/demo-backend'\ncurl -s 'https://demo.nginx.com/api/9/http/upstreams/demo-backend/servers/0'\n```\n\n----------------------------------------\n\nTITLE: Check NGINX Plus Version\nDESCRIPTION: This command verifies the installed version of NGINX Plus.  It should output NGINX Plus Release 34 or later to ensure compatibility with the OIDC module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/auth0.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nnginx -v\n```\n\n----------------------------------------\n\nTITLE: Example HTTP Redirect Response for tea with type(Text)\nDESCRIPTION: This example HTTP response for `http://cafe.example.com/tea/type`, showcasing a 302 Moved Temporarily response with the new location `http://cafe.example.com:8080/organic/type`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_10\n\nLANGUAGE: text\nCODE:\n```\nHTTP/1.1 302 Moved Temporarily\n..\nLocation: http://cafe.example.com:8080/organic/type\n```\n\n----------------------------------------\n\nTITLE: Querying Security Violation Events by Signature ID\nDESCRIPTION: This example shows how to retrieve events that triggered a specific signature-based violation by signature ID, using the NGINX Controller REST API. A substring search using wildcards is used. The startTime is set to 0 and endTime to now.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/view-app-security-analytics.md#_snippet_9\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            waf.signature_ids ='*200000098*' and\n            app='shopping' and\n            environment='prod' and\n            component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Azure CLI: Create Role Assignment for Key Vault Secrets User\nDESCRIPTION: This code snippet creates a role assignment for the 'Key Vault Secrets User' role using the Azure CLI. It requires the `$mi_principal_id` (principal ID of the managed identity) and `$key_vault_id` (resource ID of the key vault) variables to be set. This command grants the managed identity permission to read secrets from the specified key vault.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\naz role assignment create --assignee $mi_principal_id \\\n      --role \"Key Vault Secrets User\" \\\n      --scope $key_vault_id\n```\n\n----------------------------------------\n\nTITLE: Installing Encrypted Session module on Debian and Ubuntu\nDESCRIPTION: This shell script updates the package manager and installs the `nginx-plus-module-encrypted-session` package using apt.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/encrypted-session.md#_snippet_2\n\nLANGUAGE: Shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-encrypted-session\n```\n\n----------------------------------------\n\nTITLE: Reloading Keepalived Service (Shell)\nDESCRIPTION: This command reloads the Keepalived service to apply configuration changes. It needs to be executed on both the primary and backup nodes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\ncentos7-1 $ service keepalived reload\ncentos7-2 $ service keepalived reload\n```\n\n----------------------------------------\n\nTITLE: Add Node to NGINX Controller Cluster\nDESCRIPTION: This script is used to add a node to an existing NGINX Controller cluster. It requires the `controller-installer-<version>.tar.gz` tarball to be uploaded and extracted, and a join-key obtained from the NGINX Controller web interface.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/resilient-cluster-private-cloud.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./install.sh --join-key <long-value>\n```\n\n----------------------------------------\n\nTITLE: Check NGINX Instance Manager Deployment Status\nDESCRIPTION: This command checks the status of the NGINX Instance Manager deployment using Helm. It confirms whether the deployment was successful by verifying that the status is `STATUS: deployed`. It is used to validate that the application has been installed and is running correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nhelm -n nms status nms\n```\n\n----------------------------------------\n\nTITLE: Define Instance Group in Dockerfile (Bash)\nDESCRIPTION: This snippet shows how to define the instance group name in the Dockerfile for building an NGINX Controller-enabled NGINX Plus image. The `INSTANCE_GROUP` argument and `ENV_CONTROLLER_INSTANCE_GROUP` environment variable are used to specify the instance group. This ensures that the NGINX Plus instance is associated with the correct instance group in NGINX Controller.  It requires that an instance group has already been created in NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-containerized-instances.md#_snippet_1\n\nLANGUAGE: Bash\nCODE:\n```\n# example Instance group already defined in NGINX Controller\nARG INSTANCE_GROUP=k8s-nginx-deploy\nENV ENV_CONTROLLER_INSTANCE_GROUP=$INSTANCE_GROUP\n```\n\n----------------------------------------\n\nTITLE: Uploading Telemetry Report to F5 Licensing Endpoint\nDESCRIPTION: Uploads the telemetry report to F5's licensing endpoint using `curl`. It uses the `$bearer_token` and `$report_save_path` variables, utilizing the `--form` option to send the file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nupload_command=\"curl --location 'https://product.apis.f5.com/ee/v1/entitlements/telemetry/bulk' \\\n--header 'Authorization: Bearer $bearer_token' \\\n--form 'file=@\\\"$report_save_path\\\"'\"\n```\n\n----------------------------------------\n\nTITLE: Update repository information\nDESCRIPTION: Updates the repository information using apt. This command refreshes the package lists from the configured repositories.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/pin-to-version/pin-debian-ubuntu-R32.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update\n```\n\n----------------------------------------\n\nTITLE: Nginx Configuration for Pattern-Matching Cache Splitting\nDESCRIPTION: This Nginx configuration snippet is generated based on the pattern-matching cache splitting configuration. It includes the map directive, proxy_cache_path directives for each disk store, and configures the location block with proxy_cache, add_header, and proxy_cache_valid directives. The hl_lines attribute highlights key lines related to the cache splitting configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-caching.md#_snippet_5\n\nLANGUAGE: Nginx configuration file\nCODE:\n```\nmap $request_uri $cache_8de5273e13f731e283acbc999760c3e3 {\n    ~.html$ app_centric_env|app|split_string|/tmp/hdd1;\n    ~.mp4$ app_centric_env|app|split_string|/tmp/hdd2;\n    default app_centric_env|app|split_string|/tmp/default;\n}\nproxy_cache_path /tmp/hdd1/app_centric_env|app|split_string| max_size=2G min_free=1m keys_zone=app_centric_env|app|split_string|/tmp/hdd1:10m purger=off inactive=1m;\nproxy_cache_path /tmp/hdd2/app_centric_env|app|split_string| max_size=1g min_free=10k keys_zone=app_centric_env|app|split_string|/tmp/hdd2:50m purger=off inactive=1m;\nproxy_cache_path /tmp/default/app_centric_env|app|split_string| max_size=2g min_free=10k keys_zone=app_centric_env|app|split_string|/tmp/default:30m purger=off inactive=1m;\nupstream wg_http_0ace772a-0c68-4d01-a443-6e377d4f6133 {\n    zone wg_http_0ace772a-0c68-4d01-a443-6e377d4f6133 160k;\n    server 10.146.187.154:80;\n    keepalive 64;\n    keepalive_requests 100;\n    keepalive_timeout 60s;\n}\nmap $host $f5_published_api {\n    default -;\n}\nserver {\n    server_name test.example.com;\n    listen 80 reuseport;\n    status_zone server_4d1ee345-cf08-354e-93dc-1c3a844a04e3;\n    set $f5_gateway gw;\n    f5_metrics_marker gateway $f5_gateway;\n    set $f5_environment env;\n    f5_metrics_marker environment $f5_environment;\n    location / {\n        error_log /dev/null;\n        access_log off;\n        proxy_cache $cache_8de5273e13f731e283acbc999760c3e3;\n        set $f5_app app;\n        f5_metrics_marker app $f5_app;\n        set $f5_component split_string;\n        f5_metrics_marker component $f5_component;\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_set_header Host $host;\n        proxy_set_header Connection '';\n        proxy_http_version 1.1;\n        add_header Cache $upstream_cache_status;\n        proxy_cache_valid any 1m;\n        proxy_pass <http://wg_http_0ace772a-0c68-4d01-a443-6e377d4f6133;>\n    }\n}\n\n```\n\n----------------------------------------\n\nTITLE: Define Volumes in Dockerfile (Dockerfile)\nDESCRIPTION: This Dockerfile defines Docker volumes for the content and configuration directories within the Nginx container. It copies the content directory to /usr/share/nginx/html and the conf directory to /etc/nginx, then defines these directories as volumes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_23\n\nLANGUAGE: dockerfile\nCODE:\n```\nFROM nginx\nCOPY content /usr/share/nginx/html\nCOPY conf /etc/nginx\nVOLUME /usr/share/nginx/html\nVOLUME /etc/nginx\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Developer Portal (RPM-Based) - Bash\nDESCRIPTION: Upgrades the NGINX Developer Portal and UI packages on RPM-based systems (CentOS, RHEL) using `yum update`. The `--nogpgcheck` option bypasses GPG signature verification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-devportal-offline.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum -y --nogpgcheck update /home/user/nginx-devportal_<version>.x86_64.rpm\nsudo yum -y --nogpgcheck update /home/user/nginx-devportal-ui_<version>.x86_64.rpm\n```\n\n----------------------------------------\n\nTITLE: Installing yum-utils on Amazon Linux 2023\nDESCRIPTION: This command installs the yum-utils package on Amazon Linux 2023. This package provides various utilities for managing yum repositories and packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_16\n\nLANGUAGE: script\nCODE:\n```\nsudo dnf install yum-utils\n```\n\n----------------------------------------\n\nTITLE: Base64 Decode NGINX Configuration\nDESCRIPTION: This command decodes a base64 encoded NGINX configuration. The input is a base64 string, and the output is the human-readable Nginx configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configurations-terraform.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\n$ echo aHR0cCB7CiAgICBzZXJ2ZXIgewogICAgICAgIGxvY2F0aW9uIC8gewogICAgICAgICAgICByZXR1cm4gMjAwICJIZWxsbyBXb3JsZCEiOwogICAgICAgIH0KICAgIH0KfQoK | base64 --decode\nhttp {\n    server {\n        location / {\n            return 200 \"Hello World!\";\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Active Directory Connection URI (LDAPS)\nDESCRIPTION: This code snippet presents an example of a secure connection URI using LDAPS for establishing an encrypted connection to an Active Directory server. LDAPS ensures data confidentiality and integrity during transmission. It's recommended to use LDAPS in production environments to protect sensitive data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_4\n\nLANGUAGE: none\nCODE:\n```\nldaps://dc2.mydomain2.com\n```\n\n----------------------------------------\n\nTITLE: Running the Support Package Script with Config File (Bash)\nDESCRIPTION: Executes the `support-package.sh` script, specifying a custom configuration file path using the `-c` flag. Requires root privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/support/support-package.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo bash /etc/nms/scripts/support-package.sh -c /your/config.conf\n```\n\n----------------------------------------\n\nTITLE: Downloading Enhanced Tomcat Configuration (Shell)\nDESCRIPTION: These commands change the directory and then use curl to download the enhanced tomcat configuration from the nginx.com website and save it as tomcat-enhanced.conf.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_7\n\nLANGUAGE: none\nCODE:\n```\nroot# cd /etc/nginx/conf.d\nroot# curl https://www.nginx.com/resource/conf/tomcat-enhanced.conf > tomcat-enhanced.conf\n```\n\n----------------------------------------\n\nTITLE: Run Nikto Scanning Tool\nDESCRIPTION: This snippet demonstrates how to clone the Nikto scanning tool from GitHub, navigate to the Nikto directory, and run it against a local web application. The output shows the number of potential vulnerabilities reported.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\n$ git clone https://github.com/sullo/nikto\nCloning into 'nikto'...\n$ cd nikto\n$ perl program/nikto.pl -h localhost\n- Nikto v2.1.6\n...\n+ 7531 requests: 0 error(s) and 324 item(s) reported on remote host\n```\n\n----------------------------------------\n\nTITLE: Restarting NGINX Agent\nDESCRIPTION: This snippet shows the command to restart the NGINX Agent service on a Linux system.  Restarting the agent is necessary after modifying its configuration file, such as when adding an instance to a Config Sync Group. This ensures that the agent picks up the new configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/config-sync-groups/manage-config-sync-groups.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Upgrading NGINX Plus (Unprivileged)\nDESCRIPTION: This command upgrades an existing unprivileged installation of NGINX Plus using `ngxunprivinst.sh`.  Replace `<path>` with the installation path and `<file1.rpm>` and `<file2.rpm>` with the names of the new NGINX Plus package files. The `-y` parameter performs a forced upgrade without confirmation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_46\n\nLANGUAGE: shell\nCODE:\n```\n./ngxunprivinst.sh upgrade [-y] -p <path> <file1.rpm> <file2.rpm>\n```\n\n----------------------------------------\n\nTITLE: Configuring Database Connection with Environment Variables (Bash)\nDESCRIPTION: This code snippet demonstrates how to configure the database connection for NGINX Controller using environment variables. It sets variables for the database host, port, username, password, SSL enablement, and then executes the `helper.sh configdb` script to apply the configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nCTR_DB_HOST=192.0.2.1 \\\nCTR_DB_PORT=5432 \\\nCTR_DB_USER=user1 \\\nCTR_DB_PASS=<password> \\\nCTR_DB_ENABLE_SSL=false \\\n/opt/nginx-controller/helper.sh configdb\n```\n\n----------------------------------------\n\nTITLE: WebSocket Proxy HTTP Gateway Configuration\nDESCRIPTION: This snippet configures an HTTP gateway to handle WebSocket connections by defining a map directive and server configuration using the httpSnippet. It defines how the $http_upgrade and $connection_upgrade variables will be handled to properly upgrade the connection to WebSocket.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-snippets.md#_snippet_5\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"<gateway-name>\"\n    },\n    \"desiredState\": {\n        \"configSnippets\": {\n            \"httpSnippet\": {\n                \"directives\": [\n                    {\n                        \"directive\": \"map\",\n                        \"args\": [\"$http_upgrade\", \"$connection_upgrade\"],\n                        \"block\": [\n                            {\n                                \"directive\": \"default\",\n                                \"args\": [\"upgrade\"]\n                            },\n                            {\n                                \"directive\": \"''\",\n                                \"args\": [\"close\"]\n                            }\n                        ]\n                    }\n                ]\n            }\n        },\n        \"ingress\": {\n            \"uris\": {\n                \"http://example.com:8020\": {}\n            },\n            \"placement\":  {\n                \"instanceRefs\": [\n                    {\n                        \"ref\": \"/infrastructure/locations/unspecified/instances/<instance-name>\"\n                    }\n                ]\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install ModSecurity Module on RHEL/CentOS\nDESCRIPTION: This command uses the yum package manager to install the NGINX ModSecurity dynamic module from the NGINX Plus module repository on RHEL and CentOS systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\nsudo yum install nginx-plus-module-modsecurity\n```\n\n----------------------------------------\n\nTITLE: Configure JSESSIONID-Based Session Persistence - Nginx\nDESCRIPTION: This configures JSESSIONID-based session persistence in Nginx using the sticky learn method.  It defines an upstream block 'myapp' with three backend servers and uses 'sticky learn' to learn the JSESSIONID from the upstream server's cookie, look it up in the client's cookie, and store the session information in the 'client_sessions' zone with a size of 1MB.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nupstream myapp {\n    server 10.0.0.100:80;\n    server 10.0.0.101:80;\n    server 10.0.0.102:80;\n    sticky learn create=$upstream_cookie_jsessionid\n                 lookup=$cookie_jsessionid\n                 zone=client_sessions:1m;\n}\n```\n\n----------------------------------------\n\nTITLE: Disable Network Policies in values.yaml\nDESCRIPTION: This YAML snippet disables network policies for NGINX Instance Manager. By setting `enabled` to `false` under the `networkPolicies` section, the Helm chart will not create network policies during deployment, allowing all network traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_18\n\nLANGUAGE: yaml\nCODE:\n```\nnms-hybrid:\n   networkPolicies:\n      # Set this to true to enable network policies for NGINX Instance Manager.\n      enabled: false\n```\n\n----------------------------------------\n\nTITLE: Configuring Custom Cache Key\nDESCRIPTION: This configuration snippet demonstrates how to customize the cache key used by NGINX. In this case, it adds the JSESSIONID cookie to the cache key, enabling per-user caching.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_23\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_key $proxy_host$request_uri$cookie_jessionid;\n```\n\n----------------------------------------\n\nTITLE: Get Keycloak Configuration Example\nDESCRIPTION: This command retrieves the Keycloak server's OpenID Connect configuration, including endpoint URLs for authorization, token retrieval, and token introspection. The output is formatted using `jq` for readability. Requires `curl` and `jq` to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\ncurl -L -X GET http://192.0.2.5:8080/realms/nginx/.well-known/openid-configuration | jq\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect DoS Monitor Configuration (Old Syntax)\nDESCRIPTION: This code snippet demonstrates the old syntax for configuring the `app_protect_dos_monitor` directive in an NGINX server block. It specifies the URI to monitor for DoS attacks. The port configuration must match the port the server is listening on to avoid false attack declarations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-2.3.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nserver {\n    listen 8080;\n    server_name myservice.com;\n    location / {\n        app_protect_dos_monitor \"myservice.com:8080/\";\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Restricting Access to Default Strategy - JSON\nDESCRIPTION: This JSON snippet configures a role named `defaultStrategy-none` that denies users access to the default security strategy.  It assigns `NONE` permission to the `balanced_default` strategy, preventing users with this role from viewing, referencing, or modifying the default strategy. This is part of a PUT request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/using-rbac-with-app-security.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"defaultStrategy-none\",\n        \"displayName\": \"Default Security Strategy - No Access\",\n        \"description\": \"This role deny users access to the Default Security Strategy\"\n    },\n    \"desiredState\": {\n        \"permissions\": [\n            {\n                \"path\": \"/security/strategies/balanced_default\",\n                \"access\": \"NONE\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Get NGINX Ingress Controller Service\nDESCRIPTION: This command retrieves the service information for the NGINX Ingress Controller, specifically to identify the exposed UDP port. It uses `kubectl` to query the Kubernetes cluster for the `nginx-ingress` namespace and displays the service details, including the port mapping.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-udp-walkthrough.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n$ kubectl get svc -n nginx-ingress\nNAME                    TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE\nnginx-ingress           NodePort   10.120.10.134   <none>        80:32705/TCP,443:30181/TCP   57m\nudp-listener-nodeport   NodePort   10.120.4.106    <none>        8900:31839/UDP               6m35s\n```\n\n----------------------------------------\n\nTITLE: Extract Support Package Archive\nDESCRIPTION: This command extracts the contents of the support package tar archive using the tar command.  The archive contains system and service information, logs, and a database snapshot, which are useful for troubleshooting and debugging NGINX Developer Portal issues. The filename includes a timestamp.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/devportal-support-package.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ntar -xvf support-pkg-<timestamp>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Attack Signature Detection Shell Example\nDESCRIPTION: This snippet shows an example of an 'Attack signature detected' report from NGINX App Protect DoS. It includes information about the detected signature, such as its ID, efficiency, accuracy, and the signature pattern.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/security-log.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ndate_time=\"Apr 29 2021 14:02:56\",\nproduct=\"app-protect-dos\",\nproduct_version=\"23+1.54.1-1.el7.ngx\",\nunit_hostname=\"localhost.localdomain\",\ninstance_id=\"d9a6d8\",\nvs_name=\"example.com/\",\ndos_attack_id=\"1\",\nattack_event=\"Attack signature detected\",\nsignature=\"(http.user_agent_header_exists eq true) and (http.accept contains other-than(application|audio|message|text|image|multipart)) and (http.unknown_header_exists eq true) and (http.headers_count neq 10) and (http.x_forwarded_for_header_exists eq false) and (http.uri_parameters eq 1) and (http.uri_len between 48-63) and (http.accept_header_exists eq true) and (http.hdrorder not-hashes-to 55) and (http.connection_header_exists eq true) and (http.accept_encoding_header_exists eq true) and (http.request.method eq reserved) and (http.cookie_header_exists eq true) and (http.uri_file hashes-to 7) and (http.host_header_exists eq true)\",\nsignature_id=\"809655398\",\nsignature_efficiency=\"72.00\",\nsignature_accuracy=\"100.00\"\n```\n\n----------------------------------------\n\nTITLE: Nikto Scan Output After Site Files Disabled\nDESCRIPTION: Shows the reduced output from a Nikto scan after disabling requests for site files. This demonstrates the effectiveness of the configuration change in reducing the number of reported items.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_10\n\nLANGUAGE: none\nCODE:\n```\n$ perl program/nikto.pl -h localhost\n- Nikto v2.1.6\n...\n+ 7435 requests: 0 error(s) and 26 item(s) reported on remote host\n```\n\n----------------------------------------\n\nTITLE: Install Set-Misc Module on FreeBSD\nDESCRIPTION: This snippet shows how to install the nginx-plus-module-set-misc package on FreeBSD using the pkg package manager. The package repository is updated first, followed by the module installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/set-misc.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-set-misc\n```\n\n----------------------------------------\n\nTITLE: Commenting Out Basic Auth Proxy Headers\nDESCRIPTION: This YAML snippet disables passing Basic Auth user information to the upstream application. It is part of the process of disabling Basic Auth in favor of OIDC.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_12\n\nLANGUAGE: yaml\nCODE:\n```\n# HTTP Basic:\n#proxy_set_header Nginx-Management-Suite-User $remote_user;\n#proxy_set_header Nginx-Management-Suite-Groups \"\";\n#proxy_set_header Nginx-Management-Suite-ExternalId \"\";\n```\n\n----------------------------------------\n\nTITLE: Download Usage Acknowledgement from F5 via REST API (curl)\nDESCRIPTION: This curl command downloads the usage acknowledgement from F5 using the F5 Product APIs. It sends a GET request to the `/ee/v1/entitlements/telemetry/bulk/download/<report-id>` endpoint, replacing `<report-id>` with the specific report ID. Requires a JWT for authorization.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/report-usage-disconnected-deployment.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\ncurl --location 'https://product.apis.f5.com/ee/v1/entitlements/telemetry/bulk/download/<report-id>' \\\n--header \"Authorization: Bearer $(cat /path/to/jwt-file)\" \\\n--output <path-to-acknowledgement>.zip\n```\n\n----------------------------------------\n\nTITLE: Delete Nginx Service Mesh Namespace via Kubectl\nDESCRIPTION: This command deletes the `nginx-mesh` namespace, completely removing the existing mesh.  This should only be performed in a manual upgrade scenario.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade-with-helm.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete namespace nginx-mesh\n```\n\n----------------------------------------\n\nTITLE: Traffic Statistics All Drivers\nDESCRIPTION: This `nginx-meshctl top` output reflects traffic from both the allowed and disallowed drivers before any traffic rules are applied, showing that both drivers are successfully sending requests to the destination.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl top\nDeployment         Incoming Success  Outgoing Success  NumRequests\ndriver-allowed                       100.00%           15\ndriver-disallowed                    100.00%           15\ndest-svc           100.00%                             30\n```\n\n----------------------------------------\n\nTITLE: Retrieving Events by Attack Type (curl)\nDESCRIPTION: This query retrieves security violation events triggered by a particular attack type, filtered by application components.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/view-app-security-analytics.md#_snippet_11\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            waf.attack_types='*Non-browser Client, Abuse of Functionality*' and\n            app='shopping' and\n            environment='prod' and\n            component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Request to Echo Server with Custom Header - Bash\nDESCRIPTION: This bash snippet illustrates how to send a request to the echo server with the access token placed in a custom header named `apiAccessToken`. It shows the structure of the HTTP request, emphasizing the placement of the JWT token in the specified header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_33\n\nLANGUAGE: bash\nCODE:\n```\nPOST https://192.0.2.4/my/test/api\nHEADERS:\n  apiAccessToken: '<JWT_token>'\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx Configuration\nDESCRIPTION: This shell command reloads the Nginx configuration without interrupting existing connections. This is used to apply changes made to the `nginx.conf` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/image-filter.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Upgrade API Connectivity Manager on Debian/Ubuntu\nDESCRIPTION: This command upgrades the API Connectivity Manager on Debian or Ubuntu-based systems.  It first updates the package lists, then uses `apt-get` to install the newest version, upgrading only the specified package with the `--only-upgrade` flag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get update\nsudo apt-get install -y --only-upgrade nms-api-connectivity-manager\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Volume Mount for Nginx Plus License\nDESCRIPTION: Defines a Kubernetes volume mount for the `nginx` container, mounting the `nginx-plus-license` volume at `/etc/nginx/license.jwt` and specifying `license.jwt` as a subPath.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/nginx-plus-jwt.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\n- mountPath: /etc/nginx/license.jwt\n  name: nginx-plus-license\n  subPath: license.jwt\n```\n\n----------------------------------------\n\nTITLE: Configuring Nginx Plus Status API URL\nDESCRIPTION: Demonstrates how to override the URI detection of the Nginx Plus status API in the agent.conf file. If only the URI is specified, the agent will use http://127.0.0.1 to construct the full URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/configuring-amplify-agent.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\n[nginx]\n..\nplus_status = /status\n```\n\n----------------------------------------\n\nTITLE: Applying Nginx ConfigMap Manifest\nDESCRIPTION: This command applies a Kubernetes manifest file to update the config map and enable the PROXY protocol for the NGINX Plus Ingress Controller. It uses `kubectl apply` with the `-f` flag to specify the manifest file location. It configures the Nginx Ingress Controller to trust the PROXY protocol header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_7\n\nLANGUAGE: Shell\nCODE:\n```\nkubectl apply -f deployments/common/nginx-config.yaml\n```\n\n----------------------------------------\n\nTITLE: Circuit Breaker Fallback Configuration YAML\nDESCRIPTION: This YAML snippet demonstrates how to configure the fallback service for a CircuitBreaker resource. It specifies the name and port of a Kubernetes Service to which traffic is re-routed when the circuit breaker is tripped. If no namespace or port is defined, the default values are `default` and `80`, respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/smi-traffic-policies.md#_snippet_8\n\nLANGUAGE: yaml\nCODE:\n```\nfallback:\n  name: \"my-namespace/fallback-svc\"\n  port: 8080\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Amplify Agent (Ubuntu/Debian - Bash)\nDESCRIPTION: Installs the NGINX Amplify Agent package using `apt-get install`. This command installs the amplify agent, along with the required dependencies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\napt-get install nginx-amplify-agent\n```\n\n----------------------------------------\n\nTITLE: Forbidden Request Example\nDESCRIPTION: Example output from a failed request after applying access controls.  The 'disallowed' driver now receives a 403 Forbidden error due to the applied TrafficTarget and HTTPRouteGroup configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\n*   Trying 10.100.5.18:8080...\n* Connected to dest-svc (10.100.5.18) port 8080 (#0)\n> GET /echo HTTP/1.1\n> Host: dest-svc:8080\n> User-Agent: curl/7.72.0-DEV\n> Accept: */*\n> x-demo-1:demo-1\n> x-demo-2:demo-2\n> x-demo-3:demo-3\n>\n* Mark bundle as not supporting multiuse\n< HTTP/1.1 403 Forbidden\n< Server: nginx/1.19.0\n< Date: Wed, 23 Sep 2020 23:53:56 GMT\n< Content-Type: text/html\n< Content-Length: 153\n< Connection: keep-alive\n<\n{ [153 bytes data]\n* Connection #0 to host dest-svc left intact\n<html>\n<head><title>403 Forbidden</title></head>\n<body>\n<center><h1>403 Forbidden</h1></center>\n<hr><center>nginx/1.19.0</center>\n</body>\n</html>\n```\n\n----------------------------------------\n\nTITLE: Helm Upgrade Chart\nDESCRIPTION: Upgrades an existing Helm release. Replace `<release-name>` with the name of the release you want to upgrade.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-helm.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nhelm upgrade <release-name> .\n```\n\n----------------------------------------\n\nTITLE: Send Traffic to Coffee v2 with Query Parameter\nDESCRIPTION: Sends a request to the coffee application with a query parameter 'TEST'. This request is routed to the `coffee-v2` pod because the query parameter matches the conditions defined in the HTTPRoute.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee?TEST=v2\n```\n\n----------------------------------------\n\nTITLE: Configuring IP Address-Based Access Control Lists (ACLs)\nDESCRIPTION: This snippet configures IP address-based access control lists (ACLs) to restrict access to the NGINX Plus API. It allows access only from the specified network (10.0.0.0/8) and denies access from all other networks.  The `allow` and `deny` directives are used to control access based on IP addresses.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_31\n\nLANGUAGE: nginx\nCODE:\n```\nallow 10.0.0.0/8;\ndeny all;\n```\n\n----------------------------------------\n\nTITLE: Verify Kubernetes Secret\nDESCRIPTION: This snippet retrieves the Kubernetes secret `regcred` in YAML format to verify its contents. It ensures that the secret was created successfully and contains the expected information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get secret regcred --output=yaml\n```\n\n----------------------------------------\n\nTITLE: Get Metrics Catalog with curl\nDESCRIPTION: This command retrieves the full list of metrics and dimensions available in the Nginx Controller Analytics catalog.  It requires a valid session cookie for authentication. The endpoint returns a JSON payload with descriptions of available metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/view-traffic-metrics.md#_snippet_0\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{Controller-FQDN}/api/v1/analytics/catalogs/metrics\"\n```\n\n----------------------------------------\n\nTITLE: Add Instance Group to NGINX Agent Config (YAML)\nDESCRIPTION: This snippet demonstrates how to specify an instance group in the `/var/lib/nginx-agent/agent-dynamic.conf` file. This allows the NGINX Agent to automatically register the instance with the specified group.  The `instance_group` parameter is set to the desired group name. This requires NGINX Agent to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/manage-instance-groups.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\n#\n# /etc/nginx-agent/dynamic-agent.conf\n#\n# Dynamic configuration file for NGINX Agent.\n#\n# The purpose of this file is to track agent configuration\n# values that can be dynamically changed via the API and the agent install script.\n# You may edit this file, but API calls that modify the tags on this system will\n# overwrite the tag values in this file.\n#\n# The agent configuration values that API calls can modify are as follows:\n#    - tags\n#\n# The agent configuration values that the agent install script can modify are as follows:\n#    - instance_group\n\ninstance_group: default\n```\n\n----------------------------------------\n\nTITLE: Run Update Script - Bash\nDESCRIPTION: This command runs the `update.sh` script, which updates the NGINX Controller instance on the node to a newer version.  It assumes the script is located in the `controller-installer` directory. This should be run on each node in the cluster sequentially.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/resilient-cluster-private-cloud.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./update.sh\n```\n\n----------------------------------------\n\nTITLE: Restarting nginx-agent - Shell\nDESCRIPTION: This command restarts the nginx-agent process. This is necessary after changing the `precompiled_publication` setting in `/etc/nginx-agent/nginx-agent.conf`. Restarting the agent ensures the new configuration takes effect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/known-issues.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Enable dynamic loading of njs modules in Nginx configuration\nDESCRIPTION: This snippet shows how to enable dynamic loading of the njs modules in the Nginx configuration file (`nginx.conf`). It uses the `load_module` directive to load the HTTP and stream njs modules.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginscript.md#_snippet_6\n\nLANGUAGE: Nginx\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\nload_module modules/ngx_stream_js_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Update yum repository for Nginx on RHEL/CentOS\nDESCRIPTION: This command updates the yum package repository information, ensuring that the system has the latest package lists. It's required before installing or updating any packages using yum. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update\n```\n\n----------------------------------------\n\nTITLE: Defining Rate Limit with Delay Set to Nodelay in YAML\nDESCRIPTION: This YAML configuration modifies the RateLimit resource 'ratelimit-burst' to include the 'delay: nodelay' setting.  This setting ensures that burst requests are forwarded immediately without being delayed, preventing the requests from being queued.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_23\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi.nginx.com/v1alpha2\nkind: RateLimit\nmetadata:\n  name: ratelimit-burst\n  namespace: default\nspec:\n  destination:\n    kind: Service\n    name: dest-svc\n    namespace: default\n  sources:\n  - kind: Deployment\n    name: bursty-client\n    namespace: default\n  name: ratelimit-burst\n  rate: 1r/s\n  burst: 2\n  delay: nodelay\n```\n\n----------------------------------------\n\nTITLE: Upgrade CRDs for NGINX Service Mesh using Kubectl\nDESCRIPTION: This snippet clones the NGINX Service Mesh repository, checks out a specific version, and applies the CRDs using kubectl. This ensures the custom resource definitions are updated before upgrading the Helm release. The v2.0.0 version is used as an example, but should be updated to match the target upgrade version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade-with-helm.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ngit clone https://github.com/nginxinc/nginx-service-mesh\ncd nginx-service-mesh/helm-chart\ngit checkout v2.0.0\nkubectl apply -f crds/\n```\n\n----------------------------------------\n\nTITLE: Tagging a Docker image\nDESCRIPTION: This command tags a Docker image from the NGINX private registry so that it can be pushed to your own private registry.  Replace <my-docker-registry> with the path to your private registry and <version-tag> with the desired version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ndocker tag private-registry.nginx.com/nginx-plus/base:<version-tag> <my-docker-registry>/nginx-plus/base:<version-tag>\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Plus Repository (CentOS/RHEL - Shell)\nDESCRIPTION: This command downloads the `nginx-plus-7.4.repo` file from the specified URL and saves it to the `/etc/yum.repos.d` directory. This file contains the repository configuration required for accessing NGINX Plus packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Gateway Fabric from OCI Registry (NGINX Plus)\nDESCRIPTION: This command installs the latest stable release of NGINX Gateway Fabric for NGINX Plus in the 'nginx-gateway' namespace. It configures the image repository, enables NGINX Plus features, and sets the image pull secret.  Requires Helm 3.0+, kubectl, and a Docker registry secret.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nhelm install ngf oci://ghcr.io/nginx/charts/nginx-gateway-fabric  --set nginx.image.repository=private-registry.nginx.com/nginx-gateway-fabric/nginx-plus --set nginx.plus=true --set serviceAccount.imagePullSecret=nginx-plus-registry-secret -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Running the Support Package Script (Bash)\nDESCRIPTION: Executes the `support-package.sh` script to create a support package. This script requires root privileges. The resulting package is saved in the current directory by default.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/support/support-package.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo bash /etc/nms/scripts/support-package.sh\n```\n\n----------------------------------------\n\nTITLE: Inject Resources from stdin to file\nDESCRIPTION: This command injects resources passed via standard input using nginx-meshctl. The output is redirected to a new file, my-injected-app.json. It assumes the input is in JSON format.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl inject < ./my-app.json > ./my-injected-app.json\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS SRV Records with Service Parameter\nDESCRIPTION: This snippet configures DNS SRV records by adding the `service` parameter to the `server` directive in the `upstream` block, along with the `resolve` parameter. NGINX Plus uses the information in DNS SRV records, such as the port number. A `zone` directive is also included.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_37\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nresolver <IP-address-of-DNS-server>;\n\nupstream jboss {\n    zone jboss 64k;\n    server example.com service=http resolve;\n}\n```\n\n----------------------------------------\n\nTITLE: Filter Events by Start Time using Event UUID (curl)\nDESCRIPTION: This example demonstrates filtering events to only return events that occurred after the given event's UUID. Replace `<NMS_FQDN>`, `<access token>`, and the UUID accordingly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"https://<NMS_FQDN>/api/platform/v1/analytics/events?startTime=c77b71b5-3afa-497a-8e1c-fdc11d676796\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Verifying NGINX Agent Installation\nDESCRIPTION: This command verifies that the NGINX Agent has been successfully installed. It executes the nginx-agent command with the -v flag to display the agent's version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_28\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx-agent -v\n```\n\n----------------------------------------\n\nTITLE: Server Slow Start Configuration\nDESCRIPTION: Configures slow start for an upstream server. This allows the server to gradually increase its weight after recovery, preventing it from being overwhelmed. The `slow_start` parameter specifies the time it takes for the server to reach its full weight.  Requires Nginx Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    server backend1.example.com:12345 slow_start=30s;\n    server backend2.example.com;\n    server 192.0.0.1 backup;\n}\n```\n\n----------------------------------------\n\nTITLE: Fetching NGINX Plus Packages (Unprivileged)\nDESCRIPTION: This command uses the `ngxunprivinst.sh` script to fetch the NGINX Plus packages. Replace `<cert_file>` and `<key_file>` with the paths to the NGINX Plus certificate and private key.  The `-v` parameter is optional and allows specifying a particular NGINX Plus version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_43\n\nLANGUAGE: shell\nCODE:\n```\n./ngxunprivinst.sh fetch -c <cert_file> -k <key_file>\n./ngxunprivinst.sh list -c <cert_file> -k <key_file>\n./ngxunprivinst.sh fetch -c <cert_file> -k <key_file> -v <version>\n```\n\n----------------------------------------\n\nTITLE: Check Keepalived Configuration\nDESCRIPTION: This snippet displays the contents of the `keepalived.conf` file, allowing for manual inspection of the configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\ncat /etc/keepalived/keepalived.conf\n```\n\n----------------------------------------\n\nTITLE: Shared Memory Zone Configuration\nDESCRIPTION: Defines a shared memory zone for Nginx Plus worker processes to share state information about counters and connections related to upstream servers. The `zone` directive specifies the zone name and size.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    upstream stream_backend {\n        zone   stream_backend 64k;\n        server backend1.example.com:12345;\n        server backend2.example.com:12345;\n        server backend3.example.com:12345;\n    }\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Kubectl Apply Error Message\nDESCRIPTION: This code snippet shows an error message displayed when starting NGINX Controller. This message can be safely ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.3.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\nError: unknown flag: --server-dry-run\nSee 'kubectl apply --help' for usage.\nDetected an invalid patch for the analytics database. Resolving conflicts and restarting the analytics database before running the update.\nstatefulset.apps/clickhouse patched\n```\n\n----------------------------------------\n\nTITLE: Test NGINX App Protect WAF Enforcement\nDESCRIPTION: This shell command uses `curl` to send a request to the NGINX server, which should be protected by NGINX App Protect WAF. This tests WAF enforcement functionality, ensuring requests that violate configured policies are rejected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\ncurl \"<node-external-ip>:<node-port>/<script>\"\n```\n\n----------------------------------------\n\nTITLE: Restore NGINX Controller Database Script (Step 2 Replacement)\nDESCRIPTION: This bash script restores the NGINX Controller database from backup files located in the specified $BACKUP_PATH. It iterates through .backup files, extracts the database name, and uses pg_restore to restore each database. This script replaces step 2 in the original Restore External Config Database documentation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/apim/apim-release-notes-3.18.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nfor backup_file in \"$BACKUP_PATH\"/*.backup; do\n  db=\"$(basename \"$backup_file\" | cut -d '-' -f 1))\"\n  pg_restore -c  -d \"$db\" \"$backup_file\"\ndone\n```\n\n----------------------------------------\n\nTITLE: Publish gRPC API Proxy with Package-Level Routing (JSON)\nDESCRIPTION: This JSON payload is used to publish a gRPC API proxy with package-level routing using the NGINX Management Suite API Connectivity Manager.  The configuration specifies the hostname, gRPC ingress service (helloworld), and backend details, including the service name (hello-grpc-service-name), target hostname (grpc-backend.example.com), and listener settings (port 50051, GRPC transport protocol).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/services/publish-gRPC-proxy.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"dev-grpc-hello\",\n    \"version\": \"v1\",\n    \"proxyConfig\": {\n        \"hostname\": \"example.com\",\n        \"grpcIngress\": {\n            \"service\": \"helloworld.\"\n        },\n        \"backends\": [\n          {\n            \"serviceName\": \"hello-grpc-service-name\",\n            \"serviceTargets\": [\n                {\n                    \"hostname\": \"grpc-backend.example.com\",\n                    \"listener\": {\n                        \"enableTLS\": false,\n                        \"port\": 50051,\n                        \"transportProtocol\": \"GRPC\"\n                    }\n                }\n            ]\n          }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create NGINXaaS Deployment (Azure CLI)\nDESCRIPTION: This command creates an NGINXaaS deployment in Azure using the Azure CLI's NGINX extension.  It requires specifying the deployment name and resource group, and allows for various optional parameters like auto-upgrade profile, diagnostics, identity, location, logging, network profile, scaling properties, SKU, and tags. The deployment's configuration is defined through command-line arguments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/create-deployment/deploy-azure-cli.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment create --deployment-name\n                           --resource-group\n                           [--auto-upgrade-profile]\n                           [--enable-diagnostics {0, 1, f, false, n, no, t, true, y, yes}]\n                           [--identity]\n                           [--location]\n                           [--logging]\n                           [--network-profile]\n                           [--no-wait {0, 1, f, false, n, no, t, true, y, yes}]\n                           [--scaling-properties]\n                           [--sku]\n                           [--tags]\n                           [--user-profile]\n```\n\n----------------------------------------\n\nTITLE: Modified NGINX configuration with HTTPRoute\nDESCRIPTION: This NGINX configuration shows how the `nginx.conf` file is updated when an HTTPRoute is defined. It includes a server block for the hostname defined in the route and location blocks to handle requests based on the path specified.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80 default_server;\n\n    default_type text/html;\n    return 404;\n}\n\nserver {\n    listen 80;\n\n    server_name cafe.example.com;\n\n\n    location /coffee/ {\n        proxy_set_header Host \"$gw_api_compliant_host\";\n        proxy_set_header X-Forwarded-For \"$proxy_add_x_forwarded_for\";\n        proxy_set_header Upgrade \"$http_upgrade\";\n        proxy_set_header Connection \"$connection_upgrade\";\n        proxy_http_version 1.1;\n        proxy_pass http://default_coffee_80$request_uri;\n    }\n\n    location = /coffee {\n        proxy_set_header Host \"$gw_api_compliant_host\";\n        proxy_set_header X-Forwarded-For \"$proxy_add_x_forwarded_for\";\n        proxy_set_header Upgrade \"$http_upgrade\";\n        proxy_set_header Connection \"$connection_upgrade\";\n        proxy_http_version 1.1;\n        proxy_pass http://default_coffee_80$request_uri;\n    }\n\n    location / {\n        return 404 \"\";\n    }\n\n}\nupstream default_coffee_80 {\n    random two least_conn;\n    zone default_coffee_80 512k;\n\n    server 10.244.0.13:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstall Gateway API (Standard Channel) - Shell\nDESCRIPTION: This command uninstalls the Gateway API resources from the standard channel. It uses `kubectl kustomize` to fetch the resource definitions from the specified GitHub repository and then uses `kubectl delete` to remove them from the cluster. This will remove all custom resources in the entire cluster, across all namespaces. Double-check to make sure you don't have any custom resources you need to keep, and confirm that there are no other Gateway API implementations active in your cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/uninstall-gateway-api-resources.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl kustomize \"https://github.com/nginx/nginx-gateway-fabric/config/crd/gateway-api/standard?ref=v{{< version-ngf >}}\" | kubectl delete -f -\n```\n\n----------------------------------------\n\nTITLE: Creating Security Policy Bundles with POST - Shell\nDESCRIPTION: This snippet shows how to create security policy bundles using a POST request to the `/api/platform/v1/security/policies/bundles` endpoint. It includes an example curl command that sends a JSON payload (specified in `security-policy-bundles.json`) to the API endpoint, including an authorization header with a bearer token. Requires a valid access token and a `security-policy-bundles.json` file containing the desired bundle configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X POST https://{{NIM_FQDN}}/api/platform/v1/security/policies/bundles \\\n    -H \"Authorization: Bearer <access token>\" \\\n    -d @security-policy-bundles.json\n```\n\n----------------------------------------\n\nTITLE: Bicep/JSON Template Deployment Failure\nDESCRIPTION: This snippet showcases an error encountered when deploying both an NGINXaaS instance and a diagnostic setting for it using a single ARM Bicep or JSON template.  The validation error arises because of payload validation failures during the template deployment preflight validation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/known-issues.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\"code\": \"InvalidTemplateDeployment\", \"message\": \"The template deployment 'example' is not valid according to the validation procedure. The tracking id is '650afc1e-50d6-476c-bf94-9fc35ffeedd6'. See inner errors for details.\"}\n\nInner Errors:\n{\"code\": \"OpenAPISpecValidationFailedForTemplateDeploymentResources\", \"message\": \"One or more resources in template deployment preflight validation request failed during OpenApi spec (swagger) validation. Please check error details for the resource identifiers.\"}\n\nInner Errors:\n{\"code\": \"HttpPayloadAPISpecValidationFailed\", \"target\": \"/subscriptions/ee920d60-90f3-4a92-b5e7-bb284c3a6ce2/resourceGroups/testenv-1b791f58-workload/providers/NGINX.NGINXPLUS/nginxDeployments/myDeployment/providers/Microsoft.Insights/diagnosticSettings/myLoggingSetting\", \"message\": \"Failed during request payload validation against the API specification\"}\n```\n\n----------------------------------------\n\nTITLE: Create NGINX SSL directory\nDESCRIPTION: Creates the /etc/ssl/nginx/ directory to store the NGINX Instance Manager certificate and key files. This directory is required for secure communication and repository access.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo mkdir -p /etc/ssl/nginx\n```\n\n----------------------------------------\n\nTITLE: XSS Attempt Example\nDESCRIPTION: Illustrates an example of an XSS attempt in a request URL. This highlights the need to configure the OWASP CRS to block such requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_11\n\nLANGUAGE: html\nCODE:\n```\n<script>alert('Vulnerable')</script>\n```\n\n----------------------------------------\n\nTITLE: Resource Name Label for NGINX Ingress Controller DaemonSet (YAML)\nDESCRIPTION: This YAML snippet shows how to add a label to the NGINX Ingress Controller DaemonSet's Pod spec to associate metrics with the DaemonSet resource.  The `nsm.nginx.com/daemonset` label allows Prometheus to identify the DaemonSet that created the Pod, enabling more granular metrics analysis.  The value should be replaced with the actual name of the NGINX Ingress Controller DaemonSet.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_13\n\nLANGUAGE: yaml\nCODE:\n```\nnsm.nginx.com/daemonset: <name of NGINX Ingress Controller DaemonSet>\n```\n\n----------------------------------------\n\nTITLE: Update Proxy with DNS Resolver - JSON\nDESCRIPTION: This JSON payload defines the proxy configuration with an Introspection policy, including DNS resolvers. The `resolver` settings define DNS servers, TTL override (`valid`), and timeout for name resolution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_46\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"test-proxy\",\n   \"version\": \"v1\",\n   \"proxyConfig\": {\n      \"hostname\": \"data-host\",\n      \"ingress\": {\n         \"basePath\": \"/\",\n         \"basePathVersionAppendRule\": \"NONE\"\n      },\n      \"backends\": [\n         {\n            \"serviceName\": \"backend-echo-svc\",\n            \"serviceTargets\": [\n               {\n                  \"hostname\": \"192.0.2.4\",\n                  \"listener\": {\n                     \"enableTLS\": false,\n                     \"port\": 10000,\n                     \"transportProtocol\": \"HTTP\"\n                  }\n               }\n            ]\n         }\n      ],\n      \"policies\": {\n         \"oauth2-introspection\": [\n            {\n               \"action\": {\n                  \"introspectionEndpoint\": \"https://hosted.idp.com:8080/realms/nginx/protocol/openid-connect/token/introspect\",\n                  \"resolver\": {\n                     \"valid\": \"30s\",\n                     \"timeout\": \"60s\",\n                     \"servers\": [\n                        {\n                           \"hostname\": \"10.0.0.1\"\n                        },\n                        {\n                           \"hostname\": \"10.0.0.2\",\n                           \"port\": 5353\n                        }\n                     ]\n                  }\n               },\n               \"data\": [\n                  {\n                     \"clientAppID\": \"nginx-plus\",\n                     \"clientSecret\": \"<client secret>\"\n                  }\n               ]\n            }\n         ]\n      }\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Send Multiple Requests to Tea Endpoint - Shell\nDESCRIPTION: This snippet uses a for loop in shell to send multiple requests to the tea endpoint. The intention is to exceed the rate limit and observe 503 errors, which indicates the rate limiting configuration is working correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\nfor i in `seq 1 10`; do curl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/tea; done\n```\n\n----------------------------------------\n\nTITLE: NGINX Service Configuration YAML\nDESCRIPTION: This YAML snippet shows how to configure the Service to expose the NGINX deployment on port 55555.  The port is defined within the `spec.ports[0].port` field. This Service definition makes the NGINX deployment accessible on the specified port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_19\n\nLANGUAGE: YAML\nCODE:\n```\n---\nkind: Service\nspec:\n  ports:\n  - port: 55555\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Plus Certificates (JSON)\nDESCRIPTION: Downloads the NGINX Plus certificate and key bundle as a JSON file using the NGINX Controller REST API.  Requires a valid session cookie and saves the output to `nginx-plus-certs.json`. It also defines Content-Type as application/json.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller-app-sec.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\ncurl -b cookie.txt -c cookie.txt --header 'Content-Type: application/json' -X GET --url 'https://192.0.2.0/api/v1/platform/licenses/nginx-plus-licenses/controller-provided'  --output nginx-plus-certs.json\n```\n\n----------------------------------------\n\nTITLE: Service Configuration with Duplicate targetPorts in YAML\nDESCRIPTION: This YAML snippet demonstrates an invalid Service configuration where multiple ports share the same `targetPort`. NGINX Service Mesh disregards duplicate `targetPort` configurations, leading to only one port configuration being honored for traffic forwarding, authentication, and encryption.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-2.0.0.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nkind: Service\nspec:\nports:\n- port: 8080\n     protocol: TCP\n     targetPort: 55555\n- port: 9090\n     protocol: TCP\n     targetPort: 55555\n```\n\n----------------------------------------\n\nTITLE: Creating a directory for HA scripts on Ubuntu\nDESCRIPTION: This command creates a directory for the NGINX Plus HA scripts on Ubuntu systems. The scripts are later downloaded into this directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-keepalived.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /usr/lib/keepalived\n```\n\n----------------------------------------\n\nTITLE: Launching the GDB debugger\nDESCRIPTION: Launches the GDB debugger and attaches it to the specified NGINX worker process using its PID.  Requires root privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_29\n\nLANGUAGE: shell\nCODE:\n```\nsudo gdb -p <nginx PID obtained at the previous step>\n```\n\n----------------------------------------\n\nTITLE: Simple Test Application Configuration\nDESCRIPTION: This configuration defines a simple NGINX server that listens on port 8080 and returns the authenticated user's full name, email, and subject identifier. It's used as a test application to verify the OIDC setup.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/cognito.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nserver {\n    listen 8080;\n\n    location / {\n        return 200 \"Hello, $http_name!\\nEmail: $http_email\\nSub: $http_sub\\n\";\n        default_type text/plain;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install nginx-plus package on Alpine\nDESCRIPTION: This command installs the NGINX Plus package on Alpine Linux using the apk package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_25\n\nLANGUAGE: Shell\nCODE:\n```\nsudo apk add nginx-plus\n```\n\n----------------------------------------\n\nTITLE: Chef Node Definition (JSON)\nDESCRIPTION: This JSON defines the node's attributes, including the run list (roles to apply) and specific settings for Nginx, such as whether it's the primary HA node.  This configuration drives the Chef client's behavior when configuring the node.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_7\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"name\": \"chef-test-1\",\n  \"chef_environment\": \"_default\",\n  \"run_list\": [\n             \"role[nginx_plus_ha]\"\n  ]\n,\n  \"normal\": {\n    \"nginx\": {\n      \"ha_primary\": \"true\"\n    },\n    \"tags\": [\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Get Container Logs via API (Shell)\nDESCRIPTION: This shell command retrieves the logs of a Docker container named container-name using the Docker Remote API via a Unix socket. It specifies that both stdout and stderr should be included in the output.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_31\n\nLANGUAGE: shell\nCODE:\n```\ncurl --unix-sock /var/run/docker-sock http://localhost/containers/container-name/logs?stdout=1&stderr=1\n```\n\n----------------------------------------\n\nTITLE: Upstream Header Time Metrics\nDESCRIPTION: Describes the 'plus.upstream.header.time', 'plus.upstream.header.time.count', 'plus.upstream.header.time.max', 'plus.upstream.header.time.median', and 'plus.upstream.header.time.pctl95' metrics, which are gauges representing the average time to get the response header from upstream servers. These metrics are useful for identifying header retrieval latency.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_11\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, seconds.milliseconds\nDescription: Average time to get the response header from the upstream servers.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Downloading status.conf for Live Activity Monitoring\nDESCRIPTION: This shell command downloads the status.conf file from the NGINX website. This file contains the configurations for enabling live activity monitoring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_34\n\nLANGUAGE: shell\nCODE:\n```\n# cd /etc/nginx/conf.d\n# curl https://www.nginx.com/resource/conf/status.conf > status.conf\n```\n\n----------------------------------------\n\nTITLE: Installing Nginx and App Protect\nDESCRIPTION: This snippet installs Nginx OSS and the Nginx App Protect WAF v5 module. It sets up the necessary yum repositories using certificate-based authentication via Docker secrets, installs required packages, cleans up the package cache, and configures symbolic links for standard output and error streams to Nginx logs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-oracle.md#_snippet_0\n\nLANGUAGE: dockerfile\nCODE:\n```\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    dnf -y install wget ca-certificates yum-utils \\\n    && echo \"[nginx-mainline]\" > /etc/yum.repos.d/nginx.repo \\\n    && echo \"name=nginx mainline repo\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"baseurl=http://nginx.org/packages/mainline/centos/\\$releasever/\\$basearch/\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"gpgcheck=1\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"gpgkey=https://nginx.org/keys/nginx_signing.key\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"module_hotfixes=true\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"[app-protect-x-oss]\" > /etc/yum.repos.d/app-protect-8-x-oss.repo \\\n    && echo \"name=nginx-app-protect repo\" >> /etc/yum.repos.d/app-protect-8-x-oss.repo \\\n    && echo \"baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/8/\\$basearch/\" >> /etc/yum.repos.d/app-protect-8-x-oss.repo \\\n    && echo \"sslclientcert=/etc/ssl/nginx/nginx-repo.crt\" >> /etc/yum.repos.d/app-protect-8-x-oss.repo \\\n    && echo \"sslclientkey=/etc/ssl/nginx/nginx-repo.key\" >> /etc/yum.repos.d/app-protect-8-x-oss.repo \\\n    && echo \"gpgcheck=0\" >> /etc/yum.repos.d/app-protect-8-x-oss.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/app-protect-8-x-oss.repo \\\n    && dnf clean all \\\n    && dnf -y install app-protect-module-oss \\\n    && dnf clean all \\\n    && rm -rf /var/cache/dnf \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log\n```\n\n----------------------------------------\n\nTITLE: Verify WAF Compiler Installation - Shell\nDESCRIPTION: This command verifies that the WAF compiler is installed and functioning correctly by displaying its help message. It requires root privileges to execute.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_32\n\nLANGUAGE: shell\nCODE:\n```\nsudo /opt/nms-nap-compiler/app_protect-<version>/bin/apcompile -h\n```\n\n----------------------------------------\n\nTITLE: Check Nginx Service Status (systemctl)\nDESCRIPTION: This command checks the status of the nginx.service using systemctl.  It provides details on the service's current state (running, stopped, failed) and any recent logs.  This helps determine if Nginx itself is the source of the problem.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-instances.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl status nginx.service\n```\n\n----------------------------------------\n\nTITLE: HTTP Server JSON Schema\nDESCRIPTION: Defines the JSON schema for HTTP server configurations, specifying fields for server label and name within the NGINX configuration. It utilizes JSON schema to define the data structure for inputs into the base template, ensuring correct server configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/tutorials/round-robin-reverse-proxy.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"title\": \"HTTP Servers\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"templateInput\": {\n      \"type\": [\n        \"object\",\n        \"null\"\n      ],\n      \"properties\": {\n        \"serverName\": {\n          \"title\": \"Server Label\",\n          \"type\": \"string\",\n          \"description\": \"Enter a unique label for the server. This label is displayed in the user interface and acts as a key for matching and applying augment input to the specific server.\",\n          \"examples\": [\n            \"Example Server\"\n          ]\n        },\n        \"serverNameInConfig\": {\n          \"title\": \"Name\",\n          \"type\": \"string\",\n          \"description\": \"The name of the HTTP server. This value is used when matching incoming requests to the correct server.\",\n          \"examples\": [\n            \"example.com\"\n          ]\n        }\n      },\n      \"required\": [\n        \"serverName\",\n        \"serverNameInConfig\"\n      ]\n    }\n  },\n  \"required\": []\n}\n\n```\n\n----------------------------------------\n\nTITLE: Checking Pod Logs with kubectl\nDESCRIPTION: This command allows you to view the logs of a specific container within a pod in Kubernetes.  It requires the pod name and the container name as parameters. This is helpful for diagnosing pod failures by examining error messages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_33\n\nLANGUAGE: bash\nCODE:\n```\nkubectl logs [pod_name] -c [container_name]\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent insecurely using wget\nDESCRIPTION: This snippet shows how to install NGINX Agent insecurely using wget, bypassing TLS certificate verification with `--no-check-certificate`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/agent/installation/install-agent-api.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nwget --no-check-certificate https://<NIM_FQDN>/install/nginx-agent -O - | sudo sh\n```\n\n----------------------------------------\n\nTITLE: Installing nginx-plus-module-geoip2 on SLES\nDESCRIPTION: Installs the nginx-plus-module-geoip2 package using zypper. This package provides the GeoIP2 dynamic module for NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nzypper install nginx-plus-module-geoip2\n```\n\n----------------------------------------\n\nTITLE: Apply NGINX ConfigMap Update (Shell)\nDESCRIPTION: This shell command applies the updated `deployments/common/nginx-config.yaml` ConfigMap to the Kubernetes cluster.  It ensures that changes to the ConfigMap are reflected in the NGINX configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f deployments/common/nginx-config.yaml\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Plus (Oracle Linux 8.1+)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Plus package from Oracle Linux 8.1 and later. It uses the `dnf remove` command to remove the `app-protect-module-plus` package. Requires root privileges and the dnf package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_59\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf remove app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Perl Module (FreeBSD)\nDESCRIPTION: This shell script updates the package manager and installs the `nginx-plus-module-perl` package on FreeBSD systems. It uses the `pkg` package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/perl.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-perl\n```\n\n----------------------------------------\n\nTITLE: Edit HTTPRouteGroup via Kubectl\nDESCRIPTION: This bash command opens the `target-hrg` HTTPRouteGroup in a text editor, allowing modifications to the resource definition. This is used to add or modify match conditions based on path and HTTP methods.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_25\n\nLANGUAGE: bash\nCODE:\n```\nkubectl edit httproutegroup target-hrg\n```\n\n----------------------------------------\n\nTITLE: Configuring Slow Start for Upstream Servers Nginx\nDESCRIPTION: Configures the 'slow_start' parameter for upstream servers. This gradually increases traffic to a server as it recovers from a failure or when a new server is added to the upstream group. In this example, a slow start period of 30 seconds is configured for two EBS application servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_27\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'upstream' block\nserver 172.31.11.210:8000 slow_start=30s;\nserver 172.31.0.146:8000 slow_start=30s;\n```\n\n----------------------------------------\n\nTITLE: Dockerfile: Install Nginx OSS and App Protect\nDESCRIPTION: This Dockerfile installs Nginx Open Source and the Nginx App Protect WAF v5 module on a CentOS 7 base image. It uses yum to install necessary packages, configures Nginx and App Protect repositories, and sets up logging. Secrets for accessing the App Protect repository are mounted using Docker secrets.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-centos.md#_snippet_0\n\nLANGUAGE: dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Base image\nFROM centos:7\n\n# Install NGINX OSS and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    yum -y install wget ca-certificates epel-release yum-utils \\\n    && echo \"[nginx-mainline]\" > /etc/yum.repos.d/nginx.repo \\\n    && echo \"name=nginx mainline repo\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"baseurl=http://nginx.org/packages/mainline/centos/\\$releasever/\\$basearch/\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"gpgcheck=1\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"gpgkey=https://nginx.org/keys/nginx_signing.key\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"module_hotfixes=true\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"[app-protect-x-oss]\" > /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && echo \"name=nginx-app-protect repo\" >> /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && echo \"baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/7/\\$basearch/\" >> /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && echo \"sslclientcert=/etc/ssl/nginx/nginx-repo.crt\" >> /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && echo \"sslclientkey=/etc/ssl/nginx/nginx-repo.key\" >> /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && echo \"gpgcheck=0\" >> /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/app-protect-7-x-oss.repo \\\n    && yum -y install app-protect-module-oss \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log \\\n    && yum clean all \\\n    && rm -rf /var/cache/yum\n\n# Expose port\nEXPOSE 80\n\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Edit RateLimit resource using kubectl\nDESCRIPTION: This command opens the 'ratelimit-v1' RateLimit resource in a text editor, allowing the user to modify its configuration. The changes are applied when the editor is closed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nkubectl edit ratelimit ratelimit-v1\n```\n\n----------------------------------------\n\nTITLE: Changing Directory to NGINX Configuration Directory\nDESCRIPTION: This shell command changes the current directory to /etc/nginx/conf.d, which is the standard directory for Nginx configuration files.  This is required to configure the backend web server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/route-53-global-server-load-balancing.md#_snippet_6\n\nLANGUAGE: Shell\nCODE:\n```\ncd /etc/nginx/conf.d\n```\n\n----------------------------------------\n\nTITLE: Delete Resources\nDESCRIPTION: This bash command deletes all the resources created during the A/B testing demonstration. This is part of the cleanup process to remove the deployed configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_28\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete -f gateway.yaml -f target-svc.yaml -f target-v2.1-successful.yaml -f target-v3.0.yaml -f trafficsplit-matches.yaml\n```\n\n----------------------------------------\n\nTITLE: Creating Staged Config with Commit Hash (POST)\nDESCRIPTION: This JSON payload demonstrates how to create or update a staged configuration via a POST request to the `/configs` endpoint, including optional parameters for associating a Git commit hash (`externalId`) and its type (`externalIdType`) for version control. The `configName`, `configFiles`, and `auxFiles` are mandatory parameters.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/stage-configs.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"configName\": \"test-staged\",\n  \"configFiles\": {\n    \"rootDir\": \"/etc/nginx\",\n    \"files\": [\n      {\n        \"contents\": \"base64_encoded_contents\",\n        \"name\": \"/etc/nginx/nginx.conf\"\n      }\n    ]\n  },\n  \"auxFiles\": {\n    \"rootDir\": \"/etc/nginx/aux\",\n    \"files\": []\n  },\n  \"externalId\": \"8acf5aed9d2872b266d2f880cab23a4aa5791d1b\",\n  \"externalIdType\": \"git\"\n}\n```\n\n----------------------------------------\n\nTITLE: Find Supported Linux Distributions\nDESCRIPTION: This command uses `grep` to search the `install-nim-bundle.sh` script for the `-d distribution` parameter, which lists the supported operating system distributions that can be used with the script.  This helps determine which OS flags are available for installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ngrep '\\-d distribution' install-nim-bundle.sh\n```\n\n----------------------------------------\n\nTITLE: Creating Certificate Signing Request (CSR) (OpenSSL)\nDESCRIPTION: This command creates a Certificate Signing Request (CSR) file using the private key. The -sha256 parameter specifies the SHA256 hashing algorithm for the request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl req -new -sha256 -key ~/example.com.key -out ~/example.com.csr\n```\n\n----------------------------------------\n\nTITLE: Defining mgmt block in NGINX configuration\nDESCRIPTION: This snippet shows the basic structure for defining the `mgmt` block in the NGINX configuration file. This block is used to configure settings related to NGINX Plus instance reporting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/usage-tracking/agentless-reporting.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n    #...\n\n}\n```\n\n----------------------------------------\n\nTITLE: Download ModSecurity Recommended Configuration\nDESCRIPTION: These commands download the recommended ModSecurity configuration file from the ModSecurity GitHub repository and rename it to modsecurity.conf. The wget command downloads the file, and the mv command renames it.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_13\n\nLANGUAGE: none\nCODE:\n```\ncd /etc/nginx/modsec\nsudo wget https://raw.githubusercontent.com/SpiderLabs/ModSecurity/v3/master/modsecurity.conf-recommended\nsudo mv modsecurity.conf-recommended modsecurity.conf\n```\n\n----------------------------------------\n\nTITLE: Example NGINX Plus Version Output\nDESCRIPTION: This shows the expected output after running the `nginx -v` command. The output indicates that NGINX Plus Release 34 or later is installed, which is necessary for using the OpenID Connect module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/okta.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nnginx version: nginx/1.27.4 (nginx-plus-r34)\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Configuration\nDESCRIPTION: This command verifies the NGINX configuration file for any syntax errors before applying the changes. It helps to prevent service disruptions due to incorrect configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/microsoft-entra-setup.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo nginx -t\n```\n\n----------------------------------------\n\nTITLE: Applying Error Response Format Policy via REST API (JSON)\nDESCRIPTION: This JSON payload demonstrates how to create or update an Error Response Format policy within an environment using the REST API. It defines the policy to be applied on inbound traffic in the global context, specifying a custom error message for the 400 HTTP error code. The policy allows the API gateway to respond with a customized error message in JSON format instead of the standard HTTP error from the backend.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/error-response-format.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n     \"error-response-format\": [\n        {\n           \"systemMetadata\": {\n              \"appliedOn\": \"inbound\",\n              \"context\": \"global\"\n           },\n           \"action\": {\n              \"400\": {\n                 \"errorCode\": \"13\",\n                 \"errorMessage\": \"Bad Request\"\n              }\n           }\n        }\n     ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Port Forward Productpage\nDESCRIPTION: Creates a port forward from the local machine to the `productpage` service on port 9080. This allows accessing the Bookinfo application through `http://localhost:9080`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-walkthrough.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nkubectl port-forward svc/productpage 9080\n```\n\n----------------------------------------\n\nTITLE: Deploy Target Application and Gateway\nDESCRIPTION: This command deploys the initial production version (v1.0) of the target application along with the load balancer service and the ingress gateway using kubectl. It creates the necessary pods and services for the application to function.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f target-svc.yaml -f target-v1.0.yaml -f gateway.yaml\n```\n\n----------------------------------------\n\nTITLE: Including Configuration Files - Nginx\nDESCRIPTION: This Nginx configuration block includes configuration files related to single or multiple Oracle entry points.  It is placed within the `http` block of the main `nginx.conf` file. The `include` directive tells Nginx to read and process the specified configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    include conf.d/oracle-(single|multiple)-entry-point.conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Creating certificate namespace and secret\nDESCRIPTION: This YAML configuration creates a Kubernetes Namespace named 'certificate' and a Secret named 'cafe-secret' within that namespace.  The Secret stores TLS certificate and key data for HTTPS termination. The `data` field contains base64 encoded certificate and key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/https-termination.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: certificate\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: cafe-secret\n  namespace: certificate\ntype: kubernetes.io/tls\ndata:\n  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNzakNDQVpvQ0NRQzdCdVdXdWRtRkNEQU5CZ2txaGtpRzl3MEJBUXNGQURBYk1Sa3dGd1lEVlFRRERCQmoKWVdabExtVjRZVzF3YkdVdVkyOXRNQjRYRFRJeU1EY3hOREl4TlRJek9Wb1hEVEl6TURjeE5ESXhOVEl6T1ZvdwpHekVaTUJjR0ExVUVBd3dRWTJGbVpTNWxlR0Z0Y0d4bExtTnZiVENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFECmdnRVBBRENDQVFvQ2dnRUJBTHFZMnRHNFc5aStFYzJhdnV4Q2prb2tnUUx1ek10U1Rnc1RNaEhuK3ZRUmxIam8KVzFLRnMvQVdlS25UUStyTWVKVWNseis4M3QwRGtyRThwUisxR2NKSE50WlNMb0NEYUlRN0Nhck5nY1daS0o4Qgo1WDNnVS9YeVJHZjI2c1REd2xzU3NkSEQ1U2U3K2Vab3NPcTdHTVF3K25HR2NVZ0VtL1Q1UEMvY05PWE0zZWxGClRPL051MStoMzROVG9BbDNQdTF2QlpMcDNQVERtQ0thaEROV0NWbUJQUWpNNFI4VERsbFhhMHQ5Z1o1MTRSRzUKWHlZWTNtdzZpUzIrR1dYVXllMjFuWVV4UEhZbDV4RHY0c0FXaGRXbElweHlZQlNCRURjczN6QlI2bFF1OWkxZAp0R1k4dGJ3blVmcUVUR3NZdWxzc05qcU95V1VEcFdJelhibHhJZVVDQXdFQUFUQU5CZ2txaGtpRzl3MEJBUXNGCkFBT0NBUUVBcjkrZWJ0U1dzSnhLTGtLZlRkek1ISFhOd2Y5ZXFVbHNtTXZmMGdBdWVKTUpUR215dG1iWjlpbXQKL2RnWlpYVE9hTElHUG9oZ3BpS0l5eVVRZVdGQ2F0NHRxWkNPVWRhbUloOGk0Q1h6QVJYVHNvcUNOenNNLzZMRQphM25XbFZyS2lmZHYrWkxyRi8vblc0VVNvOEoxaCtQeDljY0tpRDZZU0RVUERDRGh1RUtFWXcvbHpoUDJVOXNmCnl6cEJKVGQ4enFyM3paTjNGWWlITmgzYlRhQS82di9jU2lyamNTK1EwQXg4RWpzQzYxRjRVMTc4QzdWNWRCKzQKcmtPTy9QNlA0UFlWNTRZZHMvRjE2WkZJTHFBNENCYnExRExuYWRxamxyN3NPbzl2ZzNnWFNMYXBVVkdtZ2todAp6VlZPWG1mU0Z4OS90MDBHUi95bUdPbERJbWlXMGc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==\n  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQzZtTnJSdUZ2WXZoSE4KbXI3c1FvNUtKSUVDN3N6TFVrNExFeklSNS9yMEVaUjQ2RnRTaGJQd0ZuaXAwMFBxekhpVkhKYy92TjdkQTVLeApQS1VmdFJuQ1J6YldVaTZBZzJpRU93bXF6WUhGbVNpZkFlVjk0RlAxOGtSbjl1ckV3OEpiRXJIUncrVW51L25tCmFMRHF1eGpFTVBweGhuRklCSnYwK1R3djNEVGx6TjNwUlV6dnpidGZvZCtEVTZBSmR6N3Rid1dTNmR6MHc1Z2kKbW9RelZnbFpnVDBJek9FZkV3NVpWMnRMZllHZWRlRVJ1VjhtR041c09va3R2aGxsMU1udHRaMkZNVHgySmVjUQo3K0xBRm9YVnBTS2NjbUFVZ1JBM0xOOHdVZXBVTHZZdFhiUm1QTFc4SjFINmhFeHJHTHBiTERZNmpzbGxBNlZpCk0xMjVjU0hsQWdNQkFBRUNnZ0VBQnpaRE50bmVTdWxGdk9HZlFYaHRFWGFKdWZoSzJBenRVVVpEcUNlRUxvekQKWlV6dHdxbkNRNlJLczUyandWNTN4cU9kUU94bTNMbjNvSHdNa2NZcEliWW82MjJ2dUczYnkwaVEzaFlsVHVMVgpqQmZCcS9UUXFlL2NMdngvSkczQWhFNmJxdFRjZFlXeGFmTmY2eUtpR1dzZk11WVVXTWs4MGVJVUxuRmZaZ1pOCklYNTlSOHlqdE9CVm9Sa3hjYTVoMW1ZTDFsSlJNM3ZqVHNHTHFybmpOTjNBdWZ3ZGRpK1VDbGZVL2lK1EvZkUKV216aFFoTlRpNVFkRWJLVStOTnYvNnYvb2JwandNb25HVVBCdEFTUE05cmxFemIralQ1WHdWQjgvLzRGY3VoSwoyVzNpcjhtNHVlQ1JHSVlrbGxlLzhuQmZ0eVhiVkNocVRyZFBlaGlPM1FLQmdRRGlrR3JTOTc3cjg3Y1JPOCtQClpoeXltNXo4NVIzTHVVbFNTazJiOTI1QlhvakpZL2RRZDVTdFVsSWE4OUZKZnNWc1JRcEhHaTFCYzBMaTY1YjIKazR0cE5xcVFoUmZ1UVh0UG9GYXRuQzlPRnJVTXJXbDVJN0ZFejZnNkNQMVBXMEg5d2hPemFKZUdpZVpNYjlYTQoybDdSSFZOcC9jTDlYbmhNMnN0Q1lua2Iwd0tCZ1FEUzF4K0crakEyUVNtRVFWNXA1RnRONGcyamsyZEFjMEhNClRIQ2tTazFDRjhkR0Z2UWtsWm5ZbUt0dXFYeXNtekJGcnZKdmt2eUhqbUNYYTducXlpajBEdDZtODViN3BGcVAKQWxtajdtbXI3Z1pUeG1ZMXBhRWFLMXY4SDNINGtRNVl3MWdrTWRybVJHcVAvaTBGaDVpaGtSZS9DOUtGTFVkSQpDcnJjTzhkUVp3S0JnSHA1MzRXVWNCMVZibzFlYStIMUxXWlFRUmxsTWlwRFM2TzBqeWZWSmtFb1BZSEJESnp2ClIrdzZLREJ4eFoyWmJsZ05LblV0blhHSVFZd3lGelhNcFB5SGxNVHpiZkJhYmJLcDFyR2JVT2RCMXpXM09PRkgKcmppb21TUm1YNmxhaDk0SjRHU0lFZ0drNGw1SHhxZ3JGRDZ2UDd4NGRjUktJWFpLZ0w2dVJSSUpBb0dCQU1CVApaL2p5WStRNTBLdEtEZHUrYU9ORW4zaGxUN3hrNXRKN3NBek5rbWdGMU10RXlQUk9Xd1pQVGFJbWpRbk9qbHdpCldCZ2JGcXg0M2ZlQ1Z4ZXJ6V3ZEM0txaWJVbWpCTkNMTGtYeGh3ZEVteFQwVit2NzZGYzgwaTNNYVdSNnZZR08KditwVVovL0F6UXdJcWZ6dlVmV2ZxdStrMHlhVXhQOGNlcFBIRyt0bEFvR0FmQUtVVWhqeFU0Ym5vVzVwVUhKegpwWWZXZXZ5TW54NWZyT2VsSmRmNzlvNGMvMHhVSjh1eFBFWDFkRmNrZW96dHNpaVFTNkN6MENRY09XVWxtSkRwCnVrdERvVzM3VmNSQU1BVjY3NlgxQVZlM0UwNm5aL2g2Tkd4Z28rT042Q3pwL0lkMkJPUm9IMFAxa2RjY1NLT3kKMUtFZlNnb1B0c1N1eEpBZXdUZmxDMXc9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K\nEOF\n```\n\n----------------------------------------\n\nTITLE: Proxy Configuration with JWT Forwarding Enabled\nDESCRIPTION: This JSON snippet shows the updated configuration for an NGINX API proxy with JWT forwarding enabled.  The `forwardToken` property within the `action` object is set to `true`. The other properties remain the same as the previous configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_59\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"test-proxy\",\n   \"version\": \"v1\",\n   \"proxyConfig\": {\n      \"hostname\": \"data-host\",\n      \"ingress\": {\n         \"basePath\": \"/\",\n         \"basePathVersionAppendRule\": \"NONE\"\n      },\n      \"backends\": [\n         {\n            \"serviceName\": \"backend-echo-svc\",\n            \"serviceTargets\": [\n               {\n                  \"hostname\": \"192.0.2.4\",\n                  \"listener\": {\n                     \"enableTLS\": false,\n                     \"port\": 10000,\n                     \"transportProtocol\": \"HTTP\"\n                  }\n               }\n            ]\n         }\n      ],\n      \"policies\": {\n         \"oauth2-introspection\": [\n            {\n               \"action\": {\n                  \"introspectionEndpoint\": \"https://192.0.2.5:8080/oauth/v2/oauth-introspect\",\n                  \"introspectionResponse\": \"application/jwt\",\n                        \"forwardToken\": true\n\n               },\n               \"data\": [\n                  {\n                     \"clientAppID\": \"nginx-plus\",\n                     \"clientSecret\": \"<client secret>\"\n                  }\n               ]\n            }\n         ]\n      }\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuration Load Failure Log Event JSON\nDESCRIPTION: This JSON object represents a failure during the configuration load process, providing details about the error encountered, such as policy import failures. The log level is Error.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/operation-logs.md#_snippet_7\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"error_message\": \"Failed to import Policy 'policy1' from '/etc/app_protect/conf/policy_1.json': Could not parse/validate the Policy Bot Signature.  Invalid value 'ignoree' for field 'action'.\",\n  \"completed_successfully\": false,\n  \"componentVersions\": {\n    \"wafNginxVersion\": \"4.2.0\",\n    \"wafEngineVersion\": \"10.179.0\"\n  },\n  \"softwareVersion\": \"4.0.0\",\n  \"event\": \"configuration_load_failure\",\n  \"error_line_number\": 29\n}\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Controller Agent Service (Bash)\nDESCRIPTION: This command restarts the NGINX Controller Agent service. It uses the `service` command to restart the agent. This is typically executed on the NGINX Plus system where the agent is installed. Requires root or sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/agent-restart.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nservice controller-agent restart\n```\n\n----------------------------------------\n\nTITLE: Enabling Insecure Mode with Environment Variables - Bash\nDESCRIPTION: This snippet demonstrates how to enable insecure mode by setting the `NGINX_AGENT_TLS_ENABLE` environment variable to `false`. This disables TLS completely.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/encrypt-communication.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nNGINX_AGENT_TLS_ENABLE=false\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Plus - RPM\nDESCRIPTION: Upgrades the NGINX Plus package using yum on RHEL, Amazon Linux, CentOS, Oracle Linux, AlmaLinux and Rocky Linux systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_58\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum upgrade nginx-plus\n```\n\n----------------------------------------\n\nTITLE: Gateway State Condition\nDESCRIPTION: This JSON snippet represents the state of a Gateway when an error occurs due to a duplicate ingress URI.  The `conditions` array contains an object with the `type` set to \"config\", indicating a configuration-related issue. The `selfConfigState` provides a summary of the Gateway's configuration state, indicating that it is in an error state.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_34\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"state\": {\n    \"conditions\": [\n      {\n        \"type\": \"config\"\n      }\n    ],\n    \"selfConfigState\": {\n      \"configured\": 0,\n      \"configuring\": 0,\n      \"deleting\": 0,\n      \"error\": 1,\n      \"isConfigured\": false,\n      \"isConfiguring\": false,\n      \"isDeleting\": false,\n      \"isError\": true,\n      \"total\": 1\n    }\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Upsert API Proxy with OAuth2 Introspection Policy - Bash\nDESCRIPTION: This snippet shows the PUT request used to upsert the API proxy with an OAuth2 Introspection policy. The request is sent to the management API endpoint to update the proxy configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_23\n\nLANGUAGE: bash\nCODE:\n```\nPUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy\n```\n\n----------------------------------------\n\nTITLE: Check Keepalived Status and IP Address\nDESCRIPTION: These commands check the status of the keepalived service and the configured IP address on the specified network device. They are used to verify that keepalived is running and that the virtual IP address is assigned correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/ha-data-plane.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl status keepalived\nip addr show dev <device in keepalived>\n```\n\n----------------------------------------\n\nTITLE: Create Kind Cluster Config\nDESCRIPTION: This YAML file configures a kind (Kubernetes in Docker) cluster with extra port mappings for HTTP (8080) and HTTPS (8443). These ports are mapped to the container ports 31437 and 31438 respectively, which will be used later when setting up a NodePort.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: kind.x-k8s.io/v1alpha4\nkind: Cluster\nnodes:\n  - role: control-plane\n    extraPortMappings:\n      - containerPort: 31437\n        hostPort: 8080\n        protocol: TCP\n      - containerPort: 31438\n        hostPort: 8443\n        protocol: TCP\n```\n\n----------------------------------------\n\nTITLE: Stream Upstream Zombie Servers\nDESCRIPTION: Describes the 'plus.stream.upstream.zombies' metric, which is a gauge of the current number of servers removed from the group but still processing active client connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_32\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, integer\nDescription: Current number of servers removed from the group but still\n               processing active client connections.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Extract NGINX Controller installer (bash)\nDESCRIPTION: This command extracts the NGINX Controller installer package.  This step is part of the NGINX Controller update process and is performed on each node in the cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/manage-cluster.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\ntar xzf controller-installer-<version>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX Agent on Ubuntu/Debian\nDESCRIPTION: This command removes the NGINX Agent package using the apt-get package manager, commonly used on Ubuntu and Debian. The command removes the package but leaves the configuration files. Requires root privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/uninstall.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get remove nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Add Nginx Agent repository on Ubuntu\nDESCRIPTION: This command adds the Nginx Agent repository to the system's apt sources, allowing the package manager to find and install the Nginx Agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\necho \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n  http://packages.nginx.org/nginx-agent/ubuntu/ `lsb_release -cs` agent\" \\\n  | sudo tee /etc/apt/sources.list.d/nginx-agent.list\n```\n\n----------------------------------------\n\nTITLE: Echo Server Response with Forwarded Claims\nDESCRIPTION: This code snippet shows the expected response from the echo server, including the forwarded claims as request headers. It illustrates how the OAuth2 Introspection policy transforms token claims into `X-Token-<Claim>` headers. The response also demonstrates that non-existent claims are gracefully handled, resulting in empty headers that are not proxied to the backend.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_50\n\nLANGUAGE: bash\nCODE:\n```\nRequest served by echo-host\n\nHTTP/1.0 POST /my/test/api\n\nHost: default_http_a4334620-226b-491d-8503-e0724bdf5521\nAccept: */*\nAccept-Encoding: gzip, deflate, br\nCache-Control: no-cache\nConnection: close\nContent-Length: 30\nContent-Type: application/json\nX-Correlation-Id: e537dec880a0e3eab70fe8b87f6b5838\nX-Token-Client-Id: nginx-plus\nX-Token-Exp: 1666011139\nX-Token-Iss: http://192.0.2.5:8080/realms/nginx\nX-Token-Resource-Access-Account-Roles: manage-account\nX-Token-Scope: openid email profile\nX-Token-Username: nginx-user\n```\n\n----------------------------------------\n\nTITLE: View NGINX Controller Version with helper.sh (Bash)\nDESCRIPTION: This command displays the installed and running versions of NGINX Controller using the `helper.sh` script. It executes the `version` subcommand to retrieve the version information. No specific input parameters are needed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh version\n```\n\n----------------------------------------\n\nTITLE: Checking Nginx Status\nDESCRIPTION: This command is used to check the status of the Nginx Plus server after it has been launched on an EC2 instance. It verifies that Nginx is running correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\n/etc/init.d/nginx status\n```\n\n----------------------------------------\n\nTITLE: Patch Spiffeid Resources to Remove Finalizers\nDESCRIPTION: This script iterates through all namespaces in the Kubernetes cluster and patches any Spiffeid resources found to remove their finalizers.  This is used to resolve issues where the `nginx-mesh` namespace is stuck in the 'Terminating' state during uninstallation. It relies on `kubectl`, `awk`, `tail`, and a `for` loop construct.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/uninstall/uninstall-with-helm.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nfor ns in $(kubectl get ns | awk '{print $1}' | tail -n +2)\ndo\nif [ $(kubectl get spiffeids -n $ns 2>/dev/null | wc -l) -ne 0 ]\nthen\n    kubectl patch spiffeid $(kubectl get spiffeids -n $ns | awk '{print $1}' | tail -n +2) --type='merge' -p '{\"metadata\":{\"finalizers\":null}}' -n $ns\nfi\ndone\n```\n\n----------------------------------------\n\nTITLE: Disable Private Link Service Network Policy - Azure CLI\nDESCRIPTION: Disables the `privateLinkServiceNetworkPolicies` setting on a subnet within a virtual network. This is a prerequisite for adding a private link service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/private-link-to-upstreams.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\n$ az network vnet subnet update \\\n    --name $APP_SUBNET_NAME \\\n    --vnet-name $APP_VNET_NAME \\\n    --resource-group $APP_RESOURCE_GROUP \\\n    --disable-private-link-service-network-policies yes\n```\n\n----------------------------------------\n\nTITLE: Viewing Instance Config: Example JSON Response (GET)\nDESCRIPTION: This JSON response is returned when querying the configuration of an instance, including its version history and any external ID (commit hash) associated with the configuration. The instance configuration includes details about the NGINX build and version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/publish-configs.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"build\": {\n    \"nginxPlus\": true,\n    \"release\": \"nginx-plus-r28\",\n    \"version\": \"1.23.2\"\n  },\n  \"configPath\": \"/etc/nginx/nginx.conf\",\n  \"configVersion\": {\n    \"instanceGroup\": {\n      \"createTime\": \"0001-01-01T00:00:00Z\",\n      \"uid\": \"\",\n      \"versionHash\": \"\"\n    },\n    \"versions\": [\n      {\n        \"createTime\": \"2023-02-28T19:54:58.735Z\",\n        \"externalId\": \"521747298a3790fde1710f3aa2d03b55020575aa\",\n        \"externalIdType\": \"git\",\n        \"uid\": \"92a9dbfa-dc6a-5bf9-87dd-19405db0b9c0\",\n        \"versionHash\": \"c0f7abbd9b9060c75985b943f3ec0cfc7e4b28cbf50c26bfd0b2141bb6c277a3\"\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Stream Upstream Connection Count Metric\nDESCRIPTION: Describes the 'plus.stream.upstream.conn.count' metric, which is a counter for the total number of client connections forwarded to the stream upstream server. This indicates the total number of forwarded stream connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_25\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Total number of client connections forwarded to this server.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Zone Directive in NGINX Configuration (Text)\nDESCRIPTION: This snippet shows the relevant portion of the NGINX configuration output, specifically the `upstream` blocks for `coffee` and `tea`. It confirms that the `zone` directive is set to `1m` for both upstreams, as defined in the `UpstreamSettingsPolicy`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_13\n\nLANGUAGE: text\nCODE:\n```\nupstream default_coffee_80 {\n    random two least_conn;\n    zone default_coffee_80 1m;\n\n    server 10.244.0.14:8080;\n}\n\nupstream default_tea_80 {\n    random two least_conn;\n    zone default_tea_80 1m;\n\n    server 10.244.0.15:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: Running nginx-sync.sh to display configuration differences (Shell)\nDESCRIPTION: This command executes the `nginx-sync.sh` script to compare the configuration of the local node with a specified recovered peer node. The `-c` flag specifies the hostname of the recovered node, and the `-d` flag triggers the display of configuration differences using the `diff` utility. This is useful for identifying discrepancies after a peer node has been offline.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nnginx-sync.sh -c node2.example.com -d\n```\n\n----------------------------------------\n\nTITLE: Configuring Log with Escaped Character and Custom List Prefix/Delimiter/Suffix (JSON)\nDESCRIPTION: This JSON snippet configures a security log filter to modify the output format. It replaces '/' characters with '|', and customizes list formatting with a prefix '[', a delimiter '::', and a suffix ']'.  The configuration specifies the request type to 'all', format as 'default', and defines maximum sizes for the request and message.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/security-log.md#_snippet_7\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filter\": {\n        \"request_type\": \"all\"\n    },\n    \"content\": {\n        \"format\": \"default\",\n        \"max_request_size\": \"2k\",\n        \"max_message_size\": \"5k\",\n        \"escaping_characters\": [\n      \t    {\n                \"from\": \"/\",\n                \"to\": \"|\"\n            }\n        ],\n        \"list_prefix\": \"[\",\n        \"list_delimiter\": \"::\",\n        \"list_suffix\": \"]\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create NGINXaaS Deployment with Private IP (Azure CLI)\nDESCRIPTION: This example creates an NGINXaaS deployment configured with a private IP address using static allocation. It sets the name, resource group, location, and SKU. The `network-profile` parameter configures the front-end IP with a specified subnet ID and a static private IP address.  An existing virtual network/subnet is required. Ensure the specified private IP is available within the subnet.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/create-deployment/deploy-azure-cli.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment create --name myDeployment --resource-group \\\n      myResourceGroup --location eastus2 --sku \\\n      name=\"standardv2_Monthly\" --network-profile \\\n      front-end-ip-configuration=\"{private-ip-addresses:[{private-ip-allocation-method:Static,subnet-id:/subscriptions/mySubscription/resourceGroups/myResourceGroup/providers/Microsoft.Network/virtualNetworks/myVNet/subnets/mySubnet,private-ip-address:10.0.0.2}]}\" \\\n      network-interface-configuration=\"{subnet-id:/subscriptions/mySubscription/resourceGroups/myResourceGroup/providers/Microsoft.Network/virtualNetworks/myVNet/subnets/mySubnet}\"\n```\n\n----------------------------------------\n\nTITLE: Add HTTP Strict Transport Security Headers to Gateway (JSON)\nDESCRIPTION: This JSON snippet configures a gateway to add HTTP Strict Transport Security (HSTS) headers to responses. It defines a `uriSnippets` section, specifying which URIs the directives should be applied to and includes directives to add the HSTS header with a specified max-age and includeSubDomains.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-snippets.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"<gateway-name>\"\n    },\n    \"desiredState\": {\n        \"configSnippets\": {\n            \"uriSnippets\": [\n                {\n                    \"applicableUris\": [\n                        {\n                            \"uri\": \"http://172.16.0.238:81\"\n                        }\n                    ],\n                    \"directives\": [\n                        {\n                            \"directive\": \"add_header\",\n                            \"args\": [\"Strict-Transport-Security\", \"max-age=31536000; includeSubDomains\", \"always\"]\n                        }\n                    ]\n                }\n            ]\n        },\n        \"ingress\": {\n            \"uris\": {\n                \"http://example.com:8020\": {}\n            },\n            \"placement\":  {\n                \"instanceRefs\": [\n                    {\n                        \"ref\": \"/infrastructure/locations/unspecified/instances/<instance-name>\"\n                    }\n                ]\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Defining a GraphQL Policy in JSON\nDESCRIPTION: This JSON snippet defines a GraphQL policy for NGINX App Protect. It includes the policy name, template, application language, enforcement mode, and URL configurations. Specifically, it removes the wildcard URL and defines the /graphql endpoint, associating it with the 'Default' content profile.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/how-to/enable-graphql.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\n{\n    \"name\": \"graphql_policy\",\n    \"template\": {\n        \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"applicationLanguage\": \"utf-8\",\n    \"caseInsensitive\": false,\n    \"enforcementMode\": \"blocking\",\n    \"urls\": [\n        {\n            \"$action\": \"delete\",\n            \"method\": \"*\",\n            \"name\": \"*\",\n            \"type\": \"wildcard\"\n        },\n        {\n            \"name\": \"/graphql\",\n            \"type\": \"explicit\",\n            \"urlContentProfiles\": [\n                {\n                    \"contentProfile\": {\n                        \"name\": \"Default\"\n                    },\n                    \"headerValue\": \"*\",\n                    \"headerName\": \"*\",\n                    \"headerOrder\": \"default\",\n                    \"type\": \"graphql\"\n                }\n            ]\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: GraphQL Profile Configuration Example\nDESCRIPTION: This code snippet shows an example of a GraphQL profile configuration. It demonstrates how to configure attack signature checks, defense attributes (e.g., disabling introspection queries, setting query limits), and response enforcement with a list of disallowed patterns.  The configuration defines security settings that can be applied to GraphQL applications.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/concept/graphql-profile.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\n\"graphql-profiles\" : [\n         {\n            \"attackSignaturesCheck\" : true,\n            \"defenseAttributes\" : {\n            \"allowIntrospectionQueries\" : false,\n               \"maximumBatchedQueries\" : 10,\n               \"maximumQueryCost\" : \"any\",\n               \"maximumStructureDepth\" : 10,\n               \"maximumTotalLength\" : 100000,\n               \"maximumValueLength\" : 100000,\n               \"tolerateParsingWarnings\" : false\n            },\n            \"description\" : \"\",\n            \"metacharElementCheck\" : false,\n            \"name\" : \"response_block\",\n            \"responseEnforcement\" : {\n               \"blockDisallowedPatterns\" : true,\n               \"disallowedPatterns\":[\"pattern1\",\"pattern2\"]\n            }\n         }\n     ]\n```\n\n----------------------------------------\n\nTITLE: NGINX SSL/TLS Termination Configuration\nDESCRIPTION: This NGINX configuration snippet demonstrates how to configure SSL/TLS termination, decrypting incoming traffic before forwarding it to upstream servers. It requires the `ssl_certificate` and `ssl_certificate_key` directives to be configured with the paths to the certificate and key files, which must match the paths specified when adding the certificate to the NGINXaaS deployment. The backend server address and port must also be configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/certificates.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    upstream backend {\n        server backend1.example.com:8000; # replace with your backend server address and port\n    }\n\n    server {\n        listen 443 ssl;\n\n        ssl_certificate /etc/nginx/ssl/example.crt;     # must match the Certificate path\n        ssl_certificate_key /etc/nginx/ssl/example.key; # must match the Key path\n\n        location / {\n            proxy_pass http://backend;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create NodePort Config\nDESCRIPTION: This YAML file configures a NodePort service for NGINX Gateway Fabric. It exposes ports 80 (HTTP) and 443 (HTTPS) on the cluster nodes using nodePorts 31437 and 31438, respectively. The selectors match the labels of the NGINX Gateway Fabric deployment to route traffic to the correct pods.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-gateway\n  namespace: nginx-gateway\n  labels:\n    app.kubernetes.io/name: nginx-gateway-fabric\n    app.kubernetes.io/instance: ngf\n    app.kubernetes.io/version: \"{{< version-ngf >}}\"\nspec:\n  type: NodePort\n  selector:\n    app.kubernetes.io/name: nginx-gateway-fabric\n    app.kubernetes.io/instance: ngf\n  ports:\n    - name: http\n      port: 80\n      protocol: TCP\n      targetPort: 80\n      nodePort: 31437\n    - name: https\n      port: 443\n      protocol: TCP\n      targetPort: 443\n      nodePort: 31438\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Upstream for Exchange Load Balancing\nDESCRIPTION: This code snippet configures an `upstream` block in NGINX for basic load balancing of Microsoft Exchange HTTPS traffic. It includes directives for defining the upstream server group, enabling NTLM authentication (requires NGINX Plus R7 and later), defining individual CAS servers, and configuring sticky sessions based on client IP address. The `zone` directive sets up shared memory for the upstream.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_39\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream exchange {\n    zone exchange-general 64k;\n    ntlm;\n\n    server 10.0.0.237:443; # Replace with IP address of a CAS\n    server 10.0.0.238:443; # Replace with IP address of a CAS\n    sticky learn create=$remote_addr lookup=$remote_addr\n                 zone=client_sessions:10m timeout=3h;\n}\n```\n\n----------------------------------------\n\nTITLE: Start NGINX Agent on FreeBSD\nDESCRIPTION: Starts the NGINX Agent service on FreeBSD using the `service` command. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-unprivileged.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo service nginx-agent start\n```\n\n----------------------------------------\n\nTITLE: Configure AWS CLI\nDESCRIPTION: This snippet demonstrates how to configure the AWS CLI with your credentials, including the Access Key ID, Secret Access Key, region name, and output format. This is a prerequisite for using the AWS CLI to interact with AWS services, including Session Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/aws-deploy.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\n$ aws configure\nAWS Access Key ID []: ****************DLVT\nAWS Secret Access Key []: ****************666r\nDefault region name []: <yourRegionName>\nDefault output format []: json\n```\n\n----------------------------------------\n\nTITLE: Include Weblogic Config\nDESCRIPTION: This Nginx configuration snippet includes weblogic configurations from the conf.d directory. It includes either basic or enhanced configurations.  The http block is required.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    include conf.d/weblogic-(basic|enhanced).conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Invalid Service Configuration Example - Kubernetes\nDESCRIPTION: This example shows an invalid Kubernetes Service configuration where multiple ports duplicate the `.spec.ports[].targetPort` value.  NGINX Service Mesh disregards duplicate targetPorts, only honoring one for traffic forwarding, authentication, and encryption.  The Service should use unique `.spec.ports[].targetPort` values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.3.0.md#_snippet_0\n\nLANGUAGE: plaintext\nCODE:\n```\napiVersion: v1\nkind: Service\nspec:\n  ports:\n  - port: 8080\n    protocol: TCP\n    targetPort: 55555\n  - port: 9090\n    protocol: TCP\n    targetPort: 55555\n```\n\n----------------------------------------\n\nTITLE: Describe HTTPRoutes using kubectl\nDESCRIPTION: This command retrieves detailed information about HTTPRoute resources. Useful for inspecting the route configuration, status, and associated conditions. It can be used to verify if routes have been accepted and resolved successfully.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe httproutes\n```\n\n----------------------------------------\n\nTITLE: Restart Nginx Devportal Service (TLS Config)\nDESCRIPTION: Restarts the nginx-devportal service to apply changes to TLS configuration after updating the `devportal.conf` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nginx-devportal\n```\n\n----------------------------------------\n\nTITLE: Adding SPIRE Agent Address Argument\nDESCRIPTION: This YAML snippet shows the command-line argument added to the Ingress Controller's container args. The `-spire-agent-address` argument specifies the address of the SPIRE agent socket, enabling the Ingress Controller to communicate with the agent and retrieve certificates and keys.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_18\n\nLANGUAGE: YAML\nCODE:\n```\nargs:\n  - -spire-agent-address=/run/spire/sockets/agent.sock\n  ...\n```\n\n----------------------------------------\n\nTITLE: Querying DNS using nslookup\nDESCRIPTION: This code snippet uses `nslookup` to determine the IP address returned for a specific domain. It checks which site NS1 is returning for US-based hosts.  The expected output is the IP address of the US-based Nginx Plus instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\n$ nslookup nginxgslb.cf\n\nServer:     10.10.100.102\nAddress:    10.10.100.102#53\n\nNon-authoritative answer:\nName:\tnginxgslb.cf\nAddress: 10.10.10.1\n```\n\n----------------------------------------\n\nTITLE: Update Kubernetes Service with externalTrafficPolicy (YAML)\nDESCRIPTION: This YAML snippet shows the addition of the `externalTrafficPolicy: Local` setting to the `deployments/service/loadbalancer-aws-elb.yaml` service definition. Setting the external traffic policy to `Local` preserves the client source IP address when traffic is routed to the NGINX ingress controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_14\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nkind: Service\nmetadata:\n name: nginx-ingress-nlb\n namespace: nginx-ingress\n annotations:\n  service.beta.kubernetes.io/aws-load-balancer-backend-protocol: \"tcp\"\n  service.beta.kubernetes.io/aws-load-balancer-proxy-protocol: \"*\"\n  service.beta.kubernetes.io/aws-load-balancer-type: nlb\nspec:\n  externalTrafficPolicy: Local\n  type: LoadBalancer\n  ports:\n  - port: 80\n    targetPort: 80\n    protocol: TCP\n    name: http\n  - port: 443\n    targetPort: 443\n    protocol: TCP\n    name: https\n  selector:\n   app: nginx-ingress\n```\n\n----------------------------------------\n\nTITLE: Listing Security Policy Bundles with GET - Shell\nDESCRIPTION: This snippet shows how to list existing security policy bundles using a GET request to the `/api/platform/v1/security/policies/bundles` endpoint. The example curl command includes an authorization header with a bearer token.  Requires a valid access token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET https://{{NIM_FQDN}}/api/platform/v1/security/policies/bundles \\\n    -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Raw DNS Query Packet Example\nDESCRIPTION: This is an example of a raw DNS query packet, represented as a hexadecimal string with '\\x' prefixes. The packet is used to query 'healthcheck.example.com' and is intended for use with Nginx's 'send' directive in a match block for DNS health checks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_13\n\nLANGUAGE: none\nCODE:\n```\n\\x00\\x01\\x01\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x0b\\x68\\x65\\x61\\x6c\\x74\\x68\\x63\\x68\\x65\\x63\\x6b\\x07\\x65\\x78\\x61\\x6d\\x70\\x6c\\x65\\x03\\x63\\x6f\\x6d\\x00\\x00\\x01\\x00\\x01\n```\n\n----------------------------------------\n\nTITLE: Deploy Headers application - Shell\nDESCRIPTION: Deploys the example headers application from a remote YAML file. This application returns the request headers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/examples/http-request-header-filter/headers.yaml\n```\n\n----------------------------------------\n\nTITLE: Testing the Coffee Application with curl (Shell)\nDESCRIPTION: This shell command uses `curl` to test the coffee application by sending an HTTPS request to `https://cafe.example.com/coffee`. The `-v` option increases verbosity, allowing inspection of the TLS handshake and certificate details.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/integrating-cert-manager.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://cafe.example.com/coffee -v\n```\n\n----------------------------------------\n\nTITLE: Port-Forwarding to Prometheus Service\nDESCRIPTION: This command sets up port forwarding to the Prometheus service, making the Prometheus server accessible locally.  Replace `<prometheus-namespace>` with the namespace Prometheus is running in.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/deploy-example-app.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nkubectl -n <prometheus-namespace> port-forward svc/prometheus 9090\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Instance Manager for Local Secret Storage\nDESCRIPTION: This configuration snippet shows the setting for the `driver` parameter under `core/secrets` within `/etc/nms/nms.conf` to 'local'.  This directs NGINX Instance Manager to use local file-based encryption for secrets instead of Vault.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-vault.md#_snippet_8\n\nLANGUAGE: text\nCODE:\n```\ndriver: local\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX Signing Key to Alpine Linux\nDESCRIPTION: This command downloads the NGINX signing public key from the specified URL and saves it to the `/etc/apk/keys` directory. This key is used to verify the authenticity and integrity of NGINX packages. The `wget` command downloads the key, and the `-O` option specifies the output file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-alpine.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub\n```\n\n----------------------------------------\n\nTITLE: Return Default gRPC Status Codes JSON Configuration\nDESCRIPTION: This JSON configuration defines an environment that returns default gRPC status codes by configuring the error-response-format policy. It specifies mappings between HTTP status codes (e.g., 400) and gRPC status codes, error codes and messages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/grpc-policies.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"{{environmentname}}\",\n    \"type\": \"NON-PROD\",\n    \"functions\": [\n        \"API-GATEWAY\"\n    ],\n    \"proxies\": [\n        {\n            \"proxyClusterName\": \"{{instanceGroupName}}\",\n            \"hostnames\": [\n                \"{{environmentHostname}}\"\n            ],\n            \"runtime\": \"GATEWAY-PROXY\",\n            \"listeners\": [\n                {\n                    \"port\": 8085,\n                    \"transportProtocol\": \"GRPC\"\n                }\n            ],\n            \"policies\": {\n                \"error-response-format\": [\n                    {\n                        \"action\": {\n                            \"400\": {\n                                \"errorCode\": \"13\",\n                                \"grpcStatusCode\": 5,\n                                \"errorMessage\": \"Bad Request\"\n                            }\n                        }\n                    }\n                ]\n            }\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Logging Client IP Address with PROXY Protocol Variable\nDESCRIPTION: This snippet configures the `log_format` directive in both the `http` and `stream` blocks to include the client IP address obtained from the PROXY protocol using the `$proxy_protocol_addr` variable. This ensures that the correct client IP address is logged, even when NGINX is behind a load balancer or proxy. The logged format is named \"combined\" for the HTTP block and \"basic\" for the stream block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/using-proxy-protocol.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n    log_format combined '$proxy_protocol_addr - $remote_user [$time_local] '\n                        '\"$request\" $status $body_bytes_sent '\n                        '\"$http_referer\" \"$http_user_agent\"';\n}\n\n```\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    log_format basic '$proxy_protocol_addr - $remote_user [$time_local] '\n                      '$protocol $status $bytes_sent $bytes_received '\n                      '$session_time';\n}\n```\n\n----------------------------------------\n\nTITLE: Brute Force Policy Example 2 JSON\nDESCRIPTION: This JSON demonstrates a brute force policy configuration for a specific login page. It includes configurations for login attempts from the same IP and user, along with actions and thresholds.  It references a specific URL using the 'url' parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_8\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"BruteForcePolicySpec\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"brute-force-attack-preventions\" : [\n            {\n               \"bruteForceProtectionForAllLoginPages\" : false,\n               \"loginAttemptsFromTheSameIp\" : {\n                  \"action\" : \"alarm\",\n                  \"enabled\" : true,\n                  \"threshold\" : 20\n               },\n               \"loginAttemptsFromTheSameUser\" : {\n                  \"action\" : \"alarm\",\n                  \"enabled\" : true,\n                  \"threshold\" : 3\n               },\n               \"reEnableLoginAfter\" : 3600,\n               \"sourceBasedProtectionDetectionPeriod\" : 3600,\n               \"url\": {\n                 \"method\": \"*\",\n                 \"name\": \"/html_login\",\n                 \"protocol\": \"http\"\n\t\t       }\n            }\n        ],\n\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Build Default NGINX Plus Image (Ubuntu)\nDESCRIPTION: Builds the default NGINX Plus image using Ubuntu 24.04 (Noble) as the base image.  A license is required to use NGINX Agent with NGINX Plus.  The `IMAGE_BUILD_TARGET` is set to `install-agent-repo` to use the NGINX Agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\nIMAGE_BUILD_TARGET=install-agent-repo make image\n```\n\n----------------------------------------\n\nTITLE: Successful Nginx configuration test output\nDESCRIPTION: This snippet displays the expected output when the Nginx configuration test (`nginx -t`) is successful. It indicates that the configuration file syntax is correct and the configuration file can be loaded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginscript.md#_snippet_8\n\nLANGUAGE: Shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Test CAMELLIA-SHA Cipher (Shell)\nDESCRIPTION: This command tests FIPS 140-2 compliance by attempting an SSL/TLS connection using the CAMELLIA256-SHA cipher.  This cipher is considered secure but is not permitted under FIPS. The handshake should fail if the server is FIPS compliant.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/fips-compliance-nginx-plus.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\n(echo \"GET /\" ; sleep 1) | openssl s_client -connect <NGINX-Plus-address>:443 -cipher CAMELLIA256-SHA\n```\n\n----------------------------------------\n\nTITLE: Displaying Node State with ip addr show\nDESCRIPTION: This command displays the IP address configuration for the specified network interface.  It is used to verify which node is currently the primary by checking if the VIP is assigned to the node's interface. Requires the `iproute2` package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ncentos7-1 $ ip addr show eth0\n```\n\n----------------------------------------\n\nTITLE: Help Output: Attack Signature Report Tool\nDESCRIPTION: Displays the usage instructions, required and optional arguments for the Attack Signature Report tool. This output appears when running the tool without arguments, or using the `--help` flag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_24\n\nLANGUAGE: shell\nCODE:\n```\nUSAGE:\n    /opt/app_protect/bin/get-signatures <arguments>\n\n  Required arguments:\n    --outfile|o='/path/to/report-file.json'\n      File name to write signature report.\n\n  Optional arguments:\n    --fields|f='list,of,fields'\n      Comma separated list of desired fields.\n      Available fields:\n      name,signatureId,signatureType,attackType,accuracy,tag,risk,systems,hasCve,references,isUserDefined,description,lastUpdateMicros\n\nOptionally, using --help will issue this help message.\n```\n\n----------------------------------------\n\nTITLE: Create Infrastructure Workspace with NGINX Management Suite API (JSON)\nDESCRIPTION: This JSON payload is used to create a new Infrastructure Workspace in NGINX Management Suite.  It defines the workspace name, description, and contact details. The `name` field uses a placeholder `{{infraWorkspaceName}}` which needs to be replaced with the desired workspace name.  The `adminEmail`, `adminName`, and `adminPhone` fields store the contact information for the workspace administrator.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/add-api-gateway.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"{{infraWorkspaceName}}\",\n    \"metadata\": {\n        \"description\": \"App Development Workspace\"\n    },\n    \"contactDetails\": {\n        \"adminEmail\": \"I.M.Devs@example.com\",\n        \"adminName\": \"I.M. Devs\",\n        \"adminPhone\": \"555 321 1234\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Upstream Zombie Servers Metric\nDESCRIPTION: Describes the 'plus.upstream.zombies' metric, which is a gauge representing the current number of servers that have been removed from the upstream group but are still processing active client requests. This metric indicates the number of servers in the process of being phased out.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_8\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, integer\nDescription: Current number of servers removed from the group but still processing\n               active client requests.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Run Chef Client on Node\nDESCRIPTION: This command runs the Chef client on the target node. The Chef client applies the configuration defined in the node's run list and attributes, ensuring the node is configured according to the desired state. Requires root privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_9\n\nLANGUAGE: text\nCODE:\n```\nusername@chef-test-1:~$ sudo chef-client\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Service Mesh with CLI\nDESCRIPTION: This command deploys NGINX Service Mesh using the CLI tool `nginx-meshctl`. It configures the mesh to integrate with Prometheus for metrics collection and OpenTelemetry Collector for trace collection, specifying the addresses and sampler ratio.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/observability.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy --prometheus-address \"prometheus.nsm-monitoring.svc:9090\" --telemetry-exporters \"type=otlp,host=otel-collector.nsm-monitoring.svc,port=4317\" --telemetry-sampler-ratio 1\n```\n\n----------------------------------------\n\nTITLE: NGINX gRPC Error - Nginx Configuration\nDESCRIPTION: This snippet shows an example error when the NGINX version is not v1.18 or later. This is a workaround when starting NGINX Instance Manager, and errors are seen in `/etc/nginx/conf.d/nms-http.conf:227`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/known-issues.md#_snippet_10\n\nLANGUAGE: text\nCODE:\n```\nnginx[1234]: nginx: [emerg] unknown directive \"grpc_socket_keepalive\"\n```\n\n----------------------------------------\n\nTITLE: Description of system.mem.pct_used metric\nDESCRIPTION: Provides the type and description for the system.mem.pct_used metric which is a gauge in percent representing Statistics about system memory usage, percentage.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_7\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, percent\nDescription: Statistics about system memory usage, percentage.\n```\n\n----------------------------------------\n\nTITLE: Add TLS Inbound Policy - JSON\nDESCRIPTION: This JSON configuration defines a TLS Inbound policy to secure incoming traffic. It includes parameters for server certificates and trusted root CA certificates. The `{{tlsKey}}`, `{{tlsCert}}`, and `{{caCert}}` are placeholders for the actual certificate data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/tls-policies.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policies\": {\n        \"tls-inbound\": [\n            {\n                \"data\": {\n                    \"serverCerts\": [\n                        {\n                            \"key\": {{tlsKey}},\n                            \"cert\": {{tlsCert}}\n                        }\n                    ],\n                    \"trustedRootCACerts\":{{caCert}}\n                }\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Verifying Load Balancing with Curl\nDESCRIPTION: This command uses `curl` in a loop to repeatedly request the index page from the load balancer and extract the 'Server' header, which indicates the application instance that served the request.  It is used to verify that traffic is being distributed among the backend servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\nwhile true; do curl -s <LB-external-IP-address> | grep Server: ;done\n```\n\n----------------------------------------\n\nTITLE: Delete License via NGINX Controller REST API\nDESCRIPTION: This snippet outlines how to delete a license from NGINX Controller using the REST API. This requires sending a DELETE request to the `/platform/license` endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/licensing-controller.md#_snippet_2\n\n\n\n----------------------------------------\n\nTITLE: Restart ClickHouse server\nDESCRIPTION: This command restarts the ClickHouse server using systemctl. This is necessary after upgrading ClickHouse to apply the changes and ensure proper operation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart clickhouse-server\n```\n\n----------------------------------------\n\nTITLE: Set System Time - Bash\nDESCRIPTION: This command sets the system time manually. The date and time should be set to one day before the kubelet cert expiry. This is used in a workaround if the NGINX Controller host was down when the kubelet certificate expired.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo timedatectl set-time \"2021-08-16 00:00:00\"\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Service Mesh Release using Helm\nDESCRIPTION: This command uninstalls the `nsm` release from the `nginx-mesh` namespace.  It removes most Kubernetes components associated with the NGINX Service Mesh release, but does not remove CRDs, the `nginx-mesh` namespace, or the Spire PersistentVolumeClaim.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/uninstall/uninstall-with-helm.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nhelm uninstall nsm --namespace nginx-mesh\n```\n\n----------------------------------------\n\nTITLE: Scanning NGINX Instances via API with Disabled Host Discovery (Shell)\nDESCRIPTION: This shell command initiates a scan for NGINX instances using the NGINX Instance Manager API, specifically disabling host discovery. It sends a POST request with a CIDR block, sets hostDiscovery to \"none\", and specifies port ranges to scan. It requires a valid access token for authorization and uses the application/json content type.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/scan-instances.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ncurl --request POST \\\n  --url https://<NGINX-INSTANCE-MANAGER-FQDN>/api/platform/v1/servers/scan \\\n  --header 'Authorization: Bearer <access token>.' \\\n  --header 'content-type: application/json' \\\n  --data '{\"cidr\": \"192.0.2.0/24\",\"hostDiscovery\": \"none\",\"portRanges\": [\"80\",\"443\"]}'\n```\n\n----------------------------------------\n\nTITLE: Creating Manual Signature Set\nDESCRIPTION: This JSON configures a signature set named 'my-cherry-picked-signatures' using a manual approach. It includes signatures with specific signature IDs (200003360 and 200001234). This signature set will block and alarm when triggered. The 'type' is set to 'manual', and the 'signatures' array contains the 'signatureId' for each signature to be included.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/user-defined-signature-sets.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"manual_signature_sets\",\n    \"template\": {\n        \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"applicationLanguage\": \"utf-8\",\n    \"enforcementMode\": \"blocking\",\n    \"signature-sets\": [\n        {\n            \"name\": \"my-cherry-picked-signatures\",\n            \"block\": true,\n            \"alarm\": true,\n            \"signatureSet\": {\n                \"type\": \"manual\",\n                \"signatures\": [\n                    {\n                        \"signatureId\": 200003360\n                    },\n                    {\n                        \"signatureId\": 200001234\n                    }\n                ]\n            }\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Upstream Configuration with Sticky Route\nDESCRIPTION: This code snippet configures NGINX Plus to select the upstream server by inspecting the `JSESSIONID` cookie and URL in each request and extracting the `jvmRoute` value. It uses `map` directives to extract the route from the cookie and URI, and then uses the `sticky route` directive to maintain session persistence.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_28\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nmap $cookie_jsessionid $route_cookie {\n   ~.+\\.(?P<route>\\w+)$ $route;\n}\n\nmap $request_uri $route_uri {\n   ~jsessionid=.+\\.(?P<route_uri>\\w+)$ $route_uri;\n}\n\nupstream tomcat {\n   server 10.100.100.11:8080 route=a;\n   server 10.100.100.12:8080 route=b;\n   sticky route $route_cookie $route_uri;\n}\n```\n\n----------------------------------------\n\nTITLE: Example JSON Response for DeploymentDetails API\nDESCRIPTION: This JSON snippet shows the response format for the DeploymentDetails API, highlighting the required 'failure' and 'success' fields, which contain arrays representing NGINX instances that either failed or succeeded in a deployment. It demonstrates how to structure the response with UUIDs for identifying instances and indicating the deployment status.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/release-notes.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"createTime\": \"2022-04-18T23:09:16Z\",\n  \"details\": {\n    \"failure\": [ ],\n    \"success\": [\n      {\n        \"name\": \"27de7cb8-f7d6-3639-b2a5-b7f48883aee1\"\n      }\n    ]\n  },\n  \"id\": \"07c6101e-27c9-4dbb-b934-b5ed75e389e0\",\n  \"status\": \"finalized\",\n  \"updateTime\": \"2022-04-18T23:09:16Z\"\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Access Log Format\nDESCRIPTION: This NGINX configuration snippet defines a custom log format named 'main' and configures the access log to use this format. It specifies various variables to be included in the log, such as remote address, user, request details, status code, bytes sent, referer, user agent, forwarded for, bytes sent, request length, request time, gzip ratio, and server protocol.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/overview-metrics.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nlog_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                  '$status $body_bytes_sent \"$http_referer\" '\n                  '\"$http_user_agent\" \"$http_x_forwarded_for\" '\n                  '\"$bytes_sent\" \"$request_length\" \"$request_time\" '\n                  '\"$gzip_ratio\" $server_protocol ';\n\naccess_log  /var/log/nginx/access.log  main;\n```\n\n----------------------------------------\n\nTITLE: Complete Example: Authentication and IP Restriction in Nginx\nDESCRIPTION: This is a complete Nginx configuration example that demonstrates how to protect a specific location (`/api`) with both HTTP Basic authentication and IP address-based access control. It includes setting up the server, defining IP address restrictions, and configuring the authentication prompt and user file. It uses `satisfy all` which means that both conditions need to be met.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-http-basic-authentication.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    server {\n        listen 192.168.1.23:8080;\n        root   /usr/share/nginx/html;\n\n        location /api {\n            api;\n            satisfy all;\n\n            deny  192.168.1.2;\n            allow 192.168.1.1/24;\n            allow 127.0.0.1;\n            deny  all;\n\n            auth_basic           \"Administrator’s Area\";\n            auth_basic_user_file /etc/apache2/.htpasswd;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Build Default NGINX OSS Image (Alpine)\nDESCRIPTION: Builds the default NGINX Open Source image using Alpine as the base image. The `IMAGE_BUILD_TARGET` variable is set to `install-agent-repo` which prepares the image to use the NGINX Agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nIMAGE_BUILD_TARGET=install-agent-repo make oss-image\n```\n\n----------------------------------------\n\nTITLE: Install yum prerequisites for Nginx Agent on RHEL\nDESCRIPTION: This command installs the necessary prerequisites for adding and managing yum repositories on RHEL-based systems, specifically for installing the Nginx Agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install yum-utils\n```\n\n----------------------------------------\n\nTITLE: Generating JSON with Custom Tag (Shell)\nDESCRIPTION: This command shows how to generate a user defined signature JSON file using the `convert-signatures` tool with a custom tag specified using the `--tag` option. It uses Docker and pipes the output through `jq` for formatting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_29\n\nLANGUAGE: shell\nCODE:\n```\ndocker run -v `pwd`:`pwd` -w `pwd` --entrypoint /opt/app_protect/bin/convert-signatures docker_img:latest -i /path/to/signatures.xml -o /path/to/signatures.json --tag \"MyTag\" | jq\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Agent Repository - Debian - Shell\nDESCRIPTION: Adds the Nginx Agent repository to the apt sources list in Debian.  This allows apt to locate and install the nginx-agent package. The lsb_release command dynamically determines the Debian release codename.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\necho \"deb https://pkgs.nginx.com/nginx-agent/debian/ `lsb_release -cs` agent\" \\\n  | sudo tee /etc/apt/sources.list.d/nginx-agent.list\n```\n\n----------------------------------------\n\nTITLE: Generating a Support Package with helper.sh in NGINX Controller (v3.0.0)\nDESCRIPTION: This snippet shows how to generate a support package in NGINX Controller v3.0.0 using the `helper.sh` script. It gathers configuration files, logs, and command output into a tarball for troubleshooting purposes. Certs are excluded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_43\n\nLANGUAGE: bash\nCODE:\n```\nubuntu@testenv-70389b9b-ctrl-1:/var/tmp$ /opt/nginx-controller/helper.sh supportpkg\nGathering System Diagnostics: Please wait ...\nFinished: /var/tmp/supportpkg-20191231T053348MST.tar.gz\n```\n\n----------------------------------------\n\nTITLE: NGINX Plus SSL Configuration (nginx)\nDESCRIPTION: This configuration snippet sets up a simple SSL/TLS-protected website using NGINX Plus. It configures the server to listen on port 443, specifies the SSL certificate and key, sets allowed SSL protocols, and defines the root directory and index files for the website.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/fips-compliance-nginx-plus.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 443 ssl;\n\n    ssl_certificate     /etc/nginx/ssl/test.crt;\n    ssl_certificate_key /etc/nginx/ssl/test.key;\n\n    ssl_protocols   \tTLSv1 TLSv1.1 TLSv1.2;\n\n    location / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Get NGINX Plus Repository Credentials (Deprecated) (Bash)\nDESCRIPTION: This command (deprecated in NGINX Controller v3.9) extracts the NGINX Plus repository key and certificate files using the `helper.sh` script. The `repository-cred` subcommand takes optional arguments `-c` or `--cert` for the certificate filename and `-k` or `--key` for the key filename.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh repository-cred [-c|--cert <file name>] [-k|--key <file name>]\n```\n\n----------------------------------------\n\nTITLE: Invalid Service Configuration Example YAML\nDESCRIPTION: Illustrates an invalid Service configuration with duplicate targetPorts that are disregarded by NGINX Service Mesh. The service lists multiple port configurations that duplicate `.spec.ports[].targetPort`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.7.0.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nkind: Service\nspec:\nports:\n- port: 8080\n     protocol: TCP\n     targetPort: 55555\n- port: 9090\n     protocol: TCP\n     targetPort: 55555\n```\n\n----------------------------------------\n\nTITLE: Disabling core dump size limit\nDESCRIPTION: Disables the limit on the maximum size of core dump files for the NGINX process. Uses `prlimit` to set the core size limit to unlimited. If `prlimit` fails, it tries using `ulimit` within a subshell.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\nsudo prlimit --core=unlimited:unlimited --pid $(cat /run/nginx.pid)\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Error Log Level\nDESCRIPTION: This snippet configures the NGINX error log to use the `warn` level. Setting the error log level to `warn` is necessary for collecting certain NGINX metrics, such as the number of requests buffered to disk. Nginx Amplify needs to be able to parse specific entries only available in the warning logs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nerror_log  /var/log/nginx/error.log warn;\n```\n\n----------------------------------------\n\nTITLE: Migrate Secrets to Vault\nDESCRIPTION: This command uses `nms-core` to migrate secrets from local storage to Vault. It's executed before switching the secrets driver to 'vault'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-vault.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nsudo nms-core secret migrate-secrets-to-vault\n```\n\n----------------------------------------\n\nTITLE: Create User Request with SCIM\nDESCRIPTION: This code snippet demonstrates the JSON payload required to create a new user in NGINX Instance Manager using the SCIM API.  It is sent as a POST request to the `/api/scim/v2/Users` endpoint. The request includes the user's schemas, external ID, username, and name details. Required dependency: An active SCIM server and NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/scim-provisioning.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"schemas\": [\n    \"urn:ietf:params:scim:schemas:core:2.0:User\"\n  ],\n  \"externalId\": \"idpuser@mydomain.ctrl\",\n  \"userName\": \"idpuser@mydomain.ctrl\",\n  \"name\": {\n    \"formatted\": \"Example IDP User\",\n    \"familyName\": \"Example\",\n    \"givenName\": \"SSO\"\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Redeploy NGINX Service Mesh\nDESCRIPTION: This snippet provides the commands to redeploy NGINX Service Mesh using `nginx-meshctl`. This is a workaround for TLS errors that may occur during the initial deployment due to a race condition involving the Spire server and its certificate authority.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.8.0.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl remove\nnginx-meshctl deploy ...\n```\n\n----------------------------------------\n\nTITLE: Copying Kubernetes Restore Script (cp)\nDESCRIPTION: This command copies the `k8s-restore.sh` script from the extracted Helm chart directory to the current working directory. Replace `nms-<version>` with the actual extracted chart directory name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\ncp nms-<version>/charts/nms-hybrid/backup-restore/k8s-restore.sh .\n```\n\n----------------------------------------\n\nTITLE: Querying Security Violation Events by Violation Rating\nDESCRIPTION: This example demonstrates querying security violation events flagged by App Security’s violation rating algorithm as a possible or likely threat, using the NGINX Controller REST API. The startTime is set to 0 and endTime to now. This query is specifically useful when App Security WAF is in monitoring only mode.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/view-app-security-analytics.md#_snippet_8\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            request_outcome_reason = 'SECURITY_WAF_FLAGGED' and\n            waf.violation_rating in ('POSSIBLE_ATTACK','MOST_LIKELY_ATTACK') and\n            app='shopping' and\n            environment='prod' and\n            component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Volume Definition for Nginx Plus Usage Certs\nDESCRIPTION: Defines a Kubernetes volume named `nginx-plus-usage-certs` that projects the CA and Client secrets. This is used when configuring NGINX Gateway Fabric to report to NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/nginx-plus-jwt.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\n- name: nginx-plus-usage-certs\n  projected:\n    sources:\n      - secret:\n          name: nim-ca\n      - secret:\n          name: nim-client\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisites for Debian/Ubuntu\nDESCRIPTION: This command updates the package list and installs the necessary packages (gcc, make, libpcre3-dev, and zlib1g-dev) required to compile NGINX modules on Debian and Ubuntu systems.  It ensures that the build environment has the correct tools and libraries for compiling dynamic modules.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_32\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update\nsudo apt install gcc make libpcre3-dev zlib1g-dev\n```\n\n----------------------------------------\n\nTITLE: Uninstall Controller Agent - CentOS/Red Hat\nDESCRIPTION: This snippet uninstalls the NGINX Controller Agent package on CentOS/Red Hat Enterprise Linux systems using yum. It removes the nginx-controller-agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-agent.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nyum remove nginx-controller-agent\n```\n\n----------------------------------------\n\nTITLE: Querying DNS using nslookup (Germany)\nDESCRIPTION: This code snippet uses `nslookup` to check that NS1 now returns the IP address of the Nginx Plus instance in Germany (10.10.10.2) after the US-based servers are down and the TTL has expired. This verifies that traffic is redistributed to the nearest healthy instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\n$ nslookup nginxgslb.cf\n\nServer:     10.10.100.102\nAddress:    10.10.100.102#53\n\nNon-authoritative answer:\nName:\tnginxgslb.cf\nAddress: 10.10.10.2\n```\n\n----------------------------------------\n\nTITLE: Introspection Policy Configuration (JSON)\nDESCRIPTION: This JSON snippet represents the configuration for an introspection policy. It defines how NGINX will verify claims in the introspected token, including the claim name, data type, and expected value. The configuration specifies the introspection endpoint, response type and verification rules for claims like `aud`, `scope`, `acr`, `email_verified`, and `resource_access.account.roles`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_52\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"test-proxy\",\n    \"version\": \"v1\",\n    \"proxyConfig\": {\n        \"hostname\": \"data-host\",\n        \"ingress\": {\n            \"basePath\": \"/\",\n            \"basePathVersionAppendRule\": \"NONE\"\n        },\n        \"backends\": [\n            {\n                \"serviceName\": \"backend-echo-svc\",\n                \"serviceTargets\": [\n                    {\n                        \"hostname\": \"192.0.2.4\",\n                        \"listener\": {\n                            \"enableTLS\": false,\n                            \"port\": 10000,\n                            \"transportProtocol\": \"HTTP\"\n                        }\n                    }\n                ]\n            }\n        ],\n        \"policies\": {\n            \"oauth2-introspection\": [\n                {\n                    \"action\": {\n                        \"introspectionEndpoint\": \"http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect\",\n                        \"introspectionResponse\": \"application/json\",\n                        \"verifyClaims\": [\n                            {\n                                \"claim\": \"aud\",\n                                \"type\": \"STRING\",\n                                \"value\": \"account\"\n                            },\n                            {\n                                \"claim\": \"scope\",\n                                \"type\": \"STRING\",\n                                \"value\": \"openid profile email\",\n                                \"delimiter\": \"SPACE\"\n                            },\n                            {\n                                \"claim\": \"acr\",\n                                \"type\": \"INTEGER\",\n                                \"value\": 1\n                            },\n                            {\n                                \"claim\": \"email_verified\",\n                                \"type\": \"BOOLEAN\",\n                                \"value\": true\n                            },\n                            {\n                                \"claim\": \"resource_access.account.roles\",\n                                \"type\": \"ARRAY\",\n                                \"value\": [\n                                    \"manage-account\",\n                                    \"manage-account-links\",\n                                    \"view-profile\"\n                                ]\n                            }\n                        ]\n                    },\n                    \"data\": [\n                        {\n                            \"clientAppID\": \"nginx-plus\",\n                            \"clientSecret\": \"<client secret>\"\n                        }\n                    ]\n                }\n            ]\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: AWS IAM Permissions JSON\nDESCRIPTION: This JSON snippet defines the required AWS IAM permissions for an IAM user to be used with F5 NGINX Controller. It grants permissions to perform actions related to EC2 instances and tags.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/integrations/aws-integration.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n\"ec2:*Instance*\",\n\"ec2:*Tags*\"\n```\n\n----------------------------------------\n\nTITLE: Restart Docker process (workaround)\nDESCRIPTION: This command restarts the Docker service. It's a workaround to stop leftover NGINX Controller containers on a node with a stopped `kubelet` process, which can prevent containers from starting on other nodes. Only use if there are no critical non-NGINX Controller containers running. Requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart docker\n```\n\n----------------------------------------\n\nTITLE: Use Extended Log Format in access_log - Nginx\nDESCRIPTION: Configures the `access_log` directive to use the defined extended log format.  This ensures that the specified format is used when logging requests, enabling the collection of additional metrics if the proper log format is created. The access log path will be set to `/var/log/nginx/access.log`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-metrics-collection.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\naccess_log /var/log/nginx/access.log main_ext;\n```\n\n----------------------------------------\n\nTITLE: NGINX configuration test failure due to bind error\nDESCRIPTION: This snippet illustrates an error encountered during BIG-IP Component creation, indicating a failure to bind to a specific IP address and port. This often signifies a network configuration problem where the requested address is not available.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.8.md#_snippet_2\n\nLANGUAGE: text\nCODE:\n```\nFailed testing config before applying: nginx:\nthe configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: [emerg] bind() to <IP>:20001 failed (99: Cannot assign requested address)\nnginx: configuration file /etc/nginx/nginx.conf test failed\n```\n\n----------------------------------------\n\nTITLE: NGINX Controller Timeout Error Text\nDESCRIPTION: This snippet shows an example of a timeout error that may be displayed during an NGINX Controller cluster upgrade, specifically when waiting for services to scale up. The message indicates a temporary delay and does not necessarily signify a failure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.1.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\nWhile waiting for nats-streaming-cluster to scale up, the operation did not complete before timing out.\n```\n\n----------------------------------------\n\nTITLE: Remove Existing NGINX Repo Files (Shell)\nDESCRIPTION: Removes any previously downloaded NGINX repository files and App Protect repository files from the `/etc/yum.repos.d` directory using `rm`.  Requires `sudo` privileges. Assumes the files start with `nginx` or end with `app-protect` and have a `.repo` extension.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-amazon.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo rm /etc/yum.repos.d/nginx*.repo\nsudo rm /etc/yum.repos.d/*app-protect*.repo\n```\n\n----------------------------------------\n\nTITLE: Query Multiple Metrics\nDESCRIPTION: This cURL command queries the Metrics API for two metrics simultaneously: `http.request.count` and `http.request.bytes_rcvd`.  Multiple metrics are specified by separating them with a comma in the `names` parameter. The API returns the latest recorded value for each specified metric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=http.request.count,http.request.bytes_rcvd\"\n```\n\n----------------------------------------\n\nTITLE: Submit usage report to F5 - REST API (curl)\nDESCRIPTION: This `curl` command submits the usage report to F5 for verification. It uses the `--form` option to upload the report file and includes an authorization header with a Bearer token (JWT).  The paths to the JWT file and the report zip file are placeholders.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\ncurl --location 'https://product.apis.f5.com/ee/v1/entitlements/telemetry/bulk' \\\n--header \"Authorization: Bearer $(cat /path/to/jwt-file)\" \\\n--form 'file=@\"<path-to-report>.zip\"'\n```\n\n----------------------------------------\n\nTITLE: Enable Egress with Label (Manifests)\nDESCRIPTION: Adds a label to the NGINX Ingress Controller Pod spec to enable egress traffic. This prevents automatic sidecar proxy injection and configures the NGINX Ingress Controller as the egress endpoint of the mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_6\n\nLANGUAGE: yaml\nCODE:\n```\nlabels:\n  nsm.nginx.com/enable-egress: \"true\"\n  ...\n```\n\n----------------------------------------\n\nTITLE: Extract the support package (Bash)\nDESCRIPTION: This snippet demonstrates how to extract the created support package using the `tar` command. The support package is named `k8s-support-pkg-<timestamp>.tar.gz`. The extracted contents contain detailed information about the cluster, namespace, application, and database state.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/support/k8s-support-package.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ntar -xvf k8s-support-pkg-<timestamp>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: HTTP Cookie Persistence on BIG-IP LTM\nDESCRIPTION: This code snippet configures HTTP cookie-based session persistence on BIG-IP LTM. It creates a persistence profile and modifies the virtual server to use it.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_7\n\nLANGUAGE: none\nCODE:\n```\n# create persistence cookie test_bigip_cookie cookie-name BIGIP_COOKIE_PERSIST expiration 1:0:0\n# modify virtual test_virtual { persist replace-all-with { test_bigip_cookie } }\n# save /sys config\n```\n\n----------------------------------------\n\nTITLE: Making the k8s-restore.sh Script Executable - Shell\nDESCRIPTION: This command makes the `k8s-restore.sh` script executable using `chmod +x`. This allows the user to run the script directly from the command line.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nchmod +x k8s-restore.sh\n```\n\n----------------------------------------\n\nTITLE: Querying GeoIP2 Database for ISO Code using mmdblookup\nDESCRIPTION: Example usage of the mmdblookup utility to query a GeoIP2 database for the ISO code of a country for a given IP address. Requires the libmaxminddb package to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nmmdblookup --file /usr/local/etc/geoip2/GeoLite2-Country.mmdb --ip 8.8.8.8 country iso_code\n```\n\n----------------------------------------\n\nTITLE: Verify Nginx Agent is running\nDESCRIPTION: Verifies that NGINX Agent is running and identifies the user under which it is running. It uses `ps aux` command combined with `grep nginx-agent` to filter the process list.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-unprivileged.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nps aux | grep nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Downloading Nginx Configuration via Curl\nDESCRIPTION: This shell script navigates to the Nginx configuration directory and uses the curl command to download a specific Nginx configuration file (gce-all-active-app.conf) from a remote GitHub repository. The downloaded configuration file is then saved locally with the same name, enabling the instance to use it.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ncd /etc/nginx/conf.d/\ncurl -o gce-all-active-app.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-app.conf\n```\n\n----------------------------------------\n\nTITLE: Create Diagnostic Settings for NGINX Logs to Log Analytics - Azure CLI\nDESCRIPTION: This command configures Azure Monitor diagnostic settings to export NGINX logs to a Log Analytics workspace. It takes the NGINXaaS resource ID, a diagnostic setting name, and the Log Analytics workspace name as parameters. The 'NginxLogs' category is enabled and retention is disabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/monitoring/enable-logging/logging-using-cli.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\naz monitor diagnostic-settings create --resource <nginxaas_resource_id> --logs \"[{category:NginxLogs,enabled:true,retention-policy:{enabled:false,days:0}}]\" --name <diagnostic_setting_name> --workspace <logs_analytics_workspace_name>\n```\n\n----------------------------------------\n\nTITLE: Pull NGINX Agent Docker Image\nDESCRIPTION: Pulls the latest mainline version of the NGINX Agent Docker image from the NGINX Docker registry.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ndocker pull docker-registry.nginx.com/nginx/agent:mainline\n```\n\n----------------------------------------\n\nTITLE: Running Ansible Playbook\nDESCRIPTION: This command runs the Ansible playbook named playbook.yml, which installs and configures NGINX using the specified role.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/microsoft-azure/virtual-machines-for-nginx.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nansible-playbook playbook.yml\n```\n\n----------------------------------------\n\nTITLE: Get OS Version Information\nDESCRIPTION: This code snippet retrieves operating system version information and kernel version, directing the output to a file named `system_version.txt`. This file is included in the troubleshooting tarball.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/troubleshooting-guide/troubleshooting.md#_snippet_9\n\nLANGUAGE: none\nCODE:\n```\ncat /etc/os-release > system_version.txt && uname -r >> system_version.txt && cat /proc/version >> system_version.txt\n```\n\n----------------------------------------\n\nTITLE: Removing Confidential Data from Support Archive (Bash)\nDESCRIPTION: These commands are used to remove sensitive information, like private keys and certificates, from the support archive generated by the support scripts before sharing it with F5 support. It involves unzipping the archive, deleting specific files, and then re-zipping it.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/support/contact-support.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ngzip -d /tmp/nginx-manager-log.tar.gz\n\ntar -f /tmp/nginx-manager-log.tar.gz \\\n    --delete /etc/nginx-manager/example.key \\\n    --delete /etc/nginx-manager/example.crt\n\ngzip -9 /tmp/nginx-manager-log.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Output: User Defined Signatures Conversion Success\nDESCRIPTION: Example JSON output showing the successful completion of the signature conversion.  It includes file size, filename, and a boolean indicating success.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_20\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"file_size\": 1003,\n    \"filename\": \"/path/to/signatures.json\",\n    \"completed_successfully\": true\n}\n```\n\n----------------------------------------\n\nTITLE: Apply Cafe Route Resources with Kubectl\nDESCRIPTION: This command applies the HTTPRoute resources defined in the cafe-routes.yaml file to the Kubernetes cluster, creating HTTPRoute resources for the coffee and tea applications. These routes define how traffic is routed to the backend services.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f cafe-routes.yaml\n```\n\n----------------------------------------\n\nTITLE: Configure Allowed Meta-Characters in URL - JSON\nDESCRIPTION: This example demonstrates how to configure allowed meta-characters in a user-defined URL using a JSON policy. It allows for specific characters (0x3c) and disallows others (0x28) within the URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/parameters-and-user-defined-urls.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"/Common/user_defined_URL\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_URL\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_URL_METACHAR\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"urls\": [\n            {\n                \"method\": \"*\",\n                \"name\": \"/meta*\",\n                \"protocol\": \"http\",\n                \"type\": \"wildcard\",\n                \"metacharsOnUrlCheck\": true,\n                \"metacharOverrides\": [\n                    {\n                        \"isAllowed\": true,\n                        \"metachar\": \"0x3c\"\n                    },\n                    {\n                        \"isAllowed\": false,\n                        \"metachar\": \"0x28\"\n                    }\n                ],\n                \"wildcardOrder\": 2\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: JSON Log Example with Custom Attributes\nDESCRIPTION: Illustrates how custom log attributes appear in the `json_log` output when using `app_protect_custom_log_attribute`. The `customLogAttribute` array contains key-value pairs of custom attributes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/custom-log-logging-reporting.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n\"\"customLogAttribute\"\":[{'name':'component','value':'comp1'},{'name':'gateway','value':'gway1'}]}\"\n```\n\n----------------------------------------\n\nTITLE: Reloading NGINX Configuration\nDESCRIPTION: Reloads the NGINX configuration using either `nginx -s reload` or `service nginx reload`. This applies the new configuration without interrupting service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_11\n\nLANGUAGE: none\nCODE:\n```\nroot# nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Deleting Kubernetes Manifests\nDESCRIPTION: This command deletes the Kubernetes resources defined in the manifests located in the `/home/user/k8s` directory. This is used to remove the deployed application from the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_29\n\nLANGUAGE: shell\nCODE:\n```\nkubectl delete -f /home/user/k8s\n```\n\n----------------------------------------\n\nTITLE: Query Metrics with Resolution - cURL\nDESCRIPTION: This cURL command retrieves aggregated metric values for the last three hours with one-hour granularity using the `resolution` parameter. It requires a session cookie and specifies the metric name, start time, and desired resolution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_9\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=SUM(http.request.count),&startTime=now-3h&resolution=1h\"\n```\n\n----------------------------------------\n\nTITLE: Configuring do-nothing URL Content Profile in JSON\nDESCRIPTION: This JSON configuration defines an Nginx security policy named 'ignore_body' which uses the 'POLICY_TEMPLATE_NGINX_BASE' template.  It configures a 'do-nothing' content profile for all methods and URLs, instructing the system to skip content inspection and base decisions solely on the request's headers. The policy ignores the request body, focusing solely on header analysis.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/do-nothing-and-user-defined-parameters.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\" : {\n        \"name\": \"ignore_body\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"urls\": [\n            {\n                \"method\": \"*\",\n                \"name\": \"*\",\n                \"type\": \"wildcard\",\n                \"urlContentProfiles\": [\n                    {\n                        \"headerName\": \"*\",\n                        \"headerOrder\": \"default\",\n                        \"headerValue\": \"*\",\n                        \"type\": \"do-nothing\"\n                    }\n                ]\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Dump Bundle Information\nDESCRIPTION: This command extracts and displays information about a compiled policy bundle file, such as attack signatures versions. It mounts the current directory as a volume and specifies the bundle file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ndocker run \\\n -v $(pwd):$(pwd) \\\n waf-compiler-<version-tag>:custom \\\n -dump -bundle $(pwd)/compiled_policy.tgz\n```\n\n----------------------------------------\n\nTITLE: Include OpenAPI Specification\nDESCRIPTION: This snippet includes an OpenAPI specification file for the Nginx API. It uses a Hugo shortcode `openapi` to render the API documentation from the `one.json` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/api/api-reference-guide.md#_snippet_0\n\nLANGUAGE: go-template\nCODE:\n```\n{{< openapi spec=\"./nginx-one/api/one.json\" >}}\n```\n\n----------------------------------------\n\nTITLE: Deploy UDP Listener App\nDESCRIPTION: This command deploys the example `udp-listener` application to the Kubernetes cluster using `kubectl`. It applies the configuration defined in the `udp-listener.yaml` file, which creates the necessary Kubernetes resources (e.g., Deployments, Services) for the application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-udp-walkthrough.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f udp-listener.yaml\n```\n\n----------------------------------------\n\nTITLE: Description of amplify.agent.cpu metrics\nDESCRIPTION: Provides the type and description for the amplify.agent.cpu metrics which is a gauge in percent representing CPU utilization percentage observed from the NGINX Amplify Agent process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_16\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, percent\nDescription: CPU utilization percentage observed from the NGINX Amplify Agent process.\n```\n\n----------------------------------------\n\nTITLE: Install Prerequisite Packages (CentOS/RHEL - Shell)\nDESCRIPTION: This snippet installs the prerequisite packages `ca-certificates`, `epel-release`, and `wget` using the `yum` package manager. These packages are necessary for verifying SSL certificates, accessing the Extra Packages for Enterprise Linux (EPEL) repository, and downloading files from the internet respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install ca-certificates epel-release wget\n```\n\n----------------------------------------\n\nTITLE: Configuring User-Defined Browsers and Mitigation Actions in Nginx\nDESCRIPTION: This JSON snippet demonstrates how to define user-defined browsers using `matchString` and configure mitigation actions for different browsers and browser versions using `classes` and `browsers` within the `bot-defense` section of an Nginx policy. It shows how to detect (allow) all browsers except for those with a 'block' action, and how to alarm if no browser is detected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/user-defined-browser-control.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"applicationLanguage\": \"utf-8\",\n        \"name\": \"example_1\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"browser-definitions\": [\n            {\n                \"name\": \"FunkyBrowserV3\",\n                \"matchString\": \"FunkyBrowser/1.3.1\",\n            },\n            {\n                \"name\": \"SmartBrowser4\",\n                \"matchRegex\": \"smartbrowser/([\\\\d.]+)\",\n            }\n        ],\n        \"bot-defense\": {\n            \"settings\" : {\n                \"isEnabled\": true\n            },\n            \"mitigations\": {\n                \"classes\": [\n                    {\n                        \"name\": \"browser\",\n                        \"action\": \"detect\"\n                    },\n                    {\n                        \"name\": \"unknown\",\n                        \"action\": \"alarm\"\n                    }\n                ],\n                \"browsers\": [\n                    {\n                        \"name\": \"safari\",\n                        \"action\": \"block\"\n                    },\n                    {\n                        \"name\": \"chrome\",\n                        \"minVersion\": 77,\n                        \"action\": \"block\"\n                    },\n                    {\n                        \"name\": \"firefox\",\n                        \"minVersion\": 45,\n                        \"maxVersion\": 60,\n                        \"action\": \"block\"\n                    },\n                    {\n                        \"name\": \"FunkyBrowserV3\",\n                        \"action\": \"block\"\n                    }\n                ]\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure ClickHouse TLS settings in nms.conf (YAML)\nDESCRIPTION: This snippet demonstrates how to configure TLS settings for ClickHouse connections within the `/etc/nms/nms.conf` file. It includes settings for TLS enablement, address, verification, certificate paths, and client key paths. It also includes settings to configure the log level and migrations path.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-clickhouse.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\nclickhouse:\n\n  # Sets the log level for ClickHouse processes within NMS.\n  log_level: debug\n\n  # Sets the address that will be used to connect to ClickHouse.\n  address: 127.0.0.1:9001\n\n  ## Note: Username and password should only be set, if you have custom defined username and password for ClickHouse.\n  ## Ensure that any configured username or password is wrapped in single quotes.\n  # Sets the username that will be used to connect to ClickHouse.\n  username: 'test-1'\n\n  # Sets the password that will be used to connect to ClickHouse.\n  password: 'test-2'\n\n  # Activates or deactivates TLS for connecting to ClickHouse.\n  # Note: `tls_mode` will be deprecated in the future, use the `tls` key to enable TLS connection for ClickHouse.\n  tls_mode: true\n\n  tls:\n    # Sets the address (form <ip-address:port>)used to connect to ClickHouse with a TLS connection.\n    address: 127.0.0.1:9441\n\n    # Activates or deactivates TLS verification of ClickHouse connection.\n    skip_verify: false\n\n    # Sets the path of the certificate used for TLS connections in PEM encoded format.\n    cert_path: /etc/certs\n\n    # Sets the path of the client key used for TLS connections in PEM encoded format.\n    key_path: /etc/key\n\n    # Sets the path of the Certificate Authority installed on the system for verifying certificates.\n    cert_ca: /etc/ca\n\n  # Sets directory containing ClickHouse migration files.\n  migrations_path: /test/migrations\n```\n\n----------------------------------------\n\nTITLE: Uninstalling on Debian/Ubuntu/Deb-based distributions\nDESCRIPTION: This snippet details the uninstallation process on Debian, Ubuntu, and Deb-based distributions using apt-get.  It stops the clickhouse-server service and removes the nms-* and clickhouse-server packages.  It also mentions the option of using apt-get purge to remove configuration files as well.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/uninstall/uninstall-nim.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get remove -y nms-*\nsudo systemctl stop clickhouse-server\nsudo apt-get remove -y clickhouse-server\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Deployment Image Pull Policy (Text)\nDESCRIPTION: This snippet shows how to set the `imagePullPolicy` to `Never` in a Kubernetes deployment. This is useful for locally built images to prevent Kubernetes from attempting to pull the image from a remote registry. It is part of the deployment YAML configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-containerized-instances.md#_snippet_6\n\nLANGUAGE: Text\nCODE:\n```\nspec:\n  containers:\n  - image: yourusername/yourimagename:latest\n    imagePullPolicy: Never\n    name: yourimagename\n    resources: {}\n    terminationMessagePath: /dev/termination-log\n    terminationMessagePolicy: File\n```\n\n----------------------------------------\n\nTITLE: Kubernetes HTTPRoute Accepted Status\nDESCRIPTION: An example status output of a valid HTTPRoute resource showing that the route has been accepted by NGINX Gateway Fabric. The `Status` field under `Conditions` is set to `True`, and the `Message` field indicates that the route is accepted.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/resource-validation.md#_snippet_6\n\nLANGUAGE: text\nCODE:\n```\nStatus:\n  Parents:\n    Conditions:\n      Last Transition Time:  2023-03-30T23:18:00Z\n      Message:               The route is accepted\n      Observed Generation:   2\n      Reason:                Accepted\n      Status:                True\n      Type:                  Accepted\n    Controller Name:         gateway.nginx.org/nginx-gateway-controller\n    Parent Ref:\n      Group:         gateway.networking.k8s.io\n      Kind:          Gateway\n      Name:          gateway\n      Namespace:     default\n      Section Name:  http\n```\n\n----------------------------------------\n\nTITLE: Download NGINX signing key (secure)\nDESCRIPTION: This command securely downloads the NGINX signing key from the NGINX Management Suite host and adds it to the system's keyring. This is used to resolve \"Public Key Not Available\" errors during package updates on Debian-based systems, ensuring the authenticity of NGINX packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/troubleshooting.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://<NMS_FQDN>/packages-repository/nginx-signing.key | gpg --dearmor | sudo tee /usr/share/keyrings/nginx-signing.gpg >/dev/null\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Agent using apt on Ubuntu\nDESCRIPTION: These commands update the apt package list and install the Nginx Agent package on Ubuntu systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update\nsudo apt install nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Gateway Update Failure Message\nDESCRIPTION: This code snippet shows the error message encountered when attempting to update a gateway associated with a Published API that has multiple gateways and Authentication enabled. It indicates a failure during the configuration testing phase.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.3.md#_snippet_4\n\nLANGUAGE: none\nCODE:\n```\nFailed testing config before applying\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Open Source on Debian\nDESCRIPTION: This command installs the Nginx Open Source package from the configured apt-get repositories. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get install nginx\n```\n\n----------------------------------------\n\nTITLE: JSON Profile for Registration Form in Nginx\nDESCRIPTION: This JSON snippet defines a policy with a JSON profile (`reg_form_prof`) that limits the size and nesting depth of a JSON registration form submitted to the `/register` URL.  The `maximumTotalLengthOfJSONData` is set to 1000, and `maximumStructureDepth` is set to 2. The profile is associated with the `/register` URL for POST requests, and enforces that the request body is well-formed JSON.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/handling-xml-and-json-content.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"json_form_policy\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"json-profiles\": [\n            {\n                \"name\": \"reg_form_prof\",\n                \"defenseAttributes\": {\n                    \"maximumArrayLength\": \"any\",\n                    \"maximumStructureDepth\": 2,\n                    \"maximumTotalLengthOfJSONData\": 1000,\n                    \"maximumValueLength\": \"any\",\n                    \"tolerateJSONParsingWarnings\": false\n                }\n            }\n        ],\n        \"urls\": [\n            {\n                \"name\": \"/register\",\n                \"method\": \"POST\",\n                \"type\": \"explicit\",\n                \"attackSignaturesCheck\": true,\n                \"clickjackingProtection\": false,\n                \"disallowFileUploadOfExecutables\": false,\n                \"isAllowed\": true,\n                \"mandatoryBody\": false,\n                \"methodsOverrideOnUrlCheck\": false,\n                \"urlContentProfiles\": [\n                    {\n                        \"headerName\": \"*\",\n                        \"headerValue\": \"*\",\n                        \"headerOrder\": \"default\",\n                        \"type\": \"json\",\n                        \"contentProfile\": {\n                            \"name\": \"reg_form_prof\"\n                        }\n                    }\n                ]\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Example JSON Response without Dimensions\nDESCRIPTION: This JSON response shows the format of metric data when no dimensions are specified in the query (using dimensions=). It includes the aggregation type (aggr), metric name (name), and a single series of data points containing aggregated values. The `dimensions` field is an empty object.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_22\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"metrics\":[\n      {\n         \"aggr\": \"SUM\",\n         \"name\":\"http.request.count\",\n         \"series\":[\n            {\n               \"dimensions\":{},\n               \"timestamps\":[\n                  \"2020-07-01T12:00:00Z\",\n                  \"2020-07-01T12:00:30Z\",\n                  \"2020-07-01T12:01:00Z\",\n                  \"2020-07-01T12:01:30Z\",\n                  ...\n               ],\n               \"values\":[\n                  3000,\n                  2500,\n                  2800,\n                  1900,\n                  ...\n               ]\n            }\n         ]\n      }\n   ],\n   \"queryMetadata\":{\n      \"endTime\":\"2020-07-01T15:00:00Z\"\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Enforcing High Accuracy and Reporting SQL Injection Signatures - JSON\nDESCRIPTION: This snippet configures only the 'High Accuracy Signatures' set to be enforced (blocked and alarmed) while also enabling alarm logging for 'SQL Injection Signatures'. This allows for blocking high accuracy attacks and detecting SQL injection attempts without blocking.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/signature-sets.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"attack_sigs\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"signature-sets\": [\n            {\n                \"name\": \"High Accuracy Signatures\",\n                \"block\": true,\n                \"alarm\": true\n            },\n            {\n                \"name\": \"SQL Injection Signatures\",\n                \"block\": false,\n                \"alarm\": true\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream Group with Shared Memory Zone - Nginx\nDESCRIPTION: This configuration snippet defines an upstream group named 'tomcat' with a shared memory zone. The zone directive enables sharing of the group's configuration and run-time state across worker processes. It is required for dynamic reconfiguration and other advanced features like health checks and live activity monitoring. The snippet also includes server definitions for the upstream.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_40\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream tomcat {\n    zone tomcat 64k;\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Getting Security Policy Bundle and Decode Content - Bash\nDESCRIPTION: This snippet retrieves a specific security policy bundle and decodes its content using `jq` and `base64`. It pipes the output of the `curl` command to `jq` to extract the `content` field, then pipes the extracted content to `base64 -d` to decode the base64 encoded content and save it as `security-policy-bundle.tgz`.  Requires `jq` and `base64` utilities.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X GET \"https://{{NIM_FQDN}}/api/platform/v1/security/policies/<policy-uid>/bundles/<bundle-uid>\" \\\n    -H \"Authorization: Bearer <access token>\" | jq -r '.content' | base64 -d > security-policy-bundle.tgz\n```\n\n----------------------------------------\n\nTITLE: Disallowing HTTP Methods - JSON\nDESCRIPTION: This example demonstrates how to disallow specific HTTP methods in an NGINX App Protect policy. It configures the `VIOL_METHOD` violation to block illegal methods and removes the `PUT` method from the allowed methods, illustrating how to customize the allowed set of HTTP methods.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/filetypes-and-responses.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"blocking_policy\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_METHOD\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"methods\": [\n            {\n                \"name\": \"GET\"\n            },\n            {\n                \"name\": \"POST\"\n            },\n            {\n                \"name\": \"HEAD\"\n            },\n            {\n                \"name\": \"PUT\",\n                \"$action\": \"delete\"\n            },\n            {\n                \"name\": \"PATCH\"\n            },\n            {\n                \"name\": \"DELETE\"\n            },\n            {\n                \"name\": \"OPTIONS\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: UDP Component IPv6 Configuration\nDESCRIPTION: This snippet configures a UDP component to listen on a specific IPv6 address. It uses the uriSnippets block to add a listen directive, including the `udp` parameter and the `reuseport` option to prevent bind errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-snippets.md#_snippet_10\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"metadata\": {\n    \"name\": \"<component-name>\"\n  },\n  \"desiredState\": {\n    \"configSnippets\": {\n      \"uriSnippets\": [\n        {\n          \"directives\": [\n            {\n              \"directive\": \"listen\",\n              \"args\": [\n                \"[<IPv6-Address>]:9053\",\n                \"udp\",\n                \"reuseport\"\n              ]\n            }\n          ]\n        }\n      ]\n    },\n    \"backend\": {\n      \"workloadGroups\": {\n        \"wg\": {\n          \"uris\": {\n            \"udp://<workload-host>:9053\": {}\n          }\n        }\n      }\n    },\n    \"componentType\": \"TCPUDP\",\n    \"ingress\": {\n      \"gatewayRefs\": [\n        {\n          \"ref\": \"/services/environments/<env-name>/gateways/<gateway-name>\"\n        }\n      ],\n      \"uris\": {\n        \"udp://*:9053\": {}\n      }\n    }\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Override Signature Detection in URL - JSON\nDESCRIPTION: This example shows how to disable and enable specific signatures (200010093 and 200010008, respectively) for a user-defined URL.  These signature settings only apply to requests targeting the specified URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/parameters-and-user-defined-urls.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"/Common/user_defined_URL\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_URL\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"urls\": [\n            {\n                \"method\": \"*\",\n                \"name\": \"/test*\",\n                \"protocol\": \"http\",\n                \"type\": \"wildcard\",\n                \"wildcardOrder\": 1,\n                \"attackSignaturesCheck\": true,\n                \"signatureOverrides\": [\n                    {\n                        \"enabled\": true,\n                        \"signatureId\": 200010008\n                    },\n                    {\n                        \"enabled\": false,\n                        \"signatureId\": 200010093\n                    }\n                ]\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Service Mesh CLI Usage\nDESCRIPTION: Shows the general usage and available commands for the `nginx-meshctl` command-line tool. It details how to connect to a Kubernetes cluster and interact with the NGINX Service Mesh control plane.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_0\n\nLANGUAGE: txt\nCODE:\n```\nUsage:\n  nginx-meshctl [flags]\n  nginx-meshctl [command]\n\nAvailable Commands:\n  completion  Generate the autocompletion script for the specified shell\n  config      Display the NGINX Service Mesh configuration\n  deploy      Deploys NGINX Service Mesh into your Kubernetes cluster\n  help        Help for nginx-meshctl or any command\n  inject      Inject the NGINX Service Mesh sidecars into Kubernetes resources\n  remove      Remove NGINX Service Mesh from your Kubernetes cluster\n  services    List the Services registered with NGINX Service Mesh\n  status      Check connection to NGINX Service Mesh API\n  supportpkg  Create an NGINX Service Mesh support package\n  top         Display traffic statistics\n  upgrade     Upgrade NGINX Service Mesh\n  version     Display NGINX Service Mesh version\n\nFlags:\n  -h, --help                help for nginx-meshctl\n  -k, --kubeconfig string   path to kubectl config file (default \"/Users/<user>/.kube/config\")\n  -n, --namespace string    NGINX Service Mesh control plane namespace (default \"nginx-mesh\")\n  -t, --timeout duration    timeout when communicating with NGINX Service Mesh (default 5s)\n```\n\n----------------------------------------\n\nTITLE: Apply Coffee HTTPRoute with Rate Limiting - Kubernetes YAML\nDESCRIPTION: This snippet applies a Kubernetes HTTPRoute configuration for the coffee application. It references a SnippetsFilter named 'rate-limiting-sf' to enforce rate limiting. The route matches requests with the '/coffee' path prefix and forwards them to the coffee backend service on port 80.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_10\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: coffee\nspec:\n  parentRefs:\n    - name: gateway\n      sectionName: http\n  hostnames:\n    - \"cafe.example.com\"\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /coffee\n      filters:\n        - type: ExtensionRef\n          extensionRef:\n            group: gateway.nginx.org\n            kind: SnippetsFilter\n            name: rate-limiting-sf\n      backendRefs:\n        - name: coffee\n          port: 80\nEOF\n```\n\n----------------------------------------\n\nTITLE: Test Nginx Configuration\nDESCRIPTION: This command tests the NGINX configuration file for syntax errors before reloading the configuration. It requires Nginx to be installed and the user to have appropriate permissions to access the configuration file. The expected output indicates whether the configuration is valid.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/uninstall.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Mounting SPIRE Agent Socket in OpenShift\nDESCRIPTION: This YAML snippet defines a volume that mounts the SPIRE agent socket in OpenShift by using a CSI driver.  The driver name is 'csi.spiffe.io', and it is mounted as read-only. The volume is subsequently mounted into the Ingress Controller's container spec, allowing the container to access the socket. This approach is required in OpenShift due to security restrictions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_17\n\nLANGUAGE: YAML\nCODE:\n```\nvolumes:\n- csi:\n  driver: csi.spiffe.io\n  readOnly: true\n  name: spire-agent-socket\n```\n\nLANGUAGE: YAML\nCODE:\n```\nvolumeMounts:\n- mountPath: /run/spire/sockets\n  name: spire-agent-socket\n```\n\n----------------------------------------\n\nTITLE: TrafficSplit Example Configuration\nDESCRIPTION: This example shows an invalid TrafficSplit configuration with duplicate targetPorts in a Service. NGINX Service Mesh disregards duplicate targetPorts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.4.0.md#_snippet_0\n\nLANGUAGE: plaintext\nCODE:\n```\napiVersion: v1\nkind: Service\nspec:\n  ports:\n  - port: 8080\n    protocol: TCP\n    targetPort: 55555\n  - port: 9090\n    protocol: TCP\n    targetPort: 55555\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX App Protect WAF v5 Repository (Debian)\nDESCRIPTION: This shell command adds the NGINX App Protect WAF v5 repository to the system's apt sources. It uses `printf` to generate the repository entry for NGINX App Protect, then pipes it to `sudo tee` to write to `/etc/apt/sources.list.d/nginx-app-protect.list`. It requires `lsb_release` and `sudo` to be available.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-debian.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\nhttps://pkgs.nginx.com/app-protect-x-plus/debian `lsb_release -cs` nginx-plus\\n\" | \\\nsudo tee /etc/apt/sources.list.d/nginx-app-protect.list\n```\n\n----------------------------------------\n\nTITLE: nginx_plus_ha.rb Role File (Ruby)\nDESCRIPTION: This snippet defines the `nginx_plus_ha.rb` role file, which sets attributes used in the recipe and template files.  It configures the `ha_keepalived_key`, `ha_vip`, and `enable_ha_mode` attributes. It also includes the `nginx_plus` role. The `ha_primary` attribute is configured on a per-host basis.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_2\n\nLANGUAGE: ruby\nCODE:\n```\nname \"nginx_plus_ha\"\ndescription \"An example role to install NGINX Plus in an HA cluster\"\nrun_list \"role[nginx_plus]\"\ndefault_attributes \"nginx\" => { \"enable_ha_mode\" => \"true\",\n                                      \"ha_keepalived_key\" => \"a0cf476cf069ea3dfa8940ff6d6bd885\",\n                                      \"ha_vip\" => \"10.100.10.50\"\n                                    }\n```\n\n----------------------------------------\n\nTITLE: Check MySQL User Permissions\nDESCRIPTION: This snippet connects to the MySQL database as the newly created 'amplify-agent' user and executes the 'show global status' command. This verifies that the user has the necessary permissions to read MySQL metrics. The output displays various global status variables and their corresponding values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/other-metrics.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\n$ mysql -u amplify-agent -p\n..\nmysql> show global status;\n+-----------------------------------------------+--------------------------------------------------+\n| Variable_name                                 | Value                                            |\n+-----------------------------------------------+--------------------------------------------------+\n| Aborted_clients                               | 0                                                |\n..\n| Uptime_since_flush_status                     | 1993                                             |\n+-----------------------------------------------+--------------------------------------------------+\n353 rows in set (0.01 sec)\n```\n\n----------------------------------------\n\nTITLE: Configuring Shared Memory Zone - NGINX\nDESCRIPTION: Configures a shared memory zone called `dns_zone` with a size of 64k for the upstream group. This shared memory zone enables NGINX Plus worker processes to share state information about counters and connections, essential for active health checks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    upstream dns_upstream {\n        zone   dns_zone 64k;\n        server 192.168.136.130:53;\n        server 192.168.136.131:53;\n        server 192.168.136.132:53;\n    }\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Set Keycloak Admin Credentials\nDESCRIPTION: This shell script sets environment variables for the Keycloak admin username and password. These environment variables are used when starting Keycloak in development mode.  It's crucial to replace the placeholder values with strong, unique credentials before using this in any environment. It's intended for temporary/development environment only.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_4\n\nLANGUAGE: Shell\nCODE:\n```\nexport KEYCLOAK_ADMIN=<admin user>\nexport KEYCLOAK_ADMIN_PASSWORD=<password>\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx configuration\nDESCRIPTION: This command reloads the Nginx configuration after changes have been made. This is required for the changes to take effect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/getting-started.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Plus (Amazon Linux 2)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Plus package from Amazon Linux 2. It uses the `yum remove` command to remove the `app-protect-module-plus` package. Requires root privileges and the yum package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_51\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum remove app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Verify bd_agent process - Debian and Ubuntu\nDESCRIPTION: This command verifies that the bd_agent process is running. `ps -ef | grep bd_agent` lists all running processes and filters the output to show only those containing `bd_agent`, confirming that the process is active when using Controller ADC Agent 3.20.1 or Controller APIM Agent 3.19.2.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_28\n\nLANGUAGE: shell\nCODE:\n```\nps -ef | grep bd_agent\n```\n\n----------------------------------------\n\nTITLE: Docker Check ClickHouse container\nDESCRIPTION: This command uses `docker ps` to list running Docker containers and filters for `clickhouse`. It checks if the `Clickhouse` container is still running on a node where the `kubelet` process is stopped, indicating a potential cause of the \"Cannot lock file\" error. `k8s_clickhouse` indicates it's a Kubernetes-managed container.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\nsudo docker ps | grep clickhouse\n71f665be4c35        1f973676953e           \"./setup.sh\"             2 hours ago         Up 2 hours                              k8s_clickhouse_clickhouse-0_nginx-controller_5521450f-b286-4be8-951b-408164184883_19\nc888050cc198        k8s.gcr.io/pause:3.1   \"/pause\"                 2 hours ago         Up 2 hours                              k8s_POD_clickhouse-0_nginx-controller_5521450f-b286-4be8-951b-408164184883_0\n```\n\n----------------------------------------\n\nTITLE: Create Certificate Signing Request\nDESCRIPTION: Generates a Certificate Signing Request (CSR) using the private key. The CSR is then submitted to a Certificate Authority (CA) to obtain a signed certificate. Requires the openssl command-line tool.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl req -new -sha256 -key ~/example.com.key -out ~/example.com.csr\n```\n\n----------------------------------------\n\nTITLE: Download usage acknowledgment - F5 REST API (curl)\nDESCRIPTION: This `curl` command downloads the usage acknowledgment from F5. It requires the report ID and JWT for authorization. The output is saved as a zip file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\ncurl --location 'https://product.apis.f5.com/ee/v1/entitlements/telemetry/bulk/download/<report-id>' \\\n--header \"Authorization: Bearer $(cat /path/to/jwt-file)\" \\\n--output <path-to-acknowledgement>.zip\n```\n\n----------------------------------------\n\nTITLE: Filter Events by Start and End Time (curl)\nDESCRIPTION: This example demonstrates filtering events within a specific time range using both `startTime` and `endTime` query parameters. Replace `<NMS_FQDN>` and `<access token>` accordingly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"https://<NMS_FQDN>/api/platform/v1/analytics/events?startTime=2022-03-19T08:00:00Z&endTime=2022-03-19T12:00:00Z\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Creating a Mail Context in Nginx\nDESCRIPTION: This configuration snippet demonstrates how to define a top-level `mail` context in the Nginx configuration file. This context is used to configure the mail proxy server settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nmail {\n        #...\n    }\n```\n\n----------------------------------------\n\nTITLE: Enable Ingress and Egress Labels in NGINX Ingress Controller Pod Spec (Bash)\nDESCRIPTION: This code snippet demonstrates how to add labels to the NGINX Ingress Controller Pod spec to enable ingress and egress traffic when using a plaintext configuration. These labels are crucial for the NGINX Service Mesh to recognize and configure the Ingress Controller for specific traffic directions. It requires NGINX Service Mesh deployed with `mtls-mode` set to `off`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nnsm.nginx.com/enable-ingress: \"true\"\nnsm.nginx.com/enable-egress: \"true\"\n```\n\n----------------------------------------\n\nTITLE: Loading App Protect WAF Module\nDESCRIPTION: This command loads the Nginx App Protect WAF module within the main context of the nginx.conf file. This enables the WAF functionality. Requires access to the nginx.conf file and the module library.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n```\n\n----------------------------------------\n\nTITLE: String Field with Constraints JSON Schema Example\nDESCRIPTION: This JSON schema snippet defines a string field named 'test' with regular expression pattern matching, minimum length, maximum length, and examples. This is used to validate user-provided string inputs based on predefined rules.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/reference/json-schema-reference.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"test\": {\n      \"type\": \"string\",\n      \"pattern\": \"^[A-Za-z0-9\\\\s]*$\",\n      \"minLength\": 1,\n      \"maxLength\": 140,\n      \"examples\": [\"value 1\", \"value 2\"]\n    }\n  }\n```\n\n----------------------------------------\n\nTITLE: Rolling Restart Kubernetes Resource\nDESCRIPTION: This command performs a rolling restart of a specified Kubernetes resource. It's used after an upgrade to apply configuration changes to applications that support rolling updates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nkubectl rollout restart <resource type>/<resource name>\n```\n\n----------------------------------------\n\nTITLE: Define HTTPRouteGroup for Firefox Users\nDESCRIPTION: This YAML snippet defines an HTTPRouteGroup named `target-hrg` that matches traffic with the `user-agent` header containing 'Firefox'. This HTTPRouteGroup is used to direct traffic to specific backends based on the user agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_17\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi-spec.io/v1alpha3\nkind: HTTPRouteGroup\nmetadata:\n  name: target-hrg\n  namespace: default\nspec:\n  matches:\n  - name: firefox-users\n    headers:\n      user-agent: \".*Firefox.*\"\n```\n\n----------------------------------------\n\nTITLE: Moving nginx-meshctl executable to PATH on Linux\nDESCRIPTION: This command moves the extracted nginx-meshctl executable to the /usr/local/bin directory, which is typically included in the system's PATH. This makes the command accessible from any directory in the terminal.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo mv nginx-meshctl /usr/local/bin/nginx-meshctl\n```\n\n----------------------------------------\n\nTITLE: Slab Zone Pages Total Metric\nDESCRIPTION: Describes the 'plus.slab.pages.total' metric, which is a gauge representing the sum of free and used memory pages in the slab zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_35\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, integer\nDescription: Sum of free and used memory pages above.\n```\n\n----------------------------------------\n\nTITLE: Gateway Instance Reference Error\nDESCRIPTION: This code snippet shows the error message received when trying to configure a gateway by specifying an instance directly that is already assigned to an instance group. The server returns an HTTP 400 Bad Request status code.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.3.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nError upserting gateway:\n  Object contains invalid instance reference:\n    instances cannot be directly referenced if already registered with an instance group:\n    'locations/east-loc/instances/east1' is in instance group 'east-ig'\n```\n\n----------------------------------------\n\nTITLE: App Protect Connection Failure Log Event JSON\nDESCRIPTION: This JSON object represents a failed attempt of a worker to connect to the F5 NGINX App Protect WAF. The 'mode' attribute indicates the failure status. The log level is Error.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/operation-logs.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"event\": \"waf_connection_failure\",\n    \"bd_thread_id\": 3,\n    \"worker_pid\": 4928,\n    \"mode\": \"failure\",\n    \"mode_changed\": true\n}\n```\n\n----------------------------------------\n\nTITLE: Install Gateway API Resources (Standard Channel) - Shell\nDESCRIPTION: This command uses kubectl and kustomize to install the standard Gateway API resources required for NGINX Gateway Fabric. It fetches the resource definitions from the specified GitHub repository using the provided version tag and applies them to the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/install-gateway-api-resources.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl kustomize \"https://github.com/nginx/nginx-gateway-fabric/config/crd/gateway-api/standard?ref=v{{< version-ngf >}}\" | kubectl apply -f -\n```\n\n----------------------------------------\n\nTITLE: Restart PostgreSQL\nDESCRIPTION: Restarts the PostgreSQL service using `systemctl`. This is required after modifying the `pg_hba.conf` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart postgresql\n```\n\n----------------------------------------\n\nTITLE: Update SMTP Settings with helper.sh (Bash)\nDESCRIPTION: This command updates the SMTP settings for NGINX Controller using the `helper.sh` script. It sets the SMTP address, port, TLS setting, sender address, and optionally authentication details. Requires address, port, tls and from arguments. Auth, username and password are optional.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh configsmtp <address> <port> <tls> <from> [auth] [username] [password]\n```\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh configsmtp 192.0.2.0 25 false noreply@example.com true user1 <password>\n```\n\n----------------------------------------\n\nTITLE: Installing Encrypted Session module on Alpine\nDESCRIPTION: This shell script installs the `nginx-plus-module-encrypted-session` package using apk.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/encrypted-session.md#_snippet_4\n\nLANGUAGE: Shell\nCODE:\n```\napk add nginx-plus-module-encrypted-session\n```\n\n----------------------------------------\n\nTITLE: Configure ModSecurity Main Configuration\nDESCRIPTION: This ModSecurity configuration file includes the recommended configuration and defines a test rule. The rule blocks requests and returns a 403 status code if the query string parameter 'testparam' contains the string 'test'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\n# Include the recommended configuration\nInclude /etc/nginx/modsec/modsecurity.conf\n# A test rule\nSecRule ARGS:testparam \"@contains test\" \"id:1234,deny,log,status:403\"\n```\n\n----------------------------------------\n\nTITLE: Stream Upstream Bytes Transfered\nDESCRIPTION: Describes the 'plus.stream.upstream.bytes_sent' and 'plus.stream.upstream.bytes_rcvd' metrics. These track the number of bytes received from upstream servers, and bytes sent to them.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_29\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Number of bytes received from upstream servers, and bytes sent.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Stopping the Controller Agent Service - CentOS/RHEL\nDESCRIPTION: This command stops the NGINX Controller Agent service on CentOS or Red Hat Enterprise Linux systems. This step is necessary before uninstalling the agent or deleting the associated NGINX instance from NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-instances.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsystemctl stop controller-agent\n```\n\n----------------------------------------\n\nTITLE: Start NGINX Agent using systemctl (RHEL, CentOS, Ubuntu, Debian)\nDESCRIPTION: Starts the NGINX Agent service using systemctl. This command is applicable to RHEL, CentOS, Rocky Linux, AlmaLinux, Oracle Linux, Ubuntu, Debian, SLES, and Amazon Linux operating systems. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-unprivileged.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Configuring Access Log Format and Location (Nginx)\nDESCRIPTION: This snippet configures the access log format and location within the 'http' block. It defines a custom log format named 'main' which includes the `$upstream_addr` variable for capturing the address of the CAS. It also sets the location of the access log file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_29\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nlog_format main '$remote_addr - $remote_user [$time_local] '\n                '\"$request\" $status $body_bytes_sent '\n                '\"$http_user_agent\" \"$upstream_addr\"';\naccess_log /var/log/nginx/access.log main;\n```\n\n----------------------------------------\n\nTITLE: Creating Certificate Signing Request OpenSSL\nDESCRIPTION: This snippet creates a Certificate Signing Request (CSR) file using OpenSSL. The CSR is then sent to a Certificate Authority (CA) to obtain a signed certificate. The `-new` option starts the CSR creation process. The `-sha256` option sets the hash algorithm to SHA256. The `-key` option specifies the private key to use.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl req -new -sha256 -key ~/company.com.key -out ~/company.com.csr\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Instance Manager Repository (Ubuntu)\nDESCRIPTION: Adds the NGINX Instance Manager repository to the Ubuntu system's APT sources and downloads a configuration file. The first command uses printf and tee to add a new repository entry to /etc/apt/sources.list.d/nms.list. The second command downloads a configuration file using wget and saves it to /etc/apt/apt.conf.d/90pkgs-nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/installation/add-nms-repo.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/nms/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nms.list\nsudo wget -q -O /etc/apt/apt.conf.d/90pkgs-nginx https://cs.nginx.com/static/files/90pkgs-nginx\n```\n\n----------------------------------------\n\nTITLE: Check Kubelet Logs - Bash\nDESCRIPTION: This command checks the kubelet logs using `journalctl` to determine the kubelet certificate expiry date/time.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo journalctl -xeu kubelet\n```\n\n----------------------------------------\n\nTITLE: Get Grafana Admin Password\nDESCRIPTION: This command retrieves the Grafana admin password from a Kubernetes secret in the monitoring namespace. It uses `kubectl` and `base64` to decode the password.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/prometheus.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get secret -n monitoring grafana -o jsonpath=\"{.data.admin-password}\" | base64 --decode ; echo\n```\n\n----------------------------------------\n\nTITLE: Example ModSecurity Log Entry\nDESCRIPTION: This is an example of a log entry generated by ModSecurity when a request is blocked. It includes information such as the timestamp, client IP, rule ID, matched operator, and other relevant details about the blocked request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_20\n\nLANGUAGE: none\nCODE:\n```\n2020/05/06 09:00:48 [warn] 1504#1504: *5 [client 127.0.0.1] ModSecurity: Access denied with code 403 (phase 1). Matched \"Operator `Contains' with parameter `test' against variable `ARGS:testparam' (Value: `thisisatestofmodsecurity' ) [file \"/etc/nginx/modsec/main.conf\"] [line \"207\"] [id \"1234\"] [rev \"\"] [msg \"\"] [data \"\"] [severity \"0\"] [ver \"\"] [maturity \"0\"] [accuracy \"0\"] [hostname \"127.0.0.1\"] [uri \"/foo\"] [unique_id \"14931972481.000000\"] [ref \"o7,4v19,24\"], client: 127.0.0.1, server: , request: \"GET /foo?testparam=thisisatestofmodsecurity HTTP/1.1\", host: \"localhost\"\n```\n\n----------------------------------------\n\nTITLE: Kubernetes VirtualServer Resource (YAML)\nDESCRIPTION: This YAML configuration defines a VirtualServer resource that creates an internal route to the `target-v1-0` service in the `legacy` namespace. The `internalRoute: true` field indicates that this is an internal route.  The `host` field specifies the hostname. The `ingressClassName` must be set to `nginx` for NGINX Ingress Controller to manage the VirtualServer.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_12\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: k8s.nginx.org/v1\nkind: VirtualServer\nmetadata:\n   name: target-vs-internal-route\n   namespace: legacy\nspec:\n   internalRoute: true\n   ingressClassName: nginx\n   host: target-v1-0.legacy\n   upstreams:\n      - name: legacy\n        tls:\n           enable: false\n        service: target-v1-0\n        port: 80\n   routes:\n      - path: /\n        action:\n           pass: legacy\n```\n\n----------------------------------------\n\nTITLE: Update HTTPRoute with ResponseHeaderModifier - YAML\nDESCRIPTION: This YAML configuration updates an HTTPRoute to modify response headers using the ResponseHeaderModifier filter. It sets the value of 'X-Header-Set', adds a value to 'X-Header-Add', and removes the 'X-Header-Remove' header for requests matching the '/headers' path prefix.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_11\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: headers\nspec:\n  parentRefs:\n  - name: gateway\n    sectionName: http\n  hostnames:\n  - \"cafe.example.com\"\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /headers\n    filters:\n    - type: ResponseHeaderModifier\n      responseHeaderModifier:\n        set:\n        - name: X-Header-Set\n          value: overwritten-value\n        add:\n        - name: X-Header-Add\n          value: this-is-the-appended-value\n        remove:\n        - X-Header-Remove\n    backendRefs:\n    - name: headers\n      port: 80\n```\n\n----------------------------------------\n\nTITLE: Viewing Instance Group Config: Example JSON Response (GET)\nDESCRIPTION: This JSON response is returned when querying the configuration of an instance group, including its version history and any external ID (commit hash) associated with the configuration.  The instance group configuration includes details about the NGINX build and version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/publish-configs.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"build\": {\n    \"nginxPlus\": true,\n    \"release\": \"nginx-plus-r28\",\n    \"version\": \"1.23.2\"\n  },\n  \"configPath\": \"/etc/nginx/nginx.conf\",\n  \"configVersion\": {\n    \"instanceGroup\": {\n      \"createTime\": \"0001-01-01T00:00:00Z\",\n      \"uid\": \"\",\n      \"versionHash\": \"\"\n    },\n    \"versions\": [\n      {\n        \"createTime\": \"2023-02-28T19:54:58.735Z\",\n        \"externalId\": \"8acf5aed9d2872b266d2f880cab23a4aa5791d1b\",\n        \"externalIdType\": \"git\",\n        \"uid\": \"92a9dbfa-dc6a-5bf9-87dd-19405db0b9c0\",\n        \"versionHash\": \"c0f7abbd9b9060c75985b943f3ec0cfc7e4b28cbf50c26bfd0b2141bb6c277a3\"\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Base64 Encoding Function - Bash\nDESCRIPTION: This function encodes a username and password combination to base64 format.  It's used for basic authentication with the NGINX Instance Manager API. The input is the username and password as separate arguments.  The output is the base64 encoded string.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nencode_base64() {\n  echo -n \"$1:$2\" | base64\n}\n```\n\n----------------------------------------\n\nTITLE: Ignoring NATS Streaming Timeout Errors During NGINX Controller Upgrade\nDESCRIPTION: This snippet shows the error message that may appear when upgrading the third node of an NGINX Controller cluster, related to timeout issues with scaling up services. It indicates that these warnings can be safely ignored, as the services will continue to scale up in the background and shouldn't impede the upgrade process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\nWhile waiting for nats-streaming-cluster to scale up, the operation did not complete before timing out.\n```\n\n----------------------------------------\n\nTITLE: Import Nginx signing key on Ubuntu\nDESCRIPTION: This command downloads the Nginx signing key and adds it to the system's keyring, allowing apt to verify the authenticity of Nginx packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://nginx.org/keys/nginx_signing.key | gpg --dearmor \\\n        | sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null\n```\n\n----------------------------------------\n\nTITLE: Add NGINX App Protect WAF repository - Ubuntu\nDESCRIPTION: This command adds the NGINX App Protect WAF repository to the Ubuntu system's apt sources. It uses `printf` to generate the repository entry string, which includes the distribution codename obtained using `lsb_release -cs`, and then pipes it to `sudo tee` to write it to the `/etc/apt/sources.list.d/nginx-app-protect.list` file.  This allows the system to find and install the NGINX App Protect WAF packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_35\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb https://pkgs.nginx.com/app-protect/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-app-protect.list\n```\n\n----------------------------------------\n\nTITLE: Fixing APP_PROTECT configuration error on Ubuntu\nDESCRIPTION: This snippet provides commands to resolve an error encountered during NGINX App Protect WAF installation on Ubuntu 24.04 related to missing config files. It removes the config directory, recreates it, and restarts the Nginx service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/releases/about-5.4.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo rm /opt/app_protect/config\nsudo mkdir /opt/app_protect/config\nsudo service nginx restart\n```\n\n----------------------------------------\n\nTITLE: Example Nginx configuration\nDESCRIPTION: Example of Nginx configuration showing the placement of `working_directory` and `worker_rlimit_core` directives within the main context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_24\n\nLANGUAGE: nginx\nCODE:\n```\nworker_processes   auto;\nerror_log          /var/log/nginx/error.log debug;\nworking_directory  /tmp/cores/;\nworker_rlimit_core 500M;\n\nevents {\n    ...\n}\n\nhttp {\n    ...\n}\n```\n\n----------------------------------------\n\nTITLE: Run Cleanup Script\nDESCRIPTION: This snippet executes the `cleanup.sh` script after making it executable. This script removes the infrastructure created by Terraform. This allows for easy removal of all AWS resources that were automatically created.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-network-load-balancer.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nchmod +x cleanup.sh\n./cleanup.sh\n```\n\n----------------------------------------\n\nTITLE: Configuring Liveness Probe in NGINX\nDESCRIPTION: This snippet demonstrates how to configure the liveness probe using the `app_protect_dos_liveness` directive. This directive enables or disables the liveness probe feature and allows specifying the URI and port for the probe.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_dos_liveness on uri:/liveness port:8090;\n```\n\n----------------------------------------\n\nTITLE: Full NGINX Deployment Configuration with Read-Only Root Filesystem (YAML)\nDESCRIPTION: This YAML configuration provides a complete example of deploying NGINX with App Protect in Kubernetes, including a read-only root filesystem, volume mounts for writable directories, and security context settings. It defines the deployment, containers, volumes, and image pull secrets necessary for running NGINX with enhanced security.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/nap-k8s-readonly-context.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nap5-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nap5\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: nap5\n    spec:\n      imagePullSecrets:\n        - name: regcred\n      containers:\n        - name: nginx\n          image: <your-private-registry>/nginx-app-protect-5:<your-tag>\n          imagePullPolicy: IfNotPresent\n          securityContext:\n            readOnlyRootFilesystem: true\n          volumeMounts:\n            - name: app-protect-bd-config\n              mountPath: /opt/app_protect/bd_config\n            - name: app-protect-config\n              mountPath: /opt/app_protect/config\n            - name: tmp-volume\n              mountPath: /tmp\n            - name: nginx-log\n              mountPath: /var/log/nginx\n            - name: app-protect-bundles\n              mountPath: /etc/app_protect/bundles\n        - name: waf-enforcer\n          image: private-registry.nginx.com/nap/waf-enforcer:<version-tag>\n          imagePullPolicy: IfNotPresent\n          securityContext:\n            readOnlyRootFilesystem: true\n          env:\n            - name: ENFORCER_PORT\n              value: \"50000\"\n          volumeMounts:\n            - name: app-protect-bd-config\n              mountPath: /opt/app_protect/bd_config\n        - name: waf-config-mgr\n          image: private-registry.nginx.com/nap/waf-config-mgr:<version-tag>\n          imagePullPolicy: IfNotPresent\n          securityContext:\n            allowPrivilegeEscalation: false\n            readOnlyRootFilesystem: true\n            capabilities:\n              drop:\n                - all\n          volumeMounts:\n            - name: app-protect-bd-config\n              mountPath: /opt/app_protect/bd_config\n            - name: app-protect-config\n              mountPath: /opt/app_protect/config\n            - name: app-protect-bundles\n              mountPath: /etc/app_protect/bundles\n      volumes:\n        - name: app-protect-bd-config\n          emptyDir: {}\n        - name: app-protect-config\n          emptyDir: {}\n        - name: nginx-log\n          emptyDir: {}\n        - name: tmp-volume\n          emptyDir: {}\n        - name: app-protect-bundles\n          persistentVolumeClaim:\n            claimName: nap5-bundles-pvc \n```\n\n----------------------------------------\n\nTITLE: NTP Health Check Match Block - NGINX\nDESCRIPTION: Defines a match block called `ntp` for NTP health checks. It specifies a hexadecimal string to send to the NTP server and a regular expression to match against the response. The `send` parameter sends a specific NTP request, and the `expect` parameter checks for a valid NTP response header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nmatch ntp {\n    send \\xe3\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00;\n    expect ~* \\x24;\n}\n```\n\n----------------------------------------\n\nTITLE: Logging into Private Docker Registry\nDESCRIPTION: This command logs in to your private Docker registry, allowing you to push and pull images. Replace `<my-docker-registry>` with the address of your private registry.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-plus-and-agent-docker.md#_snippet_4\n\nLANGUAGE: Shell\nCODE:\n```\ndocker login <my-docker-registry>\n```\n\n----------------------------------------\n\nTITLE: Enabling njs module and importing script in Nginx\nDESCRIPTION: This code snippet demonstrates how to enable the `ngx_http_js_module` module in NGINX and import an njs script using the `js_import` directive.  The `js_content` directive is used within a location block to execute the `http.hello` function defined in the imported script.  The njs module must be loaded and the script imported within the http block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/njs-support.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\n\nhttp {\n    js_import http.js;\n\n    server {\n        location / {\n            js_content http.hello;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Removing API Location Block in NGINX Configuration\nDESCRIPTION: This Nginx configuration block removes the `location /api/` block. NGINXaaS for Azure currently restricts access to the `api` directive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/oidc.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /api/ {\n    api write=on;\n    allow 127.0.0.1; # Only the NGINX host may call the NGINX Plus API\n    deny all;\n    access_log off;\n}\n```\n\n----------------------------------------\n\nTITLE: TrafficSplit Configuration for Target v1.0\nDESCRIPTION: This YAML configuration defines a TrafficSplit resource named `target-ts` that directs 100% of traffic to the `target-v1-0` service. It is configured using SMI's TrafficSplit CRD, specifying the target service and the backends that will receive traffic, along with their respective weights. This configuration is used as a starting point before introducing newer versions of the application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: split.smi-spec.io/v1alpha3\nkind: TrafficSplit\nmetadata:\n  name: target-ts\nspec:\n  service: target-svc\n  backends:\n  - service: target-v1-0\n    weight: 100\n```\n\n----------------------------------------\n\nTITLE: Listing Compiled Modules\nDESCRIPTION: This command lists the `.so` files in the `objs` subdirectory of the Nginx build directory.  It confirms that the module compilation was successful and shows the path to the compiled module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_37\n\nLANGUAGE: shell\nCODE:\n```\nls objs/*.so\n```\n\n----------------------------------------\n\nTITLE: Stop Controller Agent - Ubuntu/Debian\nDESCRIPTION: This snippet stops the NGINX Controller Agent service on Ubuntu/Debian systems using the `service` command. This is a prerequisite for uninstalling the agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-agent.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nservice controller-agent stop\n```\n\n----------------------------------------\n\nTITLE: Uncommenting OIDC Log Format\nDESCRIPTION: This snippet shows the YAML configuration to uncomment in `nms-http.conf` to enable OIDC logging. It defines a custom log format `oidc_jwt` that includes JWT claim information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\n# Enable when using OIDC\n log_format oidc_jwt '$remote_addr - $jwt_claim_sub [$time_local] \"$request\" '\n                     '$status $body_bytes_sent \"$http_referer\" \"$http_user_agent\" '\n                     '\"$http_x_forwarded_for\"';\n```\n\n----------------------------------------\n\nTITLE: Mounting a Local Directory to a Container (Shell)\nDESCRIPTION: This snippet shows how to mount a local directory on the Docker host to a directory in the container. This allows changes to files on the Docker host to be reflected in the container.  The directories are mounted as read-only.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\ndocker run --name mynginx2 \\\n   --mount type=bind,source=/var/www,target=/usr/share/nginx/html,readonly \\\n   --mount type=bind,source=/var/nginx/conf,target=/etc/nginx/conf,readonly \\\n   -p 80:80 \\\n   -d nginxplus\n```\n\n----------------------------------------\n\nTITLE: Update SMTP Settings with Environment Variables (Bash)\nDESCRIPTION: This command updates the SMTP settings for NGINX Controller using environment variables and the `helper.sh` script. It reads the SMTP configuration from environment variables such as `CTR_SMTP_HOST`, `CTR_SMTP_PORT`, `CTR_SMTP_TLS`, `CTR_SMTP_FROM`, `CTR_SMTP_AUTH`, `CTR_SMTP_USER`, and `CTR_SMTP_PASS`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nCTR_SMTP_HOST=192.0.2.0 \\\nCTR_SMTP_PORT=25 \\\nCTR_SMTP_TLS=false \\\nCTR_SMTP_FROM=noreply@nginx.test \\\nCTR_SMTP_AUTH=true CTR_SMTP_USER=user1 CTR_SMTP_PASS=<password> \\\n/opt/nginx-controller/helper.sh configsmtp\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX web server\nDESCRIPTION: This command restarts the NGINX web server using systemctl. This is needed to ensure that the web server picks up any new configurations or changes related to NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Defining ACL Consumer Restriction Policy via API in JSON\nDESCRIPTION: This JSON snippet defines an ACL consumer restriction policy. It allows traffic from the client ID `allowed-user` and denies traffic from `denied-user` using `acl-consumer` policy. `lookupVariable` defines which attribute to look at (e.g. 'client.id', 'token.sub').\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/api-access-control-lists.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policies\": {\n        \"acl-consumer\": [\n            {\n                \"action\": {\n                    \"lookupVariable\": \"client.id\",\n                    \"allow\": [\"allowed-user\"],\n                    \"deny\": [\"denied-user\"]\n                }\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Backing Up Private Key\nDESCRIPTION: This command creates a backup of the private key file in a secure directory.  It is crucial to prevent certificate unusability in case of key loss. Requires filesystem access to copy the key file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nroot# cp ~/private-key.pem secure-dir/private-key.pem.backup\n```\n\n----------------------------------------\n\nTITLE: Applying Request Header Specification Policy via REST API (JSON)\nDESCRIPTION: This JSON snippet demonstrates how to apply the Request Header Specification policy using the REST API. It defines the policy to allow all invalid header characters. The snippet shows the structure for a POST request to the environment endpoint to update the environment's policies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/request-header-specification.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n    \"request-correlation-id\": [\n      {\n        \"action\": {\n          \"invalidHeadersBehaviour\": \"ALLOW_ALL\"\n        }\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Proxy Cache Path Nginx\nDESCRIPTION: Defines the path to the cache, the name and maximum size of the shared memory zone used for storing cache keys, and the maximum size of the cache itself within the 'http' context. The 'proxy_cache_path' directive is responsible for configuring the cache storage.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_29\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nproxy_cache_path /var/oracle-cache/ keys_zone=cache_oracle:50m max_size=500m;\n```\n\n----------------------------------------\n\nTITLE: Checking Agent on CentOS/Red Hat\nDESCRIPTION: This shows how to use yum to get info on nginx-amplify-agent on CentOS/Red Hat systems. The `yum info` command retrieves information about the specified package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/faq/nginx-amplify-agent.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nyum info nginx-amplify-agent\n```\n\n----------------------------------------\n\nTITLE: Expected 413 error response (Coffee)\nDESCRIPTION: This snippet represents a 413 error response from coffee because the request body size exceeds the gateway level client_max_body_size setting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_21\n\nLANGUAGE: text\nCODE:\n```\n<html>\n<head><title>413 Request Entity Too Large</title></head>\n<body>\n<center><h1>413 Request Entity Too Large</h1></center>\n<hr><center>nginx/1.25.5</center>\n</body>\n</html>\n```\n\n----------------------------------------\n\nTITLE: Including statically linked third-party modules\nDESCRIPTION: This example demonstrates how to include a statically linked third-party module during NGINX configuration. The `--add-module` option specifies the path to the source code of the module. This allows extending NGINX functionality with custom or community-developed modules.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_56\n\nLANGUAGE: shell\nCODE:\n```\n./configure ... --add-module=/usr/build/nginx-rtmp-module\n```\n\n----------------------------------------\n\nTITLE: Add Inbound Access Rule for NGINXaaS Deployment - Azure CLI\nDESCRIPTION: This snippet adds an inbound access rule to a network security perimeter profile, allowing access from an NGINXaaS deployment's subscription.  Requires `RULE_NAME`, `PROFILE_NAME`, `NSP_NAME`, `NSP_RESOURCE_GROUP`, and `DEP_SUBSCRIPTION_ID` environment variables.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\naz network perimeter profile access-rule create --name $RULE_NAME \\\n      --profile-name $PROFILE_NAME \\\n      --perimeter-name $NSP_NAME \\\n      --resource-group $NSP_RESOURCE_GROUP \\\n      --subscriptions [0].id=\"/subscriptions/$DEP_SUBSCRIPTION_ID\"\n```\n\n----------------------------------------\n\nTITLE: Describing a RateLimit\nDESCRIPTION: Describes how to check for warning events on a RateLimit using `kubectl`. This helps identify potentially conflicting RateLimit configurations that could cause issues during control plane restarts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.6.0.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nkubectl describe ratelimit <ratelimit-name>\n```\n\n----------------------------------------\n\nTITLE: Installing nginx-plus-module-geoip2 on Amazon Linux, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: Installs the nginx-plus-module-geoip2 package using yum. This package provides the GeoIP2 dynamic module for NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nyum install nginx-plus-module-geoip2\n```\n\n----------------------------------------\n\nTITLE: Try_files Directive with 404 Error in Nginx\nDESCRIPTION: This snippet demonstrates using the `try_files` directive to check for the existence of a file or directory. If none are found, Nginx will return a 404 error.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    try_files $uri $uri/ $uri.html =404;\n}\n```\n\n----------------------------------------\n\nTITLE: Import official nginx signing key\nDESCRIPTION: This command downloads the official Nginx signing key using curl, de-armors it using gpg, and saves it to /usr/share/keyrings/nginx-archive-keyring.gpg. This allows apt to verify the authenticity of Nginx packages. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://nginx.org/keys/nginx_signing.key | gpg --dearmor \\\n        | sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null\n```\n\n----------------------------------------\n\nTITLE: Include license_usage_offline.sh content\nDESCRIPTION: This includes the content of `license_usage_offline.sh` script, most likely a bash script used to automate the license submission. Specific details are within the included markdown file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_5\n\nLANGUAGE: text\nCODE:\n```\n{{< include \"nim/disconnected/license-usage-offline-script.md\" >}}\n```\n\n----------------------------------------\n\nTITLE: Downloading Nginx Status Configuration via Wget\nDESCRIPTION: This shell script navigates to the Nginx configuration directory and uses the wget command to download a specific Nginx configuration file (status.conf) for enabling the live activity monitoring dashboard from a remote GitHub repository. The downloaded configuration file is saved locally as status.conf.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ncd /etc/nginx/conf.d/\nwget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/status.conf\n```\n\n----------------------------------------\n\nTITLE: Aborted NGINX Controller Agent Installation due to Invalid APT Input\nDESCRIPTION: This snippet demonstrates the output when the APT package installation aborts due to a mistyped response to the confirmation prompt during Nginx Controller Agent installation. It is essential to rerun the agent installation with the correct input to avoid a partially installed agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.2.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\nDo you want to continue? [Y/n] u\nAbort.\n```\n\n----------------------------------------\n\nTITLE: Starting NGINX Service - Bash\nDESCRIPTION: This command starts the NGINX service using `systemctl`. It is part of a workaround to fix misreported TCP/UDP traffic metrics in NGINX Controller. The command requires appropriate system privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nsystemctl start nginx\n```\n\n----------------------------------------\n\nTITLE: NGINX Service Mesh CLI Deploy Usage\nDESCRIPTION: Details the usage of the `nginx-meshctl deploy` command, which deploys NGINX Service Mesh into a Kubernetes cluster. It lists available flags for customizing the deployment, including those related to access control, image tags, mTLS, and telemetry.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_3\n\nLANGUAGE: txt\nCODE:\n```\nUsage:\n  nginx-meshctl deploy [flags]\n\nFlags:\n      --access-control-mode string        default access control mode for service-to-service communication\n                                          \t\tValid values: allow, deny (default \"allow\")\n      --client-max-body-size string       NGINX client max body size (default \"1m\")\n      --disable-public-images             don't pull third party images from public repositories\n      --enable-udp                        enable UDP traffic proxying (beta); Linux kernel 4.18 or greater is required\n      --environment string                environment to deploy the mesh into\n                                          \t\tValid values: kubernetes, openshift (default \"kubernetes\")\n  -h, --help                              help for deploy\n      --image-tag string                  tag used for pulling images from registry\n                                          \t\tAffects: nginx-mesh-controller, nginx-mesh-cert-reloader, nginx-mesh-init, nginx-mesh-metrics, nginx-mesh-sidecar (default \"2.0.0\")\n      --mtls-ca-key-type string           the key type used for the SPIRE Server CA\n                                          \t\tValid values: ec-p256, ec-p384, rsa-2048, rsa-4096 (default \"ec-p256\")\n      --mtls-ca-ttl string                the CA/signing key TTL in hours(h). Min value 24h. Max value 999999h. (default \"720h\")\n      --mtls-mode string                  mTLS mode for pod-to-pod communication\n                                          \t\tValid values: off, permissive, strict (default \"permissive\")\n      --mtls-svid-ttl string              the TTL of certificates issued to workloads in hours(h) or minutes(m). Max value is 999999. (default \"1h\")\n      --mtls-trust-domain string          the trust domain of the NGINX Service Mesh (default \"example.org\")\n      --mtls-upstream-ca-conf string      the upstream certificate authority configuration file\n      --nginx-error-log-level string      NGINX error log level\n                                          \t\tValid values: debug, info, notice, warn, error, crit, alert, emerg (default \"warn\")\n      --nginx-lb-method string            NGINX load balancing method\n                                          \t\tValid values: least_conn, least_time, least_time last_byte, least_time last_byte inflight, random, random two, random two least_conn, random two least_time, random two least_time=last_byte, round_robin (default \"least_time\")\n      --nginx-log-format string           NGINX log format\n                                          \t\tValid values: default, json (default \"default\")\n      --persistent-storage string         use persistent storage. \"auto\" will enable persistent storage if a default StorageClass exists\n                                          \t\tValid values: auto, off, on (default \"auto\")\n      --prometheus-address string         the address of a Prometheus server deployed in your Kubernetes cluster\n                                          \t\tAddress should be in the format <service-name>.<namespace>:<service-port>\n      --registry-key string               path to JSON Key file for accessing private GKE registry\n                                          \t\tCannot be used with --registry-username or --registry-password\n      --registry-password string          password for accessing private registry\n                                          \t\tRequires --registry-username to be set. Cannot be used with --registry-key\n      --registry-server string            hostname:port (if needed) for registry and path to images\n                                          \t\tAffects: nginx-mesh-controller, nginx-mesh-cert-reloader, nginx-mesh-init, nginx-mesh-metrics, nginx-mesh-sidecar (default \"docker-registry.nginx.com/nsm\")\n      --registry-username string          username for accessing private registry\n                                          \t\tRequires --registry-password to be set. Cannot be used with --registry-key\n      --spire-server-key-manager string   storage logic for SPIRE Server's private keys\n                                          \t\tValid values: disk, memory (default \"disk\")\n      --telemetry-exporters stringArray   list of telemetry exporter key-value configurations\n                                          \t\tFormat: \"type=<exporter_type>,host=<exporter_host>,port=<exporter_port>\".\n                                          \t\tType, host, and port are required. Only type \"otlp\" exporter is supported.\n      --telemetry-sampler-ratio float32   the percentage of traces that are processed and exported to the telemetry backend.\n                                          \t\tFloat between 0 and 1 (default 0.01)\n\nGlobal Flags:\n  -k, --kubeconfig string   path to kubectl config file (default \"/Users/<user>/.kube/config\")\n  -n, --namespace string    NGINX Service Mesh control plane namespace (default \"nginx-mesh\")\n  -t, --timeout duration    timeout when communicating with NGINX Service Mesh (default 5s)\n```\n\n----------------------------------------\n\nTITLE: Check Pod Status\nDESCRIPTION: This bash command retrieves the status of the Pods in the cluster, allowing verification that the target-v3-0 Pod is running correctly. It confirms the successful deployment of the new application version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_20\n\nLANGUAGE: bash\nCODE:\n```\n$ kubectl get pods\nNAME                            READY   STATUS    RESTARTS   AGE\ngateway-58c6c76dd-4mmht         2/2     Running   0          2m\ntarget-v2-1-6f69fc48f6-mzcf2    2/2     Running   0          2m\ntarget-v3-0-5f6fc9cf99-tps6k    2/2     Running   0          2m\n```\n\n----------------------------------------\n\nTITLE: Default Scopes for Microsoft Entra OIDC Authentication\nDESCRIPTION: These are the default scopes that NGINX Controller requests from Microsoft Entra during the OIDC authentication process. They define the permissions granted to the NGINX Controller application for accessing user information. Custom scopes should be added as a comma-separated list.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nopenID,email,profile\n```\n\n----------------------------------------\n\nTITLE: TLS handshake error from smi-metrics Pod logs\nDESCRIPTION: This log snippet illustrates a TLS handshake error that may occur in the smi-metrics Pod logs after deploying NGINX Service Mesh. The error indicates a potential problem with the certificate authority (CA) not being properly communicated, leading to failures in metrics aggregation, injection, and validation. The example allows users to identify a specific TLS-related issue and helps them understand its implications.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.9.0.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\necho: http: TLS handshake error from :: remote error: tls: bad certificate\n```\n\n----------------------------------------\n\nTITLE: Stream Upstream Connection Time Metrics\nDESCRIPTION: Describes the 'plus.stream.upstream.conn.time', 'plus.stream.upstream.conn.time.count', 'plus.stream.upstream.conn.time.max', 'plus.stream.upstream.conn.time.median', and 'plus.stream.upstream.conn.time.pctl95' metrics, which describe the time to connect to an upstream server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_26\n\nLANGUAGE: none\nCODE:\n```\nType:        timer, integer\nDescription: Average time to connect to an upstream server.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Backing Up Private Key (Shell)\nDESCRIPTION: This command creates a backup of the generated private key. Backing up the key is essential to prevent data loss and ensure the certificate remains usable in case of key corruption or accidental deletion.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nroot# cp ~/private-key.pem <SECURE-DIR>/private-key.pem.backup\n```\n\n----------------------------------------\n\nTITLE: Configure Wildcard and Explicit URLs - JSON\nDESCRIPTION: This example demonstrates configuring both wildcard and explicit URLs with different allowed methods. The first URL (/test*) is permitted for all methods, while the second (/index.html) is permitted only for the GET method.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/parameters-and-user-defined-urls.md#_snippet_5\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"/Common/user_defined_URL\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_URL\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"urls\": [\n            {\n                \"method\": \"*\",\n                \"name\": \"/test*\",\n                \"protocol\": \"http\",\n                \"type\": \"wildcard\",\n                \"wildcardOrder\": 1\n            },\n            {\n                \"method\": \"GET\",\n                \"name\": \"/index.html\",\n                \"protocol\": \"http\",\n                \"type\": \"explicit\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Patching Spiffeid resources in Kubernetes\nDESCRIPTION: This script iterates through all namespaces in a Kubernetes cluster and patches the Spiffeid resources within each namespace to remove finalizers. This is often needed to resolve issues during NGINX Service Mesh removal, where Spiffeid resources may block namespace deletion. The script uses `kubectl` to get namespaces, Spiffeids, and patch them.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.7.0.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nfor ns in $(kubectl get ns | awk '{print $1}' | tail -n +2)\ndo\n  if [ $(kubectl get spiffeids -n $ns 2>/dev/null | wc -l) -ne 0 ]\n  then\n    kubectl patch spiffeid $(kubectl get spiffeids -n $ns | awk '{print $1}' | tail -n +2) --type='merge' -p '{\"metadata\":{\"finalizers\":null}}' -n $ns\n  fi\ndone\n```\n\n----------------------------------------\n\nTITLE: Checking Kubernetes StorageClass Configuration using kubectl\nDESCRIPTION: This command retrieves the configured StorageClasses in the Kubernetes cluster. The output displays the name, provisioner, and age of each StorageClass. NGINX Service Mesh will automatically use the default StorageClass if configured.  Multiple Storage Classes can exist, but only the default one will be used.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/persistent-storage.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get storageclass\nNAME                 PROVISIONER            AGE\nstandard (default)   kubernetes.io/gce-pd   153d\n```\n\n----------------------------------------\n\nTITLE: Restart Keepalived Service\nDESCRIPTION: This snippet restarts the `keepalived` service to apply configuration changes.  It's a standard systemd command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart keepalived\n```\n\n----------------------------------------\n\nTITLE: Opening a core dump file with GDB\nDESCRIPTION: Opens a core dump file using the GDB debugger to analyze the program's state at the time of the crash. Requires the path to the NGINX executable and the core dump file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_25\n\nLANGUAGE: shell\nCODE:\n```\nsudo gdb <nginx_executable_path> <coredump_file_path>\n```\n\n----------------------------------------\n\nTITLE: Login to NGINX Controller API using curl\nDESCRIPTION: This code snippet demonstrates how to log in to the NGINX Controller API using curl. It sends a POST request to the login endpoint with username and password, and saves the session cookie to a file named `cookie.txt`. The `-c` flag is used to store the cookie.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/api/overview.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ncurl -c cookie.txt -X POST --url 'https://198.51.100.10/api/v1/platform/login' --header 'Content-Type: application/json' --data '{\"credentials\": {\"type\": \"BASIC\",\"username\": \"arthur@example.net\",\"password\": \"<password>\"}}'\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX Agent on SLES\nDESCRIPTION: This command removes the NGINX Agent package using the zypper package manager, which is standard for SLES distributions. Requires root privileges to execute. This removes the installed nginx-agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/uninstall.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo zypper remove nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Restarting the NGINX Controller Agent\nDESCRIPTION: This bash command restarts the Controller Agent service after the agent.conf file has been updated with the new FQDN. This ensures that the agent uses the new FQDN to communicate with the NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/manage-cluster.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo service controller-agent restart\n```\n\n----------------------------------------\n\nTITLE: BIG-IP Component Creation Error\nDESCRIPTION: This code snippet shows the error message encountered when trying to create a BIG-IP component, indicating a binding failure. The error suggests the inability to assign the requested address to NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.3.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\nFailed testing config before applying: nginx:\nthe configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: [emerg] bind() to <IP>:20001 failed (99: Cannot assign requested address)\nnginx: configuration file /etc/nginx/nginx.conf test failed\n```\n\n----------------------------------------\n\nTITLE: Set Accept-Encoding Header for _jwks_uri and _token Locations\nDESCRIPTION: This snippet shows how to add the `proxy_set_header` directive to the `/_jwks_uri` and `/_token` locations in the _openid_connect.server_conf_ file to `Accept-Encoding \"gzip\"`. This enables gzip compression for these endpoints, which improves performance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/onelogin.md#_snippet_4\n\nLANGUAGE: Nginx configuration file\nCODE:\n```\n...\nlocation = /_jwks_uri {\n    ...\n    proxy_set_header    Accept-Encoding \"gzip\";\n}\n...\nlocation = /_token {\n    ...\n    proxy_set_header    Accept-Encoding \"gzip\";\n}\n...\n```\n\n----------------------------------------\n\nTITLE: Installing Lua module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: These commands update the system and install the `nginx-plus-module-lua` package using `dnf`. This assumes that the nginx-plus repository is configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/lua.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-lua\n```\n\n----------------------------------------\n\nTITLE: NGINX: OIDC Provider Configuration\nDESCRIPTION: This configuration defines the Keycloak provider using the `oidc_provider` context within the `http` block. It specifies the issuer URL, client ID, and client secret obtained from the Keycloak configuration.  NGINX uses this information to communicate with Keycloak for authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/keycloak.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider keycloak {\n        issuer        https://<keycloak-server>/realms/<realm_name>;\n        client_id     <client_id>;\n        client_secret <client_secret>;\n    }\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Add and Update Helm Repository\nDESCRIPTION: Adds the Jetstack Helm repository and updates the local repository index. This is a prerequisite for installing cert-manager using Helm.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/integrating-cert-manager.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nhelm repo add jetstack https://charts.jetstack.io\nhelm repo update\n```\n\n----------------------------------------\n\nTITLE: Terraform Deployment Update\nDESCRIPTION: These commands are used to initialize Terraform, create a plan based on specified storage account variables, and apply the plan to update the NGINXaaS deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/monitoring/enable-logging/logging-using-terraform.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\nterraform init\nterraform plan -var=\"storage_account_resource_group=myresourcegroup\" -var=\"storage_account_name=myaccountname\" -out=plan.cache\nterraform apply plan.cache\n```\n\n----------------------------------------\n\nTITLE: Change Metrics Port - Update Container Port\nDESCRIPTION: This YAML snippet shows how to change the metrics port in the container port definition.  `<new-port>` should be replaced with the desired port number.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/prometheus.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\n- name: metrics\n  containerPort: <new-port>\n```\n\n----------------------------------------\n\nTITLE: Verify SELinux Port Configuration\nDESCRIPTION: Verifies that the specified ports have the correct SELinux context.  This is useful for confirming that the `semanage` command has been applied correctly. Requires `seinfo` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-selinux.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nseinfo --portcon=10000\nseinfo --portcon=11000\n```\n\n----------------------------------------\n\nTITLE: Mount NFS Shares\nDESCRIPTION: These commands mount the NFS shares for clickhouse and nms directories on both servers.  The NFS server IP must be specified.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo mount -t nfs4 \\\n  -o rw,relatime,vers=4.2, \\\n     rsize=524288,wsize=524288,namlen=255, \\\n     hard,proto=tcp,timeo=600,retrans=2,sec=sys \\\n  <NFS_SERVER_IP>:/mnt/nfs_share/clickhouse \\\n  /var/lib/clickhouse\n\nsudo mount -t nfs4 \\\n  -o rw,relatime,vers=4.2, \\\n     rsize=524288,wsize=524288,namlen=255, \\\n     hard,proto=tcp,timeo=600,retrans=2,sec=sys \\\n  <NFS_SERVER_IP>:/mnt/nfs_share/nms \\\n  /var/lib/nms\n```\n\n----------------------------------------\n\nTITLE: Attack Started Notification Shell Example\nDESCRIPTION: This snippet shows an example of an 'Attack Started' notification generated by NGINX App Protect DoS. It includes key parameters related to the attack, such as date and time, product information, attack ID, stress level, and various traffic statistics like DPS, RPS, and connection counts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/security-log.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ndate_time=\"Oct 05 2021 08:01:00\",\nproduct=\"app-protect-dos\",\nproduct_version=\"25+1.78.0-1.el7.ngx\",\nunit_hostname=\"localhost.localdomain\",\ninstance_id=\"129c76\",\nvs_name=\"example.com/\",\ndos_attack_id=\"1\",\nattack_event=\"Attack started\",\nstress_level=\"1.00\",\nlearning_confidence=\"Ready\",\nbaseline_dps=\"17\",\nincoming_dps=\"181\",\nincoming_rps=\"181\",\nsuccessful_tps=\"0\",\nallowlist_rps=\"0\",\nunsuccessful_rps=\"0\",\nincoming_datagrams=\"8576\",\nincoming_requests=\"8576\",\nallowlist_requests=\"162\",\nsuccessful_responses=\"5265\",\nunsuccessful_requests=\"0\",\nactive_connections=\"58\",\nthreshold_dps=\"41.60\",\nthreshold_conns=\"41.60\",\nmitigated_bad_actors=\"0\",\nmitigated_by_signatures=\"0\",\nmitigated_by_global_rate=\"0\",\nmitigated_bad_actors_l4=\"0\",\nmitigated_slow=\"0\",\nredirect_global=\"0\",\nredirect_bad_actor=\"0\",\nredirect_signature=\"0\",\nredirect_slow=\"0\",\nchallenge_global=\"0\",\nchallenge_bad_actor=\"0\",\nchallenge_signature=\"0\",\nchallenge_slow=\"0\",\nblock_global=\"0\",\nblock_bad_actor=\"0\",\nblock_signature=\"0\",\nblock_slow=\"0\",\nmitigated_connections=\"0\",\nmitigated_bad_actors_rps=\"0\",\nmitigated_by_signatures_rps=\"0\",\nmitigated_by_global_rate_rps=\"0\",\nmitigated_bad_actors_l4_rps=\"0\",\nmitigated_slow_rps=\"0\",\nredirect_global_rps=\"0\",\nredirect_bad_actor_rps=\"0\",\nredirect_signature_rps=\"0\",\nredirect_slow_rps=\"0\",\nchallenge_global_rps=\"0\",\nchallenge_bad_actor_rps=\"0\",\nchallenge_signature_rps=\"0\",\nchallenge_slow_rps=\"0\",\nblock_global_rps=\"0\",\nblock_bad_actor_rps=\"0\",\nblock_signature_rps=\"0\",\nblock_slow_rps=\"0\",\nmitigated_connections_rps=\"0\"\n```\n\n----------------------------------------\n\nTITLE: Importing NGINX Signing Key on Ubuntu\nDESCRIPTION: This command fetches the official NGINX signing key, de-armors it, and adds it to the system's keyring for verifying package authenticity. It uses curl to download the key, gpg to de-armor it, and tee to save it to the specified file while suppressing output to the terminal.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_22\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://nginx.org/keys/nginx_signing.key | gpg --dearmor \\\n    | sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null\n```\n\n----------------------------------------\n\nTITLE: Set execute permissions for bash script\nDESCRIPTION: This command changes the file permissions of the provided bash script to make it executable, allowing it to be run directly from the command line. It is a prerequisite for running the `license_usage_offline.sh` script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/report-usage-disconnected-deployment.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nchmod +x <path-to-script>/license_usage_offline.sh\n```\n\n----------------------------------------\n\nTITLE: Backing Up Key File OpenSSL\nDESCRIPTION: This snippet creates a backup copy of the generated private key. This backup ensures that the certificate remains usable in case of key loss, which is a standard security measure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nroot# cp ~/company.com.key secure-dir/company.com.key.backup\n```\n\n----------------------------------------\n\nTITLE: NGINX gateway update failure due to configuration test\nDESCRIPTION: This snippet demonstrates an error encountered during gateway update when a Published API is associated with multiple gateways and Authentication is enabled in the associated component. Disabling Authentication is necessary before the update can proceed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.8.md#_snippet_3\n\nLANGUAGE: text\nCODE:\n```\nFailed testing config before applying\n```\n\n----------------------------------------\n\nTITLE: Add Server to Upstream - Shell\nDESCRIPTION: This `curl` command adds a new server to the `appservers` upstream group using the Nginx Plus API.  It sets various parameters for the new server, including its address, weight, connection limits, and status flags.  The command sends a POST request with a JSON payload to the API endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/dynamic-configuration-api.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X POST -d '{ \\\n   \"server\": \"10.0.0.1:8089\", \\\n   \"weight\": 4, \\\n   \"max_conns\": 0, \\\n   \"max_fails\": 0, \\\n   \"fail_timeout\": \"10s\", \\\n   \"slow_start\": \"10s\", \\\n   \"backup\": true, \\\n   \"down\": true \\\n }' -s 'http://127.0.0.1/api/9/http/upstreams/appservers/servers'\n```\n\n----------------------------------------\n\nTITLE: Create Renewable Vault Token using curl\nDESCRIPTION: This bash command uses `curl` to create a renewable Vault token with a specified policy and period.  It sends a POST request to the Vault API, providing a root token for authentication and a JSON payload defining the token's policies and renewal period. The output is then parsed using `jq` to extract the client token and save it to a file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-vault.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X POST --header \"X-Vault-Token: $VAULT_ROOT_TOKEN\" \\\n  --data '{\"policies\": \"nms_secrets\", \"period\": \"24h\"}' \\\n  $VAULT_ADDR/v1/auth/token/create | jq -r \".auth.client_token\" > periodic_token.txt\n```\n\n----------------------------------------\n\nTITLE: Nginx Metrics Calculation from stub_status\nDESCRIPTION: This snippet describes how Nginx Amplify Agent calculates several key Nginx metrics based on the `stub_status` output. It demonstrates the formulas used to derive `accepted`, `active`, `current`, `dropped`, `idle`, `request.count`, `request.current`, `request.reading`, and `request.writing` metrics from the values provided by `stub_status`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/configuring-metric-collection.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nnginx.http.conn.accepted = stub_status.accepts\nnginx.http.conn.active = stub_status.active - stub_status.waiting\nnginx.http.conn.current = stub_status.active\nnginx.http.conn.dropped = stub_status.accepts - stub_status.handled\nnginx.http.conn.idle = stub_status.waiting\nnginx.http.request.count = stub_status.requests\nnginx.http.request.current = stub_status.reading + stub_status.writing\nnginx.http.request.reading = stub_status.reading\nnginx.http.request.writing = stub_status.writing\n```\n\n----------------------------------------\n\nTITLE: Add Delayed Shutdown Hooks in values.yaml\nDESCRIPTION: This YAML snippet adds `lifecycle: preStop` hooks to the `nginxGateway` and `nginx` container definitions within the `values.yaml` file. These hooks configure a delay during the shutdown process, allowing connections to gracefully close before the container terminates.  The sleep duration can be adjusted based on environmental requirements.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_12\n\nLANGUAGE: yaml\nCODE:\n```\nnginxGateway:\n  <...>\n  lifecycle:\n    preStop:\n      exec:\n        command:\n        - /usr/bin/gateway\n        - sleep\n        - --duration=40s # This flag is optional, the default is 30s\n\nnginx:\n  <...>\n  lifecycle:\n    preStop:\n      exec:\n        command:\n        - /bin/sleep\n        - \"40\"\n```\n\n----------------------------------------\n\nTITLE: Defining ACL IP Restriction Policy via API in JSON\nDESCRIPTION: This JSON snippet defines an ACL IP restriction policy to deny access from all IP addresses except for 10.0.0.1.  It utilizes the `acl-ip` policy type within the `policies` section.  `deny` contains a list of IPs to deny and `allow` contains IPs to allow. If only `allow` or `deny` is provided, the other list will default to 'deny all'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/api-access-control-lists.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policies\": {\n        \"acl-ip\": [\n            {\n                \"action\": {\n                    \"deny\": [\"*\"], // Polulate this array with your denied IP addresses\n                    \"allow\": [\"10.0.0.1\"]\n                }\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Byte-Range Caching: Full Nginx example\nDESCRIPTION: This complete example demonstrates byte-range caching by defining the `slice` directive, enabling caching using `proxy_cache`, incorporating the `$slice_range` variable in the `proxy_cache_key`, setting the `Range` header to `$slice_range` for the proxied server, and validating the cache for both 200 and 206 status codes. This setup enables caching of file slices for efficient range requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\nlocation / {\n    slice             1m;\n    proxy_cache       cache;\n    proxy_cache_key   $uri$is_args$args$slice_range;\n    proxy_set_header  Range $slice_range;\n    proxy_cache_valid 200 206 1h;\n    proxy_pass        http://localhost:8000;\n}\n```\n\n----------------------------------------\n\nTITLE: Bidirectional Streaming IDL Example (protobuf)\nDESCRIPTION: This protobuf code defines a gRPC service named `Greeter` with several methods including unary, client streaming, server streaming, and bidirectional streaming.  It also defines the `HelloRequest` and `HelloReply` message types used by these methods.  This example demonstrates how streaming can be defined within a gRPC service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/how-to/bidirectional-configuration.md#_snippet_3\n\nLANGUAGE: protobuf\nCODE:\n```\nsyntax = \"proto3\";\npackage streaming;\nservice Greeter {\n  rpc BothUnary (HelloRequest) returns (HelloReply) {}\n  rpc ClientStreaming (stream HelloRequest) returns (HelloReply) {}\n  rpc ServerStreaming (HelloRequest) returns (stream HelloReply) {}\n  rpc BidirectionalStreaming (stream HelloRequest) returns (stream HelloReply) {}\n}\nmessage HelloRequest {\n  string message = 1;\n}\nmessage HelloReply {\n  string message = 1;\n}\n```\n\n----------------------------------------\n\nTITLE: Example Service and Pod Output (Text)\nDESCRIPTION: This is the expected output from the `kubectl get svc,pod` command, showing the `coffee` and `tea` services and their corresponding pods. The output confirms that the services are of type `ClusterIP` and that the pods are running.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_2\n\nLANGUAGE: text\nCODE:\n```\nNAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE\nservice/coffee       ClusterIP   10.244.0.14     <none>        80/TCP    23h\nservice/tea          ClusterIP   10.244.0.15     <none>        80/TCP    23h\n\nNAME                          READY   STATUS    RESTARTS   AGE\npod/coffee-676c9f8944-n9g6n   1/1     Running   0          23h\npod/tea-6fbfdcb95d-cf84d      1/1     Running   0          23h\n```\n\n----------------------------------------\n\nTITLE: Configure Custom Health Check - Nginx\nDESCRIPTION: This configures a custom HTTP health check in Nginx. The `match server_ok` block defines criteria for a healthy server, requiring a 200 status code and the presence of 'Welcome to nginx!' in the response body. The `location /` block proxies requests to the 'myapp' upstream and uses `health_check match=server_ok` to apply the custom health check.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nmatch server_ok {\n    status 200;\n    body ~ \"Welcome to nginx!\";\n}\nserver {\n    #...\n    location / {\n        proxy_pass http://myapp;\n        health_check match=server_ok;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Blocking Parameter Violations with JSON\nDESCRIPTION: This JSON snippet configures an Nginx policy to block parameter-related violations, specifically multipart null values and meta-characters in parameter names and values. It also sets up a wildcard parameter configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/parameters-and-user-defined-urls.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"parameters_blocking\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_PARAMETER_MULTIPART_NULL_VALUE\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_NAME_METACHAR\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_VALUE_METACHAR\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"parameters\": [\n            {\n                \"checkMetachars\": true,\n                \"parameterLocation\": \"any\",\n                \"valueType\": \"auto-detect\",\n                \"metacharsOnParameterValueCheck\": true,\n                \"name\": \"*\",\n                \"type\": \"wildcard\",\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Kubectl Apply Error Message\nDESCRIPTION: This snippet shows an error message displayed when starting NGINX Controller, related to an invalid patch for the analytics database.  This message can be safely ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.5.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nError: unknown flag: --server-dry-run\nSee 'kubectl apply --help' for usage.\nDetected an invalid patch for the analytics database. Resolving conflicts and restarting the analytics database before running the update.\nstatefulset.apps/clickhouse patched\n```\n\n----------------------------------------\n\nTITLE: String MultiSelect Field JSON Schema Example\nDESCRIPTION: This JSON schema defines a string MultiSelect field named 'method' within an array. It enables users to select multiple values (GET, POST, PUT, DELETE) from a list of predefined options.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/reference/json-schema-reference.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"method\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\",\n        \"enum\": [\"GET\", \"POST\", \"PUT\", \"DELETE\"]\n      }\n    }\n  }\n```\n\n----------------------------------------\n\nTITLE: Configuring SSL Protocols with ssl_protocols in Nginx\nDESCRIPTION: This configuration directive allows enabling or disabling specific SSL/TLS protocols. It's crucial for controlling the security level of connections. Requires Nginx to be properly installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/technical-specs.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nssl_protocols TLSv1.2 TLSv1.3;\n```\n\n----------------------------------------\n\nTITLE: Removing SPIFFEID finalizers\nDESCRIPTION: This command removes `finalizers` from each `spiffeid` resource within a given namespace, which resolves namespace deletion issues after removing NGINX Service Mesh.  The namespace must be specified in place of `<namespace>`. This allows the namespace to be fully removed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.6.0.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl patch spiffeid $SPIFFEIDS --type='merge' -p '{\"metadata\":{\"finalizers\":null}}' -n <namespace>\n```\n\n----------------------------------------\n\nTITLE: Complete DNS Health Check Configuration Example\nDESCRIPTION: This example provides a complete NGINX configuration for DNS health checks. It includes the stream block with upstream servers, health check configuration, and the match block definition.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\n\nstream {\n    upstream dns_upstream {\n        zone   dns_zone 64k;\n        server 192.168.136.130:53;\n        server 192.168.136.131:53;\n        server 192.168.136.132:53;\n}\n    server {\n        listen          53 udp;\n        proxy_pass      dns_upstream;\n        health_check    match=dns udp;\n        proxy_timeout   1s;\n        proxy_responses 1;\n        error_log       logs/dns.log;\n        }\n\n    match dns {\n        # make sure appropriate CNAME record exists\n        send \\x00\\x01\\x01\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x0b\\x68\\x65\\x61\\x6c\\x74\\x68\\x63\\x68\\x65\\x63\\x6b\\x07\\x65\\x78\\x61\\x6d\\x70\\x6c\\x65\\x03\\x63\\x6f\\x6d\\x00\\x00\\x01\\x00\\x01;\n        expect  ~* \"healthy.svcs.example.com\";\n    }\n}\n\n```\n\n----------------------------------------\n\nTITLE: Example of Connection Error Message\nDESCRIPTION: This JSON snippet shows an example of error messages related to connection issues between NGINX Controller and a data collector (Splunk) which is obtained from the forwarder status via REST API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-forwarders.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"state\": {\n        \"conditions\": [\n            {\n                \"message\": \"error code: 440020, Sending data failed. Connection to the specified Splunk collector at {collectorAddress} could not be established. Check Integration and Splunk collector configuration.\",\n                \"type\": \"error\"\n            },\n            {\n                \"message\": \"error code: 440050, Heartbeat failed. Connection to the collector with reference /platform/integrations/splunk could not be established. Check Integration and collector configuration.; The error has occurred 3 times in the last 30s.\",\n                \"type\": \"error\"\n            }\n        ],\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Plus Repo to Amazon Linux 2023\nDESCRIPTION: Downloads the NGINX Plus repository file for Amazon Linux 2023 and places it in the /etc/yum.repos.d directory. This step is required to allow the system to find and install the NGINX Plus packages using the DNF package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/plus-amazonlinux2023.repo\n```\n\n----------------------------------------\n\nTITLE: Setting up Port-Forwarding for Bookinfo Service\nDESCRIPTION: This bash command sets up port forwarding for the `productpage` service within the `bookinfo` application, mapping local port 9080 to the service. This enables access to the application through a web browser for verification and testing purposes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/secure-traffic-mtls.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nkubectl port-forward svc/productpage 9080\n```\n\n----------------------------------------\n\nTITLE: Tear Down NGINX Instance Manager (Docker Compose)\nDESCRIPTION: This command stops and removes the containers, networks, volumes, and images created by `docker compose up`.  It completely tears down the NGINX Instance Manager deployment. It's useful for cleaning up the environment after testing or decommissioning.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ndocker compose down\n```\n\n----------------------------------------\n\nTITLE: Making nginx-meshctl executable on macOS\nDESCRIPTION: This command sets the execute permission on the nginx-meshctl binary, allowing it to be run as a program. This is required for the system to recognize and execute the command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo chmod +x /usr/local/bin/nginx-meshctl\n```\n\n----------------------------------------\n\nTITLE: Starting WAF Services using Docker Compose\nDESCRIPTION: This command starts the WAF services using Docker Compose. It navigates to the directory containing the `docker-compose.yml` file and runs `docker compose up -d` to start the services in detached mode. Requires Docker Compose to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_44\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker compose up -d\n```\n\n----------------------------------------\n\nTITLE: Logging into Private Docker Registry\nDESCRIPTION: This shell command authenticates the Docker client with the specified private Docker registry, allowing for pushing and pulling of images.  Replace `<my-docker-registry>` with the appropriate registry URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/devportal-helm-chart.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ndocker login <my-docker-registry>\n```\n\n----------------------------------------\n\nTITLE: Push NGINX Plus Docker Images\nDESCRIPTION: This command pushes docker images to the specified registry. Replace `myregistry.example.com/nginx-gateway-fabric` with your container registry path. Requires Docker to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/building-the-images.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ndocker push myregistry.example.com/nginx-gateway-fabric:{{< version-ngf >}}\ndocker push myregistry.example.com/nginx-gateway-fabric/nginx-plus:{{< version-ngf >}}\n```\n\n----------------------------------------\n\nTITLE: Uninstall Dynamic Module on Debian and Ubuntu\nDESCRIPTION: This command uninstalls the specified dynamic module using the apt package manager. It requires sudo privileges and the correct dynamic module name. The command removes the module package from the system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/uninstall.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt remove <dynamic_module_name>\n```\n\n----------------------------------------\n\nTITLE: HTTPRouteGroup YAML Definition\nDESCRIPTION: This YAML defines an HTTPRouteGroup resource.  It specifies that traffic must use the GET method, access the '/echo' path, and have specific headers to be considered a match. It defines the 'destination-traffic' match used in the TrafficTarget.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_13\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi-spec.io/v1alpha3\nkind: HTTPRouteGroup\nmetadata:\n  name: route-group\nspec:\n  matches:\n  - name: destination-traffic\n    methods:\n    - GET\n    pathRegex: \"/echo\"\n    headers:\n      X-Demo-1: \"^demo-1$\"\n      x-demo-2: \"demo\"\n```\n\n----------------------------------------\n\nTITLE: Bootstrapping the Second Nginx Node with Chef\nDESCRIPTION: This command uses `knife bootstrap` to provision the second Nginx node. It sets the node name, username, JSON attributes to configure `ha_primary` to false for the secondary node, uses sudo privileges, applies the `nginx_plus_ha` role defined in Chef, and provides the target node's IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nknife bootstrap -N chef-test-2 -x username --json-attributes \"{\\\"nginx\\\": {\\\"ha_primary\\\": \\\"false\\\"}}\" --sudo --run-list \"role[nginx_plus_ha]\" 10.100.10.102\n```\n\n----------------------------------------\n\nTITLE: Stream Status Code Metrics\nDESCRIPTION: Describes the 'plus.stream.status.2xx', 'plus.stream.status.4xx', and 'plus.stream.status.5xx' metrics, which are counters for sessions completed with the given status codes. These metrics provide a breakdown of session outcome statistics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_20\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Number of sessions completed with status codes 2xx, 4xx, or 5xx.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Backup NGINX Instance Manager (Docker)\nDESCRIPTION: This command executes the `nim-backup` script inside the `nim-nim-1` Docker container, creating a backup of NGINX Instance Manager data. The backup is stored within the container's file system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\n~$ docker exec nim-nim-1 nim-backup\n```\n\n----------------------------------------\n\nTITLE: Generate User Access Token Example\nDESCRIPTION: This command generates a user access token from Keycloak using the password grant type. It requires providing the client ID, client secret, username, and password.  The output is formatted with `jq`.  Values within angle brackets must be replaced with actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\ncurl -L -X POST 'http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token' \\\n  -H 'Content-Type: application/x-www-form-urlencoded' \\\n  --data-urlencode 'client_id=nginx-plus' \\\n  --data-urlencode 'grant_type=password' \\\n  --data-urlencode 'client_secret=<REPLACE_WITH_CLIENT_SECRET>' \\\n  --data-urlencode 'scope=openid' \\\n  --data-urlencode 'username=nginx-user' \\\n  --data-urlencode 'password=password' \\\n  | jq\n```\n\n----------------------------------------\n\nTITLE: Convert Remote Certificate via REST API (bash)\nDESCRIPTION: This cURL command sends a PUT request to the NGINX Instance Manager REST API to convert a remote certificate to a managed certificate. It requires the certificate name and details, including the private key and public certificate (both base64 encoded), within the JSON payload.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/manage-certificates.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X PUT \"https://nginx-manager.example.com/api/platform/v1/certs/pem_cert_with_ca\" \\\n  -H \"accept: application/json\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"pem_cert_with_ca\",\n    \"certPEMDetails\": {\n      \"type\": \"PEM\",\n      \"privateKey\": \"-----BEGIN PRIVATE KEY-----<base64-encoded blob>-----END PRIVATE KEY-----\",\n      \"publicCert\": \"-----BEGIN CERTIFICATE-----<base64-encoded blob>-----END CERTIFICATE-----\",\n      \"password\": \"\",\n      \"caCerts\": [\n        \"-----BEGIN CERTIFICATE-----<base64-encoded blob>-----END CERTIFICATE-----\"\n      ]\n    },\n    \"instanceRefs\": []\n  }'\n```\n\n----------------------------------------\n\nTITLE: Running Markdownlint for Nginx Documentation (Shell)\nDESCRIPTION: This command runs markdownlint to check the content of Nginx documentation against a specified configuration file. The `-c .markdownlint.yaml` argument specifies the configuration file to use.  `</content/path>` represents the path to the file or directory to be linted.\nSOURCE: https://github.com/nginx/documentation/blob/main/CONTRIBUTING_DOCS.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nmarkdownlint -c .markdownlint.yaml </content/path>\n```\n\n----------------------------------------\n\nTITLE: Generating Signature Report (All Details)\nDESCRIPTION: Generates a JSON report file with all signature details using the Attack Signature Report tool. It uses the `-o` switch to specify the output file, and pipes the output to `jq` for formatting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_25\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/get-signatures -o /path/to/signature-report.json | jq\n```\n\n----------------------------------------\n\nTITLE: Experimental Gateway and Component API Properties Implemented but not Thoroughly Tested\nDESCRIPTION: This snippet lists the Gateway and Component API properties that are marked as `experimental` and have been implemented, but have not been thoroughly tested. It indicates that these properties might not function as expected and should be used with caution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.2.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\ncomponents.desiredState.backend.workloadGroups.uris.failTimeout\ncomponents.desiredState.backend.workloadGroups.uris.slowStart\ncomponents.desiredState.programmability.uriRedirects\n```\n\n----------------------------------------\n\nTITLE: NGINX Service Mesh CLI Inject Usage\nDESCRIPTION: Explains the usage of the `nginx-meshctl inject` command, which injects the NGINX Service Mesh sidecar into Kubernetes resources.  Details how it accepts JSON and YAML formats and outputs the modified resources to stdout.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_5\n\nLANGUAGE: txt\nCODE:\n```\nUsage:\n  nginx-meshctl inject [flags]\n\nFlags:\n  -f, --file string                  the filename that contains the resources you want to inject\n                                     \t\tIf no filename is provided, input will be taken from stdin\n  -h, --help                         help for inject\n      --ignore-incoming-ports ints   ports to ignore for incoming traffic\n      --ignore-outgoing-ports ints   ports to ignore for outgoing traffic\n\nGlobal Flags:\n  -k, --kubeconfig string   path to kubectl config file (default \"/Users/<user>/.kube/config\")\n  -n, --namespace string    NGINX Service Mesh control plane namespace (default \"nginx-mesh\")\n  -t, --timeout duration    timeout when communicating with NGINX Service Mesh (default 5s)\n```\n\n----------------------------------------\n\nTITLE: Expected 413 error response\nDESCRIPTION: This snippet shows the expected 413 error response when a POST request exceeds the configured client_max_body_size limit.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_12\n\nLANGUAGE: text\nCODE:\n```\n<html>\n<head><title>413 Request Entity Too Large</title></head>\n<body>\n<center><h1>413 Request Entity Too Large</h1></center>\n<hr><center>nginx/1.25.5</center>\n</body>\n</html>\n```\n\n----------------------------------------\n\nTITLE: Running install-nim-bundle.sh with a tarball\nDESCRIPTION: This shell command runs the `install-nim-bundle.sh` script using a tarball containing the necessary packages for installation in a disconnected environment. It includes specifying paths to the SSL certificate, private key, and the tarball file. Sets installation mode to offline and defines the target distribution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide.md#_snippet_2\n\nLANGUAGE: Shell Script\nCODE:\n```\nsudo bash install-nim-bundle.sh \\\n    -c <path/to/certificate.crt>\n    -k <path/to/private.key> \\\n    -m offline \\\n    -d <distribution> \\\n    -i <path/to/tarball.tar.gz>\n```\n\n----------------------------------------\n\nTITLE: Make Bash script executable - NGINX Instance Manager\nDESCRIPTION: This command makes the downloaded `license_usage_offline.sh` script executable. This is a necessary step before running the script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nchmod +x <path-to-script>/license_usage_offline.sh\n```\n\n----------------------------------------\n\nTITLE: Delete NGINXaaS Deployment Example (Azure CLI)\nDESCRIPTION: This example shows how to delete an NGINXaaS deployment using the Azure CLI. It specifies the deployment name and the resource group where the deployment is located. The specified resource group and deployment must exist.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/create-deployment/deploy-azure-cli.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment delete --name myDeployment \\\n      --resource-group myResourceGroup\n```\n\n----------------------------------------\n\nTITLE: Checking Nginx and Keepalived Status (bash)\nDESCRIPTION: This snippet checks the status of both NGINX and Keepalived services. This is crucial for verifying that both services are running correctly after the maintenance, specifically when encountering issues.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/ha-data-plane.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl status nginx\nsudo systemctl status keepalived\n```\n\n----------------------------------------\n\nTITLE: Enable ClickHouse server to start on boot (Debian, Ubuntu)\nDESCRIPTION: Enables the ClickHouse server to start automatically on boot. This ensures ClickHouse runs after a system restart.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl enable clickhouse-server\n```\n\n----------------------------------------\n\nTITLE: Making Scripts Executable (chmod) - Shell\nDESCRIPTION: These commands use `chmod +x` to make the backup and restore scripts executable. This allows the user to run the scripts directly from the command line.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo chmod +x backup.sh\nsudo chmod +x restore.sh\nsudo chmod +x backup-acm.sh\nsudo chmod +x restore-acm.sh\nsudo chmod +x support-package.sh\n```\n\n----------------------------------------\n\nTITLE: Configure JWT path\nDESCRIPTION: Configures the path to JWT license file if it's not in the default directory.  custom/file/path/license.jwt needs to be replaced with the actual path to the JWT file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_61\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n    license_token custom/file/path/license.jwt;\n}\n```\n\n----------------------------------------\n\nTITLE: Description of amplify.agent.status metric\nDESCRIPTION: Provides the type and description for the amplify.agent.status metric which is an internal integer representing 1 - agent is up, 0 - agent is down.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_15\n\nLANGUAGE: none\nCODE:\n```\nType:        internal, integer\nDescription: 1 - agent is up, 0 - agent is down.\n```\n\n----------------------------------------\n\nTITLE: Config Action Failed Error - Text\nDESCRIPTION: This snippet shows an example error when publishing a configuration. This can occur when there is a desynchronization between the NGINX Agent and NGINX PID, often after manually restarting NGINX when the Agent is running.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/known-issues.md#_snippet_11\n\nLANGUAGE: text\nCODE:\n```\nconfig action failed: Config apply failed (write): no such process\n```\n\n----------------------------------------\n\nTITLE: Apply Kubernetes manifest for HTTPRoute resources\nDESCRIPTION: This snippet applies a Kubernetes manifest to create HTTPRoute resources for the coffee and tea applications using kubectl.  It fetches the manifest from a remote GitHub URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/examples/client-settings-policy/httproutes.yaml\n```\n\n----------------------------------------\n\nTITLE: Create Service Workspace (ACM) - JSON\nDESCRIPTION: The JSON payload for creating a Service Workspace in API Connectivity Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_17\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"name\": \"service-ws\"\n}\n```\n\n----------------------------------------\n\nTITLE: Prometheus Query for P50 Latency (200/201)\nDESCRIPTION: This Prometheus query calculates the p50 latency of successful requests (200 or 201 response codes) sent from deployment `productpage-v1` in namespace `prod` to service `details` in namespace `prod` over the last 30 seconds.  It uses the `nginxplus_upstream_server_response_latency_ms_bucket` and filters using `namespace`, `deployment`, `dst_service` and response `code` labels.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_12\n\nLANGUAGE: promQL\nCODE:\n```\nhistogram_quantile(0.50, sum(irate(nginxplus_upstream_server_response_latency_ms_bucket{namespace=\"prod\",deployment=\"productpage-v1\",dst_service=\"details\",code=~\"200|201\"}[30s])) by (le))\n```\n\n----------------------------------------\n\nTITLE: Configure keepalived.conf\nDESCRIPTION: This snippet configures `/etc/keepalived/keepalived.conf` with a VRRP instance and script to monitor NMS services. It defines the network interface, authentication password, and virtual IP address.  Placeholders must be replaced with actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nvrrp_script nms_check_keepalived {\n    script \"/etc/nms/scripts/nms-check-keepalived.sh\"\n    interval 10\n    weight 10\n}\n\nvrrp_instance VI_28 {\n    state MASTER   # Set to BACKUP on the secondary server\n    interface <NETWORK_INTERFACE>   # Replace with the correct network interface\n    priority 100\n    virtual_router_id 251\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass <AUTH_PASSWORD>   # Replace with a secure password\n    }\n    virtual_ipaddress {\n        <VIRTUAL_IP_ADDRESS>   # Replace with your reserved VIP\n    }\n    track_script {\n        nms_check_keepalived\n    }\n    notify /etc/nms/scripts/nms-notify-keepalived.sh\n}\n```\n\n----------------------------------------\n\nTITLE: Publishing Instance Group Config: Example JSON Request (POST/PUT)\nDESCRIPTION: This JSON payload is used in a POST or PUT request to publish NGINX configurations to instance groups, including specifying an optional external ID and type for version control. The externalId represents the commit hash. Config contents must be base64 encoded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/publish-configs.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"auxFiles\": {\n        \"files\": [],\n        \"rootDir\": \"/\"\n    },\n    \"configFiles\": {\n        \"rootDir\": \"/etc/nginx\",\n        \"files\": [\n            {\n                \"contents\": \"base64_encoded_contents\",\n                \"name\": \"/etc/nginx/nginx.conf\"\n            }\n        ]\n    },\n    \"updateTime\": \"2023-02-22T17:10:02.677Z\",\n    \"externalId\": \"8acf5aed9d2872b266d2f880cab23a4aa5791d1b\",\n    \"externalIdType\": \"git\"\n}\n```\n\n----------------------------------------\n\nTITLE: Kubernetes HTTPRoute Status Example\nDESCRIPTION: An example status output of an HTTPRoute resource showing that the route has been rejected due to an unsupported HTTP method. This status is reported by NGINX Gateway Fabric after validating the resource. The `Message` field provides details about the validation failure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/resource-validation.md#_snippet_5\n\nLANGUAGE: text\nCODE:\n```\n. . .\nStatus:\n  Parents:\n    Conditions:\n      Last Transition Time:  2023-03-30T22:37:53Z\n      Message:               All rules are invalid: spec.rules[0].matches[0].method: Unsupported value: \"CONNECT\": supported values: \"DELETE\", \"GET\", \"HEAD\", \"OPTIONS\", \"PATCH\", \"POST\", \"PUT\"\n      Observed Generation:   1\n      Reason:                UnsupportedValue\n      Status:                False\n      Type:                  Accepted\n    Controller Name:         gateway.nginx.org/nginx-gateway-controller\n    Parent Ref:\n      Group:         gateway.networking.k8s.io\n      Kind:          Gateway\n      Name:          prod-gateway\n      Namespace:     default\n      Section Name:  http\n```\n\n----------------------------------------\n\nTITLE: Configure SSL Certificates NGINX\nDESCRIPTION: Configures the SSL certificates for the zone synchronization TCP server using `ssl_certificate` and `ssl_certificate_key` directives. Both the certificate and key must be in PEM format. Ensure the paths to the certificate and key files are correct and accessible by the Nginx process. The server also utilizes a resolver for dynamic zone_sync server resolution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n\n    resolver 10.0.0.53 valid=20s;\n\n    server {\n        listen 10.0.0.1:9000 ssl;\n\n        ssl_certificate     /etc/ssl/nginx-1.example.com.server_cert.pem;\n        ssl_certificate_key /etc/ssl/nginx-1.example.com.key.pem;\n\n        zone_sync;\n        zone_sync_server    nginx-cluster.example.com:9000 resolve;\n        #...\n\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Terraform Error with `package_data`\nDESCRIPTION: This snippet demonstrates an error that occurs when specifying a configuration using a `tar.gz` file and the `package_data` directive in Terraform. The error indicates that at least one `config_file` block is required, suggesting an incompatibility between `package_data` and the expected configuration structure. The suggested workaround is to extract the files and use the `config_file` directive instead.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/known-issues.md#_snippet_2\n\nLANGUAGE: text\nCODE:\n```\n│ Error: Insufficient config_file blocks\n│\n│   on main.tf line 105, in resource \"azurerm_nginx_configuration\" \"example\":\n│  105: resource \"azurerm_nginx_configuration\" \"example\" {\n│\n│ At least 1 \"config_file\" blocks are required.\n```\n\n----------------------------------------\n\nTITLE: Metrics API Response Example\nDESCRIPTION: This JSON snippet demonstrates the structure of a typical Metrics API response. It shows how metrics are organized into series, each containing dimensions, timestamps, and values.  The example showcases the `http.request.count` metric with two series differentiated by `nginx_id`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"metrics\":[\n      {\n         \"name\":\"http.request.count\",\n         \"series\":[\n            {\n               \"dimensions\":{\n                  \"instance\":\"instance-name-1\",\n                  \"nginx_id\":\"nginx-id-1\",\n               },\n               \"timestamps\":[\n                  \"2020-12-10T12:00:00Z\"\n               ],\n               \"values\":[\n                  1000\n               ]\n            },\n            {\n               \"dimensions\":{\n                  \"instance\":\"instance-name-2\",\n                  \"nginx_id\":\"nginx-id-2\",\n               },\n               \"timestamps\":[\n                  \"2020-07-01T12:00:00Z\"\n               ],\n               \"values\":[\n                  2000\n               ]\n            }\n         ]\n      }\n   ]\n}\n```\n\n----------------------------------------\n\nTITLE: Creating DevOps Role - JSON\nDESCRIPTION: This JSON snippet defines a role called `devops-role` with specific permissions for an app component, gateway, location, and security strategy. It grants `WRITE` access to the `checkout-component`, `READ` access to the gateway, location and the security strategy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/using-rbac-with-app-security.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\n{\n      \"metadata\": {\n          \"name\": \"devops-role\",\n          \"displayName\": \"devops-role\",\n          \"description\": \"Role for DevOps\"\n      },\n      \"desiredState\": {\n          \"permissions\": [\n              {\n                  \"path\": \"/services/environments/env-name/apps/app-name/components/checkout-component\",\n                  \"access\": \"WRITE\"\n              },\n              {\n                  \"path\": \"/services/environments/env-name/gateways/gateway-name\",\n                  \"access\": \"READ\"\n              },\n              {\n                  \"path\": \"/infrastructure/locations/location-name/\",\n                  \"access\": \"READ\"\n              },\n              {\n                  \"path\": \"/security/strategies/sensitive-app-strategy\",\n                  \"access\": \"READ\"\n              }\n          ]\n      }\n    }\n```\n\n----------------------------------------\n\nTITLE: Listing all tags for NGINX Plus images using curl\nDESCRIPTION: This command uses curl to retrieve the list of available tags for different types of NGINX Plus images from the NGINX Plus private registry. It requires specifying the image type (base, rootless-base, agent, rootless-agent, or modules) and providing the paths to the Nginx repository key and certificate for authentication. The jq command formats the JSON output for readability.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://private-registry.nginx.com/v2/nginx-plus/<nginxplus-image-type>/tags/list --key <nginx-repo.key> --cert <nginx-repo.crt> | jq\n```\n\n----------------------------------------\n\nTITLE: Create YUM Repository File for NGINX App Protect v5\nDESCRIPTION: This snippet creates the `/etc/yum.repos.d/app-protect-x-plus.repo` file, which defines the repository for NGINX App Protect WAF v5. It specifies the repository name, base URL, SSL certificate and key paths, disables GPG checking, and enables the repository. This configuration allows the system to find and install the necessary packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-centos.md#_snippet_0\n\nLANGUAGE: None\nCODE:\n```\n[app-protect-x-plus]\nname=nginx-app-protect repo\nbaseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/8/$basearch/\nsslclientcert=/etc/ssl/nginx/nginx-repo.crt\nsslclientkey=/etc/ssl/nginx/nginx-repo.key\ngpgcheck=0\nenabled=1\n```\n\n----------------------------------------\n\nTITLE: Create CentOS Repository File (Shell)\nDESCRIPTION: This snippet creates a `centos.repo` file in the `/etc/yum.repos.d/` directory with the specified content. This allows pulling dependencies from the CentOS repository if a RHEL subscription is unavailable.  It defines a CentOS 7 repository with a base URL, enabling it, checking the GPG signature and providing the key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\n[centos]\nname=CentOS-7\nbaseurl=http://ftp.heanet.ie/pub/centos/7/os/x86_64/\nenabled=1\ngpgcheck=1\ngpgkey=http://ftp.heanet.ie/pub/centos/7/os/x86_64/RPM-GPG-KEY-CentOS-7\n```\n\n----------------------------------------\n\nTITLE: Disabling Signature in Policy JSON (modifications property)\nDESCRIPTION: This JSON snippet demonstrates disabling an attack signature (ID 200001834) using the `modifications` property. The `modifications` array contains changes applied to the policy after evaluating the `policy` block, providing a generic schema to manipulate any policy element. The `action` is set to `add-or-update` and `enabled` is set to false in the `entityChanges`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/policy-authoring-and-tuning.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"signature_exclude_2\"\n    },\n    \"modifications\": [\n        {\n            \"entityChanges\": {\n                \"enabled\": false\n            },\n            \"entity\": {\n                \"signatureId\": 200001834\n            },\n            \"entityType\": \"signature\",\n            \"action\": \"add-or-update\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Create Rate Limiting SnippetsFilter with no delay using kubectl\nDESCRIPTION: This command applies a YAML definition to create a `SnippetsFilter` resource named `no-delay-rate-limiting-sf` in a Kubernetes cluster. This `SnippetsFilter` configures rate limiting by injecting NGINX configuration snippets into the `http` and `http.server.location` contexts. This snippet includes the `nodelay` setting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_8\n\nLANGUAGE: YAML\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.nginx.org/v1alpha1\nkind: SnippetsFilter\nmetadata:\n  name: no-delay-rate-limiting-sf\nspec:\n  snippets:\n    - context: http\n      value: limit_req_zone \\$binary_remote_addr zone=no-delay-rate-limiting-sf:10m rate=1r/s;\n    - context: http.server.location\n      value: limit_req zone=no-delay-rate-limiting-sf burst=3 nodelay;\nEOF\n```\n\n----------------------------------------\n\nTITLE: AHS Calculation Algorithm - Python\nDESCRIPTION: This Python code snippet demonstrates the algorithm for calculating the Application Health Score (AHS) based on successful request percentage, timely request percentage, and agent availability. It uses thresholds T1 and T2 to determine the satisfaction level of requests based on their P95 request time.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/user-interface/overview.md#_snippet_0\n\nLANGUAGE: python\nCODE:\n```\nsuccessful_req_pct = (nginx.http.request.count - nginx.http.status.5xx) / nginx.http.request.count\n\nif (nginx.http.request.time.pctl95 < T1)\n   timely_req_pct = 1\nelse\n   if (nginx.http.request.time.pctl95 < T2)\n       timely_req_pct = 1 - (nginx.http.request.time.pctl95 - T1) / (T2 - T1)\n   else\n       timely_req_pct = 0\n\nm1 = successful_req_pct\nm2 = timely_req_pct\nm3 = agent_up_pct\n\napp_health_score = m1 * m2 * m3\n```\n\n----------------------------------------\n\nTITLE: Define Service Group for Load Balancing - Citrix ADC\nDESCRIPTION: This configuration defines a service group named 'myapp' in Citrix ADC, specifying HTTP as the protocol. It then binds three backend servers (10.0.0.100, 10.0.0.101, and 10.0.0.102) to the service group, all listening on port 80.  This sets up basic load balancing across these servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\nadd serviceGroup myapp HTTP\nbind serviceGroup myapp 10.0.0.100 80\nbind serviceGroup myapp 10.0.0.101 80\nbind serviceGroup myapp 10.0.0.102 80\n```\n\n----------------------------------------\n\nTITLE: Configuring RPC Over HTTP Location Block for HTTPS Traffic in Nginx\nDESCRIPTION: This snippet configures the location block for RPC Over HTTP ('/rpc/rpcproxy.dll') in the 'server' block for HTTPS traffic in Nginx. It proxies requests to the 'exchange-rpc' upstream, disables buffering for both upload and download, sets the HTTP version to 1.1, disables request buffering, and sets the Connection header to Keep-Alive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_48\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /rpc/rpcproxy.dll {\n    proxy_pass https://exchange-rpc;\n    proxy_buffering off;\n    proxy_http_version 1.1;\n    proxy_request_buffering off;\n    proxy_set_header Connection \"Keep-Alive\";\n}\n```\n\n----------------------------------------\n\nTITLE: Kubernetes API Server Log Example - Bash\nDESCRIPTION: This snippet shows an example from the Kubernetes api-server log indicating a failure to retrieve the OpenAPI spec due to a certificate signed by an unknown authority. This error suggests a race condition during deployment of NGINX Service Mesh where the Spire server fails to communicate its CA. \nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.1.0.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nE0105 10:03:45.159812 1 controller.go:116] loading OpenAPI spec for \"v1alpha1.metrics.smi-spec.io\" failed with: failed to retrieve openAPI spec, http error: ResponseCode: 503, Body: error trying to reach service: x509: certificate signed by unknown authority (possibly because of \"x509: ECDSA verification failure\" while trying to verify candidate authority certificate \"NGINX\")\n```\n\n----------------------------------------\n\nTITLE: Executing the support package script with a custom config file\nDESCRIPTION: This command shows how to run the `support-package.sh` script while specifying a non-default Instance Manager configuration file using the `-c` flag.  This is necessary if the Instance Manager is configured to use a config file other than `/etc/nms/nms.conf`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/support/support-package.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo bash /etc/nms/scripts/support-package.sh -c /your/config.conf\n```\n\n----------------------------------------\n\nTITLE: Install Cookie-Flag Module on Alpine\nDESCRIPTION: This shell script installs the nginx-plus-module-cookie-flag package using apk. It assumes that the apk package manager is available and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/cookie-flag.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-cookie-flag\n```\n\n----------------------------------------\n\nTITLE: TLS Handshake Error Log Example - Bash\nDESCRIPTION: This snippet shows an example of a TLS handshake error that may appear in the smi-metrics Pod logs after deploying NGINX Service Mesh.  This error indicates a potential race condition during deployment where the Spire server fails to communicate its certificate authority (CA) to dependent resources. \nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.1.0.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\necho: http: TLS handshake error from :: remote error: tls: bad certificate\n```\n\n----------------------------------------\n\nTITLE: Example Output for Nginx Configuration Test\nDESCRIPTION: This is the expected output from the command `nginx -t` if the Nginx configuration file has no syntax errors. This output indicates that the configuration is valid and can be safely reloaded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/brotli.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Install NJS Module on Debian/Ubuntu\nDESCRIPTION: This command installs the NGINX JavaScript module (njs) on Debian and Ubuntu based systems. It requires root privileges and assumes that the NGINX Plus repository is properly configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/ping-identity.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nsudo apt install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Excluding Nginx Log Files\nDESCRIPTION: Shows how to exclude specific Nginx log files from metric collection in the agent.conf file. This is useful when multiple log files contain the same request, preventing metrics from being counted more than once.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/configuring-amplify-agent.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\n[nginx]\nexclude_logs=/var/log/nginx/app1/*,access-app1-*.log,sender1-*.log\n```\n\n----------------------------------------\n\nTITLE: Changing Directory to Root Directory on Backend Servers\nDESCRIPTION: This shell command changes the current directory to the user's root directory, which is /home/ubuntu in this guide. This is a preliminary step before creating directories and files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/route-53-global-server-load-balancing.md#_snippet_3\n\nLANGUAGE: Shell\nCODE:\n```\ncd /home/ubuntu\n```\n\n----------------------------------------\n\nTITLE: Deploy Tea and Soda Applications - Kubernetes YAML\nDESCRIPTION: This Kubernetes YAML deploys the tea and soda applications, each including a deployment with a single replica and a service that exposes the application on port 80. The applications are based on the nginxdemos/nginx-hello:plain-text image.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: tea\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: tea\n  template:\n    metadata:\n      labels:\n        app: tea\n    spec:\n      containers:\n      - name: tea\n        image: nginxdemos/nginx-hello:plain-text\n        ports:\n        - containerPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: tea\nspec:\n  ports:\n  - port: 80\n    targetPort: 8080\n    protocol: TCP\n    name: http\n  selector:\n    app: tea\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: soda\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: soda\n  template:\n    metadata:\n      labels:\n        app: soda\n    spec:\n      containers:\n      - name: soda\n        image: nginxdemos/nginx-hello:plain-text\n        ports:\n        - containerPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: soda\nspec:\n  ports:\n  - port: 80\n    targetPort: 8080\n    protocol: TCP\n    name: http\n  selector:\n    app: soda\nEOF\n```\n\n----------------------------------------\n\nTITLE: Send Request to Tea Endpoint - Shell\nDESCRIPTION: This snippet uses curl to send a request to the tea endpoint. The `--resolve` flag is used to map `cafe.example.com` to the specified IP address and port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/tea\n```\n\n----------------------------------------\n\nTITLE: Find Nginx Controller Agent User\nDESCRIPTION: This command finds the user ID under which the Nginx Controller Agent service is running. It uses `ps` to list processes and `egrep` to filter for 'agent'. This helps determine if the agent is running as root or a non-root user. Requires the `ps` and `egrep` commands.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-controller.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nps -ef | egrep 'agent'\n```\n\n----------------------------------------\n\nTITLE: Get NGINX Gateway Service Details (AWS)\nDESCRIPTION: This command retrieves information about the `nginx-gateway` service in the `nginx-gateway` namespace. In AWS, instead of a public IP, this command provides the DNS name of the Network Load Balancer (NLB).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/expose-nginx-gateway-fabric.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get svc nginx-gateway -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX and BD processes - Debian and Ubuntu\nDESCRIPTION: These commands verify that the NGINX and BD processes are running. The `ps -ef | grep nginx` and `ps -ef | grep bd` commands list all running processes and filter the output to show only those containing `nginx` or `bd`, confirming that these processes are active.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_27\n\nLANGUAGE: shell\nCODE:\n```\nps -ef | grep nginx\nps -ef | grep bd\n```\n\n----------------------------------------\n\nTITLE: Remove NGINX Service Mesh CRDs\nDESCRIPTION: This command deletes the Custom Resource Definitions (CRDs) associated with the NGINX Service Mesh. It uses a label selector to identify the CRDs that belong to the mesh and removes them from the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/uninstall/uninstall-with-helm.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete crd -l app.kubernetes.io/part-of==nginx-service-mesh\n```\n\n----------------------------------------\n\nTITLE: Install RPM Packages - Bash\nDESCRIPTION: Extracts and installs RPM packages from an archive. This is used for installing external dependencies on RHEL and RPM-based systems. It uses the `tar` command to extract the archive and `rpm` to install the packages.  The `-k` flag with `tar` prevents existing files from being overwritten.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide-deprecated.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ntar -kzxvf nms-dependencies-<linux-distribution>.tar.gz\nsudo rpm -ivh *.rpm\n```\n\n----------------------------------------\n\nTITLE: Update Proxy with Token Cache Duration - Bash\nDESCRIPTION: This command uses the PUT method to update the proxy configuration via the NGINX API.  It sets the token cache duration for the Introspection policy to 10 seconds.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_37\n\nLANGUAGE: bash\nCODE:\n```\nPUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy\n```\n\n----------------------------------------\n\nTITLE: Install cert-manager with GatewayAPI enabled\nDESCRIPTION: Installs cert-manager into the `cert-manager` namespace, enabling the GatewayAPI feature gate and CRDs. This command configures cert-manager to work with Gateway API resources for certificate management.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/integrating-cert-manager.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nhelm install \\\n  cert-manager jetstack/cert-manager \\\n  --namespace cert-manager \\\n  --create-namespace \\\n  --set config.apiVersion=\"controller.config.cert-manager.io/v1alpha1\" \\\n  --set config.kind=\"ControllerConfiguration\" \\\n  --set config.enableGatewayAPI=true \\\n  --set crds.enabled=true\n```\n\n----------------------------------------\n\nTITLE: Fetching OpenID Configuration from Keycloak\nDESCRIPTION: This command fetches the OpenID Connect configuration from Keycloak using curl and formats the output using python's json.tool. The configuration contains URLs for authorization, token, and JWK endpoints, which are required for configuring NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/keycloak.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\n$ curl https://<keycloak-server-address>/auth/realms/master/.well-known/openid-configuration | python -m json.tool\n```\n\n----------------------------------------\n\nTITLE: Shell: Create Attack Signatures Bundle\nDESCRIPTION: This shell command creates a `.tgz` bundle containing the attack signatures files (signatures.bin.tgz, signature_update.yaml, version). This bundle is then uploaded to NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_4\n\nLANGUAGE: Shell\nCODE:\n```\ntar -czvf attack-signatures.tgz signatures.bin.tgz signature_update.yaml version\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Deprecation Warnings Example\nDESCRIPTION: This example shows Kubernetes deprecation warnings related to older API versions used by NGINX Service Mesh dependencies. These warnings indicate that the resources are supported but will not be in an upcoming release.  No immediate action is required.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.0.0.md#_snippet_4\n\nLANGUAGE: plaintext\nCODE:\n```\nW0303 00:12:03.484737   44320 warnings.go:70] apiextensions.k8s.io/v1beta1 CustomResourceDefinition is deprecated in v1.16+, unavailable in v1.22+; use apiextensions.k8s.io/v1 CustomResourceDefinition\n```\n\nLANGUAGE: plaintext\nCODE:\n```\nW0303 00:12:04.996104   44320 warnings.go:70] admissionregistration.k8s.io/v1beta1 ValidatingWebhookConfiguration is deprecated in v1.16+, unavailable in v1.22+; use admissionregistration.k8s.io/v1 ValidatingWebhookConfiguration\n```\n\n----------------------------------------\n\nTITLE: Restart System Configuration\nDESCRIPTION: This command applies the changes made in the `/etc/sysctl.d/k8s.conf` file by reloading the system configuration. This ensures that the network parameters are updated in the running system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nsudo sysctl --system\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration\nDESCRIPTION: This shell command gracefully reloads the NGINX configuration without interrupting existing connections.  This is used to apply changes made to the configuration file, such as loading a new module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/cookie-flag.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Create API Proxy (ACM) - JSON\nDESCRIPTION: The JSON payload for creating an API proxy in API Connectivity Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_19\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"name\": \"test-proxy\",\n  \"version\": \"v1\",\n  \"proxyConfig\": {\n    \"hostname\": \"data-host\",\n    \"ingress\": {\n      \"basePath\": \"/\",\n      \"basePathVersionAppendRule\": \"NONE\"\n    },\n    \"backends\": [\n      {\n        \"serviceName\": \"backend-echo-svc\",\n        \"serviceTargets\": [\n          {\n            \"hostname\": \"192.0.2.4\",\n            \"listener\": {\n              \"enableTLS\": false,\n              \"port\": 10000,\n              \"transportProtocol\": \"HTTP\"\n            }\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Prometheus Query for Server Errors\nDESCRIPTION: This Prometheus query finds all upstream server responses with server-side errors (5xx response codes) for the deployment `productpage-v1` in the namespace `prod`. It uses the `nginxplus_upstream_server_responses` metric and filters by `deployment`, `namespace`, and `code` labels.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_8\n\nLANGUAGE: promQL\nCODE:\n```\nnginxplus_upstream_server_responses{deployment=\"productpage-v1\",namespace=\"prod\",code=\"5xx\"}\n```\n\n----------------------------------------\n\nTITLE: Unzipping nginx-meshctl binary on macOS\nDESCRIPTION: This command extracts the nginx-meshctl binary from the downloaded tar.gz archive. This is a necessary step to access the executable after downloading it.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\ntar -xvf nginx-meshctl_<version>_darwin_amd64.tar.gz nginx-meshctl\n```\n\n----------------------------------------\n\nTITLE: Describe BackendTLSPolicy (Shell)\nDESCRIPTION: This command retrieves and displays the details of the `backend-tls` BackendTLSPolicy object using `kubectl describe`. It shows the policy's specifications, status, and any associated events. This helps confirm that the policy was created and attached successfully to the Gateway.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/securing-backend-traffic.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe backendtlspolicies.gateway.networking.k8s.io\n```\n\n----------------------------------------\n\nTITLE: Accessing gRPC Metadata in Go\nDESCRIPTION: This Go code snippet demonstrates how to retrieve the `Authorization` header (or any metadata) from an incoming gRPC context. The `metadata.FromIncomingContext` function is used to access the metadata, and then `md.Get(\"Authorization\")` is used to retrieve the value associated with the `Authorization` key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/grpc-policies.md#_snippet_1\n\nLANGUAGE: Go\nCODE:\n```\n// GetFeature returns the feature at the given point.\nfunc (s *routeGuideServer) GetFeature(ctx context.Context, point *pb.Point) (*pb.Feature, error) {\nmd, _ := metadata.FromIncomingContext(ctx)\nfmt.Printf(\"Authorization: %+v\\n\", md.Get(\"Authorization\"))\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx Configuration\nDESCRIPTION: This snippet demonstrates how to reload the Nginx configuration. This ensures that any changes made to the Nginx configuration files are applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/configuring-metric-collection.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\n# service nginx reload\n```\n\n----------------------------------------\n\nTITLE: Delete and Recreate Kubernetes Deployment (Bash)\nDESCRIPTION: This snippet demonstrates how to delete and recreate a Kubernetes deployment using the `kubectl delete deployment` and `kubectl create -f` commands. This is typically done after modifying the deployment's YAML configuration file. Requires `kubectl` command-line tool to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-containerized-instances.md#_snippet_8\n\nLANGUAGE: Bash\nCODE:\n```\nkubectl delete deployment hello-node\nkubectl create -f modified_deployment.yaml\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent securely using curl\nDESCRIPTION: This snippet shows how to install NGINX Agent securely using curl. It downloads and executes the installation script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/agent/installation/install-agent-api.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ncurl https://<NIM_FQDN>/install/nginx-agent | sudo sh\n```\n\n----------------------------------------\n\nTITLE: Create Docker Registry Secret in OpenShift\nDESCRIPTION: Creates a Docker registry secret named 'regcred' in the 'nms' project within OpenShift. This secret stores authentication credentials (JWT token as username and 'none' as password) for accessing the private NGINX Docker registry, necessary for pulling NGINX Instance Manager images.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\noc create secret docker-registry regcred \\\n--docker-server=private-registry.nginx.com \\\n--docker-username=<JWT Token> \\\n--docker-password=none \\\n-n nms\n```\n\n----------------------------------------\n\nTITLE: Numeric Field with Validation JSON Schema Example\nDESCRIPTION: This JSON schema defines a numeric field named 'proxyTimeout' with multiple validation criteria, including 'multipleOf', 'minimum', 'maximum', and examples. This allows for input validation based on specified rules and constraints.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/reference/json-schema-reference.md#_snippet_5\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"proxyTimeout\": {\n      \"type\": \"number\",\n      \"multipleOf\": 10,\n      \"minimum\": 10,\n      \"maximum\": 1000,\n      \"examples\": [50, 120, 870]\n    }\n  }\n```\n\n----------------------------------------\n\nTITLE: Querying Metrics API for Multiple Metrics\nDESCRIPTION: This curl command demonstrates querying the Metrics API for multiple metrics simultaneously. The `names` parameter takes a comma-separated list of metric names.  The API returns the last recorded values for each of the specified metrics, and the command requires a valid access token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/metrics?names=nginx.http.request.count,nginx.http.conn.accepted\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Configuring Hostname in agent.conf\nDESCRIPTION: This is an example of how to configure hostname settings in the `/etc/amplify-agent/agent.conf` file. The file uses nginx configuration syntax. Replace 'myhostname1' with the desired hostname.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/faq/nginx-amplify-agent.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\n[credentials]\n..\nhostname = myhostname1\n```\n\n----------------------------------------\n\nTITLE: Expected Nginx signing key fingerprint\nDESCRIPTION: This code block shows the expected output from the gpg command when verifying the Nginx signing key.  It highlights the expected fingerprint value.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-ubuntu.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\npub   rsa2048 2011-08-19 [SC] [expires: 2027-05-24]\n        573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62\nuid                      nginx signing key <signing-key@nginx.com>\n```\n\n----------------------------------------\n\nTITLE: Checking for `--with-debug` Configuration Option\nDESCRIPTION: This command verifies if NGINX was configured with the `--with-debug` option during compilation, which is required for debug logging. It greps the output of `nginx -V` for the specified flag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nnginx -V 2>&1 | grep -- '--with-debug'\n```\n\n----------------------------------------\n\nTITLE: Configuring SMTP Upstream for TCP Load Balancing (Nginx)\nDESCRIPTION: This snippet configures an upstream group for SMTP servers within the 'stream' block. It sets a zone and defines the servers that will be load balanced. The standard SMTP port is 25. Replace the IP addresses with the actual addresses of your CAS servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_26\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'stream' block\nupstream exchange-smtp {\n    zone exchange-smtp 64k;\n    server 10.0.0.237:25; # Replace with IP address of a CAS\n    server 10.0.0.238:25; # Replace with IP address of a CAS\n}\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Plus Package - RPM\nDESCRIPTION: Installs the NGINX Plus package using the RPM package manager. This command is applicable for RHEL, Amazon Linux, CentOS, Oracle Linux, AlmaLinux and Rocky Linux distributions.  The <rpm_package_name> placeholder should be replaced with the actual name of the RPM package file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_47\n\nLANGUAGE: shell\nCODE:\n```\nsudo rpm -ihv <rpm_package_name>\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Instance Manager Repository (Amazon Linux 2)\nDESCRIPTION: Downloads the NGINX Instance Manager repository configuration file for Amazon Linux 2 using wget and places it in the /etc/yum.repos.d directory.  This configures the system to recognize and utilize the NGINX Instance Manager package repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/installation/add-nms-repo.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nms-amazon2.repo\n```\n\n----------------------------------------\n\nTITLE: Test Nginx Configuration\nDESCRIPTION: This shell command tests the Nginx configuration file for syntax errors and ensures that the configuration is valid before reloading Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/xslt.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Backup NGINX Controller Database Script (Step 2 Replacement)\nDESCRIPTION: This bash script backs up the NGINX Controller database to a directory named pgbackup_<timestamp>. It iterates through the common, data, and system databases, using pg_dump to create a backup for each. This script replaces step 2 in the original Backup External Config Database documentation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/apim/apim-release-notes-3.18.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nDATE=$(date +\"%Y%m%d%H%M\")\nmkdir ~/pgbackup_${DATE}\n\nfor db in common data system; do\n  pg_dump -c -C -w -E utf8 -d ${db} -F c -f ~/pgbackup_${DATE}/${db}-${DATE}.backup\ndone\n```\n\n----------------------------------------\n\nTITLE: Loading OpenTelemetry Module in NGINX Configuration (Nginx)\nDESCRIPTION: This configuration adds the `load_module` directive to the NGINX configuration file (`nginx.conf`). This directive instructs NGINX to load the OpenTelemetry module dynamically.  The path to the module varies depending on the operating system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_otel_module.so;\n\nhttp {\n#...\n}\n```\n\n----------------------------------------\n\nTITLE: Config Push Failure Error Message\nDESCRIPTION: Illustrates a configuration push failure error message that occurs when publishing a configuration with an uncompiled WAF policy in Instance Manager 2.13. This message indicates that the aux payload is not ready, preventing the config from being built successfully.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/known-issues.md#_snippet_5\n\nLANGUAGE: text\nCODE:\n```\nConfig push failed - err: failure from multiple instances. Affected placements: instance/70328a2c-699d-3a90-8548-b8fcec15dabd (instance-group: ig1) - err: failed building config payload: config: aux payload /etc/nms/NginxDefaultPolicy.tgz for instance:70328a2c-699d-3a90-8548-b8fcec15dabd not ready aux payload not ready, instance/2e637e08-64b3-36f9-8f47-b64517805e98 (instance-group: ig1) - err: failed building config payload: config: aux payload /etc/nms/NginxDefaultPolicy.tgz for instance:2e637e08-64b3-36f9-8f47-b64517805e98 not ready aux payload not ready\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX FIPS module on SLES\nDESCRIPTION: This shell command sequence refreshes the package list and installs the nginx-plus-module-fips-check package using the zypper package manager on SLES.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/fips.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-fips-check\n```\n\n----------------------------------------\n\nTITLE: Enable NGINX RTMP Module\nDESCRIPTION: This configuration snippet shows how to enable dynamic loading of the NGINX RTMP module using the load_module directive in the main context of the nginx.conf file. It also includes the http block as context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/rtmp.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_rtmp_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Defining volumes in a Dockerfile (Dockerfile)\nDESCRIPTION: This snippet shows how to define volumes in a Dockerfile. This is used to specify which directories in the container should be persistent and shared with the host machine.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_19\n\nLANGUAGE: dockerfile\nCODE:\n```\nVOLUME /usr/share/nginx/html\nVOLUME /etc/nginx\n```\n\n----------------------------------------\n\nTITLE: Example Output of Traffic Metrics\nDESCRIPTION: This shows example output of the `nginx-meshctl top` command, displaying the incoming and outgoing success rates and number of requests for `gateway` and `target-v1-0` deployments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\n$ nginx-meshctl top\nDeployment   Incoming Success  Outgoing Success  NumRequests\ngateway                        100.00%           10\ntarget-v1-0  100.00%                             10\n```\n\n----------------------------------------\n\nTITLE: Generating RSA Key (OpenSSL)\nDESCRIPTION: This command generates an RSA private key without encryption. This key will be packaged in the certificate.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl genrsa -out ~/example.com.key 2048\n```\n\n----------------------------------------\n\nTITLE: Install SPNEGO Auth Module (Amazon Linux 2, CentOS, Oracle Linux, RHEL)\nDESCRIPTION: Installs the `nginx-plus-module-auth-spnego` package using yum on Amazon Linux 2, CentOS, Oracle Linux, and RHEL operating systems. The script first updates the package manager's cache and then installs the specified module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/spnego.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-auth-spnego\n```\n\n----------------------------------------\n\nTITLE: Example: Remove Sidecar Proxy from Deployment 'frontend' (kubectl)\nDESCRIPTION: This example shows how to restart a Kubernetes Deployment named 'frontend' using `kubectl rollout restart` to remove the sidecar proxy injected by NGINX Service Mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/uninstall/uninstall.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nkubectl rollout restart deployment/frontend\n```\n\n----------------------------------------\n\nTITLE: Viewing Full Mesh Configuration with nginx-meshctl - Bash\nDESCRIPTION: This command uses the `nginx-meshctl` command-line tool to display the complete mesh configuration, including runtime-modifiable and installation-set fields. It requires `nginx-meshctl` to be installed and configured to connect to the NGINX Service Mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/api-usage.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl config\n```\n\n----------------------------------------\n\nTITLE: Configuring Hash Session Persistence with $remote_addr Nginx\nDESCRIPTION: This snippet configures session persistence based on the full client IP address using the 'hash' directive. It routes requests based on the hash of the client's IP address to maintain session affinity. This configuration needs to be placed within the 'http' block inside upstream.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_19\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream weblogic {\n    hash $remote_addr;\n    server 192.168.25.33:7001;\n    server 192.168.25.69:7001;\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX worker_rlimit_nofile configuration\nDESCRIPTION: This code snippet shows how to increase the number of file descriptors to resolve the `Too many open files` error message in NGINX App Protect WAF. This involves setting the `worker_rlimit_nofile` directive in the main context of the `nginx.conf` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/troubleshooting-guide/troubleshooting.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\nworker_rlimit_nofile 65535;\n```\n\n----------------------------------------\n\nTITLE: Filtering logs for specific processes\nDESCRIPTION: This command demonstrates how to filter the `nms.log` file using `grep` to view entries belonging to a specific Instance Manager process (nms-core in this example).  The `nms.log` file contains entries for multiple processes, so filtering is often necessary.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/support/support-package.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ncat nms.log | grep 'COR'\n```\n\n----------------------------------------\n\nTITLE: Disable User-Agent Blocking in Nikto Configuration\nDESCRIPTION: This snippet modifies the Nikto configuration file to change the User-Agent header. By commenting out the default User-Agent and replacing it with a generic value, requests from Nikto are no longer blocked solely based on the User-Agent. This is needed to find vulnerabilities in the demo application and not just be blocked by the WAF.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\n# USERAGENT=Mozilla/5.00 (Nikto/@VERSION) (Evasions:@EVASIONS) (Test:@TESTID)\nUSERAGENT=Mozilla/5.00\n```\n\n----------------------------------------\n\nTITLE: Stopping and Starting NGINX with Debug Binary (NGINX Plus)\nDESCRIPTION: This command stops the standard NGINX service and starts the NGINX debug binary, enabling debugging capabilities in NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nservice nginx stop && service nginx-debug start\n```\n\n----------------------------------------\n\nTITLE: Enable NGINX Plus API Location\nDESCRIPTION: This snippet configures the /api/ location block within the NGINX Plus configuration to enable the API.  It sets `api write=on` to allow write operations, restricts access to localhost (127.0.0.1), and denies all other requests for enhanced security. The intended use is for allowing metric collection via the NGINX Plus API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/use-cases/monitoring/enable-nginx-plus-api.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\n# Enable the /api/ location with appropriate access control\n# to use the NGINX Plus API.\n#\nlocation /api/ {\n    api write=on;\n    allow 127.0.0.1;\n    deny all;\n}\n```\n\n----------------------------------------\n\nTITLE: Enable OpenShift in values.yaml\nDESCRIPTION: This YAML snippet shows the configuration required in `values.yaml` to enable OpenShift support.  The `openshift.enabled` setting must be set to `true` when deploying on OpenShift.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\nopenshift:\n  enabled: true\n```\n\n----------------------------------------\n\nTITLE: Application Health Score Calculation\nDESCRIPTION: This code snippet represents the algorithm for calculating the Application Health Score (AHS) using NGINX metrics. It calculates the score based on the percentage of successful requests, timely requests, and agent availability, using thresholds (T1 and T2) for request time to determine the satisfaction ratio. The snippet shows how the timely_req_pct is calculated based on request time and the T1/T2 thresholds, which is then incorporated into the final AHS calculation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/dashboards/application-health-score.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nsuccessful_req_pct = (nginx.http.request.count - nginx.http.status.5xx) / nginx.http.request.count\n\nif (nginx.http.request.time.pctl95 < T1)\n   timely_req_pct = 1\nelse\n   if (nginx.http.request.time.pctl95 < T2)\n       timely_req_pct = 1 - (nginx.http.request.time.pctl95 - T1) / (T2 - T1)\n   else\n       timely_req_pct = 0\n\nm1 = successful_req_pct\nm2 = timely_req_pct\nm3 = agent_up_pct\n\napp_health_score = m1 * m2 * m3\n```\n\n----------------------------------------\n\nTITLE: Apply Kubernetes configuration\nDESCRIPTION: Applies a Kubernetes configuration file using kubectl. This command attempts to create or update resources defined in the specified YAML file in the Kubernetes cluster. Errors will be reported if the configuration is invalid or if there are conflicts with existing resources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/resource-validation.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f coffee-route.yaml\n```\n\n----------------------------------------\n\nTITLE: Load NGINX Instance Manager SELinux Policy\nDESCRIPTION: Loads the SELinux policy module for NGINX Instance Manager and applies it to the system. This enables mandatory access control for NGINX Instance Manager processes. Requires `semodule` and `load_policy` tools to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-selinux.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo semodule -n -i /usr/share/selinux/packages/nms.pp\nsudo /usr/sbin/load_policy\n```\n\n----------------------------------------\n\nTITLE: Enable Certificate Verification for Cluster Instances\nDESCRIPTION: This configuration enables verification of the certificate of another cluster instance by including the `zone_sync_ssl_verify` directive, the `zone_sync_ssl_trusted_certificate` directive to specify the trusted certificate authority, and the `zone_sync_ssl_name` directive to specify the expected name of the certificate. Requires a valid CA certificate.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/runtime-state-sharing.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n  resolver 127.0.0.1:49153 valid=20s;\n\n  server {\n    listen 9000 ssl;\n\n    ssl_certificate     /opt/ssl/server.crt;\n    ssl_certificate_key /opt/ssl/server.key;\n\n    zone_sync;\n    zone_sync_server internal.nginxaas.nginx.com:9000 resolve;\n\n    zone_sync_ssl                     on;\n    zone_sync_ssl_verify              on;\n    zone_sync_ssl_trusted_certificate /opt/ssl/server_ca.pem;\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Sending Traffic via Curl to Secure App\nDESCRIPTION: This command sends a request to the `secure-app` service on the TLS port using `curl`. The `--resolve` flag maps `app.example.com` and port `$GW_TLS_PORT` to the IP address `$GW_IP`. The `--insecure` flag is used because the `secure-app` uses self-signed certificates. It uses `-v` for verbose output of the request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/tls-passthrough.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve app.example.com:$GW_TLS_PORT:$GW_IP https://app.example.com:$GW_TLS_PORT --insecure -v\n```\n\n----------------------------------------\n\nTITLE: API Token Authentication with curl\nDESCRIPTION: This snippet shows how to authenticate an API request using an API token with curl.  The token is passed in the Authorization header. The request lists tenant namespaces for organization plans.  Replace <tenant> with your tenant name and <token-value> with your API token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/api/authentication.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://<tenant>.console.ves.volterra.io/api/web/namespaces \\\n-H \"Authorization: APIToken <token-value>\"\n```\n\n----------------------------------------\n\nTITLE: Disabling Threat Campaign Blocking in NGINX App Protect WAF\nDESCRIPTION: This JSON snippet demonstrates how to disable both alarm and blocking for the Threat Campaign violation in NGINX App Protect WAF. This configuration allows traffic associated with threat campaigns without triggering alarms or blocking requests. It requires NGINX App Protect WAF to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/signature-sets.md#_snippet_9\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"policy_name\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_THREAT_CAMPAIGN\",\n                    \"alarm\": false,\n                    \"block\": false\n                }\n            ]\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Enable and start NGINX Management Suite services\nDESCRIPTION: This command enables and starts all essential NGINX Management Suite services, including nms, nms-core, nms-dpm, nms-ingestion, nms-integrations, and nms-acm. The --now flag ensures that the services are started immediately after being enabled. It configures the services to run as the non-root 'nms' user within the 'nms' group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl enable nms nms-core nms-dpm nms-ingestion nms-integrations nms-acm --now\n```\n\n----------------------------------------\n\nTITLE: Log Illegal Requests in Key-Value Format JSON\nDESCRIPTION: This JSON snippet configures the security log to log only illegal requests in a user-defined key-value format. It specifies a custom format string with placeholders for client IP, client port, request, violations, and signature IDs. The max request size is set to 2000 bytes, and the max message size is 32k.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/logging-overview/security-log.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filter\": {\n        \"request_type\": \"illegal\"\n    },\n    \"content\": {\n        \"format\": \"user-defined\",\n        \"format_string\": \"client_ip=%ip_client%,client_port=%src_port%,request=%request%,violations=%violations%,signature_ids=%sig_ids%\",\n        \"max_request_size\": 2000,\n        \"max_message_size\": \"32k\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Stream Module for mTLS\nDESCRIPTION: This snippet configures the NGINX stream module to proxy requests to the App Protect Enforcer with mTLS enabled. It specifies the client certificate, key, and trusted CA certificate for secure communication. It listens on port 5000 and forwards traffic to the enforcer on port 4431.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n\t    upstream enforcer {\n\t        # Replace with the actual App Protect Enforcer address and port if different\n\t        server 127.0.0.1:4431;\n\t    }\n\n\t    server {\n\t        listen 5000;\n\t        proxy_pass enforcer;\n\t        proxy_ssl_server_name on;\n\t        proxy_timeout 60m;\n\t        proxy_ssl on;\n            proxy_ssl_certificate /etc/ssl/certs/app_protect_client.crt;\n\t\t    proxy_ssl_certificate_key /etc/ssl/certs/app_protect_client.key;\n\t\t    proxy_ssl_trusted_certificate /etc/ssl/certs/app_protect_server_ca.crt;\n\t    }\n\t}\n```\n\n----------------------------------------\n\nTITLE: Get Average Latency Total with curl\nDESCRIPTION: This command retrieves the average `client.request.latency.total` over the last 24 hours from Nginx Controller Analytics. It uses the `AVG` aggregation function. Note that using AVG aggregation on pre-aggregated metrics might not give the expected results, as highlighted in the documentation. Requires a valid session cookie for authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/view-traffic-metrics.md#_snippet_5\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{Controller-FQDN}/api/v1/analytics/metrics?names=AVG(client.request.latency.total)&startTime=now-24h\"\n```\n\n----------------------------------------\n\nTITLE: Configuring Nginx Upstream Block\nDESCRIPTION: This Nginx configuration snippet defines an upstream block named `upstream_app_pool` for load balancing between two application servers.  It configures each server with its internal IP address and enables sticky sessions using a cookie named GCPPersist with an expiration time of 300 seconds. It requires the internal IP addresses of the two application servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nupstream upstream_app_pool {\n    server <internal IP address of nginx-plus-app-1-vm>;\n    server <internal IP address of nginx-plus-app-2-vm>;\n    zone upstream-apps 64k;\n    sticky cookie GCPPersist expires=300;\n}\n```\n\n----------------------------------------\n\nTITLE: Nginx Configuration with App Protect\nDESCRIPTION: This Nginx configuration enables the App Protect module, configures a server listening on 127.0.0.1:8080, and sets up a proxy to handle requests. It defines a location block for the root ('/') that enables App Protect and proxies requests to '/proxy'. Another location block '/proxy' returns a simple HTML response with the requested URI.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/configure-static-location.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n\nhttp {\n    server {\n        listen       127.0.0.1:8080;\n        server_name  localhost;\n\n        location / {\n            app_protect_enable on;\n            proxy_pass    http://127.0.0.1:8080/proxy/$request_uri;\n        }\n\n        location /proxy {\n            default_type text/html;\n            return 200 \"Hello! I got your URI request - $request_uri\\n\";\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure Disallowed Geolocation in App Protect (JSON)\nDESCRIPTION: This JSON snippet shows how to configure disallowed geolocations in an App Protect security policy.  It specifies that requests originating from Israel (countryCode: IL, countryName: Israel) should trigger a `VIOL_GEOLOCATION` violation and be blocked. It also configures the blocking settings for the `VIOL_GEOLOCATION` violation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/disallow-application-use-geolocation.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n \"general\": {\n  \"customXffHeaders\": [],\n  \"trustXff\": true\n },\n \"disallowed-geolocations\" : [\n  {\n   \"countryCode\" : \"IL\",\n   \"countryName\" : \"Israel\"\n  }\n ],\n \"blocking-settings\": {\n  \"violations\": [\n   {\n    \"name\": \"VIOL_GEOLOCATION\",\n    \"alarm\": true,\n    \"block\": true\n   }\n  ]\n }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Controller Agent (agent.conf)\nDESCRIPTION: This snippet adds gRPC configuration options to the `/etc/controller-agent/agent.conf` file on each NGINX Controller Agent. This is a workaround to ensure complete agent upgrade after upgrading NGINX Controller from version 3.9 to NGINX APIM 3.18.1. It defines settings related to gRPC usage and server names for command and metric ingestion.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/apim/apim-release-notes-3.18.1.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\ngrpc = true\ngrpc_common_server_name =\ngrpc_command_server_name = dataplane-manager\ngrpc_metrics_server_name = agent-ingest\n```\n\n----------------------------------------\n\nTITLE: Define Upstream Server Group - Nginx\nDESCRIPTION: This Nginx configuration block defines an upstream server group named `appservers`.  It includes several server directives specifying the backend servers and their associated parameters like weight, fail_timeout, and backup status. This configuration lacks the `zone` directive, which is essential for dynamic configuration with the Nginx Plus API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/dynamic-configuration-api.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    upstream appservers {\n        server appserv1.example.com      weight=5;\n        server appserv2.example.com:8080 fail_timeout=5s;\n        server reserve1.example.com:8080 backup;\n        server reserve2.example.com:8080 backup;\n    }\n\n    server {\n    # Location that proxies requests to the upstream group\n        location / {\n            proxy_pass http://appservers;\n            health_check;\n         }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Forward Error Logs to Remote Syslog\nDESCRIPTION: This snippet configures an Nginx gateway to forward HTML error logs to a remote syslog server. It uses the `error_log` directive within the httpSnippet to define the syslog server address and logging level, enabling centralized error monitoring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-snippets.md#_snippet_7\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"<gateway-name>\"\n    },\n    \"desiredState\": {\n        \"configSnippets\": {\n            \"httpSnippet\": {\n                \"directives\": [\n                    {\n                        \"directive\": \"error_log\",\n                        \"args\": [\"syslog:server=<data-host-name>\", \"debug\"]\n                    }\n                ]\n            }\n        },\n        \"ingress\": {\n            \"uris\": {\n                \"http://example.com:8000\": {}\n            },\n            \"placement\":  {\n                \"instanceRefs\": [\n                    {\n                        \"ref\": \"/infrastructure/locations/unspecified/instances/<instance-name>\"\n                    }\n                ]\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Build NGINX App Protect WAF Compiler Image\nDESCRIPTION: This command builds the NGINX App Protect WAF compiler image using Docker, specifying the path to the Dockerfile and the image tag. It utilizes secrets for handling the client key and certificate securely. The `--no-cache` option ensures that the image is built from scratch, incorporating the latest changes. It also sets platform to `linux/amd64`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker build --no-cache --platform linux/amd64 \\\n    --secret id=nginx-crt,src=nginx-repo.crt \\\n    --secret id=nginx-key,src=nginx-repo.key \\\n    -t waf-compiler-<version-tag>:custom .\n```\n\n----------------------------------------\n\nTITLE: Enable NGINX App Protect WAF Reporting\nDESCRIPTION: This YAML snippet demonstrates how to configure the NGINX Agent to report NGINX App Protect WAF installation information and enable precompiled publication from NGINX Management Suite. It defines the directories the agent can access, enables the necessary extensions, and sets the report interval and precompiled publication setting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_11\n\nLANGUAGE: yaml\nCODE:\n```\n# path to aux file dirs can also be added\nconfig_dirs: \"/etc/nginx:/usr/local/etc/nginx:/usr/share/nginx/modules:/etc/nms:/etc/app_protect\"\n\n# Enable necessary NAP extension\nextensions:\n    - nginx-app-protect\n\nnginx_app_protect:\n  # Report interval for NGINX App Protect details - the frequency the NGINX Agent checks NGINX App Protect for changes.\n  report_interval: 15s\n  # Enable precompiled publication from the NGINX Management Suite (true) or perform compilation on the data plane host (false).\n  precompiled_publication: true\n```\n\n----------------------------------------\n\nTITLE: Backup Custom Resources for Nginx Service Mesh\nDESCRIPTION: This set of commands retrieves and saves custom resources (TrafficSplits, TrafficTargets, HTTPRouteGroups, TCPRoutes, RateLimits, and CircuitBreakers) to YAML files before a manual upgrade.  This allows for the resources to be recreated after the mesh is reinstalled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade-with-helm.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get trafficsplits.split.smi-spec.io -A -o yaml > trafficsplits.yaml\nkubectl get traffictargets.access.smi-spec.io -A -o yaml > traffictargets.yaml\nkubectl get httproutegroups.specs.smi-spec.io -A -o yaml > httproutegroups.yaml\nkubectl get tcproutes.specs.smi-spec.io -A -o yaml > tcproutes.yaml\nkubectl get ratelimits.specs.smi.nginx.com -A -o yaml > ratelimits.yaml\nkubectl get circuitbreakers.specs.smi.nginx.com -A -o yaml > circuitbreakers.yaml\n```\n\n----------------------------------------\n\nTITLE: Granting Sidecar Permissions in OpenShift\nDESCRIPTION: This command adds the `nginx-mesh-sidecar-permissions` SecurityContextConstraint (SCC) to a workload namespace. This allows sidecars injected into workloads within that namespace to operate with the necessary permissions, bypassing OpenShift's default security policies that restrict sidecar injection.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/openshift.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\noc adm policy add-scc-to-group nginx-mesh-sidecar-permissions system:serviceaccounts:<workload-namespace>\n```\n\n----------------------------------------\n\nTITLE: Defining Stop Signal\nDESCRIPTION: This snippet defines the stop signal as SIGQUIT. This signal is used to gracefully shut down the Nginx process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-oracle.md#_snippet_2\n\nLANGUAGE: dockerfile\nCODE:\n```\nSTOPSIGNAL SIGQUIT\n```\n\n----------------------------------------\n\nTITLE: Deploying Target v2.1 (Successful Version) with kubectl\nDESCRIPTION: This command deploys a new, corrected version of the target application, `target-v2.1`, using the configuration defined in `target-v2.1-successful.yaml`. This version is expected to return successful responses. The deployment is performed using `kubectl apply`, creating the necessary pods and services in the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f target-v2.1-successful.yaml\n```\n\n----------------------------------------\n\nTITLE: NGINX Service Mesh Pod Status Example\nDESCRIPTION: This example demonstrates output from `kubectl -n nginx-mesh get pods` showing pods in an `ErrImagePull` or `ImagePullBackOff` status. This status indicates a problem pulling the container image, often due to an invalid `--registry-server` and/or `--image-tag` during NGINX Service Mesh deployment. The workaround involves correcting the `--registry-server` and `--image-tag` arguments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.2.0.md#_snippet_1\n\nLANGUAGE: plaintext\nCODE:\n```\nNAME                                  READY   STATUS                  RESTARTS   AGE\ngrafana-5647fdf464-hx9s4              1/1     Running                 0          64s\njaeger-6fcf7cd97b-cgrt9               1/1     Running                 0          64s\nnats-server-6bc4f9bbc8-jxzct          0/2     Init:ImagePullBackOff   0          2m9s\nnginx-mesh-api-84898cbc67-tdwdw       0/1     ImagePullBackOff        0          68s\nnginx-mesh-metrics-55fd89954c-mbb25   0/1     ErrImagePull            0          66s\nprometheus-8d5fb5879-fgdbh            1/1     Running                 0          65s\nspire-agent-47t2w                     1/1     Running                 1          2m49s\nspire-agent-8pnch                     1/1     Running                 1          2m49s\nspire-agent-qtntx                     1/1     Running                 0          2m49s\nspire-server-0                        2/2     Running                 0          2m50s\n```\n\n----------------------------------------\n\nTITLE: Create a Gateway (YAML)\nDESCRIPTION: This YAML configuration defines a Gateway resource in Kubernetes. The gateway uses the `nginx` gateway class and listens on port 80 for HTTP traffic with a hostname of `*.example.com`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nmetadata:\n  name: gateway\nspec:\n  gatewayClassName: nginx\n  listeners:\n    - name: http\n      port: 80\n      protocol: HTTP\n      hostname: \"*.example.com\"\nEOF\n```\n\n----------------------------------------\n\nTITLE: Kube-apiserver Configuration (Existing Cluster)\nDESCRIPTION: This YAML snippet shows the configuration to be added to the `/etc/kubernetes/manifests/kube-apiserver.yaml` file for existing kubeadm clusters. It configures the kube-apiserver to use Service Account Token Volume Projection by setting the `service-account-api-audiences`, `service-account-issuer`, and `service-account-signing-key-file` flags. Modifying this file will cause the API server to restart.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/kubeadm.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\nspec:\n  containers:\n  - command:\n    - kube-apiserver\n    - --service-account-api-audiences=api\n    - --service-account-issuer=api\n    - --service-account-signing-key-file=/etc/kubernetes/pki/sa.key\n```\n\n----------------------------------------\n\nTITLE: Set Up Non-Local IP Address Binding\nDESCRIPTION: These commands configure the system to support non-local IP address bindings. The first command adds the `net.ipv4.ip_nonlocal_bind=1` setting to `/etc/sysctl.conf`, and the second command applies the new settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/ha-data-plane.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\necho \"net.ipv4.ip_nonlocal_bind=1\" | sudo tee -a /etc/sysctl.conf\nsudo sysctl -p\n```\n\n----------------------------------------\n\nTITLE: NGINX Service Mesh Re-deployment Command\nDESCRIPTION: This example shows the commands to remove and re-deploy NGINX Service Mesh. This workaround can resolve issues where the Spire server fails to communicate its certificate authority (CA) to dependent resources during deployment, causing TLS errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.0.0.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl remove\nnginx-meshctl deploy ...\n```\n\n----------------------------------------\n\nTITLE: Example HTTP Redirect Response (Text)\nDESCRIPTION: This is an example HTTP response showing a 302 redirect and the Location header, which indicates the new URL to which the client is redirected. This verifies that the HTTPRoute is working as intended.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_8\n\nLANGUAGE: text\nCODE:\n```\nHTTP/1.1 302 Moved Temporarily\n..\nLocation: http://cafe.example.com:8080/organic\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Management Suite Helm Chart\nDESCRIPTION: This command upgrades the NGINX Management Suite deployment using Helm. It sets the admin password hash, specifies the path to the `values.yaml` file, and optionally the chart version.  Replace `<path-to-your-values.yaml>` with the path to your values.yaml file. Replace `YourPassword123#` with a secure password.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/deploy-api-connectivity-manager.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nhelm upgrade -n nms --set nms-hybrid.adminPasswordHash=$(openssl passwd -6 'YourPassword123#') nms nginx-stable/nms -f <path-to-your-values.yaml> [--version <nms-chart-version>] --wait\n```\n\n----------------------------------------\n\nTITLE: gRPC Client Stream Definition (protobuf)\nDESCRIPTION: Defines a gRPC service method where the client sends a stream of `HelloRequest` messages to the server and receives a single `HelloResponse` message in return. This example uses the protobuf syntax to define the service interface.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/how-to/bidirectional-configuration.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nrpc LotsOfGreetings(stream HelloRequest) returns (HelloResponse);\n```\n\n----------------------------------------\n\nTITLE: Extract Installer Package - Bash\nDESCRIPTION: This command extracts the NGINX Controller installer package. It uses the `tar` command with the `xzf` options, which means extract, gzip decompress, and use file. The resulting files are placed in the current directory. Before running the update script on a cluster node, download the updated installer package and extract it to the node.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/resilient-cluster-private-cloud.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\ntar xzf controller-installer-<version>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Update Package Repository (CentOS, RHEL) - Bash\nDESCRIPTION: This command updates the package repository using `yum update` and installs the `nginx-plus-module-metrics` package. This command is suitable for CentOS and RHEL based systems. It requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-plus-advanced-metrics.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum update\nsudo yum install nginx-plus-module-metrics\n```\n\n----------------------------------------\n\nTITLE: GDB Script for Extracting Debug Log From Memory\nDESCRIPTION: This GDB script extracts the debugging log from the Nginx memory buffer and saves it to a file named `debug_log.txt` in the current directory.  It iterates through the log writers to find the memory writer, then dumps the memory contents.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nset $log = ngx_cycle->log\nwhile $log->writer != ngx_log_memory_writer\n    set $log = $log->next\nend\nset $buf = (ngx_log_memory_buf_t *) $log->wdata\ndump binary memory debug_log.txt $buf->start $buf->end\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Plus and App Protect WAF (Dockerfile)\nDESCRIPTION: This Dockerfile snippet installs NGINX Plus and the NGINX App Protect WAF v5 module on an Ubuntu base image. It uses secrets for authentication and configures the necessary repositories and keys.  It also sets up symbolic links for access and error logs and cleans up the APT package manager after installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-plus/build-ubuntu.md#_snippet_0\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Supported OS_CODENAME's are: focal/jammy\nARG OS_CODENAME=jammy\n\n# Base image\nFROM ubuntu:${OS_CODENAME}\n\n# Install NGINX Plus and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    apt-get update \\\n    && apt-get install -y \\\n       apt-transport-https \\\n       lsb-release \\\n       ca-certificates \\\n       wget \\\n       gnupg2 \\\n       ubuntu-keyring \\\n    && wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key | \\\n       gpg --dearmor | tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null \\\n    && gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg \\\n    && printf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n       https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | \\\n       tee /etc/apt/sources.list.d/nginx-plus.list \\\n    && printf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n       https://pkgs.nginx.com/app-protect-x-plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | \\\n       tee /etc/apt/sources.list.d/nginx-app-protect.list \\\n    && wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx \\\n    && apt-get update \\\n    && DEBIAN_FRONTEND=\"noninteractive\" apt-get install -y app-protect-module-plus \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log \\\n    && apt-get clean \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Expose port\nEXPOSE 80\n\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Keepalive Policy Status Example (Text)\nDESCRIPTION: This is the expected output from the `kubectl describe` command, confirming that the keepalive policy is accepted. It includes the status conditions and ancestor information for the Gateway.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_16\n\nLANGUAGE: text\nCODE:\n```\nStatus:\n  Ancestors:\n    Ancestor Ref:\n      Group:      gateway.networking.k8s.io\n      Kind:       Gateway\n      Name:       gateway\n      Namespace:  default\n    Conditions:\n      Last Transition Time:  2025-01-07T20:06:55Z\n      Message:               Policy is accepted\n      Observed Generation:   1\n      Reason:                Accepted\n      Status:                True\n      Type:                  Accepted\n    Controller Name:         gateway.nginx.org/nginx-gateway-controller\nEvents:                      <none>\n```\n\n----------------------------------------\n\nTITLE: Defining Proxy Cache Path in NGINX\nDESCRIPTION: This configuration sets up a local disk directory for caching and allocates shared memory for storing cache keys and metadata. The proxy_cache_path directive defines the cache directory and memory zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_20\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nproxy_cache_path /tmp/NGINX_cache/ keys_zone=backcache:10m;\n```\n\n----------------------------------------\n\nTITLE: Verify bd_agent Process (Shell)\nDESCRIPTION: This command uses `ps -ef` to list all running processes and then `grep` to filter the output and show only processes related to `bd_agent`. This verifies that the `bd_agent` is running. This is only needed when using Controller ADC Agent 3.20.1 or Controller APIM Agent 3.19.2\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nps -ef | grep bd_agent\n```\n\n----------------------------------------\n\nTITLE: Example metric definitions response (JSON)\nDESCRIPTION: This JSON represents a sample response from the Azure Monitor API when retrieving metric definitions. It shows the `id`, `resourceId`, `namespace`, and `name` (value and localizedValue) of a metric definition.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/monitoring/enable-monitoring.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"value\": [\n   \t...\n      {\n        \"id\": \"/subscriptions/12345678-abcd-98765432-abcdef012345/resourceGroups/my-nginx-rg/providers/NGINX.NGINXPLUS/nginxDeployments/my-nginx-dep/providers/microsoft.insights/metricdefinitions/Nginx Connections Statistics/nginx.conn.current\",\n        \"resourceId\": \"/subscriptions/12345678-abcd-98765432-abcdef012345/resourceGroups/my-nginx-rg/providers/NGINX.NGINXPLUS/nginxDeployments/my-nginx-deployment\",\n        \"namespace\": \"NGINX Connections Statistics\",\n        \"name\": {\n          \"value\": \"nginx.conn.current\",\n          \"localizedValue\": \"nginx.conn.current\"\n        },\n        ...\n      },\n   \t...\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Backup NGINX Controller Cluster Configuration Bash\nDESCRIPTION: This command backs up the NGINX Controller cluster configuration and encryption keys. The backup file is saved as `/opt/nginx-controller/cluster-config.tgz`.  It relies on the `helper.sh` script located in `/opt/nginx-controller/`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-cluster-config.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh cluster-config save\n```\n\n----------------------------------------\n\nTITLE: Hugo Shortcode: Embed GitHub Code\nDESCRIPTION: This snippet illustrates the usage of the `ghcode` shortcode to embed a single file directly from a GitHub repository. The shortcode takes the raw GitHub URL of the file as its parameter, enabling easy inclusion of code examples.\nSOURCE: https://github.com/nginx/documentation/blob/main/CONTRIBUTING_DOCS.md#_snippet_6\n\nLANGUAGE: Markdown\nCODE:\n```\n{{< ghcode \"<https://raw.githubusercontent.com/some-repository-file-link>\" >}}\n```\n\n----------------------------------------\n\nTITLE: Retrieve metric values via Azure Monitor API (Bash)\nDESCRIPTION: This `curl` command retrieves metric values for a specified metric and namespace over a given time range, with specified aggregation and interval parameters.  It requires an authorization token, subscription ID, resource group, deployment name, metric namespace, metric name, timespan, aggregation type, and interval.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/monitoring/enable-monitoring.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\ncurl --request GET --header \"Authorization: Bearer $TOKEN\" \"https://management.azure.com/subscriptions/12345678-abcd-98765432-abcdef012345/resourceGroups/my-nginx-rg/providers/NGINX.NGINXPLUS/nginxDeployments/my-nginx-dep/providers/microsoft.insights/metrics?metricnamespace=nginx%20connections%20statistics&metricnames=nginx.conn.current&timespan=2024-03-27T20:00:00Z/2024-03-27T20:10:00Z&aggregation=Average&interval=PT5M&api-version=2024-02-01\"\n```\n\n----------------------------------------\n\nTITLE: Example JSON Output from AD FS Configuration\nDESCRIPTION: This JSON snippet represents an abridged version of the OpenID Connect configuration retrieved from AD FS. It highlights the authorization, JWK, and token endpoints. These endpoints are essential for configuring NGINX Plus as a relying party.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/active-directory-federation-services.md#_snippet_5\n\nLANGUAGE: json\nCODE:\n```\n{\n ...\n   \"authorization_endpoint\": \"https://<ADFS-server-address>/oidc/adfs/auth\",\n   ...\n   \"jwks_uri\": \"https://<ADFS-server-address>/oidc/adfs/certs\",\n   ...\n   \"token_endpoint\": \"https://<ADFS-server-address>/oidc/adfs/token\",\n ...\n}\n```\n\n----------------------------------------\n\nTITLE: Starting NGINX and WAF Services with Docker Compose (Shell)\nDESCRIPTION: Starts the NGINX and WAF services using Docker Compose. It navigates to the directory containing the docker-compose.yml file and then executes the `docker compose up -d` command to start the services in detached mode. This command assumes Docker Compose is installed and configured on the system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_10\n\nLANGUAGE: Shell\nCODE:\n```\nsudo docker compose up -d\n```\n\n----------------------------------------\n\nTITLE: Bash Command to Download Installation Script\nDESCRIPTION: This command downloads the NGINX Agent installation script from a specified URL, bypassing SSL certificate verification. This script is then used to install the NGINX Agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\ncurl -k https://<NGINX-INSTANCE-MANAGER-FQDN>/install/nginx-agent > install.sh\n```\n\n----------------------------------------\n\nTITLE: Clean up Rate Limit Resources\nDESCRIPTION: This command deletes the client deployments and the rate limit configuration from the cluster. It removes the resources defined in 'client-v1.yaml', 'client-v2.yaml', and 'ratelimit-rules.yaml'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_16\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete -f client-v1.yaml -f client-v2.yaml -f ratelimit-rules.yaml\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Management Suite Helm Chart using Helm (Bash)\nDESCRIPTION: These commands add the NGINX stable Helm repository, update the local repository cache, download the NGINX Management Suite Helm chart, and extract the chart archive. This prepares the chart for running the support package script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/support/k8s-support-package.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nhelm repo add nginx-stable https://helm.nginx.com/stable\nhelm repo update\nhelm pull nginx-stable/nms\ntar zxvf nms-<version>.tgz\n```\n\n----------------------------------------\n\nTITLE: Check usage acknowledgment status - F5 REST API (curl)\nDESCRIPTION: This `curl` command checks the status of the usage acknowledgment from F5. It uses the report ID obtained from the previous step. Requires JWT for authorization.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\ncurl --location 'https://product.apis.f5.com/ee/v1/entitlements/telemetry/bulk/status/<report-id>' \\\n--header \"Authorization: Bearer $(cat /path/to/jwt-file)\"\n```\n\n----------------------------------------\n\nTITLE: Update Helm Repositories\nDESCRIPTION: Updates the local Helm chart repository cache to ensure that the user has the latest information about available charts. This is important to do after adding a new repository, or periodically to keep up-to-date.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nhelm repo update\n```\n\n----------------------------------------\n\nTITLE: Install NGINX RTMP Module on FreeBSD\nDESCRIPTION: This shell script updates the package repositories and installs the nginx-plus-module-rtmp package using pkg.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/rtmp.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-rtmp\n```\n\n----------------------------------------\n\nTITLE: Example Output of cat (BACKUP)\nDESCRIPTION: Example output of the `cat` command showing the node is in BACKUP state.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_8\n\nLANGUAGE: none\nCODE:\n```\nSTATE=BACKUP\n```\n\n----------------------------------------\n\nTITLE: Check Controller Agent Service Status (systemctl)\nDESCRIPTION: This command checks the status of the controller-agent.service using systemctl.  It displays information about whether the service is running, stopped, or has encountered errors.  This is the first step in troubleshooting a failed NGINX Controller instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-instances.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl status controller-agent.service\n```\n\n----------------------------------------\n\nTITLE: Configuring Hostname\nDESCRIPTION: Explains how to manually set the hostname in the agent.conf file if the agent fails to determine it automatically. A valid hostname is required for the agent to start. Redefining the hostname creates a new monitoring object in the Amplify UI.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/configuring-amplify-agent.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\n[credentials]\n..\nhostname = myhostname1\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Signing Key - Shell\nDESCRIPTION: Verifies the downloaded NGINX signing key file by displaying its fingerprint. The command uses gpg to check the key's fingerprint without actually importing it, ensuring the downloaded key is the correct one before importing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\ngpg --with-fingerprint --dry-run --quiet --no-keyring --import --import-options import-show /tmp/nginx_signing.key\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Signing Key\nDESCRIPTION: Downloads the NGINX signing key from the specified URL and adds it to the system's keyring, allowing the system to verify the authenticity of NGINX packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-debian.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nwget -qO - https://cs.nginx.com/static/keys/nginx_signing.key | gpg --dearmor | \\\nsudo tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null\n```\n\n----------------------------------------\n\nTITLE: Restore Embedded Config Database (Latest Backup) (Bash)\nDESCRIPTION: This command restores the embedded NGINX Controller configuration database from the latest automated backup using the `helper.sh` script. The `backup restore` subcommand without a filename argument restores from the latest available backup.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh backup restore\n```\n\n----------------------------------------\n\nTITLE: NGINX Reload Command\nDESCRIPTION: This command reloads the NGINX configuration without restarting the server. This is used to apply configuration changes made to the NGINX configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: OAS Server URL Templating (JSON)\nDESCRIPTION: This snippet shows server URL templating in an OpenAPI Specification (OAS) object.  The `url` property uses placeholders `{server}` and `{version}`, which are defined in the `variables` section.  Each placeholder in the URL must correspond to a defined variable for validation to succeed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/publish-api-proxy.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"url\": \"https://{server}.example.com/api/{version}\",\n    \"variables\": {\n      \"version\": {\n        \"default\": \"v1\"\n      },\n      \"server\": {\n        \"default\": \"staging\"\n      }\n    }\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Secret Example - YAML\nDESCRIPTION: This Kubernetes Secret example shows the required fields for providing custom certificates to NGINX Instance Manager, including `tls.crt`, `tls.key`, and `ca.pem`. These fields should contain base64-encoded certificate, key, and CA data, respectively.  This is specified within the values.yaml for the `nms-hybrid.apigw.tlsSecret` parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/frequently-used-helm-configs.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nkind: Secret\nmetadata:\n   name: apigw-tls\ntype: kubernetes.io/tls\ndata:\n   tls.crt: |\n      <base64-encoded-certificate>\n   tls.key: |\n      <base64-encoded-key>\n   ca.pem: |\n      <base64-encoded-ca>\n```\n\n----------------------------------------\n\nTITLE: Download and Extract Keycloak\nDESCRIPTION: This shell script downloads a specific version of Keycloak, extracts the tarball, and then removes the tarball.  It uses `curl` to download the Keycloak tarball from the GitHub releases page and `tar` to extract the contents.  Requires `curl` and `tar` to be installed. It also removes the downloaded archive after extraction.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_3\n\nLANGUAGE: Shell\nCODE:\n```\nKEYCLOAK_VERSION=19.0.3\n\ncurl -L -o keycloak-${KEYCLOAK_VERSION}.tar.gz \\\nhttps://github.com/keycloak/keycloak/releases/download/${KEYCLOAK_VERSION}/keycloak-${KEYCLOAK_VERSION}.tar.gz\ntar -zxf keycloak-${KEYCLOAK_VERSION}.tar.gz\nrm -rf keycloak-${KEYCLOAK_VERSION}.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Configuring the Server Block for the Application\nDESCRIPTION: This snippet configures the NGINX server block for the application being protected by OIDC. It listens on port 443 (HTTPS), specifies the server name (`demo.example.com`), and configures the SSL certificate and key. A `location` block is defined that proxies requests to the backend application running on `http://127.0.0.1:8080`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/okta.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n\n    server {\n        listen      443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate     /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n            # ...\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Update Security Policy via REST API using PUT\nDESCRIPTION: This snippet demonstrates updating a security policy by overwriting the existing version using a `PUT` request to the NGINX Instance Manager REST API. It requires a valid access token, the policy's UID, and the updated policy definition in JSON format, sent as the request body.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_4\n\nLANGUAGE: Shell\nCODE:\n```\ncurl -X PUT https://{{NIM_FQDN}}/api/platform/v1/security/policies/<policy-uid> \\\n    -H \"Authorization: Bearer <access token>\" \\\n    --Content-Type application/json \\\n    -d @update-xss-policy.json\n```\n\n----------------------------------------\n\nTITLE: NGINX config template archive structure\nDESCRIPTION: This illustrates the required directory structure for a `.tar.gz` archive to be successfully imported as a config template in NGINX Instance Manager. Each template should reside in its own directory, including template files (.tmpl), JSON schemas (.json), and a `meta.json` file for metadata.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/how-to/manage-nginx-configs-with-templates.md#_snippet_1\n\nLANGUAGE: text\nCODE:\n```\n<archive-name>.tar.gz\n│\n├── <template-name>/\n│   ├── <template-files>.tmpl\n│   ├── <validation-files>.json\n│   └── meta.json\n│\n├── <another-template-name>/\n│   ├── <template-files>.tmpl\n│   ├── <validation-files>.json\n│   └── meta.json\n│\n└── ...\n```\n\n----------------------------------------\n\nTITLE: Create Gateway and HTTPRoute for the application\nDESCRIPTION: Creates a Gateway and HTTPRoute resource to route traffic to the 'coffee' application. The Gateway listens on port 80, and the HTTPRoute routes traffic for the 'cafe.example.com' hostname and '/coffee' path to the 'coffee' service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_11\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nmetadata:\n  name: cafe\nspec:\n  gatewayClassName: nginx\n  listeners:\n  - name: http\n    port: 80\n    protocol: HTTP\n---\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: coffee\nspec:\n  parentRefs:\n  - name: cafe\n  hostnames:\n  - \"cafe.example.com\"\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /coffee\n    backendRefs:\n    - name: coffee\n      port: 80\nEOF\n```\n\n----------------------------------------\n\nTITLE: Loading NGINX App Protect Images\nDESCRIPTION: These commands load the previously saved NGINX App Protect images from the tar archives into the local Docker environment. This is the counterpart to the `docker save` command, and it's used to import the images in environments where they were transferred as tar files. This step is crucial in offline environments to make the images available to Docker.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\ndocker load -i nginx-app-protect-5.tar\ndocker load -i waf-enforcer.tar\ndocker load -i waf-config-mgr.tar\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Server Block for OIDC Protection\nDESCRIPTION: This configuration sets up a server block in Nginx to listen on port 443 with SSL enabled. It defines a location that is protected by Entra ID OIDC using the `auth_oidc` directive and forwards the requests to an internal application.  It also passes OIDC claims as headers to the application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/entra-id.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n\n    # ...\n\n    server {\n        listen      443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate     /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n\n            # ...\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Filter Events with Predicates (curl)\nDESCRIPTION: This example demonstrates filtering events using predicates with the `filter` parameter. The example filters for events where category is 'agent' or 'nms', level is 'debug', and count is greater than 100. Replace `<NMS_FQDN>` and `<access token>` accordingly. Dimensions and values are case-sensitive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"https://<NMS_FQDN>/api/platform/v1/analytics/events?filter=category IN ('agent','nms') AND level='debug' AND count > 100\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Mount NFS Volumes (Shell)\nDESCRIPTION: These commands mount NFS (Network File System) shares to specific directories on the host machine. This allows the Docker containers to access data stored on the NFS server. Replace `<<nfs-ip>>` with the actual IP address of the NFS server. Ensure the directories `/mnt/nfs_share/clickhouse` and `/mnt/nfs_share/data` exist on the host system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\n~$ sudo mount -t nfs <<nfs-ip>>:/mnt/nfs_share/clickhouse /mnt/nfs_share/clickhouse\n~$ sudo mount -t nfs <<nfs-ip>>:/mnt/nfs_share/data /mnt/nfs_share/data\n```\n\n----------------------------------------\n\nTITLE: Install NGINX App Protect WAF v5 Package (Ubuntu)\nDESCRIPTION: This set of commands updates the APT package list and installs the 'app-protect-module-plus' package from the configured repositories. `sudo apt-get update` refreshes the package index, ensuring the latest available versions are known. `sudo apt-get install app-protect-module-plus` then installs the specified package along with any required dependencies, requiring administrative privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-ubuntu.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get update\nsudo apt-get install app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Pass OIDC Claims as Headers (Nginx)\nDESCRIPTION: This snippet passes OIDC claims extracted from the ID token as headers to the backend application. It uses the `proxy_set_header` directive to set the `sub`, `email`, and `name` headers with the corresponding OIDC claim values. The backend application can then use these headers to identify the authenticated user.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/ping-identity.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc ping;\n\n     proxy_set_header sub   $oidc_claim_sub;\n     proxy_set_header email $oidc_claim_email;\n     proxy_set_header name  $oidc_claim_name;\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Clone Nginx OpenID Connect Repository\nDESCRIPTION: This shell command demonstrates how to clone the nginx-openid-connect GitHub repository. This repository contains necessary scripts and configuration files for integrating NGINX Plus with OneLogin for OpenID Connect.\nIt is a prerequisite to configure NGINX as an OpenID connect client.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/onelogin.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\ngit clone https://github.com/nginxinc/nginx-openid-connect.git\n```\n\n----------------------------------------\n\nTITLE: Add nginx User to nginx-agent Group\nDESCRIPTION: This command adds the `nginx` user to the `nginx-agent` group using `usermod`.  The `-a` option appends the user to the group, and the `-G` option specifies the group. `sudo` is required for administrative privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configure-nginx-agent-group.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo usermod -a -G nginx-agent nginx\n```\n\n----------------------------------------\n\nTITLE: Delete the NGINX Service Mesh Namespace\nDESCRIPTION: This command deletes the `nginx-mesh` namespace and all resources within it, including the PersistentVolumeClaim used by Spire.  This should be done after uninstalling the helm chart and deleting the CRDs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/uninstall/uninstall-with-helm.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete namespace nginx-mesh\n```\n\n----------------------------------------\n\nTITLE: Create vSphere Location with NGINX Controller API (JSON)\nDESCRIPTION: This JSON payload is used to create a Location within NGINX Controller, grouping NGINX Plus instances by their physical location on vSphere.  It specifies the datacenter and folder within vSphere where the instances will reside, and references the previously created vSphere Integration. Replace dc1 and v_test with your actual vSphere datacenter and folder name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/add-vsphere-instance.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"metadata\": {\n    \"name\": \"my-v-location\"\n  },\n  \"desiredState\": {\n    \"type\": \"VSPHERE_LOCATION\",\n    \"datacenter\": \"dc1\",\n    \"folder\": \"v_test\",\n    \"integrationRef\": {\n      \"ref\": \"/api/v1/platform/integrations/my-v-integration\"\n    }\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Verify Vault Token using curl\nDESCRIPTION: This bash command uses `curl` to verify that the created Vault token is working correctly. It sends a request to the Vault API's `token/lookup-self` endpoint with the token retrieved from 'periodic_token.txt'. The output is then parsed using `jq` to display the token's data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-vault.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncurl --header \"X-Vault-Token: $(cat periodic_token.txt)\" \\\n  $VAULT_ADDR/v1/auth/token/lookup-self | jq .data\n```\n\n----------------------------------------\n\nTITLE: Internal Route Ingress Annotation\nDESCRIPTION: Adds the annotation `nsm.nginx.com/internal-route: \"true\"` to an Ingress resource to define an internal route.  This designates the route as accessible only from within the mesh, not from the public internet.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nnsm.nginx.com/internal-route: \"true\"\n```\n\n----------------------------------------\n\nTITLE: Get Pods Status\nDESCRIPTION: This snippet retrieves the status of the deployed pods using `kubectl get pods`. This allows verification that the destination service's pods are running correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get pods\nNAME                                 READY   STATUS    RESTARTS   AGE\ndest-svc-69f4b86fb4-r8wzh            2/2     Running   0          2m\n```\n\n----------------------------------------\n\nTITLE: Describe RateLimit Resource (Bash)\nDESCRIPTION: This bash command uses kubectl to describe a RateLimit resource.  It's useful for checking for misconfiguration events, such as UpsertRateLimitFailed, that indicate issues with the rate limit policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/smi-traffic-policies.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nkubectl describe ratelimit <rate limit name>\n```\n\n----------------------------------------\n\nTITLE: Tag NGINX Agent Docker Image\nDESCRIPTION: Tags the pulled NGINX Agent Docker image with a simpler name (nginx-agent) for easier reference in subsequent commands.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ndocker tag docker-registry.nginx.com/nginx/agent:mainline nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Configure Default Health Check - Citrix ADC\nDESCRIPTION: This configures a default HTTP health check in Citrix ADC. It adds a load balancing monitor named 'httphealth' which sends an HTTP HEAD request to the root path ('/') and expects a response code of 200. It then binds this monitor to the 'myapp' service group, ensuring that the backend servers are regularly checked for health.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_8\n\nLANGUAGE: none\nCODE:\n```\nadd lb monitor httphealth HTTP -respCode 200 -httpRequest \"HEAD /\"\nbind serviceGroup myapp -monitorName httphealth\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Ingress Resource (YAML)\nDESCRIPTION: This YAML configuration defines an Ingress resource that creates an internal route to the `target-v1-0` service in the `legacy` namespace. The `nsm.nginx.com/internal-route: \"true\"` annotation indicates that this is an internal route. The `host` field specifies the hostname that should be used to access the service.  Important: `ingressClassName` is required for Kubernetes v1.18.0 or greater.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_11\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: target-internal-route\n  namespace: legacy\n  annotations:\n    nsm.nginx.com/internal-route: \"true\"\nspec:\n  # ingressClassName: nginx # use only with k8s version >= 1.18.0\n  tls:\n  rules:\n  - host: target-v1-0.legacy\n    http:\n      paths:\n      - path: /\n        pathType: Exact\n        backend:\n          service:\n            name: target-v1-0\n            port:\n              number: 80\n```\n\n----------------------------------------\n\nTITLE: Test API Proxy\nDESCRIPTION: This command tests the newly created API Proxy to verify it is functioning correctly.  A custom header and dummy JSON body are included in the request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_20\n\nLANGUAGE: bash\nCODE:\n```\nPOST https://192.0.2.4/my/test/api\nHEADERS:\n   X-NGINX-Test: true\n```\n\n----------------------------------------\n\nTITLE: Example: Overriding Inherited Permissions JSON Configuration\nDESCRIPTION: This example demonstrates how to override inherited permissions in Nginx Controller. It sets READ access at the /services/environments/ level and then overrides it with NONE access specifically for /services/environments/test. Requests to /services/environments/test will be denied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-roles.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n     \"access\": \"READ\",\n     \"path\": \"/services/environments/\"\n},\n{\n     \"access\": \"NONE\",\n     \"path\": \"/services/environments/test\"\n}\n```\n\n----------------------------------------\n\nTITLE: Build Nginx Image (Shell)\nDESCRIPTION: This shell command builds a Docker image named mynginx_image1 using the Dockerfile in the current directory. The period (.) specifies the build context as the current directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_21\n\nLANGUAGE: shell\nCODE:\n```\ndocker build -t mynginx_image1 .\n```\n\n----------------------------------------\n\nTITLE: Start Developer Portal Service\nDESCRIPTION: Starts the `nginx-devportal.service` using `systemctl`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start nginx-devportal.service\n```\n\n----------------------------------------\n\nTITLE: Updating Nginx PID and Temporary Paths\nDESCRIPTION: This snippet shows the essential fields in the `nginx.conf` file that need to be updated to point to writable volumes. This is crucial for Nginx to function correctly in a Kubernetes environment with a read-only file system. The updated paths typically reside under the /tmp directory which has been mounted as a writable volume.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/nap-k8s-readonly-paths.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\npid        /tmp/nginx.pid;\n...\nhttp {\n...\n    # Temporary directories for kubernetes \"readonlyfilesystem\"\n    client_body_temp_path /tmp/nginx-client-body;\n    proxy_temp_path       /tmp/nginx-proxy;    \n    fastcgi_temp_path     /tmp/nginx-fastcgi;    \n    uwsgi_temp_path       /tmp/nginx-uwsgi;    \n    scgi_temp_path        /tmp/nginx-scgi;\n...\n}\n```\n\n----------------------------------------\n\nTITLE: JSON Request for Uploading Policy\nDESCRIPTION: This JSON payload represents the structure required to upload a custom security policy to NGINX Instance Manager. The `content` field should contain the base64-encoded policy from the previous step.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_18\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"metadata\": {\n    \"name\": \"ignore-xss-example\",\n    \"displayName\": \"Ignore cross-site scripting example\",\n    \"description\": \"Security policy that intentionally ignores cross-site scripting\"\n  },\n  \"content\": \"<base64-encoded-policy>\"\n}\n```\n\n----------------------------------------\n\nTITLE: Delete Kubernetes Namespace using kubectl\nDESCRIPTION: This command deletes a Kubernetes namespace. This is suggested as a workaround before deploying NGINX Service Mesh if the target namespace already exists and is empty. Ensure you replace `<namespace>` with the actual namespace name you wish to delete.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.0.0.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete namespace <namespace>\n```\n\n----------------------------------------\n\nTITLE: Verifying NS1 Traffic Redistribution after Marking Instance Down\nDESCRIPTION: This command uses `nslookup` to query the DNS record for `nginxgslb.cf` after marking the US instance down and waiting for the TTL to expire. This checks if the DNS record now returns the IP address of the next nearest NGINX Plus instance, verifying the traffic redistribution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\n$ nslookup nginxgslb.cf\n\nServer:     10.10.100.102\nAddress:    10.10.100.102#53\n\nNon-authoritative answer:\nName:\tnginxgslb.cf\nAddress: 10.10.10.2\n```\n\n----------------------------------------\n\nTITLE: Stream Upstream Response Time\nDESCRIPTION: Describes the 'plus.stream.upstream.response.time' metric, which provides the average time to receive the last byte of data from an upstream stream server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_28\n\nLANGUAGE: none\nCODE:\n```\nType:        timer, integer\nDescription: Average time to receive the last byte of data.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Determine Site Returned by NS1 via nslookup\nDESCRIPTION: This snippet uses the `nslookup` command to determine which IP address NS1 is returning for a given domain. It queries a DNS server to resolve the domain name and outputs the corresponding IP address. This allows verification of traffic routing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\n$ nslookup nginxgslb.cf\n\nServer:     10.10.100.102\nAddress:    10.10.100.102#53\n\nNon-authoritative answer:\nName:\tnginxgslb.cf\nAddress: 10.10.10.1\n```\n\n----------------------------------------\n\nTITLE: Setting KUBECONFIG Environment Variable (export)\nDESCRIPTION: This command sets the `KUBECONFIG` environment variable to specify the path to the Kubernetes configuration file. This is necessary if the root user does not have default access to the Kubernetes cluster. Replace `/etc/kubernetes/admin.conf` with the correct path.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nKUBECONFIG=/etc/kubernetes/admin.conf\n```\n\n----------------------------------------\n\nTITLE: Complete Citrix ADC Configuration\nDESCRIPTION: This complete Citrix ADC configuration sets up SSL, load balancing, session persistence, and health checks. It includes adding an SSL certificate, configuring a virtual server with cookie-based persistence, defining a service group, binding backend servers, configuring a health check, and binding the monitor to the service group and the service group to the virtual server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_12\n\nLANGUAGE: none\nCODE:\n```\nadd ssl certKey test.crt -cert test.crt -key test.key\nadd lb vserver myssl SSL 10.0.0.98 443 -persistenceType COOKIEINSERT -timeout 60 -cookieName mysession\nbind ssl vserver myssl -certkeyName test.crt\nadd serviceGroup myapp HTTP\nbind serviceGroup myapp 10.0.0.100 80\nbind serviceGroup myapp 10.0.0.101 80\nbind serviceGroup myapp 10.0.0.102 80\nadd lb monitor httphealth HTTP -respCode 200 -httpRequest \"HEAD /\"\nbind serviceGroup myapp -monitorName httphealth\nbind lb vserver mysslvserver myapp\n```\n\n----------------------------------------\n\nTITLE: Pushing a Docker image to a private registry\nDESCRIPTION: This command pushes a Docker image to your private registry. Replace <my-docker-registry> with the path to your private registry and <version-tag> with the appropriate tag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ndocker push <my-docker-registry>/nginx-plus/base:<version-tag>\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Instance Manager services\nDESCRIPTION: This command restarts the NGINX Instance Manager platform services using systemctl.  This is necessary after upgrading to apply the changes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nms\n```\n\n----------------------------------------\n\nTITLE: Ignoring Timeout Errors During NGINX Controller Cluster Upgrade\nDESCRIPTION: This snippet shows the error message that may appear when upgrading the third node of an NGINX Controller cluster. The message indicates a timeout while waiting for services to scale up. The documentation states that these warnings can be safely ignored as the services will continue to scale up in the background.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.2.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\nWhile waiting for nats-streaming-cluster to scale up, the operation did not complete before timing out.\n```\n\n----------------------------------------\n\nTITLE: Example Output of ip addr show\nDESCRIPTION: This is an example output from the `ip addr show` command, showing that the VIP (192.168.100.150) is assigned to the interface `eth0` of the primary node (centos7-1).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state\n     UP qlen 1000\n    link/ether 52:54:00:33:a5:a5 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.100.100/24 brd 192.168.122.255 scope global dynamic eth0\n       valid_lft 3071sec preferred_lft 3071sec\n    inet 192.168.100.150/32 scope global eth0\n       valid_lft forever preferred_lft forever\n```\n\n----------------------------------------\n\nTITLE: Checking Kubernetes resources status\nDESCRIPTION: This shell command retrieves information about pods and services in the current Kubernetes namespace. It's used to verify that the 'coffee' pod and service have been successfully created and are running.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/https-termination.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get pods,svc\n```\n\n----------------------------------------\n\nTITLE: Run Restore Script (Shell)\nDESCRIPTION: Runs the k8s-restore.sh script to restore NGINX Management Suite from a backup.  Requires root access and specifies the Kubernetes configuration file and backup archive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\nsudo KUBECONFIG=/etc/kubernetes/admin.conf ./k8s-restore.sh -i k8s-backup-<timestamp>.tar.gz -r -d\n```\n\n----------------------------------------\n\nTITLE: Get Pods in Default Namespace\nDESCRIPTION: This command retrieves a list of pods running in the `default` namespace. This is used to verify that the coffee and tea pods created from the cafe.yaml file are running as expected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n default get pods\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Gateway Fabric with Helm\nDESCRIPTION: This shell command uninstalls the NGINX Gateway Fabric Helm chart from the Kubernetes cluster. Replace `ngf` with the release name used during the initial installation.  The command targets the `nginx-gateway` namespace.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nhelm uninstall ngf -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration (Demo App)\nDESCRIPTION: This command reloads the Nginx configuration, applying any changes made to the configuration files (e.g., after creating echo.conf).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_7\n\nLANGUAGE: none\nCODE:\n```\n$ sudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Remove Instance Group from Nginx Agent Config (YAML)\nDESCRIPTION: This snippet demonstrates how to remove or comment out the `instance_group` setting in the `/var/lib/nginx-agent/agent-dynamic.conf` file. This is necessary when deleting an instance group from Instance Manager to prevent the agent from re-creating it upon restart.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/manage-instance-groups.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\n#\n# /var/lib/nginx-agent/agent-dynamic.conf\n#\n# Dynamic configuration file for NGINX Agent.\n#\n# The purpose of this file is to track agent configuration\n# values that can be dynamically changed via the API and the agent install script.\n# You may edit this file, but API calls that modify the tags on this system will\n# overwrite the tag values in this file.\n#\n# The agent configuration values that API calls can modify are as follows:\n#    - tags\n#\n# The agent configuration values that the agent install script can modify are as follows:\n#    - instance_group\n\n# instance_group: default\n```\n\n----------------------------------------\n\nTITLE: Edit NginxProxy Configuration\nDESCRIPTION: This command opens the NginxProxy configuration in your default text editor, allowing you to modify its settings, such as the ipFamily field.  This is useful for correcting IP Family Mismatch Errors. Make sure you have kubectl installed and configured to access your Kubernetes cluster. Replace ngf-proxy-config with the name of your NginxProxy resource.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nkubectl edit -n nginx-gateway nginxproxies.gateway.nginx.org ngf-proxy-config\n```\n\n----------------------------------------\n\nTITLE: Install nginx-plus package on FreeBSD\nDESCRIPTION: This command installs the nginx-plus package on FreeBSD using the pkg package manager.  It assumes the nginx-plus.conf file has been downloaded and the /usr/local/etc/pkg.conf file has been updated with the proper SSL settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_15\n\nLANGUAGE: Shell\nCODE:\n```\nsudo pkg install nginx-plus\n```\n\n----------------------------------------\n\nTITLE: Update NGINXaaS Deployment (Azure CLI)\nDESCRIPTION: This command updates an existing NGINXaaS deployment in Azure using the Azure CLI's NGINX extension. It accepts various optional parameters, including those for modifying tags, auto-upgrade profile, diagnostics, identity, location, logging, network profile, scaling properties, and SKU. It also includes generic update parameters like `--add`, `--remove`, and `--set` for complex modifications.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/create-deployment/deploy-azure-cli.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment update [--add]\n                           [--auto-upgrade-profile]\n                           [--deployment-name]\n                           [--enable-diagnostics {0, 1, f, false, n, no, t, true, y, yes}]\n                           [--force-string {0, 1, f, false, n, no, t, true, y, yes}]\n                           [--identity]\n                           [--ids]\n                           [--location]\n                           [--logging]\n                           [--network-profile]\n                           [--no-wait {0, 1, f, false, n, no, t, true, y, yes}]\n                           [--remove]\n                           [--resource-group]\n                           [--scaling-properties]\n                           [--set]\n                           [--sku]\n                           [--subscription]\n                           [--tags]\n                           [--user-profile]\n```\n\n----------------------------------------\n\nTITLE: Static Content Server Configuration\nDESCRIPTION: This Nginx server configuration listens on port 8080 and serves static HTML content.  It defines the root directory as /usr/share/nginx/html and sets index.html and index.htm as the default index files. It also defines a custom error page for 500, 502, 503, and 504 errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/default-conf-hostname.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 8080;\n    server_name localhost;\n\n\n    location / {\n        root /usr/share/nginx/html;\n        index index.html index.htm;\n    }\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page 500 502 503 504 /50x.html;\n    location = /50x.html {\n        root /usr/share/nginx/html;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Setting Git Username via Command Line\nDESCRIPTION: This snippet demonstrates how to configure the Git username associated with commits using the `git config` command. It sets the `user.name` property to a specified value within the Git configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/templates/how-to/guide-how-to.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ngit config user.name \"Dakota Everson\"\n```\n\n----------------------------------------\n\nTITLE: eBPF Connected Log Event JSON\nDESCRIPTION: This JSON snippet represents an eBPF connected event in NGINX App Protect DoS. It indicates that a worker process successfully connected to eBPF maps. The event includes the worker PID, the current mode (operational), and a flag indicating whether the mode has changed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/operation-log.md#_snippet_6\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"event\": \"ebpf_connected\",\n    \"worker_pid\": 4928,\n    \"mode\": \"operational\",\n    \"mode_changed\": true\n}\n```\n\n----------------------------------------\n\nTITLE: Including OpenID Configuration File\nDESCRIPTION: This YAML snippet includes the OpenID configuration file, enabling OIDC in Nginx.  Ensure the file path `/etc/nms/nginx/oidc/openid_configuration.conf` is correct.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_8\n\nLANGUAGE: yaml\nCODE:\n```\n# OIDC -- client configuration uncomment include to enable\ninclude /etc/nms/nginx/oidc/openid_configuration.conf;\n```\n\n----------------------------------------\n\nTITLE: Send POST Request to Microsoft Entra Token Endpoint - Bash\nDESCRIPTION: This snippet illustrates sending a `POST` request to the Microsoft Entra token endpoint to retrieve an access token using client credentials.  The request must include the client ID, client secret, scope, and grant type in the request body.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/microsoft-entra-automation.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nhttps://login.microsoftonline.com/<your-azure-tenant-id>/oauth2/v2.0/token\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Plus OpenTelemetry Module on CentOS, Oracle Linux, and RHEL (Shell)\nDESCRIPTION: This command updates the package repositories and installs the `nginx-plus-module-otel` package on CentOS, Oracle Linux, and RHEL systems. This installs the OpenTelemetry module for NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update  && \\\nsudo yum install nginx-plus-module-otel\n```\n\n----------------------------------------\n\nTITLE: Slab Zone Pages Free Metric\nDESCRIPTION: Describes the 'plus.slab.pages.free' metric, which is a gauge representing the current number of free memory pages in the slab zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_34\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, integer\nDescription: Сurrent number of free memory pages.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Get Pods using kubectl\nDESCRIPTION: This command retrieves the list of pods in the current namespace using kubectl. It is used to verify that the destination server and clients have been deployed successfully.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get pods\n```\n\n----------------------------------------\n\nTITLE: Backing Up Private Key\nDESCRIPTION: Copies the generated private key to a secure backup location. This is crucial for disaster recovery and ensuring the certificate remains usable.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nroot# cp ~/example.com.key secure-dir/example.com.key.backup\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Plus Repository (Ubuntu)\nDESCRIPTION: This command adds the NGINX Plus repository to the system's APT sources. It uses `printf` to generate the repository entry string, including the signed-by option for key verification, the repository URL, the Ubuntu release codename obtained using `lsb_release -cs`, and the repository name 'nginx-plus'. The output is then piped to `sudo tee` to write it to the `/etc/apt/sources.list.d/nginx-plus.list` file, requiring administrative privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-ubuntu.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\nhttps://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | \\\nsudo tee /etc/apt/sources.list.d/nginx-plus.list\n```\n\n----------------------------------------\n\nTITLE: Setting system time manually\nDESCRIPTION: This command sets the system time to a specific date and time. This is used to simulate a time before the certificate expiration date to allow kubelet to start and generate a new certificate.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_21\n\nLANGUAGE: bash\nCODE:\n```\nsudo timedatectl set-time \"2021-08-16 00:00:00\"\n```\n\n----------------------------------------\n\nTITLE: Generating RSA Private Key (OpenSSL)\nDESCRIPTION: This snippet demonstrates how to generate an RSA private key using OpenSSL. It uses the `-des3` option to encrypt the private key with a passphrase for added security.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl genrsa -des3 -out ~/private-key.pem 2048\nGenerating RSA private key\nEnter pass phrase for private-key.pem:\n```\n\n----------------------------------------\n\nTITLE: Configuring Correlation ID header in Nginx\nDESCRIPTION: This snippet configures a correlation ID header in Nginx to track requests across different services. Replace `<correlation-id-header-name>` with the name of the header and `<correlation-id>` with the desired value. A request-correlation-id policy will determine the header name and value, often using $request_id.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-response-headers.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nadd_header `<correlation-id-header-name> <correlation-id> [always]`\n```\n\n----------------------------------------\n\nTITLE: Configure SMTP Settings Bash\nDESCRIPTION: This command configures SMTP settings for Nginx Controller, which may be necessary if the SMTP configuration is affected by the IP address change. It is used to update the SMTP host, port, and email address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/maintenance/changing-ip-address.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nopt/nginx-controller/helper.sh configsmtp <smtp_host> <smtp_port> false <do-not-reply-email>\n```\n\n----------------------------------------\n\nTITLE: Reloading Nginx Configuration\nDESCRIPTION: This command gracefully reloads the Nginx configuration without interrupting service. This applies the changes made to the configuration file without requiring a full restart of the Nginx server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/brotli.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Apply Target v3.0 Deployment\nDESCRIPTION: This bash command applies the `target-v3.0.yaml` configuration file to deploy the target-v3-0 Pod and Service. This is a prerequisite step for A/B testing scenarios where different versions of the application are deployed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_19\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f target-v3.0.yaml\n```\n\n----------------------------------------\n\nTITLE: Build NGINX Gateway Fabric and NGINX images\nDESCRIPTION: This command uses make to build both the NGINX Gateway Fabric and NGINX images. The PREFIX variable allows specifying the registry where the images will be pushed. It requires GNU Make and Docker to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/building-the-images.md#_snippet_1\n\nLANGUAGE: makefile\nCODE:\n```\nmake PREFIX=myregistry.example.com/nginx-gateway-fabric build-prod-images\n```\n\n----------------------------------------\n\nTITLE: Stream Upstream Connection TTFB\nDESCRIPTION: Describes the 'plus.stream.upstream.conn.ttfb' metric, which provides the average time to receive the first byte of data from an upstream stream server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_27\n\nLANGUAGE: none\nCODE:\n```\nType:        timer, integer\nDescription: Average time to receive the first byte of data.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Load Docker Image\nDESCRIPTION: This command loads a Docker image from a `.tar.gz` archive into the Docker image repository. Replace `nms-acm-<version>-img.tar.gz` with the actual name of the downloaded archive file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/deploy-api-connectivity-manager.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ndocker load -i nms-acm-<version>-img.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Configuring Arbitrator IP Address in NGINX\nDESCRIPTION: This snippet demonstrates how to configure the Arbitrator IP address using the `app_protect_dos_arb_fqdn` directive. This directive specifies the FQDN or IP address of the desired Arbitrator.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_17\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_dos_arb_fqdn 192.168.1.10;\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Gateway Fabric Deployment\nDESCRIPTION: This command retrieves the status of pods within the `nginx-gateway` namespace. It's used to verify that NGINX Gateway Fabric has been successfully deployed and is running correctly. It utilizes `kubectl get` to fetch pod information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get pods -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Dumping VRRP Statistics and Data\nDESCRIPTION: This command sends signals to the running `keepalived` process to write the current state to `/tmp/keepalived.stats` and `/tmp/keepalived.data`. Requires `keepalived` version 1.1 or later.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\ncentos7-1 $ service keepalived dump\n```\n\n----------------------------------------\n\nTITLE: Nginx App Protect Module and Proxy Configuration\nDESCRIPTION: This snippet loads the App Protect module and configures two server blocks. The first server listens on 127.0.0.1:8080, enables App Protect, and proxies requests to 127.0.0.1:8081. The second server listens on 127.0.0.1:8081 and proxies requests to 1.2.3.4, enabling `proxy_force_ranges`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/configure-ranges.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n\nhttp {\n\n    server {\n        listen       127.0.0.1:8080;\n        server_name  localhost;\n\n        location / {\n            app_protect_enable on;\n            proxy_pass    http://127.0.0.1:8081$request_uri;\n        }\n    }\n\n    server {\n        listen       127.0.0.1:8081;\n        server_name  localhost;\n\n        location / {\n            proxy_pass http://1.2.3.4$request_uri;\n            proxy_force_ranges on;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent on FreeBSD (PKG)\nDESCRIPTION: This command installs the NGINX Agent package using the pkg package manager on FreeBSD. It assumes that the pkg repository has been properly configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_36\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg install nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Backup NGINX Controller Cluster Configuration (Bash)\nDESCRIPTION: This command backs up the NGINX Controller cluster configuration and encryption keys using the `helper.sh` script. The `cluster-config save` subcommand initiates the backup process, saving the file to `/opt/nginx-controller/cluster-config.tgz`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh cluster-config save\n```\n\n----------------------------------------\n\nTITLE: Configuring Nginx Plus API Location Block\nDESCRIPTION: This snippet configures a location block for the Nginx Plus API.  The `api` directive enables the API within the location. The `allow` and `deny` directives are used to restrict access to the API location, allowing only authorized administrators (in this case, localhost) to access the API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_34\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /api {\n    api write=on;\n    allow 127.0.0.1;\n    deny all;\n}\n```\n\n----------------------------------------\n\nTITLE: Modify /etc/hosts\nDESCRIPTION: Adds an entry to the `/etc/hosts` file to resolve `bookinfo.example.com` to the public IP address of the NGINX Ingress Controller. This allows accessing the Bookinfo application through the defined domain name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-walkthrough.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\n       <INGRESS_CONTROLLER_PUBLIC_IP> bookinfo.example.com\n```\n\n----------------------------------------\n\nTITLE: Shell Command to Restart Docker Compose Containers\nDESCRIPTION: This shell command restarts the Docker Compose containers defined in the `docker-compose.yaml` file. This is required after modifying the `docker-compose.yaml` file to apply the changes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\ndocker compose restart\n```\n\n----------------------------------------\n\nTITLE: Making API Requests with JWT Authentication using curl\nDESCRIPTION: This snippet demonstrates how to make an API request using a JSON Web Token (JWT) for authentication with curl. It sends the JWT in the Authorization header as a Bearer token. Replace `<NMS_FQDN>` with the fully qualified domain name and `<access token>` with the actual JWT.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/about/api-overview.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET \"https://<NMS_FQDN>/api/acm/<API_VERSION>/workspaces/infrastructure\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Add vSphere NGINX Instance to NGINX Controller (JSON)\nDESCRIPTION: This JSON payload adds a vSphere NGINX instance to NGINX Controller using the Instances API endpoint. It references the Instance Template and Location created in previous steps, which defines the configuration and placement of the NGINX instance.  It assumes that a Location and Instance Template named `my-v-location` and `my-v-template` have been previously created.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/add-vsphere-instance.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"metadata\": {\n    \"name\": \"v-inst\"\n  },\n  \"desiredState\": {\n    \"type\": \"VSPHERE_INSTANCE\",\n    \"templateRef\": {\n      \"ref\": \"/infrastructure/locations/my-v-location/instance-templates/my-v-template\"\n    }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Syslog Event Example YAML\nDESCRIPTION: This is an example of an NGINX log event written to an Azure Storage account when using syslog. It demonstrates the modified structure of the `properties` field compared to standard access logs. The `properties` now include fields like `message`, `tag`, `severity`, and `facility` instead of `filePath`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginxaas-azure/logging-analysis-azure-storage.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\n#...\n\"properties\": {\n\t\t\"message\": \"172.92.129.50 - - [16/Jan/2024:18:00:00 +0000] \\\"GET / HTTP/1.1\\\" 200 11232 \\\"-\\\" \\\"curl/8.4.0\\\"\",\n\t\t\"tag\": \"nginx\",\n\t\t\"severity\": \"info\",\n\t\t\"facility\": \"local7\"\n\t},\n#...\n```\n\n----------------------------------------\n\nTITLE: Deploy Gateway with cert-manager annotation\nDESCRIPTION: Defines a Gateway resource with a cert-manager annotation to trigger certificate issuance. Includes HTTP and HTTPS listeners for ACME challenge and secure traffic.  `spec.listeners[1].hostname` field must be updated with the correct domain.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/integrating-cert-manager.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nmetadata:\n  name: gateway\n  annotations: # This is the name of the ClusterIssuer created in the previous step\n    cert-manager.io/cluster-issuer: letsencrypt-prod\nspec:\n  gatewayClassName: nginx\n  listeners:\n  - name: http\n    port: 80\n    protocol: HTTP\n  - name: https\n    # Important: The hostname needs to be set to your domain\n    hostname: \"cafe.example.com\"\n    port: 443\n    protocol: HTTPS\n    tls:\n      mode: Terminate\n      certificateRefs:\n      - kind: Secret\n        name: cafe-secret\n```\n\n----------------------------------------\n\nTITLE: API Response with GroupBy - JSON\nDESCRIPTION: This JSON snippet shows a sample API response for a query using the `groupBy` parameter. The data is grouped by `app` and `alias` dimensions, and the response includes metric values for each group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_14\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"metrics\":[\n      {\n         \"aggr\": \"SUM\",\n         \"name\":\"http.request.count\",\n         \"series\":[\n            {\n               \"dimensions\":{\n                  \"app\":\"app-name\",\n                  \"alias\": \"alias1\"\n               },\n               \"timestamps\":[\n                  \"2020-07-01T12:00:00Z\"\n               ],\n               \"values\":[\n                  1000\n               ]\n            },\n            {\n               \"dimensions\":{\n                  \"app\":\"app-name-2\",\n                  \"component\":\"alias1\"\n               },\n               \"timestamps\":[\n                  \"2020-07-01T12:00:00Z\"\n               ],\n               \"values\":[\n                  2000\n               ]\n            }\n         ]\n      }\n   ],\n   \"queryMetadata\":{\n      \"endTime\":\"2020-07-01T12:00:00.970106672Z\"\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX: Pass OIDC Claims as Headers\nDESCRIPTION: This configuration adds `proxy_set_header` directives to pass OIDC claims as headers to the proxied application. It extracts the 'sub', 'email', and 'name' claims from the ID token returned by Keycloak and sets them as HTTP headers. The application can then use these headers to identify the authenticated user.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/keycloak.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc keycloak;\n\n     proxy_set_header sub   $oidc_claim_sub;\n     proxy_set_header email $oidc_claim_email;\n     proxy_set_header name  $oidc_claim_name;\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: NGINX Access Log Configuration with App Protect DoS Variables\nDESCRIPTION: This example demonstrates how to configure NGINX to log requests and include App Protect DoS variables. It defines a custom log format and applies it to a specific location, including the optional logging condition for rate limiting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/access-log.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    log_format security_dos 'request_time=$request_time client_ip=$remote_addr,'\n                            'request=\"$request\", status=$status,'\n                            'dos_policy=$app_protect_dos_policy_name, dos_protected_object=app_protect_dos_vs_name'\n                            'dos_action=$app_protect_dos_outcome, dos_action_reason=$app_protect_dos_outcome_reason';\n\n    server {\n        location / {\n            set $loggable 1;\n            access_log /var/log/nginx/access.log security_dos if=$loggable;;\n            ...\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Load Balancing with Service Annotations - YAML\nDESCRIPTION: This YAML snippet demonstrates how to configure the load balancing method for a service using annotations in the service's metadata. The `config.nsm.nginx.com/lb-method` annotation specifies the desired load balancing strategy, such as 'random' in this example. The service selects pods with the 'app: MyApp' label and exposes port 80.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/configuration.md#_snippet_6\n\nLANGUAGE: YAML\nCODE:\n```\napiVersion: v1\nkind: Service\nmetadata:\n  name: my-service\n  annotations:\n    config.nsm.nginx.com/lb-method: random\nspec:\n  selector:\n    app: MyApp\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 80\n```\n\n----------------------------------------\n\nTITLE: Kubectl logs ClickHouse pod\nDESCRIPTION: This command retrieves the logs from the `clickhouse-0` pod. The log output indicates a \"Cannot lock file\" error, suggesting another ClickHouse instance is running in the same directory. This is part of the troubleshooting steps for a multi-node NGINX Controller configuration issue.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl logs clickhouse-0\n2021.12.14 14:53:13.631963 [ 1 ] {} <Error> Application: DB::Exception: Cannot lock file /var/lib/clickhouse/status. Another server instance in same directory is already running.\n```\n\n----------------------------------------\n\nTITLE: Modifying Rate Limit Sources (YAML)\nDESCRIPTION: This YAML configuration extends the rate limit policy to include `client-v2` in addition to `client-v1`. The `sources` list now contains both deployments. When multiple sources are present, the rate is evenly distributed among them.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi.nginx.com/v1alpha2\nkind: RateLimit\nmetadata:\n  name: ratelimit-v1\n  namespace: default\nspec:\n  destination:\n    kind: Service\n    name: dest-svc\n    namespace: default\n  sources:\n  - kind: Deployment\n    name: client-v1\n    namespace: default\n  - kind: Deployment\n    name: client-v2\n    namespace: default\n  name: 10rm\n  rate: 10r/m\n```\n\n----------------------------------------\n\nTITLE: Uploading OpenAPI Spec via API\nDESCRIPTION: This JSON payload represents an OpenAPI specification that is sent to the `/api-docs` endpoint. It defines the API's metadata, including the version, title, and license information. The `openapi` field specifies the OpenAPI specification version, and the `paths` field contains the API's endpoint definitions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/publish-api-proxy.md#_snippet_7\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"info\": {\n        \"version\": \"1.0.0\",\n        \"title\": \"Swagger Petstore\",\n        \"license:\" {\n            \"name\": \"MIT\"\n        }\n    },\n    \"openapi\": \"3.0.0\",\n    \"paths\": {...}\n    }\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Persistent Volume and Claim for App Protect Bundles\nDESCRIPTION: This YAML defines a PersistentVolume and PersistentVolumeClaim for storing App Protect bundles. It creates a local PersistentVolume backed by a hostPath, and a PersistentVolumeClaim to request storage from the volume.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: nap5-bundles-pv\n  labels:\n    type: local\nspec:\n  storageClassName: manual\n  capacity:\n    storage: 2Gi\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  hostPath:\n    path: \"/mnt/nap5_bundles_pv_data\"\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: nap5-bundles-pvc\nspec:\n  storageClassName: manual\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 2Gi\n  volumeName: nap5-bundles-pv\n```\n\n----------------------------------------\n\nTITLE: Azure CLI: Get Principal ID of System Assigned Managed Identity\nDESCRIPTION: This code snippet retrieves the principal ID of a system-assigned managed identity using the Azure CLI. It requires the `DEP_NAME` (NGINXaaS deployment name) and `DEP_RESOURCE_GROUP` (resource group name) environment variables to be set. The command queries the Azure nginx deployment service and extracts the `identity.principalId` value.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nmi_principal_id=$(az nginx deployment show --name $DEP_NAME \\\n         --resource-group $DEP_RESOURCE_GROUP \\\n         --query identity.principalId --output tsv)\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX Open Source Repository (Shell)\nDESCRIPTION: This command adds the NGINX Open Source repository to the system's package sources. It constructs a deb line with the repository URL and distribution codename, and then pipes it to the tee command to write it to the nginx.list file. Requires sudo privileges to modify the /etc/apt/sources.list.d directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-ubuntu.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\necho \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\nhttp://nginx.org/packages/mainline/ubuntu `lsb_release -cs` nginx\" | \\\nsudo tee /etc/apt/sources.list.d/nginx.list\n```\n\n----------------------------------------\n\nTITLE: Generate Server Certificate with OpenSSL\nDESCRIPTION: This snippet generates a certificate and key for the App Protect Enforcer (server) using OpenSSL. The certificate is signed by the server's root CA. The certificate and key are stored in `/etc/ssl/certs/` directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nopenssl genpkey -algorithm RSA -out /etc/ssl/certs/app_protect_server.key\nopenssl req -new -key /etc/ssl/certs/app_protect_server.key -out /etc/ssl/certs/app_protect_server_csr.crt -subj \"/O=F5/OU=app-protect/CN=mTLS\"\nopenssl x509 -req -in /etc/ssl/certs/app_protect_server_csr.crt -CA /etc/ssl/certs/app_protect_server_ca.crt -CAkey /etc/ssl/certs/app_protect_server_ca.key -out /etc/ssl/certs/app_protect_server.crt -CAcreateserial\n```\n\n----------------------------------------\n\nTITLE: Configure Docker to interact with F5 Registry\nDESCRIPTION: This snippet configures Docker to interact with the F5 Container Registry by creating a directory for certificates and copying the client certificate and key files. This allows Docker to authenticate and pull images from the private registry.  The user needs to replace `<path-to-your-nginx-repo.crt>` and `<path-to-your-nginx-repo.key>` with the actual paths to their certificate and key files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/setup-docker-registry.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\nsudo mkdir -p /etc/docker/certs.d/private-registry.nginx.com\nsudo cp <path-to-your-nginx-repo.crt> /etc/docker/certs.d/private-registry.nginx.com/client.cert\nsudo cp <path-to-your-nginx-repo.key> /etc/docker/certs.d/private-registry.nginx.com/client.key\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX Helm Repository\nDESCRIPTION: These shell commands add the NGINX stable Helm repository to the local Helm configuration and update the repository list. This allows users to install NGINX Management Suite charts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/devportal-helm-chart.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nhelm repo add nginx-stable https://helm.nginx.com/stable\nhelm repo update\n```\n\n----------------------------------------\n\nTITLE: Create Azure Deployment Group using Azure CLI\nDESCRIPTION: This command recreates the NGINXaaS deployment using the exported ARM template via the Azure CLI.  It requires the subscription ID, resource group name, and the path to the ARM template file. The deployment will be created within the specified resource group and subscription.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/recreate.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\naz deployment group create \\\n    --subscription=<deployment subscription ID> \\\n    --resource-group=<resource group name> \\\n    --template-file=<path to template file>\n```\n\n----------------------------------------\n\nTITLE: Alternative: Disabling core dump size limit\nDESCRIPTION: Alternative method to disable the core dump size limit, using `ulimit` within a subshell, if the `prlimit` command fails. This ensures the limit is disabled for the current shell and any subprocesses.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\nsudo sh -c \"ulimit -c unlimited && exec su $LOGNAME\"\n```\n\n----------------------------------------\n\nTITLE: Create ClusterRoleBinding for NGINX Service Mesh (Bash)\nDESCRIPTION: This command creates a ClusterRoleBinding named `cluster-admin-binding` that grants the Kubernetes user account associated with your Google Cloud account the `cluster-admin` role. This allows NGINX Service Mesh to access resources across all namespaces in your Kubernetes cluster. It requires `kubectl` and `gcloud` to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/gke.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubectl create clusterrolebinding cluster-admin-binding --clusterrole=cluster-admin --user=$(gcloud config  get-value core/account)\n```\n\n----------------------------------------\n\nTITLE: Create coffee and tea example applications using kubectl\nDESCRIPTION: This command applies a YAML file to create the coffee and tea example applications within a Kubernetes cluster using `kubectl`. It retrieves the YAML file from a specified URL on GitHub, targeting a particular version of NGINX Gateway Fabric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_0\n\nLANGUAGE: YAML\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/examples/snippets-filter/app.yaml\n```\n\n----------------------------------------\n\nTITLE: Describe UpstreamSettingsPolicy for Status (Shell)\nDESCRIPTION: This command uses `kubectl describe` to check the status of the `UpstreamSettingsPolicy` named `1m-zone-size`.  It verifies that the policy has been accepted by the NGINX Gateway Fabric controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe upstreamsettingspolicies.gateway.nginx.org 1m-zone-size\n```\n\n----------------------------------------\n\nTITLE: Build Nginx Image with Volumes (Shell)\nDESCRIPTION: This shell command builds a Docker image named mynginx_image2 using the Dockerfile in the current directory. It is assumed the Dockerfile contains VOLUME definitions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_24\n\nLANGUAGE: shell\nCODE:\n```\ndocker build -t mynginx_image2 .\n```\n\n----------------------------------------\n\nTITLE: Describe HTTPRoute ClientSettingsPolicy\nDESCRIPTION: This snippet describes the ClientSettingsPolicy applied to the tea HTTPRoute, verifying its status and confirming that it targets the HTTPRoute.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe clientsettingspolicies.gateway.nginx.org tea-client-settings\n```\n\n----------------------------------------\n\nTITLE: Backend Application Configuration (Nginx)\nDESCRIPTION: This snippet configures a simple backend application that listens on port 8080. It returns a 200 OK response with the authenticated user's full name, email, and subject identifier.  It accesses the headers passed by the reverse proxy (`name`, `email`, `sub`).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/ping-identity.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nserver {\n    listen 8080;\n\n    location / {\n        return 200 \"Hello, $http_name!\\nEmail: $http_email\\nSub: $http_sub\\n\";\n        default_type text/plain;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Shell: Check NGINX Plus Version\nDESCRIPTION: This command is used to verify the NGINX Plus version. It checks if the version is NGINX Plus Release 34 or later, which is a prerequisite for using the OpenID Connect module as described in this guide. The command should be executed in a terminal.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/keycloak.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nnginx -v\n```\n\n----------------------------------------\n\nTITLE: Postpone Initial Usage Reporting in NGINX Plus\nDESCRIPTION: This configuration snippet shows how to postpone the initial usage report enforcement by setting `enforce_initial_report` to `off` within the `mgmt` block in NGINX. This allows a 180-day grace period for setting up usage reporting. After this grace period, NGINX Plus will stop processing traffic if reporting isn't established.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/solutions/about-subscription-licenses.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\n# Modify this directive to start the 180-day grace period for initial reporting.\nmgmt {\n  enforce_initial_report off;\n}\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Developer Portal Service - Bash\nDESCRIPTION: Restarts the `nginx-devportal.service` using `systemctl`. This applies any configuration changes or updates made to the service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-devportal-offline.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx-devportal.service\n```\n\n----------------------------------------\n\nTITLE: NGINX Securing Traffic to Upstream Servers Configuration\nDESCRIPTION: This NGINX configuration snippet demonstrates how to secure traffic to upstream servers by encrypting the traffic between the NGINXaaS deployment and the backend servers. It requires the `proxy_ssl_certificate` and `proxy_ssl_certificate_key` directives to be configured with the paths to the client certificate and key files. The backend server address and port must also be configured to use HTTPS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/certificates.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    upstream backend {\n        server backend1.example.com:8443; # replace with your backend server address and port\n    }\n\n    server {\n        listen 80;\n\n        location / {\n            proxy_pass https://backend;\n            proxy_ssl_certificate /etc/nginx/ssl/client.crt;     # must match the Certificate path\n            proxy_ssl_certificate_key /etc/nginx/ssl/client.key; # must match the Key path\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Update Proxy to Disable Token Cache - Bash\nDESCRIPTION: This command uses the PUT method to update the proxy configuration. It is used to disable token caching.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_40\n\nLANGUAGE: bash\nCODE:\n```\nPUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy\n```\n\n----------------------------------------\n\nTITLE: Configuring Cache-Control header in Nginx\nDESCRIPTION: This snippet configures the Cache-Control header in Nginx to control caching behavior in browsers and shared caches. The 'public, must-revalidate, proxy-revalidate' directives specify that the response can be cached by both the browser and intermediate proxies, and that they must revalidate the cache entry with the origin server before using it.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-response-headers.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nadd_header Cache-Control \"public, must-revalidate, proxy-revalidate\" [always]\n```\n\n----------------------------------------\n\nTITLE: Uninstall Dynamic Module on FreeBSD\nDESCRIPTION: This command uninstalls the specified dynamic module using the pkg package manager. It requires sudo privileges and the correct dynamic module name. The command removes the module package from the system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/uninstall.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg delete <dynamic_module_name>\n```\n\n----------------------------------------\n\nTITLE: Access Nginx Plus Reference Guide Shell\nDESCRIPTION: This command opens the NGINX Plus Reference Guide using the `less` command in the shell. The guide provides information on open source licenses and other relevant details for NGINX Plus users.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus-google-cloud-platform.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nless /usr/share/nginx/html/nginx-modules-reference.pdf\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Amplify Agent for MySQL\nDESCRIPTION: This snippet shows the configuration settings required in the /etc/amplify-agent/agent.conf file to enable MySQL monitoring by NGINX Amplify Agent. It enables the MySQL extension and specifies the connection details such as unix socket, username, and password. The password 'xxxxxx' must match the password set during user creation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/other-metrics.md#_snippet_8\n\nLANGUAGE: plaintext\nCODE:\n```\n[extensions]\n..\nmysql = True\n\n[mysql]\n#host =\n#port =\nunix_socket = /var/run/mysqld/mysqld.sock\nuser = amplify-agent\npassword = xxxxxx\n```\n\n----------------------------------------\n\nTITLE: Bad Actor Detection Shell Example\nDESCRIPTION: This snippet illustrates a 'Bad actor detection' event report from NGINX App Protect DoS. It showcases information regarding newly detected bad actors, including their source IP and associated impact on RPS (Requests Per Second).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/security-log.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ndate_time=\"Apr 29 2021 14:03:01\",\nproduct=\"app-protect-dos\",\nproduct_version=\"23+1.54.1-1.el7.ngx\",\nunit_hostname=\"localhost.localdomain\",\ninstance_id=\"d9a6d8\",\nvs_name=\"example.com/\",\ndos_attack_id=\"1\",\nattack_event=\"Bad actor detection\",\nsource_ip=\"5.5.5.9\",\nimpact_rps=\"30\"\n```\n\n----------------------------------------\n\nTITLE: Restore NGINX Instance Manager (Docker)\nDESCRIPTION: Executes the `nim-restore` script inside the `nim-nim-1` Docker container to restore a backup. Requires specifying the path to the backup file within the container.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\n~$ docker exec nim-nim-1 nim-restore /data/backup/nim-backup-<date>.tgz\n```\n\n----------------------------------------\n\nTITLE: Add Yum Repositories for Dependencies (RHEL - Shell)\nDESCRIPTION: This command enables specific Red Hat Update Infrastructure (RHUI) repositories using `yum-config-manager`.  These repositories provide dependencies needed by NGINX App Protect WAF on RHEL systems. The `REGION` placeholder should be replaced with the appropriate region identifier.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum-config-manager --enable rhui-REGION-rhel-server-optional rhui-REGION-rhel-server-releases rhel-7-server-optional-rpms\n```\n\n----------------------------------------\n\nTITLE: Kubernetes API Server Error Log Example\nDESCRIPTION: This example shows an error log from the Kubernetes api-server. This error indicates a potential issue where the Spire server fails to communicate its certificate authority (CA) to dependent resources during NGINX Service Mesh deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.0.0.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nE0105 10:03:45.159812 1 controller.go:116] loading OpenAPI spec for \"v1alpha1.metrics.smi-spec.io\" failed with: failed to retrieve openAPI spec, http error: ResponseCode: 503, Body: error trying to reach service: x509: certificate signed by unknown authority (possibly because of \"x509: ECDSA verification failure\" while trying to verify candidate authority certificate \"NGINX\")\n```\n\n----------------------------------------\n\nTITLE: Verifying NGINX Service Mesh pod status\nDESCRIPTION: This command retrieves the status of the pods in the nginx-mesh namespace.  The expected output shows all pods in a 'Running' state.  If using OpenShift, additional `spiffe-csi-driver` pods will be visible.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\n$ kubectl get pods -n nginx-mesh\nNAME                                   READY   STATUS    RESTARTS   AGE\nnats-server-84f8b6f669-xszkc           1/1     Running   0          14m\nnginx-mesh-controller-954467945-sc7qh  1/1     Running   0          14m\nnginx-mesh-metrics-57464df46d-qskd2    1/1     Running   0          14m\nspire-agent-92ktv                      1/1     Running   0          15m\nspire-agent-9dbn6                      1/1     Running   0          15m\nspire-agent-z5cq6                      1/1     Running   0          15m\nspire-server-0                         2/2     Running   0          15m\n```\n\n----------------------------------------\n\nTITLE: Filter Events by Start Time (curl)\nDESCRIPTION: This example demonstrates how to filter events based on a start time.  It uses a GET request with the `startTime` query parameter. Replace `<NMS_FQDN>` and `<access token>` accordingly. The timestamp must be in ISO 8601 format.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"https://<NMS_FQDN>/api/platform/v1/analytics/events?startTime=2022-03-19T08:00:00.000000000Z\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Create HTTPRoutes for coffee and tea applications using kubectl\nDESCRIPTION: This command applies a YAML file to create HTTPRoutes for the coffee and tea applications within a Kubernetes cluster using `kubectl`. It retrieves the YAML file from a specified URL on GitHub, targeting a particular version of NGINX Gateway Fabric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_2\n\nLANGUAGE: YAML\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/examples/snippets-filter/httproutes.yaml\n```\n\n----------------------------------------\n\nTITLE: Defining Shared Memory Zone for Health Checks in Nginx Plus\nDESCRIPTION: This snippet defines a shared memory zone named `backend` of size 64k for the `backend` upstream group. This zone is used to store the configuration of the upstream group and enables worker processes to share counters for tracking server responses.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-health-check.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    upstream backend {\n        zone backend 64k;\n        server backend1.example.com;\n        server backend2.example.com;\n        server backend3.example.com;\n        server backend4.example.com;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure REST API permissions for roles\nDESCRIPTION: This snippet demonstrates how to add permissions to a custom role using the NGINX Controller REST API's `/platform/roles` endpoint. It includes setting READ access for `/api/v1/services/errorsets` and `/api/v1/security/identity-providers`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_11\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"path\": \"/api/v1/services/errorsets\",\n  \"access\": \"READ\"\n},\n{\n  \"path\": \"/api/v1/security/identity-providers\",\n  \"access\": \"READ\"\n}\n```\n\n----------------------------------------\n\nTITLE: Describe Kubernetes Ingress Resource (Bash)\nDESCRIPTION: This command retrieves detailed information about a Kubernetes Ingress resource named `target-internal-route` in the `legacy` namespace. It helps verify that the Ingress resource has been created correctly and to inspect its configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nkubectl -n legacy describe ingress target-internal-route\n```\n\n----------------------------------------\n\nTITLE: Delete Namespace and Deployment\nDESCRIPTION: This command deletes the `legacy` namespace and the `egress-driver` deployment, removing the deployed resources. It uses `kubectl delete` to remove the resources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_16\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete ns legacy\nkubectl delete deploy egress-driver\n```\n\n----------------------------------------\n\nTITLE: Remove NGINX Service Mesh from specified namespace\nDESCRIPTION: This command removes the NGINX Service Mesh from a specific namespace specified by the --namespace flag.  It demonstrates how to target a namespace other than the default (nginx-mesh) for removal. Manual cleanup of deployments is still required.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl remove --namespace my-namespace\n```\n\n----------------------------------------\n\nTITLE: Send Request to Echo Server API Proxy (POST)\nDESCRIPTION: This code snippet demonstrates sending a POST request to the echo server API proxy after configuring the OAuth2 Introspection policy. The request includes an Authorization header with a JWT token. This triggers the proxy to introspect the token and forward configured claims as headers to the backend.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_49\n\nLANGUAGE: bash\nCODE:\n```\nPOST https://192.0.2.4/my/test/api\nHEADERS:\n  Authorization: 'Bearer <JWT_token>'\n```\n\n----------------------------------------\n\nTITLE: Restoring API Connectivity Manager Data (restore.sh) - Shell\nDESCRIPTION: This snippet from `restore.sh` checks if the API Connectivity Manager service (nms-acm) is active. If it is active, it displays an error message and exits.  It then calls the `restore-acm.sh` script to restore the API Connectivity Manager data. The code requires `systemctl`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nACM_ACTIVE=$(systemctl is-active --quiet nms-acm)\nIS_ACM_ACTIVE=$?\nif [ $IS_ACM_ACTIVE -eq 0 ]; then\n    echo \"You need to stop the required NGINX Management Suite\n        services before running the restore script.\"\n    echo \"Please ensure the following nms service is stopped:\"\n    echo \"nms-acm\"\n    exit 1\nfi\n```\n\nLANGUAGE: shell\nCODE:\n```\n./restore-acm.sh\n```\n\n----------------------------------------\n\nTITLE: Installing yum-utils on Amazon Linux/Oracle Linux/RHEL\nDESCRIPTION: This snippet installs yum-utils, a collection of tools for managing yum repositories, on Amazon Linux, Oracle Linux, and RHEL. This is a prerequisite for using repotrack to download packages and their dependencies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_27\n\nLANGUAGE: script\nCODE:\n```\nsudo dnf install yum-utils\n```\n\n----------------------------------------\n\nTITLE: Updating App Protect DoS (RedHat/CentOS)\nDESCRIPTION: These commands are used to update the App Protect DoS solution on RedHat or CentOS based systems. It stops the Nginx service, installs the app-protect-dos package using yum, and then starts the Nginx service. Requires `sudo`, `service`, `yum`, and `systemctl`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo service nginx stop\nsudo yum install app-protect-dos\nsudo systemctl start nginx\n```\n\n----------------------------------------\n\nTITLE: Downloading Nginx Status Configuration via Curl\nDESCRIPTION: This shell script navigates to the Nginx configuration directory and uses the curl command to download a specific Nginx configuration file (status.conf) for live activity monitoring from a remote GitHub repository. The downloaded configuration file is then saved locally with the name `status.conf`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ncd /etc/nginx/conf.d/\ncurl -o status.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/status.conf\n```\n\n----------------------------------------\n\nTITLE: Customize gRPC Status Codes with ACL IP Policy JSON\nDESCRIPTION: This JSON configuration shows how to customize gRPC status codes using the `acl-ip` policy. It defines a policy that allows access from a specific IP address (`10.0.0.2`) and sets a custom gRPC status code (13) if the access is denied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/grpc-policies.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policies\": {\n        \"acl-ip\": [\n            {\n                \"action\": {\n                    \"allow\": [\"10.0.0.2\"],\n                    \"grpcStatusCode\": 13\n                }\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: SELinux: Parse audit log for NGINX exceptions (Shell)\nDESCRIPTION: This command parses the audit log for entries related to nginx and uses `audit2allow` to generate a SELinux module that would allow the identified exceptions. It helps identify the specific SELinux rules needed to allow NGINX App Protect DoS to function correctly after putting SELinux in permissive mode and triggering the error.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/troubleshooting-guide/how-to-troubleshoot.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ngrep nginx /var/log/audit/audit.log | audit2allow -m nginx\n```\n\n----------------------------------------\n\nTITLE: Create UpstreamSettingsPolicy for Zone Size (YAML)\nDESCRIPTION: This YAML configuration creates an `UpstreamSettingsPolicy` named `1m-zone-size`. It targets both the `coffee` and `tea` services and sets the upstream zone size to 1 megabyte (`1m`). This policy limits the memory allocated for each upstream zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.nginx.org/v1alpha1\nkind: UpstreamSettingsPolicy\nmetadata:\n  name: 1m-zone-size\nspec:\n  targetRefs:\n  - group: core\n    kind: Service\n    name: tea\n  - group: core\n    kind: Service\n    name: coffee\n  zoneSize: 1m\nEOF\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS Resolver and Resolve Parameter in Nginx\nDESCRIPTION: This snippet configures the DNS resolver and the `resolve` parameter for dynamic reconfiguration of upstream servers. The `resolver` directive specifies the IP address of the DNS server. The `resolve` parameter in the `server` directive instructs Nginx to periodically re-resolve the domain name with DNS, enabling dynamic updates to the upstream server list.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_35\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nresolver <IP-address-of-DNS-server>;\n\nupstream nodejs {\n    zone nodejs 64k;\n    server example.com resolve;\n}\n```\n\n----------------------------------------\n\nTITLE: Shell: Upload Certificate via REST API\nDESCRIPTION: This curl command uploads the NGINX repository certificate and key to NGINX Instance Manager using the REST API. It uses a POST request with the certificate data provided in a JSON file. Replace `<access token>` and `{{NIM_FQDN}}` with actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\ncurl -X POST 'https://{{NIM_FQDN}}/api/platform/v1/certs' \\\n  --header \"Authorization: Bearer <access token>\" \\\n  --header \"Content-Type: application/json\" \\\n  -d @nginx-repo-certs.json\n```\n\n----------------------------------------\n\nTITLE: Configuring Listen Directive with Backlog in NGINX\nDESCRIPTION: This code snippet configures the `listen` directive within an NGINX `server` block. It sets the listening port to 80 and adjusts the `backlog` parameter to 4096. This adjustment is recommended when the `somaxconn` kernel parameter is set to a value greater than 512, to ensure that NGINX can efficiently handle incoming connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80 backlog=4096;\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Syslog for Metric Collection\nDESCRIPTION: This snippet demonstrates how to configure Nginx to send access logs to a syslog server. It assumes that Nginx is version 1.9.5 or newer. The `access_log` directive is modified to specify the syslog server address (127.0.0.1:12000), a tag (`amplify`), and the log format (`main_ext`). The Nginx configuration must be reloaded to apply changes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/configuring-metric-collection.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\naccess_log syslog:server=127.0.0.1:12000,tag=amplify,severity=info main_ext;\n```\n\n----------------------------------------\n\nTITLE: Configure Kubernetes API Server Arguments in Kubespray\nDESCRIPTION: This snippet demonstrates how to add extra flags to the Kubernetes API Server using Kubespray's group_vars configuration. It configures the service account issuer, signing key file, and API audiences, which are required for older Kubespray versions to enable Service Account Token Volume Projection.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/kubespray.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nkube_kubeadm_apiserver_extra_args:\n  service-account-issuer: api\n  service-account-signing-key-file: /etc/kubernetes/ssl/sa.key\n  service-account-api-audiences: api\n```\n\n----------------------------------------\n\nTITLE: Querying NS1 API for Active Connections After Increase\nDESCRIPTION: Similar to the second snippet, this queries the NS1 API to get the number of active connections reported by the NS1 agent, but after simulating an increase in connections. This step verifies that the NS1 API reflects the new number of active connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\n$ curl -X GET -H 'X-NSONE-Key: <NS1-API-key>' https://api.nsone.net/v1/data/feeds/<NS1-data-source-ID>/<NS1-feed-ID> | python -m json.tool\n\n{\n  \"config\": {\n    \"label\": \"us-nginxgslb-datafeed\"\n  },\n  \"data\": {\n    \"connections\": 5,\n    \"up\": true\n  },\n  ...\n}\n```\n\n----------------------------------------\n\nTITLE: Checking Telemetry Upload Status\nDESCRIPTION: Checks the status of the telemetry upload using `curl` and `jq`. It retrieves the percentage complete, percentage successful, and ready for download status from the response and loops until the upload is complete or the maximum number of attempts is reached.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nstatus_command=\"curl --location 'https://product.apis.f5.com/ee/v1/entitlements/telemetry/bulk/status/$status_link' --header 'Authorization: Bearer $bearer_token'\"\n\n  status_response=$(eval $status_command)\n\n  # Extract values from the response\n  percentage_complete=$(jq -r '.percentageComplete' <<< \"$status_response\")\n  percentage_successful=$(jq -r '.percentageSuccessful' <<<  \"$status_response\")\n  ready_for_download=$(jq -r '.readyForDownload' <<< \"$status_response\")\n```\n\n----------------------------------------\n\nTITLE: Proxying requests to HTTP server with URI in Nginx\nDESCRIPTION: This example demonstrates how to configure NGINX to proxy requests to an HTTP server, replacing the matched location with a specified URI. The `proxy_pass` directive is used within a `location` block to forward requests to the defined server and URI. When a request matches the location, the URI part of the request is replaced with the URI specified in `proxy_pass` before being sent to the proxied server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/reverse-proxy.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /some/path/ {\n    proxy_pass http://www.example.com/link/;\n}\n```\n\n----------------------------------------\n\nTITLE: Create Ansible Playbook for NGINX Instance Manager\nDESCRIPTION: This YAML snippet defines an Ansible playbook to install NGINX Instance Manager. It configures host, privilege escalation, variables for license, setup, version, user credentials and modules, includes the necessary collections, and applies the NGINX Management Suite role.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/infrastructure-as-code/configuration.md#_snippet_0\n\nLANGUAGE: YAML\nCODE:\n```\n- hosts: nms\n  become: yes\n  vars:\n    nginx_license:\n      certificate: ./nginx-repo.crt\n      key: ./nginx-repo.key\n    nms_setup: install\n    nms_version: 2.16.0*\n    nms_user_name: admin\n    nms_user_passwd: default\n    nms_modules:\n      - name: sm\n  collections:\n    - nginxinc.nginx_core\n  roles:\n    - nginxinc.nginx_management_suite\n```\n\n----------------------------------------\n\nTITLE: Configure JSESSIONID-Based Session Persistence - Citrix ADC\nDESCRIPTION: This configures JSESSIONID-based session persistence on a Citrix ADC virtual server.  It sets the persistence type to RULE and defines rules to extract the 'jsessionid' value from the HTTP request cookie and the HTTP response's Set-Cookie header. This allows Citrix ADC to maintain session persistence based on the JSESSIONID cookie value.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\nset lb vserver mysslvserver -persistencetype RULE -rule 'HTTP.REQ.COOKIE.VALUE(\"jsessionid\")' -resRule 'HTTP.RES.SET_COOKIE.COOKIE(\"jsessionid\")'\n```\n\n----------------------------------------\n\nTITLE: Define Custom access.log Format - NGINX\nDESCRIPTION: Defines a custom `access.log` format with extended variables for more detailed metrics collection by the NGINX Controller Agent. This allows including additional information like request time, upstream address, status, response time, length, and cache status.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-metrics-collection.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nlog_format main_ext '$remote_addr - $remote_user [$time_local] \"$request\" '\n'$status $body_bytes_sent \"$http_referer\" '\n'\"$http_user_agent\" \"$http_x_forwarded_for\" '\n'\"$host\" sn=\"$server_name\" '\n'rt=$request_time '\n'ua=\"$upstream_addr\" us=\"$upstream_status\" '\n'ut=\"$upstream_response_time\" ul=\"$upstream_response_length\" '\n'cs=$upstream_cache_status' ;\n```\n\n----------------------------------------\n\nTITLE: Get Total Request Count with curl\nDESCRIPTION: This command retrieves the total number of requests for the last 3 hours from the Nginx Controller Analytics. It uses the `SUM` aggregation function on the `http.request.count` metric and specifies a start time of 'now-3h'. Requires a valid session cookie for authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/view-traffic-metrics.md#_snippet_3\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{Controller-FQDN}/api/v1/analytics/metrics?names=SUM(http.request.count)&startTime=now-3h\"\n```\n\n----------------------------------------\n\nTITLE: BIG-IP Component creation failure due to address assignment\nDESCRIPTION: This snippet shows an error message that occurs when creating a BIG-IP Component due to the inability to bind to a specified IP address and port. This indicates that NGINX is unable to assign the requested address, leading to a configuration test failure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.7.md#_snippet_2\n\nLANGUAGE: text\nCODE:\n```\nFailed testing config before applying: nginx:\nthe configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: [emerg] bind() to <IP>:20001 failed (99: Cannot assign requested address)\nnginx: configuration file /etc/nginx/nginx.conf test failed\n```\n\n----------------------------------------\n\nTITLE: Enabling XFF Header Trust in NGINX Policy (JSON)\nDESCRIPTION: This snippet demonstrates how to enable trust for XFF headers within an NGINX policy.  By setting `trustXff` to `true`, the policy will consider XFF headers when making decisions.  The `customXffHeaders` array is empty in this configuration, indicating the use of standard XFF headers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/additional-config-options.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"xff_enabled\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"general\": {\n            \"customXffHeaders\": [],\n            \"trustXff\": true\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring mTLS Mode for NGINX Deployment via Annotation\nDESCRIPTION: This YAML snippet shows how to configure the mTLS mode for an Nginx deployment by adding the `config.nsm.nginx.com/mtls-mode: strict` annotation to the Pod template specification. This ensures that the deployed Nginx pods will enforce strict mTLS settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/configuration.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  labels:\n    app: nginx\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n      annotations:\n        config.nsm.nginx.com/mtls-mode: strict\n    spec:\n      containers:\n      - name: nginx\n        image: nginx\n        ports:\n        - containerPort: 80\n```\n\n----------------------------------------\n\nTITLE: Updating Default Policy - app_protect_default_policy - Shell\nDESCRIPTION: This command updates the `app_protect_default_policy` with the latest security updates using the `-factory-policy` option in the waf-compiler docker image. It mounts the current working directory to the container and outputs the new policy to a specified file. Requires a compiler image named `waf-compiler-1.0.0:custom`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ndocker run \\\n -v $(pwd):$(pwd) \\\n waf-compiler-1.0.0:custom \\\n -factory-policy default -o $(pwd)/new_default_policy.tgz\n```\n\n----------------------------------------\n\nTITLE: Querying Security Violation Events by Signature Name\nDESCRIPTION: This example shows how to retrieve events that triggered a specific signature-based violation by signature Name, using the NGINX Controller REST API. The substring search using wildcards or ‘IN’ operand is used. The startTime is set to 0 and endTime to now.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/view-app-security-analytics.md#_snippet_10\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            waf.signature_names IN ('DIRECTORY_TRAVERSAL') and\n            app='shopping' and\n            environment='prod' and\n            component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Add delayed shutdown hooks to nginx-gateway container\nDESCRIPTION: This YAML snippet adds a `preStop` lifecycle hook to the `nginx-gateway` container, causing it to delay its shutdown process by executing the `/usr/bin/gateway sleep --duration=40s` command. This allows existing connections to close gracefully during pod termination.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_12\n\nLANGUAGE: yaml\nCODE:\n```\n<...>\nname: nginx-gateway\n<...>\nlifecycle:\n  preStop:\n    exec:\n      command:\n      - /usr/bin/gateway\n      - sleep\n      - --duration=40s # This flag is optional, the default is 30s\n<...>\n```\n\n----------------------------------------\n\nTITLE: ObservabilityPolicy Status Example\nDESCRIPTION: This text block shows the output of `kubectl describe` for an ObservabilityPolicy. It includes the status of the policy, the ancestor reference, conditions, and controller name, indicating whether the policy has been accepted by the system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/custom-policies.md#_snippet_3\n\nLANGUAGE: text\nCODE:\n```\nStatus:\n  Ancestors:\n    Ancestor Ref:\n      Group:      gateway.networking.k8s.io\n      Kind:       HTTPRoute\n      Name:       foo\n      Namespace:  default\n    Conditions:\n      Last Transition Time:  2024-05-23T18:13:03Z\n      Message:               Policy is accepted\n      Observed Generation:   1\n      Reason:                Accepted\n      Status:                True\n      Type:                  Accepted\n    Controller Name:         gateway.nginx.org/nginx-gateway-controller\n```\n\n----------------------------------------\n\nTITLE: Specifying SSL protocols and ciphers in Nginx\nDESCRIPTION: This snippet demonstrates how to configure the SSL protocols and ciphers used for communication between Nginx and upstream servers. The `proxy_ssl_protocols` directive specifies the allowed SSL/TLS protocols, and the `proxy_ssl_ciphers` directive defines the allowed cipher suites. This allows for fine-grained control over the security of the connection.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/securing-http-traffic-upstream.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /upstream {\n        #...\n        proxy_ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        proxy_ssl_ciphers   HIGH:!aNULL:!MD5;\n}\n```\n\n----------------------------------------\n\nTITLE: Compile Policy with Global Settings\nDESCRIPTION: This command compiles a security policy using the NGINX App Protect WAF compiler, incorporating global settings from a JSON file. It mounts the current directory as a volume and specifies the global settings file, policy file, and output bundle file. The `-rm` flag ensures the container is removed after execution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ndocker run --rm \\\n -v $(pwd):$(pwd) \\\n waf-compiler-1.0.0:custom \\\n -g $(pwd)/global_settings.json -p $(pwd)/policy.json -o $(pwd)/compiled_policy.tgz\n```\n\n----------------------------------------\n\nTITLE: Active Directory Group Search Filter (Multiple Attributes)\nDESCRIPTION: This code snippet shows an example of a group search filter that matches more than one attribute using the ampersand symbol (&). This allows for more specific filtering of AD groups during the authentication provider setup in NGINX Controller.  The ampersand means we search for both objectClass=group and CN=devops.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\n(&(objectClass=group)(CN=devops))\n```\n\n----------------------------------------\n\nTITLE: Configure Usage Report Endpoint in Nginx Configuration\nDESCRIPTION: This snippet shows how to configure the `usage_report` directive within the `mgmt` block of the Nginx configuration file (`/etc/nginx/nginx.conf`). It specifies the endpoint where the Nginx instance will send usage reports to the Nginx Instance Manager. The `<NGINX-INSTANCE-MANAGER-FQDN>` placeholder should be replaced with the fully qualified domain name of the Nginx Instance Manager host.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/licensing-and-reporting/configure-nginx-plus-report-to-nim.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n  usage_report endpoint=<NGINX-INSTANCE-MANAGER-FQDN>;\n}\n```\n\n----------------------------------------\n\nTITLE: Excluding Multiple Signatures using Modifications - JSON\nDESCRIPTION: This snippet shows how to exclude multiple signatures using the `modifications` section. Each signature ID is specified in a separate `entity` block with `entityChanges` setting `enabled` to `false`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/signature-sets.md#_snippet_5\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"modifications\": [\n        {\n            \"entityChanges\": {\n                \"enabled\": false\n            },\n            \"entity\": {\n                \"signatureId\": 200001834\n            },\n            \"entityType\": \"signature\",\n            \"action\": \"add-or-update\"\n        },\n        {\n            \"entityChanges\": {\n                \"enabled\": false\n            },\n            \"entity\": {\n                \"signatureId\": 200004461\n            },\n            \"entityType\": \"signature\",\n            \"action\": \"add-or-update\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Executing the k8s-restore.sh Script - Shell\nDESCRIPTION: This command executes the `k8s-restore.sh` script as a superuser, providing the path to the backup tarball as an argument using `-i` and specifying the restore operation with `-r`. The `KUBECONFIG` environment variable is set to specify the Kubernetes configuration file.  The script requires root access and access to a Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\nsudo KUBECONFIG=/etc/kubernetes/admin.conf ./k8s-restore.sh -i k8s-backup-<timestamp>.tar.gz -r\n```\n\n----------------------------------------\n\nTITLE: Including Multiple HTTP Configuration Files in Nginx\nDESCRIPTION: This Nginx configuration block demonstrates using wildcard notation to include multiple configuration files within the `http` block.  It includes all files ending with `-http.conf` located in the `conf.d` directory, offering a flexible way to manage HTTP-related configurations. Files must be named according to the specified pattern.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    include conf.d/*-http.conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Amplify Agent\nDESCRIPTION: This snippet shows how to download and run the NGINX Amplify Agent installation script, which requires an API key. Replace 'YOUR_API_KEY' with your actual NGINX Amplify API key. This command uses curl to download the script and then executes it with the API key provided as an environment variable.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/faq/nginx-amplify-agent.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ncurl -sS -L -O \\\nhttps://github.com/nginxinc/nginx-amplify-agent/raw/master/packages/install.sh && \\\nAPI_KEY='YOUR_API_KEY' sh ./install.sh\n```\n\n----------------------------------------\n\nTITLE: List Pods and Services - Shell\nDESCRIPTION: This shell command uses `kubectl` to list the deployed pods and services in the Kubernetes cluster. It's used to verify that the coffee application, as well as the tea and soda applications, have been successfully deployed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get pods,svc\n```\n\n----------------------------------------\n\nTITLE: Restart ACM Service (bash)\nDESCRIPTION: This snippet shows how to restart the API Connectivity Manager (ACM) service after modifying the configuration file.  The `sudo systemctl restart nms-acm` command ensures that the new configuration changes, such as enabling metrics, are applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/enable-metrics.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nms-acm\n```\n\n----------------------------------------\n\nTITLE: NGINX Agent CLI Usage\nDESCRIPTION: This snippet shows how to start the NGINX Agent using CLI flags.  The agent is invoked with `nginx-agent` followed by the desired flags. These flags override any configuration settings defined in the configuration files or environment variables.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configuration-overview.md#_snippet_2\n\nLANGUAGE: sh\nCODE:\n```\nnginx-agent [flags]\n```\n\n----------------------------------------\n\nTITLE: Pull Debian NGINX Plus Image (Docker)\nDESCRIPTION: This command pulls the `debian` tagged NGINX Plus image from the private registry.  Docker must be installed and running. This is a specific example of pulling the NGINX Plus agent image with the `debian` tag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/containers/connect-nginx-plus-container-images-to-nginx-one.md#_snippet_2\n\nLANGUAGE: sh\nCODE:\n```\nsudo docker pull private-registry.nginx.com/nginx-plus/agent:debian\n```\n\n----------------------------------------\n\nTITLE: Checking NGINX HA Node State with cat Command (bash)\nDESCRIPTION: This snippet checks the current state (MASTER or BACKUP) of an NGINX high-availability node by reading the `/var/run/nginx-ha-keepalived.state` file. The output displays the current state of the node, which is critical for determining which node is the primary and which is the backup.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/ha-data-plane.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nnode-1 $ cat /var/run/nginx-ha-keepalived.state\nSTATE=MASTER\nnode-2 $ cat /var/run/nginx-ha-keepalived.state\nSTATE=BACKUP\n```\n\n----------------------------------------\n\nTITLE: Describe HTTPRoute coffee with kubectl\nDESCRIPTION: This command retrieves and displays the status of a Kubernetes HTTPRoute resource named 'coffee'. The output includes information about parent references, conditions (Accepted, ResolvedRefs), and controller name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe httproute coffee\n```\n\n----------------------------------------\n\nTITLE: Decompress GZIP Archive\nDESCRIPTION: Decompresses a gzipped archive containing NGINX Plus certificates and keys. Requires `gunzip` utility. This makes the certificate and key files accessible for use in NGINX App Protect installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller-app-sec.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\ngunzip nginx-plus-certs.gz\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Plus repository - Ubuntu\nDESCRIPTION: This command adds the NGINX Plus repository to the Ubuntu system's apt sources. It uses `printf` to generate the repository entry string, which includes the distribution codename obtained using `lsb_release -cs`, and then pipes it to `sudo tee` to write it to the `/etc/apt/sources.list.d/nginx-plus.list` file. This allows the system to find and install the NGINX Plus packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_34\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-plus.list\n```\n\n----------------------------------------\n\nTITLE: Invoking uWSGI Server with Django (Command Line)\nDESCRIPTION: This command shows how to invoke the uWSGI server with Django. It sets various parameters, including the working directory, the WSGI module, Django settings, master process, PID file, socket address, number of processes, user/group IDs, harakiri timeout, maximum requests, vacuum option, and daemonization for logging.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/app-gateway-uwsgi-django.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\n     --chdir=/var/django/projects/myapp \\\n     --module=myapp.wsgi:application \\\n     --env DJANGO_SETTINGS_MODULE=myapp.settings \\\n     --master --pidfile=/usr/local/var/run/uwsgi/project-master.pid \\\n     --socket=127.0.0.1:29000 \\\n     --processes=5 \\\n     --uid=505 --gid=505 \\\n     --harakiri=20 \\\n     --max-requests=5000 \\\n     --vacuum \\\n     --daemonize=/usr/local/var/log/uwsgi/myapp.log\n```\n\n----------------------------------------\n\nTITLE: Unauthorized Response - JSON\nDESCRIPTION: This snippet shows the JSON response expected when accessing the API endpoint without a valid access token.  The server returns a 401 Unauthorized status code.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_26\n\nLANGUAGE: json\nCODE:\n```\n{\n       \"message\": \"Unauthorized\",\n       \"status\": \"401\"\n   }\n```\n\n----------------------------------------\n\nTITLE: Verifying NGINX Signing Key Fingerprint on Ubuntu\nDESCRIPTION: This command checks the fingerprint of the imported NGINX signing key to ensure its authenticity. It performs a dry-run import using gpg and displays the key's fingerprint, which should match the expected values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_23\n\nLANGUAGE: shell\nCODE:\n```\ngpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg\n```\n\n----------------------------------------\n\nTITLE: Set SSL Certificate Secrets (YAML)\nDESCRIPTION: Configuration for setting external SSL certificate, key, and CA files in PEM format for the NGINX Instance Manager Ingress proxy using Docker secrets. This allows for secure HTTPS communication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\nsecrets:\n  nim_proxy_cert_file:\n    file: ./certs/nim_cert.pem\n  nim_proxy_cert_key:\n    file: ./certs/nim_key.pem\n  nim_proxy_ca_cert:\n    file: ./certs/nim_ca.pem\n```\n\n----------------------------------------\n\nTITLE: Setting readOnlyRootFilesystem in Kubernetes Security Context (YAML)\nDESCRIPTION: This snippet demonstrates how to set the `readOnlyRootFilesystem` property to `true` within the security context of a Kubernetes container. This configuration enhances security by preventing writes to the root filesystem. It's applied to multiple containers: nginx, waf-enforcer and waf-config-mgr.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/nap-k8s-readonly-context.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\ncontainers:\n    - name: nginx\n      ...\n      securityContext:\n          readOnlyRootFilesystem: true\n    - name: waf-enforcer\n      ...\n      securityContext:\n          readOnlyRootFilesystem: true\n    - name: waf-config-mgr\n      ...\n      securityContext:\n          readOnlyRootFilesystem: true\n```\n\n----------------------------------------\n\nTITLE: Update System Packages on RHEL 8\nDESCRIPTION: This command updates all installed packages on the RHEL 8 system to their latest versions. It uses the `yum` package manager with the `-y` flag to automatically answer 'yes' to any prompts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum -y upgrade\n```\n\n----------------------------------------\n\nTITLE: Extracting NGINX Controller installer package\nDESCRIPTION: This command extracts the downloaded NGINX Controller installer package using the `tar` utility. The package contains the necessary files for installing NGINX Controller and its prerequisites.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/controller/helper-script-prereqs.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ntar xzf controller-installer-<version>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Update Prometheus Address in MeshConfig (YAML)\nDESCRIPTION: This YAML snippet demonstrates how to update the `meshconfig` resource to specify the Prometheus address at runtime. This allows the control plane to retrieve metrics from the specified Prometheus instance. The address format is `<service-name>.<namespace>:<port>`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/monitoring-and-tracing.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\nspec:\n   prometheusAddress: my-prometheus.example-namespace:9090\n```\n\n----------------------------------------\n\nTITLE: Send Request to Coffee Endpoint - Shell\nDESCRIPTION: This snippet uses curl to send a request to the coffee endpoint. It includes the `--resolve` flag to map `cafe.example.com` to the specified IP address and port, and sends an HTTP GET request to `/coffee`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee\n```\n\n----------------------------------------\n\nTITLE: Viewing kubelet logs\nDESCRIPTION: This command displays the logs for the kubelet service using journalctl. This is useful for diagnosing issues related to kubelet certificate expiration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_19\n\nLANGUAGE: bash\nCODE:\n```\nsudo journalctl -xeu kubelet\n```\n\n----------------------------------------\n\nTITLE: Running Kubernetes Restore Script (Data Only) (./k8s-restore.sh)\nDESCRIPTION: This command executes the `k8s-restore.sh` script for a data-only restoration of NGINX Instance Manager in a Kubernetes environment. The `-d` flag indicates a data-only restore, while `-i` specifies the backup archive. KUBECONFIG is set to specify the Kubernetes configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\nsudo KUBECONFIG=/etc/kubernetes/admin.conf ./k8s-restore.sh -i k8s-backup-<timestamp>.tar.gz -r -d\n```\n\n----------------------------------------\n\nTITLE: Define OpenID Connect Provider in NGINX\nDESCRIPTION: This configuration defines the Amazon Cognito OIDC provider within the `http` context using the `oidc_provider` block. This block will contain directives for the issuer, client ID, and client secret.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/cognito.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider cognito {\n\n        # ...\n\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Bad Actors Detected Shell Example\nDESCRIPTION: This snippet displays an example report for when bad actors are detected by NGINX App Protect DoS. It includes the number of newly detected bad actors and the total number of bad actors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/security-log.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ndate_time=\"Apr 29 2021 14:02:00\",\nproduct=\"app-protect-dos\",\nproduct_version=\"23+1.54.1-1.el7.ngx\",\nunit_hostname=\"localhost.localdomain\",\ninstance_id=\"d9a6d8\",\nvs_name=\"example.com/\",\ndos_attack_id=\"1\",\nattack_event=\"Bad actors detected\",\nnew_bad_actors_detected=\"2\",\nbad_actors=\"2\"\n```\n\n----------------------------------------\n\nTITLE: Modifying PHP-FPM Listen Configuration\nDESCRIPTION: These configuration lines modify the PHP-FPM pool configuration to listen on a specific TCP port (127.0.0.1:9000) instead of a Unix socket. This allows Nginx to communicate with PHP-FPM over TCP/IP.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nListen = /run/php/php5-fpm.sock\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Invalid HTTPRoute Error\nDESCRIPTION: This error message is displayed when an HTTPRoute resource is invalid according to the OpenAPI schema validation. Specifically, the hostname contains invalid characters. This validation is performed by the Kubernetes API server during resource creation or update.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/resource-validation.md#_snippet_1\n\nLANGUAGE: text\nCODE:\n```\nThe HTTPRoute \"coffee\" is invalid: spec.hostnames[0]: Invalid value: \"cafe.!@#$%example.com\": spec.hostnames[0] in body should match '^(\\*\\.)?[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$'\n```\n\n----------------------------------------\n\nTITLE: Install Docker Packages on RHEL 8\nDESCRIPTION: This command installs specific versions of the Docker CE, Docker CE CLI, and containerd.io packages using yum. Specifying the versions ensures compatibility and avoids potential issues with newer, untested releases.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum install docker-ce-3:19.03.15-3.el8 docker-ce-cli-1:19.03.15-3.el8 containerd.io-1.3.9-3.1.el8\n```\n\n----------------------------------------\n\nTITLE: Upstream Keepalive Connections Metric\nDESCRIPTION: Describes the 'plus.upstream.conn.keepalive' metric, which is a gauge showing the current number of idle keepalive connections. It indicates the number of persistent connections available for reuse, reducing connection overhead.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_7\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, integer\nDescription: Сurrent number of idle keepalive connections.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Mitigating CVE-2023-1550 in NGINX Agent (Instance Manager)\nDESCRIPTION: This snippet outlines the mitigation steps for CVE-2023-1550, a vulnerability where NGINX Agent inserts sensitive information into a log file. The recommended mitigation is to avoid configuring trace-level logging or to restrict access to log files to trusted users only.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/release-notes.md#_snippet_1\n\nLANGUAGE: text\nCODE:\n```\n- Avoid configuring trace-level logging in the NGINX Agent configuration file. For more information, refer to the [Configuring the NGINX Agent]({{< ref \"/nms/nginx-agent/install-nginx-agent.md#configuring-the-nginx-agent \">}}) section of NGINX Management Suite documentation. If trace-level logging is required, ensure only trusted users have access to the log files.\n```\n\n----------------------------------------\n\nTITLE: Plan Terraform Deployment\nDESCRIPTION: This command creates an execution plan, showing the changes that Terraform will apply to the infrastructure. It allows you to preview the effects of the Terraform configuration before making any actual changes. It requires a properly initialized Terraform working directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-terraform.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nterraform plan\n```\n\n----------------------------------------\n\nTITLE: Querying NS1 API for Data Feed Status (false)\nDESCRIPTION: This code snippet queries the NS1 API after the upstream servers have been taken down, verifying that NS1 now returns 'false' in the 'up' field for the corresponding data feed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\n$ curl -X GET -H 'X-NSONE-Key: <NS1-API-key>' https://api.nsone.net/v1/data/feeds/<NS1-data-source-ID> | python -m json.tool\n[\n  ...\n  {\n    \"destinations\": [\n      {\n        \"destid\": \"<Answer-ID>\",\n        \"desttype\": \"answer\",\n        \"record\": \"<Record-ID>\"\n      }\n    ],\n    \"id\": \"<Feed-ID>\",\n    \"data\": {\n      \"up\": \"false\"\n    },\n    \"config\": {\n      \"label\": \"us-nginxgslb-datafeed\"\n    },\n    \"name\": \"us-nginxgslb-datafeed\"\n  },\n  ...\n]\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Plus Certificates as JSON\nDESCRIPTION: This curl command downloads the NGINX Plus certificate and key bundle as a JSON file using the NGINX Controller API. Replace `192.0.2.0` with the actual controller IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\ncurl -b cookie.txt -c cookie.txt --header 'Content-Type: application/json' -X GET --url 'https://192.0.2.0/api/v1/platform/licenses/nginx-plus-licenses/controller-provided'  --output nginx-plus-certs.json\n```\n\n----------------------------------------\n\nTITLE: Create NGINX Certificate with Paths and Key Vault - Azure CLI\nDESCRIPTION: This example demonstrates creating an NGINX certificate using the Azure CLI, specifying the certificate name, deployment name, resource group, certificate path, key path, and key vault secret ID.  This command creates a link between the specified paths and the key vault secret for use by the NGINX deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-azure-cli.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment certificate create --certificate-name myCertificate \\\n      --deployment-name myDeployment --resource-group myResourceGroup \\\n      --certificate-path /etc/nginx/test.cert --key-path /etc/nginx/test.key \\\n      --key-vault-secret-id keyVaultSecretId\n```\n\n----------------------------------------\n\nTITLE: Get NGINX Plus and App Protect packages version (Shell)\nDESCRIPTION: This command retrieves the versions of the installed NGINX Plus and App Protect packages on CentOS/RHEL systems and appends them to the `package_versions.txt` file.  This is part of the process of collecting troubleshooting information to send to customer support.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/troubleshooting-guide/how-to-troubleshoot.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nrpm -qa nginx-plus* app-protect* >> package_versions.txt\n```\n\n----------------------------------------\n\nTITLE: Set Admin Password Secret (YAML)\nDESCRIPTION: Configures a Docker secret that will be used to set the initial admin password for NGINX Instance Manager. The `file` parameter specifies the path to the file containing the password.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\nsecrets:\n  nim_admin_password:\n    file: admin_password.txt\n```\n\n----------------------------------------\n\nTITLE: Create a Services Workspace API Request (JSON)\nDESCRIPTION: This JSON payload defines the structure for creating a new services workspace within NGINX Management Suite API Connectivity Manager. It includes the workspace name, metadata describing the workspace, and contact details for the workspace administrator. This snippet is used in a POST request to the `/services/workspaces` endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/publish-api-proxy.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"{{proxyWorkspaceName}}\",\n    \"metadata\": {\n        \"description\": \"Petstore Team Workspace\"\n    },\n    \"contactDetails\": {\n        \"adminEmail\": \"admin@example.com\",\n        \"adminName\": \"I.M. Admin\",\n        \"adminPhone\": \"555 123 1234\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Reloading NGINX Configuration (Shell)\nDESCRIPTION: Reloads the NGINX configuration within the running NGINX container.  It executes the `nginx -s reload` command inside the container named `nginx`.  This requires the `docker` command-line tool to be installed and configured and for the Nginx container to be running.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-on-docker.md#_snippet_12\n\nLANGUAGE: Shell\nCODE:\n```\nsudo docker exec nginx  nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Removing a Server from Upstream Group via API Shell\nDESCRIPTION: This snippet demonstrates how to remove a server from an upstream group using a `DELETE` request to the NGINX Plus API.  The `curl` command sends the request to remove the server at index 0. It requires Nginx plus with API enabled and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_22\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X DELETE -s 'http://127.0.0.1/api/9/stream/upstreams/appservers/servers/0'\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Service Mesh Helm Repository\nDESCRIPTION: Adds the NGINX Service Mesh Helm repository to your local Helm configuration. This allows you to install the chart directly from the repository. Requires Helm to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install-with-helm.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nhelm repo add nginx-stable https://helm.nginx.com/stable\nhelm repo update\n```\n\n----------------------------------------\n\nTITLE: Mapping Request Method for Purging Cache in Nginx (HTTP block)\nDESCRIPTION: This map block defines a mapping between the HTTP request method and a variable, $purge_method. If the request method is PURGE, the variable is set to 1; otherwise, it defaults to 0. This mapping is used later to determine whether to purge the cache for a request. This is defined within the http block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_35\n\nLANGUAGE: nginx\nCODE:\n```\nmap $request_method $purge_method {\n    PURGE 1;\n    default 0;\n}\n```\n\n----------------------------------------\n\nTITLE: Changing ownership of Kubernetes configuration\nDESCRIPTION: This command changes the ownership of the Kubernetes configuration file to the current user and group, granting them access to the file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_15\n\nLANGUAGE: bash\nCODE:\n```\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n----------------------------------------\n\nTITLE: Backing Up Example Key (Shell)\nDESCRIPTION: This command backs up the newly created example.com.key file.  It is crucial to back up the key to prevent data loss.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nroot# cp ~/example.com.key <SECURE-DIR>/example.com.key.backup\n```\n\n----------------------------------------\n\nTITLE: Installing yum-utils on Oracle Linux 8.1+\nDESCRIPTION: This command installs the yum-utils package on Oracle Linux 8.1+. This package provides various utilities for managing yum repositories and packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_19\n\nLANGUAGE: script\nCODE:\n```\nsudo dnf install yum-utils\n```\n\n----------------------------------------\n\nTITLE: Run Nginx Agent - Shell\nDESCRIPTION: This command starts NGINX Agent from the source code root directory. It requires `sudo` privileges and outputs log information to the console.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/getting-started.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nsudo make run\n\n# Command Output snippet\nWARN[0000] Log level is info\nINFO[0000] setting displayName to XXX\nINFO[0000] NGINX Agent at with pid 12345, clientID=XXXXXX-XXXXXX-XXXXXX-XXXXXX-XXXXXX name=XXX\nINFO[0000] NginxBinary initializing\nINFO[0000] Commander initializing\nINFO[0000] Comms initializing\nINFO[0000] OneTimeRegistration initializing\nINFO[0000] Registering XXXXXX-XXXXXX-XXXXXX-XXXXXX-XXXXXX\nINFO[0000] Metrics initializing\nINFO[0000] MetricsThrottle initializing\nINFO[0000] DataPlaneStatus initializing\nINFO[0000] MetricsThrottle waiting for report ready\nINFO[0000] Metrics waiting for handshake to be completed\nINFO[0000] ProcessWatcher initializing\nINFO[0000] Extensions initializing\nINFO[0000] FileWatcher initializing\nINFO[0000] FileWatchThrottle initializing\nINFO[0001] Events initializing\nINFO[0001] OneTimeRegistration completed\n```\n\n----------------------------------------\n\nTITLE: Blocking Specific File Types - JSON\nDESCRIPTION: This example demonstrates how to configure NGINX App Protect to block specific file types, while allowing all others by default.  It configures file type enforcement in blocking mode, allows all file types with a wildcard, and explicitly disallows the 'bat' file type. The configuration is part of the NGINX App Protect policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/filetypes-and-responses.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"policy1\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_FILETYPE\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"filetypes\": [\n            {\n                \"name\": \"*\",\n                \"type\": \"wildcard\",\n                \"allowed\": true,\n                \"checkPostDataLength\": false,\n                \"postDataLength\": 4096,\n                \"checkRequestLength\": false,\n                \"requestLength\": 8192,\n                \"checkUrlLength\": true,\n                \"urlLength\": 2048,\n                \"checkQueryStringLength\": true,\n                \"queryStringLength\": 2048,\n                \"responseCheck\": false\n            },\n            {\n                \"name\": \"bat\",\n                \"allowed\": false\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Swap Metrics Collection Error Message\nDESCRIPTION: This snippet shows the warning message in the NGINX Agent logs when the Docker host system does not have cgroup swap limit capabilities enabled. Enabling these capabilities is required to collect swap metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-support.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nUnable to collect Swap metrics because the file ... was not found\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration\nDESCRIPTION: This shell command reloads the NGINX configuration without interrupting existing connections. It is used to apply changes made to the configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/perl.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Configure Allowed Capabilities for Nginx Service Mesh Sidecar\nDESCRIPTION: Adds allowed capabilities to the Pod Security Policy to enable the Nginx Service Mesh sidecar init container to configure iptables rules and BPF programs required for UDP communication.  Specifically, it allows `NET_ADMIN`, `NET_RAW`, `SYS_RESOURCE`, and `SYS_ADMIN` capabilities.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/rke.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\nspec:\n  allowedCapabilities:\n  - NET_ADMIN\n  - NET_RAW\n  - SYS_RESOURCE\n  - SYS_ADMIN\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Service Mesh via Helm Repository\nDESCRIPTION: Installs the NGINX Service Mesh chart using the Helm repository. This command creates a new namespace for the mesh, installs the chart with the release name `nsm` in the `nginx-mesh` namespace, and waits for the installation to complete. Requires the Helm repository to be added first.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install-with-helm.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nhelm install nsm nginx-stable/nginx-service-mesh --namespace nginx-mesh --create-namespace --wait\n```\n\n----------------------------------------\n\nTITLE: Uninstalling the NGINX Developer Portal Helm Chart\nDESCRIPTION: This bash command uninstalls and deletes the specified NGINX Developer Portal Helm chart release from a given namespace. The command removes all Kubernetes components associated with the release but does not delete the namespace itself. It requires the release name and namespace as parameters.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/devportal-helm-chart.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nhelm uninstall devportal --namespace devportal\n```\n\n----------------------------------------\n\nTITLE: Querying Metrics Catalog API\nDESCRIPTION: This curl command retrieves the list of supported metrics from the Metrics Catalog API. It requires a valid access token for authentication. The command sends a GET request to the specified endpoint, including the access token in the Authorization header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/catalogs/metrics\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Create Environment (ACM)\nDESCRIPTION: This command creates an Environment in API Connectivity Manager within a specified Infrastructure Workspace. It requires NGINX Management Suite user credentials in the Basic Authentication header for the REST request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\nPOST https://192.0.2.2/api/acm/v1/infrastructure/workspaces/infra-ws/environments\n```\n\n----------------------------------------\n\nTITLE: Pass OIDC Claims as Headers\nDESCRIPTION: This snippet passes OIDC claims from the ID token as headers to the upstream application using the `proxy_set_header` directive. The claims include the subject, email, and name of the authenticated user. These claims can then be used by the application for authorization or personalization.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-oidc.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc my_idp;\n\n     proxy_set_header sub   $oidc_claim_sub;\n     proxy_set_header email $oidc_claim_email;\n     proxy_set_header name  $oidc_claim_name;\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Restoring NGINX Controller Database (Bash)\nDESCRIPTION: This script restores the NGINX Controller database from backup files. It iterates through the `.backup` files in the specified `$BACKUP_PATH`, extracts the database name from the filename, and uses `pg_restore` to restore each database. The `-c -C` flags drop and recreate the database before restoring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-external-config-db.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nfor backup_file in \"$BACKUP_PATH\"/*.backup; do\n  db=\"$(basename \"$backup_file\" | cut -d '-' -f 1)\"\n  pg_restore -c -C -d \"$db\" \"$backup_file\"\ndone\n```\n\n----------------------------------------\n\nTITLE: Specify Cluster Nodes (DNS) NGINX\nDESCRIPTION: Specifies other NGINX instances in the cluster using the `zone_sync_server` directive with DNS resolution.  The `resolver` directive configures DNS resolution, allowing nodes to be added dynamically.  The `resolve` parameter enables dynamic resolution of the hostname to IP addresses.  Assumes that `nginx-cluster.example.com` resolves to the IP addresses of the other cluster members.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n\n    resolver 10.0.0.53 valid=20s;\n\n    server {\n        zone_sync;\n        zone_sync_server nginx-cluster.example.com:9000 resolve;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Verify redirect with curl for tea application (Shell)\nDESCRIPTION: This `curl` command sends a request to `http://cafe.example.com/tea` and includes the response headers to verify the redirect. The `--resolve` option is used to map the hostname to the Gateway IP and Port, the `--include` option is used to show the response headers including the `Location` header which confirms the redirect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/tea --include\n```\n\n----------------------------------------\n\nTITLE: Send multiple requests to coffee app using curl\nDESCRIPTION: This shell script sends multiple HTTP requests to the coffee application through NGINX Gateway Fabric using `curl`. The script iterates 10 times, sending a request in each iteration. The `--resolve` flag maps `cafe.example.com` to the specified IP address and port using shell variables `$GW_PORT` and `$GW_IP`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_5\n\nLANGUAGE: Shell\nCODE:\n```\nfor i in `seq 1 10`; do curl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee; done\n```\n\n----------------------------------------\n\nTITLE: Configuring app_protect_custom_log_attribute in Nginx\nDESCRIPTION: This example demonstrates how to configure the `app_protect_custom_log_attribute` directive at the server and location levels within an Nginx configuration. It shows how to define key/value pairs for custom logging with App Protect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/custom-log-configuration.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nuser nginx;\nload_module modules/ngx_http_app_protect_module.so;\nerror_log /var/log/nginx/error.log debug;\n\nevents {\n    worker_connections  65536;\n}\nserver {\n\n        listen       80;\n\n        server_name  localhost;\n        proxy_http_version 1.1;\n        app_protect_custom_log_attribute ‘environment' 'env1';\n\n        location / {\n\n            app_protect_enable on;\n            app_protect_custom_log_attribute gateway gway1;\n            app_protect_custom_log_attribute component comp1;\n            proxy_pass http://172.29.38.211:80$request_uri;\n        }\n    }\n```\n\n----------------------------------------\n\nTITLE: Logging Upstream Time Values in Nginx\nDESCRIPTION: This example demonstrates how to log different time values between NGINX and an upstream server to diagnose website slowdowns using variables like `$upstream_connect_time`, `$upstream_header_time`, `$upstream_response_time`, and `$request_time`. A custom log format `upstream_time` is defined and applied to a virtual server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/logging.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    log_format upstream_time '$remote_addr - $remote_user [$time_local] '\n                             '\"$request\" $status $body_bytes_sent '\n                             '\"$http_referer\" \"$http_user_agent\"'\n                             'rt=$request_time uct=\"$upstream_connect_time\" uht=\"$upstream_header_time\" urt=\"$upstream_response_time\"';\n\n    server {\n        access_log /spool/logs/nginx-access.log upstream_time;\n        ...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Set Up a Proxy\nDESCRIPTION: This code snippet configures a proxy for the NGINX Controller Agent in the `agent.conf` file. This enables the agent to communicate with NGINX Controller when the system is in a DMZ environment without direct access.  The agent utilizes environment variables first but the proxy can be manually defined here. This configuration allows the agent to report collected metrics even without direct access to the NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-the-agent.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\n[proxies]\nhttps = https://10.20.30.40:3030\n..\n```\n\n----------------------------------------\n\nTITLE: Request to Echo Server with Access Token\nDESCRIPTION: This snippet shows a sample request to the echo server API proxy with an access token. It includes the HTTP method, path, headers, and other relevant information.  The request is made after configuring JWT introspection.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_57\n\nLANGUAGE: bash\nCODE:\n```\nRequest served by echo-host\n\nHTTP/1.0 POST /my/test/api\n\nHost: default_http_07b28d26-9641-4a67-a422-0c4e14f27b03\nAccept: */*\nAccept-Encoding: gzip, deflate, br\nCache-Control: no-cache\nConnection: close\nContent-Length: 30\nContent-Type: application/json\nX-Correlation-Id: 00342cadec0651b6643fcf092246535f\n```\n\n----------------------------------------\n\nTITLE: Install ACM Data Plane Dependencies (RPM)\nDESCRIPTION: These commands extract the `acm-dataplane-dependencies-<linux-distribution>.tar.gz` archive and install the RPM packages within it.  The `tar` command's `-k` option ensures existing files are not overwritten. Replace `<linux-distribution>` with the target distribution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm-offline.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\ntar -kzxvf acm-dataplane-dependencies-<linux-distribution>.tar.gz\nsudo rpm -ivh *.rpm\n```\n\n----------------------------------------\n\nTITLE: Policy Configuration with Local File Modification Reference JSON\nDESCRIPTION: This JSON defines an App Protect policy that references a local file (on the same machine) containing signature modifications. It configures attack signatures and uses a file reference to exclude specific signatures.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-references.md#_snippet_6\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"external_resources_signature_modification\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"signature-sets\": [\n            {\n                \"name\": \"All Signatures\",\n                \"block\": true,\n                \"alarm\": true\n            }\n        ]\n    },\n    \"modificationsReference\": {\n        \"link\": \"file:///modifications.txt\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Querying Metrics without Dimensions using cURL\nDESCRIPTION: This cURL command retrieves the sum of HTTP request counts without any dimensions. It utilizes an empty `dimensions` parameter to aggregate all data into a single series. It requires a session cookie and specifies a 3-hour startTime window. The controller IP address needs to be replaced in the URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_21\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=SUM(http.request.count)&startTime=now-3h&dimensions=\"\n```\n\n----------------------------------------\n\nTITLE: Kubernetes API Deprecation Warning\nDESCRIPTION: These warnings indicate that NGINX Service Mesh dependencies use older Kubernetes API versions that are deprecated in newer Kubernetes versions (>=1.19). These versions will become unavailable in Kubernetes 1.22+. Although NGINX Service Mesh will still function, users will see these warnings until the resource versions are updated.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.9.0.md#_snippet_5\n\nLANGUAGE: plaintext\nCODE:\n```\nW0303 00:12:03.484737 44320 warnings.go:70] apiextensions.k8s.io/v1beta1 CustomResourceDefinition is deprecated in v1.16+, unavailable in v1.22+; use apiextensions.k8s.io/v1 CustomResourceDefinition\n```\n\nLANGUAGE: plaintext\nCODE:\n```\nW0303 00:12:04.996104 44320 warnings.go:70] admissionregistration.k8s.io/v1beta1 ValidatingWebhookConfiguration is deprecated in v1.16+, unavailable in v1.22+; use admissionregistration.k8s.io/v1 ValidatingWebhookConfiguration\n```\n\n----------------------------------------\n\nTITLE: Downloading Nginx Configuration via Wget\nDESCRIPTION: This shell script navigates to the Nginx configuration directory and uses the wget command to download a specific Nginx configuration file (gce-all-active-app.conf) from a remote GitHub repository. The downloaded configuration file is then saved locally with the same name, enabling the instance to use it.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_5\n\nLANGUAGE: none\nCODE:\n```\ncd /etc/nginx/conf.d/\nwget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-app.conf\n```\n\n----------------------------------------\n\nTITLE: Removing NGINX Service Mesh Resources\nDESCRIPTION: These commands are used to manually remove remaining NGINX Service Mesh resources after a standard removal process if errors occur or injected pods are still present. These commands delete the mesh namespace, cluster roles and security context constraints associated with NGINX Service Mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/openshift.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete ns <mesh-namespace>\nkubectl delete clusterrole system:openshift:scc:nginx-mesh-spire-agent-permissions\nkubectl delete scc nginx-mesh-spire-agent-permissions\nkubectl delete clusterrolebinding csi-driver-sentinel.builtin.nsm.nginx\n```\n\n----------------------------------------\n\nTITLE: Check Pod Status with kubectl in Kubernetes\nDESCRIPTION: This command is used to retrieve and display the status of pods within the 'nginx-mesh' namespace in a Kubernetes cluster. It helps identify issues such as `ErrImagePull` or `ImagePullBackOff` by showing the current state and any restarts of the containers within the pods. It requires kubectl to be configured and connected to the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.1.0.md#_snippet_5\n\nLANGUAGE: plaintext\nCODE:\n```\nkubectl -n nginx-mesh get pods\n```\n\n----------------------------------------\n\nTITLE: Deploying Target v2.0 (Failing Version) with kubectl\nDESCRIPTION: This command deploys a new version of the target application, `target-v2.0`, using the configuration defined in `target-v2.0-failing.yaml`. This version is intentionally configured to return a 500 error status code. The deployment is performed using `kubectl apply`, creating the necessary pods and services in the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f target-v2.0-failing.yaml\n```\n\n----------------------------------------\n\nTITLE: Building Docker Image for NGINX App Protect\nDESCRIPTION: This command builds a Docker image for NGINX App Protect WAF v5 using the provided Dockerfile, certificate (nginx-repo.crt), and key (nginx-repo.key). It utilizes Docker secrets to securely pass the certificate and key during the build process, avoiding their inclusion in the image itself. The resulting image is tagged as `nginx-app-protect-5`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/build-nginx-image-cmd.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker build --no-cache --platform linux/amd64 \\\n  --secret id=nginx-crt,src=nginx-repo.crt \\\n  --secret id=nginx-key,src=nginx-repo.key \\\n  -t nginx-app-protect-5 .\n```\n\n----------------------------------------\n\nTITLE: Querying PHP-FPM Status via FastCGI\nDESCRIPTION: This command queries the PHP-FPM status using the `cgi-fcgi` tool. This is a way to manually test and confirm that PHP-FPM metrics are accessible via FastCGI before relying on NGINX Amplify Agent. The command specifies the script name and filename, query string, request method and socket connection.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/other-metrics.md#_snippet_2\n\nLANGUAGE: text\nCODE:\n```\n# SCRIPT_NAME=/status SCRIPT_FILENAME=/status QUERY_STRING= REQUEST_METHOD=GET cgi-fcgi -bind -connect /var/run/php/php7.0-fpm.sock\n```\n\n----------------------------------------\n\nTITLE: Including OpenID Connect Configuration\nDESCRIPTION: This YAML snippet includes the OpenID Connect configuration file, enabling the authorization code flow and Relying Party processing. The `add_header` directive sets an authentication indicator. Ensure the file path `/etc/nms/nginx/oidc/openid_connect.conf` is correct.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\n## For OIDC Authentication: authorization code flow and Relying Party processing\n# OIDC - remove comment from following directives to enable\nadd_header Nginx-Management-Suite-Auth \"OIDC\";\ninclude /etc/nms/nginx/oidc/openid_connect.conf;\n```\n\n----------------------------------------\n\nTITLE: Example JSON Output from OpenID Configuration\nDESCRIPTION: This JSON snippet shows an example response from the OpenID Connect configuration endpoint. It includes important URLs such as authorization_endpoint, jwks_uri, and token_endpoint, which are required for configuring NGINX Plus as an OpenID Connect relying party.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/ping-identity.md#_snippet_5\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"authorization_endpoint\": \"https://sso.connect.pingidentity.com/sso/as/authorization.oauth2\",\n    ...\n    \"jwks_uri\": \"https://sso.connect.pingidentity.com/sso/as/jwks\",\n    ...\n    \"token_endpoint\": \"https://sso.connect.pingidentity.com/sso/as/token.oauth2\",\n ...\n    }\n```\n\n----------------------------------------\n\nTITLE: Configure Proxy Cache Path in Nginx\nDESCRIPTION: This code snippet configures the proxy cache path for Nginx. It specifies the location of the cache directory (`/var/cache/nginx`) and defines a key zone named `mycache` with a size of 10MB.  NGINXaaS for Azure only supports caching to `/var/cache/nginx` because it will be stored on a temporary disk.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/basic-caching.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    proxy_cache_path /var/cache/nginx keys_zone=mycache:10m;\n}\n```\n\n----------------------------------------\n\nTITLE: Azure CLI: Get Principal ID of User Assigned Managed Identity\nDESCRIPTION: This code snippet retrieves the principal ID of a user-assigned managed identity using the Azure CLI. It requires the `MI_NAME` (managed identity name) and `MI_RESOURCE_GROUP` (resource group name) environment variables to be set. The command queries the Azure identity service and extracts the `principalId` value.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nmi_principal_id=$(az identity show --name $MI_NAME \\\n         --resource-group $MI_RESOURCE_GROUP \\\n         --query principalId --output tsv)\n```\n\n----------------------------------------\n\nTITLE: Updated TrafficTarget YAML\nDESCRIPTION: This YAML shows the updated TrafficTarget, where the 'source-disallowed-sa' ServiceAccount has been added to the list of allowed sources. This will enable traffic from the 'disallowed' driver to reach the destination service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_15\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: access.smi-spec.io/v1alpha2\nkind: TrafficTarget\nmetadata:\n  name: traffic-target\nspec:\n  destination:\n    kind: ServiceAccount\n    name: destination-sa\n  rules:\n  - kind: HTTPRouteGroup\n    name: route-group\n    matches:\n      - destination-traffic\n  sources:\n  - kind: ServiceAccount\n    name: source-allowed-sa\n  - kind: ServiceAccount\n    name: source-disallowed-sa\n```\n\n----------------------------------------\n\nTITLE: Health Check JSON Response\nDESCRIPTION: This JSON snippet shows the response from the `/health` endpoint of the NGINX Agent REST API. It includes the overall status of the agent and a list of individual checks for registration, command connection, and metrics connection. The 'status' field indicates the health of each component.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/health-checks.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"status\": \"OK\",\n  \"checks\": [\n    {\n      \"name\": \"registration\",\n      \"status\": \"OK\"\n    },\n    {\n      \"name\": \"commandConnection\",\n      \"status\": \"OK\"\n    },\n    {\n      \"name\": \"metricsConnection\",\n      \"status\": \"OK\"\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Update Controller Agent FQDN - NGINX\nDESCRIPTION: This snippet shows the NGINX configuration required to update the `api_url` value in the Controller Agent's `agent.conf` file.  This configuration points the agent to the new Fully Qualified Domain Name (FQDN) of the NGINX Controller.  The port 8443 is used for secure communication with the controller's API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/resilient-cluster-private-cloud.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\n[cloud]\napi_url = https://<NEW_FQDN>:8443/1.4\n```\n\n----------------------------------------\n\nTITLE: NGINX dest-svc Deployment Configuration YAML\nDESCRIPTION: This YAML snippet demonstrates configuring the deployment for the `dest-svc` with the container port updated to 55555.  The container port is defined within the `spec.template.spec.containers[0].ports[0].containerPort` field. This deployment ensures the pod exposes the correct port for the service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_17\n\nLANGUAGE: YAML\nCODE:\n```\n---\nkind: Deployment\nspec:\n  template:\n    spec:\n      containers:\n      - name: example\n        - containerPort: 55555\n```\n\n----------------------------------------\n\nTITLE: Controller Agent Configuration - CentOS 6.x Workaround\nDESCRIPTION: This configuration change addresses an issue where the Controller Agent stops running on CentOS 6.x. Adding 'level = INFO' and 'level = DEBUG' to the end of the /etc/controller-agent/agent.conf file stabilizes the agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_46\n\nLANGUAGE: conf\nCODE:\n```\nlevel = INFO\nlevel = DEBUG\n```\n\n----------------------------------------\n\nTITLE: Markdown Formatting: Internal Link\nDESCRIPTION: This snippet demonstrates the recommended way to create internal links within the NGINX documentation using the Hugo `ref` shortcode. Absolute paths starting with a forward slash are used for clarity, and file extensions are included for ease of targeting page anchors.\nSOURCE: https://github.com/nginx/documentation/blob/main/CONTRIBUTING_DOCS.md#_snippet_2\n\nLANGUAGE: Markdown\nCODE:\n```\nTo install <software>, refer to the [installation instructions]({{< ref \"/product/deploy/install.md\" >}}).\nTo install <integation>, refer to the [integration instructions]({{< ref \"/integration/thing.md#section\" >}}).\n```\n\n----------------------------------------\n\nTITLE: Gateway Update Failure Error Message\nDESCRIPTION: This snippet shows an error message that occurs when updating a gateway associated with a Published API and a component with Authentication enabled. The configuration test fails, indicating a problem with the update process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.5.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\nFailed testing config before applying\n```\n\n----------------------------------------\n\nTITLE: Description of amplify.agent.mem metrics\nDESCRIPTION: Provides the type and description for the amplify.agent.mem metrics which is a gauge in bytes representing Memory utilized by the NGINX Amplify Agent process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_17\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, bytes\nDescription: Memory utilized by the NGINX Amplify Agent process.\n```\n\n----------------------------------------\n\nTITLE: Download Usage Report via REST API (curl)\nDESCRIPTION: This curl command downloads the prepared telemetry usage report in zip format from the NGINX Instance Manager REST API. It sends a request to the `/api/platform/v1/report/download` endpoint and saves the response to `report.zip`. The `-k` flag disables SSL certificate validation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/report-usage-disconnected-deployment.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ncurl -k --location 'https://<NIM-FQDN>/api/platform/v1/report/download?format=zip&reportType=telemetry&telemetryAction=download' \\\n--header 'accept: */*' \\\n--header 'authorization: Basic <base64-encoded-credentials>' \\\n--output report.zip\n```\n\n----------------------------------------\n\nTITLE: Install SQLite on Debian (buster/sid) and Ubuntu 18.04\nDESCRIPTION: Installs SQLite on Debian (buster/sid) and Ubuntu 18.04. This involves installing build tools, downloading and compiling libuv, raft, and sqlite3 from source due to potential compatibility issues with default packages. It configures and installs each library with static linking.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/sqlite-installation.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo su\napt-get install -y gcc \\\n      make \\\n      automake \\\n      liblz4-dev \\\n      pkg-config \\\n      libtool \\\n      diffutils \\\n      file\n\nLIBUV=1.43.0\nRAFT=0.16.0\nSQLITE3=3410100\n\ncurl -L -o libuv.tar.gz https://github.com/libuv/libuv/archive/refs/tags/v${LIBUV}.tar.gz && \\\n    tar -zxf libuv.tar.gz && cd libuv-${LIBUV} && sh autogen.sh && ./configure --prefix=/usr --enable-shared=no && make && make install && cd .. && rm -rf libuv.tar.gz libuv-${LIBUV}\ncurl -L -o raft.tar.gz https://github.com/canonical/raft/archive/refs/tags/v${RAFT}.tar.gz && \\\n    tar -zxf raft.tar.gz && cd raft-${RAFT} && autoreconf -i && ./configure --disable-lz4 --prefix=/usr --enable-shared=no && make && make install && cd .. && rm -rf raft.tar.gz raft-${RAFT}\ncurl -L -o sqlite3.tar.gz https://sqlite.org/2023/sqlite-autoconf-${SQLITE3}.tar.gz && \\\n    tar -zxf sqlite3.tar.gz && cd sqlite-autoconf-${SQLITE3} && ./configure --prefix=/usr --enable-shared=no && make && make install && cd .. && rm -rf sqlite3.tar.gz sqlite-autoconf-${SQLITE3}\n```\n\n----------------------------------------\n\nTITLE: Disabling NTP synchronization\nDESCRIPTION: This command disables NTP (Network Time Protocol) synchronization. This is done to manually set the system time to a specific value for troubleshooting certificate issues.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_20\n\nLANGUAGE: bash\nCODE:\n```\nsudo timedatectl set-ntp off\n```\n\n----------------------------------------\n\nTITLE: Start AWS SSM Session\nDESCRIPTION: This snippet shows how to initiate a Session Manager session with a specific EC2 instance using the AWS CLI. Replace `<instanceId>` with the actual ID of your EC2 instance. This command provides terminal access to the specified instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/aws-deploy.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\n$ aws ssm start-session --target \"<instanceId>\"\n\nStarting session with SessionId: aaaaaaaa-0538f063ab275aeed\n$\n```\n\n----------------------------------------\n\nTITLE: Merging Internal Branch to Origin in Git\nDESCRIPTION: This snippet shows how to switch back to the origin `main` branch, create a new feature branch, merge changes from the internal branch, and push it to the origin repository. The merging step integrates the changes from the internal feature branch to the public branch. Requires that the internal changes have been completed and reviewed.\nSOURCE: https://github.com/nginx/documentation/blob/main/CLOSED_CONTRIBUTIONS.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ngit checkout main\ngit checkout -b feature\ngit merge internal/internal/feature\ngit push origin\n```\n\n----------------------------------------\n\nTITLE: Copying SSL Certificate and Key Files with Shell\nDESCRIPTION: Copies the downloaded certificate (.crt) and key (.key) files to the /etc/ssl/nginx/ directory. This ensures that Nginx can use the SSL certificate for secure communication. The files are renamed to nginx-repo.crt and nginx-repo.key respectively. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/copy-crt-and-key.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo cp <downloaded-file-name>.crt /etc/ssl/nginx/nginx-repo.crt\nsudo cp <downloaded-file-name>.key /etc/ssl/nginx/nginx-repo.key\n```\n\n----------------------------------------\n\nTITLE: Security Log Profile Response - JSON\nDESCRIPTION: This is an example JSON response received after creating a security log profile. The response includes metadata such as creation and modification timestamps, external ID type, name, revision timestamp, a unique ID for the log profile (`uid`), and a self-link. This provides information about the created log profile.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_17\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"metadata\": {\n    \"created\": \"2023-07-05T22:09:19.634358096Z\",\n    \"externalIdType\": \"\",\n    \"modified\": \"2023-07-05T22:09:19.634358096Z\",\n    \"name\": \"default-log-example\",\n    \"revisionTimestamp\": \"2023-07-05T22:09:19.634358096Z\",\n    \"uid\": \"<log-profile-uid>\"\n  },\n  \"selfLink\": {\n    \"rel\": \"/api/platform/v1/security/logprofiles/<log-profile-uid>\"\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Introspection Policy Configuration with Custom Error Codes (JSON)\nDESCRIPTION: This JSON configuration shows how to configure the `errorReturnConditions` within the `oauth2-introspection` policy. It sets up the proxy to return a `418` status code when a token is invalid (`noMatch`) and a `410` status code when no token is provided (`notSupplied`). It includes client credentials and the introspection endpoint URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_54\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"test-proxy\",\n   \"version\": \"v1\",\n   \"proxyConfig\": {\n      \"hostname\": \"data-host\",\n      \"ingress\": {\n         \"basePath\": \"/\",\n         \"basePathVersionAppendRule\": \"NONE\"\n      },\n      \"backends\": [\n         {\n            \"serviceName\": \"backend-echo-svc\",\n            \"serviceTargets\": [\n               {\n                  \"hostname\": \"192.0.2.4\",\n                  \"listener\": {\n                     \"enableTLS\": false,\n                     \"port\": 10000,\n                     \"transportProtocol\": \"HTTP\"\n                  }\n               }\n            ]\n         }\n      ],\n      \"policies\": {\n         \"oauth2-introspection\": [\n            {\n               \"action\": {\n                  \"introspectionEndpoint\": \"http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect\",\n                  \"introspectionResponse\": \"application/json\",\n                  \"errorReturnConditions\": {\n                     \"noMatch\": {\n                        \"returnCode\": 418\n                     },\n                     \"notSupplied\": {\n                        \"returnCode\": 410\n                     }\n                  }\n               },\n               \"data\": [\n                  {\n                     \"clientAppID\": \"nginx-plus\",\n                     \"clientSecret\": \"<client secret>\"\n                  }\n               ]\n            }\n         ]\n      }\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Adding Egress Label to Nginx Ingress Controller Pod Spec (YAML)\nDESCRIPTION: Adds the `nsm.nginx.com/enable-egress: \"true\"` label to the Ingress Controller's Pod spec. This label instructs NGINX Service Mesh to configure the Ingress Controller Pod for proper integration with the mesh, enabling egress traffic management.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\nlabels:\n  nsm.nginx.com/enable-egress: \"true\"\n  ...\n```\n\n----------------------------------------\n\nTITLE: Executing the Signature Converter Tool\nDESCRIPTION: This command executes the `/opt/app_protect/bin/convert-signatures` tool, which is the User Defined Signatures Converter tool for NGINX App Protect WAF.  It converts signatures from XML to JSON format.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_24\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/convert-signatures\n```\n\n----------------------------------------\n\nTITLE: Description of system.mem metrics\nDESCRIPTION: Provides the type and description for the system.mem metrics which is a gauge in bytes representing Statistics about system memory usage.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, bytes\nDescription: Statistics about system memory usage.\n```\n\n----------------------------------------\n\nTITLE: Configure Request Body Size Limit via REST API with JSON\nDESCRIPTION: This snippet demonstrates how to configure the Request Body Size Limit policy using a JSON payload sent to the Environments endpoint of the REST API.  It sets the maximum allowed request body size to 1 megabyte and configures the API to return a 413 error code if a request exceeds this limit. This policy is applied at the environment level.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/request-body-size-limit.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n    \"request-body-size-limit\": [\n      {\n        \"action\": {\n          \"returnCode\": 413,\n          \"size\": \"1M\"\n        }\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Overriding Action for Specific Bot Signature - JSON\nDESCRIPTION: This JSON snippet demonstrates how to override the default action for a specific bot signature (`python-requests`) in an NGINX App Protect policy. In this example, the action is set to `ignore`, effectively disabling the signature.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/anti-automation.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"bot_defense_policy\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"bot-defense\": {\n            \"settings\": {\n                \"isEnabled\": true\n            },\n            \"mitigations\": {\n                \"signatures\": [\n                    {\n                        \"action\": \"ignore\",\n                        \"name\": \"python-requests\"\n                    }\n                ]\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Open Source\nDESCRIPTION: This command downloads the specified version of NGINX Open Source (in this case, 1.27.4) using `wget` and extracts it using `tar`. This is a prerequisite to compiling community modules that are compatible with a particular version of NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_34\n\nLANGUAGE: shell\nCODE:\n```\nwget -qO - https://nginx.org/download/nginx-1.27.4.tar.gz | tar zxfv -\n```\n\n----------------------------------------\n\nTITLE: Apply Proxy Request Headers Policy via REST API - JSON Request\nDESCRIPTION: This JSON payload is used in a PUT request to the Proxies endpoint to configure the Proxy Request Headers policy. It includes settings for forwarding default headers and a custom header with a string value. The 'isSensitive' flag prevents logging of the custom header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-request-headers.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n    \"proxy-request-headers\": [\n      {\n        \"action\": {\n          \"proxyHeaders\": {\n            \"proxyDefaultHeadersToBackend\": true,\n            \"proxyCustomHeadersToBackend\": [\n              {\n                \"key\": \"my-custom-header\",\n                \"value\": \"stringValue.myValue\",\n                \"isSensitive\": true\n              }\n            ]\n          }\n        }\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Description of system.swap metrics\nDESCRIPTION: Provides the type and description for the system.swap metrics which is a gauge in bytes representing System swap memory statistics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_13\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, bytes\nDescription: System swap memory statistics.\n```\n\n----------------------------------------\n\nTITLE: Example Output of ip addr show (Backup Node)\nDESCRIPTION: This is an example output from the `ip addr show` command on the backup node. The absence of the VIP address indicates that this node is the backup.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_4\n\nLANGUAGE: none\nCODE:\n```\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state\n     UP qlen 1000\n    link/ether 52:54:00:33:a5:87 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.100.101/24 brd 192.168.122.255 scope global eth0\n       valid_lft forever preferred_lft forever\n```\n\n----------------------------------------\n\nTITLE: Enable Extension - YAML\nDESCRIPTION: This YAML snippet enables an extension in NGINX Agent, specifically the `advanced-metrics` extension. Extensions add functionality that is not critical to the core functionality of managing NGINX configuration and reporting metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/getting-started.md#_snippet_6\n\nLANGUAGE: yaml\nCODE:\n```\nextensions:\n  - advanced-metrics\n```\n\n----------------------------------------\n\nTITLE: Add Load Balancer Configuration via API\nDESCRIPTION: This snippet demonstrates how to add a load balancer configuration to an API Proxy through the backend-config policy using a POST request. It sets the target backend policy label, keep-alive settings (cache connection alive, requests, time, and timeout).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/http-backend-configuration.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"policies\": {\n      \"backend-config\": [\n         {\n            \"action\": {\n               \"targetBackendPolicyLabel\" : \"petstore-api\",\n               \"keepCacheConnectionAlive\": 32,\n               \"keepAliveRequests\": 1000,\n               \"keepAliveTime\": \"1h\",\n               \"keepAliveTimeout\": \"60s\"\n            }\n         }\n      ]\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Swap Memory Limit Warning in NGINX Agent Logs\nDESCRIPTION: This code snippet shows the warning message in the NGINX Agent logs when the swap memory limit for the Docker container is greater than the swap memory for the Docker host system. The `system.swap.total` metric will reflect the Docker host's total swap memory instead of the container's specified limit.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-support.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nSwap memory limit specified for the container, ... is greater than the host system swap memory ...\n```\n\n----------------------------------------\n\nTITLE: Example NGINX Plus Version Output\nDESCRIPTION: This output shows the expected format when verifying the NGINX Plus version using the `nginx -v` command. It confirms that the installed version is NGINX Plus Release 34, indicated by `nginx-plus-r34`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/onelogin.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nnginx version: nginx/1.27.4 (nginx-plus-r34)\n```\n\n----------------------------------------\n\nTITLE: Ignoring controller-postgres volume not found error during upgrade\nDESCRIPTION: This code snippet shows the error message reported by the update script when upgrading NGINX Controller using an external config database. The error `Error from server (NotFound): persistentvolumes \"controller-postgres\" not found.` can be safely ignored as it relates to an internal test and does not affect the upgrade's success.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nError from server (NotFound): persistentvolumes \"controller-postgres\" not found.\n```\n\n----------------------------------------\n\nTITLE: Applying Request Correlation ID Policy via REST API\nDESCRIPTION: This JSON payload demonstrates how to define a Request Correlation ID policy using the REST API.  It specifies that an HTTP header named `x-correlation-id` should be used to pass the correlation ID. To use this, send an HTTP `POST` request to the Environment endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/request-correlation-id.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n    \"request-correlation-id\": [\n      {\n        \"action\": {\n          \"httpHeaderName\": \"x-correlation-id\"\n        }\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX App Protect WAF Repository - Shell\nDESCRIPTION: This shell command adds the NGINX App Protect WAF v5 repository to the `/etc/apk/repositories` file. It dynamically determines the Alpine Linux version from `/etc/alpine-release` and constructs the correct repository URL, appending it to the repositories file using `sudo tee -a`. Requires `egrep` and `sudo`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-alpine.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\nprintf \"https://pkgs.nginx.com/app-protect-x-plus/alpine/v`egrep -o '^[0-9]+\\.[0-9]+' /etc/alpine-release`/main\\n\" | sudo tee -a /etc/apk/repositories\n```\n\n----------------------------------------\n\nTITLE: Create Cluster Zone Sync Policy - Minimum Configuration - JSON\nDESCRIPTION: This JSON payload defines a Cluster Zone Sync policy with the minimum required configuration. It specifies a TCP server listener port and the names and ports of the zone sync servers.  This configures basic synchronization without DNS resolution or TLS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/cluster-zone-sync.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"cluster-zone-sync\": [\n    {\n      \"action\": {\n        \"tcpServer\": {\n          \"listeners\": [\n            {\n              \"port\": 12345\n            }\n          ]\n        },\n        \"zoneSyncServers\": [\n          {\n            \"name\": \"nginx-cluster-instance-1.com\",\n            \"port\": 12345\n          },\n          {\n            \"name\": \"nginx-cluster-instance-2.com\",\n            \"port\": 12345\n          }\n        ]\n      }\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Server Slow Start in Nginx Plus\nDESCRIPTION: This snippet configures server slow start for `backend1.example.com` in the `backend` upstream group.  `slow_start=30s` means that after the server recovers or becomes available, it will gradually increase its weight from zero to its nominal value over 30 seconds. This feature is exclusive to NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-health-check.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nupstream backend {\n    server backend1.example.com slow_start=30s;\n    server backend2.example.com;\n    server 192.0.0.1 backup;\n}\n```\n\n----------------------------------------\n\nTITLE: Install Metrics Module Securely - Bash\nDESCRIPTION: This command downloads and installs the NGINX Plus metrics module from NGINX Management Suite using `curl` over HTTPS.  The `--skip-verify false` flag ensures that the TLS certificates are verified.  It pipes the output to `sudo sh` to execute the installation script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-plus-advanced-metrics.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\ncurl https://<NMS_FQDN>/install/nginx-plus-module-metrics | sudo sh -s -- --skip-verify false\n```\n\n----------------------------------------\n\nTITLE: Configuring RealIP Module to Trust Proxy IPs\nDESCRIPTION: This snippet configures the `set_real_ip_from` directive within a `server` block to specify the IP address range of trusted proxies or load balancers. The RealIP module will only replace the client IP address if the connection originates from within this specified range. This enhances security by preventing arbitrary IP address spoofing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/using-proxy-protocol.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    #...\n    set_real_ip_from 192.168.1.0/24;\n   #...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Server Block\nDESCRIPTION: This NGINX configuration defines a server block listening on port 80 for any application. It configures root directories for two applications, 'app1' and 'app2', based on the requested URI. This setup is used for distributing requests to different applications on the same NGINX instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived-nodes.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen *:80;\n\n    location /app1 {\n        root /application1;\n    }\n\n    location /app2 {\n        root /application2;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Upstream with Shared Memory Zone (HTTP block)\nDESCRIPTION: This configures an upstream group named 'weblogic' with multiple servers and a shared memory zone named 'weblogic'.  The `zone` directive allows worker processes to share configuration and runtime state.  This is usually placed inside the http block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_41\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream weblogic {\n     zone weblogic 64k;\n     server 192.168.25.33:7001;\n     server 192.168.25.69:7001;\n     # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Login to NGINX Private Registry (Docker)\nDESCRIPTION: This command is used to authenticate with the NGINX container registry to download the NGINX Instance Manager image. Replace <JWT_CONTENTS> with your actual JSON Web Token from MyF5.  The password is set to 'none' as the JWT is used for authentication. This step is necessary before deploying NGINX Instance Manager with Docker Compose.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ndocker login private-registry.nginx.com --username=<JWT_CONTENTS> --password=none\n```\n\n----------------------------------------\n\nTITLE: Install API Connectivity Manager Package (Debian)\nDESCRIPTION: This command installs the API Connectivity Manager package on Debian-based systems like Ubuntu and Debian. It uses the `apt-get install` command with the `-f` option to fix any dependency issues during installation. Replace `<user>` and `<version>` with the actual username and ACM version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm-offline.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get install -f /home/<user>/nms-api-connectivity-manager_<version>_amd64.deb\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Gateway Fabric (Experimental)\nDESCRIPTION: This command deploys NGINX Gateway Fabric with NGINX OSS and experimental features. It uses a deployment manifest from the nginx-gateway-fabric repository specifically designed for experimental features and requires the Gateway APIs installed from the experimental channel. It uses `kubectl apply` to apply the configurations defined in the remote YAML file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/deploy/experimental/deploy.yaml\n```\n\n----------------------------------------\n\nTITLE: Example of Duplicate Data Issue Configuration\nDESCRIPTION: This JSON snippet shows an example of a forwarder configuration with two streams that may cause the collector to receive duplicate data. This happens because the wildcard selector in the second stream overlaps with the specific metric in the first stream.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-forwarders.md#_snippet_3\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"streams\": [\n        {\n            \"inputDataType\": \"METRICS\",\n            \"outputFormat\": \"SPLUNK\",\n            \"selector\": \"names=nginx.http.conn.active\"\n        },\n        {\n            \"inputDataType\": \"METRICS\",\n            \"outputFormat\": \"SPLUNK\",\n            \"selector\": \"names=nginx.http*\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Example OpenID Connect Configuration Metadata (JSON)\nDESCRIPTION: This snippet shows the JSON format of OpenID Connect configuration metadata, including the issuer, authorization endpoint, token endpoint, and JWKS URI. The issuer value is crucial for configuring NGINX Plus as the Relying Party.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-oidc.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    ...\n    \"issuer\": \"https://your-idp-domain/idp\",\n    \"authorization_endpoint\": \"https://your-idp-domain/idp/oauth2/authorize/\",\n    \"token_endpoint\": \"https://your-idp-domain/idp/oauth2/token/\",\n    \"jwks_uri\": \"https://your-idp-domain/idp/discovery/keys\",\n    ...\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring HTTP to HTTPS Redirection Nginx\nDESCRIPTION: This snippet configures an HTTP server block, listening on port 80 for 'example.com'. It redirects all HTTP requests to the HTTPS version of the site using a 301 redirect. The `location` block handles the redirection.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nserver {\n     listen 80;\n     server_name example.com;\n\n     proxy_http_version 1.1;\n     proxy_set_header Host $host;\n     proxy_set_header Connection \"\";\n\n     # Redirect all HTTP requests to HTTPS\n     location / {\n         return 301 https://$server_name$request_uri;\n     }\n }\n```\n\n----------------------------------------\n\nTITLE: KQL Query for Top Matched Rules\nDESCRIPTION: This KQL query retrieves the top matched rules from NGINX security logs in Azure Log Analytics. It extracts the attack type names and summarizes the count of requests by attack name and time.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/enable-logging.md#_snippet_8\n\nLANGUAGE: kql\nCODE:\n```\nNGXSecurityLogs\n| extend JSONLog = extract(@\"json_log\\s*=\\s*\\\"({.*?})\\\"\", 1, Message)\n| extend Log = parse_json(replace_string(JSONLog, '\"\"', '\"'))\n| where Log.enforcementAction == \"block\"\n| project attackType = Log.enforcementState.attackType, TimeGenerated\n| mv-expand attackType\n| project attackName = tostring(attackType.name), TimeGenerated\n| summarize count() by attackName, bin(TimeGenerated, 1m)\n| render timechart\n```\n\n----------------------------------------\n\nTITLE: Create Docker Registry Secret in Kubernetes\nDESCRIPTION: Creates a Docker registry secret named 'regcred' in the 'nms' namespace within Kubernetes. This secret stores authentication credentials (JWT token as username and 'none' as password) for accessing the private NGINX Docker registry. This is needed to pull NGINX Instance Manager images from the private registry.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl create secret docker-registry regcred \\\n--docker-server=private-registry.nginx.com \\\n--docker-username=<JWT Token> \\\n--docker-password=none \\\n-n nms\n```\n\n----------------------------------------\n\nTITLE: Configuring App Protect DoS Monitor with Port - Nginx\nDESCRIPTION: This example demonstrates configuring the `app_protect_dos_monitor` directive with a specific port. It is crucial that the port specified in the monitor directive matches the port the server is listening on. Misconfiguration can lead to false attack detections. In this case, the server listens on port 8080, so the monitor directive is configured to `myservice.com:8080`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-4.0.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 8080;\n    location / {  app_protect_dos_monitor \"myservice.com:8080\";  }\n}\n```\n\n----------------------------------------\n\nTITLE: Login Page Policy Configuration JSON\nDESCRIPTION: This JSON example configures a login page for NGINX App Protect WAF. It specifies the login URL, username/password parameters, and validation criteria. The 'accessValidation' section defines how a successful login is determined based on the response content.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_6\n\nLANGUAGE: json\nCODE:\n```\n{\n\t    \"login-pages\": [\n            {\n               \"accessValidation\" : {\n                  \"responseContains\": \"Success\"\n               },\n               \"authenticationType\": \"form\",\n               \"url\" : {\n                  \"method\" : \"*\",\n                  \"name\" : \"/html_login\",\n                  \"protocol\" : \"http\",\n                  \"type\" : \"explicit\"\n               },\n               \"usernameParameterName\": \"username\",\n               \"passwordParameterName\": \"password\"\n            }\n        ]\n}\n```\n\n----------------------------------------\n\nTITLE: Allowlist Policy with Masks - JSON\nDESCRIPTION: This JSON snippet demonstrates an alternative format for specifying IP addresses and ranges in the allowlist file. It uses the 'ipMask' field to define the subnet mask explicitly and sets 'blockRequests' to 'never'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_23\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"policy\":{\n      \"whitelist-ips\":[\n         {\n            \"ipAddress\":\"2034::2300\",\n            \"ipMask\":\"ffff:ffff:ffff:ffff:ffff:ffff:ffff:ff00\",\n            \"blockRequests\":\"never\"\n         },\n         {\n            \"blockRequests\":\"never\",\n            \"ipAddress\":\"4.4.4.0\",\n            \"ipMask\":\"255.255.255.0\"\n         }\n      ]\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Download Dependencies Repo (Shell)\nDESCRIPTION: Downloads the `dependencies.repo` file from the specified URL and saves it to the `/etc/yum.repos.d` directory. This file contains the configuration for the NGINX repository, allowing the system to access and install NGINX packages. The `wget` command is used with `sudo` privileges and the `-P` flag to specify the output directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-rhel-cen-74.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo\n```\n\n----------------------------------------\n\nTITLE: Referenced File Content (response-pages.txt) JSON\nDESCRIPTION: This JSON defines the content of the custom response page referenced via HTTPS.  It contains the HTML content, headers, action type, and page type for the custom response.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-references.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n[\n    {\n        \"responseContent\": \"<html><head><title>Custom Reject Page</title></head><body>This is a custom response page, it is supposed to overwrite the default page with custom text.<br><br>Your support ID is: <%TS.request.ID()%><br><br><a href='javascript:history.back();'>[Go Back]</a></body></html>\",\n        \"responseHeader\": \"HTTP/1.1 200 OK\\r\\nCache-Control: no-cache\\r\\nPragma: no-cache\\r\\nConnection: close\",\n        \"responseActionType\": \"custom\",\n        \"responsePageType\": \"default\"\n    }\n]\n```\n\n----------------------------------------\n\nTITLE: Change Agent Log Level\nDESCRIPTION: This code snippet shows how to change the log level for the NGINX Controller Agent by editing the `[loggers]` section of the `/etc/controller-agent/agent.conf` file. Available log levels include error, info, debug, and trace.  Debug mode should only be used for troubleshooting purposes as it will create a large log file. A restart of the agent is required.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-the-agent.md#_snippet_9\n\nLANGUAGE: plaintext\nCODE:\n```\n[loggers]\nlevel = DEBUG\n...\n```\n\n----------------------------------------\n\nTITLE: Stream Client-v2 Logs using kubectl\nDESCRIPTION: This command streams the logs from the `client` container of the `client-v2` Pod using kubectl. The `-l app=client-v2` flag selects the pod with the label `app=client-v2`. The `-f` flag follows the logs as new data is written. The `-c client` flag specifies the `client` container within the pod.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nkubectl logs -l app=client-v2 -f -c client\n```\n\n----------------------------------------\n\nTITLE: Copy Certificates to NGINX Agent\nDESCRIPTION: These bash commands create a directory `/etc/nms/certs/` on the Nginx Agent and then copy the `ca.pem`, `agent.crt`, and `agent.key` files to that directory, using sudo privileges.  These certificates are needed for the Nginx Agent to securely communicate with NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo mkdir -p /etc/nms/certs\nsudo cp ca.pem /etc/nms/certs/\nsudo cp agent.crt /etc/nms/certs/\nsudo cp agent.key /etc/nms/certs/\n```\n\n----------------------------------------\n\nTITLE: Process SSL Parameter Log File (Shell)\nDESCRIPTION: This shell script processes the `sslparams.log` file to determine the frequency of different ciphers used by clients. It extracts the cipher, counts occurrences, sorts the results, and displays the cipher and its count using equal signs as a visual representation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/logging.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ncat /tmp/sslparams.log | cut -d ' ' -f 2,2 | sort | uniq -c | sort -rn | perl -ane 'printf \"%30s %s\\n\", $F[1], \"=\"x$F[0];'\n```\n\n----------------------------------------\n\nTITLE: Enabling core dumps for setuid/setgid processes (CentOS, Debian, Ubuntu)\nDESCRIPTION: Enables core dumps for `setuid` and `setgid` processes on CentOS 7.0, Debian 8.2, and Ubuntu 14.04. Sets the core pattern to include the executable name and process ID, and configures the system to dump core files for `setuid` processes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\necho \"/tmp/cores/core.%e.%p\" | sudo tee /proc/sys/kernel/core_pattern\nsudo sysctl -w fs.suid_dumpable=2\nsysctl -p\n```\n\n----------------------------------------\n\nTITLE: Configuring SSL Protocols and Ciphers\nDESCRIPTION: This snippet demonstrates how to configure SSL protocols and ciphers for the TCP stream to ensure a secure connection. It utilizes the `ssl_protocols` and `ssl_ciphers` directives to limit connections to strong versions and ciphers of SSL/TLS.  This helps prevent the use of weaker, more vulnerable protocols and ciphers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-tcp.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    #...\n    ssl_protocols  TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers    HIGH:!aNULL:!MD5;\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Custom XFF Headers in NGINX Policy (JSON)\nDESCRIPTION: This snippet configures an NGINX policy to trust XFF headers, but specifically those defined in the `customXffHeaders` array.  In this case, the policy will only trust headers named \"xff\".  Setting `trustXff` to `true` enables the trust functionality.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/additional-config-options.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"xff_custom_headers\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"general\": {\n            \"customXffHeaders\": [\n                \"xff\"\n            ],\n            \"trustXff\": true\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install DEB Packages - Bash\nDESCRIPTION: Extracts and installs DEB packages from an archive. This is used for installing external dependencies on Debian and Ubuntu systems.  It uses the `tar` command to extract the archive and `dpkg` to install the packages. The `-k` flag with `tar` prevents existing files from being overwritten.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide-deprecated.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ntar -kzxvf nms-dependencies-<linux-distribution>.tar.gz\nsudo dpkg -i ./*.deb\n```\n\n----------------------------------------\n\nTITLE: JSON Request Example\nDESCRIPTION: This JSON payload is used to upload the NGINX repository certificate and key to NGINX Instance Manager via the REST API. It includes the certificate, private key, and metadata for authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"name\": \"nginx-repo\",\n  \"nginxResourceType\": \"NginxRepo\",\n  \"certPEMDetails\": {\n    \"caCerts\": [],\n    \"password\": \"\",\n    \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\n[content snipped]\\n-----END PRIVATE KEY-----\\n\",\n    \"publicCert\": \"-----BEGIN CERTIFICATE-----\\n[content snipped]\\n-----END CERTIFICATE-----\",\n    \"type\": \"PEM\"\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Service Mesh API Server Connection Failure - Plaintext\nDESCRIPTION: This snippet represents the error message displayed when the `nginx-meshctl` command fails to connect to the NGINX Service Mesh API Server after attempting to deploy with an invalid image. It suggests checking the logs of the nginx-mesh-api container for more details.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.1.0.md#_snippet_4\n\nLANGUAGE: plaintext\nCODE:\n```\nAll resources created. Testing the connection to the Service Mesh API Server...\nConnection to NGINX Service Mesh API Server failed.\n\tCheck the logs of the nginx-mesh-api container in namespace nginx-mesh for more details.\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration for Resource Credentials Endpoint\nDESCRIPTION: This NGINX configuration block enables the resource credentials endpoint in the API Connectivity Manager (ACM). This is required to allow the developer portal to access credentials. Authentication is disabled for this location, and the configuration includes SSL client verification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\n#Deployment of resource credentials from the devportal\n#  Uncomment this block when using devportal. Authentication is disabled\n#  for this location. This location block will mutually\n#  verify the client trying to access the credentials API.\n#  location = /api/v1/devportal/credentials {\n#    OIDC authentication (uncomment to disable)\n#    auth_jwt off;\n#    auth_basic off;\n#    error_page 401 /401_certs.json;\n#    if ($ssl_client_verify != SUCCESS) {\n#      return 401;\n#    }\n#    proxy_pass http://apim-service/api/v1/devportal/credentials;\n#  }\n```\n\n----------------------------------------\n\nTITLE: Read JWT Content - Bash\nDESCRIPTION: This snippet reads the content of the JWT file into the `bearer_token` variable. This token is used for authenticating API requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nbearer_token=$(<\"$jwt_file\")\n```\n\n----------------------------------------\n\nTITLE: Prometheus Query for Successful Responses\nDESCRIPTION: This Prometheus query finds all upstream server responses with successful response codes (1xx or 2xx) for the deployment `productpage-v1` in the namespace `prod`. It leverages the `nginxplus_upstream_server_responses` metric, filtering based on the `deployment`, `namespace`, and `code` labels using regex.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_9\n\nLANGUAGE: promQL\nCODE:\n```\nnginxplus_upstream_server_responses{deployment=\"productpage-v1\",namespace=\"prod\",code=~\"1xx|2xx\"}\n```\n\n----------------------------------------\n\nTITLE: Retrieving Rejected or Flagged Security Violation Events (curl)\nDESCRIPTION: This query retrieves security violation events where the request was either rejected or flagged for review by WAF. This provides a comprehensive view of potentially problematic requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/view-app-security-analytics.md#_snippet_6\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            request_outcome_reason in ('SECURITY_WAF_VIOLATION','SECURITY_WAF_FLAGGED'))\n```\n\n----------------------------------------\n\nTITLE: Nginx Interface IP Address Output\nDESCRIPTION: The output displays the IP address configuration for eth1, including the physical IP and the virtual IP assigned by keepalived. This sample shows an example from the primary node before failover.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\n3: eth1:  mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:c8:66:ee brd ff:ff:ff:ff:ff:ff\n    inet 10.100.10.100/24 brd 10.100.10.255 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet 10.100.10.50/32 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::a00:27ff:fec8:66ee/64 scope link\n       valid_lft forever preferred_lft forever\n```\n\n----------------------------------------\n\nTITLE: Push Docker Image\nDESCRIPTION: This command pushes a Docker image to a private registry.  Replace `<my-docker-registry:port>` with the address and port of your private Docker registry and `<version>` with the version tag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/deploy-api-connectivity-manager.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ndocker push <my-docker-registry:port>/nms-acm:<version>\n```\n\n----------------------------------------\n\nTITLE: Downloading and Extracting OpenSSL Library for NGINX\nDESCRIPTION: These commands download, extract, configure, build, and install the OpenSSL library. This library provides support for HTTPS protocol within NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_50\n\nLANGUAGE: shell\nCODE:\n```\nwget http://www.openssl.org/source/openssl-3.0.13.tar.gz\ntar -zxf openssl-3.0.13.tar.gz\ncd openssl-3.0.13\n./Configure darwin64-x86_64-cc --prefix=/usr\nmake\nsudo make install\n```\n\n----------------------------------------\n\nTITLE: Making the k8s-backup.sh Script Executable - Shell\nDESCRIPTION: This command makes the `k8s-backup.sh` script executable using `chmod +x`. This allows the user to run the script directly from the command line. \nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nchmod +x k8s-backup.sh\n```\n\n----------------------------------------\n\nTITLE: Adding Basic Authentication Policy via API using JSON\nDESCRIPTION: This snippet shows the JSON payload for adding a basic authentication policy to an API Proxy in NGINX Management Suite API Connectivity Manager. It configures credential forwarding, error return conditions, client ID, username, and password. Requires a running instance of API Connectivity Manager and knowledge of the service workspace name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/basic-authn.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n\t\"policies\": {\n\t\t\"basic-authn\": [\n\t\t\t{\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"credentialForward\": false,\n\t\t\t\t\t\"errorReturnConditions\": {\n\t\t\t\t\t\t\"notSupplied\": {\n\t\t\t\t\t\t\t\"returnCode\": 401\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"data\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"clientID\": \"ClientA\",\n\t\t\t\t\t\t\"username\": \"UserA\",\n\t\t\t\t\t\t\"password\": \"secret123\"\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t]\n\t}\n}\n```\n\n----------------------------------------\n\nTITLE: Setting mTLS mode for a specific resource in Kubernetes\nDESCRIPTION: This YAML snippet demonstrates how to override the global mTLS setting for a specific resource in Kubernetes by adding an annotation to the resource's PodTemplateSpec. The annotation `config.nsm.nginx.com/mtls-mode` is used to specify the desired mTLS mode, in this case, `strict`. This allows fine-grained control over mTLS settings for individual resources within the mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/secure-traffic-mtls.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\nconfig.nsm.nginx.com/mtls-mode: \"strict\"\n```\n\n----------------------------------------\n\nTITLE: Bootstrap a Chef Node\nDESCRIPTION: This command bootstraps a new node with the specified name and IP address using the Knife tool.  It connects to the node, installs the Chef client, and registers the node with the Chef server. Requires network connectivity to the target node and appropriate SSH credentials.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nroot@chef-server:~/chef-zero/playground# knife bootstrap -N chef-test-1 -x username --sudo 10.100.10.100\n```\n\n----------------------------------------\n\nTITLE: Describing Gateway Status (kubectl)\nDESCRIPTION: This command uses `kubectl` to describe the status of a Kubernetes Gateway resource named 'cafe'. The output provides information about the Gateway's addresses, conditions (e.g., Accepted, Programmed), and attached listeners with their associated routes. This command helps verify that the Gateway is properly configured and functioning.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/routing-traffic-to-your-app.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe gateway cafe\n```\n\n----------------------------------------\n\nTITLE: Viewing Mesh Services with nginx-meshctl - Bash\nDESCRIPTION: This command uses the `nginx-meshctl` command-line tool to list the services participating in the mesh. It requires `nginx-meshctl` to be installed and configured to connect to the NGINX Service Mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/api-usage.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl services\n```\n\n----------------------------------------\n\nTITLE: Upgrade ClickHouse on Debian-based systems\nDESCRIPTION: These commands upgrade ClickHouse server and client to the latest version using the apt package manager on Debian, Ubuntu, and other Debian-based systems.  `apt-get update` refreshes the package lists, and `apt-get install` with `--only-upgrade` ensures only the specified packages are upgraded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get update\nsudo apt-get install -y --only-upgrade clickhouse-server clickhouse-client\n```\n\n----------------------------------------\n\nTITLE: Kubeadm Cluster Configuration (New Cluster)\nDESCRIPTION: This YAML configuration is for creating a new Kubernetes cluster using kubeadm. It enables Service Account Token Volume Projection by setting extra arguments for the API server, including the signing key file, issuer, and API audiences. This configuration should be saved to a file and passed to the `kubeadm init` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/kubeadm.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: kubeadm.k8s.io/v1beta2\nkind: ClusterConfiguration\napiServer:\n  extraArgs:\n    service-account-signing-key-file: /etc/kubernetes/pki/sa.key\n    service-account-issuer: api\n    service-account-api-audiences: api\n```\n\n----------------------------------------\n\nTITLE: Destroying Terraform Deployment\nDESCRIPTION: This command destroys all resources managed by Terraform in the current working directory. The `--auto-approve` flag bypasses the interactive approval prompt, automatically confirming the deletion. Use with extreme caution as this action is irreversible.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/create-deployment/deploy-terraform.md#_snippet_3\n\nLANGUAGE: Bash\nCODE:\n```\nterraform destroy --auto-approve\n```\n\n----------------------------------------\n\nTITLE: Upstream Queue Overflow Metric\nDESCRIPTION: Describes the 'plus.upstream.queue.overflows' metric, which is a counter representing the number of requests rejected due to queue overflows. This metric indicates the frequency of queue capacity issues.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_16\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Number of requests rejected due to queue overflows.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: AWS Configure Set Session Token\nDESCRIPTION: This snippet shows how to configure a temporary session token using the AWS CLI. This command is used when your AWS account is configured to use temporary credentials. Replace `<sessionToken>` with your actual session token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/aws-deploy.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\naws configure set aws_session_token <sessionToken>\n```\n\n----------------------------------------\n\nTITLE: JSON Response for NGINX Statistics\nDESCRIPTION: This JSON snippet shows the structure and example values returned by the NGINX Plus API when querying the `/nginx` endpoint.  It contains information such as version, build, address, generation, and process IDs. It returns a JSON object with string and numerical values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_16\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"version\" : \"1.27.4\",\n   \"build\" : \"nginx-plus-r34\",\n   \"address\" : \"206.251.255.64\",\n   \"generation\" : 14,\n   \"load_timestamp\" : \"2025-04-01T10:00:00.114Z\",\n   \"timestamp\" : \"2025-04-01T14:06:36.475Z\",\n   \"pid\" : 2201,\n   \"ppid\" : 92033\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Service Mesh CLI Completion Usage\nDESCRIPTION: Details the usage of the `nginx-meshctl completion` command, which generates autocompletion scripts for different shells. The script is used to enable tab completion for `nginx-meshctl` commands.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_1\n\nLANGUAGE: txt\nCODE:\n```\nUsage:\n  nginx-meshctl completion [command]\n\nAvailable Commands:\n  bash        Generate the autocompletion script for bash\n  fish        Generate the autocompletion script for fish\n  powershell  Generate the autocompletion script for powershell\n  zsh         Generate the autocompletion script for zsh\n\nFlags:\n  -h, --help   help for completion\n\nGlobal Flags:\n  -k, --kubeconfig string   path to kubectl config file (default \"/Users/<user>/.kube/config\")\n  -n, --namespace string    NGINX Service Mesh control plane namespace (default \"nginx-mesh\")\n  -t, --timeout duration    timeout when communicating with NGINX Service Mesh (default 5s)\n```\n\n----------------------------------------\n\nTITLE: Update NGINX Controller\nDESCRIPTION: This command runs the NGINX Controller update script. It first changes the directory to `controller-installer` and then executes `update.sh`. The `--allow-with-root` flag may be needed if upgrading from an older version where Controller was installed as root.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./update.sh\n```\n\n----------------------------------------\n\nTITLE: Retrieving Flagged Security Violation Events (curl)\nDESCRIPTION: This query retrieves security violation events where the request was flagged for review by WAF. This helps to identify requests that were allowed but may warrant further investigation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/view-app-security-analytics.md#_snippet_5\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            request_outcome_reason='SECURITY_WAF_FLAGGED')\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect Policy with File OpenAPI Reference (JSON)\nDESCRIPTION: This JSON snippet configures an NGINX App Protect policy referencing a local OpenAPI Specification file. The `open-api-files` array contains an object with a `link` property pointing to a local file using the `file://` protocol. This allows the policy to be configured with a locally stored OpenAPI specification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-openapi-references.md#_snippet_4\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"openapi-file-reference-json\",\n    \"template\": {\n        \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"open-api-files\": [\n        {\n            \"link\": \"file:///myapi2.json\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Get NGINX Ingress Controller Instances and Nodes\nDESCRIPTION: This command retrieves a list of NGINX Ingress Controller instances and nodes from the specified NGINX Instance Manager host. Replace `<NMS_FQDN>` with the fully-qualified domain name of your NGINX Instance Manager host. The output is a JSON payload containing the desired information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/usage-tracking/get-list-k8s-deployments.md#_snippet_0\n\nLANGUAGE: sh\nCODE:\n```\ncurl -X GET --url \"https://<NMS_FQDN>/api/platform/v1/k8s-usage\"\n```\n\n----------------------------------------\n\nTITLE: Inject command ambiguous error message\nDESCRIPTION: Example of ambiguous error message returned by the inject command of nginx-meshctl. This can be caused by invalid YAML, a down control plane, or incorrect installation namespace. The example demonstrates the output when the inject process fails.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.5.0.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n./build/nginx-meshctl inject < example.yaml\nCannot inject NGINX Service Mesh sidecar.\nError: error formatting response string: invalid syntax\n```\n\n----------------------------------------\n\nTITLE: TLS error in Kubernetes api-server log\nDESCRIPTION: This log snippet shows a TLS error that may occur in the Kubernetes api-server logs after deploying NGINX Service Mesh. The error indicates a problem with the certificate authority (CA) and can lead to failures in subsystems like metrics aggregation, injection, and validation. It demonstrates the type of error message administrators should look for in api-server logs if TLS issues are suspected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.9.0.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nE0105 10:03:45.159812 1 controller.go:116] loading OpenAPI spec for \"v1alpha1.metrics.smi-spec.io\" failed with: failed to retrieve openAPI spec, http error: ResponseCode: 503, Body: error trying to reach service: x509: certificate signed by unknown authority (possibly because of \"x509: ECDSA verification failure\" while trying to verify candidate authority certificate \"NGINX\")\n```\n\n----------------------------------------\n\nTITLE: Limiting API Access with Allow/Deny NGINX\nDESCRIPTION: This snippet restricts access to the `/api` location using the `allow` and `deny` directives.  It allows access only from localhost (127.0.0.1) and denies access from all other IP addresses. This is a security measure to prevent unauthorized access.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_17\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    server {\n        location /api {\n            api   write=on;\n            allow 127.0.0.1; # permit access from localhost\n            deny  all;       # deny access from everywhere else\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create Service Workspace (ACM)\nDESCRIPTION: This command creates a Service Workspace in API Connectivity Manager.  It requires NGINX Management Suite user credentials in the Basic Authentication header for the REST request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_16\n\nLANGUAGE: bash\nCODE:\n```\nPOST https://192.0.2.2/api/acm/v1/services/workspaces\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Agent - Bash\nDESCRIPTION: This snippet shows how to restart the NGINX Agent. This is a workaround for the 'No such process' error that occurs when publishing a configuration, often due to desynchronization between the NGINX Agent and NGINX PID after manually restarting NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/known-issues.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Restore NGINX Controller Cluster Configuration (Bash)\nDESCRIPTION: This command restores the NGINX Controller cluster configuration and encryption keys from a backup file using the `helper.sh` script. The `cluster-config load` subcommand takes the filename of the backup as an argument.  The filename is required to specify the backup to restore from.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh cluster-config load <filename>\n```\n\n----------------------------------------\n\nTITLE: Test AES256-SHA Cipher (Shell)\nDESCRIPTION: This command tests FIPS 140-2 compliance by attempting an SSL/TLS connection using the AES256-SHA cipher.  This cipher is considered secure by NGINX and is permitted under FIPS. The handshake should succeed if the server is FIPS compliant.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/fips-compliance-nginx-plus.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\n(echo \"GET /\" ; sleep 1) | openssl s_client -connect <NGINX-Plus-address>:443 -cipher AES256-SHA\n```\n\n----------------------------------------\n\nTITLE: Run Nginx Container with Volumes (Shell)\nDESCRIPTION: This shell command runs a Docker container named mynginx4 based on the mynginx_image2 image. It maps port 80 on the host to port 80 on the container and runs the container in detached mode (-d).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_25\n\nLANGUAGE: shell\nCODE:\n```\ndocker run --name mynginx4 -p 80:80 -d mynginx_image2\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX App Protect WAF v5 Repository\nDESCRIPTION: This shell command adds the NGINX App Protect WAF v5 apk repository to the system. It retrieves the Alpine version from `/etc/alpine-release`, constructs the repository URL, and appends it to `/etc/apk/repositories` using `tee` with sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-alpine.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"https://pkgs.nginx.com/app-protect-x-oss/alpine/v`egrep -o '^[0-9]+\\.[0-9]+' /etc/alpine-release`/main\\n\" | sudo tee -a /etc/apk/repositories\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Gateway Fabric from Source (NGINX Plus)\nDESCRIPTION: This command installs NGINX Gateway Fabric for NGINX Plus from local source code into the 'nginx-gateway' namespace using Helm. It configures the image repository, enables NGINX Plus features, and sets the image pull secret. Requires Helm 3.0+, kubectl, local access to the Helm chart, and a Docker registry secret.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nhelm install ngf . --set nginx.image.repository=private-registry.nginx.com/nginx-gateway-fabric/nginx-plus --set nginx.plus=true --set serviceAccount.imagePullSecret=nginx-plus-registry-secret -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Using the Chained Certificate in Nginx\nDESCRIPTION: This snippet shows how to configure Nginx to use the chained SSL certificate file created in the previous step. The `ssl_certificate` directive is updated to point to the chained certificate file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen              443 ssl;\n    server_name         www.example.com;\n    ssl_certificate     www.example.com.chained.crt;\n    ssl_certificate_key www.example.com.key;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Download Basic Load Balancing Configuration\nDESCRIPTION: Downloads the basic weblogic load balancing configuration file from a specified URL.  Requires curl to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_7\n\nLANGUAGE: none\nCODE:\n```\nroot# curl https://www.nginx.com/resource/conf/weblogic-basic.conf > weblogic-basic.conf\n```\n\n----------------------------------------\n\nTITLE: Converting User Defined Signatures to JSON (custom tag)\nDESCRIPTION: This example shows how to convert a User Defined Signatures XML file to a JSON file using the `convert-signatures` tool with a custom tag. It's similar to the previous example but includes the `--tag` option to assign a specific tag to the converted signatures.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_22\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker run --rm \\\n -v $(pwd):$(pwd) \\\n --entrypoint=/opt/app_protect/bin/convert-signatures \\\n waf-compiler-<version-tag>:custom \\\n -i $(pwd)/signatures.xml -o $(pwd)/signatures.json --tag \"MyTag\n```\n\n----------------------------------------\n\nTITLE: Start WAF Services with Docker Compose\nDESCRIPTION: Starts the NGINX App Protect WAF services using Docker Compose. This command deploys the services defined in the docker-compose.yml file. The -d flag runs the services in detached mode (in the background).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker compose up -d\n```\n\n----------------------------------------\n\nTITLE: Send POST request within body size limit\nDESCRIPTION: This snippet sends a POST request with a body within the configured client_max_body_size to the coffee application. This should result in a successful response.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee -X POST --data \"this payload is under fifty bytes\"\n```\n\n----------------------------------------\n\nTITLE: Verify Nginx Agent installation on Debian\nDESCRIPTION: This command checks the version of the installed Nginx Agent to verify that the installation was successful on Debian.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx-agent -v\n```\n\n----------------------------------------\n\nTITLE: NGINX Meshctl Top Deployment Command Output\nDESCRIPTION: Displays sample output from the `nginx-meshctl top deployment/productpage-v1` command, providing detailed traffic metrics for the `productpage-v1` deployment. The output shows traffic direction, resource, success rate, latency percentiles (P99, P90, P50), and the number of requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-walkthrough.md#_snippet_8\n\nLANGUAGE: txt\nCODE:\n```\n$ nginx-meshctl top deployment/productpage-v1\n\nDeployment      Direction  Resource            Success Rate  P99    P90    P50   NumRequests\nproductpage-v1\n                To         reviews-v3          100.00%       50ms   48ms   40ms  2\n                To         details-v1          100.00%       20ms   15ms   3ms   6\n                To         reviews-v1          100.00%       99ms   90ms   20ms  3\n                To         reviews-v2          100.00%       100ms  95ms   75ms  4\n                From       nginx-plus-ingress  100.00%       196ms  160ms  75ms  6\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Agent - Yum - Shell\nDESCRIPTION: Installs the nginx-agent package using the yum package manager. This command assumes the Nginx Agent repository has been properly configured. It may prompt the user to accept the GPG key to verify package authenticity.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Enabling Utility Pod and ACM Integration - YAML\nDESCRIPTION: This YAML snippet shows how to enable the `utility` pod and configure API Connectivity Manager (nms-acm) integration in the Helm `values.yaml` file. Setting `utility: true` enables the utility pod.  The nmsModules section is configured to enable ACM and grant it claims to the utility pod.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\nglobal:\n    utility: true\n    nmsModules :\n        nms—acm:\n            enabled: true\n            addClaimsToUtility: true\n```\n\n----------------------------------------\n\nTITLE: Create User Response with SCIM\nDESCRIPTION: This code snippet represents the JSON response received after successfully creating a user in NGINX Instance Manager using the SCIM API. It includes details such as the user's email, external ID, unique ID, metadata (creation and modification timestamps, location, resource type), name, schemas, and username.  The ID is a generated UUID for the created user. Requires a successful POST request to `/api/scim/v2/Users`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/scim-provisioning.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"emails\": [\n    {\n      \"value\": \"idpuser@mydomain.ctrl\"\n    }\n  ],\n  \"externalId\": \"idpuser@mydomain.ctrl\",\n  \"id\": \"dc898740-4e9c-41a4-912c-1f3a20edf66e\",\n  \"meta\": {\n    \"created\": \"2022-06-17T21:03:37.138Z\",\n    \"lastModified\": \"2022-06-17T21:03:37.138Z\",\n    \"location\": \"/api/scim/v2/Users/dc898740-4e9c-41a4-912c-1f3a20edf66e\",\n    \"resourceType\": \"User\"\n  },\n  \"name\": {\n    \"familyName\": \"Example\",\n    \"givenName\": \"SSO\"\n  },\n  \"schemas\": [\n    \"urn:ietf:params:scim:schemas:core:2.0:User\"\n  ],\n  \"userName\": \"idpuser@mydomain.ctrl\"\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstalling the Controller Agent - CentOS/RHEL\nDESCRIPTION: This command uninstalls the NGINX Controller Agent package from CentOS or Red Hat Enterprise Linux systems. It removes the installed package and associated files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-instances.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nyum remove nginx-controller-agent\n```\n\n----------------------------------------\n\nTITLE: Querying Active Directory Group with ldapsearch\nDESCRIPTION: This command uses ldapsearch to query for a specific group in Active Directory. It requires ldapsearch to be installed and configured to connect to the LDAP server. The command specifies the LDAP server address, base DN, bind DN, and search filter. The -ZZ option enables TLS encryption, -W prompts for the bind password, -H specifies the LDAP server, -b specifies the base DN, -D specifies the bind DN, and the final string specifies the search filter to find a group with the common name 'devops'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nldapsearch -ZZ -W -H ldap://ldap.example.com \\\n             -b \"DC=ldap,DC=example,DC=com\" \\\n             -D \"uid=search-user,ou=People,dc=example,dc=com\" \\\n             \"(&(objectClass=group)(CN=devops))\"\n```\n\n----------------------------------------\n\nTITLE: Disabling Default NGINX Module\nDESCRIPTION: This example shows how to disable a default NGINX module during the configuration process.  It uses the `--without-<MODULE-NAME>` option with the `configure` script to exclude the specified module from the compiled binary. In this specific instance, it disables the `http_empty_gif_module`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_54\n\nLANGUAGE: shell\nCODE:\n```\n./configure\n--sbin-path=/usr/local/nginx/nginx\n--conf-path=/usr/local/nginx/nginx.conf\n--pid-path=/usr/local/nginx/nginx.pid\n--with-http_ssl_module\n--with-stream\n--with-pcre=../pcre2-10.43\n--with-zlib=../zlib-1.3.1\n--without-http_empty_gif_module\n```\n\n----------------------------------------\n\nTITLE: Prometheus Query for P99 Latency\nDESCRIPTION: This Prometheus query calculates the p99 latency of all requests sent from the deployment `productpage-v1` in the namespace `prod` to the service `details` in the namespace `prod` over the last 30 seconds. It uses `nginxplus_upstream_server_response_latency_ms_bucket` and filters by `namespace`, `deployment`, and `dst_service` labels.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_10\n\nLANGUAGE: promQL\nCODE:\n```\nhistogram_quantile(0.99, sum(irate(nginxplus_upstream_server_response_latency_ms_bucket{namespace=\"prod\",deployment=\"productpage-v1\",dst_service=\"details\"}[30s])) by (le))\n```\n\n----------------------------------------\n\nTITLE: Azure CLI: Get Resource ID of Key Vault\nDESCRIPTION: This code snippet retrieves the resource ID of an Azure Key Vault using the Azure CLI. It requires the `KV_NAME` (key vault name) and `KV_RESOURCE_GROUP` (resource group name) environment variables to be set. The command queries the Azure keyvault service and extracts the `id` value.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nkey_vault_id=$(az keyvault show --name $KV_NAME \\\n      --resource-group $KV_RESOURCE_GROUP \\\n      --query id --output tsv)\n```\n\n----------------------------------------\n\nTITLE: Remove NGINX Repo Files (Shell)\nDESCRIPTION: Removes any previously downloaded NGINX repository configuration files from the `/etc/yum.repos.d` directory. This step is necessary to ensure that the system uses the latest repository configurations and avoids conflicts with older versions. The `rm` command is used with `sudo` for the required permissions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-rhel-cen-74.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo rm /etc/yum.repos.d/nginx*.repo\nsudo rm /etc/yum.repos.d/*app-protect*.repo\n```\n\n----------------------------------------\n\nTITLE: Update Backend in NGINX Configuration\nDESCRIPTION: This snippet shows how to update the `my_backend` upstream in the `frontend.conf` file with the address of the application that you want to add OIDC authorization to.\nThe `upstream` directive defines a group of servers that can be used to forward requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/onelogin.md#_snippet_3\n\nLANGUAGE: Nginx configuration file\nCODE:\n```\nupstream my_backend {\n    zone my_backend 64k;\n    server my-backend-app.com:80;\n}\n```\n\n----------------------------------------\n\nTITLE: Testing stub_status Configuration\nDESCRIPTION: This snippet shows how to test the stub_status configuration using `curl`. It sends a request to `http://127.0.0.1/nginx_status` and expects output showing active connections, server accepts/handled/requests, and reading/writing/waiting connections. The output format will be interpreted by Nginx Amplify Agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/configuring-metric-collection.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n$ curl http://127.0.0.1/nginx_status\nActive connections: 2\nserver accepts handled requests\n 344014 344014 661581\nReading: 0 Writing: 1 Waiting: 1\n```\n\n----------------------------------------\n\nTITLE: OpenAPI Server URL Templating - JSON\nDESCRIPTION: This JSON snippet shows an example of server URL templating within an OpenAPI specification. It defines variables for the server, version, basePathVersionAppendRule and stripBasePathVersion, allowing dynamic configuration of the API endpoint. This enables flexible deployment environments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/release-notes.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\nservers:\n url: http://{server}.hostname.com/api/{version}\n  variables:\n    server:\n      default: customers\n    version:\n      default: v1\n    basePathVersionAppendRule:\n      default : none\n    stripBasePathVersion:\n      default : false\n```\n\n----------------------------------------\n\nTITLE: Compile Security Policy with NGINX App Protect WAF Compiler\nDESCRIPTION: This command compiles a security policy from a JSON file into a policy bundle using the NGINX App Protect WAF compiler. It mounts the current directory as a volume and specifies the policy file and output bundle file.  The `-rm` flag ensures the container is removed after execution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ndocker run --rm \\\n -v $(pwd):$(pwd) \\\n waf-compiler-<version-tag>:custom \\\n -p $(pwd)/policy.json -o $(pwd)/compiled_policy.tgz\n```\n\n----------------------------------------\n\nTITLE: Restart controller-agent service\nDESCRIPTION: This command restarts the `controller-agent` service on datapaths. It's a workaround for UDP statistics not being reported correctly after installing NGINX ADC Controller 3.22. It ensures the agent is properly connected and collecting the statistics. Requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart controller-agent\n```\n\n----------------------------------------\n\nTITLE: Configure basic HTTPRoute - YAML\nDESCRIPTION: Creates a basic HTTPRoute resource that exposes the headers application outside the cluster. This route does not include any header modification filters initially.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: headers\nspec:\n  parentRefs:\n  - name: gateway\n    sectionName: http\n  hostnames:\n  - \"cafe.example.com\"\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /headers\n    backendRefs:\n    - name: headers\n      port: 80\nEOF\n```\n\n----------------------------------------\n\nTITLE: Setting 'down' Parameter for a Server via API with PATCH Method (Shell)\nDESCRIPTION: This command sets the `down` parameter for a specific server in the upstream group using the PATCH method via curl. It updates the server configuration by sending a JSON payload with the `down` parameter set to true. The target server is identified by its ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_23\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X PATCH -d '{ \"down\": true }' -s 'http://192.168.1.23/api/9/http/upstreams/appservers/servers/0'\n```\n\n----------------------------------------\n\nTITLE: Upload Policy to Instance Manager (Shell)\nDESCRIPTION: This `curl` command sends a POST request to the NGINX Instance Manager REST API to create a new security policy. It requires a valid access token and the `policy.json` file containing the JSON payload defined previously.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X POST https://<NIM_FQDN>/api/platform/v1/security/policies \\\n-H \"Authorization: Bearer <access token>\" \\\n-H \"Content-Type: application/json\" \\\n-d @policy.json\n```\n\n----------------------------------------\n\nTITLE: Configure Reverse Proxy with Proxy Pass in Nginx\nDESCRIPTION: This snippet configures a location block that proxies all traffic to the 'oracle' upstream group. It sets the 'Host' header to the value of the incoming request's host header. This allows Nginx to forward requests to the backend servers in the upstream group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_22\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation / {\n     proxy_pass http://oracle;\n     proxy_set_header Host $host;\n}\n```\n\n----------------------------------------\n\nTITLE: Create gRPC Health Check Policy - JSON Request\nDESCRIPTION: This JSON payload configures a gRPC health check policy for an NGINX API proxy. The policy defines the health check parameters, including port, interval, success/failure thresholds, timeouts, and gRPC status.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/health-check.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"policies\": {\n    \"grpc-backend-health-check\": [\n      {\n        \"action\": {\n          \"mandatory\": true,\n          \"persistent\": true,\n          \"port\": 84,\n          \"interval\": 7,\n          \"fails\": 3,\n          \"passes\": 5,\n          \"connectTimeout\": \"6s\",\n          \"readTimeout\": \"5s\",\n          \"grpc\": {\n            \"status\": 12\n          }\n        }\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Check Instance Publication Status (GET) - Shell\nDESCRIPTION: This code snippet shows how to view the deployment status for a specific instance by providing the system UID and instance UID in a GET request.  Requires `curl`, a valid access token, the system UID, and the instance UID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_27\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET \"https://{{NIM_FQDN}}/api/platform/v1/systems/<system-uid>/instances/<instance-uid>\" \\\n    -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Check UDP Listener Logs\nDESCRIPTION: This command checks the logs of the `udp-listener` container within the `udp-listener` Pod. It uses `kubectl` to retrieve the logs and filters for the `udp-listener` container. The expected output is the \"UDP Datagram Message\", verifying that the message was received by the application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-udp-walkthrough.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\n$ kubectl logs udp-listener-59665d7ffc-drzh2 -c udp-listener\nListening on UDP port 5005\nUDP Datagram Message\n```\n\n----------------------------------------\n\nTITLE: Configuring Virtual Server on BIG-IP LTM\nDESCRIPTION: This code snippet demonstrates how to create a virtual server on BIG-IP LTM, listening on port 80 and distributing traffic to a pool of backend servers. It involves creating a pool, a virtual server, and saving the system configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\n# create pool test_pool members add { 10.10.10.10:80 10.10.10.20:80 }\n# create virtual test_virtual { destination 192.168.10.10:80 pool test_pool source-address-translation { type automap } ip-protocol tcp profiles add { http } }\n# save sys config\n```\n\n----------------------------------------\n\nTITLE: Enabling mTLS with CLI Flags - Bash\nDESCRIPTION: This snippet shows how to enable mTLS for the NGINX Agent using command-line flags. It sets the `--tls-cert`, `--tls-key`, and `--tls-ca` options to specify the paths to the certificate, key, and CA certificate files. The `--tls-enable` flag enables TLS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/encrypt-communication.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nnginx-agent --tls-cert \"path-to-cert\" --tls-key \"path-to-key\" --tls-ca \"path-to-ca-cert\" --tls-enable\n```\n\n----------------------------------------\n\nTITLE: Syslog Message Example\nDESCRIPTION: This example demonstrates the format of a syslog message sent by the forwarder, compliant with RFC-5424 and RFC-5425, including octet count delimiting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/integrations/syslog-integration.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n<6>1 2019-09-10T06:40:15+02:00 controller.fqdn.svc nginx_controller 1 ngxctrl [dimensions alias=\"my_system\" category=\"agent event\" counter=\"1\" instance=\"\" instance.tags=\"tag1,tag2\" level=\"INFO\" local_id=\"d23c85484ee760ee5f4619c0434e1968b5290964487541da0889964eb783613c\" location=\"\" message=\"nginx stub_status detected, https://127.0.0.1:443/basic_status\" parent_hostname=\"d0784771a503\" root_uuid=\"49946669ca315d45bae1d6c05de9bd7e\"] nginx stub_status detected, https://127.0.0.1:443/basic_status\n```\n\n----------------------------------------\n\nTITLE: Setting Up DNF Repository for NGINX Agent (Amazon Linux 2023)\nDESCRIPTION: This command creates the `/etc/yum.repos.d/nginx-agent.repo` file, which configures the dnf package manager to use the NGINX Agent repository for Amazon Linux 2023. The repository URL, GPG key, and other settings are defined in this file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_30\n\nLANGUAGE: shell\nCODE:\n```\n[nginx-agent]\nname=nginx agent repo\nbaseurl=https://packages.nginx.org/nginx-agent/amzn/2023/$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n```\n\n----------------------------------------\n\nTITLE: Example valid Proxy Buffers number and size\nDESCRIPTION: This text example shows a valid configuration where the proxy busy buffers size is less than the total buffer size minus one buffer, demonstrating a correct setting for NGINX proxy buffers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/http-backend-configuration.md#_snippet_5\n\nLANGUAGE: text\nCODE:\n```\nproxy busy buffers size : 16 KB\nproxy buffer number     : 8\nproxy buffer size       : 4 KB\ntotal buffer size       : 32 KB\n\nbusy_buffers_size < total buffer size - buffer\n16 KB < 32 KB - 4 KB\n16 KB < 28 KB\nTrue: Valid proxy buffer number & size configuration\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect DoS Monitor Configuration\nDESCRIPTION: This code snippet demonstrates the proper configuration of the `app_protect_dos_monitor` directive within an NGINX server block.  It is crucial to ensure the port configuration corresponds to the port the server is listening on to prevent false attack declarations. The snippet provides a basic configuration example with the server listening on port 8080.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-2.2.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nserver {\n    listen 8080;\n    server_name myservice.com;\n    location / {\n        app_protect_dos_monitor \"myservice.com:8080/\";\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Full Configuration Example for NGINX Reporting\nDESCRIPTION: This is a complete configuration example demonstrating how to configure NGINX Plus instance reporting, including custom resolver, uid_file, SSL protocols, certificates, and verification settings within the `mgmt` block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/usage-tracking/agentless-reporting.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\n#...\n\nmgmt {\n    usage_report endpoint=nginx-mgmt.local interval=30m;\n    resolver     DNS_IP;\n\n    uid_file /var/lib/nginx/nginx.id;\n\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers   DEFAULT;\n\n    ssl_certificate     client_cert.pem;\n    ssl_certificate_key client_cert.key;\n\n    ssl_trusted_certificate  trusted_ca_cert.crt;\n    ssl_verify               on;\n    ssl_verify_depth         2;\n}\n\n#...\n```\n\n----------------------------------------\n\nTITLE: Configure OAB Authentication PowerShell\nDESCRIPTION: This command configures the authentication methods and external URL for the Offline Address Book (OAB) virtual directory using the Set-OabVirtualDirectory cmdlet in PowerShell. It disables Windows Authentication and enables Basic Authentication, also setting the ExternalUrl.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_8\n\nLANGUAGE: PowerShell\nCODE:\n```\nC:\\> Set-OabVirtualDirectory -WindowsAuthentication 0\n-BasicAuthentication 1\n-ExternalUrl https://mail.company.com/OAB\n```\n\n----------------------------------------\n\nTITLE: YUM Installation Error Example\nDESCRIPTION: This code snippet shows an example of a yum installation error that can occur when the app-protect-security-updates repository is missing during NGINX App Protect WAF installation. The error indicates missing dependencies like app-protect-attack-signatures and app-protect-threat-campaigns.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/troubleshooting-guide/troubleshooting.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nError: Package: app-protect-compiler-1.234.0-1.el7.ngx.x86_64 (app-protect)\nRequires: app-protect-attack-signatures\nError: Package: app-protect-compiler-1.234.0-1.el7.ngx.x86_64 (app-protect)\nRequires: app-protect-threat-campaigns\n```\n\n----------------------------------------\n\nTITLE: Markdown example for Steps Section\nDESCRIPTION: This snippet demonstrates the Markdown formatting for structuring a 'Steps' section in a how-to guide. It includes a task name, optional description, numbered steps, and optional substeps with proper indentation.\nSOURCE: https://github.com/nginx/documentation/blob/main/templates/how-to/guide-how-to.md#_snippet_2\n\nLANGUAGE: markdown\nCODE:\n```\n{Task name}\n\n{Optional: Provide a concise description of the purpose of this task. Only include this if the purpose is not clear from the task title.}\n\n1. {Write the action to take here. Start with a verb.}\n\n   {Optional: Explanatory text}\n\n   {Optional: Code sample or screenshot that helps your users complete this step}\n\n   {Optional: Result}\n\n{Optional: If needed, you can add substeps below a primary step. Make sure to indent the substep one tab space over if you're using Markdown.}\n```\n\n----------------------------------------\n\nTITLE: Configuring Slow Start for Tomcat Servers\nDESCRIPTION: This configures a slow start period of 30 seconds for the Tomcat application servers within the upstream group. This allows servers to gradually increase traffic after recovery or when newly added, preventing overload. Requires the upstream block to be defined.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_33\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'upstream' block\n#...\nserver 10.100.100.11:8080 slow_start=30s;\nserver 10.100.100.12:8080 slow_start=30s;\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Plus Usage Reporting\nDESCRIPTION: Configures the NGINX Plus instance to report usage to NGINX Instance Manager. The usage_report directive specifies the domain name or IP address of the NGINX Instance Manager, and the enforce_initial_report directive enables a grace period for sending the initial usage report.  NIM_FQDN needs to be replaced with the fully qualified domain name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_51\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n    usage_report endpoint=NIM_FQDN;\n    enforce_initial_report off;\n}\n```\n\n----------------------------------------\n\nTITLE: Kubernetes dry-run warning during NGINX Controller Installation\nDESCRIPTION: This snippet shows a warning message that may appear during NGINX Controller installation on Red Hat Enterprise Linux 8 when checking Kubernetes. The warning indicates the deprecation of the `--dry-run` flag. It's safe to ignore this warning.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.8.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\nW0304 00:13:38.871876 1594252 helpers.go:553] --dry-run is deprecated and can be replaced with --dry-run=client.\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Open Source Packages on Debian\nDESCRIPTION: These commands create a directory, update package lists, and download NGINX Open Source packages, including dependencies using apt-get on Debian. The packages are downloaded to /etc/packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/packages/\ncd /etc/packages/\nsudo apt-get update\nsudo bash -c 'for i in $(apt-cache depends --recurse --no-recommends --no-suggests --no-conflicts --no-breaks --no-replaces --no-enhances nginx=1.25.5-1~`lsb_release -cs` app-protect-module-oss | grep \"^\\w\" | sort -u); do apt-get download $i; done 2>>/etc/packages/errors.txt'\n```\n\n----------------------------------------\n\nTITLE: JWT File Validation - Bash\nDESCRIPTION: This snippet validates the JWT file path. It checks if the path is empty and if the file exists. If the file doesn't exist, or the path is empty, it prints an error message and exits. Otherwise, it confirms the file's presence.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nif [ -z \"$jwt_file\" ]; then\n    echo \"JWT file path is not defined. Please set the JWT_FILE variable.\"\n    exit 1\nelif [ ! -f \"$jwt_file\" ]; then\n    echo \"JWT file not found: $jwt_file\"\n    exit 1\nelse\n    echo \"JWT file found: $jwt_file\"\nfi\n```\n\n----------------------------------------\n\nTITLE: Fetching OpenID Configuration using curl\nDESCRIPTION: This command retrieves the OpenID Connect configuration from the Ping Identity server using curl. The output is piped to the python json.tool module to format the JSON response for readability. The <Ping-Identity-Client-ID> variable should be replaced with the actual Client ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/ping-identity.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\n$ curl sso.connect.pingidentity.com/<Ping-Identity-Client-ID>/.well-known/openid-configuration | python -m json.tool\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Open Source Packages on Ubuntu\nDESCRIPTION: These commands create a directory, update package lists, and download NGINX Open Source packages, including dependencies using apt-get on Ubuntu. The packages are downloaded to /etc/packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_25\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/packages/\ncd /etc/packages/\nsudo apt-get update\nsudo bash -c 'for i in $(apt-cache depends --recurse --no-recommends --no-suggests --no-conflicts --no-breaks --no-replaces --no-enhances nginx=1.25.5-1~`lsb_release -cs` app-protect-module-oss | grep \"^\\w\" | sort -u); do apt-get download $i; done 2>>/etc/packages/errors.txt'\n```\n\n----------------------------------------\n\nTITLE: Set Keycloak Secret as Environment Variable (Bash)\nDESCRIPTION: This command sets the Keycloak client secret as an environment variable. The <secret> placeholder should be replaced with the actual secret value obtained from Keycloak. This environment variable is used by NGINX Instance Manager to authenticate with Keycloak. It's crucial to secure access to the environment where this variable is set.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nexport KEYCLOAK_SECRET=<secret>\n```\n\n----------------------------------------\n\nTITLE: Configuring API Access Control\nDESCRIPTION: This snippet configures a `location` block for the NGINX Plus API, enabling dynamic reconfiguration. It sets `api write=on` to allow write operations and restricts access to the localhost address (127.0.0.1) using `allow` and `deny` directives.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_35\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /api {\n    api write=on;\n    allow 127.0.0.1;\n    deny all;\n}\n```\n\n----------------------------------------\n\nTITLE: Unsupported NGINX App Protect Configuration\nDESCRIPTION: This NGINX configuration is unsupported due to the incompatibility of the `slice` directive (which expects the Range header) within a location where `app_protect_enable on` is set. This combination leads to issues as App Protect WAF may interfere with the handling of the Range header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/unsupported-configuration.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n\nhttp {\n    server {\n        listen 127.0.0.1:8080;\n        server_name localhost;\n\n        location / {\n            app_protect_enable on;\n            proxy_pass http://1.2.3.4$request_uri;\n            slice 2;\n            proxy_set_header Range $slice_range;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Example: Running NGINX Plus and NGINX Agent (Debian/Ubuntu) (Shell)\nDESCRIPTION: This snippet provides an example of running a Docker container with NGINX Plus and the NGINX Agent on Debian or Ubuntu. It uses the same environment variables as the previous example but specifies a concrete image tag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_14\n\nLANGUAGE: sh\nCODE:\n```\nsudo docker run \\\n--env=NGINX_LICENSE_JWT=$(cat license.jwt) \\\n--env=NGINX_AGENT_SERVER_GRPCPORT=443 \\\n--env=NGINX_AGENT_SERVER_HOST=agent.connect.nginx.com \\\n--env=NGINX_AGENT_SERVER_TOKEN=\"YOUR_NGINX_ONE_DATA_PLANE_KEY\" \\\n--env=NGINX_AGENT_TLS_ENABLE=true \\\n--restart=always \\\n--runtime=runc \\\n-d private-registry.nginx.com/nginx-plus/agent:debian\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Instance Manager (DEB) - Bash\nDESCRIPTION: Installs the NGINX Instance Manager package on Debian and Ubuntu systems using the `apt-get` command.  The `-y` flag automatically answers yes to prompts. The `-f` flag attempts to correct broken dependencies. The <user> and <version> placeholders need to be replaced with the actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide-deprecated.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get -y install -f /home/<user>/nms-instance-manager_<version>_amd64.deb\n```\n\n----------------------------------------\n\nTITLE: Querying App Security Metrics for Request Outcomes with REST API\nDESCRIPTION: This example shows how to query App Security metrics to retrieve the number of requests based on their outcome (Passed or Rejected) using the NGINX Controller REST API.  It groups the results by 'request_outcome' and specifies a resolution of 30 minutes. The startTime is set to 0 and endTime to now.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/view-app-security-analytics.md#_snippet_0\n\nLANGUAGE: curl\nCODE:\n```\nhttps://{{host}}/api/v1/analytics/metrics?\n    startTime=0&\n    endTime=now&\n    names=sum(http.request.count)&\n    groupBy=request_outcome&\n    resolution=30m\n```\n\n----------------------------------------\n\nTITLE: Monitoring Keepalived Logs and IP Address (bash)\nDESCRIPTION: This snippet monitors the `keepalived` service logs and displays the IP address configuration. The `journalctl` command shows the state transitions of `keepalived`, while `ip addr show` provides information about the IP addresses assigned to the interface.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/ha-data-plane.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\njournalctl -u keepalived.service -f\nip addr show\n```\n\n----------------------------------------\n\nTITLE: Defining Connection Limit Zone - Nginx\nDESCRIPTION: This snippet defines a shared memory zone using the `limit_conn_zone` directive to store connection limits per IP address. The `$binary_remote_addr` variable is used as the key, representing the client's IP address. The zone is named `ip_addr` and allocated 10MB of memory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-tcp.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    limit_conn_zone $binary_remote_addr zone=ip_addr:10m;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling Security Logging in NGINX\nDESCRIPTION: This snippet shows how to enable or disable the security logger using the `app_protect_dos_security_log_enable` directive. This directive controls whether security-related events are logged. By default, if not written, the logger is disabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_dos_security_log_enable on;\n```\n\n----------------------------------------\n\nTITLE: Updating Helm Repositories (helm repo update)\nDESCRIPTION: This command updates the local Helm repository cache to ensure the latest charts are available. It should be run after adding a new repository or before installing a chart.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nhelm repo update\n```\n\n----------------------------------------\n\nTITLE: Configuration Apply Error Message\nDESCRIPTION: This text represents an error message encountered when publishing a configuration due to a file residing outside the allowed directory list. This error highlights the importance of maintaining auxiliary files within the designated directory for successful deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/troubleshooting.md#_snippet_8\n\nLANGUAGE: text\nCODE:\n```\nConfig apply failed (write): the file <filename> is outside the allowed directory list.\n```\n\n----------------------------------------\n\nTITLE: JSON Response Example\nDESCRIPTION: This is an example of the JSON response received after successfully uploading the NGINX repository certificate and key to NGINX Instance Manager. It contains metadata about the certificate, as well as the masked key and cert data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"certAssignmentDetails\": [],\n  \"certMetadata\": [\n    {\n      \"authorityKeyIdentifier\": \"<fingerprint>\",\n      \"commonName\": \"<subscription name>\",\n      \"expired\": false,\n      \"expiry\": 59789838,\n      \"issuer\": \"C=US, ST=Washington, L=Seattle, Inc., O=F5 Networks\\\\, OU=Certificate Authority, CN=F5 PRD Issuing Certificate Authority TEEM V1\",\n      \"publicKeyType\": \"RSA (2048 bit)\",\n      \"serialNumber\": \"<serial number>\",\n      \"signatureAlgorithm\": \"SHA256-RSA\",\n      \"subject\": \"CN=<subscription name>\",\n      \"subjectAlternativeName\": \"\",\n      \"subjectKeyIdentifier\": \"<fingerprint>\",\n      \"thumbprint\": \"<thumbprint>\",\n      \"thumbprintAlgorithm\": \"SHA256-RSA\",\n      \"validFrom\": \"2021-12-21T16:57:55Z\",\n      \"validTo\": \"2024-12-20T00:00:00Z\",\n      \"version\": 3\n    }\n  ],\n  \"certPEMDetails\": {\n    \"caCerts\": [],\n    \"password\": \"**********\",\n    \"privateKey\": \"**********\",\n    \"publicCert\": \"[content snipped]\",\n    \"type\": \"PEM\"\n  },\n  \"created\": \"2023-01-27T23:42:41.587760092Z\",\n  \"modified\": \"2023-01-27T23:42:41.587760092Z\",\n  \"name\": \"nginx-repo\",\n  \"serialNumber\": \"<serial number>\",\n  \"uid\": \"d08d9f54-58dd-447a-a71d-6fa5aa0d880c\",\n  \"validFrom\": \"2021-12-21T16:57:55Z\",\n  \"validTo\": \"2024-12-20T00:00:00Z\"\n}\n```\n\n----------------------------------------\n\nTITLE: Start, Status, and Enable Docker Service\nDESCRIPTION: These commands manage the Docker service using `systemctl`.  `start` initiates the service, `status` checks its current state, and `enable` configures it to start automatically on system boot.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start docker.service\n```\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl status docker.service\n```\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl enable docker.service\n```\n\n----------------------------------------\n\nTITLE: Saving the waf-enforcer Docker image to a tar file\nDESCRIPTION: This snippet saves the `waf-enforcer` Docker image to a tar file for transferring to an offline machine. Replace `5.2.0` with the actual release version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_40\n\nLANGUAGE: shell\nCODE:\n```\ndocker save -o waf-enforcer.tar waf-enforcer:5.2.0\n```\n\n----------------------------------------\n\nTITLE: Customize Helm Chart Values (values.yaml)\nDESCRIPTION: This YAML snippet demonstrates the structure of a `values.yaml` file, used to customize the NGINX Instance Manager Helm chart deployment. It sets the `imagePullSecrets` to use the 'regcred' secret and defines the Docker image repository and tag for each NGINX Instance Manager component (apigw, core, dpm, ingestion, integrations, secmon, utility). Replace `<version>` with the desired NGINX Instance Manager version tag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_8\n\nLANGUAGE: yaml\nCODE:\n```\nimagePullSecrets:\n    - name: regcred\napigw:\n    image:\n        repository: private-registry.nginx.com/nms/apigw\n        tag: <version>\ncore:\n    image:\n        repository: private-registry.nginx.com/nms/core\n        tag: <version>\ndpm:\n    image:\n        repository: private-registry.nginx.com/nms/dpm\n        tag: <version>\ningestion:\n    image:\n        repository: private-registry.nginx.com/nms/ingestion\n        tag: <version>\nintegrations:\n    image:\n        repository: private-registry.nginx.com/nms/integrations\n        tag: <version>\nsecmon:\n    image:\n        repository: private-registry.nginx.com/nms/secmon\n        tag: <version>\nutility:\n    image:\n        repository: private-registry.nginx.com/nms/utility\n        tag: <version>\n```\n\n----------------------------------------\n\nTITLE: Setting Minimum Uses for Caching in Nginx\nDESCRIPTION: This snippet defines the minimum number of times a request with the same key must be made before the response is cached. This prevents caching of infrequently accessed content, saving cache space. This can be useful for filtering out rarely used resources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_min_uses 5;\n```\n\n----------------------------------------\n\nTITLE: Checking ClickHouse Version (clickhouse-server)\nDESCRIPTION: This command checks the version of the ClickHouse server. It is used to verify that the installed version supports backup and restore functionality. It requires the `clickhouse-server` executable to be in the system's PATH.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_21\n\nLANGUAGE: shell\nCODE:\n```\nclickhouse-server --version\n```\n\n----------------------------------------\n\nTITLE: `jq` Command Not Found Error Message\nDESCRIPTION: This snippet shows an error message encountered during the installation of NGINX Controller on Red Hat, indicating that the `jq` command was not found. The surrounding text explains that this error is non-fatal and does not signify a problem with the installation process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.21.md#_snippet_3\n\nLANGUAGE: text\nCODE:\n```\n/opt/nginx-controller/helper.sh: line 726: jq: command not found.\n```\n\n----------------------------------------\n\nTITLE: Configure Default Rate Limiting (YAML)\nDESCRIPTION: This YAML configuration defines a default RateLimit resource for all traffic to a destination service. By omitting the `sources` field, the rate limit applies to all requests sent to the `dest-svc` service, restricting traffic to 10 requests per second.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/smi-traffic-policies.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi.nginx.com/v1alpha2\nkind: RateLimit\nmetadata:\n  name: dest-svc-default\n  namespace: default\nspec:\n  destination:\n    kind: Service\n    name: dest-svc\n    namespace: default\n  name: 10rs\n  rate: 10r/s\n```\n\n----------------------------------------\n\nTITLE: Enable HTTP/2 Support in Nginx\nDESCRIPTION: This configuration snippet enables HTTP/2 support for a server block. The `http2 on;` directive must be placed within the `server` block for HTTPS traffic. This allows clients to communicate with the server using the HTTP/2 protocol, potentially improving performance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_22\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlisten 443 ssl;\nhttp2  on;\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent with Instance Group using wget\nDESCRIPTION: This snippet explains how to install NGINX Agent and add it to a specific instance group using the `--instance-group` flag with wget.  It downloads, makes executable, and runs install.sh\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/agent/installation/install-agent-api.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nwget https://<NIM_FQDN>/install/nginx-agent -O install.sh\nchmod u+x install.sh\nsudo ./install.sh --instance-group <instance group>\n```\n\n----------------------------------------\n\nTITLE: Apply Kubernetes manifest for egress driver (Bash)\nDESCRIPTION: This command applies a Kubernetes manifest file (`egress-driver.yaml`) to create the `sender` application (named `egress-driver`) within the `default` namespace. This application sends requests to the `target-v1-0.legacy` service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f egress-driver.yaml\n```\n\n----------------------------------------\n\nTITLE: Reboot Server to Trigger Failover\nDESCRIPTION: This command reboots the server, triggering a failover.  This is a destructive action.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nsudo reboot\n```\n\n----------------------------------------\n\nTITLE: Install NJS Module on CentOS/RHEL/Oracle Linux\nDESCRIPTION: This command installs the NGINX JavaScript module (njs) on CentOS, RHEL, and Oracle Linux based systems. It requires root privileges and assumes that the NGINX Plus repository is properly configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/ping-identity.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Configuration Load Success Log Event JSON\nDESCRIPTION: This JSON snippet represents a configuration load success event in NGINX App Protect DoS. It includes the event type, software version, and an optional error message containing warnings.  This event confirms that the App Protect DoS configuration has loaded successfully.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/operation-log.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"event\": \"configuration_load_success\",\n    \"software_version\": \"x.x.x.x.x\",\n    \"error_message\": \"warning if exists...\"\n}\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Plus Version\nDESCRIPTION: This command checks the installed NGINX Plus version. It's crucial to ensure you're running NGINX Plus Release 34 or later for native OIDC support.  The expected output is the nginx version including the nginx-plus release.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/active-directory-federation-services.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nnginx -v\n```\n\n----------------------------------------\n\nTITLE: Add delayed shutdown hooks to nginx container\nDESCRIPTION: This YAML snippet adds a `preStop` lifecycle hook to the `nginx` container, causing it to delay its shutdown process by executing the `/bin/sleep \"40\"` command. This allows existing connections to close gracefully during pod termination.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_13\n\nLANGUAGE: yaml\nCODE:\n```\n<...>\nname: nginx\n<...>\nlifecycle:\n  preStop:\n    exec:\n      command:\n      - /bin/sleep\n      - \"40\"\n<...>\n```\n\n----------------------------------------\n\nTITLE: Logging to Syslog Configuration (NGINX)\nDESCRIPTION: This snippet demonstrates how to configure NGINX to log to a syslog server.  It shows examples for both error logs and access logs, including specifying the server address (UNIX socket and IPv6 address with port), facility, tag, and severity level.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/logging.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nerror_log  syslog:server=unix:/var/log/nginx.sock debug;\naccess_log syslog:server=[2001:db8::1]:1234,facility=local7,tag=nginx,severity=info;\n```\n\n----------------------------------------\n\nTITLE: Implementing HTTP basic authentication in Nginx\nDESCRIPTION: This code shows how to implement HTTP basic authentication to restrict access to PATCH, POST, and DELETE methods, allowing access to only authorized users. This is a common method for securing APIs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/live-activity-monitoring.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    server {\n        listen 192.168.1.23;\n        # ...\n        location /api {\n            limit_except GET {\n                auth_basic \"NGINX Plus API\";\n                auth_basic_user_file /path/to/passwd/file;\n            }\n            app_protect_dos_api;\n            allow 192.168.1.0/24;\n            deny  all;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Update CVE List - Bash\nDESCRIPTION: Manually updates the CVE list by downloading the latest CVE XML file from the nginx.org website and replacing the existing `cve.xml` file in the `/usr/share/nms` directory. It then restarts the Data Plane Manager service (nms-dpm).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide-deprecated.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nsudo chmod 777 /usr/share/nms/cve.xml && \\\nsudo curl -s http://hg.nginx.org/nginx.org/raw-file/tip/xml/en/security_advisories.xml > /usr/share/nms/cve.xml && \\\nsudo chmod 644 /usr/share/nms/cve.xml && \\\nsudo systemctl restart nms-dpm\n```\n\n----------------------------------------\n\nTITLE: Reverse Proxy Configuration with Nginx App Protect WAF\nDESCRIPTION: This Nginx server configuration listens on port 80 and acts as a reverse proxy. It enables Nginx App Protect WAF to protect the application. It forwards incoming requests to the upstream server at 127.0.0.1:8080. The client_max_body_size is set to 0, and the proxy_http_version is set to 1.1.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/default-conf-hostname.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80;\n    server_name domain.com;\n\n    proxy_http_version 1.1;\n\n    location / {\n\n        # NGINX App Protect WAF\n        app_protect_enable on;\n\n        client_max_body_size 0;\n        default_type text/html;\n        proxy_pass http://127.0.0.1:8080/;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Instance Manager Helm chart (Bash)\nDESCRIPTION: This snippet demonstrates how to download the latest NGINX Instance Manager Helm chart from the nginx-stable repository. It adds the repository, updates the Helm repositories, pulls the chart, and extracts the downloaded archive. The extracted archive contains the support package script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/support/k8s-support-package.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nhelm repo add nginx-stable https://helm.nginx.com/stable\nhelm repo update\nhelm pull nginx-stable/nms\ntar zxvf nms-<version>.tgz\n```\n\n----------------------------------------\n\nTITLE: Define Proxy Cache Path in Nginx\nDESCRIPTION: This directive defines the path for the proxy cache and allocates shared memory for storing cache keys and metadata. The `keys_zone` parameter specifies the name and size of the shared memory zone. This configuration is required for enabling content caching for backend responses.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_20\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nproxy_cache_path /tmp/NGINX_cache/ keys_zone=backcache:10m;\n```\n\n----------------------------------------\n\nTITLE: Simple Directives in NGINX Configuration\nDESCRIPTION: This code snippet demonstrates simple directives in an NGINX configuration file. These directives are single-line statements that end with a semicolon (;).  They are used to set basic parameters for the NGINX server, such as the user, error log location, and number of worker processes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/basic-functionality/managing-configuration-files.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nuser             nobody;\nerror_log        logs/error.log notice;\nworker_processes 1;\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Agent Features (YAML)\nDESCRIPTION: Configures the NGINX Agent to enable specific features such as metrics collection, metrics throttling, and data plane status reporting.  This snippet demonstrates enabling specific features by listing them under the `features` key in the configuration file. Other features will be disabled implicitly. Newlines are represented as `\\n`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configure-nginx-agent-features.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\nfeatures:\\n  - metrics\\n  - metrics-throttle\\n  - dataplane-status\n```\n\n----------------------------------------\n\nTITLE: Install API Connectivity Manager on RPM-based systems (CentOS, RHEL)\nDESCRIPTION: This command installs the latest version of API Connectivity Manager on CentOS or RHEL systems using the yum package manager. It assumes that the yum repository is properly configured to access the NGINX Management Suite packages. The -y flag automatically answers 'yes' to all prompts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum install -y nms-api-connectivity-manager\n```\n\n----------------------------------------\n\nTITLE: Passing OIDC Claims to the Application\nDESCRIPTION: This snippet configures NGINX to pass OIDC claims as HTTP headers to the backend application. The `proxy_set_header` directives extract claims from the ID token returned by Okta and sets them as headers (e.g., `sub`, `email`, `name`).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/okta.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc okta;\n\n     proxy_set_header sub   $oidc_claim_sub;\n     proxy_set_header email $oidc_claim_email;\n     proxy_set_header name  $oidc_claim_name;\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Initializing Kubeadm with Configuration\nDESCRIPTION: This bash command initializes a Kubernetes cluster using kubeadm with a specified configuration file. The `--config` flag points to the YAML file containing the cluster configuration, including the API server settings required for Service Account Token Volume Projection. This command should be executed after the kubeadm configuration file is created.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/kubeadm.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nkubeadm init --config kubeadm.conf\n```\n\n----------------------------------------\n\nTITLE: Additional IPs - JSON\nDESCRIPTION: This JSON snippet represents example content for a file containing additional IP addresses to be included in the allowlist. It includes an 'ipAddresses' array with IP addresses and ranges, suitable for inclusion using the `$ref` keyword in the main allowlist file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_22\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"ipAddresses\": [\n        { \"ipAddress\": \"2.2.2.2/32\" },\n        { \"ipAddress\": \"4.4.4.0/24\" }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Create ClusterRole for Nginx Mesh PSP\nDESCRIPTION: Creates a ClusterRole `nginx-mesh-psp-role` that grants the permission to 'use' the `podsecuritypolicies` resource within the 'policy' API group. It restricts usage to the `restricted-psp-nginx-mesh` policy, securing the access.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/rke.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: nginx-mesh-psp-role\nrules:\n- apiGroups: ['policy']\n  resources: ['podsecuritypolicies']\n  verbs:     ['use']\n  resourceNames:\n  - restricted-psp-nginx-mesh\n```\n\n----------------------------------------\n\nTITLE: Creating an HTTP Gateway Resource\nDESCRIPTION: This snippet creates a Gateway resource in Kubernetes to configure NGINX Gateway Fabric. It defines an HTTP listener on port 80, enabling the gateway to receive HTTP traffic. The gatewayClassName is set to 'nginx', which directs Kubernetes to use the NGINX Gateway Fabric implementation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/securing-backend-traffic.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nmetadata:\n  name: gateway\nspec:\n  gatewayClassName: nginx\n  listeners:\n  - name: http\n    port: 80\n    protocol: HTTP\nEOF\n```\n\n----------------------------------------\n\nTITLE: Setting Status Zone in Nginx Server Block\nDESCRIPTION: This snippet shows how to add the `status_zone` directive to a `server` block for HTTPS traffic. This directive enables collection of statistics for the specific server block, which are then accessible through the live activity monitoring interface.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_38\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nstatus_zone oracle-ssl;\n```\n\n----------------------------------------\n\nTITLE: Creating Docker Registry Secret in Kubernetes\nDESCRIPTION: This command creates a Kubernetes secret of type `docker-registry` named `nginx-plus-registry-secret` within the `nginx-gateway` namespace.  It authenticates to the private registry `private-registry.nginx.com` using a JWT token as the username and `none` as the password (since the password is not used).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/nginx-plus/docker-registry-secret.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl create secret docker-registry nginx-plus-registry-secret --docker-server=private-registry.nginx.com --docker-username=<JWT Token> --docker-password=none -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Shell Command to Install NGINX Agent with WAF Mode\nDESCRIPTION: This shell command downloads and executes the NGINX Agent installation script, specifying the `--nginx-app-protect-mode` flag to enable precompiled publication of WAF configurations. Replace `<NMS_FQDN>` with the fully qualified domain name of the NGINX Instance Manager host.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://<NMS_FQDN>/install/nginx-agent > install.sh\nsudo sh ./install.sh --nginx-app-protect-mode precompiled-publication\n```\n\n----------------------------------------\n\nTITLE: Disable App Protect for DoS API Location - Nginx\nDESCRIPTION: This snippet demonstrates how to disable the standard NGINX App Protect WAF for the location of the DoS Live Activity Monitoring API using `app_protect_enable off` and enabling the DoS API with `app_protect_dos_api`. This is necessary when both WAF and DoS protection are installed to prevent conflicts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-4.1.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nlocation /api {\n    app_protect_enable off;\n    app_protect_dos_api;\n}\n```\n\n----------------------------------------\n\nTITLE: Define Proxy Bind Directive NGINX\nDESCRIPTION: This code snippet demonstrates using the `proxy_bind` directive to specify a source IP address for connections to the upstream server.  It's useful when the upstream server is configured to accept connections from specific IP networks or ranges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    # ...\n    server {\n        listen     127.0.0.1:12345;\n        proxy_pass backend.example.com:12345;\n        proxy_bind 127.0.0.1:12345;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Shell Command to Check Group ID\nDESCRIPTION: This shell command uses `cat` to display the contents of the `/etc/group` file. This file contains information about all user groups on the system, including their group IDs.  This is necessary to properly configure Docker Compose for NGINX App Protect WAF v5.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\ncat /etc/group\n```\n\n----------------------------------------\n\nTITLE: Filtering Nginx Metrics with Logical Expressions\nDESCRIPTION: This code snippet demonstrates how to filter Nginx metrics using the `filter` parameter with logical expressions (`AND`). It retrieves data where the `nginx_id` starts with `nginx_id1` and the `server_zone` is `zone1` for the last 12 hours.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/metrics?names=nginx.http.request.count&filter=nginx_id='nginx_id1*' and server_zone='zone1'&startTime=now-12h\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Running Nginx New Relic Agent Directly\nDESCRIPTION: Demonstrates how to start the NGINX New Relic agent directly from the command line using the Python script. Includes optional parameters for specifying the configuration file path, PID file path, and running in foreground mode. Requires the agent to be installed and the Python script to be accessible.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/new-relic-plugin.md#_snippet_1\n\nLANGUAGE: python\nCODE:\n```\n/usr/bin/nginx-nr-agent.py -c <config_file_path> -p <pid_file_path> -f\n```\n\n----------------------------------------\n\nTITLE: Install API Connectivity Manager Package (RPM)\nDESCRIPTION: This command installs the API Connectivity Manager package on RPM-based systems like CentOS and RHEL. It uses the `rpm` command with options to install the package while skipping signature verification. Replace `<user>` and `<version>` with the actual username and ACM version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm-offline.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo rpm -ivh --nosignature /home/<user>/nms-api-connectivity-manager_<version>.x86_64.rpm\n```\n\n----------------------------------------\n\nTITLE: Securely Copying the Support Package (Bash)\nDESCRIPTION: This command uses `scp` to securely copy the generated support package from the NGINX Controller host to a local machine.  It requires specifying the username, controller host IP, the remote path where the support package is stored (including the timestamped filename), and the local destination path.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_15\n\nLANGUAGE: bash\nCODE:\n```\nscp <username>@<controller-host-ip>:/var/tmp/supportpkg-<timestamp>.tar.gz /local/path\n```\n\n----------------------------------------\n\nTITLE: Docker Config JSON Structure (Username/Password)\nDESCRIPTION: This JSON snippet illustrates the structure of the `auths` section within the Docker config JSON when using a username and password for authentication. It includes the registry server, username, password, and a base64 encoded string of the username and password.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/private-registry.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"auths\": {\n        \"<your-docker-registry as specified with --registry-server>\": {\n            \"username\": \"<your-username>\",\n            \"password\": \"<your-password>\",\n            \"auth\": \"<base64 encoded string of your username and password>\"\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Restart Nginx and Nginx Agent (Shell)\nDESCRIPTION: This snippet restarts both the Nginx web server and the Nginx Agent service to apply all configuration changes.  It uses `sudo systemctl restart nginx-agent` and `sudo systemctl restart nginx` to ensure that the services are restarted with correct permissions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/set-up-app-protect-instances.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nginx-agent\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Health Checks BIG-IP LTM\nDESCRIPTION: This snippet configures HTTP health checks on BIG-IP LTM. It creates an HTTP monitor named `test_monitor` and configures it to send a `GET` request to `/index.html` every 5 seconds with a timeout of 20 seconds. It then associates this monitor with the `test_pool`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_16\n\nLANGUAGE: none\nCODE:\n```\n# create monitor http test_monitor defaults-from http send \"GET /index.html HTTP/1.0\\r\\n\\r\\n\" interval 5 timeout 20\n# modify pool test_pool monitor test_monitor\n# save /sys config\n```\n\n----------------------------------------\n\nTITLE: Download and Extract OWASP CRS\nDESCRIPTION: This snippet downloads the OWASP CRS from GitHub using wget and extracts the archive to /usr/local.  It assumes wget and tar are available. It also moves the extracted directory to a standard location for easier configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nwget https://github.com/SpiderLabs/owasp-modsecurity-crs/archive/v3.0.2.tar.gz\ntar -xzvf v3.0.2.tar.gz\nsudo mv owasp-modsecurity-crs-3.0.2 /usr/local\n```\n\n----------------------------------------\n\nTITLE: Set Host Tags in NGINX Controller Agent\nDESCRIPTION: This code snippet demonstrates how to define tags on a per-host basis within the `agent.conf` file. Tags are used to build custom graphs, configure alerts, and filter systems in the NGINX Controller user interface.  Any changes made via the user interface will override those set in the `agent.conf` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-the-agent.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\n[credentials]\ntags = foo bar foo:bar\n```\n\n----------------------------------------\n\nTITLE: Setting Up YUM Repository for NGINX Agent (Amazon Linux 2)\nDESCRIPTION: This command creates the `/etc/yum.repos.d/nginx-agent.repo` file, which configures the yum package manager to use the NGINX Agent repository for Amazon Linux 2. The repository URL, GPG key, and other settings are defined in this file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_33\n\nLANGUAGE: shell\nCODE:\n```\n[nginx-agent]\nname=nginx agent repo\nbaseurl=http://packages.nginx.org/nginx-agent/amzn2/$releasever/$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n```\n\n----------------------------------------\n\nTITLE: Configuring GeoIP2 Database Paths in NGINX\nDESCRIPTION: Configures the paths to the GeoIP2 Country and City databases within the HTTP and Stream contexts of the Nginx configuration.  This allows Nginx to locate and use the databases for geographical lookups.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n    geoip2 GeoIP2/GeoLite2-Country.mmdb {\n        #...\n    }\n\n    geoip2 GeoIP2/GeoLite2-City.mmdb {\n        #...\n    }\n}\n\nstream {\n    #...\n    geoip2 GeoIP2/GeoLite2-Country.mmdb {\n        #...\n    }\n\n    geoip2 GeoIP2/GeoLite2-City.mmdb {\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Health Check Status Zone in NGINX\nDESCRIPTION: This snippet shows how to configure health checks for a location block within a server block. Statistics for the health checks are collected in the status zone configured on the server block, and can be displayed in the NGINX Plus dashboard. It requires the `health_check` directive to be enabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    # ...\n    status_zone status_page;\n    location / {\n        proxy_pass http://backend;\n        health_check;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Get NGINX App Protect DoS shared memory dump (Shell)\nDESCRIPTION: This command retrieves a shared memory dump from NGINX App Protect DoS using the `admd` utility and saves it to `napd_shmem.txt`. This provides insight into the current state of the shared memory used by the module. This is part of the process of collecting troubleshooting information to send to customer support.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/troubleshooting-guide/how-to-troubleshoot.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nadmd -c > napd_shmem.txt\n```\n\n----------------------------------------\n\nTITLE: Update Telemetry Configuration in MeshConfig (YAML)\nDESCRIPTION: This YAML snippet demonstrates how to update the `meshconfig` resource to configure telemetry exporters and the sampler ratio at runtime. It configures an OTLP exporter with a specified host and port, and sets the sampler ratio to `0.1` (10% probability).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/monitoring-and-tracing.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\ntelemetry:\n   exporters:\n      otlp:\n         host: otel-collector.example-namespace.svc\n         port: 4317\n   samplerRatio: 0.1\n```\n\n----------------------------------------\n\nTITLE: Querying Metrics API with Aggregation\nDESCRIPTION: This curl command queries the Metrics API with an aggregation function, `SUM`. It calculates the sum of the metric values for the last 12 hours. The `startTime` parameter is required when using aggregate functions, and a valid access token is needed for authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/metrics?names=SUM(nginx.http.request.count)&startTime=now-12h\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Port Forwarding to Prometheus (Bash)\nDESCRIPTION: This command sets up port forwarding to the Prometheus service running within the `nginx-mesh` namespace. It maps the local port 9090 to the Prometheus service's port 9090, allowing access to the Prometheus web UI from the local machine. This requires `kubectl` to be configured and access to the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\nkubectl port-forward -n nginx-mesh svc/prometheus 9090\n```\n\n----------------------------------------\n\nTITLE: Creating HTTPRoute resources\nDESCRIPTION: This YAML configuration creates two HTTPRoute resources. The first, 'cafe-tls-redirect', redirects all HTTP traffic on port 80 to HTTPS on port 443 for the hostname 'cafe.example.com'. The second, 'coffee', routes traffic to the 'coffee' service on the HTTPS listener when the path prefix is '/coffee'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/https-termination.md#_snippet_6\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: cafe-tls-redirect\nspec:\n  parentRefs:\n  - name: cafe\n    sectionName: http\n  hostnames:\n  - \"cafe.example.com\"\n  rules:\n  - filters:\n    - type: RequestRedirect\n      requestRedirect:\n        scheme: https\n        port: 443\n---\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: coffee\nspec:\n  parentRefs:\n  - name: cafe\n    sectionName: https\n  hostnames:\n  - \"cafe.example.com\"\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /coffee\n    backendRefs:\n    - name: coffee\n      port: 80\nEOF\n```\n\n----------------------------------------\n\nTITLE: View License Details via NGINX Controller REST API\nDESCRIPTION: This snippet shows how to view license details for NGINX Controller using the REST API. It involves sending a GET request to the `/platform/license` endpoint to retrieve the license information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/licensing-controller.md#_snippet_1\n\n\n\n----------------------------------------\n\nTITLE: Describe No Delay Rate Limiting SnippetsFilter using kubectl\nDESCRIPTION: This command retrieves the details of the `SnippetsFilter` resource named `no-delay-rate-limiting-sf` from a Kubernetes cluster using `kubectl describe`. It's used to verify the status and configuration of the `SnippetsFilter`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_9\n\nLANGUAGE: Shell\nCODE:\n```\nkubectl describe snippetsfilters.gateway.nginx.org no-delay-rate-limiting-sf\n```\n\n----------------------------------------\n\nTITLE: Setting NGINX Error Log Level in NGINX Service Mesh\nDESCRIPTION: This command sets the NGINX error log level to 'debug' during NGINX Service Mesh deployment.  This configures the verbosity of the NGINX sidecar logs.  Requires `nginx-meshctl` to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/configuration.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --nginx-error-log-level debug\n```\n\n----------------------------------------\n\nTITLE: Backup NGINX Configurations and Logs (Shell)\nDESCRIPTION: This snippet creates a backup of the existing NGINX configuration and log files by copying the `/etc/nginx` and `/var/log/nginx` directories to `/etc/nginx-plus-backup` and `/var/log/nginx-plus-backup` respectively. This is a precautionary measure before installing NGINX App Protect WAF.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo cp -a /etc/nginx /etc/nginx-plus-backup\nsudo cp -a /var/log/nginx /var/log/nginx-plus-backup\n```\n\n----------------------------------------\n\nTITLE: Port-forward Jaeger dashboard\nDESCRIPTION: Sets up port forwarding to access the Jaeger dashboard locally. This allows viewing collected traces through the Jaeger UI at http://127.0.0.1:16686.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nkubectl port-forward -n tracing svc/jaeger 16686:16686 &\n```\n\n----------------------------------------\n\nTITLE: Stop ClickHouse Service to Trigger Failover\nDESCRIPTION: This snippet stops the `clickhouse-server` service on the primary server to simulate a failure and trigger failover to the secondary server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl stop clickhouse-server\n```\n\n----------------------------------------\n\nTITLE: Example JSON Output for Docker Registry Tags\nDESCRIPTION: This JSON example shows the format of the response received when querying the Docker registry for available tags of the NGINX App Protect WAF compiler. It lists the name of the image and an array of available tags.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"name\": \"nap/waf-compiler\",\n  \"tags\": [\n    \"1.0.0\",\n    \"5.1.0\",\n    \"5.2.0\"\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Install Gateway API Resources (Experimental Channel) - Shell\nDESCRIPTION: This command utilizes kubectl and kustomize to install the experimental Gateway API resources, including standard resources and additional experimental features supported by NGINX Gateway Fabric. It retrieves resource definitions from the specified GitHub repository, enabling the experimental channel features.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/install-gateway-api-resources.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl kustomize \"https://github.com/nginx/nginx-gateway-fabric/config/crd/gateway-api/experimental?ref=v{{< version-ngf >}}\" | kubectl apply -f -\n```\n\n----------------------------------------\n\nTITLE: Example deployment manifest modification\nDESCRIPTION: This code shows a snippet of a deployment manifest configuration used to run NGINX in debug mode within NGINX Gateway Fabric when using Kubernetes manifests instead of Helm. It modifies the command and arguments for the `nginx` container.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/data-plane-configuration.md#_snippet_8\n\nLANGUAGE: text\nCODE:\n```\n...\n- args:\n  - -c\n  - rm -rf /var/run/nginx/*.sock && nginx-debug -g 'daemon off;'\n  command:\n  - /bin/sh\n...\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX web server\nDESCRIPTION: This command restarts the NGINX web server. It's necessary to restart Nginx to apply changes made to NGINX Management Suite configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Active Directory External Group Name Example\nDESCRIPTION: This code snippet demonstrates the format for specifying an external AD group name that will be mapped to NGINX Controller RBAC roles. This is required for linking users to roles for access control. The group name should include the CN, OU, and any other relevant components from the AD structure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_11\n\nLANGUAGE: none\nCODE:\n```\nCN=devops,OU=Distribution Lists,OU=Groups\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Error Log\nDESCRIPTION: This example shows how to configure the NGINX error log, including the file path and debug level, using the `error_log` directive in `nginx.conf`. The log level can be set to `debug` for more verbose output, useful for troubleshooting App Protect DoS configuration issues.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/types-of-logs.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nerror_log /var/log/nginx/error.log debug;\n```\n\n----------------------------------------\n\nTITLE: Install Specific NGINX App Protect WAF version - Debian\nDESCRIPTION: These commands are used to install a specific version of the NGINX App Protect WAF module on Debian. The `apt-cache policy` command is used to find available versions, and then `apt-get install` is used to install a specific version of the `nginx-plus-module-appprotect` package, specifying the exact version number.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_23\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-cache policy app-protect | grep 25+\nsudo apt-get install  nginx-plus-module-appprotect=25+3.671.0-1~buster\n```\n\n----------------------------------------\n\nTITLE: Sample REST API Output\nDESCRIPTION: Example of the JSON response from the Agent REST API when querying the `/nginx/` endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_12\n\nLANGUAGE: code\nCODE:\n```\n[{\"nginx_id\":\"b636d4376dea15405589692d3c5d3869ff3a9b26b0e7bb4bb1aa7e658ace1437\",\"version\":\"1.27.1\",\"conf_path\":\"/etc/nginx/nginx.conf\",\"process_id\":\"7\",\"process_path\":\"/usr/sbin/nginx\",\"start_time\":1725878806000,\"built_from_source\":false,\"loadable_modules\":null,\"runtime_modules\":[\"http_addition_module\",\"http_auth_request_module\",\"http_dav_module\",\"http_flv_module\",\"http_gunzip_module\",\"http_gzip_static_module\",\"http_mp4_module\",\"http_random_index_module\",\"http_realip_module\",\"http_secure_link_module\",\"http_slice_module\",\"http_ssl_module\",\"http_stub_status_module\",\"http_sub_module\",\"http_v2_module\",\"http_v3_module\",\"mail_ssl_module\",\"stream_realip_module\",\"stream_ssl_module\",\"stream_ssl_preread_module\"],\"plus\":{\"enabled\":false,\"release\":\"\"},\"ssl\":{\"ssl_type\":0,\"details\":[\"OpenSSL\",\"3.3.0\",\"9 Apr 2024 (running with OpenSSL 3.3.1 4 Jun 2024)\"]},\"status_url\":\"\",\"configure_args\":[\"\",\"prefix=/etc/nginx\",\"sbin-path=/usr/sbin/nginx\",\"modules-path=/usr/lib/nginx/modules\",\"conf-path=/etc/nginx/nginx.conf\",\"error-log-path=/var/log/nginx/error.log\",\"http-log-path=/var/log/nginx/access.log\",\"pid-path=/var/run/nginx.pid\",\"lock-path=/var/run/nginx.lock\",\"http-client-body-temp-path=/var/cache/nginx/client_temp\",\"http-proxy-temp-path=/var/cache/nginx/proxy_temp\",\"http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp\",\"http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp\",\"http-scgi-temp-path=/var/cache/nginx/scgi_temp\",\"with-perl_modules_path=/usr/lib/perl5/vendor_perl\",\"user=nginx\",\"group=nginx\",\"with-compat\",\"with-file-aio\",\"with-threads\",\"with-http_addition_module\",\"with-http_auth_request_module\",\"with-http_dav_module\",\"with-http_flv_module\",\"with-http_gunzip_module\",\"with-http_gzip_static_module\",\"with-http_mp4_module\",\"with-http_random_index_module\",\"with-http_realip_module\",\"with-http_secure_link_module\",\"with-http_slice_module\",\"with-http_ssl_module\",\"with-http_stub_status_module\",\"with-http_sub_module\",\"with-http_v2_module\",\"with-http_v3_module\",\"with-mail\",\"with-mail_ssl_module\",\"with-stream\",\"with-stream_realip_module\",\"with-stream_ssl_module\",\"with-stream_ssl_preread_module\",\"with-cc-opt='-Os -fstack-clash-protection -Wformat -Werror=format-security -g'\",\"with-ld-opt=-Wl,--as-needed,-O1,--sort-common\"],\"error_log_paths\":null}]\n```\n\n----------------------------------------\n\nTITLE: Check Kubernetes Deployments\nDESCRIPTION: This shell command retrieves a list of deployments in the Kubernetes cluster and displays their status. It helps to verify if the deployments are running as expected and if any issues are present.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get deployments\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration\nDESCRIPTION: This command reloads the Nginx configuration without interrupting traffic. It ensures that the changes made to the `nginx.conf` file, specifically the `usage_report` endpoint, are applied to the running Nginx instance. This step is necessary after modifying the configuration file to activate the new settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/licensing-and-reporting/configure-nginx-plus-report-to-nim.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Enable NGINX Agent on Boot - Shell\nDESCRIPTION: This command enables NGINX Agent to start automatically on boot on systemd systems. It requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/getting-started.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl enable nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Uninstalling the Controller Agent - Ubuntu/Debian\nDESCRIPTION: This command uninstalls the NGINX Controller Agent package from Ubuntu or Debian systems. It removes the installed package and associated files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-instances.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\napt-get purge nginx-controller-agent\n```\n\n----------------------------------------\n\nTITLE: Description of system.net.listen_overflows metric\nDESCRIPTION: Provides the type and description for the system.net.listen_overflows metric which is a counter in integer representing Number of times the listen queue of a socket overflowed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_12\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Number of times the listen queue of a socket overflowed.\n```\n\n----------------------------------------\n\nTITLE: Test NGINX Configuration\nDESCRIPTION: This shell command tests the NGINX configuration file for syntax errors.  It's essential to run this command before reloading NGINX to ensure that any changes made to the configuration file are valid.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/cookie-flag.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Install Prerequisites for NGINX Plus on Ubuntu\nDESCRIPTION: Installs the prerequisite packages required for installing NGINX Plus on Ubuntu systems. These packages provide the necessary tools and libraries for secure package management and repository access.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update\nsudo apt install apt-transport-https lsb-release ca-certificates wget gnupg2 ubuntu-keyring\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Gateway Fabric without Service\nDESCRIPTION: This command installs NGINX Gateway Fabric without creating a service, which can be useful in certain environments. It creates the 'nginx-gateway' namespace if it doesn't exist.  Requires Helm 3.0+ and kubectl.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nhelm install ngf oci://ghcr.io/nginx/charts/nginx-gateway-fabric --create-namespace -n nginx-gateway --set service.create=false\n```\n\n----------------------------------------\n\nTITLE: Apply TrafficSplit and HTTPRouteGroup\nDESCRIPTION: This bash command applies the `trafficsplit-matches.yaml` configuration file, creating or updating the `target-hrg` HTTPRouteGroup and `target-ts` TrafficSplit.  It's a core step to enable the traffic splitting logic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_23\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f trafficsplit-matches.yaml\n```\n\n----------------------------------------\n\nTITLE: Converting Policy with Docker CLI\nDESCRIPTION: This snippet demonstrates how to convert an input policy using the `convert-policy` tool within a Docker container.  It mounts the current directory to /policies inside the container, and specifies the input and output file paths for the policy conversion, along with a full export to export the entire policy with all entities.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_23\n\nLANGUAGE: docker\nCODE:\n```\ndocker run -it --rm \\\n  -v $(pwd):/policies \\\n  --entrypoint=\"/opt/app_protect/bin/convert-policy\" \\\n  waf-compiler-<version-tag>:custom -i test.json -o test.xml\n  -i /policies/input_policy.plc \\\n  -o /policies/output_policy \\\n  --full-export\n```\n\n----------------------------------------\n\nTITLE: Define Conflicting Rate Limits (YAML)\nDESCRIPTION: This YAML configuration defines a RateLimit resource targeting a Service destination with a Service source. It is part of a conflict demonstration where a subsequent RateLimit with a different destination kind but same source will be allowed by the admission webhook but may fail at runtime if the IP addresses are the same.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/smi-traffic-policies.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi.nginx.com/v1alpha2\nkind: RateLimit\nmetadata:\n name: limit-1\n namespace: default\nspec:\n  destination:\n    kind: Service\n    name: dest-svc\n    namespace: default\n  sources:\n  - kind: Service\n    name: src-1\n    namespace: default\n```\n\n----------------------------------------\n\nTITLE: Get Dimensions Catalog\nDESCRIPTION: This cURL command retrieves the full list of available dimensions from the Catalogs API.  It requires a valid session cookie. The API provides details about dimensions which can be used for filtering and grouping metrics data.  Knowing dimensions is essential for targeted metrics queries.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/catalogs/dimensions\"\n```\n\n----------------------------------------\n\nTITLE: Generating RSA Private Key\nDESCRIPTION: Generates an RSA private key with a key size of 2048 bits using OpenSSL. The key is saved to the specified file path.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl genrsa -out ~/example.com.key 2048\n```\n\n----------------------------------------\n\nTITLE: Creating a tarball of Static Files\nDESCRIPTION: This bash command creates a compressed tar archive (tarball) of the current directory's contents. The `-cvzf` options specify creating, verbose output, gzip compression, and the filename of the archive, respectively.  It requires `tar` to be installed on the system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/hosting-static-content.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ntest-static-files $ tar -cvzf <path to store tarball>/test.tar.gz *\n```\n\n----------------------------------------\n\nTITLE: Define HTTPRouteGroup for L7 Matching\nDESCRIPTION: This YAML configuration defines an HTTPRouteGroup resource named 'hrg' with multiple match conditions: 'get-only' (GET requests), 'demo-header' (requests with header X-Demo: true), 'config-v1-path' (requests to /configuration-v1), and 'v2-only' (GET requests to /configuration-v2 with header X-DEMO: true). These matches are used to create more advanced rate limiting policies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_10\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi-spec.io/v1alpha3\nkind: HTTPRouteGroup\nmetadata:\n  name: hrg\n  namespace: default\nspec:\n  matches:\n  - name: get-only\n    methods:\n    - GET\n  - name: demo-header\n    headers:\n      X-Demo: \"^true$\"\n  - name: config-v1-path\n    pathRegex: \"/configuration-v1\"\n  - name: v2-only\n    pathRegex: \"/configuration-v2\"\n    headers:\n      X-DEMO: \"^true$\"\n    methods:\n    - GET\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration\nDESCRIPTION: This shell command gracefully reloads the Nginx configuration, applying any changes made to the configuration file without interrupting existing connections. This is useful for enabling newly installed modules or updating existing configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/ndk.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Docker Daemon Configuration\nDESCRIPTION: This JSON snippet configures the Docker daemon. It sets the cgroup driver to `systemd`, configures the logging driver to `json-file` with size limits, and specifies the `overlay2` storage driver.  These configurations are important for compatibility and stability, especially within Kubernetes environments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n    \"log-driver\": \"json-file\",\n    \"log-opts\": {\n        \"max-size\": \"10m\",\n        \"max-file\": \"2\"\n    },\n    \"storage-driver\": \"overlay2\"\n}\n```\n\n----------------------------------------\n\nTITLE: Example User-Defined Signature Definition JSON\nDESCRIPTION: Provides an example of a complete user-defined signature definition file. It includes a single signature with the tag 'Fruits', a specific rule to match 'apple' (case-insensitive), and relevant metadata.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/user-defined-signatures.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"softwareVersion\": \"15.1.0\",\n    \"tag\": \"Fruits\",\n    \"revisionDatetime\": \"2020-01-22T18:32:02Z\",\n    \"signatures\": [\n        {\n            \"name\": \"Apple_medium_acc\",\n            \"rule\": \"content:\\\"apple\\\"; nocase;\",\n            \"signatureType\": \"request\",\n            \"attackType\": {\n                \"name\": \"Buffer Overflow\"\n            },\n            \"systems\": [\n                {\n                    \"name\": \"Microsoft Windows\"\n                },\n                {\n                    \"name\": \"Unix/Linux\"\n                }\n            ],\n            \"risk\": \"medium\",\n            \"accuracy\": \"medium\",\n            \"description\": \"Medium accuracy user defined signature with tag (Fruits)\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Test CRS Blocking User-Agent\nDESCRIPTION: This snippet shows how to use curl to send a request with a specific User-Agent header to a local web server and observe the response.  In this case, the User-Agent is set to 'Nikto', which is recognized and blocked by the CRS, resulting in a 403 Forbidden error.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_5\n\nLANGUAGE: none\nCODE:\n```\n$ curl -H \"User-Agent: Nikto\" http://localhost/\n<html>\n<head><title>403 Forbidden</title></head>\n<body bgcolor=\"white\">\n<center><h1>403 Forbidden</h1></center>\n<hr><center>nginx/1.17.10</center>\n</body>\n</html>\n```\n\n----------------------------------------\n\nTITLE: Apply TransportServer Configuration\nDESCRIPTION: This command applies the TransportServer resource defined in `udp-transportserver.yaml` to the Kubernetes cluster using `kubectl`.  The TransportServer configures UDP traffic to route from the GlobalConfiguration listener to the `udp-listener` application.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-udp-walkthrough.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f udp-transportserver.yaml\n```\n\n----------------------------------------\n\nTITLE: Helm Registry Login\nDESCRIPTION: Logs into the specified Helm registry using a JWT token for authentication. Replace <JWT Token> with the actual JWT token provided by NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-helm.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nhelm registry login --username=<JWT Token> --password=none private-registry.nginx.com\n```\n\n----------------------------------------\n\nTITLE: Generating User Defined Signatures JSON (Custom Tag)\nDESCRIPTION: Generates a JSON file from a User Defined Signatures XML file, using a custom tag. It uses the `-i`, `-o`, and `--tag` switches to specify the input XML file, the output JSON file, and the desired custom tag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_22\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/convert-signatures -i /path/to/signatures.xml -o /path/to/signatures.json --tag \"MyTag\"\n```\n\n----------------------------------------\n\nTITLE: Access Log Configuration in NGINXaaS\nDESCRIPTION: This snippet references the NGINX documentation on configuring access logs for NGINXaaS. Access logs are used to troubleshoot server issues, analyze web traffic patterns, and monitor server performance. The Module ngx_http_log_module documentation provides more information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/faq.md#_snippet_2\n\nLANGUAGE: text\nCODE:\n```\nModule ngx_http_log_module (https://nginx.org/en/docs/http/ngx_http_log_module.html?&_ga=2.80762515.545098740.1677716889-256521444.1670450998#access_log)\n```\n\n----------------------------------------\n\nTITLE: Shared Memory Failure Log Event JSON\nDESCRIPTION: This JSON snippet represents a shared memory failure event in NGINX App Protect DoS. It indicates that a worker process failed to connect to shared memory.  The event includes the worker PID, the current mode (failure), and a flag indicating whether the mode has changed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/operation-log.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"event\": \"shared_memory_failure\",\n    \"worker_pid\": 4928,\n    \"mode\": \"failure\",\n    \"mode_changed\": true\n}\n```\n\n----------------------------------------\n\nTITLE: Creating Kubernetes Secret for mTLS Certificates\nDESCRIPTION: This command creates a Kubernetes secret named `enforcer-certificates` from certificate and key files.  It takes paths to the server certificate, server key, and client CA certificate as input and stores them securely in the cluster.  These files are required for configuring mTLS between NGINX and App Protect Enforcer.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/nap-k8s-mtls-deployment.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl create secret generic enforcer-certificates \\\n\t--from-file=app_protect_server.crt=/path/to/app_protect_server.crt \\\n\t--from-file=app_protect_server.key=/path/to/app_protect_server.key \\\n\t--from-file=app_protect_client_ca.crt=/path/to/app_protect_client_ca.crt\n```\n\n----------------------------------------\n\nTITLE: Install apt prerequisites for Nginx Agent on Debian\nDESCRIPTION: This command installs the necessary prerequisites for adding and managing repositories on Debian systems, specifically for installing the Nginx Agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt install curl gnupg2 ca-certificates lsb-release debian-archive-keyring\n```\n\n----------------------------------------\n\nTITLE: Configuring SSL Session Cache and Timeout Together\nDESCRIPTION: This snippet demonstrates setting the SSL session cache and timeout together, which are interdependent for optimal performance. The `ssl_session_cache` directive creates the cache, and `ssl_session_timeout` specifies how long sessions are stored. A larger timeout requires a larger cache.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-tcp.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    #...\n    ssl_session_cache   shared:SSL:20m;\n    ssl_session_timeout 4h;\n}\n```\n\n----------------------------------------\n\nTITLE: Workload Group OpenAPI Specification YAML\nDESCRIPTION: This YAML snippet defines the OpenAPI Specification for `workloadGroup`, including `WebWorkloadGroup` and `TcpUdpWorkloadGroup`. It outlines the structure, properties, and relationships between these groups, referencing common settings and specific objects like proxy and URI configurations. It's crucial for understanding how to configure workload groups within NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\nWebWorkloadGroup:\n      description: Group of servers hosting a part of a Web application represented by a Component.\n      allOf:\n        - $ref: '#/components/schemas/WorkloadGroupCommon' # Settings common to Web and TCP/UDP workloadGroups.\n        - type: object\n          properties:\n            proxy:\n              $ref: '#/components/schemas/WebProxy' # Proxy retry and timeout settings applicable to servers in a Web workloadGroup.\n            sessionPersistence:\n              $ref: '#/components/schemas/SessionPersistence' # SessionPersistence settings in a Web workloadGroup.\n            uris:\n              type: object\n              description: |\n                The URI for a server hosting a part of a Web application.\n                It must conform to the format `schema://address[:port]`\n                where schema is chosen from http or https, address is IP or hostname,\n                schema and address must be provided.\n                For example:\n                - `http://192.0.2.247`\n                - `https://192.0.2.247:8443`\n                - `https://www.f5workload.com`\n              additionalProperties:\n                $ref: '#/components/schemas/WorkloadUri'\n  TcpUdpWorkloadGroup:\n      description: Group of servers hosting a part of a TCP/UDP application represented by a Component.\n      allOf:\n        - $ref: '#/components/schemas/WorkloadGroupCommon' # Settings common to Web and TCP/UDP workloadGroups.\n        - type: object\n          properties:\n            proxy:\n              $ref: '#/components/schemas/TcpUdpProxy' # Proxy retry and timeout settings applicable to servers in a TcpUdp workloadGroup.\n            useServerPort:\n              $ref: '#/components/schemas/ServiceConfigState'\n            uris:\n              type: object\n              description: |\n              The URI of a server that hosts a TCP/UDP application.\n                The URI must conform to the format `schema://address:port`.\n                - The schema must be one of the following: `tcp`, `udp`, or `tcp+tls`.\n                - The address value can be an IP address or a host name.\n                - All three elements -- schema, address, and port -- are required.\n                Note: When `useServerPort` is `ENABLED`, then you should define a single URI that uses the `schema://address` format.\n                Defining a `port` value for the URI when also using `useServerPort` will result in an error.\n                For example:\n                - `tcp://192.0.2.247:8443`\n                - `tcp+tls://192.0.2.247:8449`\n                - `udp://www.f5workload.com:989`\n              additionalProperties:\n                $ref: '#/components/schemas/WorkloadUri'\n  WorkloadGroupCommon:\n      description: Settings common to Web and TCP/UDP workloadGroups.\n      type: object\n      properties:\n        locationRefs:\n          type: array\n          items:\n            $ref: 'https://gitlab.com/f5/nginx/controller/product/api-common/raw/master/schema/resource-common.yaml#/components/schemas/ResourceRef'\n        loadBalancingMethod:\n          $ref: '#/components/schemas/LoadBalancingMethod'\n        dnsServiceDiscovery:\n          $ref: '#/components/schemas/DNSServiceDiscovery'\n    WorkloadUri:\n      type: object\n      properties:\n        weight:\n          type: integer\n          minimum: 1\n          default: 1\n        maxConns:\n          type: integer\n          minimum: 0\n          default: 0\n        maxFails:\n          type: integer\n          minimum: 0\n          default: 1\n        failTimeout:\n          x-f5-experimental: true\n          type: string\n          default: 10s\n          pattern: '^[0-9]+[h|m|s]{1}$'\n        isBackup:\n          type: boolean\n          default: false\n        isDown:\n          type: boolean\n          default: false\n        route:\n          x-f5-experimental: true\n          type: string\n        srvService:\n          type: string\n        slowStart:\n          x-f5-experimental: true\n          type: integer\n          minimum: 0\n          default: 0\n        isDrain:\n          type: boolean\n          default: false\n```\n\n----------------------------------------\n\nTITLE: Restart ACM Service (Bash)\nDESCRIPTION: This command restarts the API Connectivity Manager service. It's often useful when the module doesn't appear in the NGINX Management Suite web interface after installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/troubleshooting.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nms-acm\n```\n\n----------------------------------------\n\nTITLE: Waiting for NGINX Gateway Fabric Deployment\nDESCRIPTION: This command waits for the NGINX Gateway Fabric deployment to become available in the 'nginx-gateway' namespace. It uses kubectl to check the deployment status and waits for up to 5 minutes.  Requires kubectl.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nkubectl wait --timeout=5m -n nginx-gateway deployment/ngf-nginx-gateway-fabric --for=condition=Available\n```\n\n----------------------------------------\n\nTITLE: Example NGINX Upstream Configuration\nDESCRIPTION: A basic Nginx upstream configuration example showing a server defined with an IP address and port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/private-link-to-upstreams.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nupstream {\n    server 10.0.1.4:8000;\n}\n```\n\n----------------------------------------\n\nTITLE: Syslog-NG Configuration Example\nDESCRIPTION: This example shows a `syslog-ng.conf` configuration that receives syslog messages over TLS, including source definition, destination file, and options for storing raw messages with dimensions. It requires syslog-ng version 3.29 or higher and the `scl.conf` include file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/integrations/syslog-integration.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n@version: 3.29\n@include \"scl.conf\"\n\nsource s_network {\n    default-network-drivers(\n    tls(key-file(\"/key.pem\") cert-file(\"/cert.pem\") peer-verify(optional-trusted))\n\n    # the optional flag that enables the access to $RAWSMSG\n    flags(store-raw-message)\n    );\n};\n\ndestination d_remote  {\n    file(\"/var/log/controller.events.log\");\n\n    # if you want to see the raw message with all dimensions:\n    file(\"/var/log/controller.events.raw.log\" template(\"${RAWMSG}\\n\"));\n};\n\nlog {\n    source(s_network);\n    destination(d_remote);\n};\n```\n\n----------------------------------------\n\nTITLE: Example: Enabling IO_PLUGIN Debug Logging\nDESCRIPTION: This snippet shows an example of enabling debug logging for the `IO_PLUGIN` module.  It sets the `LOG_LEVEL` to include both `TS_INFO` and `TS_DEBUG` messages, and it specifies that log messages should be written to file number 2 (errors.log).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/debug-logs.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\nMODULE=IO_PLUGIN;\nLOG_LEVEL=TS_INFO | TS_DEBUG;\nFILE = 2;\n```\n\n----------------------------------------\n\nTITLE: Run bash script to submit license usage offline\nDESCRIPTION: This command executes the `license_usage_offline.sh` script with several parameters: the JWT license filename, NGINX Instance Manager IP address, admin username and password, output report filename, and telemetry action type. The script downloads the usage report, submits it to F5 for acknowledgment, and uploads the acknowledgment back to NGINX Instance Manager. The script requires access to NGINX Instance Manager and `https://product.apis.f5.com/` on port 443.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/report-usage-disconnected-deployment.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n./license_usage_offline.sh \\\n  -j <license-filename>.jwt \\\n  -i <NIM-IP-address> \\\n  -u admin \\\n  -p <password> \\\n  -o report.zip \\\n  -s telemetry\n```\n\n----------------------------------------\n\nTITLE: Monitoring Traffic Metrics with nginx-meshctl top\nDESCRIPTION: This command uses `nginx-meshctl top` to display real-time traffic metrics for the deployments in the cluster. This includes the incoming success rate, outgoing success rate, and the number of requests for each deployment. It is used to monitor the performance and health of the deployed services, especially during deployments and traffic splits.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl top\n```\n\n----------------------------------------\n\nTITLE: Login to NGINX Private Registry (Docker)\nDESCRIPTION: This command logs into the NGINX private registry using a JWT for authentication.  The username is set to the JWT, and the password is 'none'. This command requires Docker to be installed and running on the system.  Replace `YOUR_JWT_HERE` with your actual JWT.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/containers/connect-nginx-plus-container-images-to-nginx-one.md#_snippet_0\n\nLANGUAGE: sh\nCODE:\n```\nsudo docker login private-registry.nginx.com --username=YOUR_JWT_HERE --password=none\n```\n\n----------------------------------------\n\nTITLE: Create SSL directory - Ubuntu\nDESCRIPTION: This command creates the `/etc/ssl/nginx/` directory, which is used to store SSL certificates and keys for NGINX. The `-p` option ensures that parent directories are created if they don't already exist.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_30\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/ssl/nginx\n```\n\n----------------------------------------\n\nTITLE: JWT Header Example (RS256)\nDESCRIPTION: This JSON snippet demonstrates an example of a JWT header when using the RS256 (RSA/SHA-256) signing algorithm. The 'alg' key specifies the algorithm used for signing, and the 'typ' key indicates the type of token, which is JWT.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/json-web-token-overview.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"alg\": \"RS256\",\n  \"typ\": \"JWT\"\n}\n```\n\n----------------------------------------\n\nTITLE: List API Rootpoints using curl\nDESCRIPTION: This snippet demonstrates how to use the `curl` command to send a GET request to the NGINX Plus API root to retrieve a list of available endpoints.  It uses `json_pp` for pretty printing the JSON output. It depends on having `curl` and `json_pp` installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\ncurl -s 'https://demo.nginx.com/api/9/' | json_pp\n```\n\n----------------------------------------\n\nTITLE: Disabling Authentication for Specific Location in Nginx\nDESCRIPTION: This snippet shows how to disable HTTP Basic authentication for a specific location within a server block that has authentication enabled globally. The `auth_basic off;` directive overrides the inherited authentication settings, making the `/public/` location accessible without authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-http-basic-authentication.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    ...\n    auth_basic           \"Administrator’s Area\";\n    auth_basic_user_file conf/htpasswd;\n\n    location /public/ {\n        auth_basic off;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Port-Forwarding to a Tracing Service (Jaeger)\nDESCRIPTION: This command configures port forwarding for a tracing service, such as Jaeger, allowing local access for inspecting distributed traces. Replace `<tracing-namespace>`, `<tracing-service>`, and `<tracing-service-port>` with the appropriate values for the specific tracing deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/deploy-example-app.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nkubectl -n <tracing-namespace> port-forward svc/<tracing-service> <tracing-service-port>\n```\n\n----------------------------------------\n\nTITLE: Send Request to Coffee (Shell)\nDESCRIPTION: This command uses `curl` to send an HTTP request to the `coffee` application. It resolves the `cafe.example.com` hostname to the NGINX Gateway Fabric's IP address and port specified by the `GW_IP` and `GW_PORT` environment variables. The request is sent to the `/coffee` path.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee\n```\n\n----------------------------------------\n\nTITLE: Get Metric Description with curl\nDESCRIPTION: This command retrieves a detailed description for a specific metric from the Nginx Controller Analytics catalog. It requires a valid session cookie for authentication and the name of the metric to be retrieved. The example provided fetches the description for `client.latency.total`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/view-traffic-metrics.md#_snippet_1\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{Controller-FQDN}/api/v1/analytics/catalogs/metrics/client.latency.total\"\n```\n\n----------------------------------------\n\nTITLE: Upgrade Gateway API Resources (Experimental Channel) - Shell\nDESCRIPTION: This command upgrades Gateway API resources using the experimental channel configuration from the NGINX Gateway Fabric repository. It's intended for users who installed NGINX Gateway from the experimental channel. It requires kubectl to be installed and configured to connect to the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/upgrade-api-resources.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl kustomize \"https://github.com/nginx/nginx-gateway-fabric/config/crd/gateway-api/experimental?ref=v{{< version-ngf >}}\" | kubectl apply -f -\n```\n\n----------------------------------------\n\nTITLE: Sending Signals to NGINX Master Process\nDESCRIPTION: This snippet demonstrates how to send signals to the NGINX master process using the `nginx` command. The `<SIGNAL>` placeholder should be replaced with a valid signal like `quit`, `reload`, `reopen`, or `stop`. This command is used to control the NGINX server's behavior without interrupting service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/basic-functionality/runtime-control.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nnginx -s <SIGNAL>\n```\n\n----------------------------------------\n\nTITLE: Kubernetes NginxGateway Valid Status\nDESCRIPTION: An example status output of a valid NginxGateway resource, showing that the resource has been successfully validated. The `Status` field is set to `True` for the `Valid` condition, and the `Message` field confirms that the NginxGateway is valid.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/resource-validation.md#_snippet_12\n\nLANGUAGE: text\nCODE:\n```\nStatus:\n  Conditions:\n    Last Transition Time:  2023-12-15T21:04:49Z\n    Message:               NginxGateway is valid\n    Observed Generation:   1\n    Reason:                Valid\n    Status:                True\n    Type:                  Valid\n```\n\n----------------------------------------\n\nTITLE: Upstream Configuration without ip_hash (Sticky Route)\nDESCRIPTION: This code snippet shows the configuration of an upstream block in NGINX without the `ip_hash` directive, preparing for sticky route-based session persistence. It defines two backend servers for the `tomcat` upstream.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_26\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nupstream tomcat {\n    #ip_hash;\n    server 10.100.100.11:8080;\n    server 10.100.100.12:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: Register Azure Application\nDESCRIPTION: This command registers a new application in Microsoft Entra ID, representing NGINX Plus as an OIDC client.  The `--display-name` parameter sets the application name, and `--web-redirect-uris` specifies the callback URI for NGINX Plus after successful authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/entra-id.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\naz ad app create --display-name \"Nginx Demo App\" --web-redirect-uris \"https://demo.example.com/oidc_callback\"\n```\n\n----------------------------------------\n\nTITLE: Configure Authentication Methods PowerShell\nDESCRIPTION: This command configures the authentication methods for Outlook Anywhere using the Set-OutlookAnywhere cmdlet in PowerShell.  It sets various authentication-related properties, including requiring SSL and setting the default and external authentication methods to basic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_6\n\nLANGUAGE: PowerShell\nCODE:\n```\nC:\\> Set-OutlookAnywhere -ExternalClientsRequireSsl 1\n-DefaultAuthenticationMethod basic\n-ExternalClientAuthenticationMethod basic\n-IISAuthenticationMethods basic\n-InternalClientAuthenticationMethod basic\n```\n\n----------------------------------------\n\nTITLE: Setting Up Stable NGINX Repository on SUSE\nDESCRIPTION: This command adds the official NGINX stable repository to the zypper package manager on SUSE, enabling the system to install and update NGINX packages from the official source. It specifies gpgcheck, type yum, refresh, and check options for the repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_31\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper addrepo --gpgcheck --type yum --refresh --check \\\n        'http://nginx.org/packages/sles/$releasever_major' nginx-stable\n```\n\n----------------------------------------\n\nTITLE: API Response with Specified Dimensions\nDESCRIPTION: This JSON snippet shows the API response format when the `dimensions` parameter is used.  It includes only the specified dimension (`nginx_id`) in the response.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_15\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"metrics\":[\n      {\n         \"aggr\": \"SUM\",\n         \"name\":\"nginx.http.request.count\",\n         \"series\":[\n            {\n               \"dimensions\":{\n                  \"nginx_id\":\"nginx-id-1\"\n               },\n               \"timestamps\":[\n                  \"2020-12-13T12:00:00Z\"\n               ],\n               \"values\":[\n                  1000\n               ]\n            },\n            {\n               \"dimensions\":{\n                  \"nginx_id\":\"nginx-id-2\"\n               },\n               \"timestamps\":[\n                  \"2020-12-13T12:00:00Z\"\n               ],\n               \"values\":[\n                  2000\n               ]\n            }\n         ]\n      }\n   ]\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Agent Features in YAML\nDESCRIPTION: This configuration snippet shows how to limit the features of NGINX Agent to 'registration' and 'dataplane-status'.  This is useful when using Instance Manager primarily for tracking NGINX Plus usage, optimizing performance by reducing the amount of data collected and transmitted. The configuration is added to the `/etc/nginx-agent/nginx-agent.conf` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/usage-tracking/install-nginx-agent.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nfeatures: registration,dataplane-status\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Service Mesh via Helm Source\nDESCRIPTION: Installs the NGINX Service Mesh chart using local source files. This command creates a new namespace for the mesh, installs the chart with the release name `nsm` in the `nginx-mesh` namespace, and waits for the installation to complete. Requires the Helm chart to be downloaded from GitHub first.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install-with-helm.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nhelm install nsm . --namespace nginx-mesh --create-namespace --wait\n```\n\n----------------------------------------\n\nTITLE: Example NGINX Logs for ACME Challenge (Shell)\nDESCRIPTION: This shell command retrieves logs from an NGINX pod within the `nginx-gateway` namespace, specifically from the `nginx` container. The log output shows successful ACME challenge requests, indicating that Let's Encrypt is able to verify domain ownership.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/integrating-cert-manager.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nkubectl logs <pod-name> -n nginx-gateway -c nginx\n```\n\n----------------------------------------\n\nTITLE: NGINX Agent Configuration (agent.conf)\nDESCRIPTION: This snippet shows the configuration settings in the `agent.conf` file for the NGINX Controller Agent. It configures the agent to verify SSL certificates using a custom CA bundle. The `verify_ssl_cert` option enables SSL verification, and `requests_ca_bundle` specifies the path to the CA certificate file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_38\n\nLANGUAGE: nginx\nCODE:\n```\n[cloud]\n...\nverify_ssl_cert = True\nrequests_ca_bundle = <path-to-ca-bundle-file>\n```\n\n----------------------------------------\n\nTITLE: Reference Bundle Files in NGINX Configuration\nDESCRIPTION: This NGINX snippet shows how to reference custom policy and logging profile bundle files within the NGINX configuration after mounting the host directory to the container. It assumes that the bundle files are accessible under the `/bundles` directory inside the container.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/bundles-volume-mount.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_policy_file /bundles/custom_policy.tgz;\napp_protect_security_log /bundles/custom_logging_profile.tgz syslog:server=localhost:514;\n```\n\n----------------------------------------\n\nTITLE: Configure Server Block with SSL in NGINX\nDESCRIPTION: This code configures a server block to listen on port 443 with SSL enabled. It specifies the SSL certificate and key files, and proxies requests to a backend application running on `http://127.0.0.1:8080`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/auth0.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n\n    # ...\n\n    server {\n        listen      443 ssl;\n        server_name demo.example.com;\n\n        ssl_certificate     /etc/ssl/certs/fullchain.pem;\n        ssl_certificate_key /etc/ssl/private/key.pem;\n\n        location / {\n\n            # ...\n\n            proxy_pass http://127.0.0.1:8080;\n        }\n    }\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Deploy Clients using kubectl\nDESCRIPTION: This command deploys the `client-v1` and `client-v2` Deployments along with their ConfigMaps using the respective YAML files. This will generate traffic to the destination service. It depends on kubectl being configured and connected to a Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f client-v1.yaml -f client-v2.yaml\n```\n\n----------------------------------------\n\nTITLE: Restarting Controller Agent Service\nDESCRIPTION: This snippet shows the command to restart the controller-agent service. This restart is required after modifying the `/etc/controller-agent/agent.conf` file to apply the new gRPC configuration options. This ensures the Controller Agent picks up the new configuration and properly communicates with the NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/apim/apim-release-notes-3.18.1.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo service controller-agent restart\n```\n\n----------------------------------------\n\nTITLE: Active Directory Group Search Filter (One or More Attributes)\nDESCRIPTION: This code snippet illustrates a group search filter that matches one or more attributes using the pipe symbol (|). This allows you to search for groups with either CN=devops OR CN=quality_assurance when configuring Active Directory integration in NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_7\n\nLANGUAGE: none\nCODE:\n```\n(&(objectClass=group)(|(CN=devops)(CN=quality_assurance)))\n```\n\n----------------------------------------\n\nTITLE: Using curl to get detailed statistics\nDESCRIPTION: This command uses `curl` to make a GET request to a specific API endpoint to retrieve detailed statistics in JSON format. The `json_pp` tool is used to pretty-print the JSON output for better readability. Requires `json_pp` to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/live-activity-monitoring.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ncurl -s 'http://192.168.1.23/api/dos/1/protected_objects' | json_pp\n```\n\n----------------------------------------\n\nTITLE: Query HTTP Success Rate with Prometheus\nDESCRIPTION: This Prometheus query calculates the success rate of HTTP requests to upstream servers. It divides the rate of successful responses (1xx or 2xx) by the total request rate, grouped by application and version, over a 30-second window.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_2\n\nLANGUAGE: promQL\nCODE:\n```\nsum(irate(nginxplus_upstream_server_responses{code=~\"1xx|2xx\"}[30s])) by (app, version) / sum(irate(nginxplus_upstream_server_responses[30s])) by (app, version)\n```\n\n----------------------------------------\n\nTITLE: Deleting APIGW Pod (kubectl delete pod)\nDESCRIPTION: This command deletes the apigw pod to ensure that the changes from the applied secrets are applied successfully. It depends on `kubectl` and the correct apigw pod name. The `<hash>` placeholder must be replaced with the actual hash of the apigw pod.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_20\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n nms delete pod apigw-<hash>\n```\n\n----------------------------------------\n\nTITLE: Configure DNS Resolver in NGINX\nDESCRIPTION: This configuration sets up a DNS resolver within the `http` context of the NGINX configuration. It's essential for NGINX Plus to resolve DNS records for the Entra ID provider and other external services. The `valid` parameter overrides the TTL value for DNS records.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/entra-id.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Exclude Certain NGINX Log Files\nDESCRIPTION: This code snippet shows how to exclude specific NGINX log files from the metrics collection by adding an `exclude_logs` setting in the `[nginx]` section of the `/etc/controller-agent/agent.conf` file. This is useful when multiple log files contain the same request information, preventing duplicate metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-the-agent.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\n[nginx]\nexclude_logs=/var/log/nginx/app1/*,access-app1-*.log,sender1-*.log\n```\n\n----------------------------------------\n\nTITLE: Get Resource Size via command-line\nDESCRIPTION: This bash command uses `curl` to determine the size of the HTML/data returned by a specific resource. The `-so /dev/null` option discards the output, while `-w '%{size_download}'` extracts the download size.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/http-backend-configuration.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\ncurl -so /dev/null https://nginx.org/ -w '%{size_download}'\n```\n\n----------------------------------------\n\nTITLE: Update Proxy with Token in Header - Bash\nDESCRIPTION: This bash snippet shows the PUT request to update the proxy configuration so that it accepts access tokens in the request header with the key name `apiAccessToken`. The default value for `action.clientTokenSuppliedIn` is `HEADER` and thus does not need to be defined in the request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_31\n\nLANGUAGE: bash\nCODE:\n```\nPUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy\n```\n\n----------------------------------------\n\nTITLE: Configuring Default Location Block for HTTPS Traffic in Nginx\nDESCRIPTION: This snippet configures the default location block ('/') in the 'server' block for HTTPS traffic in Nginx.  It proxies requests to the 'exchange' upstream, sets the HTTP version to 1.1, and clears the Connection header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_43\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation / {\n    proxy_pass https://exchange;\n    proxy_http_version 1.1;\n    proxy_set_header Connection \"\";\n}\n```\n\n----------------------------------------\n\nTITLE: Set operation mode to disconnected - NGINX Instance Manager\nDESCRIPTION: This snippet sets the `mode_of_operation` to `disconnected` in the NGINX Instance Manager configuration file. It's a prerequisite for configuring NGINX Instance Manager in a network-restricted (disconnected) environment.  Specific file and location details are presumably within the included markdown file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\n{{< include \"nim/disconnected/set-mode-of-operation-disconnected.md\" >}}\n```\n\n----------------------------------------\n\nTITLE: Generating Support Package Excluding Sidecar Logs\nDESCRIPTION: This command generates a support package similar to the previous one, but excludes information about sidecar containers. This can be useful when sidecar logs are not relevant to the issue being investigated, reducing the size of the generated package and simplifying analysis.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/support/contact-support.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl supportpkg --disable-sidecar-logs\n```\n\n----------------------------------------\n\nTITLE: Preparing Telemetry Report for Download\nDESCRIPTION: Prepares a telemetry report for download from NGINX Instance Manager API.  It sends a request to initiate the report generation. The command uses the `$ip_address` and `$basic_auth` variables. A JSON response is expected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nprepare_usage_command=\"curl --insecure --location 'https://$ip_address/api/platform/v1/report/download?format=zip&reportType=telemetry&telemetryAction=prepare' \\\n          --header 'accept: application/json' \\\n          --header 'authorization: Basic $basic_auth' \\\n          --header 'referer: https://$ip_address/ui/settings/license'\"\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Secret Definition for Registry Credentials\nDESCRIPTION: This YAML snippet defines a Kubernetes Secret used to store the private registry credentials. The secret is created in the `nginx-mesh` namespace and labeled for identification. The `.dockerconfigjson` field contains the base64 encoded configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/private-registry.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nkind: Secret\nmetadata:\n    name: nginx-mesh-registry-key\n    namespace: nginx-mesh\n    labels:\n        usage: nginx-mesh-registry-key\ndata:\n    .dockerconfigjson: <base64-encoded-config>\ntype: kubernetes.io/dockerconfigjson\n```\n\n----------------------------------------\n\nTITLE: Configuring WebSocket Proxy Nginx\nDESCRIPTION: This snippet defines a map to set the $connection_upgrade variable based on the $http_upgrade header, used for WebSocket proxying. It defaults to 'upgrade' if $http_upgrade is set, otherwise 'close'. This map is used to properly handle WebSocket connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_18\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n```\n\n----------------------------------------\n\nTITLE: Setting up DNF Repository (Amazon Linux 2023)\nDESCRIPTION: Creates the /etc/yum.repos.d/nginx-agent.repo file with the specified contents to configure the dnf repository for nginx-agent packages. This allows the dnf package manager to find and install the nginx-agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_30\n\nLANGUAGE: none\nCODE:\n```\n[nginx-agent]\nname=nginx-agent repo\nbaseurl=https://packages.nginx.org/nginx-agent/amzn/2023/$basearch/\nsslclientcert=/etc/ssl/nginx/nginx-repo.crt\nsslclientkey=/etc/ssl/nginx/nginx-repo.key\ngpgcheck=0\nenabled=1\n```\n\n----------------------------------------\n\nTITLE: Setting Termination Grace Period in Kubernetes YAML\nDESCRIPTION: This YAML snippet demonstrates how to set the `terminationGracePeriodSeconds` for a Kubernetes pod. Setting this value ensures that Kubernetes waits for the specified duration before forcefully terminating the pod, allowing `preStop` hooks to complete their execution. The provided example sets the termination grace period to 50 seconds.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/delay-pod-termination/termination-grace-period.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nterminationGracePeriodSeconds: 50\n```\n\n----------------------------------------\n\nTITLE: Upstream Health Check Metrics\nDESCRIPTION: Describes the 'plus.upstream.health.checks', 'plus.upstream.health.fails', and 'plus.upstream.health.unhealthy' metrics, which are counters for performed health check requests, failed health checks, and times upstream servers became unhealthy. These metrics monitor the effectiveness of health checks and server health.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_14\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Number of performed health check requests, failed health checks, and\n               how many times the upstream servers became unhealthy.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Internal Route VirtualServer Field\nDESCRIPTION: Adds the `internalRoute: true` field to a VirtualServer resource to designate it as an internal route, accessible only from within the mesh. This configuration prevents public internet access to the route.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\nspec:\n  internalRoute: true\n```\n\n----------------------------------------\n\nTITLE: Associate HTTPRouteGroup with TrafficSplit\nDESCRIPTION: This YAML snippet shows how to associate the `target-hrg` HTTPRouteGroup with a TrafficSplit resource.  The `matches` field in the TrafficSplit specification links the HTTPRouteGroup to the split, allowing traffic to be routed based on the criteria defined in the HTTPRouteGroup.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_18\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: split.smi-spec.io/v1alpha3\nkind: TrafficSplit\nmetadata:\n  name: target-ts\nspec:\n  service: target-svc\n  backends:\n  - service: target-v2-1\n    weight: 0\n  - service: target-v3-0\n    weight: 100\n  matches:\n  - kind: HTTPRouteGroup\n    name: target-hrg\n```\n\n----------------------------------------\n\nTITLE: Kubectl Check ClickHouse pod status YAML\nDESCRIPTION: This command retrieves the status of pods, filters for 'clickhouse', and shows wide output. It is used to check if the `ClickHouse` pod is crashing in a multi-node NGINX Controller configuration. The status `CrashLoopBackOff` indicates a problem.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl get po -o wide | grep clickhouse\nclickhouse-0                 0/1     CrashLoopBackOff   5          3m53s\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX Build Options\nDESCRIPTION: This command configures the NGINX build options by specifying paths for various files and enabling specific modules.  It is an example and needs to be adapted to the system where Nginx is being built.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_53\n\nLANGUAGE: shell\nCODE:\n```\n./configure\n--sbin-path=/usr/local/nginx/nginx\n--conf-path=/usr/local/nginx/nginx.conf\n--pid-path=/usr/local/nginx/nginx.pid\n--with-pcre=../pcre2-10.43\n--with-zlib=../zlib-1.3.1\n--with-http_ssl_module\n--with-stream\n--with-mail=dynamic\n--add-module=/usr/build/nginx-rtmp-module\n--add-dynamic-module=/usr/build/3party_module\n```\n\n----------------------------------------\n\nTITLE: Enable and Start API Connectivity Manager Service\nDESCRIPTION: This command enables and starts the `nms-acm` service using `systemctl`. The `--now` option ensures that the service is started immediately after being enabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm-offline.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl enable nms-acm --now\n```\n\n----------------------------------------\n\nTITLE: Experimental Gateway and Component API Properties\nDESCRIPTION: This snippet lists the Gateway and Component API properties that are marked as `experimental` but have not been implemented in this NGINX Controller release. Users are advised that these properties are not functional and should not be relied upon.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.2.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\ngateway.desiredState.ingress.headers\ngateway.desiredState.ingress.http2\ngateway.desiredState.ingress.spdy\ngateway.desiredState.ingress.proxyProtocol\ngateway.desiredState.ingress.notFoundStatusCode\ngateway.desiredState.ingress.setFib\ngateway.desiredState.ingress.fastOpen\ngateway.desiredState.ingress.acceptFilter\ngateway.desiredState.ingress.deferred\ngateway.desiredState.ingress.backlog\ngateway.desiredState.ingress.isIpv6Only\ngateway.desiredState.ingress.reusePort (set by controller for all listen directives)\ncomponents.desiredState.ingress.headers\ncomponents.desiredState.ingress.http2\ncomponents. desiredState.ingress.spdy\ncomponents.desiredState.ingress.proxyProtocol\ncomponents.desiredState.ingress.notFoundStatusCode\ncomponents.desiredState.backend.preserveHostHeader\ncomponents.desiredState.backend.queue\ncomponents. desiredState.backend.persistentState\ncomponents.desiredState.backend.workloadGroups.uris.route\ncomponents.desiredState.programmability.httpHttpsRedirect\ncomponents.desiredState.programmability.cookieModifications\ncomponents.desiredState.security.interceptWorkloadErrors\n```\n\n----------------------------------------\n\nTITLE: Testing Nginx Configuration\nDESCRIPTION: This shell command tests the Nginx configuration file for syntax errors. This is a crucial step to ensure the configuration is valid before reloading Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/image-filter.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Prometheus Annotations for NGINX Ingress Controller Pod Spec (YAML)\nDESCRIPTION: This YAML snippet shows the Prometheus annotations that need to be added to the NGINX Ingress Controller Pod spec for metrics collection.  The `prometheus.io/scrape` annotation enables Prometheus to scrape metrics from the pod, and `prometheus.io/port` specifies the port on which the metrics are exposed.  These annotations are essential for monitoring the NGINX Ingress Controller's performance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_11\n\nLANGUAGE: yaml\nCODE:\n```\nprometheus.io/scrape: \"true\"\nprometheus.io/port: \"<prometheus-metrics-listen-port>\"\n```\n\n----------------------------------------\n\nTITLE: Update HTTPRouteGroup with Path and Method\nDESCRIPTION: This YAML snippet updates the `target-hrg` HTTPRouteGroup to include a new match for GET requests to the `/api` endpoint. It demonstrates traffic splitting based on path and HTTP method in addition to header filters.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_26\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi-spec.io/v1alpha3\nkind: HTTPRouteGroup\nmetadata:\n  name: target-hrg\n  namespace: default\nspec:\n  matches:\n  - name: firefox-users\n    headers:\n      user-agent: \".*Firefox.*\"\n  - name: get-api-requests\n    pathRegex: \"/api\"\n    methods:\n    - GET\n```\n\n----------------------------------------\n\nTITLE: Health Check Match Definition\nDESCRIPTION: This snippet defines a `match` block named 'health_check' to specify the criteria for a successful health check.  It verifies the status code, Content-Type header, and response body against predefined values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_31\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\nmatch health_check {\n    status 200;\n    header Content-Type = text/html;\n    body ~ \"Welcome To Dizzyworld\";\n}\n```\n\n----------------------------------------\n\nTITLE: Hugo Shortcode: Include Content\nDESCRIPTION: This snippet demonstrates how to use the `include` shortcode to embed content from a file in the `/content/includes` directory into a documentation page. This allows for content to be defined once and reused across multiple pages, ensuring consistency and simplifying maintenance.\nSOURCE: https://github.com/nginx/documentation/blob/main/CONTRIBUTING_DOCS.md#_snippet_8\n\nLANGUAGE: Markdown\nCODE:\n```\n{{< include \"licensing-and-reporting/apply-jwt.md\" >}}\n```\n\n----------------------------------------\n\nTITLE: Load NJS Module in NGINX Configuration\nDESCRIPTION: This snippet shows how to load the NGINX JavaScript module (njs) by adding the `load_module` directive to the top-level configuration context in the NGINX Plus configuration file (`/etc/nginx/nginx.conf`).\nThis module is essential for handling interactions between NGINX Plus and the OneLogin identity provider (IdP).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/onelogin.md#_snippet_0\n\nLANGUAGE: Nginx configuration file\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\n```\n\n----------------------------------------\n\nTITLE: Install NDK Module on Debian and Ubuntu\nDESCRIPTION: This shell command updates the package lists for upgrades and new packages and then installs the nginx-plus-module-ndk package on Debian and Ubuntu systems. This ensures the system has the latest information about available packages before installing the NDK module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/ndk.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-ndk\n```\n\n----------------------------------------\n\nTITLE: Submit Usage Report to F5 via REST API (curl)\nDESCRIPTION: This curl command submits the usage report to F5 for verification using the F5 Product APIs. It sends a POST request to the `/ee/v1/entitlements/telemetry/bulk` endpoint with the report file attached. Requires a JWT for authorization.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/report-usage-disconnected-deployment.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\ncurl --location 'https://product.apis.f5.com/ee/v1/entitlements/telemetry/bulk' \\\n--header \"Authorization: Bearer $(cat /path/to/jwt-file)\" \\\n--form 'file=@\"<path-to-report>.zip\"'\n```\n\n----------------------------------------\n\nTITLE: Convert JSON Policy to Full JSON Policy\nDESCRIPTION: This snippet shows how to translate a valid NGINX App Protect WAF JSON policy into a full JSON policy, including elements from the defaults. Useful for creating a complete policy configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/convert-policy -i /path/to/policy.json -o /path/to/full_policy.json --full-export\n```\n\n----------------------------------------\n\nTITLE: API Response with Resolution Warning - JSON\nDESCRIPTION: This JSON snippet shows a typical API response including a warning message within `responseMetadata`. The warning indicates that the requested `resolution` was downsized due to metrics retention periods.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_10\n\nLANGUAGE: json\nCODE:\n```\n\"responseMetadata\": {\n    \"warning\": \"Time window is above 8 days, Resolution is downsized to 300 seconds\"\n}\n```\n\n----------------------------------------\n\nTITLE: Create Infrastructure Workspace (ACM)\nDESCRIPTION: This command creates an Infrastructure Workspace in API Connectivity Manager.  It requires NGINX Management Suite user credentials in the Basic Authentication header for the REST request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nPOST https://192.0.2.2/api/acm/v1/infrastructure/workspaces\n```\n\n----------------------------------------\n\nTITLE: Get NGINX Statistics using curl\nDESCRIPTION: This snippet demonstrates how to use the `curl` command to send a GET request to the NGINX Plus API to retrieve general statistics about NGINX.  It pipes the output to `json_pp` for pretty printing. It assumes API version 9 and depends on `curl` and `json_pp`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\ncurl -s 'https://demo.nginx.com/api/9/nginx' | json_pp\n```\n\n----------------------------------------\n\nTITLE: Upstream Fail and Unavailable Counts\nDESCRIPTION: Describes the 'plus.upstream.fails.count' and 'plus.upstream.unavail.count' metrics, which are counters for the number of unsuccessful attempts to communicate with upstream servers and the number of times upstream servers became unavailable, respectively. These metrics provide insight into upstream reliability.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_13\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Number of unsuccessful attempts to communicate with upstream servers, and\n               how many times upstream servers became unavailable for client requests.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Setting PHP-FPM Listen to TCP Port\nDESCRIPTION: These configuration lines replace the original socket configuration and set PHP-FPM to listen on 127.0.0.1:9000, explicitly allowing connections only from the local host. This is a security best practice for local communication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\nListen = 127.0.0.1:9000\nListen.allowed_clients = 127.0.0.1\n```\n\n----------------------------------------\n\nTITLE: Running Kubernetes Restore Script (./k8s-restore.sh)\nDESCRIPTION: This command executes the `k8s-restore.sh` script to restore NGINX Instance Manager in a Kubernetes environment. It takes the backup archive as input using the `-i` flag and performs a full restore with the `-r` flag. KUBECONFIG is set to specify the Kubernetes configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\nsudo KUBECONFIG=/etc/kubernetes/admin.conf ./k8s-restore.sh -i k8s-backup-<timestamp>.tar.gz -r\n```\n\n----------------------------------------\n\nTITLE: Service with Duplicate targetPorts\nDESCRIPTION: Example of an invalid Service configuration with duplicate `targetPort` values. NGINX Service Mesh disregards duplicate `targetPort` configurations and only honors one for traffic forwarding, authentication, and encryption. This leads to unexpected traffic routing behavior.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.5.0.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nkind: Service\nspec:\nports:\n  - port: 8080\n    protocol: TCP\n    targetPort: 55555\n  - port: 9090\n    protocol: TCP\n    targetPort: 55555\n```\n\n----------------------------------------\n\nTITLE: Configuring Session Persistence with Hash Directive - Nginx\nDESCRIPTION: This snippet configures session persistence using the 'hash' directive and the '$remote_addr' variable. This ensures that requests from the same client IP address are consistently routed to the same backend server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_18\n\nLANGUAGE: nginx\nCODE:\n```\nupstream tomcat {\n    hash $remote_addr;\n    server 10.100.100.11:8080;\n    server 10.100.100.12:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: Resetting Processes Statistics via API with DELETE Method (Shell)\nDESCRIPTION: This command resets the number of abnormally terminated and respawned child processes using the DELETE method via curl. It assumes the API is configured in read-write mode and targets the `/api/9/processes` endpoint on the specified host.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X DELETE -i 'http://192.168.1.23/api/9/processes'\n```\n\n----------------------------------------\n\nTITLE: Install nginx-plus-module-njs (CentOS 7)\nDESCRIPTION: This snippet shows how to install the latest version of the `nginx-plus-module-njs` module on CentOS 7. It's part of a workaround for a package error.  The command utilizes `yum install` with the `-y` flag for automatic yes to prompts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_31\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum install -y nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Disable SSL Verification in Nginx mgmt block\nDESCRIPTION: Disables SSL verification for usage reporting within the `mgmt` block of an Nginx configuration. This is generally not recommended for production environments due to security concerns. This configuration is used for testing and troubleshooting connectivity issues.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n    ssl_verify off;\n}\n```\n\n----------------------------------------\n\nTITLE: Adding Instance to Config Sync Group in agent-dynamic.conf\nDESCRIPTION: This snippet shows how to add an existing NGINX instance to a Config Sync Group by modifying the `agent-dynamic.conf` file.  The `instance_group` parameter specifies the Config Sync Group name. After modifying the file, the Nginx Agent needs to be restarted for the changes to take effect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/config-sync-groups/manage-config-sync-groups.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\ninstance_group: <config_sync_group>\n```\n\n----------------------------------------\n\nTITLE: Creating Shared Memory Zone for Upstream NGINX\nDESCRIPTION: This snippet creates a shared memory zone for an upstream server group within the `stream` block. This allows all worker processes to share the same upstream configuration.  It's essential for dynamic configuration changes to be reflected across all workers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_19\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    upstream stream_backend {\n        zone backend 64k;\n        # ...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Check Kubernetes certificates expiration\nDESCRIPTION: This command checks the expiration of Kubernetes certificates. It's used to identify if an expired kubelet certificate is preventing NGINX Controller from starting. It's part of the troubleshooting process for certificate-related issues. Requires `kubeadm` to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nkubeadm alpha certs check-expiration\n```\n\n----------------------------------------\n\nTITLE: Defining Cache Path for Nginx Proxy\nDESCRIPTION: This snippet defines the path where Nginx will store cached content. It also configures a shared memory zone named `backcache` to store cache keys and metadata, specifying its size as 10MB.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_21\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_path /tmp/NGINX_cache/ keys_zone=backcache:10m;\n```\n\n----------------------------------------\n\nTITLE: Setting SSL Handshake Timeout\nDESCRIPTION: This snippet configures the SSL handshake timeout for the TCP stream.  The `ssl_handshake_timeout` directive specifies the maximum time NGINX Plus will wait for the SSL handshake to complete.  Setting this value too low can cause handshake failures, while setting it too high can delay connection establishment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-tcp.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    #...\n    ssl_handshake_timeout 10s;\n}\n```\n\n----------------------------------------\n\nTITLE: Configure AWS PCA Upstream Authority in YAML\nDESCRIPTION: This YAML configuration sets up SPIRE to use Amazon Certificate Manager Private Certificate Authority (ACM PCA) as the upstream authority. It requires specifying the AWS region and the ARN of the certificate authority.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/secure-traffic-mtls.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: \"v1\"\nupstreamAuthority: \"aws_pca\"\nconfig:\n    region: \"us-west-2\"\n    certificate_authority_arn: \"arn:aws:acm-pca::123456789012:certificate-authority/test\"\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Controller Agent Status (Bash)\nDESCRIPTION: This command verifies that the NGINX Controller Agent service has started. It uses `ps ax` to list all processes and `grep -i` to filter the output for processes containing 'controller-'. The output shows the process ID, status, and command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/agent-restart.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nps ax | grep -i 'controller\\-'\n2552 ?        S      0:00 controller-agent\n```\n\n----------------------------------------\n\nTITLE: Configuring Hash Session Persistence in NGINX\nDESCRIPTION: This code configures session persistence based on the client's full IP address using the `hash` directive with the `$remote_addr` variable. All requests originating from the same IP address are forwarded to the same server within the upstream group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_18\n\nLANGUAGE: nginx\nCODE:\n```\nupstream jboss {\n    hash $remote_addr;\n    server 192.168.33.11:8080;\n    server 192.168.33.12:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: Disabling Signature in Policy JSON (signatures property)\nDESCRIPTION: This JSON snippet demonstrates how to disable a specific attack signature (ID 200001834) within the `policy` structure using the `signatures` property. It configures individual signatures within the policy by setting the `enabled` attribute to `false`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/policy-authoring-and-tuning.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"signature_exclude_1\",\n        \"signatures\": [\n            {\n                \"signatureId\": 200001834,\n                \"enabled\": false\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Shell Command to Edit NGINX Agent Configuration\nDESCRIPTION: This shell command opens the NGINX Agent configuration file (`/etc/nginx-agent/nginx-agent.conf`) in the `vi` text editor. It's used to enable support for NGINX App Protect WAF by configuring settings related to configuration directories, extensions, and precompiled publication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nsudo vi /etc/nginx-agent/nginx-agent.conf\n```\n\n----------------------------------------\n\nTITLE: Update nginx-agent.list\nDESCRIPTION: This command updates the `nginx-agent.list` file with the correct repository URL and signing key reference. This ensures that the system can properly authenticate and download updates for the NGINX Agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/troubleshooting.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-signing.gpg] https://<NMS_FQDN>/packages-repository/deb/ubuntu `lsb_release -cs` agent\\n\" | sudo tee /etc/apt/sources.list.d/nginx-agent.list\n```\n\n----------------------------------------\n\nTITLE: Upgrading the NGINX Developer Portal Helm Chart\nDESCRIPTION: This bash command upgrades an existing NGINX Developer Portal Helm chart release. It updates the release with the latest version or the version specified by `--version` and uses the configuration specified in the provided `values.yaml` file. This command requires an existing Helm release.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/devportal-helm-chart.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nhelm upgrade devportal nginx-stable/nginx-devportal --namespace devportal -f <path-to-your-values.yaml> [--version <desired-version>] --wait\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Instance Manager (RPM) - Bash\nDESCRIPTION: Upgrades NGINX Instance Manager package on RHEL and RPM-based systems using the `rpm` command. The `-Uvh` option upgrades the package. The `--nosignature` flag disables signature verification. After upgrading, it restarts the nms and nginx services.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide-deprecated.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo rpm -Uvh --nosignature /home/user/nms-instance-manager_<version>.x86_64.rpm\nsudo systemctl restart nms\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Updating Kubernetes Certificate Validity Period using update.sh\nDESCRIPTION: This snippet shows how to override the default Kubernetes certificate validity period during product updates by setting the `CTR_CERT_RENEWAL_PERIOD` environment variable. This can be used to extend the validity period beyond the default two years.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.9.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\n./update.sh -e CTR_CERT_RENEWAL_PERIOD=3650\n```\n\n----------------------------------------\n\nTITLE: Creating SSL/TLS Virtual Server and Pool on BIG-IP LTM\nDESCRIPTION: This snippet creates a pool and a virtual server for SSL/TLS traffic on BIG-IP LTM. It sets the destination to port 443 and adds HTTP profile to the virtual server configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\n# create pool ssl_test_pool members add { 10.10.10.10:443 10.10.10.20:443 }\n# create virtual test_ssl_virtual { destination 192.168.10.10:443 pool ssl_test_pool source-address-translation { type automap } ip-protocol tcp profiles add { http } }\n# save /sys config\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Agent\nDESCRIPTION: This command installs NGINX Agent on the Nginx instance. It uses curl to download the install script and executes it with the data plane key. Replace `YOUR_DATA_PLANE_KEY` with the actual key. The `-y` option automatically confirms prompts during installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/getting-started.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://agent.connect.nginx.com/nginx-agent/install | DATA_PLANE_KEY=\"YOUR_DATA_PLANE_KEY\" sh -s -- -y\n```\n\n----------------------------------------\n\nTITLE: Set error.log Level to Warn - Nginx\nDESCRIPTION: Sets the Nginx `error.log` level to `warn`. This configuration ensures that only warning-level and higher messages are logged, which can be helpful in reducing log volume while still capturing important error information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-metrics-collection.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nerror_log /var/log/nginx/error.log warn;\n```\n\n----------------------------------------\n\nTITLE: Configure MAPI Virtual Directory PowerShell\nDESCRIPTION: This command configures the internal and external URLs and IIS authentication methods for the MAPI virtual directory using the Set-MapiVirtualDirectory cmdlet in PowerShell.  It sets the internal and external URLs and enables Basic authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_9\n\nLANGUAGE: PowerShell\nCODE:\n```\nC:\\> Set-MapiVirtualDirectory\n-InternalURL http://mail.company.com/mapi\n-ExternalURL https://mail.company.com/mapi\n-IISAuthenticationMethods Basic\n```\n\n----------------------------------------\n\nTITLE: Running the Custom Policy Converter Image\nDESCRIPTION: Example command to run the custom Policy Converter image built using the Dockerfile.  The command mounts the current directory and specifies input and output files. It assumes the image has been tagged as `waf-policy-converter-<version-tag>:custom`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker run --rm \\\n -v $(pwd):$(pwd) \\\n waf-compiler-<version-tag>:custom \\\n -i $(pwd)/policy1.xml -o $(pwd)/policy1.json\n```\n\n----------------------------------------\n\nTITLE: Configuring DNS Resolver in NGINX\nDESCRIPTION: This snippet configures the DNS resolver in the NGINX `http` block. The `resolver` directive specifies the DNS server's IP address, enables IPv4 resolution, and sets a TTL of 300 seconds. This is necessary for NGINX to resolve the Okta issuer URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/okta.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Downloading Telemetry Report from NGINX Instance Manager\nDESCRIPTION: Downloads a telemetry report (initial or telemetry) from the NGINX Instance Manager API using `curl`.  The command uses the `$ip_address`, `$basic_auth` and `$report_save_path` variables.  The report type (initial or telemetry) is specified in the URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ndownload_usage_command=\"curl --insecure --location 'https://$ip_address/api/platform/v1/report/download?format=zip&reportType=initial' \\\n          --header 'accept: */*' \\\n          --header 'authorization: Basic $basic_auth' \\\n          --output \\\"$report_save_path\\\"\"\n```\n\nLANGUAGE: shell\nCODE:\n```\ndownload_usage_command=\"curl --insecure --location 'https://$ip_address/api/platform/v1/report/download?format=zip&reportType=telemetry&telemetryAction=download' \\\n  --header 'accept: */*' \\\n  --header 'authorization: Basic $basic_auth' \\\n  --output \\\"$report_save_path\\\"\"\n```\n\n----------------------------------------\n\nTITLE: Querying Metrics API with Names Parameter\nDESCRIPTION: This curl command queries the Metrics API for a specific metric, `nginx.http.request.count`. It uses the `names` parameter to specify the metric of interest.  The API returns the last recorded value for the queried metric, and requires a valid access token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/metrics?names=nginx.http.request.count\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Create PostgreSQL Database and User\nDESCRIPTION: Creates the `devportal` database, adds the `nginxdm` user with a password, and grants all privileges on the database to the user. These commands are executed as the `postgres` user.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo -u postgres createdb devportal\nsudo -u postgres psql -c \"CREATE USER nginxdm WITH LOGIN PASSWORD 'nginxdm';\"\nsudo -u postgres psql -c \"GRANT ALL PRIVILEGES ON DATABASE devportal TO nginxdm;\"\n```\n\n----------------------------------------\n\nTITLE: Policy Configuration with HTTPS Response Page Reference JSON\nDESCRIPTION: This JSON configures an App Protect policy that uses an HTTPS URL to reference a custom response page.  It retrieves the response page content from the specified secure URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-references.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\": \"external_references_custom_respsonse\",\n    \"template\": {\n        \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"applicationLanguage\": \"utf-8\",\n    \"enforcementMode\": \"blocking\",\n    \"responsePageReference\": {\n        \"link\": \"https://securedomain.com:8081/response-pages.txt\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Stopping NGINX Agent on Debian/Ubuntu\nDESCRIPTION: This snippet demonstrates how to stop the NGINX Agent on Debian and Ubuntu systems using systemctl. This step is a prerequisite for upgrading NGINX App Protect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/admin-guide/upgrade-nap-waf.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl stop nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Loading App Protect DoS Module\nDESCRIPTION: This command loads the Nginx App Protect DoS module within the main context of the nginx.conf file. This enables the DoS protection functionality. Requires access to the nginx.conf file and the module library.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nload_module modules/ngx_http_app_protect_dos_module.so;\n```\n\n----------------------------------------\n\nTITLE: Expected Output of Nginx Configuration Test\nDESCRIPTION: This is the expected output of the `nginx -t` command, indicating that the Nginx configuration file has correct syntax and can be loaded without errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip2.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Installing Passenger module on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This code snippet demonstrates how to install the `nginx-plus-module-passenger` package on Amazon Linux 2, CentOS, Oracle Linux, and RHEL systems using the yum package manager. It first updates the package list and then installs the module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/passenger-open-source.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-passenger\n```\n\n----------------------------------------\n\nTITLE: Test NGINX Configuration\nDESCRIPTION: This shell command tests the NGINX configuration file for syntax errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/rtmp.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Installing GeoIP2 Module on FreeBSD\nDESCRIPTION: This command updates the package manager and installs the `nginx-plus-module-geoip2` package on FreeBSD systems. The module is required to use MaxMind GeoIP2 databases within Nginx Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/geoip2.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-geoip2\n```\n\n----------------------------------------\n\nTITLE: Create API Proxy (ACM)\nDESCRIPTION: This command creates an API proxy in API Connectivity Manager within a specified Service Workspace. It requires NGINX Management Suite user credentials in the Basic Authentication header for the REST request. The Proxy service target is an echo server in this example.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_18\n\nLANGUAGE: bash\nCODE:\n```\nPOST https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies\n```\n\n----------------------------------------\n\nTITLE: Run Helper Container (Shell)\nDESCRIPTION: This shell command runs a helper container named mynginx4_files based on the Debian image. It uses the --volumes-from option to mount the volumes from the mynginx4 container, providing access to the content and configuration files.  The container runs in interactive mode (-i) with a TTY (-t) and executes /bin/bash.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_26\n\nLANGUAGE: shell\nCODE:\n```\n$ docker run -i -t --volumes-from mynginx4 --name mynginx4_files debian /bin/bash\nroot@b1cbbad63dd1:/#\n```\n\n----------------------------------------\n\nTITLE: Key-Value Storage Zone Synchronization in NGINX\nDESCRIPTION: This snippet configures key-value storage zone synchronization in NGINX. It adds the `sync` parameter to the `keyval_zone` directive to share key-value pairs across the cluster.  The `state` parameter defines the path to the state file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nkeyval_zone zone=one:32k state=/var/lib/nginx/state/one.keyval sync;\nkeyval $arg_text $text zone=one;\n#...\nserver {\n    #...\n    location / {\n        return 200 $text;\n    }\n\n    location /api {\n        api write=on;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration\nDESCRIPTION: This command reloads the Nginx configuration. This is necessary to apply any changes made to the nginx.conf file.  It uses the `nginx` command with the `-s reload` option to signal the Nginx master process to reload the configuration without downtime.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/use-cases/monitoring/enable-nginx-plus-api.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Ansible Role\nDESCRIPTION: This command installs the official Ansible role for NGINX from NGINXinc.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/microsoft-azure/virtual-machines-for-nginx.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nansible-galaxy install nginxinc.nginx\n```\n\n----------------------------------------\n\nTITLE: List Token Cache Directory - Bash\nDESCRIPTION: This command lists the contents of the Nginx cache directory and filters the results to find the token cache realm.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_39\n\nLANGUAGE: bash\nCODE:\n```\nls -l /var/cache/nginx/ | grep tokens_\n```\n\n----------------------------------------\n\nTITLE: Install SQLite on CentOS 7, Amazon Linux 2, and Oracle Linux 7\nDESCRIPTION: Installs SQLite on CentOS 7, Amazon Linux 2, and Oracle Linux 7. This process involves installing build tools, downloading and compiling libuv, raft, and sqlite3 from source due to compatibility issues with the system's default packages. It configures and installs each library with static linking to avoid dependency conflicts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/sqlite-installation.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo su\nyum install -y gcc \\\n    make \\\n    automake \\\n    lz4-devel \\\n    libtool \\\n    diffutils \\\n    file\n\nLIBUV=1.30.0\nRAFT=0.10.0\nSQLITE3=3410100\n\ncurl -L -o libuv.tar.gz https://github.com/libuv/libuv/archive/refs/tags/v${LIBUV}.tar.gz && \\\n    tar -zxf libuv.tar.gz && cd libuv-${LIBUV} && sh autogen.sh && ./configure --prefix=/usr --enable-shared=no && make && make install && cd .. && rm -rf libuv.tar.gz libuv-${LIBUV}\ncurl -L -o raft.tar.gz https://github.com/canonical/raft/archive/refs/tags/v${RAFT}.tar.gz && \\\n    tar -zxf raft.tar.gz && cd raft-${RAFT} && autoreconf -i && ./configure --disable-lz4 --prefix=/usr --enable-shared=no && make && make install && cd .. && rm -rf raft.tar.gz raft-${RAFT}\ncurl -L -o sqlite3.tar.gz https://sqlite.org/2023/sqlite-autoconf-${SQLITE3}.tar.gz && \\\n    tar -zxf sqlite3.tar.gz && cd sqlite-autoconf-${SQLITE3} && ./configure --prefix=/usr --enable-shared=no && make && make install && cd .. && rm -rf sqlite3.tar.gz sqlite-autoconf-${SQLITE3}\n```\n\n----------------------------------------\n\nTITLE: Querying Security Violation Events by Support ID\nDESCRIPTION: This example demonstrates how to query security violation events filtered by a specific Support ID using the NGINX Controller REST API. The Support ID is a unique identifier associated with a request blocking page.  startTime is set to 0 and endTime to now.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/view-app-security-analytics.md#_snippet_3\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            waf.support_id='1880765231147185611')\n```\n\n----------------------------------------\n\nTITLE: Querying NS1 API for Active Connections\nDESCRIPTION: This snippet queries the NS1 API to get the number of active connections reported by the NS1 agent. It requires an NS1 API key, data source ID, and feed ID. The `curl` command retrieves the data feed details, and `python -m json.tool` formats the JSON output. The output contains the number of active connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\n$ curl -X GET -H 'X-NSONE-Key: <NS1-API-key>' https://api.nsone.net/v1/data/feeds/<NS1-data-source-ID>/<NS1-feed-ID> | python -m json.tool\n\n{\n  \"config\": {\n    \"label\": \"us-nginxgslb-datafeed\"\n  },\n  \"data\": {\n    \"connections\": 1,\n    \"up\": true\n  },\n  \"destinations\": [\n    {\n      \"destid\": \"<Answer-ID>\",\n      \"desttype\": \"answer\",\n      \"record\": \"<Record-ID>\"\n    }\n  ],\n  \"id\": \"<Feed-ID>\",\n  \"name\": \"us-nginxgslb-datafeed\",\n  \"networks\": [\n    0\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Create tracing namespace in Kubernetes\nDESCRIPTION: Creates a namespace named 'tracing' in the Kubernetes cluster. This namespace will be used to deploy the OpenTelemetry Collector and Jaeger instances.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl create namespace tracing\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Instance Manager (Docker Compose)\nDESCRIPTION: This command deploys the NGINX Instance Manager using Docker Compose, running the services in detached mode (-d). It reads the service definitions from the `docker-compose.yaml` file in the current directory. The `-d` flag ensures the containers run in the background.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ndocker compose up -d\n```\n\n----------------------------------------\n\nTITLE: Configuring Debug Logging for Virtual Host\nDESCRIPTION: These Nginx configuration directives demonstrate how to enable debugging logging for a particular virtual host by specifying the `error_log` directive with the `debug` level inside the `server` block, overriding the global settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nerror_log /path1/to/log debug;\n...\nhttp {\n    ...\n    server {\n    error_log /path2/to/log debug;\n    ...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Numeric MultiSelect Field JSON Schema Example\nDESCRIPTION: This JSON schema defines a numeric MultiSelect field named 'proxyTimeout' within an array. It allows users to select multiple values from a predefined list of numbers (10, 20, 30, 40, 50).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/reference/json-schema-reference.md#_snippet_7\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"proxyTimeout\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"number\",\n        \"enum\": [10, 20, 30, 40, 50]\n      }\n    }\n  }\n```\n\n----------------------------------------\n\nTITLE: Embedding OpenAPI Specification\nDESCRIPTION: This snippet includes an OpenAPI specification file to generate API documentation using a shortcode. It uses the `openapi` shortcode to embed the contents of the `./nginx-controller/api/reference/ctlr-adc-openapi.json` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/api/reference/ctlr-adc-api.md#_snippet_0\n\nLANGUAGE: HTML\nCODE:\n```\n{{< openapi spec=\"./nginx-controller/api/reference/ctlr-adc-openapi.json\" >}}\n```\n\n----------------------------------------\n\nTITLE: Create OpenShift Project for NMS\nDESCRIPTION: Creates a new project named 'nms' in OpenShift. This project isolates the NGINX Instance Manager deployment from other applications running on the OpenShift cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\noc new-project nms\n```\n\n----------------------------------------\n\nTITLE: Testing Nginx Configuration\nDESCRIPTION: This command tests the Nginx configuration file for syntax errors before reloading the configuration. This prevents service disruptions caused by invalid configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/brotli.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Docker Compose configuration for NGINX App Protect WAF\nDESCRIPTION: This snippet shows the Docker Compose file configuration for deploying NGINX App Protect WAF.  It defines the `waf-enforcer` and `waf-config-mgr` services, their dependencies, volumes, network, and environment variables. Replace the version tag with the actual release version being deployed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_43\n\nLANGUAGE: yaml\nCODE:\n```\nservices:\n  waf-enforcer:\n    container_name: waf-enforcer\n    image: waf-enforcer:5.2.0\n    environment:\n      - ENFORCER_PORT=50000\n    ports:\n      - \"50000:50000\"\n    volumes:\n      - /opt/app_protect/bd_config:/opt/app_protect/bd_config\n    networks:\n      - waf_network\n    restart: always\n\n  waf-config-mgr:\n    container_name: waf-config-mgr\n    image: waf-config-mgr:5.2.0\n    volumes:\n      - /opt/app_protect/bd_config:/opt/app_protect/bd_config\n      - /opt/app_protect/config:/opt/app_protect/config\n      - /etc/app_protect/conf:/etc/app_protect/conf\n    restart: always\n    network_mode: none\n    depends_on:\n      waf-enforcer:\n        condition: service_started\n\nnetworks:\n  waf_network:\n    driver: bridge\n```\n\n----------------------------------------\n\nTITLE: Configuring X-Frame-Options header in Nginx\nDESCRIPTION: This snippet configures the X-Frame-Options header to prevent clickjacking attacks by restricting whether a browser can render a page in an iframe. Setting it to SAMEORIGIN allows the page to be displayed in an iframe only if the origin matches the origin of the top-level browsing context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-response-headers.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nadd_header X-Frame-Options SAMEORIGIN [always]\n```\n\n----------------------------------------\n\nTITLE: Backing Up Nginx Configuration Files\nDESCRIPTION: These commands back up the original Nginx configuration files `openid_configuration.conf` and `nms-http.conf` before modification. This allows for easy restoration to the original state if needed. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo cp /etc/nms/nginx/oidc/openid_configuration.conf ~/openid_configuration.conf.orig\nsudo cp /etc/nginx/conf.d/nms-http.conf ~/nms-http.conf.orig\n```\n\n----------------------------------------\n\nTITLE: Query NGINX logs by location in Azure Monitor Logs using KQL\nDESCRIPTION: This KQL query filters the NGXOperationLogs table in Azure Monitor Logs to retrieve logs from a specific location (e.g., eastus). It demonstrates how to use the 'where' operator to filter based on the 'Location' attribute. The result shows NGINXaaS logs from the specified location.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginxaas-azure/logging-analysis-logs-analytics.md#_snippet_0\n\nLANGUAGE: KQL\nCODE:\n```\nNGXOperationLogs\n| where Location contains \"eastus\"\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration\nDESCRIPTION: This shell command reloads the NGINX configuration, applying any changes made to the configuration files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/rtmp.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Specifying the HTTP Authentication Server\nDESCRIPTION: This configuration snippet shows how to specify the HTTP authentication server using the `auth_http` directive. The authentication server authenticates email clients and chooses an upstream server for processing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nmail {\n        server_name mail.example.com;\n        auth_http   localhost:9000/cgi-bin/nginxauth.cgi;\n        #...\n    }\n```\n\n----------------------------------------\n\nTITLE: Making API Requests with Basic Authentication using curl\nDESCRIPTION: This snippet demonstrates how to make an API request using basic authentication with curl.  It sends the base64-encoded credentials in the Authorization header.  It is crucial to replace `<NMS_FQDN>` with the actual fully qualified domain name of your NGINX Management Suite instance. Basic Authentication is not secure and is not recommended for production environments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/about/api-overview.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET \"https://<NMS_FQDN>/api/acm/<API_VERSION>/workspaces/infrastructure\" -H \"Authorization: Basic YWRtaW...\"\n```\n\n----------------------------------------\n\nTITLE: Deploy Nginx Mesh with Upstream CA Configuration\nDESCRIPTION: This command shows how to deploy Nginx Service Mesh using `nginx-meshctl` and specifying the path to the upstream CA configuration file using the `--mtls-upstream-ca-conf` flag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/secure-traffic-mtls.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --mtls-upstream-ca-conf /path/to/upstream_authority.yaml\n```\n\n----------------------------------------\n\nTITLE: Active Directory LDAP Domain Example\nDESCRIPTION: This code snippet shows an example of the LDAP domain to authenticate against as a domain-component when configuring an Active Directory authentication provider in NGINX Controller.  This value is used to establish a connection to the AD server. The LDAP domain cannot be updated after it's initially set.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\nDC=mydomain,DC=example,DC=com\n```\n\n----------------------------------------\n\nTITLE: Get Kubernetes Events\nDESCRIPTION: This command uses `kubectl get events` to retrieve events from the `nginx-gateway` namespace. Events provide insights into the system and configuration changes, including warnings about deleted resources or other operational issues within the cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get events -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Load Docker Images\nDESCRIPTION: Loads the downloaded Docker images into the local Docker environment.  This allows the images to be tagged and pushed to a private registry for use in Kubernetes deployments.  The images contain the API and API Gateway components of the Developer Portal.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/devportal-helm-chart.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ndocker load -i nginx-devportal-api-<version>-img.tar.gz\ndocker load -i nginx-devportal-apigw-<version>-img.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Install njs module on Alpine\nDESCRIPTION: This snippet shows how to install the `nginx-plus-module-njs` package on Alpine Linux using the `apk` package manager. This single command installs the required module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginscript.md#_snippet_4\n\nLANGUAGE: Shell\nCODE:\n```\napk add nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Restart Nginx Container (Shell)\nDESCRIPTION: This shell command restarts a Docker container, effectively restarting Nginx within the container.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_34\n\nLANGUAGE: shell\nCODE:\n```\ndocker restart container-name\n```\n\n----------------------------------------\n\nTITLE: Generate Traffic to Target Service\nDESCRIPTION: This command generates traffic to the target service by sending HTTP requests to the gateway's external IP address in a loop. It simulates user traffic to test and observe the traffic splitting configurations. The loop runs for 5 minutes, sending one request per second.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nfor i in $(seq 1 300); do curl $GATEWAY_IP; sleep 1; done\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisites for NGINX on SUSE\nDESCRIPTION: This command installs necessary tools for managing and verifying packages from the official NGINX repository on SUSE. It includes curl for downloading files, ca-certificates for SSL certificate verification, and gpg2 for verifying cryptographic signatures using the zypper package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_30\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper install curl ca-certificates gpg2\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX service (service)\nDESCRIPTION: This command restarts the NGINX service using the `service` command. This is a common step after resolving port conflicts to ensure that NGINX starts properly and begins serving traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/troubleshooting.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo service nginx restart\n```\n\n----------------------------------------\n\nTITLE: Example API Response for Sync Status\nDESCRIPTION: This is an example of the JSON response received from the NGINX Plus API when polling for the synchronization status of shared memory zones.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_15\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"zones\" : {\n    \"zone1\" : {\n      \"records_pending\" : 2061,\n      \"records_total\" : 260575\n    },\n    \"zone2\" : {\n      \"records_pending\" : 0,\n      \"records_total\" : 14749\n    }\n  },\n  \"status\" : {\n    \"bytes_in\" : 1364923761,\n    \"msgs_in\" : 337236,\n    \"msgs_out\" : 346717,\n    \"bytes_out\" : 1402765472,\n    \"nodes_online\" : 15\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Verify Nginx Agent installation on Ubuntu\nDESCRIPTION: This command checks the version of the installed Nginx Agent to verify that the installation was successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx-agent -v\n```\n\n----------------------------------------\n\nTITLE: Upgrading from NGINX OSS to NGINX Plus\nDESCRIPTION: This command upgrades an existing NGINX OSS installation to NGINX Plus using Helm. It configures the image repository, enables NGINX Plus features, and sets the image pull secret. Requires Helm 3.0+, kubectl, a Docker registry secret, and JWT secrets configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nhelm upgrade ngf oci://ghcr.io/nginx/charts/nginx-gateway-fabric  --set nginx.image.repository=private-registry.nginx.com/nginx-gateway-fabric/nginx-plus --set nginx.plus=true --set serviceAccount.imagePullSecret=nginx-plus-registry-secret -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Make Certificate Script Executable\nDESCRIPTION: These bash commands change the permissions of the `make_certs.sh` script to be executable and then executes the script with sudo privileges.  This allows the script to create the necessary certificates and keys, potentially in protected directories.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo chmod +x ./make_certs.sh\nsudo ./make_certs.sh\n```\n\n----------------------------------------\n\nTITLE: Configuring Enforcer Address\nDESCRIPTION: This Nginx configuration snippet configures the address of the App Protect enforcer at the `http` context. The `app_protect_enforcer_address` directive specifies the hostname and port where the enforcer service is running. It's essential for Nginx to communicate with the enforcer to enforce security policies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_19\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enforcer_address waf-enforcer:50000;\n```\n\n----------------------------------------\n\nTITLE: Copy Certificates to NGINX Instance Manager\nDESCRIPTION: These bash commands copy the `ca.pem`, `server.crt`, and `server.key` files to the `/etc/nms/certs/` directory on the NGINX Instance Manager server using sudo privileges. These files are required for NGINX Instance Manager to authenticate and communicate securely.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/secure-traffic.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nsudo cp ca.pem /etc/nms/certs/\nsudo cp server.crt /etc/nms/certs/\nsudo cp server.key /etc/nms/certs/\n```\n\n----------------------------------------\n\nTITLE: Configure DoS Monitor Port - Nginx\nDESCRIPTION: This configuration shows how to configure the `app_protect_dos_monitor` directive, ensuring that the port specified matches the port the server is listening on. A mismatch can lead to false attack declarations.  The example shows a server listening on port 8080.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-4.1.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nserver {\n    listen 8080;\n    location / {  app_protect_dos_monitor \"myservice.com:8080\";  }\n}\n```\n\n----------------------------------------\n\nTITLE: Gateway update failure with Authentication enabled\nDESCRIPTION: This snippet shows an error message that occurs when updating a gateway associated with a Published API with multiple gateways and Authentication enabled in the associated component. It indicates a failure during the configuration testing phase.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.7.md#_snippet_3\n\nLANGUAGE: text\nCODE:\n```\nFailed testing config before applying\n```\n\n----------------------------------------\n\nTITLE: Enabling TCP_NODELAY (Nginx)\nDESCRIPTION: This snippet enables the operating system's `TCP_NODELAY` option within the 'http' block. This option disables the aggregating of small messages, potentially improving performance by reducing latency. The directive value is set to 'on'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_31\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\ntcp_nodelay on;\n```\n\n----------------------------------------\n\nTITLE: Echo Server Request with Opaque Token\nDESCRIPTION: This snippet shows the request received by the echo server when an opaque token is used. The `Authorization` header may or may not be present depending on configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_62\n\nLANGUAGE: bash\nCODE:\n```\nRequest served by echo-host\n\nHTTP/1.0 POST /my/test/api\n\nHost: default_http_07b28d26-9641-4a67-a422-0c4e14f27b03\nAccept: */*\nAccept-Encoding: gzip, deflate, br\nCache-Control: no-cache\nConnection: close\nContent-Length: 30\nContent-Type: application/json\nX-Correlation-Id: 00342cadec0651b6643fcf092246535f\n```\n\n----------------------------------------\n\nTITLE: Keepalive Connections NGINX\nDESCRIPTION: This snippet configures keepalive connections in NGINX Plus. It creates an upstream group named `test_pool` and sets the `keepalive` directive to 32, specifying the maximum number of idle keepalive connections to upstream servers. The snippet also defines the upstream servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\nupstream test_pool {\n    server 10.10.10.10:80;\n    server 10.10.10.20:80;\n    keepalive 32;\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstall Nginx Instance Manager\nDESCRIPTION: This command executes the `install-nim-bundle.sh` script with the `-r` flag to remove NGINX Instance Manager and all its dependencies, including NGINX and ClickHouse. This is intended for use when re-running the script in a fresh environment and will result in data loss.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nbash install-nim-bundle.sh -r\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Instance Manager Services\nDESCRIPTION: These commands restart the `nms-ingestion` and `nms-core` services, ensuring that the updated GeoLite2 database is loaded and utilized by the NGINX Security Monitoring module. This requires sudo privileges to execute the `systemctl restart` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/update-geo-db.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nms-ingestion\nsudo systemctl restart nms-core\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Service Configuration with Duplicate targetPorts\nDESCRIPTION: Illustrates an invalid Kubernetes Service configuration where multiple ports duplicate the `.spec.ports[].targetPort` value, leading to only one port configuration being honored. This is a known issue in NGINX Service Mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.6.0.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nkind: Service\nspec:\nports:\n- port: 8080\n     protocol: TCP\n     targetPort: 55555\n- port: 9090\n     protocol: TCP\n     targetPort: 55555\n```\n\n----------------------------------------\n\nTITLE: Pass OIDC Claims to Application\nDESCRIPTION: This snippet passes OIDC claims from the ID token as headers to the backend application using `proxy_set_header`. Claims like `sub`, `email`, and `name` are extracted and forwarded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/cognito.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nlocation / {\n     auth_oidc cognito;\n\n     proxy_set_header sub   $oidc_claim_sub;\n     proxy_set_header email $oidc_claim_email;\n     proxy_set_header name  $oidc_claim_name;\n\n     proxy_pass http://127.0.0.1:8080;\n}\n# ...\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Plus Certificate Bundle as JSON\nDESCRIPTION: This command downloads the NGINX Plus certificate and key bundle in JSON format using the NGINX Controller API. It requires a valid session cookie for authentication and saves the output to a file named `nginx-plus-certs.json`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/get-n-plus-cert-and-key.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ncurl -b cookie.txt -c cookie.txt --header 'Content-Type: application/json' -X GET --url 'https://192.0.2.0/api/v1/platform/licenses/nginx-plus-licenses/controller-provided'  --output nginx-plus-certs.json\n```\n\n----------------------------------------\n\nTITLE: Generating Self-Signed Certificate\nDESCRIPTION: This command generates a self-signed certificate using OpenSSL.  It uses the generated private key and prompts for information to include in the certificate. The validity period is set using the -days option.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl req -new -x509 -key ~/private-key.pem -out ~/self-cert.pem \\\n                      -days 10950\n```\n\n----------------------------------------\n\nTITLE: Enabling Sendfile in Nginx\nDESCRIPTION: This snippet demonstrates enabling the `sendfile` directive, which optimizes file transmission by eliminating the step of copying data into a buffer. It also shows limiting the amount of data transferred in a single `sendfile()` call using `sendfile_max_chunk`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /mp3 {\n    sendfile           on;\n    sendfile_max_chunk 1m;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Inject Resources with ignored outgoing ports\nDESCRIPTION: This command injects resources from my-app.yaml using nginx-meshctl, configuring the proxies to ignore outgoing traffic on ports 1433 and 1434.  The --ignore-outgoing-ports flag specifies the ports to be ignored, separated by commas.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl inject --ignore-outgoing-ports 1433,1434 -f ./my-app.yaml\n```\n\n----------------------------------------\n\nTITLE: Redeploying NGINX Service Mesh with Prior Version (Bash)\nDESCRIPTION: This command redeploys NGINX Service Mesh with the images from a prior version. It is used as a temporary workaround to restore service before upgrading to version 0.9.1, specifically when private registry credentials are required.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.9.1.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl -n <namespace> deploy --registry-server <registry-server> --image-tag <tag>\n```\n\n----------------------------------------\n\nTITLE: Configuring PKG_ENV for FreeBSD (Shell)\nDESCRIPTION: This command configures the `PKG_ENV` variables in `/usr/local/etc/pkg.conf` for FreeBSD to specify the location of the NGINX Plus certificate and key files.  This allows the package manager to authenticate against the NGINX Plus repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nPKG_ENV: { SSL_NO_VERIFY_PEER: \"1\",\nSSL_CLIENT_CERT_FILE: \"/etc/ssl/nginx/nginx-repo.crt\",\nSSL_CLIENT_KEY_FILE: \"/etc/ssl/nginx/nginx-repo.key\" }\n```\n\n----------------------------------------\n\nTITLE: Invalid Service Configuration Example - Kubernetes YAML\nDESCRIPTION: This snippet shows an invalid Kubernetes Service configuration with duplicate targetPorts. NGINX Service Mesh disregards duplicate targetPorts, leading to unexpected traffic forwarding. The Service must use unique `.spec.ports[].targetPort` values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.1.0.md#_snippet_0\n\nLANGUAGE: plaintext\nCODE:\n```\napiVersion: v1\nkind: Service\nspec:\n  ports:\n  - port: 8080\n    protocol: TCP\n    targetPort: 55555\n  - port: 9090\n    protocol: TCP\n    targetPort: 55555\n```\n\n----------------------------------------\n\nTITLE: TLS Handshake Error Log Example\nDESCRIPTION: This example shows a TLS handshake error log from the smi-metrics Pod. This error indicates a potential issue where the Spire server fails to communicate its certificate authority (CA) to dependent resources during NGINX Service Mesh deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.0.0.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\necho: http: TLS handshake error from :: remote error: tls: bad certificate\n```\n\n----------------------------------------\n\nTITLE: Health Check Configuration\nDESCRIPTION: This snippet enables health checks for the '/weblogic-app/' location using the `health_check` directive.  It specifies a URI and a named `match` block to define the criteria for a successful health check.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_30\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /weblogic-app/ {\n    proxy_pass http://weblogic;\n    proxy_cache backcache;\n    health_check uri=/benefits match=health_check;\n}\n```\n\n----------------------------------------\n\nTITLE: Send POST request to coffee exceeding gateway limit\nDESCRIPTION: This snippet sends a POST request to the coffee application exceeding the gateway-level `client_max_body_size` limit (50 bytes). This confirms that the gateway policy still applies to routes without specific policies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_20\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee -X POST --data \"this payload is greater than fifty bytes but less than seventy five\"\n```\n\n----------------------------------------\n\nTITLE: Get Okta Configuration\nDESCRIPTION: This command retrieves the OpenID configuration from Okta, which includes URLs for the authorization endpoint, token endpoint, and JSON Web Key (JWK) file. The output is piped to `jq` for easy readability.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/okta.md#_snippet_2\n\nLANGUAGE: Shell\nCODE:\n```\ncurl https://<username>-admin.okta.com/.well-known/openid-configuration | jq\n```\n\n----------------------------------------\n\nTITLE: Restricting Access using ngx_http_access_module in NGINXaaS\nDESCRIPTION: This snippet references the NGINX documentation on how to restrict access to NGINXaaS based on various criteria such as IP addresses, domain names, and HTTP headers. It explains using the access control list using the ngx_http_access_module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/faq.md#_snippet_1\n\nLANGUAGE: text\nCODE:\n```\nNGINX module ngx_http_access_module (http://nginx.org/en/docs/http/ngx_http_access_module.html)\n```\n\n----------------------------------------\n\nTITLE: Object Field JSON Schema Example\nDESCRIPTION: This JSON schema defines an object field named 'server' with nested properties 'isBackup', 'weight', and 'service'. It specifies that 'service' is a required field within the 'server' object.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/reference/json-schema-reference.md#_snippet_8\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"server\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"isBackup\": { \"type\": \"boolean\" },\n        \"weight\": { \"type\": \"integer\" },\n        \"service\": { \"type\": \"string\" }\n      },\n      \"required\": [\"service\"]\n    }\n  }\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Open Source Packages on Alpine Linux\nDESCRIPTION: These commands create a directory, update the package index, and download the NGINX Open Source packages, including all dependencies, using the `apk` package manager. The packages are saved to the `/etc/packages/` directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir /etc/packages/\nsudo apk update\nsudo apk fetch --recursive --output /etc/packages app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Defining Cache Key in Nginx\nDESCRIPTION: This snippet demonstrates how to change the request characteristics used in calculating the cache key. The proxy_cache_key directive is used to create a custom cache key based on the host, request URI, and a cookie value. This allows for more granular cache control based on request attributes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/content-cache/content-caching.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_cache_key \"$host$request_uri$cookie_user\";\n```\n\n----------------------------------------\n\nTITLE: Resetting Connections Statistics via API with DELETE Method (Shell)\nDESCRIPTION: This command resets accepted and dropped client connections using the DELETE method via curl. It targets the `/api/9/connections` endpoint on the specified host and requires the API to be configured in read-write mode.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_20\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X DELETE  -i 'http://192.168.1.23/api/9/connections'\n```\n\n----------------------------------------\n\nTITLE: Kubernetes TLS Secret Creation for Nginx Instance Manager Client\nDESCRIPTION: Creates a Kubernetes TLS secret named `nim-client` in the `nginx-gateway` namespace from a client certificate and key. This secret is used for client authentication when reporting usage to NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/nginx-plus-jwt.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n nginx-gateway create secret tls nim-client --cert /path/to/cert --key /path/to/key\n```\n\n----------------------------------------\n\nTITLE: Executing NGINX Gateway Fabric in Static Mode (Shell)\nDESCRIPTION: This command is used to configure NGINX for a single NGINX Gateway Fabric resource in static mode. It requires the 'gateway' executable to be available in the system's PATH or the full path to the executable must be provided.  The command accepts flags that modify its behavior.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/reference/cli-help.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ngateway static-mode [flags]\n```\n\n----------------------------------------\n\nTITLE: HTTPRoute Traffic Splitting - Complete Switch - YAML\nDESCRIPTION: This YAML snippet configures a complete traffic switch to the new version of an application.  By setting the weight of the old version to 0 and the new version to 1, all traffic is routed to the new deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/upgrade-apps-without-downtime.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\n- matches:\n    - path:\n        type: PathPrefix\n        value: /\n  backendRefs:\n    - name: my-app-old\n      port: 80\n      weight: 0\n    - name: my-app-new\n      port: 80\n      weight: 1\n```\n\n----------------------------------------\n\nTITLE: Testing Nginx Instance via Curl\nDESCRIPTION: This shell command uses curl to access the index.html page served by the Nginx instance at its external IP address. It verifies that the Nginx server is running and accessible. Replace `<external-IP-address-of-NGINX-Plus-server>` with the actual external IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\ncurl http://<external-IP-address-of-NGINX-Plus-server>\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Open Source Packages on Oracle Linux 8.1+\nDESCRIPTION: These commands create a directory, navigate into it, and download NGINX Open Source packages, including dependencies using `repotrack`. Repotrack is used to download packages and their dependencies from a yum repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_20\n\nLANGUAGE: script\nCODE:\n```\nsudo mkdir /etc/packages/\ncd /etc/packages/\nsudo repotrack --forcearch x86_64 app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Markdown Formatting: Custom Callout\nDESCRIPTION: This example demonstrates how to create a custom callout using the `call-out` shortcode in Hugo. It includes parameters for type, position, header, and a Font Awesome icon, allowing for flexible and visually distinct callouts.\nSOURCE: https://github.com/nginx/documentation/blob/main/CONTRIBUTING_DOCS.md#_snippet_5\n\nLANGUAGE: Markdown\nCODE:\n```\n{{<call-out \"important side-callout\" \"JWT file required for upgrade\" \"fa fa-exclamation-triangle\">}}\n```\n\n----------------------------------------\n\nTITLE: Configuring X-Frame-Options with 'only-same' in NGINX App Protect WAF (JSON)\nDESCRIPTION: This JSON configuration enables clickjacking protection for the URL `/clickme` and sets the `X-Frame-Options` header to `only-same`.  This allows the content to be displayed in a frame only if it originates from the same website. It requires NGINX App Protect WAF and the POLICY_TEMPLATE_NGINX_BASE template.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/clickjacking-protection.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"name\": \"x_frame_options\",\n    \"template\": {\n        \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"applicationLanguage\": \"utf-8\",\n    \"enforcementMode\": \"blocking\",\n    \"urls\": [\n        {\n            \"name\": \"/clickme\",\n            \"type\": \"explicit\",\n            \"method\": \"*\",\n            \"isAllowed\": true,\n            \"clickjackingProtection\": true,\n            \"allowRenderingInFrames\": \"only-same\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Service Mesh with Sampler Ratio\nDESCRIPTION: This command deploys NGINX Service Mesh and sets the sampler ratio for tracing. The `--telemetry-sampler-ratio` flag sets the probability of sampling a span, with a value between `0` and `1`. A value of `0.1` sets a 10% probability that the span is sampled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/monitoring-and-tracing.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --telemetry-sampler-ratio 0.1\n```\n\n----------------------------------------\n\nTITLE: Nginx ConfigMap Configuration for Nginx Instance Manager endpoint\nDESCRIPTION: Adds a configuration line to the `mgmt` block of the `nginx-includes-bootstrap` ConfigMap to specify the Nginx Instance Manager endpoint used for usage reporting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/nginx-plus-jwt.md#_snippet_7\n\nLANGUAGE: text\nCODE:\n```\nusage_report endpoint=<your-endpoint>;\n```\n\n----------------------------------------\n\nTITLE: Example parametersRef for GatewayClass\nDESCRIPTION: This YAML snippet shows how to add a `parametersRef` to the GatewayClass spec to attach the NginxProxy resource.  It specifies the group, kind, and name of the NginxProxy, enabling the GatewayClass to utilize its configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/data-plane-configuration.md#_snippet_6\n\nLANGUAGE: yaml\nCODE:\n```\nparametersRef:\n    group: gateway.nginx.org\n    kind: NginxProxy\n    name: ngf-proxy-config\n```\n\n----------------------------------------\n\nTITLE: Applying SecurityContextConstraint (SCC) in OpenShift (Bash)\nDESCRIPTION: Applies the `nginx-ingress-permissions` SecurityContextConstraint (SCC) to allow NGINX Ingress Controller to run in an OpenShift environment. This step is required to grant the necessary permissions for the Ingress Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f nic-scc.yaml\n```\n\n----------------------------------------\n\nTITLE: Extracting Download Link ID using jq\nDESCRIPTION: Extracts the download link ID from the JSON response using `jq`. It splits the `downloadLink` string by `/` and retrieves the last element storing it in the `$download_link` variable.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\ndownload_link=$(jq -r '.downloadLink | split(\"/\") | last' <<< \"$status_response\")\n```\n\n----------------------------------------\n\nTITLE: Update and install module (RHEL, Amazon Linux 2, CentOS, Oracle Linux)\nDESCRIPTION: Updates the package index and installs a specified NGINX module using yum.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_26\n\nLANGUAGE: Shell\nCODE:\n```\nyum update\nyum install <MODULE-NAME>\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Plus Package - SLES\nDESCRIPTION: Installs the NGINX Plus package using the RPM package manager on SLES. The <rpm_package_name> placeholder should be replaced with the actual name of the RPM package file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_50\n\nLANGUAGE: shell\nCODE:\n```\nrpm -ivh <rpm_package_name>\n```\n\n----------------------------------------\n\nTITLE: Configure SSH access to peers - Permit Root Login\nDESCRIPTION: This configuration snippet adds the line PermitRootLogin without-password to the /etc/ssh/sshd_config file, which allows root login without a password using SSH keys.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_8\n\nLANGUAGE: none\nCODE:\n```\nPermitRootLogin without-password\n```\n\n----------------------------------------\n\nTITLE: Upload Usage Acknowledgement to NIM via REST API (curl)\nDESCRIPTION: This curl command uploads the usage acknowledgement to NGINX Instance Manager using the NIM REST API. It sends a POST request to the `/api/platform/v1/report/upload` endpoint with the acknowledgement file attached and the authorization header. The `-k` flag disables SSL certificate validation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/report-usage-disconnected-deployment.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\ncurl -k --location 'https://<NIM-FQDN>/api/platform/v1/report/upload' \\\n--header 'Authorization: Basic <base64-encoded-credentials>' \\\n--form 'file=@\"<path-to-acknowledgement>.zip\"'\n```\n\n----------------------------------------\n\nTITLE: Checking for auth_request module\nDESCRIPTION: This command checks if the NGINX Open Source installation includes the `http_auth_request_module`.  It executes `nginx -V 2>&1` to get the configuration options and then uses `grep` to search for the string `--with-http_auth_request_module`.  This step is necessary for NGINX Open Source but not for NGINX Plus, which includes the module by default.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-subrequest-authentication.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nnginx -V 2>&1 | grep -- 'http_auth_request_module'\n```\n\n----------------------------------------\n\nTITLE: Create Infrastructure Workspace (ACM) - JSON\nDESCRIPTION: The JSON payload for creating an Infrastructure Workspace in API Connectivity Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_13\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"name\": \"infra-ws\"\n}\n```\n\n----------------------------------------\n\nTITLE: Install SPNEGO Auth Module (Amazon Linux 2023, AlmaLinux, Rocky Linux)\nDESCRIPTION: Installs the `nginx-plus-module-auth-spnego` package using dnf on Amazon Linux 2023, AlmaLinux, and Rocky Linux operating systems.  The script updates the package manager's cache and then installs the specified module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/spnego.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-auth-spnego\n```\n\n----------------------------------------\n\nTITLE: Delete Kubernetes Manifests\nDESCRIPTION: This shell command deletes Kubernetes resources defined in a specified directory or file. It is used to remove deployments, services, and other Kubernetes objects from the cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nkubectl delete -f /home/user/k8s\n```\n\n----------------------------------------\n\nTITLE: Updating NGINX Amplify Agent on Ubuntu/Debian\nDESCRIPTION: This snippet updates the NGINX Amplify Agent on Ubuntu or Debian systems. It first updates the package list using `apt-get update` and then installs the latest version of the agent using `apt-get install nginx-amplify-agent`. This ensures the system has the most recent version of the Amplify Agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/updating-amplify-agent.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\napt-get update && \\\napt-get install nginx-amplify-agent\n```\n\n----------------------------------------\n\nTITLE: Load Headers-More Module in Nginx Configuration\nDESCRIPTION: This Nginx configuration snippet shows how to dynamically load the Headers-More module using the `load_module` directive.  It loads the module from the specified path, enabling it for use within the Nginx configuration. The path `modules/ngx_http_headers_more_filter_module.so` is relative to the Nginx installation directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/headers-more.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_headers_more_filter_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Serving Excessive Requests Immediately (Nodelay)\nDESCRIPTION: This example shows how to serve excessive requests within the burst limit immediately without delay, regardless of the configured rate. Requests exceeding the burst limit are still rejected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n\n    limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;\n\n    server {\n        #...\n\n        location /search/ {\n            limit_req zone=one burst=5 nodelay;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Numeric Select Field JSON Schema Example\nDESCRIPTION: This JSON schema defines a numeric select field named 'proxyTimeout' for predefined numerical values. It enables users to choose a value from the specified options (10, 20, 30, 40, 50).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/reference/json-schema-reference.md#_snippet_6\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"proxyTimeout\": {\n      \"type\": \"number\",\n      \"enum\": [10, 20, 30, 40, 50]\n    }\n  }\n```\n\n----------------------------------------\n\nTITLE: Using the gateway sleep command\nDESCRIPTION: This command pauses execution for a specified duration and then exits. It is used to introduce delays in scripts or automation workflows. The `duration` flag controls how long the command sleeps for, using Go's `time.ParseDuration` format.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/reference/cli-help.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\n  gateway sleep [flags]\n```\n\n----------------------------------------\n\nTITLE: Serving Static Files and Proxying Requests Based on Location\nDESCRIPTION: This snippet combines serving static files from the /images/ location with proxying all other requests to a backend server. It showcases how to configure different locations to handle different types of requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    location /images/ {\n        root /data;\n    }\n\n    location / {\n        proxy_pass http://www.example.com;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure SSH access to peers - Append Public Key to authorized_keys\nDESCRIPTION: This command appends the public key from the primary node to the authorized_keys file on each peer node. The from=\"192.168.1.2\" prefix restricts access to only the IP address of the primary node.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir /root/.ssh\nsudo echo 'from=\"192.168.1.2\" ssh-rsa AAAAB3Nz4rFgt...vgaD root@node1' >> /root/.ssh/authorized_keys\n```\n\n----------------------------------------\n\nTITLE: Disabling Debug Logging for Virtual Host\nDESCRIPTION: These Nginx configuration directives demonstrate how to disable debug logging for a specific virtual host, while still maintaining global debug logging. It overrides global debug settings within the specific server block, reverting to default logging.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_14\n\nLANGUAGE: nginx\nCODE:\n```\nerror_log /path/to/log debug;\n...\nhttp {\n    ...\n    server {\n    error_log /path/to/log;\n    ...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Running the App Protect Policy Converter\nDESCRIPTION: This snippet demonstrates how to run the NGINX App Protect WAF policy converter tool. This tool is used to convert XML policies from BIG-IP systems to JSON format compatible with NGINX App Protect WAF. It is located in the /opt/app_protect/bin directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_22\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/convert-policy\n```\n\n----------------------------------------\n\nTITLE: Destroy Terraform Deployment\nDESCRIPTION: This command destroys all resources managed by the Terraform configuration. The `--auto-approve` flag bypasses the interactive approval prompt, automatically destroying the resources.  Use with caution as this will permanently delete provisioned resources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-terraform.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nterraform destroy --auto-approve\n```\n\n----------------------------------------\n\nTITLE: Mount NFS Share (Bash)\nDESCRIPTION: This command mounts the NFS share specified by `<nfs_host>:<path_on_host>` to the mount point `/mnt/local_pgdata`. This allows access to the backup files stored on the NFS share. `sudo` is used to ensure proper permissions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-embedded-config-db.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo mount <nfs_host>:<path_on_host> /mnt/local_pgdata\n```\n\n----------------------------------------\n\nTITLE: Cloning nginx-openid-connect repository\nDESCRIPTION: This command clones the nginx-openid-connect GitHub repository, which contains necessary files for configuring NGINX Plus with OpenID Connect. This is the first step in setting up NGINX Plus as an OpenID Connect relying party.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/keycloak.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ngit clone https://github.com/nginxinc/nginx-openid-connect\n```\n\n----------------------------------------\n\nTITLE: CSS Stylesheet for NGINXaaS Cost Calculator\nDESCRIPTION: This CSS stylesheet provides the visual styling for the cost calculator. It defines the layout, colors, fonts, and other visual aspects of the calculator elements to ensure a user-friendly interface. It is included using a link tag in the HTML structure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/billing/usage-and-cost-estimator.md#_snippet_2\n\nLANGUAGE: CSS\nCODE:\n```\n<link rel=\"stylesheet\" href=\"/nginxaas-azure/css/cost-calculator_v2.css\">\n```\n\n----------------------------------------\n\nTITLE: Kubernetes apply error\nDESCRIPTION: Error message displayed when starting NGINX Controller. It indicates an unknown flag `--server-dry-run` used with `kubectl apply`. This message can be safely ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.6.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nError: unknown flag: --server-dry-run\nSee 'kubectl apply --help' for usage.\nDetected an invalid patch for the analytics database. Resolving conflicts and restarting the analytics database before running the update.\nstatefulset.apps/clickhouse patched\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Agent (systemctl)\nDESCRIPTION: This command restarts the NGINX Agent service using systemctl, which is commonly used to resolve connectivity issues between the Agent and the Instance Manager. It ensures that the Agent picks up any changes in the environment, such as a new Instance Manager IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/troubleshooting.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Add Nginx stable repository to apt sources\nDESCRIPTION: This command adds the Nginx stable repository to the apt sources list, allowing apt to install Nginx packages from the official Nginx repository. It uses lsb_release to determine the Debian codename. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\necho \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\n    http://nginx.org/packages/debian `lsb_release -cs` nginx\" \\\n        | sudo tee /etc/apt/sources.list.d/nginx.list\n```\n\n----------------------------------------\n\nTITLE: Create SSL Directory for NGINX (Shell)\nDESCRIPTION: Creates the `/etc/ssl/nginx/` directory using `mkdir` with the `-p` flag to create parent directories if they don't exist. Requires `sudo` privileges. No specific input or output other than directory creation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-amazon.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/ssl/nginx\n```\n\n----------------------------------------\n\nTITLE: Filtering Nginx Metrics\nDESCRIPTION: This code snippet demonstrates how to filter Nginx metrics using the `filter` parameter in the API. It retrieves data for the application named `app1` for the last 12 hours by specifying the `nginx_id` dimension.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/metrics?names=nginx.http.request.count&filter=nginx_id='nginx_id1'&startTime=now-12h\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: NGINX Controller Version Displayed (Bash)\nDESCRIPTION: This snippet shows the expected output when querying the version using the `helper.sh` script. It displays both the installed and running version of the NGINX Controller. The specific versions displayed (e.g., 3.14.0) will vary depending on the installed version of the NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/about/get-controller-version.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nInstalled version: 3.14.0\nRunning version: 3.14.0\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Plus Certificates (GZIP)\nDESCRIPTION: Downloads the NGINX Plus certificate and key bundle as a GZIP file using the NGINX Controller REST API. Requires a valid session cookie and saves the output to `nginx-plus-certs.gz`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller-app-sec.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\ncurl -b cookie.txt -c cookie.txt -X GET --url 'https://192.0.2.0/api/v1/platform/licenses/nginx-plus-licenses/controller-provided' --output nginx-plus-certs.gz\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Instance Manager on RPM-based systems\nDESCRIPTION: This command upgrades NGINX Instance Manager to the latest version using the yum package manager on CentOS, RHEL, and other RPM-based systems. The `--allowerasing` option allows yum to remove packages to resolve dependencies during the upgrade.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum update -y nms-instance-manager --allowerasing\n```\n\n----------------------------------------\n\nTITLE: Disable Site Files in Nikto Configuration\nDESCRIPTION: Demonstrates how to modify the Nikto configuration file to disable requests for specific site files. This reduces false positives when using Nikto to scan an application behind the WAF.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\n# Default plug-in macros\n# Remove plug-ins designed to be run standalone\n@@EXTRAS=dictionary;siebel;embedded\n@@DEFAULT=@@ALL;-@@EXTRAS;tests(report:500);-sitefiles\n```\n\n----------------------------------------\n\nTITLE: Applying NMS Auth Secrets (kubectl apply)\nDESCRIPTION: This command applies the `nms-auth.json` secret file to the `nms` namespace in Kubernetes. It restores user passwords during a data-only restoration. Requires `kubectl` and proper Kubernetes configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n nms apply -f nms-auth.json\n```\n\n----------------------------------------\n\nTITLE: Restarting Nginx Agent after Removal (Shell)\nDESCRIPTION: This command is used to restart the Nginx agent after removing or commenting out the instance_group line. This ensures that changes are applied to the agent configuration and is required to be executed after making changes to the file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/config-sync-groups/manage-config-sync-groups.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Markdown Formatting: Caution Shortcode\nDESCRIPTION: This snippet demonstrates the use of the Hugo `caution` shortcode for creating a caution callout. The example showcases a multi-line block of text within the shortcode, which will be displayed as a warning or caution to the user.\nSOURCE: https://github.com/nginx/documentation/blob/main/CONTRIBUTING_DOCS.md#_snippet_4\n\nLANGUAGE: Markdown\nCODE:\n```\n{{< caution >}}\nYou should probably never do this specific thing in a production environment.\n\nIf you do, and things break, don't say we didn't warn you.\n{{< /caution >}}\n```\n\n----------------------------------------\n\nTITLE: Apply Kubernetes configuration\nDESCRIPTION: Applies a Kubernetes configuration file using kubectl.  This command attempts to create or update resources defined in the specified YAML file in the Kubernetes cluster. Errors will be reported if the configuration is invalid or if there are conflicts with existing resources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/resource-validation.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f nginx-gateway-config.yaml\n```\n\n----------------------------------------\n\nTITLE: Apply Kubernetes configuration\nDESCRIPTION: Applies a Kubernetes configuration file using kubectl.  This command attempts to create or update resources defined in the specified YAML file in the Kubernetes cluster. Errors will be reported if the configuration is invalid or if there are conflicts with existing resources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/resource-validation.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f some-gateway.yaml\n```\n\n----------------------------------------\n\nTITLE: Loading Dynamic Module in NGINX Configuration\nDESCRIPTION: This directive, placed in the `main` (top-level) context of `/etc/nginx/nginx.conf`, loads a dynamically loadable module into NGINX. Replace `<MODULE-NAME>` with the actual filename of the `.so` file (without the `.so` extension).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_39\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/<MODULE-NAME>.so;\n```\n\n----------------------------------------\n\nTITLE: NGINX Plus Configuration Restore Failure Error Message (bash)\nDESCRIPTION: This is an example of an error message observed when restoring an NGINX Plus configuration fails. The error indicates a missing `nginx.conf.bak` file, but the message is inaccurate and can be ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_19\n\nLANGUAGE: bash\nCODE:\n```\nFailed to deploy to instance (<instance name>). Could not restore: nginx.conf.bak rename /etc/nginx/nginx.conf.bak /etc/nginx/nginx.conf: no such file or directory.\n```\n\n----------------------------------------\n\nTITLE: Install Make (Bash)\nDESCRIPTION: This command installs the `make` utility using the `apt` package manager on Ubuntu. `make` is a build automation tool used to compile and link the NGINX Agent source code. It is a prerequisite for building the agent from source.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/contribute/dev-environment-setup.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt install make\n```\n\n----------------------------------------\n\nTITLE: Send a request to the tea application via curl\nDESCRIPTION: This snippet sends an HTTP GET request to the tea application using curl. It uses the `--resolve` option to map the domain name to the gateway's IP address and port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/tea\n```\n\n----------------------------------------\n\nTITLE: Specifying Password File for HTTP Basic Authentication in Nginx\nDESCRIPTION: This snippet expands on the previous configuration, adding the `auth_basic_user_file` directive to specify the location of the password file. This file contains the username and password pairs that Nginx uses to authenticate users.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-http-basic-authentication.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /api {\n    auth_basic           \"Administrator’s Area\";\n    auth_basic_user_file /etc/apache2/.htpasswd;\n}\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Service Configuration\nDESCRIPTION: This YAML configuration defines a Kubernetes Service of type NodePort to expose the Nginx deployment.  It maps port 80 on the Node to port 80 within the Pod. This allows external access to the Nginx service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_23\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx\nspec:\n  selector:\n    app: nap5\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 80\n  type: NodePort\n```\n\n----------------------------------------\n\nTITLE: Create an NGINXaaS data plane API key using Azure CLI\nDESCRIPTION: This snippet creates a new data plane API key for the NGINXaaS deployment using the Azure CLI. It specifies the key name, secret text (the generated UUID), the deployment name, and the resource group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/loadbalancer-kubernetes.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment api-key create --name $keyName --secret-text $keyValue --deployment-name $nginxName --resource-group  $nginxGroup\n```\n\n----------------------------------------\n\nTITLE: Deploy Allowed Driver\nDESCRIPTION: This command deploys a driver workload configured to send requests to the destination service. The driver is considered 'allowed' as it will initially have unrestricted access to the destination.  A Kubernetes manifest (driver-allowed.yaml) defines the driver deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f driver-allowed.yaml\n```\n\n----------------------------------------\n\nTITLE: Send a request to the coffee application via curl\nDESCRIPTION: This snippet sends an HTTP GET request to the coffee application using curl. It uses the `--resolve` option to map the domain name to the gateway's IP address and port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee\n```\n\n----------------------------------------\n\nTITLE: Restricting API Access with Allow/Deny Nginx\nDESCRIPTION: This snippet restricts access to the API location using the `allow` and `deny` directives. It allows access from the 192.168.1.0/24 network and denies all other access.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    server {\n        listen 192.168.1.23;\n        # ...\n        location /api {\n            api write=on;\n            allow 192.168.1.0/24;\n            deny  all;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Agent (RPM-based)\nDESCRIPTION: This snippet shows how to upgrade NGINX Agent on CentOS, RHEL, and other RPM-based systems using yum. It first updates the yum cache and then upgrades the nginx-agent package. The -y flag automatically answers yes to any prompts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/upgrade.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum -y makecache\nsudo yum update -y nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Add TLS Listener Configuration - JSON\nDESCRIPTION: This JSON configuration defines a listener for secure communication using TLS. It specifies the transport protocol, port number, TLS enablement, and IPv6 setting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/tls-policies.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"transportProtocol\": \"HTTP\",\n    \"port\": 443,\n    \"tlsEnabled\": true,\n    \"ipv6\": false\n}\n```\n\n----------------------------------------\n\nTITLE: Modifying NGINX Agent Configuration (Text)\nDESCRIPTION: This snippet shows how to modify the `agent-dynamic.conf` file to change the instance group an NGINX Agent belongs to.  The `<new_config_sync_group>` placeholder should be replaced with the name of the desired group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/config-sync-groups/manage-config-sync-groups.md#_snippet_3\n\nLANGUAGE: text\nCODE:\n```\ninstance_group: <new_config_sync_group>\n```\n\n----------------------------------------\n\nTITLE: Delete Nginx Service Mesh CRDs using Kubectl\nDESCRIPTION: This command deletes the Custom Resource Definitions (CRDs) associated with NGINX Service Mesh. This is necessary during a manual upgrade process to ensure that old CRDs do not conflict with new ones.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade-with-helm.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete crd -l app.kubernetes.io/part-of==nginx-service-mesh\n```\n\n----------------------------------------\n\nTITLE: NGINX Service Mesh CLI Deploy Examples\nDESCRIPTION: Provides example usages of the `nginx-meshctl deploy` command with various options for customizing the NGINX Service Mesh deployment, such as specifying the registry server, namespace, mTLS mode, telemetry exporters and upstream certificates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_4\n\nLANGUAGE: txt\nCODE:\n```\nnginx-meshctl deploy --registry-server \"registry:5000\"\n```\n\nLANGUAGE: txt\nCODE:\n```\nnginx-meshctl deploy ... --namespace my-namespace\n```\n\nLANGUAGE: txt\nCODE:\n```\nnginx-meshctl deploy ... --mtls-mode off\n```\n\nLANGUAGE: txt\nCODE:\n```\nnginx-meshctl deploy ... --telemetry-exporters \"type=otlp,host=otel-collector.my-namespace.svc.cluster.local,port=4317\"\n```\n\nLANGUAGE: txt\nCODE:\n```\nnginx-meshctl deploy ... --mtls-upstream-ca-conf=\"disk.yaml\"\n```\n\n----------------------------------------\n\nTITLE: NGINX Server Configuration for API Base Path (Alternative)\nDESCRIPTION: This snippet shows an alternative configuration where the API base path starts from the root. This configuration is relevant when using an API doc with a proxy.  The `Servers` directive specifies the URL for the API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nServers:\n- url: /api/v3\n```\n\n----------------------------------------\n\nTITLE: Setting Access Control Mode in NGINX Service Mesh\nDESCRIPTION: This command sets the access control mode to 'deny' during NGINX Service Mesh deployment.  This configures a closed global policy where traffic is only allowed between services with defined access control policies. Requires `nginx-meshctl` to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/configuration.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --access-control-mode deny\n```\n\n----------------------------------------\n\nTITLE: Backup NGINX Controller Agent Configuration\nDESCRIPTION: This command backs up the Controller Agent `agent.conf` file by copying it from its current location to a temporary location. This file is crucial for restoring the agent's configuration after an update or if the agent needs to be reinstalled. It requires the `cp` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\ncp /etc/controller-agent/agent.conf <temporary location>\n```\n\n----------------------------------------\n\nTITLE: Redirecting 404 Errors with 301 in Nginx\nDESCRIPTION: This snippet configures NGINX to redirect a 404 error to a new URL using a 301 Moved Permanently redirect. This is useful when a page has moved permanently and you want to update clients' bookmarks.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_17\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /old/path.html {\n    error_page 404 =301 http:/example.com/new/path.html;\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Open Source (RHEL 7.4+)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Open Source package from RHEL 7.4 and later. It uses the `yum remove` command to remove the `app-protect-module-oss` package. Requires root privileges and the yum package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_60\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum remove app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Verify installed packages (CentOS 7)\nDESCRIPTION: This snippet provides a command to verify the installed versions of NGINX and metrics-related packages on CentOS 7. It uses `yum list installed` piped to `egrep` to filter the output for packages containing 'nginx' or 'metrics'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_33\n\nLANGUAGE: bash\nCODE:\n```\nyum list installed | egrep 'nginx|metrics'\n```\n\n----------------------------------------\n\nTITLE: Retrieving Nginx Ingress Controller Logs\nDESCRIPTION: This command retrieves logs from the specified NGINX Ingress Controller pod within the `nginx-ingress` namespace. It replaces `<pod_name>` with the actual name of the pod. It's used to verify that the PROXY protocol is enabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_11\n\nLANGUAGE: Shell\nCODE:\n```\nkubectl logs <pod_name> -n nginx-ingress\n```\n\n----------------------------------------\n\nTITLE: Detailed Traffic Metrics using nginx-meshctl\nDESCRIPTION: Shows additional golden metrics and edge information for a specified resource. Uses the `nginx-meshctl top` command with a specific deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/smi-traffic-metrics.md#_snippet_1\n\nLANGUAGE: txt\nCODE:\n```\n$ nginx-meshctl top deployments/productpage-v1\n\nDeployment      Direction  Resource            Success Rate  P99    P90   P50   NumRequests\nproductpage-v1\n                To         reviews-v2          100.00%       91ms   22ms  15ms  54\n                To         details-v1          100.00%       15ms   4ms   2ms   160\n                To         reviews-v1          100.00%       91ms   16ms  5ms   54\n                To         reviews-v3          100.00%       183ms  20ms  14ms  52\n                From       nginx-plus-ingress  100.00%       183ms  47ms  31ms  161\n```\n\n----------------------------------------\n\nTITLE: Stop NMS Service (bash)\nDESCRIPTION: This command stops the `nms` (NGINX Management Suite) service. This is a necessary step before rotating encryption keys and requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/manage-certificates.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl stop nms\n```\n\n----------------------------------------\n\nTITLE: Install API Connectivity Manager on Debian/Ubuntu\nDESCRIPTION: These commands install the latest version of API Connectivity Manager on Debian or Ubuntu systems. The first command updates the package lists, and the second command installs the nms-api-connectivity-manager package. The apt-get command assumes the availability of the appropriate repositories.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get update\nsudo apt-get install nms-api-connectivity-manager\n```\n\n----------------------------------------\n\nTITLE: Include Total Count of Events (curl)\nDESCRIPTION: This example retrieves the total number of events by using the `includeTotal` query parameter. The total count is returned in the response's metadata. Replace `<NMS_FQDN>` and `<access token>` accordingly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"https://<NMS_FQDN>/api/platform/v1/analytics/events?includeTotal=true\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Configure Nginx for API access (Nginx)\nDESCRIPTION: This snippet configures a `location /api` block in the Nginx configuration to allow access to the API from localhost only. It enables the `api write=on` directive, allowing write access via the API, and restricts access to only 127.0.0.1.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/set-up-app-protect-instances.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n   location /api {\n      api write=on;\n      allow 127.0.0.1;\n      deny all;\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Describe HTTPRoute Resource Status\nDESCRIPTION: This command uses `kubectl describe` to show the status of an HTTPRoute resource named `coffee` in the `nginx-gateway` namespace. This allows you to identify configuration errors, such as missing backend services, by examining the conditions in the status section.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe httproutes.gateway.networking.k8s.io coffee -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Restarting NGINX Agent on CentOS/RHEL\nDESCRIPTION: This snippet shows how to restart the NGINX Agent on CentOS and RHEL systems using systemctl. This completes the upgrade process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/admin-guide/upgrade-nap-waf.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Installing Prometheus Module on FreeBSD\nDESCRIPTION: This command installs the nginx-plus-module-prometheus package using the pkg package manager, specific to FreeBSD systems. It installs the module and requires root privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg install nginx-plus-module-prometheus\n```\n\n----------------------------------------\n\nTITLE: Create NGINX Controller Support Package\nDESCRIPTION: This command creates a support package for NGINX Controller which contains logs and configuration data that can be used to diagnose issues. The `-o`, `-s`, and `-t` flags allow customizing the output file name, skipping the database dump, and specifying the timeseries data duration, respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh supportpkg [-o|--output <file name>] [-s|--skip-db-dump] [-t|--timeseries-dump <hours>]\n```\n\n----------------------------------------\n\nTITLE: Install XSLT Module on Amazon Linux 2, CentOS, Oracle Linux, RHEL\nDESCRIPTION: This shell command updates the package manager and installs the `nginx-plus-module-xslt` package on Amazon Linux 2, CentOS, Oracle Linux, and RHEL systems. It uses `yum` as the package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/xslt.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-xslt\n```\n\n----------------------------------------\n\nTITLE: Streaming Bursty Client Logs using Kubectl\nDESCRIPTION: This command streams the logs from the client container of the bursty-client deployment. It's used to monitor the requests sent by the client and verify the effect of different rate limiting configurations on the request flow and response codes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_19\n\nLANGUAGE: bash\nCODE:\n```\nkubectl logs -l app=bursty-client -f -c client\n```\n\n----------------------------------------\n\nTITLE: Query TCP Connect Time with Prometheus\nDESCRIPTION: This Prometheus query retrieves the connection time for TCP connections to upstream servers. The query uses the `nginxplus_stream_upstream_server_connect_time` metric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_5\n\nLANGUAGE: promQL\nCODE:\n```\nnginxplus_stream_upstream_server_connect_time\n```\n\n----------------------------------------\n\nTITLE: Create ModSecurity Configuration Directory\nDESCRIPTION: This command creates a directory to store the Nginx ModSecurity WAF configuration files.  This directory will contain the main configuration file and any included rule sets.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_12\n\nLANGUAGE: none\nCODE:\n```\nsudo mkdir /etc/nginx/modsec\n```\n\n----------------------------------------\n\nTITLE: Show Chef Node Definition (JSON)\nDESCRIPTION: This command retrieves the node definition for the specified node from the Chef server and formats it as JSON.  The output is then redirected to a file for editing.  This file serves as a template for modifying the node's configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nroot@chef-server:~/chef-zero/playground# knife node show chef-test-1 --format json > nodes/chef-test-1.json\n```\n\n----------------------------------------\n\nTITLE: Configuring Numeric Parameter with MultipleOf Validation in NGINX App Protect\nDESCRIPTION: This JSON snippet configures a numeric parameter named \"multiples\" that accepts integer values between 0 and 10, which must be multiples of 3. It utilizes the checkMultipleOfValue and multipleOf properties for validation, triggering VIOL_PARAMETER_NUMERIC_VALUE if the condition isn't met.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/do-nothing-and-user-defined-parameters.md#_snippet_3\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"user_defined_parameters_data_types\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_PARAMETER_NUMERIC_VALUE\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_VALUE_LENGTH\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_STATIC_VALUE\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_DATA_TYPE\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"parameters\": [\n            {\n                \"name\": \"multiples\",\n                \"type\": \"explicit\",\n                \"parameterLocation\": \"any\",\n                \"mandatory\": false,\n                \"allowEmptyValue\": false,\n                \"allowRepeatedParameterName\": false,\n                \"sensitiveParameter\": false,\n                \"valueType\": \"user-input\",\n                \"dataType\": \"integer\",\n                \"checkMinValue\": true,\n                \"checkMaxValue\": true,\n                \"minimumValue\": 0,\n                \"maximumValue\": 10,\n                \"checkMultipleOfValue\": true,\n                \"multipleOf\": 3\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Move and Rename Cert and Key Files\nDESCRIPTION: These commands move and rename the certificate and key files downloaded from MyF5 or a trial activation email to the correct directory and filenames expected by the NGINX Instance Manager installation script. The files are renamed to `nginx-repo.crt` and `nginx-repo.key` and placed in `/etc/ssl/nginx/`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo mv nginx-<subscription id>.crt /etc/ssl/nginx/nginx-repo.crt\nsudo mv nginx-<subscription id>.key /etc/ssl/nginx/nginx-repo.key\n```\n\n----------------------------------------\n\nTITLE: Create Log Format for Security Monitoring (JSON)\nDESCRIPTION: This snippet defines a custom log format for the Security Monitoring module in Nginx App Protect WAF.  It specifies the fields to be logged, escaping characters, maximum request size, and message size. The log format is stored in `/etc/app_protect/conf/log_sm.json`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/set-up-app-protect-instances.md#_snippet_5\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filter\": {\n        \"request_type\": \"illegal\"\n    },\n    \"content\": {\n        \"format\": \"user-defined\",\n        \"format_string\": \"%blocking_exception_reason%,%dest_port%,%ip_client%,%is_truncated_bool%,%method%,%policy_name%,%protocol%,%request_status%,%response_code%,%severity%,%sig_cves%,%sig_set_names%,%src_port%,%sub_violations%,%support_id%,%threat_campaign_names%,%violation_rating%,%vs_name%,%x_forwarded_for_header_value%,%outcome%,%outcome_reason%,%violations%,%violation_details%,%bot_signature_name%,%bot_category%,%bot_anomalies%,%enforced_bot_anomalies%,%client_class%,%client_application%,%client_application_version%,%transport_protocol%,%uri%,%request%\",\n        \"escaping_characters\": [\n            {\n                \"from\": \",\",\n                \"to\": \"%2C\"\n            }\n        ],\n        \"max_request_size\": \"2048\",\n        \"max_message_size\": \"5k\",\n        \"list_delimiter\": \"::\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Instance Manager (RPM) - Bash\nDESCRIPTION: Installs the NGINX Instance Manager package on RHEL and RPM-based systems using the `rpm` command. The `--nosignature` flag disables signature verification.  The <user> and <version> placeholders need to be replaced with the actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide-deprecated.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo rpm -ivh --nosignature /home/<user>/nms-instance-manager_<version>.x86_64.rpm\n```\n\n----------------------------------------\n\nTITLE: Disabling a Signature Set by Setting Alarm and Block to False - JSON\nDESCRIPTION: This snippet demonstrates disabling a signature set (XPath Injection Signatures) by setting both its `block` and `alarm` properties to `false`. This overrides the settings inherited from the base template, effectively preventing the signature set from being enforced or triggering alarms.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/signature-sets.md#_snippet_6\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"no_xpath_policy\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"signature-sets\": [\n            {\n                 \"name\": \"XPath Injection Signatures\",\n                 \"block\": false,\n                 \"alarm\": false\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Access Logging with Syslog in Nginx\nDESCRIPTION: This snippet configures Nginx to send access logs to a syslog server, specifying the server address, facility, tag, and severity level. It uses the `access_log` directive with the `syslog` parameter and the predefined `combined` format. This is meant to be put inside the `http` block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_34\n\nLANGUAGE: nginx\nCODE:\n```\naccess_log syslog:server=192.168.1.1,facility=local7,tag=oracle,severity=info\n           combined;\n```\n\n----------------------------------------\n\nTITLE: Uninstall Controller Agent - Ubuntu/Debian\nDESCRIPTION: This snippet uninstalls the NGINX Controller Agent package on Ubuntu/Debian systems using apt-get. It removes the nginx-controller-agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-agent.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\napt-get purge nginx-controller-agent\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Modules on Alpine\nDESCRIPTION: This command installs the specified NGINX modules (image-filter and njs) using the apk package manager.  The `@nginx` tag ensures that the modules are installed for the correct NGINX version. This command is used when installing dynamic modules.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_44\n\nLANGUAGE: shell\nCODE:\n```\nsudo apk add nginx-module-image-filter@nginx nginx-module-njs@nginx\n```\n\n----------------------------------------\n\nTITLE: Installing Passenger module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This code snippet demonstrates how to install the `nginx-plus-module-passenger` package on Amazon Linux 2023, AlmaLinux, and Rocky Linux systems using the dnf package manager. It updates the package list and installs the passenger module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/passenger-open-source.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-passenger\n```\n\n----------------------------------------\n\nTITLE: Downloading Enhanced NGINX Configuration Files\nDESCRIPTION: These commands download pre-configured NGINX configuration files for either basic or enhanced Exchange load balancing from the NGINX website. The files are saved to the /etc/nginx/conf.d directory. `curl` is the required dependency.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_18\n\nLANGUAGE: none\nCODE:\n```\nroot# cd /etc/nginx/conf.d\nroot# curl https://www.nginx.com/resource/conf/exchange-enhanced.conf > exchange-enhanced.conf\n```\n\n----------------------------------------\n\nTITLE: Enabling Big-IP Integration with helper.sh - Bash\nDESCRIPTION: This code snippet demonstrates how to enable the Big-IP integration functionality in NGINX Controller Application Delivery Module by setting the `enable-bigip` flag to `true` using the `helper.sh` script. This requires access to the `helper.sh` script and assumes a bash environment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.4.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nhelper.sh setfeature enable-bigip true\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Plus repo file (RHEL 9)\nDESCRIPTION: Downloads the NGINX Plus repository file to /etc/yum.repos.d. This step is essential for configuring the system to retrieve NGINX Plus packages from the official NGINX repository for RHEL 9. The command uses wget to download the repository file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/plus-9.repo\n```\n\n----------------------------------------\n\nTITLE: Get Private Endpoint IP Address - Azure CLI\nDESCRIPTION: Retrieves the IP address of a private endpoint by first obtaining the network interface ID and then querying for the private IP address associated with the IP configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/private-link-to-upstreams.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\n$ export nic_id=$(az network private-endpoint show \\\n    --resource-group $DEP_RESOURCE_GROUP \\\n    --name private-endpoint \\\n    --query \"networkInterfaces[0].id\" \\\n    --output tsv)\n\n$ az network nic show \\\n    --ids $nic_id \\\n    --query \"ipConfigurations[0].privateIPAddress\" \\\n    --output tsv\n```\n\n----------------------------------------\n\nTITLE: Expose Port 80\nDESCRIPTION: This instruction exposes port 80, making it accessible from outside the Docker container.  This allows external traffic to reach the Nginx server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-ubuntu.md#_snippet_1\n\nLANGUAGE: dockerfile\nCODE:\n```\nEXPOSE 80\n```\n\n----------------------------------------\n\nTITLE: Adding SSL Certificates\nDESCRIPTION: This configuration snippet demonstrates how to add SSL certificates to the mail proxy configuration. It specifies the paths to the certificate and private key files using the `ssl_certificate` and `ssl_certificate_key` directives within the `mail` context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nmail {\n        #...\n        ssl_certificate     /etc/ssl/certs/server.crt;\n        ssl_certificate_key /etc/ssl/certs/server.key;\n    }\n```\n\n----------------------------------------\n\nTITLE: Installing App Protect and SELinux package in SELinux-enforced environments\nDESCRIPTION: This command demonstrates how to install both the `app-protect` and `app-protect-selinux` packages using `yum` in a SELinux-enforced environment. This ensures that the necessary SELinux module is installed along with App Protect, as it is no longer included in the default installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/releases/about-4.2.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nyum install app-protect app-protect-selinux\n```\n\n----------------------------------------\n\nTITLE: Generate Signature Report using Attack Signature Report Tool (bash)\nDESCRIPTION: This command generates a JSON file containing the attack signature report from the NGINX App Protect WAF instance. The `-o` flag specifies the output file name and location.  This requires NGINX App Protect to be installed and configured on the data plane host. The output file is saved as signature-report.json.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/update-signatures.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo /opt/app_protect/bin/get-signatures -o ./signature-report.json\n```\n\n----------------------------------------\n\nTITLE: Enable MAPI Over HTTP PowerShell\nDESCRIPTION: This command enables MAPI over HTTP at the organization level using the Set-OrganizationConfig cmdlet in PowerShell. Requires Exchange 2013 SP1 or later.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_10\n\nLANGUAGE: PowerShell\nCODE:\n```\nC:\\> Set-OrganizationConfig -MapiHTTPEnabled\n```\n\n----------------------------------------\n\nTITLE: Logger Configuration File Content\nDESCRIPTION: This snippet shows the content of the `/etc/app_protect/bd/logger.cfg` file, which contains the App Protect modules for logging and debugging. It defines various modules like IO_PLUGIN, FTP_PLUGIN, SMTP_PLUGIN, and others, along with log levels (TS_DEBUG, TS_INFO, TS_NOTICE, etc.) and file numbers (errors.log = 2, debug.log = 3).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/debug-logs.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\n################################################################################################\n#\n#                                        Logger configuration file\n#\n#       Existing modules:\n#\n#       IO_PLUGIN (Requests & Responses) FTP_PLUGIN (ftp) SMTP_PLUGIN (smtp)\n#       BEM (Accumulation Responses), ECARD (Tables),\n#       ECARD_POLICY (Enforcer), BD_SSL (Communications), UMU (Memory),\n#       IMF (Sockets), BD_MISC (Config and miscs),COOKIE_MGR (Cookies), REG_EXP (Regular expressions),\n#       RESP_PARAMS (Extractions), ATTACK_SIG (Attack Signatures), BD_XML(XML Enforcer),\n#       ATTACK_ENGINE (BF & BOT detect monitor), XML_PARSER (all xml engine), ACY (pattern match engine),\n#       BD_PB (policy builder), BD_PB_SAMPLING (sampling decisions for pb), LEGAL_HASH (internal cache tables),\n#       CLIENT_SIDE (Client Side infrastructure), STATS (policy builder statistics), ICAP (content inspection),\n#       CLUSTER_ANOMALY (the anomaly distributed channel), PIPE (shmem channel bd-pbng, bd-lrn),\n#       MPP_PARSER (Multipart parser), SA_PLUGIN (Session awareness), DATA_PROTECT (Data Protection Library),\n#       GDM (Guardium DB security), ASM_IRULE (ASM iRule commands), LIBDATASYNC (Data Sync Library),\n#       BD_CONF (BD MCP configuration), MPI_CHANNEL (BD initiated MPI events),\n#       BD_FLUSH_TBLS(flush BD conf tables), CSRF (CSRF feature), BRUTE_FORCE_ENFORCER (Brute Force feature),\n#       LONG_REQUEST (Long request), HTML_PARSER (HTML parser)\n#\n#       Log levels:\n#\n#       TS_DEBUG | TS_INFO | TS_NOTICE | TS_WARNING | TS_ERR | TS_CRIT\n#\n#       File numbers:\n#\n#       errors.log = 2 , debug.log = 3 (see /ts/agent/log.cfg)\n#\n```\n\n----------------------------------------\n\nTITLE: Example: Inheriting Permissions JSON Configuration\nDESCRIPTION: This example shows how permissions are inherited in Nginx Controller based on the path hierarchy.  Resources deeper in the path inherit permissions from their parents unless explicitly overwritten.  This configuration grants READ access to all resources under /services/environments/.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-roles.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n     \"access\": \"READ\",\n     \"path\": \"/services/environments/\"\n}\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Plus Version in Shell\nDESCRIPTION: This command checks the installed version of NGINX Plus. It's used to ensure the server is running NGINX Plus Release 34 or later, which supports the OpenID Connect module required for this SSO configuration. The output confirms the NGINX Plus version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/onelogin.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nnginx -v\n```\n\n----------------------------------------\n\nTITLE: Running NGINX Agent Support Script (Bash)\nDESCRIPTION: This command executes the support script for NGINX Agent running on a data plane instance. It gathers logs and system information from the agent to help diagnose issues. It needs SSH access to the data plane instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/support/contact-support.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n/usr/share/nginx-agent/support.sh\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Agent\nDESCRIPTION: Restarts the NGINX Agent after modifying the `agent-dynamic.conf` file to apply changes related to config sync group membership. The agent restart ensures that the new configuration is loaded and the instance is correctly associated with the specified config sync group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/nginx-configs/manage-config-sync-groups.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Install Required Dependencies Shell\nDESCRIPTION: Installs the `ca-certificates` and `wget` packages using the `dnf` package manager. `ca-certificates` provides trusted root certificates, and `wget` is used to download files from the internet.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-dnf.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf install ca-certificates wget\n```\n\n----------------------------------------\n\nTITLE: Extract NGINX Controller Installer Package\nDESCRIPTION: This command extracts the NGINX Controller installer package from a compressed tar archive. Replace <version> with the actual version number of the installer package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ntar xzf controller-installer-<version>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Remove old Nginx repo configurations\nDESCRIPTION: Removes any existing NGINX repository configuration files and related files. This is crucial for ensuring a clean setup and avoiding conflicts with previous installations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-ubuntu.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo rm /etc/apt/sources.list.d/nginx*.list\nsudo rm /etc/apt/sources.list.d/*app-protect*.list\nsudo rm /etc/apt/apt.conf.d/90pkgs-nginx\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Agent (shell)\nDESCRIPTION: This snippet demonstrates how to install the NGINX Agent on a data plane host. It fetches the installation script, executes it, and then starts the agent service, also assigning the host to an instance group named `test-ig`. The agent facilitates metric collection and configuration management.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/enable-metrics.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ncurl --insecure https://192.0.2.2/install/nginx-agent > install.sh \\\n&& sudo sh install.sh -g test-ig \\\n&& sudo systemctl start nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Gateway Fabric CRDs\nDESCRIPTION: This command upgrades the Custom Resource Definitions (CRDs) for NGINX Gateway Fabric using a manifest file from the nginx-gateway-fabric repository. This ensures that the CRDs are up-to-date with the latest version, enabling compatibility with new features and fixes. It uses `kubectl apply` to apply the configurations defined in the remote YAML file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/deploy/crds.yaml\n```\n\n----------------------------------------\n\nTITLE: Testing GCE Network LB with Curl\nDESCRIPTION: This shell script uses curl to repeatedly query the GCE Network Load Balancer's external static IP address and grep the Server header from the response. This allows verification that traffic is being load balanced across different Nginx Plus instances.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\nwhile true; do curl -s <GCE-Network-LB-external-static-IP-address> | grep Server: ;done\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Open Source Packages on RHEL 8.1+\nDESCRIPTION: These commands create a directory, navigate into it, and download NGINX Open Source packages, including dependencies using `repotrack`. Repotrack is used to download packages and their dependencies from a yum repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_22\n\nLANGUAGE: script\nCODE:\n```\nsudo mkdir /etc/packages/\ncd /etc/packages/\nsudo repotrack --forcearch x86_64 app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Configure SSH access to peers - Reload sshd (Amazon Linux, AlmaLinux, CentOS, Oracle Linux, RHEL, Rocky Linux)\nDESCRIPTION: This command restarts the sshd service on Amazon Linux, AlmaLinux, CentOS, Oracle Linux, RHEL, and Rocky Linux systems. The sudo command is used to execute the command with administrative privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart sshd\n```\n\n----------------------------------------\n\nTITLE: Running NGINX Manager Support Script (Bash)\nDESCRIPTION: This command executes the support script for NGINX Instance Manager, which collects diagnostic information to aid in troubleshooting. It requires SSH access to the NGINX Instance Manager host and generates a tarball with logs and system details.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/support/contact-support.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n/usr/share/nginx-manager/support.sh\n```\n\n----------------------------------------\n\nTITLE: Remove PROXY Protocol Keys from NGINX ConfigMap (YAML)\nDESCRIPTION: This YAML snippet shows the keys that need to be removed from the `deployments/common/nginx-config.yaml` ConfigMap to disable the PROXY Protocol. Removing these keys will prevent NGINX from processing PROXY Protocol headers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_12\n\nLANGUAGE: yaml\nCODE:\n```\nproxy-protocol: \"True\"\nreal-ip-header: \"proxy_protocol\"\nset-real-ip-from: \"0.0.0.0/0\"\n```\n\n----------------------------------------\n\nTITLE: Set Page Size for Events (curl)\nDESCRIPTION: This example sets the number of events returned per page using the `pageSize` query parameter. The example sets the page size to 3. Replace `<NMS_FQDN>` and `<access token>` accordingly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"https://<NMS_FQDN>/api/platform/v1/analytics/events?pageSize=3\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Testing nginx-meshctl installation on macOS\nDESCRIPTION: This command runs the nginx-meshctl command without any arguments, verifying that it is correctly installed and accessible from the terminal. It expects the command to output help information or an error message indicating missing arguments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl\n```\n\n----------------------------------------\n\nTITLE: Cloning the nginx-openid-connect GitHub Repository\nDESCRIPTION: This command clones the nginx-openid-connect repository from GitHub. This repository contains necessary files for configuring NGINX Plus as an OpenID Connect relying party. The clone operation downloads the repository to the local machine.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/active-directory-federation-services.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ngit clone https://github.com/nginxinc/nginx-openid-connect\n```\n\n----------------------------------------\n\nTITLE: JSON Response for API Rootpoints\nDESCRIPTION: This JSON snippet shows the structure and example values returned by the NGINX Plus API when querying the root endpoint.  It lists the available top-level API endpoints. It assumes API version 9.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_14\n\nLANGUAGE: json\nCODE:\n```\n[\n   \"nginx\",\n   \"processes\",\n   \"connections\",\n   \"slabs\",\n   \"workers\",\n   \"http\",\n   \"stream\",\n   \"resolvers\",\n   \"ssl\"\n   \"workers\"\n]\n```\n\n----------------------------------------\n\nTITLE: Update NGINXaaS Azure CLI Extension\nDESCRIPTION: This command updates the `nginx` extension for the Azure CLI to the latest version. Updating the extension ensures access to the latest capabilities and features available for NGINXaaS deployments. The `--allow-preview` flag ensures that preview versions are also updated.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/client-tools/cli.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\naz extension update --name nginx --allow-preview true\n```\n\n----------------------------------------\n\nTITLE: Delete NGINX Certificate - Azure CLI\nDESCRIPTION: This command deletes an NGINX certificate from a deployment using the Azure CLI.  It requires the certificate name, deployment name, and resource group to identify the certificate to be removed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-azure-cli.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment certificate delete [--certificate-name]\n                                       [--deployment-name]\n                                       [--ids]\n                                       [--no-wait {0, 1, f, false, n, no, t, true, y, yes}]\n                                       [--resource-group]\n                                       [--subscription]\n                                       [--yes]\n```\n\n----------------------------------------\n\nTITLE: YUM Command to Get NMS Instance Manager Info\nDESCRIPTION: This bash command retrieves information about the installed NGINX Management Suite (NMS) Instance Manager package using the yum package manager. It is used to verify the installed version of Instance Manager to ensure compatibility with other NMS modules.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nyum info nms-instance-manager\n```\n\n----------------------------------------\n\nTITLE: Enabling HTTP Basic Authentication\nDESCRIPTION: This snippet enables HTTP Basic authentication. It specifies a user file that contains usernames and passwords for accessing the dashboard. An htpasswd generator can create the user file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_37\n\nLANGUAGE: nginx\nCODE:\n```\nauth_basic on;\nauth_basic_user_file /etc/nginx/users;\n```\n\n----------------------------------------\n\nTITLE: Port Forward to Access NGINX Plus Dashboard\nDESCRIPTION: This command uses `kubectl port-forward` to forward connections from the local machine's port 8765 to the NGINX Gateway Fabric pod's port 8765. Replace `<nginx-gateway-fabric-pod>` with the actual name of the pod.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/dashboard.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl port-forward <nginx-gateway-fabric-pod> 8765:8765 -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Text Output Example\nDESCRIPTION: This code snippet provides an example of expected output from a shell command. It demonstrates how to use a separate code block to illustrate the expected results, including the use of ellipses to truncate lengthy output.\nSOURCE: https://github.com/nginx/documentation/blob/main/archetypes/default.md#_snippet_1\n\nLANGUAGE: text\nCODE:\n```\n# A second code block is used underneath the first to show what kind of example output to expect from the command. Truncate unnecessary output with ellipses (...).\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Plus repo file (RHEL)\nDESCRIPTION: Downloads the NGINX Plus repository file to /etc/yum.repos.d. This step is essential for configuring the system to retrieve NGINX Plus packages from the official NGINX repository. The command uses wget to download the repository file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-8.repo\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Plus Repo to RHEL 9/Oracle/Alma/Rocky 9\nDESCRIPTION: Downloads the Nginx Plus repository file for RHEL 9 (and compatible distributions) and places it in the /etc/yum.repos.d directory. This is a necessary step to install NGINX Plus packages using DNF.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/plus-9.repo\n```\n\n----------------------------------------\n\nTITLE: Securely Copy NGINX Controller Support Package\nDESCRIPTION: This command securely copies the generated support package from the NGINX Controller host to a local machine using `scp`. Replace `<username>`, `<controller-host-ip>`, and `<timestamp>` with the appropriate values for your environment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_16\n\nLANGUAGE: bash\nCODE:\n```\nscp <username>@<controller-host-ip>:/var/tmp/supportpkg-<timestamp>.tar.gz /local/path\n```\n\n----------------------------------------\n\nTITLE: HTTP Cookie Persistence on NGINX Plus\nDESCRIPTION: This code snippet configures HTTP cookie-based session persistence on NGINX Plus.  It uses the `sticky cookie` directive within the upstream block to enable cookie-based persistence with an expiration time.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nupstream test_pool {\n        server 10.10.10.10:80;\n        server 10.10.10.20:80;\n        sticky cookie mysession expires=1h;\n   }\n```\n\n----------------------------------------\n\nTITLE: Delete Resource Group Request - NGINX Instance Manager\nDESCRIPTION: This bash command demonstrates how to delete a resource group using the NGINX Instance Manager REST API with a DELETE request.  It requires the resource group UID as a path parameter.  Replace <NIM_FQDN> and {resourceGroupUid} with actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/rbac/manage-resource-groups.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nDELETE https://<NIM_FQDN>/api/platform/v1/resource-groups/{resourceGroupUid}\n```\n\n----------------------------------------\n\nTITLE: Example NGINX Plus Version Output\nDESCRIPTION: This is an example output from the `nginx -v` command, showing that the installed version is NGINX Plus Release 34 or later.  This output confirms the environment meets the minimum version requirement for the OpenID Connect module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/cognito.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nnginx version: nginx/1.27.4 (nginx-plus-r34)\n```\n\n----------------------------------------\n\nTITLE: Configuring Security Logs in Nginx with App Protect\nDESCRIPTION: This snippet shows how to configure security logs within an Nginx server block using NGINX App Protect WAF. It enables the security log and sets the destination to syslog.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/logging-overview/logs-overview.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\n    ...\n    location / {\n\n        # NGINX App Protect WAF\n        app_protect_enable on;\n        app_protect_security_log_enable on;\n        app_protect_security_log log_blocked syslog:server=log-server:514;\n\n        proxy_pass http://127.0.0.1:8080/;\n    }\n```\n\n----------------------------------------\n\nTITLE: Verify resource creation\nDESCRIPTION: This shell command retrieves the list of pods and services to ensure the secure-app pod and service are running correctly. It helps verify if the resources were created successfully as defined in the previous step.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/tls-passthrough.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get pods,svc\n```\n\n----------------------------------------\n\nTITLE: Encoding Credentials to Base64 in Bash\nDESCRIPTION: This command encodes the provided username and password into base64 format. It takes username and password as input, concatenates them with a colon, and then encodes the result using the base64 utility. The output is the base64-encoded credentials.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/admin-guide/auth/basic-auth-api-requests.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\necho -n <username>:<password> | base64\n```\n\n----------------------------------------\n\nTITLE: Query Metrics with SeriesLimit - cURL\nDESCRIPTION: This cURL command restricts the returned data to five series using the `seriesLimit` parameter.  It also requires the `groupBy` parameter. The API response includes the top 5 series, plus an `all` series.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_15\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=SUM(http.request.count)&groupBy=app&seriesLimit=5&startTime=now-3h&resolution=5m\"\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Public Key (CentOS/RHEL/Amazon Linux - Bash)\nDESCRIPTION: Downloads the NGINX public key and imports it using `rpm`. It enables the system to verify the authenticity of NGINX packages. The `curl` command downloads the key, and `rpm --import` adds it to the RPM database.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\ncurl -sS -L -O https://nginx.org/keys/nginx_signing.key && \\\nrpm --import nginx_signing.key\n```\n\n----------------------------------------\n\nTITLE: Upload Chef Roles using Knife\nDESCRIPTION: These commands upload role definitions from files to the Chef server. Roles define the configuration settings and run lists for different types of nodes, such as Nginx Plus or Nginx Plus HA.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nroot@chef-server:~/chef-zero/playground# knife role from file roles/nginx_plus.rb\n```\n\nLANGUAGE: shell\nCODE:\n```\nroot@chef-server:~/chef-zero/playground# knife role from file roles/nginx_plus_ha.rb\n```\n\n----------------------------------------\n\nTITLE: Enabling Read/Write API Access NGINX\nDESCRIPTION: This snippet enables read/write access to the NGINX Plus API by adding the `write=on` parameter to the `api` directive.  This is essential for modifying upstream configurations.  Without this, the API will be read-only.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    server {\n        location /api {\n            api  write=on;\n            # ...\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Reverting to Basic Auth Configuration\nDESCRIPTION: These commands revert the Nginx configuration to use Basic Auth instead of OIDC, restoring the original configuration files from the backups. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\nsudo cp ~/openid_configuration.conf.orig /etc/nms/nginx/oidc/openid_configuration.conf\nsudo cp ~/nms-http.conf.orig /etc/nginx/conf.d/nms-http.conf\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Describing GatewayClass using kubectl\nDESCRIPTION: This command retrieves and displays details about the 'nginx' GatewayClass, including the status of the associated NginxProxy configuration.  The output shows the `ResolvedRefs` condition to confirm the configuration is valid and applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/data-plane-configuration.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe gatewayclasses nginx\n```\n\n----------------------------------------\n\nTITLE: Enable HTTPS for Metrics - Add HTTPS Scheme Annotation\nDESCRIPTION: This YAML snippet demonstrates how to add the HTTPS scheme annotation to the Pod template, enabling HTTPS for metrics endpoint. This requires the `-metrics-secure-serving` command-line argument to be set to `true`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/prometheus.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\nannotations:\n    <...>\n    prometheus.io/scheme: \"https\"\n    <...>\n```\n\n----------------------------------------\n\nTITLE: Describe Kubernetes HTTPRoute\nDESCRIPTION: Retrieves detailed information about an HTTPRoute resource using kubectl. This command shows the resource's specification, status, and other metadata, which can be used to diagnose issues or verify its configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/resource-validation.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe httproutes.gateway.networking.k8s.io coffee\n```\n\n----------------------------------------\n\nTITLE: Docker Login to NGINX Private Registry (Shell)\nDESCRIPTION: This command is used to log in to the NGINX private registry using a JSON Web Token (JWT) license from MyF5. Replace `YOUR_JWT_HERE` with the actual JWT.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/config-sync-groups/manage-config-sync-groups.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker login private-registry.nginx.com --username=YOUR_JWT_HERE --password=none\n```\n\n----------------------------------------\n\nTITLE: Enabling PROXY Protocol for TCP Stream in NGINX\nDESCRIPTION: This snippet demonstrates how to enable the PROXY protocol for a TCP stream connection between NGINX and an upstream server. It configures the server to listen on port 12345 and pass traffic to example.com:12345, enabling the proxy_protocol.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/using-proxy-protocol.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    server {\n        listen 12345;\n        proxy_pass example.com:12345;\n        proxy_protocol on;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create Azure Load Balancer Health Probe - Azure CLI\nDESCRIPTION: Creates a health probe for an Azure Load Balancer to monitor a specific port (e.g., 8000) using the TCP protocol.  It is essential for determining the health of backend servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/private-link-to-upstreams.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n$ az network lb probe create \\\n    --resource-group $APP_RESOURCE_GROUP \\\n    --lb-name load-balancer \\\n    --name 8000-probe \\\n    --protocol tcp \\\n    --port 8000\n```\n\n----------------------------------------\n\nTITLE: Install njs module on SLES\nDESCRIPTION: This snippet provides the command to install the `nginx-plus-module-njs` package on SUSE Linux Enterprise Server (SLES) using the `zypper` package manager. It refreshes the package repositories and then installs the module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginscript.md#_snippet_3\n\nLANGUAGE: Shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Configuring X-Total-Request-Response-Latency header in Nginx\nDESCRIPTION: This snippet adds the X-Total-Request-Response-Latency header to the response, indicating the total request time, from when Nginx receives the request to when the response is sent. The $request_time variable represents the total request time.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/proxy-response-headers.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nadd_header X-Total-Request-Response-Latency $request_time [always]\n```\n\n----------------------------------------\n\nTITLE: Set PID Directive (Nginx)\nDESCRIPTION: This snippet shows how to configure the Nginx configuration file to use a specific PID file location. It's essential for managing the Nginx process and signals when running with non-standard configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-agent-non-root.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\npid        /var/tmp/nginx.pid;\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent on RHEL with rpm\nDESCRIPTION: This command installs the NGINX Agent package on RHEL systems using the `rpm` package manager. Sudo privileges are required to perform the installation. Replace `<agent-version>` with the correct version of the downloaded package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-github.md#_snippet_2\n\nLANGUAGE: Shell\nCODE:\n```\nsudo rpm -i nginx-agent-<agent-version>.rpm\n```\n\n----------------------------------------\n\nTITLE: Test Configuration (Path '/')\nDESCRIPTION: This curl command tests the configuration by sending a request to the 'cafe.example.com' hostname and port specified in the environment variables. The `--resolve` option simulates DNS resolution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/routing-traffic-to-your-app.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/\n```\n\n----------------------------------------\n\nTITLE: Enabling Image-Filter Module in Nginx Configuration\nDESCRIPTION: This configuration snippet shows how to enable the Image-Filter module by loading the module in the main context and then configuring it within the http context in the `nginx.conf` file. This requires the `ngx_http_image_filter_module.so` file to exist in the `modules` directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/image-filter.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_image_filter_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Verifying Kubernetes API Root Access (kubectl)\nDESCRIPTION: This command uses `kubectl` to verify if the root user has access to the Kubernetes API in the `nms` namespace. It retrieves a list of pods, indicating successful access. Requires `kubectl` and proper Kubernetes configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo kubectl -n nms get pods\n```\n\n----------------------------------------\n\nTITLE: Stopping Controller Agent Service - Bash\nDESCRIPTION: This command stops the `controller-agent` service using `systemctl`. It is part of a workaround to address misreported TCP/UDP traffic issues after upgrading NGINX Controller. It is executed in sequence with stopping/starting the nginx service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsystemctl stop controller-agent\n```\n\n----------------------------------------\n\nTITLE: Changing permissions of Kubernetes configuration\nDESCRIPTION: This command sets the permissions of the Kubernetes configuration file to 777, granting read, write, and execute permissions to all users.  This is likely for debugging and should be used cautiously.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_16\n\nLANGUAGE: bash\nCODE:\n```\nsudo chmod 777 $HOME/.kube/config\n```\n\n----------------------------------------\n\nTITLE: Test Configuration (Path '/some-path')\nDESCRIPTION: This curl command tests the configuration by sending a request to the 'cafe.example.com' hostname with a specific path. This confirms that the path prefix matching is working as expected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/routing-traffic-to-your-app.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/some-path\n```\n\n----------------------------------------\n\nTITLE: Updating Agent on CentOS\nDESCRIPTION: This shows how to update the nginx-amplify-agent package on CentOS systems. It first makes sure that yum's cache is up to date by calling `yum makecache` and then runs `yum update` to update the agent to the latest version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/faq/nginx-amplify-agent.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nyum makecache && \\\nyum update nginx-amplify-agent\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Open Source (Debian 11)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Open Source package from Debian 11. It uses the `apt-get remove` command to remove the `app-protect-module-oss` package. Requires root privileges and the apt package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_54\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get remove app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Gateway Fabric with NodePort Service\nDESCRIPTION: This command installs NGINX Gateway Fabric with a NodePort service type, allowing access to the gateway through node ports. It creates the 'nginx-gateway' namespace if it doesn't exist.  Requires Helm 3.0+ and kubectl.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nhelm install ngf oci://ghcr.io/nginx/charts/nginx-gateway-fabric --create-namespace -n nginx-gateway --set service.type=NodePort\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Service Mesh with mTLS strict mode (Bash)\nDESCRIPTION: This command deploys NGINX Service Mesh with mTLS mode set to strict. The `--mtls-mode=strict` flag ensures that all communication within the mesh is encrypted using mTLS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --mtls-mode=strict\n```\n\n----------------------------------------\n\nTITLE: Configure SSL CRL in NGINX\nDESCRIPTION: This snippet configures NGINX to use a Certificate Revocation List (CRL) for checking revoked certificates using the `proxy_ssl_crl` directive. The file should be in PEM format.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/securing-upstream-traffic.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /upstream {\n    # ...\n    proxy_ssl_crl /etc/nginx/revoked.crt;\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Disable Metrics - Remove Prometheus Annotations\nDESCRIPTION: This YAML snippet shows how to remove the Prometheus annotations from a Pod template. These annotations are used by Prometheus to scrape metrics from the pod; removing them is part of disabling metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/prometheus.md#_snippet_6\n\nLANGUAGE: yaml\nCODE:\n```\nannotations:\n  prometheus.io/scrape: \"true\"\n  prometheus.io/port: \"9113\"\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Developer Portal (RPM-Based) - Bash\nDESCRIPTION: Installs the NGINX Developer Portal and UI packages on RPM-based systems (CentOS, RHEL) using `yum`. The `--nogpgcheck` option is used to bypass GPG signature verification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-devportal-offline.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum -y --nogpgcheck install /home/user/nginx-devportal-<version>.x86_64.rpm\nsudo yum -y --nogpgcheck install /home/user/nginx-devportal-ui-<version>.x86_64.rpm\n```\n\n----------------------------------------\n\nTITLE: In-Place Upgrade using nginx-meshctl\nDESCRIPTION: This command upgrades the NGINX Service Mesh control plane to the latest version. It preserves user configurations but requires application re-rolling for updates to take effect and may incur brief downtime.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl upgrade\n```\n\n----------------------------------------\n\nTITLE: Update OIDC Domain in openid_configuration.conf - Nginx\nDESCRIPTION: This snippet shows how to update the `oidc_domain` setting in the `/etc/nms/nginx/oidc/openid_configuration.conf` file with your Microsoft Entra tenant domain. The tenant domain is used to construct the user email.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/microsoft-entra-automation.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\n...\nmap $host $oidc_domain {\n    SERVER_FQDN OIDC_DOMAIN;\n    # replace with OIDC specific setting\n    default \"f5.com\";\n}\n...\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Plus (CentOS 7.4+)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Plus package from CentOS 7.4 and later. It uses the `yum remove` command to remove the `app-protect-module-plus` package. Requires root privileges and the yum package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_53\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum remove app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Coffee Response Example (Text)\nDESCRIPTION: This is an example response received from the `coffee` application after a successful request. It shows the server address and the server name (pod name) that handled the request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_6\n\nLANGUAGE: text\nCODE:\n```\nServer address: 10.244.0.9:8080\nServer name: coffee-76c7c85bbd-cf8nz\n```\n\n----------------------------------------\n\nTITLE: Verify Nginx Configuration Syntax is OK\nDESCRIPTION: This shows the expected output when the nginx configuration file syntax is ok. This result comes from running the command `nginx -t`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/headers-more.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Get NGINX Controller API Session Status\nDESCRIPTION: Retrieves the status of the current NGINX Controller API session using the session cookie obtained during login.  This allows verification of the session's validity. Requires a valid session cookie stored in `cookie.txt`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller-app-sec.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ncurl -b cookie.txt -c cookie.txt -X GET --url 'https://<ip address>/api/v1/platform/login'\n```\n\n----------------------------------------\n\nTITLE: Disable Metrics - Remove Metrics Port\nDESCRIPTION: This YAML snippet shows how to remove the metrics port entry from the container ports list within a Pod template. This is part of disabling metrics for NGINX Gateway Fabric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/prometheus.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\n- name: metrics\n  containerPort: 9113\n```\n\n----------------------------------------\n\nTITLE: Configure usage_report directive for NGINX Instance Manager\nDESCRIPTION: This snippet configures the `usage_report` directive within the `mgmt` block of the NGINX configuration file. It specifies the endpoint for reporting telemetry data to a specified NGINX Instance Manager host.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/solutions/r33-pre-release-guidance-for-automatic-upgrades.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nusage_report endpoint=<NGINX_INSTANCE_MANAGER_HOST_FQDN> interval=1hr;\n```\n\n----------------------------------------\n\nTITLE: Example JWT Header - JSON\nDESCRIPTION: This is an example of the JWT header received after decoding the access token. It contains the algorithm, x5t, and kid.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/microsoft-entra-automation.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"alg\": \"RS256\",\n    \"x5t\": \"-KI3Q9nNR7bR0fxmeZ0XqbHZGew\",\n    \"kid\": \"-KI3Q9nNR7bR0fxmeZ0XqbHZGew\"\n}\n```\n\n----------------------------------------\n\nTITLE: Running Nginx New Relic Agent via init script\nDESCRIPTION: Explains how to manage the NGINX New Relic agent using the init script.  The command allows starting, stopping, or checking the status of the agent service. Requires the agent to be installed and the init script to be configured. The agent runs as the 'nobody' user when started this way.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/new-relic-plugin.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nservice nginx-nr-agent start\nservice nginx-nr-agent stop\nservice nginx-nr-agent status\n```\n\n----------------------------------------\n\nTITLE: Security Log JSON Example\nDESCRIPTION: This JSON snippet illustrates the structure of a security log entry, highlighting new fields such as `ratingIncludingViolationsInStaging`, `stagingCertificationDatetime`, and `lastUpdateTime` related to enforcement state. The snippet shows various violation details, including signature information, observed entities, and policy entities.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/time-based-sig-log-report.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\njson_log=\"{\\\"id\\\":\\\"7103271131347005954\\\",\\\"violations\\\":[{\\\"enforcementState\\\":{\\\"isBlocked\\\":true,\\\"isAlarmed\\\":true,\\\"isInStaging\\\":false,\\\"isLearned\\\":false,\\\"isLikelyFalsePositive\\\":false},\\\"violation\\\":{\\\"name\\\":\\\"VIOL_ATTACK_SIGNATURE\\\"},\\\"signature\\\":{\\\"name\\\":\\\"XSS script tag (Parameter)\\\",\\\"signatureId\\\":200000098,\\\"accuracy\\\":\\\"high\\\",\\\"risk\\\":\\\"high\\\",\\\"hasCve\\\":false,\\\"stagingCertificationDatetime\\\":\\\"2024-01-01T00:00:00Z\\\",\\\"lastUpdateTime\\\":\\\"2023-11-02T19:36:54Z\\\"},\\\"snippet\\\":{\\\"buffer\\\":\\\"cGFyYW09PHNjcmlwdA==\\\",\\\"offset\\\":6,\\\"length\\\":7},\\\"policyEntity\\\":{\\\"parameters\\\":[{\\\"name\\\":\\\"*\\\",\\\"level\\\":\\\"global\\\",\\\"type\\\":\\\"wildcard\\\"}]},\\\"observedEntity\\\":{\\\"name\\\":\\\"cGFyYW0=\\\",\\\"value\\\":\\\"PHNjcmlwdA==\\\",\\\"location\\\":\\\"query\\\"}},{\\\"enforcementState\\\":{\\\"isBlocked\\\":false,\\\"isAlarmed\\\":true,\\\"isLearned\\\":false},\\\"violation\\\":{\\\"name\\\":\\\"VIOL_PARAMETER_VALUE_METACHAR\\\"},\\\"policyEntity\\\":{\\\"parameters\\\":[{\\\"name\\\":\\\"*\\\",\\\"level\\\":\\\"global\\\",\\\"type\\\":\\\"wildcard\\\"}]},\\\"observedEntity\\\":{\\\"name\\\":\\\"cGFyYW0=\\\",\\\"value\\\":\\\"PHNjcmlwdA==\\\",\\\"location\\\":\\\"query\\\"},\\\"metachar\\\":\\\"0x3c\\\",\\\"charsetType\\\":\\\"parameter-value\\\"},{\\\"enforcementState\\\":{\\\"isBlocked\\\":false},\\\"violation\\\":{\\\"name\\\":\\\"VIOL_HTTP_PROTOCOL\\\"},\\\"policyEntity\\\":{\\\"blocking-settings\\\":{\\\"http-protocols\\\":{\\\"description\\\":\\\"Host header contains IP address\\\"}}}},{\\\"enforcementState\\\":{\\\"isBlocked\\\":true},\\\"violation\\\":{\\\"name\\\":\\\"VIOL_RATING_THREAT\\\"}},{\\\"enforcementState\\\":{\\\"isBlocked\\\":false},\\\"violation\\\":{\\\"name\\\":\\\"VIOL_BOT_CLIENT\\\"}}],\\\"enforcementAction\\\":\\\"block\\\",\\\"method\\\":\\\"GET\\\",\\\"clientPort\\\":6026,\\\"clientIp\\\":\\\"10.42.0.1\\\",\\\"host\\\":\\\"nginx-78b84c446f-flw6h\\\",\\\"responseCode\\\":0,\\\"serverIp\\\":\\\"0.0.0.0\\\",\\\"serverPort\\\":80,\\\"requestStatus\\\":\\\"blocked\\\",\\\"url\\\":\\\"L2luZGV4LnBocA==\\\",\\\"virtualServerName\\\":\\\"24-localhost:1-/\\\",\\\"enforcementState\\\":{\\\"isBlocked\\\":true,\\\"isAlarmed\\\":true,\\\"rating\\\":4,\\\"attackType\\\":[{\\\"name\\\":\\\"Non-browser Client\\\"},{\\\"name\\\":\\\"Abuse of Functionality\\\"},{\\\"name\\\":\\\"Cross Site Scripting (XSS)\\\"},{\\\"name\\\":\\\"Other Application Activity\\\"},{\\\"name\\\":\\\"HTTP Parser Attack\\\"}],\\\"ratingIncludingViolationsInStaging\\\":4,\\\"stagingCertificationDatetime\\\":\\\"2024-01-01T00:00:00Z\\\"},\\\"requestDatetime\\\":\\\"2023-12-27T14:22:29Z\\\"}\n```\n\n----------------------------------------\n\nTITLE: Testing NGINX configuration with curl (root path)\nDESCRIPTION: This curl command tests the configuration by sending a request to the '/' path. Since there's no specific rule to handle this route, it returns a 404 Not Found error.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/\n```\n\n----------------------------------------\n\nTITLE: Example HTTP Redirect Response for soda (Text)\nDESCRIPTION: This is an example HTTP response showing a 302 redirect for `http://cafe.example.com/soda` to `http://cafe.example.com:8080/flavors`\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_14\n\nLANGUAGE: text\nCODE:\n```\nHTTP/1.1 302 Moved Temporarily\n..\nLocation: http://cafe.example.com:8080/flavors\n```\n\n----------------------------------------\n\nTITLE: Add User-Defined Signature Definition File Location in NGINX\nDESCRIPTION: This snippet shows how to define a URI Snippet within a Gateway API to specify the location of a User-Defined Signature Definition file for NGINX App Protect WAF. The `app_protect_user_defined_signatures` directive is used to reference the signature definition. The user-defined signature file must already exist on the NGINX App Protect WAF instances.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/concepts/extend-app-security-snippets.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"<gateway-name>\"\n    },\n    \"desiredState\": {\n        \"configSnippets\": {\n            \"httpSnippet\": {\n                \"directives\": [\n                    {\n                        \"directive\": \"app_protect_user_defined_signatures\",\n                        \"args\": [\"app_protect_user_defined_signature_def_01\"]\n                    }\n                ]\n            }\n        },\n        \"ingress\": {\n            \"uris\": {\n                \"<gateway-uri>\": {}\n            },\n            \"placement\":  {\n                \"instanceRefs\": [\n                    {\n                        \"ref\": \"/infrastructure/locations/unspecified/instances/<instance-name>\"\n                    }\n                ]\n            }\n        }\n    }\n}\n\n```\n\n----------------------------------------\n\nTITLE: Dockerfile for Nginx OSS and App Protect WAF Setup\nDESCRIPTION: This Dockerfile sets up an Nginx environment with Nginx App Protect WAF v5 on a Red Hat Universal Base Image. It installs necessary packages, configures Nginx repositories, and sets up certificates for accessing protected resources. The UBI_VERSION argument allows selection of the base OS version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-rhel.md#_snippet_0\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Supported UBI_VERSION's are 7/8/9\nARG UBI_VERSION=9\n\n# Base Image\nFROM registry.access.redhat.com/ubi${UBI_VERSION}/ubi\n\n# Define the ARG again after FROM to use it in this stage\nARG UBI_VERSION\n\n# Install NGINX OSS and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    PKG_MANAGER=dnf; \\\n    if [ \"${UBI_VERSION}\" = \"7\" ]; then \\\n        PKG_MANAGER=yum; \\\n    fi \\\n    && $PKG_MANAGER -y install wget ca-certificates yum-utils \\\n    && wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo \\\n    && echo \"[nginx-mainline]\" > /etc/yum.repos.d/nginx.repo \\\n    && echo \"name=nginx mainline repo\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"baseurl=http://nginx.org/packages/mainline/centos/\\$releasever/\\$basearch/\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"gpgcheck=1\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"gpgkey=https://nginx.org/keys/nginx_signing.key\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"module_hotfixes=true\" >> /etc/yum.repos.d/nginx.repo \\\n    && echo \"[app-protect-x-oss]\" > /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-oss.repo \\\n    && echo \"name=nginx-app-protect repo\" >> /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-oss.repo \\\n    && echo \"baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/${UBI_VERSION}/\\$basearch/\" >> /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-oss.repo \\\n    && echo \"sslclientcert=/etc/ssl/nginx/nginx-repo.crt\" >> /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-oss.repo \\\n    && echo \"sslclientkey=/etc/ssl/nginx/nginx-repo.key\" >> /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-oss.repo \\\n    && echo \"gpgcheck=0\" >> /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-oss.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/app-protect-${UBI_VERSION}-x-oss.repo \\\n    && $PKG_MANAGER clean all \\\n    && $PKG_MANAGER install -y app-protect-module-oss \\\n    && $PKG_MANAGER clean all \\\n    && rm -rf /var/cache/$PKG_MANAGER \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log\n\n# Expose port\nEXPOSE 80\n\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Amplify Agent Status (Bash)\nDESCRIPTION: Checks if the NGINX Amplify Agent is running by listing processes and filtering for 'amplify-'.  It uses `ps` and `grep` commands. The expected output is a line containing 'amplify-agent' and its process ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nps ax | grep -i 'amplify\\-'\n2552 ?        S      0:00 amplify-agent\n```\n\n----------------------------------------\n\nTITLE: Inspect Docker Volume Mountpoint (Docker)\nDESCRIPTION: Inspects the Docker volume named `nim_nim-data` and extracts the mountpoint path using `jq`. This allows you to locate the directory on the host system where the volume's data is stored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\n~/compose$ docker inspect volume nim_nim-data | jq '.[0].Mountpoint'\n```\n\n----------------------------------------\n\nTITLE: Warning messages example in NGINX Service Mesh logs\nDESCRIPTION: This snippet provides an example warning message that may appear in the `nginx-mesh-sidecar` logs after configuring traffic access policies. The message, indicating a failure to connect to the upstream, is considered harmless and can be safely ignored. The snippet illustrates the type of log entry users might encounter and reassures them that it doesn't signify an operational issue.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.9.0.md#_snippet_0\n\nLANGUAGE: plaintext\nCODE:\n```\n2020/09/24 01:03:14 could not parse syslog message: nginx could not connect to upstream\n```\n\n----------------------------------------\n\nTITLE: Create NGINX SSL Directory (Shell)\nDESCRIPTION: This command creates the directory `/etc/ssl/nginx/` if it doesn't already exist. This directory is intended to store SSL certificates and keys, which are required for secure communication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/ssl/nginx\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Instance Manager License Mode (YAML)\nDESCRIPTION: This YAML snippet configures the NGINX Instance Manager license mode to 'disconnected'. This setting is added to the `integrations:license` section of the `/etc/nms/nms.conf` file. This ensures that the Instance Manager operates without needing to connect to a licensing server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/set-mode-of-operation-disconnected.md#_snippet_0\n\nLANGUAGE: YAML\nCODE:\n```\nintegrations:\n    license:\n        mode_of_operation: disconnected\n```\n\n----------------------------------------\n\nTITLE: Using Wildcard Includes for HTTP and Stream Config Files\nDESCRIPTION: This snippet illustrates how to use wildcard notation with the `include` directive to include all HTTP and stream configuration files from the conf.d directory. This assumes a consistent naming convention for these files. The `include` directive is part of the core Nginx module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_20\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    include conf.d/*-http.conf;\n}\n\nstream {\n    include conf.d/*-stream.conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Create NGINX Certificate - Azure CLI\nDESCRIPTION: This command creates an NGINX certificate under a specific deployment, referencing an existing certificate stored in an Azure Key Vault.  It requires the certificate name, deployment name, and resource group. Optional parameters include certificate path, key path, and key vault secret ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-azure-cli.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment certificate create --certificate-name\n                                       --deployment-name\n                                       --resource-group\n                                       [--certificate-path]\n                                       [--key-path]\n                                       [--key-vault-secret-id]\n                                       [--location]\n                                       [--no-wait {0, 1, f, false, n, no, t, true, y, yes}]\n```\n\n----------------------------------------\n\nTITLE: Stream Client-v1 Logs using kubectl\nDESCRIPTION: This command streams the logs from the `client` container of the `client-v1` Pod using kubectl.  The `-l app=client-v1` flag selects the pod with the label `app=client-v1`. The `-f` flag follows the logs as new data is written. The `-c client` flag specifies the `client` container within the pod.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nkubectl logs -l app=client-v1 -f -c client\n```\n\n----------------------------------------\n\nTITLE: Defining Custom NGINX Instance Manager Address\nDESCRIPTION: This snippet shows how to define a custom address for NGINX Instance Manager using the `usage_report` directive with the `endpoint` parameter. It allows specifying a hostname or IP address other than the default.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/usage-tracking/agentless-reporting.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n    resolver     10.0.0.1;\n    usage_report endpoint=nms.local interval=15m;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Adding SPIFFE Label to Pod\nDESCRIPTION: This YAML snippet illustrates the addition of the `spiffe.io/spiffeid: \"true\"` label to the Ingress Controller's Pod.  This label signals NGINX Service Mesh to apply the necessary mutations to the Pod for proper integration with the mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_20\n\nLANGUAGE: YAML\nCODE:\n```\nlabels:\n  spiffe.io/spiffeid: \"true\"\n  ...\n```\n\n----------------------------------------\n\nTITLE: Stopping NGINX Controller (Bash)\nDESCRIPTION: This script stops the NGINX Controller service. It uses the `helper.sh` script located in `/opt/nginx-controller/` with the `controller stop` command. This step is necessary before backing up or restoring the config database to ensure data consistency.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-external-config-db.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh controller stop\n```\n\n----------------------------------------\n\nTITLE: Remove Local Backup File (Bash)\nDESCRIPTION: This command removes the backup file from the `local_backups/` directory. The `-i` flag prompts for confirmation before removing the file, preventing accidental deletion.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-embedded-config-db.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nrm -i local_backups/backup_<timestamp>.tar\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Instance Manager for Vault Secret Storage\nDESCRIPTION: This configuration snippet shows the setting for the `driver` parameter under `core/secrets` within `/etc/nms/nms.conf` to 'vault'. This directs NGINX Instance Manager to use Vault for secret storage instead of local file-based encryption.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-vault.md#_snippet_11\n\nLANGUAGE: text\nCODE:\n```\ndriver: vault\n```\n\n----------------------------------------\n\nTITLE: Uninstalling on CentOS/RHEL/RPM-based distributions\nDESCRIPTION: This snippet shows how to uninstall Nginx Instance Manager and ClickHouse on CentOS, RHEL and RPM based distributions using yum. It stops the clickhouse-server service and then removes the packages nms-* and clickhouse-server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/uninstall/uninstall-nim.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum remove -y nms-*\nsudo systemctl stop clickhouse-server\nsudo yum remove -y clickhouse-server\n```\n\n----------------------------------------\n\nTITLE: Displaying IP Address Configuration for Nginx Interface\nDESCRIPTION: This command displays the IP address configuration of the specified network interface (eth1). This is used to verify the assignment of the virtual IP address to the primary node and the absence of it from the secondary node after synchronization.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nip addr show eth1\n```\n\n----------------------------------------\n\nTITLE: Stopping WAF Services using Docker Compose\nDESCRIPTION: This command stops the WAF services using Docker Compose.  It requires Docker Compose to be installed and the `docker-compose.yml` file to be present in the current directory. This will stop all containers defined in the docker-compose.yml file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_47\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker compose stop\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Volume Mount for Nginx Plus Usage Certs\nDESCRIPTION: Defines a Kubernetes volume mount for the `nginx` container that mounts the `nginx-plus-usage-certs` volume to `/etc/nginx/certs-bootstrap/`. This is used when configuring NGINX Gateway Fabric to report to NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/nginx-plus-jwt.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\n- mountPath: /etc/nginx/certs-bootstrap/\n  name: nginx-plus-usage-certs\n```\n\n----------------------------------------\n\nTITLE: Checking Instance State\nDESCRIPTION: This command checks the current state of the instance (MASTER or BACKUP) by reading the contents of the /var/run/nginx-ha-keepalived.state file. This file is updated by keepalived to reflect the current role of the instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-keepalived.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\ncat /var/run/nginx-ha-keepalived.state\n```\n\n----------------------------------------\n\nTITLE: Check App Protect Installation (Debian)\nDESCRIPTION: This command checks if NGINX App Protect WAF is installed on Debian-based systems. It's used to verify that App Protect WAF and the WAF compiler are not running on the same host.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_29\n\nLANGUAGE: shell\nCODE:\n```\ndpkg -s app-protect\n```\n\n----------------------------------------\n\nTITLE: Copying admin Kubernetes configuration\nDESCRIPTION: This command copies the Kubernetes admin configuration file to the user's .kube directory. This step ensures that the user has the necessary permissions to interact with the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n```\n\n----------------------------------------\n\nTITLE: Describe UpstreamSettingsPolicy Keepalive Status (Shell)\nDESCRIPTION: This command uses `kubectl describe` to check the status of the `UpstreamSettingsPolicy` named `upstream-keepalives`. It verifies that the policy has been accepted by the NGINX Gateway Fabric controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe upstreamsettingspolicies.gateway.nginx.org upstream-keepalives\n```\n\n----------------------------------------\n\nTITLE: Backup Configuration Files - FreeBSD\nDESCRIPTION: Backs up the NGINX configuration and log files on FreeBSD systems before upgrading NGINX Plus.  It copies the contents of /usr/local/etc/nginx and /var/log/nginx to /usr/local/etc/nginx-plus-backup and /var/log/nginx-plus-backup, respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_53\n\nLANGUAGE: shell\nCODE:\n```\nsudo cp -a /usr/local/etc/nginx /usr/local/etc/nginx-plus-backup\nsudo cp -a /var/log/nginx /var/log/nginx-plus-backup\n```\n\n----------------------------------------\n\nTITLE: Check NGINX version - Debian and Ubuntu\nDESCRIPTION: This command checks the installed NGINX binary version. `sudo nginx -v` displays the version information for the Nginx web server, confirming successful NGINX Plus installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_24\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx -v\n```\n\n----------------------------------------\n\nTITLE: Stream Active Connections Metric\nDESCRIPTION: Describes the 'plus.stream.conn.active' metric, which is a gauge representing the current number of client connections that are currently being processed. This metric is useful for monitoring the current number of active TCP/UDP connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_18\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, integer\nDescription: Current number of client connections that are currently being processed.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Update apt-get repository information on Debian\nDESCRIPTION: This command updates the apt-get package repository information, ensuring that the system has the latest package lists. It's required before installing or updating any packages using apt-get. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get update\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX Agent on RHEL/CentOS\nDESCRIPTION: This command removes the NGINX Agent package using the yum package manager, which is common on RHEL, CentOS, Rocky Linux, AlmaLinux, and Oracle Linux distributions. It requires root privileges to execute. This removes the installed nginx-agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/uninstall.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum remove nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Instance Manager Services (bash)\nDESCRIPTION: These commands restart the `nms-ingestion` and `nms-core` services on the NGINX Instance Manager control plane. Restarting these services applies the updated attack signature database. Requires `sudo` privileges and systemctl to manage the services.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/update-signatures.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nms-ingestion\nsudo systemctl restart nms-core\n```\n\n----------------------------------------\n\nTITLE: Applying Terraform Configuration\nDESCRIPTION: This command applies the changes required to reach the desired state defined in your Terraform configuration. The `--auto-approve` flag bypasses the interactive approval prompt, automatically confirming the changes. Use with caution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/create-deployment/deploy-terraform.md#_snippet_2\n\nLANGUAGE: Bash\nCODE:\n```\nterraform apply --auto-approve\n```\n\n----------------------------------------\n\nTITLE: Enabling Server Side TLS with CLI Flags - Bash\nDESCRIPTION: This snippet demonstrates how to enable server-side TLS for the NGINX Agent using a command-line flag. The `--tls-enable` flag enables TLS without specifying certificate or key files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/encrypt-communication.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nnginx-agent --tls-enable\n```\n\n----------------------------------------\n\nTITLE: TCP Server Configuration with Proxy Pass\nDESCRIPTION: Configures a TCP server that listens on port 12345 and forwards connections to the `stream_backend` upstream group. The `proxy_pass` directive specifies the upstream group to which connections should be proxied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    server {\n        listen     12345;\n        proxy_pass stream_backend;\n    }\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Disable Default Nginx Web Server\nDESCRIPTION: These commands disable the default web server configuration in Nginx. The first command renames the `default.conf` file, and the second command restarts the Nginx service to apply the changes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/ha-data-plane.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.bak\nsudo systemctl restart nginx.service\n```\n\n----------------------------------------\n\nTITLE: Enable Nginx Plus API\nDESCRIPTION: This configuration enables the Nginx Plus API endpoint. It allows access only from localhost (127.0.0.1) for security purposes, enabling metric collection for Nginx Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/getting-started.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\n# Enable the /api/ location with appropriate access control\n# to use the NGINX Plus API.\n#\nlocation /api/ {\n    api write=on;\n    allow 127.0.0.1;\n    deny all;\n}\n```\n\n----------------------------------------\n\nTITLE: Verifying Nginx Plus Version\nDESCRIPTION: This command is used to verify that the latest version of Nginx Plus is installed on the EC2 machine. It compares the installed version with the latest release available on the Nginx website. Requires the `nginx` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nnginx -v\n```\n\n----------------------------------------\n\nTITLE: List Directory Contents - Bash\nDESCRIPTION: This command lists the contents of the `/var/lib/kubelet/pki` directory. This is used to verify that a new PEM file is written and that the symbolic link points to the new PEM.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\ncd /var/lib/kubelet/pki; ls -l\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX App Protect WAF v5 - Shell\nDESCRIPTION: Installs the NGINX App Protect WAF v5 package using the dnf package manager. The sudo command is used to execute the installation with administrative privileges. This installs the app-protect-module-plus package, which provides the WAF functionality.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-amazon.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf install app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: List Mesh-Associated Resources (kubectl)\nDESCRIPTION: This command lists all Kubernetes resources associated with NGINX Service Mesh in the cluster. It uses `kubectl api-resources` and `kubectl get` to find resources labeled with `app.kubernetes.io/part-of=nginx-service-mesh`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/uninstall/uninstall.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nkubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get --show-kind --ignore-not-found -l app.kubernetes.io/part-of=nginx-service-mesh -A\n```\n\n----------------------------------------\n\nTITLE: Port Forward Grafana Service\nDESCRIPTION: This `kubectl` command port-forwards the Grafana service to allow access from the local machine. Replace `<grafana-namespace>` with the namespace where Grafana is deployed, allowing you to access Grafana at localhost:3000.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\nkubectl port-forward -n <grafana-namespace> svc/grafana 3000\n```\n\n----------------------------------------\n\nTITLE: Upload Chef Cookbooks using Knife\nDESCRIPTION: This command uploads all cookbooks from the specified directory to the Chef server. It ensures that the Chef server has access to the necessary recipes for configuring the nodes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nroot@chef-server:~/chef-zero/playground/cookbooks# knife cookbook upload *\n```\n\n----------------------------------------\n\nTITLE: Install yum-utils and add ClickHouse repository (CentOS, RHEL)\nDESCRIPTION: Installs yum-utils and adds the ClickHouse repository to the yum configuration. This allows the system to download and install ClickHouse packages from the specified repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum install -y yum-utils\nsudo yum-config-manager --add-repo https://packages.clickhouse.com/rpm/clickhouse.repo\n```\n\n----------------------------------------\n\nTITLE: Autoindex Configuration in Nginx\nDESCRIPTION: This snippet shows how to enable automatic directory listing using the `autoindex` directive. When a request ends with a slash and no index file is found, NGINX will generate a directory listing if `autoindex` is enabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /images/ {\n    autoindex on;\n}\n```\n\n----------------------------------------\n\nTITLE: Create certificate bundle on SLES\nDESCRIPTION: This command concatenates the client certificate and key into a single file, nginx-repo-bundle.crt. This bundle is then used for authenticating to the NGINX Plus repository on SLES.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_17\n\nLANGUAGE: Shell\nCODE:\n```\ncat /etc/ssl/nginx/nginx-repo.crt /etc/ssl/nginx/nginx-repo.key > /etc/ssl/nginx/nginx-repo-bundle.crt\n```\n\n----------------------------------------\n\nTITLE: Copying Kubernetes Backup Script (cp)\nDESCRIPTION: This command copies the `k8s-backup.sh` script from the extracted Helm chart directory to the current working directory. Replace `nms-<version>` with the actual extracted chart directory name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\ncp nms-<version>/charts/nms-hybrid/backup-restore/k8s-backup.sh .\n```\n\n----------------------------------------\n\nTITLE: Extract Installer Package - Bash\nDESCRIPTION: This command extracts the NGINX Controller installer package. This is a prerequisite step before updating NGINX Controller on a cluster node. The extracted files contain the necessary scripts and binaries for the update process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/resilient-cluster-aws.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ntar xzf controller-installer-<version>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Remove NGINX Service Mesh without confirmation\nDESCRIPTION: This command removes the NGINX Service Mesh without prompting the user for confirmation, using the -y or --yes flag.  This is useful for automation but should be used with caution to prevent accidental removal of the mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl remove -y\n```\n\n----------------------------------------\n\nTITLE: Deploy Disallowed Driver\nDESCRIPTION: This command deploys a second driver workload that will initially send unfiltered traffic, which will then be restricted using access control policies. The driver's configuration is defined in driver-disallowed.yaml.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f driver-disallowed.yaml\n```\n\n----------------------------------------\n\nTITLE: Install Nginx njs Module on Debian/Ubuntu\nDESCRIPTION: This command installs the NGINX JavaScript module (njs) for Debian and Ubuntu operating systems. It requires root privileges and uses the apt package manager to install the nginx-plus-module-njs package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/cognito.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nsudo apt install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Enable Automatic Sidecar Injection - Bash\nDESCRIPTION: This command adds a label to a Kubernetes namespace to enable automatic sidecar injection for all Pods within that namespace. The `<namespace name>` placeholder should be replaced with the actual namespace name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/inject-sidecar-proxy.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubectl label namespaces <namespace name> injector.nsm.nginx.com/auto-inject=enabled\n```\n\n----------------------------------------\n\nTITLE: Install NGINX App Protect Module\nDESCRIPTION: This snippet installs the NGINX App Protect WAF v5 package using the yum package manager. It requires sudo privileges and prompts the user to verify and accept the GPG key. The module is named `app-protect-module-oss`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-centos.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Test Demo Application\nDESCRIPTION: This command uses curl to test the demo web application.  It sends an HTTP request to localhost:8085 and displays the response headers and body.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_8\n\nLANGUAGE: none\nCODE:\n```\n$ curl -D - http://localhost:8085\nHTTP/1.1 200 OK\nServer: nginx/1.17.10\nDate: Wed, 6 May 2020 08:55:29 GMT\nContent-Type: text/plain\nContent-Length: 27\nConnection: keep-alive\n\nThank you for requesting /\n```\n\n----------------------------------------\n\nTITLE: Copy Backup File (Bash)\nDESCRIPTION: This command copies a specific backup file from the mounted NFS share (`/mnt/local_pgdata/`) to the `local_backups/` directory.  `sudo` is required to perform this operation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-embedded-config-db.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsudo cp /mnt/local_pgdata/backup_<timestamp>.tar local_backups/\n```\n\n----------------------------------------\n\nTITLE: Configuring Error Message Passthrough\nDESCRIPTION: This snippet demonstrates how to enable the `proxy_pass_error_message` directive to inform users about errors from the authentication server, such as a mailbox running out of memory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nmail {\n        server_name mail.example.com;\n        auth_http   localhost:9000/cgi-bin/nginxauth.cgi;\n\n        proxy_pass_error_message on;\n        #...\n    }\n```\n\n----------------------------------------\n\nTITLE: Base64 Encode JSON Policy (Shell)\nDESCRIPTION: This command uses `base64` to encode a JSON policy file. The encoded output will be used in the subsequent steps to upload a custom security policy to NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\nbase64 -i ./ignore-xss-policy-example.json\n```\n\n----------------------------------------\n\nTITLE: Setting ownership for NGINX App Protect WAF directories\nDESCRIPTION: This snippet sets the correct ownership for the NGINX App Protect WAF directories to ensure proper permissions for the services.  The directories are recursively owned by user and group ID 101:101, which are the default UID/GID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_38\n\nLANGUAGE: shell\nCODE:\n```\nsudo chown -R 101:101 /opt/app_protect/\n```\n\n----------------------------------------\n\nTITLE: Check NGINX is running\nDESCRIPTION: This command checks if NGINX is running by listing all processes and filtering for those containing 'nginx'. It uses the `ps aux` command to list all running processes and pipes the output to `grep nginx` to filter for lines containing 'nginx'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nps aux | grep nginx\n```\n\n----------------------------------------\n\nTITLE: Configure SSH access to peers - Verify SSH access\nDESCRIPTION: This command verifies that the root user can ssh to each of the other nodes without providing a password. Replace node2.example.com with the actual hostname of a peer node.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nsudo ssh root@node2.example.com <hostname>\n```\n\n----------------------------------------\n\nTITLE: Creating Kubernetes Secret from JWT file\nDESCRIPTION: This command creates a Kubernetes Secret named `nplus-license` in the `nginx-gateway` namespace. It reads the JWT from the `license.jwt` file and stores it in the secret. Requires kubectl to be installed and configured to connect to the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/nginx-plus/nginx-plus-secret.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl create secret generic nplus-license --from-file license.jwt -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Upload usage acknowledgment to NGINX Instance Manager - REST API (curl)\nDESCRIPTION: This `curl` command uploads the usage acknowledgment to NGINX Instance Manager. It uses the `--form` option for file upload and requires basic authentication with base64 encoded credentials. The `-k` flag skips SSL certificate verification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\ncurl -k --location 'https://<NIM-FQDN>/api/platform/v1/report/upload' \\\n--header 'Authorization: Basic <base64-encoded-credentials>' \\\n--form 'file=@\"<path-to-acknowledgement>.zip\"'\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration\nDESCRIPTION: This command reloads the Nginx configuration without interrupting existing connections. It's necessary after making changes to the Nginx configuration files to apply the new settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/infrastructure/enable-create-credentials.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Installing HTTP Substitutions Filter on FreeBSD\nDESCRIPTION: This shell command updates the package repositories and installs the `nginx-plus-module-subs-filter` package using the `pkg` package manager. This is for FreeBSD. It requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/http-substitutions-filter.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-subs-filter\n```\n\n----------------------------------------\n\nTITLE: Extracting Status Link ID using jq\nDESCRIPTION: Extracts the status link ID from the JSON response using `jq`. It splits the `statusLink` string by `/` and retrieves the last element, storing it in the `$status_link` variable.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nstatus_link=$(jq -r '.statusLink | split(\"/\") | last' <<< \"$response\")\n```\n\n----------------------------------------\n\nTITLE: YAML: Configure Automatic Updates\nDESCRIPTION: This YAML snippet shows the `app_protect_security_update` settings within the `/etc/nms/nms.conf` file to enable automatic download of attack signatures and threat campaigns. It specifies the update interval and the number of updates to download.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_3\n\nLANGUAGE: YAML\nCODE:\n```\nintegrations:\n  # enable this for integrations on tcp\n  # address: 127.0.0.1:8037\n  address: unix:/var/run/nms/integrations.sock\n  dqlite:\n    addr: 127.0.0.1:7892\n  app_protect_security_update:\n    # enable this to automatically retrieve the latest Attack Signatures and Threat Campaigns\n    enable: true\n    # how often, in hours, to check for updates; default is 6\n    interval: 6\n    # how many updates to download; default is 10, max is 20\n    number_of_updates: 10\n```\n\n----------------------------------------\n\nTITLE: Upgrade ClickHouse on RPM-based systems\nDESCRIPTION: This command upgrades ClickHouse server and client to the latest version using the yum package manager on CentOS, RHEL, and other RPM-based systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum update -y clickhouse-server clickhouse-client\n```\n\n----------------------------------------\n\nTITLE: API Response for Grouped Metrics\nDESCRIPTION: This JSON snippet shows the API response format when grouping metrics by `nginx_id`.  It includes the aggregated value for each `nginx_id` along with timestamps.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_13\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"metrics\":[\n      {\n         \"aggr\": \"SUM\",\n         \"name\":\"nginx.http.request.count\",\n         \"series\":[\n            {\n               \"dimensions\":{\n                  \"nginx_id\":\"nginx-id-1\",\n               },\n               \"timestamps\":[\n                  \"2020-12-13T12:00:00Z\"\n               ],\n               \"values\":[\n                  1000\n               ]\n            },\n            {\n               \"dimensions\":{\n                  \"nginx_id\":\"nginx-id-2\",\n               },\n               \"timestamps\":[\n                  \"2020-12-13T12:00:00Z\"\n               ],\n               \"values\":[\n                  2000\n               ]\n            }\n         ]\n      }\n   ]\n}\n```\n\n----------------------------------------\n\nTITLE: Uncommenting Keycloak Sections in openid_configuration.conf\nDESCRIPTION: This snippet shows the YAML configuration to uncomment in `/tmp/openid_configuration.conf` when using OIDC with Keycloak. It defines mappings for group claims and user email using JWT claims.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\n# Enable when using OIDC with keycloak\nmap $http_authorization $groups_claim {\n    default $jwt_claim_groups;\n}\n\n\nmap $http_authorization $user_email {\n    \"~^Bearer.*\" '$jwt_clientId@$oidc_domain';\n    default $jwt_claim_email;\n}\n```\n\n----------------------------------------\n\nTITLE: Installing Prometheus Module on Debian and Ubuntu\nDESCRIPTION: This command installs the nginx-plus-module-prometheus package using the apt package manager. It is used for Debian and Ubuntu-based systems. The command requires sudo privileges to install software packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt install nginx-plus-module-prometheus\n```\n\n----------------------------------------\n\nTITLE: Parsed JSON for customLogAttributes\nDESCRIPTION: This JSON snippet illustrates how the key/value pairs defined using the `app_protect_custom_log_attribute` directive are parsed.  The 'name' field corresponds to the key, and the 'value' field corresponds to the value.  These attributes would then be used for custom logging within the App Protect module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/custom-log-configuration.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"customLogAttributes\": [\n        {\n            \"name\": \"gateway\",\n            \"value\": \"gway1\"\n        },\n        {\n            \"name\": \"component\",\n            \"value\": \"comp1\"\n        }\n    ]\n}\n```\n\n----------------------------------------\n\nTITLE: Install Prerequisite Packages (RHEL - Shell)\nDESCRIPTION: This snippet installs the prerequisite packages `ca-certificates` and `wget` using the `yum` package manager. These packages are necessary for verifying SSL certificates and downloading files from the internet respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install ca-certificates wget\n```\n\n----------------------------------------\n\nTITLE: Add Log Format Policy via REST API\nDESCRIPTION: This JSON snippet configures the log format policy for an NGINX environment through the ACM REST API.  It sets the error log severity, log file locations, and specifies which information to include in the logs. The `enablePrettyPrint` setting controls JSON log readability.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/log-format.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"policies\": {\n    \"log-format\": [\n      {\n        \"action\": {\n          \"enablePrettyPrint\": false,\n          \"errorLogSeverity\": \"WARN\",\n          \"logDestination\": {\n            \"type\": \"FILE\",\n            \"accessLogFileLocation\": \"/var/log/nginx/\",\n            \"errorLogFileLocation\": \"/var/log/nginx/\"\n          },\n          \"logFormat\": {\n            \"include\": [\n              \"BASIC\",\n              \"INGRESS\",\n              \"BACKEND\",\n              \"RESPONSE\"\n            ],\n            \"variables\": []\n          },\n          \"type\": \"JSON\"\n        }\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: OpenSSL MD5 Hash Normal Operation (Shell)\nDESCRIPTION: This command shows the output of OpenSSL computing an MD5 hash when NOT running in FIPS mode.  This demonstrates that MD5 functions normally when FIPS mode is not enabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/fips-compliance-nginx-plus.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nopenssl md5 /dev/null\nMD5(/dev/null)= d41d8cd98f00b204e9800998ecf8427e\n```\n\n----------------------------------------\n\nTITLE: Tagging Docker Images\nDESCRIPTION: These shell commands tag existing Docker images with a new name and tag, suitable for pushing to a private registry.  This step prepares the images to be pushed to the private registry after logging in.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/devportal-helm-chart.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\ndocker tag nginx-devportal-apigw:<version> <my-docker-registry>/nginx-devportal-apigw:<version>\ndocker tag nginx-devportal-api:<version> <my-docker-registry>/nginx-devportal-api:<version>\n```\n\n----------------------------------------\n\nTITLE: Allow HTTPD to Connect to the Network\nDESCRIPTION: Allows the HTTPD process (often used by NGINX Agent) to make network connections. This is necessary for NGINX Agent to communicate with external services.  Requires `setsebool` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-selinux.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo setsebool -P httpd_can_network_connect 1\n```\n\n----------------------------------------\n\nTITLE: Removing Instance from Config Sync Group\nDESCRIPTION: Removes an NGINX instance from a config sync group by commenting out or deleting the `instance_group` line in the `agent-dynamic.conf` file and restarting the NGINX Agent. This action disassociates the instance from the config sync group, preventing it from receiving the group's configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/nginx-configs/manage-config-sync-groups.md#_snippet_4\n\nLANGUAGE: text\nCODE:\n```\n# instance_group: <config_sync_group>\n```\n\n----------------------------------------\n\nTITLE: Terraform Plan Output - NGINX Configuration Change\nDESCRIPTION: This snippet displays a Terraform plan showing the change in the NGINX configuration file content. It highlights the transition from an old configuration to a new one, where the content is base64 encoded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configurations-terraform.md#_snippet_1\n\nLANGUAGE: terraform\nCODE:\n```\n$ terraform plan\n...\n- config_file {\n    - content      = \"aHR0cCB7CiAgICBzZXJ2ZXIgewogICAgICAgIGxvY2F0aW9uIC8gewogICAgICAgICAgICByZXR1cm4gMjAwICJIZWxsbyI7CiAgICAgICAgfQogICAgfQoK\" -> null\n    - virtual_path = \"nginx.conf\" -> null\n  }\n+ config_file {\n    + content      = \"aHR0cCB7CiAgICBzZXJ2ZXIgewogICAgICAgIGxvY2F0aW9uIC8gewogICAgICAgICAgICByZXR1cm4gMjAwICJIZWxsbyBXb3JsZCEiOwogICAgICAgIH0KICAgIH0KfQoK\"\n    + virtual_path = \"nginx.conf\"\n  }\n...\n```\n\n----------------------------------------\n\nTITLE: Updating and Installing Packages on Ubuntu (Shell)\nDESCRIPTION: This command updates the package repositories and installs the necessary packages (apt-transport-https, lsb-release, ca-certificates, wget, gnupg2, ubuntu-keyring) on Ubuntu systems. These packages are required for accessing HTTPS repositories and managing packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update  && \\\nsudo apt install apt-transport-https \\\n                     lsb-release \\\n                     ca-certificates \\\n                     wget \\\n                     gnupg2 \\\n                     ubuntu-keyring\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Instance Manager with nms.conf (YAML)\nDESCRIPTION: This YAML configuration file (nms.conf) is used to configure NGINX Instance Manager. It defines various settings for the NMS user, daemon, logging, modules, core, DPM (Deployment Proxy Manager), integrations, ingestion, and ClickHouse.  It configures database connections, log levels, and other parameters necessary for the proper functioning of NGINX Instance Manager components. The file specifies addresses, paths, timeouts, and other configurable settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-with-config.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\n# This is the default /etc/nms/nms.conf file distributed with Linux packages.\n\nuser: nms\ndaemon: true\n# Root dqlite db directory. Each subdirectory here is dedicated to the process\ndb_root_dir: /var/lib/nms/dqlite\n\n# Default log level for all processes. Each process can override this level.\nlog:\n  encoding: console\n  level: error\n\nmodules:\n  prefix: /var/lib/nms\n  # NMS modules config are available here to be read if installed\n  conf_dir: /etc/nms/modules\n\ncore:\n  # Enable this for core on TCP\n  # address: 127.0.0.1:8033\n  address: unix:/var/run/nms/core.sock\n  grpc_addr: unix:/var/run/nms/coregrpc.sock\n  analytics:\n    # Catalogs config\n    catalogs:\n      metrics_data_dir: /usr/share/nms/catalogs/metrics\n      events_data_dir: /usr/share/nms/catalogs/events\n      dimensions_data_dir: /usr/share/nms/catalogs/dimensions\n  # Dqlite config\n  dqlite:\n    addr: 127.0.0.1:7891\n  # Disable this to prevent automatic cleanup on a module removal of its RBAC features and permissions\n  disable_rbac_cleanup: false\n\ndpm:\n  # Enable this for dpm on TCP\n  # address: 127.0.0.1:8034\n  address: unix:/var/run/nms/dpm.sock\n  # Enable this for dpm gRPC server on TCP\n  # grpc_addr: 127.0.0.1:8036\n  grpc_addr: unix:/var/run/nms/am.sock\n  # Dqlite config\n  dqlite:\n    addr: 127.0.0.1:7890\n  # WATCHDOG configurations\n  # Enable this setting to specify how often, in seconds, messages are sent to the watchdog.\n  # The default interval is 2 seconds\n  reporting_period: 2s\n  # Enable this setting to specify how often, in seconds, the system checks in with the watchdog timer to reset.\n  # The default interval is 5 seconds\n  check_period: 5s\n  # Enable this setting to specify the maximum allowable time for the system to operate without resetting the watchdog.\n  # The default interval is 30 seconds\n  threshold_duration: 30s\n  # Enable this setting to specify how often, in seconds, performance statistics are collected and analyzed by the watchdog.\n  # The default interval is 30 seconds\n  stats_period: 30s\n  # Enable this setting to specify the maximum amount of time allowed for a deployment process to complete.\n  # The default interval is 10 minutes\n  deployment_timeout: 10m\n  # NATS config\n  nats:\n    address: nats://127.0.0.1:9100\n    # NATS streaming\n    store_root_dir: /var/lib/nms/streaming\n    # 10GB\n    max_store_bytes: 10737418240\n    # 1GB\n    max_memory_bytes: 1073741824\n    # https://docs.nats.io/reference/faq#is-there-a-message-size-limitation-in-nats\n    # 8MB\n    max_message_bytes: 8388608\n  # ClickHouse schema migration check interval\n  clickhouse_migration_interval: 100s\n  # Enable this setting to specify how often, in hours, offline agents are pruned from the system\n  # The default interval is 72 hours\n  agent_prune_duration: 72h\n  # Enable this setting to specify how often, in hours, offline container agents are pruned from the system\n  # The default interval is 12 hours\n  agent_container_prune_duration: 12h\n\nintegrations:\n  # Enable this for integrations on TCP\n  # address: 127.0.0.1:8037\n  address: unix:/var/run/nms/integrations.sock\n  # Dqlite config\n  dqlite:\n    addr: 127.0.0.1:7892\n  app_protect_security_update:\n    # Enable this setting to automatically retrieve the latest Attack Signatures and Threat Campaigns.\n    enable: true\n    # Enable this setting to specify how often, in hours, the latest Attack Signatures and Threat Campaigns are retrieved.\n    # The default interval is 6 hours, the maximum interval is 48 hours, and the minimum is 1 hour.\n    interval: 6\n    # Enable this setting to specify how many updates to download for the latest Attack Signatures and Threat Campaigns.\n    # By default, the 10 latest updates are downloaded. The maximum value is 20, and the minimum value is 1.\n    number_of_updates: 10\n  policy_manager:\n    # Time to live for attack signatures. If the attack signatures exceed their TTL and are not deployed to an instance or\n    # instance group, they will be deleted from the database. Duration unit can be seconds (s), minutes (m), or hours (h).\n    attack_signatures_ttl: 336h\n    # Time to live for compiled bundles, this includes compiled security policies and compiled log profiles. If a compiled\n    # bundle exceeds its TTL and is not deployed to an instance or instance group, it will be deleted from the database. Note\n    # that the compiled bundle is deleted, not the definition of it (i.e., the security policy or log profile definition).\n    # Duration unit can be seconds (s), minutes (m), or hours (h).\n    compiled_bundles_ttl: 336h\n    # Time to live for threat campaigns. If the threat campaigns exceed their TTL and are not deployed to an instance or\n    # instance group, they will be deleted from the database. Duration unit can be seconds (s), minutes (m), or hours (h).\n    threat_campaigns_ttl: 1440h\n  license:\n    db:\n      addr: 127.0.0.1:7893\n\ningestion:\n  # Enable this for ingestion gRPC server on TCP\n  # grpc_addr: 127.0.0.1:8035\n  grpc_addr: unix:/var/run/nms/ingestion.sock\n  # Parameters for ingesting metrics and events\n  sink:\n    # All limits are inclusive on both ends of the bound.\n    # Buffer_size limits: 2,000 - 1,000,000\n    buffer_size: 20000\n    buffer_flush_interval: 1m\n    buffer_check_interval: 1s\n    # Insert_connection_retries limits: -1 - 10\n    insert_connection_retries: -1\n    insert_connection_retry_interval: 5s\n    # Insert_timeout_retries limits: 2 - 10\n    insert_timeout_retries: 3\n    insert_timeout_retry_interval: 30s\n    transaction_timeout: 30s\n    # Concurrent_transactions limits: 2 - 20\n    concurrent_transactions: 10\n\n# ClickHouse config for establishing a ClickHouse connection\nclickhouse:\n  # Below address not used if TLS mode is enabled\n  address: 127.0.0.1:9000\n  # Ensure username and password are wrapped in quotes\n  # The default ClickHouse username on install is empty. If you've set up a custom user, set the username here\n  username: \"\"\n  # The default ClickHouse password on install is empty. If you've set a custom password, set the password here\n  password: \"\"\n  # The TTL configurations below define how long data for features will be retained in ClickHouse\n  # The default values can be updated for a custom retention period. Restart nms-dpm to apply any modifications to TTL\n  ttl_configs:\n    - feature: metrics\n      ttl: 32 # number of days\n    - feature: events\n      ttl: 120 # number of days\n    - feature: securityevents\n      ttl: 32 # number of days\n#   # Enable TLS configurations for ClickHouse connections\n#   tls:\n#     # Address pointing to <tcp_port_secure> of ClickHouse\n#     # Below CH address is used when TLS mode is active\n#     tls_address: 127.0.0.1:9440\n#     # Verification should be skipped for self-signed certificates\n#     skip_verify: true\n#     key_path\n```\n\n----------------------------------------\n\nTITLE: SSH to NGINX Instance (Bash)\nDESCRIPTION: Connects to the NGINX instance using SSH. This command requires the user's credentials and the NGINX instance's address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configure-nginx-agent-features.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nssh user@your-nginx-instance\n```\n\n----------------------------------------\n\nTITLE: Manage NGINX Controller Service (Bash)\nDESCRIPTION: These commands use the `helper.sh` script to manage the NGINX Controller service.  The `controller` subcommand takes arguments like `start`, `stop`, `restart`, and `status` to control the service.  No specific dependencies are required other than the `helper.sh` script being present.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh controller start\n/opt/nginx-controller/helper.sh controller stop\n/opt/nginx-controller/helper.sh controller restart\n/opt/nginx-controller/helper.sh controller status\n```\n\n----------------------------------------\n\nTITLE: Security Log Configuration JSON Example\nDESCRIPTION: This snippet provides an example of a security log configuration file in JSON format for NGINX App Protect DoS. The configuration defines filters for traffic mitigation statistics, bad actors, and attack signatures, specifying whether to log all, none, or the top N events for each category.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/security-log.md#_snippet_8\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filter\": {\n        \"traffic-mitigation-stats\": \"all\",\n        \"bad-actors\": \"top 100\",\n        \"attack-signatures\": \"top 100\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Get Kubernetes Network Policies\nDESCRIPTION: This command retrieves the Kubernetes network policies in the `nms` namespace. It is used to verify that the network policies have been created and configured as expected, controlling network traffic to and from the NGINX Instance Manager pods.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get netpol -n nms\n```\n\n----------------------------------------\n\nTITLE: Install Yum Dependencies (Shell)\nDESCRIPTION: Installs the required dependencies using the `yum` package manager. `ca-certificates` are needed for SSL certificate verification, and `wget` is required for downloading the repository configuration file.  The command uses `sudo` to gain the required privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-rhel-cen-74.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install ca-certificates wget\n```\n\n----------------------------------------\n\nTITLE: Inject Resources with ignored incoming port\nDESCRIPTION: This command injects resources from stdin using nginx-meshctl, configuring the proxies to ignore incoming traffic on port 1433. The --ignore-incoming-ports flag specifies the port to be ignored. Input is taken from the my-app.json file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl inject --ignore-incoming-ports 1433 < ./my-app.json\n```\n\n----------------------------------------\n\nTITLE: Upgrading NGINX Gateway Fabric from Source\nDESCRIPTION: This command upgrades NGINX Gateway Fabric from local source code using Helm, in the 'nginx-gateway' namespace. Requires Helm 3.0+, kubectl, and local access to the Helm chart.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nhelm upgrade ngf . -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Rebooting the system\nDESCRIPTION: This command reboots the system to apply the changes and ensure the updated configurations are loaded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_18\n\nLANGUAGE: bash\nCODE:\n```\nsudo shutdown now -r\n```\n\n----------------------------------------\n\nTITLE: Using curl to view API endpoints\nDESCRIPTION: This command uses `curl` to make a GET request to the API endpoint and retrieves a list of available endpoints in JSON format. The `json_pp` tool is used to pretty-print the JSON output for readability.  Requires `json_pp` to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/live-activity-monitoring.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ncurl -s 'http://192.168.1.23/api/dos/1/' | json_pp\n```\n\n----------------------------------------\n\nTITLE: Check Keepalived Status\nDESCRIPTION: This snippet checks the status of the `keepalived` service using `systemctl`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nsystemctl status keepalived\n```\n\n----------------------------------------\n\nTITLE: Deploying NGINX Service Mesh without persistent storage\nDESCRIPTION: This command deploys NGINX Service Mesh, disabling persistent storage. This is useful if persistent storage is not configured in the Kubernetes or OpenShift cluster. The user must have kubectl configured and connected to a cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy --persistent-storage off\n```\n\n----------------------------------------\n\nTITLE: Referencing JSON data file with cURL\nDESCRIPTION: This command demonstrates how to reference a JSON data file instead of including the string directly in a cURL request, to avoid variable expansion issues. It redefines the `$host` variable to itself to allow it to pass to the NGINX configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-snippets.md#_snippet_0\n\nLANGUAGE: None\nCODE:\n```\nhost='$host' curl -s -k -H \"Content-Type: application/json\" -X PUT -d \"<data>\" https://192.168.100.10:80/\n```\n\n----------------------------------------\n\nTITLE: Downloading Acknowledgement File from F5 Licensing Endpoint\nDESCRIPTION: Downloads the acknowledgement file from F5's licensing endpoint using `curl`. It uses the `$bearer_token` and `$report_save_path` variables.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\ndownload_command=\"curl --location 'https://product.apis.f5.com/ee/v1/entitlements/telemetry/bulk/download/$download_link' \\\n        --header 'Authorization: Bearer $bearer_token' \\\n        --output '$report_save_path'\"\n```\n\nLANGUAGE: shell\nCODE:\n```\ncurl --location \"https://product.apis.f5.com/ee/v1/entitlements/telemetry/bulk/download/$download_link\" \\\n--header \"Authorization: Bearer $bearer_token\" \\\n--output \"$report_save_path\"\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX App Protect WAF Package - Shell\nDESCRIPTION: This shell command installs the NGINX App Protect WAF v5 package (`app-protect-module-plus`) using the `apk` package manager.  It requires `sudo` to execute with elevated privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-alpine.md#_snippet_2\n\nLANGUAGE: Shell\nCODE:\n```\nsudo apk add app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Download External Dependencies Script - Bash\nDESCRIPTION: Downloads external dependencies for NGINX Instance Manager using a shell script. The script takes the Linux distribution as an argument (e.g., ubuntu20.04, rhel8) and creates an archive containing the required dependencies. The user must have sudo privileges to execute the script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide-deprecated.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo bash fetch-external-dependencies.sh <linux distribution>\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX web server using systemctl\nDESCRIPTION: This command restarts the NGINX web server using systemctl, a system and service manager for Linux operating systems. This ensures that any configuration changes are applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/release-notes.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Helm Install Chart\nDESCRIPTION: Installs the NGINX App Protect Helm chart with a specified release name. Replace `<release-name>` with the desired name for the Helm release.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-helm.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nhelm install <release-name> .\n```\n\n----------------------------------------\n\nTITLE: Create Agent Dynamic Configuration - Linux\nDESCRIPTION: This command creates the `agent-dynamic.conf` file in Linux environments, which is required for NGINX Agent to run. It requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/getting-started.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo touch /var/lib/nginx-agent/agent-dynamic.conf\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent with Instance Group using curl\nDESCRIPTION: This snippet explains how to install NGINX Agent and add it to a specific instance group using the `--instance-group` flag with curl. It downloads, makes executable, and runs install.sh\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/agent/installation/install-agent-api.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://<NIM_FQDN>/install/nginx-agent -o install.sh\nchmod u+x install.sh\nsudo ./install.sh --instance-group <instance group>\n```\n\n----------------------------------------\n\nTITLE: Deploying NGINX Service Mesh on OpenShift\nDESCRIPTION: This command deploys NGINX Service Mesh to an OpenShift cluster.  The `--environment openshift` flag is required for proper installation on OpenShift. The user must have kubectl configured and connected to the OpenShift cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy --environment openshift\n```\n\n----------------------------------------\n\nTITLE: Show IP Address of Interface\nDESCRIPTION: This command displays the IP address configuration of the specified network interface (eth1).  It's used to verify that the virtual IP address has been correctly assigned to the interface after Chef configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_10\n\nLANGUAGE: text\nCODE:\n```\nusername@chef-test-1:~$ ip addr show eth1\n```\n\n----------------------------------------\n\nTITLE: Extract NGINX Controller Installer\nDESCRIPTION: Extracts the NGINX Controller installer package from a gzipped tar archive.  This command is essential to unpack the installation files required for the subsequent installation process. Requires `tar` utility.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller-app-sec.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ntar xzf controller-installer-<version>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Run NGINX Controller Prereqs Helper Script - Bash\nDESCRIPTION: This command runs the `helper.sh` script with the `prereqs` option to install the required system packages and Docker CE. It automates the process of setting up the environment before installing NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./helper.sh prereqs\n```\n\n----------------------------------------\n\nTITLE: Configuring Health Check Port in Nginx Plus\nDESCRIPTION: This snippet configures the health check port to 8080 for the `backend` upstream group. The `health_check port=8080` directive in the `location /` block tells NGINX Plus to send health check requests to port 8080 on the servers in the `backend` group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-health-check.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    location / {\n        proxy_pass   http://backend;\n        health_check port=8080;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Makefile Target: Hugo Update\nDESCRIPTION: This command updates the Hugo theme to the latest version, ensuring that the documentation is built with the most recent changes to the theme. It uses the `make` command to execute the `hugo-update` target defined in the Makefile.\nSOURCE: https://github.com/nginx/documentation/blob/main/CONTRIBUTING_DOCS.md#_snippet_0\n\nLANGUAGE: Makefile\nCODE:\n```\n`make hugo-update`\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX ModSecurity WAF on Amazon Linux 2023\nDESCRIPTION: This snippet shows how to install the NGINX ModSecurity WAF module package on Amazon Linux 2023 using the `dnf` package manager. It first updates the package list and then installs the specified module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginx-waf.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-modsecurity\n```\n\n----------------------------------------\n\nTITLE: Get Network Security Profile Resource ID - Azure CLI\nDESCRIPTION: This snippet retrieves the resource ID of a network security profile using the Azure CLI. Requires `PROFILE_NAME`, `NSP_RESOURCE_GROUP`, and `NSP_NAME` environment variables.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nnsp_profile_id=$(az network perimeter profile show --name $PROFILE_NAME \\\n      --resource-group $NSP_RESOURCE_GROUP \\\n      --perimeter-name $NSP_NAME --query id --output tsv)\n```\n\n----------------------------------------\n\nTITLE: Extract Kubernetes Support Package (Bash)\nDESCRIPTION: This command extracts the generated Kubernetes support package, allowing access to the collected system and service information.  The package is named `k8s-support-pkg-<timestamp>.tar.gz`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/support/k8s-support-package.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ntar -xvf k8s-support-pkg-<timestamp>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Stream Upstream Fail and Unavailable Counts\nDESCRIPTION: Describes the 'plus.stream.upstream.fails.count' and 'plus.stream.upstream.unavail.count' metrics, tracking unsuccessful attempts to communicate with upstream servers, and server unavailability for client requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_30\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Number of unsuccessful attempts to communicate with upstream servers, and\n               how many times upstream servers became unavailable for client requests.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Secret Creation for Nginx Instance Manager CA certificate\nDESCRIPTION: Creates a Kubernetes secret named `nim-ca` in the `nginx-gateway` namespace from a CA certificate file. This secret is used for configuring NGINX Plus to report usage to NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/nginx-plus-jwt.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n nginx-gateway create secret generic nim-ca --from-file ca.crt\n```\n\n----------------------------------------\n\nTITLE: Logging into Docker Registry with JSON Web Token\nDESCRIPTION: This command logs into the Docker registry using a JSON Web Token (JWT) obtained from MyF5. The username is set to the content of the JWT, and the password is set to 'none'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ndocker login private-registry.nginx.com --username=<output_of_jwt_token> --password=none\n```\n\n----------------------------------------\n\nTITLE: Stream Upstream Health Check Metrics\nDESCRIPTION: Describes the 'plus.stream.upstream.health.checks', 'plus.stream.upstream.health.fails', and 'plus.stream.upstream.health.unhealthy' metrics. These are counters for performed health check requests, failed health checks, and unhealthy counts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_31\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Number of performed health check requests, failed health checks, and\n               how many times the upstream servers became unhealthy.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Installing Nginx App Protect on Amazon Linux 2\nDESCRIPTION: These commands install the NGINX App Protect module using yum and apt-get. The apt-get command includes the nginx version and lsb_release to be compatible with debian based systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install app-protect-module-oss\nsudo apt-get install nginx=1.25.5-1~`lsb_release -cs` app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Creating Client SSL/TLS Profile on BIG-IP LTM\nDESCRIPTION: This snippet demonstrates the creation of a client SSL/TLS profile on BIG-IP LTM, associating a certificate and key. The profile is then added to the virtual server configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\n# create profile client-ssl test_ssl_client_profile cert test.crt key test.key\n# modify virtual test_ssl_virtual profiles add { test_ssl_client_profile }\n# save /sys config\n```\n\n----------------------------------------\n\nTITLE: Restore Kubernetes Custom Resources\nDESCRIPTION: These commands recreate the custom resources from the previously created YAML files. They're used after redeploying the mesh during a manual upgrade.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nkubectl create -f trafficsplits.yaml -f traffictargets.yaml -f httproutegroups.yaml -f tcproutes.yaml -f ratelimits.yaml -f circuitbreakers.yaml\n```\n\n----------------------------------------\n\nTITLE: Install Set-Misc Module on Amazon Linux 2023, AlmaLinux, and Rocky Linux\nDESCRIPTION: This snippet demonstrates the installation of the nginx-plus-module-set-misc package on Amazon Linux 2023, AlmaLinux, and Rocky Linux distributions using the dnf package manager. It updates the package repositories before installing the module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/set-misc.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-set-misc\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Plus Package - Debian\nDESCRIPTION: Installs the NGINX Plus package using the dpkg package manager. This command is applicable for Debian and Ubuntu distributions.  The <deb_package_name> placeholder should be replaced with the actual name of the Debian package file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_48\n\nLANGUAGE: shell\nCODE:\n```\nsudo dpkg -i <deb_package_name>\n```\n\n----------------------------------------\n\nTITLE: Install NGINX JavaScript Module (CentOS/RHEL)\nDESCRIPTION: This command installs the NGINX JavaScript module (njs) on CentOS or RHEL systems. The module is necessary for handling interactions between NGINX Plus and Microsoft Entra (IdP).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/microsoft-entra-setup.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Stopping NGINX Agent Service\nDESCRIPTION: This command stops the NGINX Agent service using systemctl, which is the standard service manager for many Linux distributions. It ensures that the agent is no longer running before attempting to uninstall it. This command requires root privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/uninstall.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl stop nginx-agent\n```\n\n----------------------------------------\n\nTITLE: NGINX Socket Configuration\nDESCRIPTION: This snippet shows how to configure the NGINX Agent socket path within the `nginx-agent.conf` file. The 'socket' parameter is used to specify the location of the Unix domain socket. This configuration enables the socket server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configure-nginx-agent-group.md#_snippet_0\n\nLANGUAGE: nginx configuration\nCODE:\n```\nnginx:\n ...\n socket: \"unix:/var/run/nginx-agent/nginx.sock\"\n```\n\n----------------------------------------\n\nTITLE: Reloading NGINX Configuration\nDESCRIPTION: This command reloads the Nginx configuration without dropping active connections, allowing for seamless updates without interrupting users. It integrates directly with the system's service manager on Linux distributions using systemd.\nSOURCE: https://github.com/nginx/documentation/blob/main/templates/style-guide.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl reload nginx\n```\n\n----------------------------------------\n\nTITLE: Restarting NGINX Service\nDESCRIPTION: This command fully stops and starts the Nginx service, causing a temporary service interruption by dropping all active connections. It is used for software upgrades or clearing memory and resets logging and temporary files.\nSOURCE: https://github.com/nginx/documentation/blob/main/templates/style-guide.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Tea Response Example (Text)\nDESCRIPTION: This is an example response received from the `tea` application, showing the server address and the server name (pod name) that handled the request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_8\n\nLANGUAGE: text\nCODE:\n```\nServer address: 10.244.0.9:8080\nServer name: tea-76c7c85bbd-cf8nz\n```\n\n----------------------------------------\n\nTITLE: Describe Gateway status with kubectl\nDESCRIPTION: This command retrieves and displays the status of a Kubernetes Gateway resource named 'cafe'. The output includes information such as IP addresses, conditions (Accepted, Programmed), and attached routes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe gateway cafe\n```\n\n----------------------------------------\n\nTITLE: Install SPNEGO Auth Module (Debian and Ubuntu)\nDESCRIPTION: Installs the `nginx-plus-module-auth-spnego` package using apt on Debian and Ubuntu operating systems. It first updates the package lists and then installs the specified module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/spnego.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-auth-spnego\n```\n\n----------------------------------------\n\nTITLE: Enable SPNEGO Module (Dynamic Loading)\nDESCRIPTION: Enables the SPNEGO module by dynamically loading it within the NGINX configuration file (`nginx.conf`). The `load_module` directive is placed in the top-level context, and the `http` block is shown for context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/spnego.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/spnego-http-auth-nginx-module.so;\n\n   http {\n       # ...\n   }\n```\n\n----------------------------------------\n\nTITLE: Example Nginx Configuration Test Output (Shell)\nDESCRIPTION: This is the expected output of the `nginx -t` command when the configuration file is valid. It confirms that the syntax is correct and that the configuration file can be loaded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Creating SSL directory for Nginx (shell)\nDESCRIPTION: This command creates the /etc/ssl/nginx directory with necessary permissions. It uses sudo to execute the command with root privileges and the -p flag to create parent directories if they don't exist.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/create-dir-for-crt-key.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/ssl/nginx\n```\n\n----------------------------------------\n\nTITLE: NGINX Controller Version Check with helper.sh (Bash)\nDESCRIPTION: This snippet uses the `helper.sh` script to display the installed and running versions of the NGINX Controller. The script is located at `/opt/nginx-controller/helper.sh` and takes the `version` argument. The output shows the installed and running version of the NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/about/get-controller-version.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh version\n```\n\n----------------------------------------\n\nTITLE: Port Forward Prometheus Dashboard\nDESCRIPTION: This command uses `kubectl port-forward` to create a local port forwarding to the Prometheus service running in the `nsm-monitoring` namespace. This allows access to the Prometheus dashboard through a local port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/observability.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nkubectl -n nsm-monitoring port-forward svc/prometheus 9090\n```\n\n----------------------------------------\n\nTITLE: Apply Access Controls\nDESCRIPTION: This command applies Kubernetes resources defined in access.yaml, which includes a TrafficTarget and HTTPRouteGroup. These resources configure access controls to restrict traffic from the 'disallowed' driver.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f access.yaml\n```\n\n----------------------------------------\n\nTITLE: Apply App Protect Policy NGINX\nDESCRIPTION: This snippet demonstrates how to apply a custom NGINX App Protect policy by specifying the path to the policy file within the NGINX configuration. The policy file should be placed in the `/etc/app_protect/bundles/` directory. Ensure the policy file is accessible by the appropriate user ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/nap-k8s-use-compiled-bundles.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_policy_file \"/etc/app_protect/bundles/custom_policy.tgz\";\n```\n\n----------------------------------------\n\nTITLE: Downloading and Extracting zlib Library for NGINX\nDESCRIPTION: These commands download, extract, configure, build, and install the zlib library. This is needed for header compression support in NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_49\n\nLANGUAGE: shell\nCODE:\n```\nwget http://zlib.net/zlib-1.3.1.tar.gz\ntar -zxf zlib-1.3.1.tar.gz\ncd zlib-1.3.1\n./configure\nmake\nsudo make install\n```\n\n----------------------------------------\n\nTITLE: Get OpenShift Secret Details\nDESCRIPTION: Retrieves the details of the 'regcred' secret in YAML format from the 'nms' project in OpenShift. This command is used to confirm that the secret has been created correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\noc get secret regcred --output=yaml -n nms\n```\n\n----------------------------------------\n\nTITLE: Retrieving Raw Traffic Metrics using kubectl\nDESCRIPTION: Retrieves raw traffic metrics using the `kubectl get` command to query the Kubernetes API. This provides detailed information about traffic edges and metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/smi-traffic-metrics.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get --raw /apis/metrics.smi-spec.io/v1alpha1/namespaces/default/deployments/reviews-v3/edges\n```\n\n----------------------------------------\n\nTITLE: Get the Secret created by cert-manager\nDESCRIPTION: Retrieves the Kubernetes Secret named `cafe-secret`, which contains the TLS certificate issued by Let's Encrypt. The command verifies that cert-manager has successfully created the secret containing the signed keypair.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/integrating-cert-manager.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get secret cafe-secret\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Service User and Group (Systemd)\nDESCRIPTION: This snippet shows how to configure the Nginx service to run as a specific non-root user and group by editing the systemd service file.  It requires root privileges to edit the file and restart the service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-agent-non-root.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\n[Service]\nUser=<non-root-user>\nGroup=<optional group>\n```\n\n----------------------------------------\n\nTITLE: Description of system.load.1, system.load.5, system.load.15 metrics\nDESCRIPTION: Provides the type and description for the system.load.1, system.load.5, and system.load.15 metrics which is a gauge in float representing Number of processes in the system run queue, averaged over the last 1, 5, and 15 min.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_5\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, float\nDescription: Number of processes in the system run queue, averaged over the last 1, 5,\n               and 15 min.\n```\n\n----------------------------------------\n\nTITLE: Enabling core dumps for setuid/setgid processes (FreeBSD)\nDESCRIPTION: Enables core dumps for `setuid` and `setgid` processes on FreeBSD. Configures the system to include the hostname and process ID in the core file name and enables core dumps for setuid/setgid processes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_20\n\nLANGUAGE: shell\nCODE:\n```\nsudo sysctl kern.sugid_coredump=1\nsudo sysctl kern.corefile=/tmp/cores/%N.core.%P\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Open Source on Ubuntu\nDESCRIPTION: This command updates the apt package lists and then installs the NGINX Open Source package.  The `apt update` command ensures that the package manager is aware of the latest versions available, and `apt install nginx` installs the NGINX package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_27\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update\nsudo apt install nginx\n```\n\n----------------------------------------\n\nTITLE: Test Nginx Configuration\nDESCRIPTION: Tests the Nginx configuration file for syntactic validity using the `nginx -t` command. This helps identify errors before reloading the configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_11\n\nLANGUAGE: none\nCODE:\n```\nroot# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n```\n\n----------------------------------------\n\nTITLE: Extract NGINX Controller Installer Package\nDESCRIPTION: This command extracts the files from the NGINX Controller installer package. It uses the `tar` command with the `xzf` options to decompress and extract the archive. This step is necessary before updating NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\ntar xzf controller-installer-<version>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Update Proxy with JWT Introspection Response\nDESCRIPTION: This example shows how to update a proxy configuration to use the `application/jwt` introspection response type. It sends a PUT request to the API to update the proxy configuration with the specified OAuth2 server and JWT introspection settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_55\n\nLANGUAGE: bash\nCODE:\n```\nPUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy\n```\n\n----------------------------------------\n\nTITLE: Source IP Persistence on NGINX Plus\nDESCRIPTION: This code snippet configures source IP address-based session persistence on NGINX Plus. It uses the `ip_hash` directive within the upstream block to enable source IP hash-based persistence.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nupstream test_pool {\n        ip_hash;\n        server 10.10.10.10:80;\n        server 10.10.10.20:80;\n   }\n```\n\n----------------------------------------\n\nTITLE: Restarting nms-integrations service (systemctl)\nDESCRIPTION: This command restarts the `nms-integrations` service using `systemctl`, the systemd service manager. Restarting the service ensures that any configuration changes are applied. It requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/nap-waf/restart-nms-integrations.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nms-integrations\n```\n\n----------------------------------------\n\nTITLE: Get Dimensions Catalog with curl\nDESCRIPTION: This command retrieves the full list of available dimensions in the Nginx Controller Analytics catalog. It requires a valid session cookie for authentication. The endpoint returns a JSON payload with descriptions of available dimensions that can be used to filter metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/view-traffic-metrics.md#_snippet_2\n\nLANGUAGE: curl\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{Controller-FQDN}/api/v1/analytics/catalogs/dimensions\"\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration\nDESCRIPTION: This bash command reloads the NGINX configuration. This is necessary after making changes to any of the NGINX configuration files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/auth0.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: RateLimit v1alpha1 YAML Configuration\nDESCRIPTION: Defines a RateLimit resource using the specs.smi.nginx.com/v1alpha1 API version. It configures rate limiting for traffic from a specific source (Deployment) to a destination service. The rate is set to 10 requests per minute, with a burst of 10 and no delay.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/v1alpha1-ratelimit.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi.nginx.com/v1alpha1\nkind: RateLimit\nmetadata:\n  name: ratelimit-v1\n  namespace: default\nspec:\n  destination:\n    kind: Service\n    name: dest-svc\n    namespace: default\n  sources:\n  - kind: Deployment\n    name: source-1\n    namespace: default\n  name: 10rm\n  rate: 10r/m\n  burst: 10\n  delay: \"nodelay\"\n```\n\n----------------------------------------\n\nTITLE: Save NGINX Gateway Fabric IP and Port\nDESCRIPTION: Saves the public IP address and port of NGINX Gateway Fabric into shell variables. This simplifies subsequent commands by using variables for the IP and port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nGW_IP=XXX.YYY.ZZZ.III\nGW_PORT=<port number>\n```\n\n----------------------------------------\n\nTITLE: Check NGINX Controller Status\nDESCRIPTION: This command checks the NGINX Controller status to confirm the installation is healthy before updating. It runs the `helper.sh` script with the `controller status` option. Any degradations should be resolved before proceeding with the update.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\n./helper.sh controller status\n```\n\n----------------------------------------\n\nTITLE: Deploy Coffee Application\nDESCRIPTION: This snippet defines the Kubernetes deployment and service for a sample 'coffee' application. It creates a deployment with two replicas that expose a simple HTTP server and a service to route traffic to those pods.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/routing-traffic-to-your-app.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: coffee\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: coffee\n  template:\n    metadata:\n      labels:\n        app: coffee\n    spec:\n      containers:\n      - name: coffee\n        image: nginxdemos/nginx-hello:plain-text\n        ports:\n        - containerPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: coffee\nspec:\n  ports:\n  - port: 80\n    targetPort: 8080\n    protocol: TCP\n    name: http\n  selector:\n    app: coffee\nEOF\n```\n\n----------------------------------------\n\nTITLE: Security Strategy with BYO WAF Policy (JSON)\nDESCRIPTION: This JSON snippet defines a Security Strategy that references a BYO NGINX App Protect WAF policy. This strategy can then be used to configure WAF for an App Component. It requires sending a PUT request to the Strategies REST API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/add-app-security-with-waf.md#_snippet_3\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"metadata\": {\n        \"name\": \"yourSecStrategyName\",\n        \"displayName\": \"Security Strategy\",\n        \"description\": \"my special security strategy\",\n        \"tags\": [\n            \"tag1\",\n            \"tag2\"\n        ]\n    },\n    \"desiredState\": {\n        \"content\": {\n            \"securityPolicyRef\": \"/security/policies/yourPolicyName\"\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Simple Tracing Configuration (Nginx)\nDESCRIPTION: This configuration enables basic request tracing by turning on `otel_trace`. Every incoming request will be traced, even in non-distributed environments. It requires the otel module to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_20\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    otel_trace on;\n    server {\n        location / {\n        proxy_pass http://backend;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Kubernetes error during NGINX Controller startup\nDESCRIPTION: This snippet shows an error message that may appear when starting NGINX Controller on Red Hat Enterprise Linux 8. The error indicates an unknown flag `--server-dry-run`. This message, along with the subsequent patching and restarting of the analytics database, can be safely ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.8.md#_snippet_1\n\nLANGUAGE: text\nCODE:\n```\nError: unknown flag: --server-dry-run\nSee 'kubectl apply --help' for usage.\nDetected an invalid patch for the analytics database. Resolving conflicts and restarting the analytics database before running the update.\nstatefulset.apps/clickhouse patched\n```\n\n----------------------------------------\n\nTITLE: Initialize Terraform Configuration\nDESCRIPTION: This command initializes the Terraform working directory, downloading any necessary providers and modules.  It prepares the environment for subsequent Terraform commands. It must be run before `terraform plan` or `terraform apply`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-terraform.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nterraform init\n```\n\n----------------------------------------\n\nTITLE: Restart Nginx Controller Agent\nDESCRIPTION: This command restarts the Nginx Controller Agent service on the Nginx Plus system. It uses the `service` command to manage the agent's lifecycle, restarting the service. Requires the controller-agent service to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-controller.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nservice controller-agent restart\n```\n\n----------------------------------------\n\nTITLE: Removing Failed NGINX Service Mesh Services (Bash)\nDESCRIPTION: This command removes the failed NGINX Service Mesh services from the specified namespace. It is used as part of the workaround for the private registry credentials issue in version 0.9.0.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.9.1.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl -n <namespace> remove\n```\n\n----------------------------------------\n\nTITLE: Executing the k8s-backup.sh Script - Shell\nDESCRIPTION: This command executes the `k8s-backup.sh` script, which backs up NGINX Management Suite deployed in a Kubernetes cluster. The script will prompt for the NGINX Management Suite namespace and create a backup archive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\n./k8s-backup.sh\n```\n\n----------------------------------------\n\nTITLE: Enabling Passenger module in NGINX configuration\nDESCRIPTION: This snippet shows how to enable the Passenger module in the NGINX configuration file (nginx.conf) by loading the module and including it in the http context. This allows Nginx to utilize Passenger for application deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/passenger-open-source.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_passenger_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Verifying NGINX Signing Key\nDESCRIPTION: This command verifies the downloaded NGINX signing key. It uses openssl to display the public key modulus, which should match the expected value to ensure the key's integrity.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_25\n\nLANGUAGE: shell\nCODE:\n```\nopenssl rsa -pubin -in /tmp/nginx_signing.rsa.pub -text -noout\n```\n\n----------------------------------------\n\nTITLE: Check the status of Pods in the tracing namespace\nDESCRIPTION: Retrieves the status of all Pods running within the 'tracing' namespace. This ensures that the OpenTelemetry Collector and Jaeger Pods are running correctly before proceeding.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nkubectl -n tracing get pods\n```\n\n----------------------------------------\n\nTITLE: Installing nginx-sync on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This command installs the nginx-sync package on Amazon Linux 2, CentOS, Oracle Linux, and RHEL systems using the yum package manager. The sudo command is used to execute the command with administrative privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install nginx-sync\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Plus Dependencies (Deb-Based) - Bash\nDESCRIPTION: Extracts and installs NGINX Plus dependencies from a `tar.gz` archive on Debian-based systems (Ubuntu). It uses `dpkg -i` to install the DEB packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-devportal-offline.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ntar -kzxvf acm-dataplane-dependencies-<linux-distribution>.tar.gz\nsudo dpkg -i ./*.deb\n```\n\n----------------------------------------\n\nTITLE: Gateway Update Failure\nDESCRIPTION: Error message displayed when updating a Gateway associated with a Published API and Authentication is enabled in the associated component.  Indicates a configuration testing failure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.6.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\nFailed testing config before applying\n```\n\n----------------------------------------\n\nTITLE: Setting NGINX Load Balancing Method in NGINX Service Mesh\nDESCRIPTION: This command sets the NGINX load balancing method to 'random two least_conn' during NGINX Service Mesh deployment.  This configures the load balancing algorithm used by the NGINX sidecar.  Requires `nginx-meshctl` to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/configuration.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --nginx-lb-method \"random two least_conn\"\n```\n\n----------------------------------------\n\nTITLE: Install PostgreSQL (CentOS, RHEL, RPM-based)\nDESCRIPTION: Installs the PostgreSQL server on CentOS, RHEL, or other RPM-based systems. It uses `yum` to install the `postgresql-server` package and initializes the database using `postgresql-setup`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum install -y postgresql-server\nsudo postgresql-setup initdb\n```\n\n----------------------------------------\n\nTITLE: Inject Resources via nginx-meshctl and kubectl\nDESCRIPTION: This command injects resources defined in my-app.yaml into a Kubernetes cluster using nginx-meshctl and kubectl. The injected resources are then applied to the cluster using kubectl apply.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl inject -f ./my-app.yaml | kubectl apply -f -\n```\n\n----------------------------------------\n\nTITLE: Edit TrafficTarget Resource\nDESCRIPTION: This command opens the `traffictarget` resource in a text editor, allowing modifications to the resource's YAML configuration. This is used to add the 'source-disallowed-sa' to the allowed sources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\nkubectl edit traffictarget traffic-target\n```\n\n----------------------------------------\n\nTITLE: Adding SCC to ServiceAccount in OpenShift (Bash)\nDESCRIPTION: Adds the `nginx-ingress-permissions` SecurityContextConstraint (SCC) to the ServiceAccount of the NGINX Ingress Controller in OpenShift. This enables the Ingress Controller to operate with the required security context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\noc adm policy add-scc-to-user nginx-ingress-permissions -z nginx-ingress -n nginx-ingress\n```\n\n----------------------------------------\n\nTITLE: Rotate Encryption Keys (bash)\nDESCRIPTION: This command rotates the encryption keys for certificates stored in NGINX Management Suite. It should be run as the `nms` user and requires stopping the `nms` service beforehand.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/manage-certificates.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo runuser -u nms -- nms-core secret rotate\n```\n\n----------------------------------------\n\nTITLE: Update APT Package List (Ubuntu)\nDESCRIPTION: Updates the package source lists on Ubuntu using the Advanced Packaging Tool (APT). This ensures you have the latest package information before installing new software.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisites for NGINX on Alpine\nDESCRIPTION: This command installs the necessary packages for installing NGINX from the official repository on Alpine Linux. It installs openssl for secure connections, curl for downloading files, and ca-certificates for verifying SSL certificates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_37\n\nLANGUAGE: shell\nCODE:\n```\nsudo apk add openssl curl ca-certificates\n```\n\n----------------------------------------\n\nTITLE: Installing Passenger module on SLES\nDESCRIPTION: This code snippet details the installation of the `nginx-plus-module-passenger` package on SLES systems using the zypper package manager. It refreshes the package list and installs the NGINX Passenger module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/passenger-open-source.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-passenger\n```\n\n----------------------------------------\n\nTITLE: Load Kernel Modules Immediately\nDESCRIPTION: These commands load the `overlay`, `br_netfilter`, and `iptable_nat` kernel modules into the currently running kernel. This is necessary to enable Kubernetes networking immediately without requiring a reboot.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo modprobe overlay\n```\n\nLANGUAGE: bash\nCODE:\n```\nsudo modprobe br_netfilter\n```\n\nLANGUAGE: bash\nCODE:\n```\nsudo modprobe iptable_nat\n```\n\n----------------------------------------\n\nTITLE: Pull NGINX Gateway Fabric Chart with Helm\nDESCRIPTION: This shell script pulls the latest stable release of the NGINX Gateway Fabric chart using Helm. It then navigates into the extracted chart directory. Requires Helm to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/helm/pulling-the-chart.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nhelm pull oci://ghcr.io/nginx/charts/nginx-gateway-fabric --untar\ncd nginx-gateway-fabric\n```\n\n----------------------------------------\n\nTITLE: SELinux Audit Search\nDESCRIPTION: This code snippet demonstrates how to use `ausearch` to search for audit denials related to the `nap-engine_t` context when troubleshooting SELinux issues with NGINX App Protect WAF.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/troubleshooting-guide/troubleshooting.md#_snippet_5\n\nLANGUAGE: none\nCODE:\n```\nausearch --start recent -m avc --raw -se nap-engine_t\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Instance Manager Services\nDESCRIPTION: Restarts the NGINX Instance Manager service to apply the updated SELinux policies.  This ensures that the running processes are using the new security context. Requires systemd.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-selinux.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nms\n```\n\n----------------------------------------\n\nTITLE: Installing keepalived and wget on Ubuntu\nDESCRIPTION: This command installs the `keepalived` and `wget` packages on Ubuntu systems. `keepalived` is used for managing the virtual IP address, and `wget` is used by the HA scripts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-keepalived.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get install keepalived wget\n```\n\n----------------------------------------\n\nTITLE: Configuring Nginx Error Logging for ModSecurity\nDESCRIPTION: This snippet configures the Nginx error log to capture all messages from the NGINX ModSecurity WAF by setting the logging level to `info`. This ensures that all ModSecurity related events are logged in /var/log/nginx/error.log.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_19\n\nLANGUAGE: nginx\nCODE:\n```\nerror_log /var/log/nginx/error.log info;\n```\n\n----------------------------------------\n\nTITLE: Include Status Configuration in Nginx\nDESCRIPTION: This code snippet demonstrates how to include the downloaded status.conf file into the main Nginx configuration file within the `http` block. This makes the monitoring configuration active.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_53\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\ninclude conf.d/status.conf;\n```\n\n----------------------------------------\n\nTITLE: Remove NGINX Repository Files Shell\nDESCRIPTION: Removes any previously downloaded NGINX repository files and application protection repository files from the `/etc/yum.repos.d` directory. This ensures a clean slate before adding the new repository configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-dnf.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo rm /etc/yum.repos.d/nginx*.repo\nsudo rm /etc/yum.repos.d/*app-protect*.repo\n```\n\n----------------------------------------\n\nTITLE: Verify nginx-agent Group Existence\nDESCRIPTION: This command uses `getent group` to verify the existence of the `nginx-agent` group.  `grep` filters the output for the `nginx-agent` group. This is a prerequisite step before proceeding to modify group memberships or permissions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configure-nginx-agent-group.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo getent group | grep nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Get Nginx and App Protect versions on Debian\nDESCRIPTION: This code snippet retrieves the versions of Nginx Plus and App Protect packages on Debian systems and appends the output to a file named `package_versions.txt`.  This file is part of the troubleshooting data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/troubleshooting-guide/troubleshooting.md#_snippet_8\n\nLANGUAGE: none\nCODE:\n```\napt list --installed | grep -E 'nginx-plus|app-protect' >> package_versions.txt\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Controller\nDESCRIPTION: This script is used to uninstall NGINX Controller from a node that was previously deleted from the cluster. It's executed via SSH connection to the target node.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/resilient-cluster-private-cloud.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/uninstall.sh\n```\n\n----------------------------------------\n\nTITLE: Running NGINX Controller helper script for prerequisites\nDESCRIPTION: This script installs the required system packages and Docker CE for NGINX Controller using the helper script. It navigates to the `controller-installer` directory and executes the `helper.sh` script with the `prereqs` option.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/controller/helper-script-prereqs.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./helper.sh prereqs\n```\n\n----------------------------------------\n\nTITLE: Installing Logrotate on CentOS\nDESCRIPTION: This command installs the logrotate utility on CentOS systems. Logrotate is used for managing and rotating log files, preventing them from consuming excessive disk space.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/logs-overview.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install logrotate\n```\n\n----------------------------------------\n\nTITLE: Clone nginx-openid-connect Repository\nDESCRIPTION: This bash command clones the nginx-openid-connect GitHub repository. This repository contains necessary configuration files and scripts for setting up OpenID Connect with NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/auth0.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ngit clone https://github.com/nginxinc/nginx-openid-connect.git\n```\n\n----------------------------------------\n\nTITLE: Error Message Example\nDESCRIPTION: This snippet shows the error message that appears when `app_protect_custom_log_attribute` directive is invalid, specifically when the number of directives exceeds the maximum allowed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/custom-log-errors-warnings.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\napp_protect_custom_log_attribute directive is invalid. Number of app_protect_custom_log_attribute directives exceeds maximum\n```\n\n----------------------------------------\n\nTITLE: Clone nginx-openid-connect Repo\nDESCRIPTION: This command clones the nginx-openid-connect GitHub repository. This repository contains necessary configuration files and scripts for setting up OpenID Connect with NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/okta.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\ngit clone https://github.com/nginxinc/nginx-openid-connect.git\n```\n\n----------------------------------------\n\nTITLE: Kubectl logs command\nDESCRIPTION: Command to view the logs of the NLK controller deployment in Kubernetes. This is useful for troubleshooting and verifying that the controller is picking up services and communicating with NGINXaaS correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/loadbalancer-kubernetes.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nkubectl logs deployment/nlk-nginxaas-loadbalancer-kubernetes\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Management Suite (nms) using systemctl\nDESCRIPTION: This command restarts the NGINX Management Suite (nms) service using systemctl, a system and service manager for Linux operating systems. This is required after OIDC configuration updates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/release-notes.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nms\n```\n\n----------------------------------------\n\nTITLE: Proxying Requests to a Backend Server\nDESCRIPTION: This snippet shows how to proxy requests to a backend server using the `proxy_pass` directive. Requests that don't match the /images/ location are proxied to http://www.example.com.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    location / {\n        proxy_pass http://www.example.com;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Get GatewayClass configuration\nDESCRIPTION: Retrieves the GatewayClass resource named 'nginx' in YAML format. This confirms that the GatewayClass is configured to reference the NginxProxy resource.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get gatewayclasses.gateway.networking.k8s.io nginx -o yaml\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Management Suite for mTLS\nDESCRIPTION: Configures NGINX Management Suite to verify client certificates by setting the `ssl_client_certificate` directive in `/etc/nginx/conf.d/nms-http.conf` to the location of the CA PEM file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_16\n\nLANGUAGE: yaml\nCODE:\n```\nssl_certificate         /etc/nms/certs/manager-server.pem;\nssl_certificate_key     /etc/nms/certs/manager-server.key;\nssl_client_certificate  /etc/nms/certs/ca.pem;\n```\n\n----------------------------------------\n\nTITLE: Run Nginx Container (Shell)\nDESCRIPTION: This shell command runs a Docker container named mynginx3 based on the mynginx_image1 image. It maps port 80 on the host to port 80 on the container and runs the container in detached mode (-d).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_22\n\nLANGUAGE: shell\nCODE:\n```\ndocker run --name mynginx3 -p 80:80 -d mynginx_image1\n```\n\n----------------------------------------\n\nTITLE: Copy Restore Script (Shell)\nDESCRIPTION: Copies the k8s-restore.sh script from the NGINX Management Suite package to the working directory. This script is essential for performing the data restoration process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\ncp nms-<version>/nms/charts/nms-hybrid/backup-restore/k8s-restore.sh .\n```\n\n----------------------------------------\n\nTITLE: Get Nginx and App Protect versions on CentOS\nDESCRIPTION: This code snippet retrieves the versions of Nginx Plus and App Protect packages on CentOS systems and appends the output to a file named `package_versions.txt`.  This file is part of the troubleshooting data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/troubleshooting-guide/troubleshooting.md#_snippet_7\n\nLANGUAGE: none\nCODE:\n```\nrpm -qa nginx-plus* app-protect* >> package_versions.txt\n```\n\n----------------------------------------\n\nTITLE: Limiting Connections in a Nginx Location Block\nDESCRIPTION: This configuration limits the number of concurrent connections from a single IP address to 1 within the `/download/` location. It references the previously defined 'addr' zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /download/ {\n     limit_conn addr 1;\n}\n```\n\n----------------------------------------\n\nTITLE: Markdown Formatting: Note Shortcode\nDESCRIPTION: This snippet shows how to use the Hugo `note` shortcode to create a note callout within the documentation. The content within the `note` shortcode will be formatted as a note.\nSOURCE: https://github.com/nginx/documentation/blob/main/CONTRIBUTING_DOCS.md#_snippet_3\n\nLANGUAGE: Markdown\nCODE:\n```\n{{< note >}} Provide the text of the note here .{{< /note >}}\n```\n\n----------------------------------------\n\nTITLE: Configuring Health Check for Web Application\nDESCRIPTION: This snippet adds a `health_check` directive to a `location` block, enabling health checks for the web application. The `match` parameter refers to a named `match` block that defines the criteria for a successful health check.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_25\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nlocation /webapp/ {\n    proxy_pass http://jboss;\n    proxy_cache backcache;\n    health_check match=jboss_check;\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstall AVRD - RedHat/CentOS\nDESCRIPTION: This snippet uninstalls the Analytics, Visibility, and Reporting Daemon (AVRD) and related modules on RedHat/CentOS systems using yum. It removes the avrd, avrd-metrics, and nginx-plus-module-metrics packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-agent.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum remove avrd avrd-metrics nginx-plus-module-metrics\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Volume Definition for Nginx Plus License\nDESCRIPTION: Defines a Kubernetes volume named `nginx-plus-license` that mounts a Kubernetes secret containing the NGINX Plus license. This is used to provide the license to the Nginx container.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/nginx-plus-jwt.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\n- name: nginx-plus-license\n  secret:\n    secretName: nplus-license\n```\n\n----------------------------------------\n\nTITLE: Load Cookie-Flag Module in NGINX Configuration\nDESCRIPTION: This snippet shows how to load the Cookie-Flag module in the nginx.conf file. The `load_module` directive is placed in the main context, and the `http` block represents the HTTP context where further module configurations would typically reside.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/cookie-flag.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_cookie_flag_filter_module.so;\n\n   http {\n       # ...\n   }\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Amplify Agent\nDESCRIPTION: This snippet restarts the NGINX Amplify Agent service, which is required for the new configuration to take effect. After restarting, the agent should start collecting and sending MySQL metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/other-metrics.md#_snippet_9\n\nLANGUAGE: plaintext\nCODE:\n```\n# service amplify-agent restart\n```\n\n----------------------------------------\n\nTITLE: Define Conflicting Rate Limits (YAML)\nDESCRIPTION: This YAML configuration defines another RateLimit resource also with the Service source, but targeting a Deployment destination of the same name. Demonstrates a scenario where the admission webhook allows the configuration, potentially leading to runtime failure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/smi-traffic-policies.md#_snippet_6\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi.nginx.com/v1alpha2\nkind: RateLimit\nmetadata:\n  name: limit-2\n  namespace: default\nspec:\n  destination:\n    kind: Deployment\n    name: dest-svc\n    namespace: default\n  sources:\n    - kind: Service\n      name: src-1\n      namespace: default\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX JavaScript module (njs) on CentOS/RHEL/Oracle Linux\nDESCRIPTION: This command installs the NGINX JavaScript module (njs) on CentOS, RHEL, and Oracle Linux systems using the yum package manager. This module is required for handling the interaction between NGINX Plus and the Keycloak identity provider.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/keycloak.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Configure External Hostname PowerShell\nDESCRIPTION: This command configures the external hostname for Outlook Anywhere in Exchange using the Set-OutlookAnywhere cmdlet in PowerShell.  It sets the ExternalHostname property.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_5\n\nLANGUAGE: PowerShell\nCODE:\n```\nC:\\> Set-OutlookAnywhere -ExternalHostname mail.company.com\n```\n\n----------------------------------------\n\nTITLE: Specifying a Custom DNS Resolver\nDESCRIPTION: This snippet demonstrates how to specify a custom DNS resolver within the `mgmt` block using the `resolver` directive.  It also shows how to configure the TTL and IPv6 settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/usage-tracking/agentless-reporting.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n    resolver 10.0.0.1;\n    #...\n}\n```\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n    resolver 10.0.0.1 valid=300s ipv6=off;\n    #...\n}\n```\n\nLANGUAGE: nginx\nCODE:\n```\nmgmt {\n    resolver 10.0.0.1 status_zone=resolver-zone1;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Set Maintenance Mode (YAML)\nDESCRIPTION: Sets the NIM_MAINTENANCE environment variable to \"true\" within the docker-compose.yaml file, which puts NGINX Instance Manager into maintenance mode. This is required before restoring a backup.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_10\n\nLANGUAGE: yaml\nCODE:\n```\n    environment:\n      NIM_MAINTENANCE: \"true\"\n```\n\n----------------------------------------\n\nTITLE: Getting Scanned Servers via API (Shell)\nDESCRIPTION: This shell command retrieves a list of scanned servers using the NGINX Instance Manager API. It performs a GET request to the `/api/v1/servers` endpoint. It requires a valid access token for authorization and specifies that the response should be in JSON format.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/scan-instances.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET \"https://<NGINX-INSTANCE-MANAGER-FQDN>/api/v1/servers\" -H  \"accept: application/json\" -H 'Authorization: Bearer <access token>'\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Controller with Join Key Bash\nDESCRIPTION: This command installs NGINX Controller on a node and joins it to an existing cluster using a provided join key. It is essential for adding a node back to the cluster after changing its IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/maintenance/changing-ip-address.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./install.sh --join-key <long-value>\n```\n\n----------------------------------------\n\nTITLE: Backing Up Private Key File\nDESCRIPTION: This command creates a backup of the generated private key file in a secure location. This is important to ensure the certificate remains usable in case the original key is lost.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nroot# cp ~/private-key.pem secure-dir/private-key.pem.backup\n```\n\n----------------------------------------\n\nTITLE: Setting NGINX Log Format in NGINX Service Mesh\nDESCRIPTION: This command sets the NGINX sidecar logging format to 'json' during NGINX Service Mesh deployment.  This configures the format of the NGINX sidecar logs. Requires `nginx-meshctl` to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/configuration.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --nginx-log-format json\n```\n\n----------------------------------------\n\nTITLE: Cloning the nginx-openid-connect repository\nDESCRIPTION: This command clones the nginx-openid-connect GitHub repository, which contains the necessary configuration files and scripts for setting up NGINX Plus as an OpenID Connect relying party. It creates a local copy of the repository on the user's machine. This step is a prerequisite for further configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/cognito.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ngit clone https://github.com/nginxinc/nginx-openid-connect\n```\n\n----------------------------------------\n\nTITLE: Set NGINXaaS deployment details using Azure CLI\nDESCRIPTION: This snippet sets shell variables for the NGINXaaS deployment name and resource group. These variables are used in subsequent Azure CLI commands to manage the NGINXaaS deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/loadbalancer-kubernetes.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n## Customize this to provide the details about my already created NGINXaaS deployment\nnginxName=myNginx\nnginxGroup=myNginxGroup\n```\n\n----------------------------------------\n\nTITLE: Installing keepalived and wget on CentOS\nDESCRIPTION: This command installs the `keepalived` and `wget` packages on CentOS systems. `keepalived` is used for managing the virtual IP address, and `wget` is used by the HA scripts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-keepalived.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install keepalived wget\n```\n\n----------------------------------------\n\nTITLE: Querying Metrics API with Aggregated and Non-Aggregated Metrics\nDESCRIPTION: This curl command demonstrates querying the Metrics API with a mix of aggregated and non-aggregated metrics. It retrieves the sum of `nginx.http.request.count` and the last recorded value of `nginx.http.conn.accepted` for the last 12 hours. The `startTime` parameter is required for the aggregated metric, and a valid access token is needed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/metrics?names=SUM(nginx.http.request.count),nginx.http.conn.accepted&startTime=now-12h\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Install Apt Prerequisites - Shell\nDESCRIPTION: Installs the necessary packages on Ubuntu systems to manage apt repositories over HTTPS. These packages are apt-transport-https, lsb-release, ca-certificates, wget, gnupg2, and ubuntu-keyring. They are needed to securely configure and use the Nginx Agent repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get install apt-transport-https lsb-release ca-certificates wget gnupg2 ubuntu-keyring\n```\n\n----------------------------------------\n\nTITLE: Establishing SSH Connection to Azure VM\nDESCRIPTION: This command establishes an SSH connection to an Azure Virtual Machine. It requires the private key file, username, and public IP address of the VM.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/microsoft-azure/virtual-machines-for-nginx.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nssh -i <private-key-file> <username>@<public-IP-address>\n```\n\n----------------------------------------\n\nTITLE: Check cgroup Swap Limit Capabilities\nDESCRIPTION: This code shows how to use the `docker info` command to check if the cgroup swap limit capabilities are enabled on the Docker host. The output will indicate whether swap limit support is available.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-support.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\n$ docker info | grep swap\nWARNING: No swap limit support\n```\n\n----------------------------------------\n\nTITLE: Configuring Nginx Stub Status API\nDESCRIPTION: This Nginx configuration block enables the stub_status module, which provides basic server activity metrics. It listens on 127.0.0.1:8080 and allows requests to the /api location only from localhost. All other requests are denied for security reasons. The stub_status module must be installed and enabled in your Nginx installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/use-cases/monitoring/enable-nginx-oss-stub-status.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 127.0.0.1:8080;\n    location /api {\n        stub_status;\n        allow 127.0.0.1;\n        deny all;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Service Mesh Control Plane (nginx-meshctl -y)\nDESCRIPTION: This command uninstalls the NGINX Service Mesh control plane and its components from the Kubernetes cluster. The `-y` flag bypasses the confirmation prompt, automating the uninstallation process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/uninstall/uninstall.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl remove -y\n```\n\n----------------------------------------\n\nTITLE: Enabling the API in Nginx Configuration\nDESCRIPTION: This snippet enables the NGINX API within a specific location. The `api;` directive activates the API endpoint, allowing access to NGINX Plus status metrics, which are then used by the Prometheus module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /api {\n    api;\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Invalid NginxGateway Error\nDESCRIPTION: This error message is displayed when an NginxGateway resource is invalid according to the OpenAPI schema validation. Specifically, the logging level has an unsupported value. This validation is performed by the Kubernetes API server during resource creation or update.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/resource-validation.md#_snippet_8\n\nLANGUAGE: text\nCODE:\n```\nThe NginxGateway \"nginx-gateway-config\" is invalid: spec.logging.level: Unsupported value: \"some-level\": supported values: \"info\", \"debug\", \"error\"\n```\n\n----------------------------------------\n\nTITLE: Check Controller Agent Status (systemctl)\nDESCRIPTION: This snippet shows how to check the status of the NGINX Controller Agent using the systemctl command. It's used to verify that the agent is running as expected after updates or configuration changes. The expected output includes the status 'running'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_37\n\nLANGUAGE: bash\nCODE:\n```\nsystemctl status controller-agent\n```\n\n----------------------------------------\n\nTITLE: Making Kubernetes Backup Script Executable (chmod)\nDESCRIPTION: This command makes the `k8s-backup.sh` script executable. This is a necessary step before running the script. It depends on the `chmod` utility being available.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nchmod +x k8s-backup.sh\n```\n\n----------------------------------------\n\nTITLE: DPKG Command to Get NMS Instance Manager Info\nDESCRIPTION: This bash command retrieves information about the installed NGINX Management Suite (NMS) Instance Manager package using the dpkg package manager. It is used to verify the installed version of Instance Manager to ensure compatibility with other NMS modules.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\ndpkg -s nms-instance-manager\n```\n\n----------------------------------------\n\nTITLE: Assigning DevOps Role to User - JSON\nDESCRIPTION: This JSON snippet shows how to assign the previously created `devops-role` to a user named `David`. It updates the user's `roles` array to include a reference to the `devops-role`. This is part of a PATCH request to update the user.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/using-rbac-with-app-security.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\n{\n      \"desiredState\": {\n          \"firstName\": \"david\",\n          \"lastName\": \"david\",\n          \"email\": \"david@secured-org.test\",\n          \"roles\": [\n              {\n                  \"ref\": \"/platform/roles/devops-role\"\n              }\n          ]\n      },\n      \"metadata\": {\n          \"name\": \"david@secured-org.test\",\n          \"tags\": [\n              \"david\"\n          ]\n      }\n    }\n```\n\n----------------------------------------\n\nTITLE: Description of system.io.wait_r and system.io.wait_w metrics\nDESCRIPTION: Provides the type and description for the system.io.wait_r and system.io.wait_w metrics which is a gauge in milliseconds representing Time spent reading from or writing to disk.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_4\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, milliseconds\nDescription: Time spent reading from or writing to disk.\n```\n\n----------------------------------------\n\nTITLE: Installing Passenger module on FreeBSD\nDESCRIPTION: This code snippet installs the `nginx-plus-module-passenger` package on FreeBSD using the pkg package manager. It updates the package list and then installs the NGINX Passenger module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/passenger-open-source.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-passenger\n```\n\n----------------------------------------\n\nTITLE: Apply ClientSettingsPolicy to GRPCRoute\nDESCRIPTION: This snippet shows how to apply a ClientSettingsPolicy to a GRPCRoute, setting the client_max_body_size to 75 bytes. This is done similarly to HTTPRoutes by specifying the GRPCRoute in the `targetRef`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_22\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.nginx.org/v1alpha1\nkind: ClientSettingsPolicy\nmetadata:\n  name: grpc-client-settings\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: GRPCRoute\n    name: my-grpc-route\n  body:\n    maxSize: \"75\" # sizes without a unit are bytes.\nEOF\n```\n\n----------------------------------------\n\nTITLE: Verify Pods Deployment Status\nDESCRIPTION: This command uses `kubectl` to verify that the gateway and target application pods have been deployed successfully and are in a running state.  It shows the status, restarts, and age of the pods.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n$ kubectl get pods\nNAME                           READY   STATUS    RESTARTS   AGE\ngateway-58c6c76dd-4mmht        2/2     Running   0          2m\ntarget-v1-0-6f69fc48f6-mzcf2   2/2     Running   0          2m\n```\n\n----------------------------------------\n\nTITLE: Test API Proxy - JSON\nDESCRIPTION: The JSON payload for testing the newly created API Proxy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_21\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"testKey\": \"testValue\"\n}\n```\n\n----------------------------------------\n\nTITLE: Restart Deployments/DaemonSets/StatefulSets to Remove Sidecar\nDESCRIPTION: This command restarts Kubernetes Deployments, DaemonSets, or StatefulSets to remove the sidecar proxy injected by the NGINX Service Mesh. This is necessary after uninstalling the mesh to ensure that the sidecar proxy is no longer running in the application pods. Replace `<resource type>` and `<resource name>` with the specific resource to restart.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/uninstall/uninstall-with-helm.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nkubectl rollout restart <resource type>/<resource name>\n```\n\n----------------------------------------\n\nTITLE: Example metric namespaces response (JSON)\nDESCRIPTION: This JSON represents a sample response from the Azure Monitor API when retrieving metric namespaces. It showcases the structure of the response, including the `id`, `name`, `type`, `classification`, and `properties` of each namespace.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/monitoring/enable-monitoring.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"value\": [\n    \t...\n   \t{\n         \"id\": \"/subscriptions/12345678-abcd-98765432-abcdef012345/resourceGroups/my-nginx-rg/providers/NGINX.NGINXPLUS/nginxDeployments/my-nginx-dep/providers/microsoft.insights/metricNamespaces/NGINX Connections Statistics\",\n         \"name\": \"nginx connections statistics\",\n   \t  \"type\": \"Microsoft.Insights/metricNamespaces\",\n         \"classification\": \"Custom\",\n         \"properties\": {\n           \"metricNamespaceName\": \"nginx connections statistics\"\n         }\n       },\n   \t...\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Agent on Data Plane Host - Bash\nDESCRIPTION: This snippet shows the command to install the NGINX Agent on the data plane host. It downloads, installs, configures, and starts the NGINX Agent package. It requires replacing `{{nms-fqdn}}` with the FQDN or IP address of your Dev Portal host and `{{clusterName}}` with the name of your Developer Portal cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/add-devportal.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncurl --insecure https://{{nms-fqdn}}/install/nginx-agent > install.sh && \\\nsudo sh install.sh -g {{clusterName}} && sudo systemctl start nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Applying NGINX Gateway Fabric CRDs\nDESCRIPTION: This command applies the Custom Resource Definitions (CRDs) for NGINX Gateway Fabric using kubectl. It fetches the CRDs from the specified URL. Requires kubectl.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/deploy/crds.yaml\n```\n\n----------------------------------------\n\nTITLE: Configuring Buffers via API in NGINX using JSON\nDESCRIPTION: This JSON snippet demonstrates how to configure buffers for an API Proxy using the backend-config policy. The `number` parameter sets the number of buffers used for reading a response, and `size` defines the size of these buffers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/http-backend-configuration.md#_snippet_8\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"policies\" : {\n      \"backend-config\" : [\n         {\n            \"action\" : {\n               \"buffer\": {\n                  \"number\": 42,\n                  \"size\": \"16KB\"\n               }\n            }\n         }\n      ]\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Directory structure for static files and Nginx config\nDESCRIPTION: This shows an example directory structure, including the Nginx config file and static content. The Nginx configuration file is at the root. The static files, like `index.html`, must be under the `srv` directory. This structure must be preserved when creating the tarball.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/hosting-static-content.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ntest-static-files $ tree .\n.\n├── nginx.conf\n└── srv\n    └── index.html\n\n2 directories, 2 files\n```\n\n----------------------------------------\n\nTITLE: Import Nginx signing key on Debian\nDESCRIPTION: This command downloads the Nginx signing key and adds it to the system's keyring, allowing apt to verify the authenticity of Nginx packages on Debian.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ncurl https://nginx.org/keys/nginx_signing.key | gpg --dearmor \\\n        | sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Agent - Apt - Shell\nDESCRIPTION: Updates the apt package lists and installs the nginx-agent package using the apt package manager. The 'apt update' command refreshes the package list to include the newly added Nginx Agent repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update\nsudo apt install nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Configuring Git Username in Bash\nDESCRIPTION: This code snippet shows how to set the Git username using the `git config` command. It configures the `user.name` setting in the Git configuration. This is a crucial step when contributing to Git repositories.\nSOURCE: https://github.com/nginx/documentation/blob/main/templates/tutorial/guide-tutorial.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ngit config user.name \"Dakota Everson\"\n```\n\n----------------------------------------\n\nTITLE: Get NginxProxy configuration\nDESCRIPTION: Retrieves the NginxProxy resource named 'ngf-proxy-config' in YAML format. This shows the global tracing configuration applied to the NGINX data plane.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get nginxproxies.gateway.nginx.org ngf-proxy-config -o yaml\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Controller (bash)\nDESCRIPTION: This command executes the `controller restart` command using the helper script located at `/opt/nginx-controller/helper.sh`. This is used to restart the NGINX Controller service, typically after making configuration changes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_18\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh controller restart\n```\n\n----------------------------------------\n\nTITLE: Stopping Keepalived Service (bash)\nDESCRIPTION: This snippet stops the `keepalived` service on a node. This is a necessary step before performing maintenance or updates on the node to prevent failover.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/ha-data-plane.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl stop keepalived\n```\n\n----------------------------------------\n\nTITLE: Stopping NGINX Agent on CentOS/RHEL\nDESCRIPTION: This snippet demonstrates how to stop the NGINX Agent on CentOS and RHEL systems using systemctl. This step is a prerequisite for upgrading NGINX App Protect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/admin-guide/upgrade-nap-waf.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl stop nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Deploy Destination Service\nDESCRIPTION: This snippet deploys the destination service using a Kubernetes manifest file (dest-svc.yaml). It creates a Deployment, Service, ServiceAccount, and ConfigMap required for the destination service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f dest-svc.yaml\n```\n\n----------------------------------------\n\nTITLE: Including HTTP Configuration Files with Wildcard\nDESCRIPTION: Includes all HTTP configuration files ending with `-http.conf` from the conf.d directory using a wildcard. This simplifies including multiple configuration files for different HTTP-related functions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    include conf.d/*-http.conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Checking TLS SNI Support - Shell\nDESCRIPTION: This shell command checks if the NGINX binary was built with TLS SNI support by using the `-V` switch. The output will include `TLS SNI support enabled` if SNI support is included.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nnginx -V\n...\nTLS SNI support enabled\n...\n```\n\n----------------------------------------\n\nTITLE: Restart Specific Deployment - Bash\nDESCRIPTION: This command restarts a specific Kubernetes deployment named 'frontend' using the `kubectl rollout restart` command.  This is used to apply changes after configuring sidecar injection.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/inject-sidecar-proxy.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl rollout restart deployment/frontend\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX App Protect on Debian/Ubuntu\nDESCRIPTION: This snippet shows how to install NGINX App Protect on Debian and Ubuntu systems using apt-get. This command upgrades the existing installation to the latest version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/admin-guide/upgrade-nap-waf.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get install app-protect\n```\n\n----------------------------------------\n\nTITLE: Get App Protect Version\nDESCRIPTION: This code snippet shows the command to retrieve the App Protect version information, directing the output to a file named `package_versions.txt`. This file is later included in the troubleshooting tarball.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/troubleshooting-guide/troubleshooting.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\ncat /opt/app_protect/VERSION /opt/app_protect/RELEASE > package_versions.txt\n```\n\n----------------------------------------\n\nTITLE: Install njs module on FreeBSD\nDESCRIPTION: This snippet illustrates the command to install the `nginx-plus-module-njs` package on FreeBSD using the `pkg` package manager. The script updates the package repository and installs the module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginscript.md#_snippet_5\n\nLANGUAGE: Shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Remove SELinux Policy\nDESCRIPTION: This snippet removes the SELinux policy associated with the NGINX Controller Agent on CentOS/Red Hat Enterprise Linux systems. It reverts the installed permissions using `semodule`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-agent.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo semodule -r nginx\n```\n\n----------------------------------------\n\nTITLE: List Installed Compiler Versions (Shell)\nDESCRIPTION: This command lists the installed NGINX App Protect WAF compiler versions on the NGINX Instance Manager host. This is used to ensure the compiler version matches the NGINX App Protect WAF version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_31\n\nLANGUAGE: shell\nCODE:\n```\nls -l /opt/nms-nap-compiler\n```\n\n----------------------------------------\n\nTITLE: Verifying WAF Enforcement\nDESCRIPTION: This command is used to verify the WAF enforcement functionality. It sends a curl request to the localhost with a potentially malicious script in the URL. The WAF should reject this request if properly configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_46\n\nLANGUAGE: shell\nCODE:\n```\ncurl \"localhost/<script>\"\n```\n\n----------------------------------------\n\nTITLE: WAF Compiler Binary Command\nDESCRIPTION: This command shows how to execute the compiler binary directly from within the container, specifying global settings, policy and output file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/apcompile -g /path/to/global_settings.json -p /path/to/policy.json -o /path/to/compiled_policy.tgz\n```\n\n----------------------------------------\n\nTITLE: Uninstall Nginx Service Mesh Release via Helm\nDESCRIPTION: This command uninstalls the NGINX Service Mesh release `nsm` from the `nginx-mesh` namespace using Helm.  It's a crucial step in the manual upgrade process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade-with-helm.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nhelm uninstall nsm --namespace nginx-mesh\n```\n\n----------------------------------------\n\nTITLE: Description of system.net.packets_in.count and system.net.packets_out.count metrics\nDESCRIPTION: Provides the type and description for the system.net.packets_in.count and system.net.packets_out.count metrics which is a counter in integer representing Network I/O statistics. Number of packets received or sent, per network interface.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_10\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Network I/O statistics. Number of packets received or sent, per network\n               interface.\n```\n\n----------------------------------------\n\nTITLE: Downloading and Extracting NGINX Stable Source Code\nDESCRIPTION: These commands download and extract the source code for the latest NGINX stable version. This allows for compiling a stable release of NGINX from source.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_52\n\nLANGUAGE: shell\nCODE:\n```\nwget https://nginx.org/download/nginx-1.26.3.tar.gz\ntar zxf nginx-1.26.3.tar.gz\ncd nginx-1.26.3\n```\n\n----------------------------------------\n\nTITLE: Disabling ModSecurity Audit Logging\nDESCRIPTION: This snippet disables audit logging in the ModSecurity configuration by setting the `SecAuditEngine` directive to `off`. This is recommended for production environments to improve performance and prevent disk space exhaustion.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_21\n\nLANGUAGE: nginx\nCODE:\n```\nSecAuditEngine off\n```\n\n----------------------------------------\n\nTITLE: Configure SSH access to peers - Reload ssh (Ubuntu, Debian, SLES)\nDESCRIPTION: This command restarts the ssh service on Ubuntu, Debian, and SLES systems. The sudo command is used to execute the command with administrative privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart ssh\n```\n\n----------------------------------------\n\nTITLE: Restarting Nginx Agent (Shell)\nDESCRIPTION: This command restarts the NGINX Agent service using systemctl.  This is necessary after modifying the `agent-dynamic.conf` file for changes to take effect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/config-sync-groups/manage-config-sync-groups.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX App Protect WAF Package\nDESCRIPTION: This snippet shows the command to install the NGINX App Protect WAF package using the `dnf` package manager. The `sudo` command is used to execute the installation with administrative privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-amazon.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf install app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Listing Available Modules - Shell\nDESCRIPTION: This command is used to search for available Nginx Plus modules in the apt package manager cache on Debian and Ubuntu systems. It helps discover installable modules for extending Nginx's capabilities.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/dynamic-modules.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\napt-cache search nginx-plus-module\n```\n\n----------------------------------------\n\nTITLE: Decrypt Private Key OpenSSL\nDESCRIPTION: This command decrypts an encrypted private key file using OpenSSL. It prompts for the password used to encrypt the key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_14\n\nLANGUAGE: Shell\nCODE:\n```\nroot# openssl rsa -in company.com.key.encrypted -out company.com.key\n```\n\n----------------------------------------\n\nTITLE: Example NGINX configuration test output\nDESCRIPTION: This represents the expected output from the `nginx -t` command when the configuration is valid.  It confirms the syntax is ok and that the configuration file is successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/lua.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Stop NGINX Controller Agent Service (Bash)\nDESCRIPTION: This command stops the NGINX Controller Agent service. It utilizes the `service` command to stop the agent. This is typically executed on the NGINX Plus system where the agent is installed. Requires root or sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/agent-restart.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nservice controller-agent stop\n```\n\n----------------------------------------\n\nTITLE: Stream Accepted Connections Metric\nDESCRIPTION: Describes the 'plus.stream.conn.accepted' metric, which is a counter representing the total number of connections accepted from clients. This metric gives the total number of incoming TCP/UDP connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_19\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Total number of connections accepted from clients.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Apply Kubernetes Service Update (Shell)\nDESCRIPTION: This shell command applies the updated `deployments/service/loadbalancer-aws-elb.yaml` service definition to the Kubernetes cluster. It updates the service with the new externalTrafficPolicy setting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f deployments/service/loadbalancer-aws-elb.yaml\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration (Shell)\nDESCRIPTION: This command reloads the NGINX configuration without interrupting existing connections. It's essential to reload the configuration after making changes to apply the new settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/entra-id.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Stopping NGINX Agent Service (FreeBSD)\nDESCRIPTION: This command stops the NGINX Agent service using the service command on FreeBSD. It ensures the agent is not running before uninstall. Requires root privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/uninstall.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo service nginx-agent stop\n```\n\n----------------------------------------\n\nTITLE: APT Confirmation Prompt During NGINX Controller Agent Installation\nDESCRIPTION: This snippet displays the APT confirmation prompt encountered during the NGINX Controller Agent installation process. It highlights the potential issue of a partially installed agent if an invalid response is provided.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.2.md#_snippet_5\n\nLANGUAGE: none\nCODE:\n```\nDo you want to continue? [Y/n]\n```\n\n----------------------------------------\n\nTITLE: Configuring Host Tags\nDESCRIPTION: Explains how to define arbitrary tags on a per-host basis in the agent.conf file. Tags can be used to build custom graphs, configure alerts, and filter the systems on the Graphs page in the Amplify UI.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/configuring-amplify-agent.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\n[tags]\ntags = foo,bar,foo:bar\n```\n\n----------------------------------------\n\nTITLE: Port-Forwarding to Grafana Service\nDESCRIPTION: This command establishes a port forward to the Grafana service, allowing access to the Grafana dashboard from a local machine.  Replace `<grafana-namespace>` with the actual namespace where Grafana is deployed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/deploy-example-app.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nkubectl -n <grafana-namespace> port-forward svc/grafana 3000\n```\n\n----------------------------------------\n\nTITLE: Creating GZIP Archive\nDESCRIPTION: This bash command creates a gzipped tar archive named `nginx.tar.gz` from the directory `nginx`. This archive can then be uploaded to the Azure portal for NGINX configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configuration-portal.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n$ tar -czf nginx.tar.gz nginx\n```\n\n----------------------------------------\n\nTITLE: Redeploy NGINX Service Mesh - Bash\nDESCRIPTION: This snippet shows the commands to redeploy NGINX Service Mesh as a workaround for TLS errors during initial deployment.  It involves removing the existing deployment and then redeploying it using `nginx-meshctl`. This can resolve issues related to certificate authority communication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.1.0.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl remove\nnginx-meshctl deploy ...\n```\n\n----------------------------------------\n\nTITLE: Build NGINX Gateway Fabric image\nDESCRIPTION: This command builds only the NGINX Gateway Fabric image using make. It requires GNU Make and Docker to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/building-the-images.md#_snippet_3\n\nLANGUAGE: makefile\nCODE:\n```\nmake PREFIX=myregistry.example.com/nginx-gateway-fabric build-prod-ngf-image\n```\n\n----------------------------------------\n\nTITLE: Decrypting Private Key OpenSSL\nDESCRIPTION: This snippet decrypts the encrypted private key file created in the previous step using OpenSSL. The command prompts for the password used to encrypt the private key. The `-in` option specifies the encrypted key file, and `-out` specifies the decrypted key file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl rsa -in company.com.key.encrypted -out company.com.key\n```\n\n----------------------------------------\n\nTITLE: Azure CLI: Create Access Policy for Key Vault Secrets\nDESCRIPTION: This code snippet creates an access policy on an Azure Key Vault using the Azure CLI. It requires the `$KV_NAME` (key vault name), `$KV_RESOURCE_GROUP` (resource group name), and `$mi_principal_id` (principal ID of the managed identity) variables to be set. This command grants 'get' permission for secrets to the specified managed identity on the key vault.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\naz keyvault set-policy --name $KV_NAME \\\n      --resource-group $KV_RESOURCE_GROUP \\\n      --object-id $mi_principal_id \\\n      --secret-permissions get\n```\n\n----------------------------------------\n\nTITLE: Querying Active Directory User with ldapsearch\nDESCRIPTION: This command uses ldapsearch to query for a specific user in Active Directory. It requires ldapsearch to be installed and configured to connect to the LDAP server. The command specifies the LDAP server address, base DN, bind DN, and search filter. The -ZZ option enables TLS encryption, -W prompts for the bind password, -H specifies the LDAP server, -b specifies the base DN, -D specifies the bind DN, and the final string specifies the search filter to find a user with the common name 'Jane Doe'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nldapsearch -ZZ -W -H ldap://ldap.example.com \\\n             -b \"DC=ldap,DC=example,DC=com\" \\\n             -D \"uid=search-user,ou=People,dc=example,dc=com\" \\\n             \"(&(objectClass=person)(CN=Jane Doe))\"\n```\n\n----------------------------------------\n\nTITLE: Deleting Database Entry using curl\nDESCRIPTION: This shell command uses curl to delete an entry from the keyval zone by setting its value to null.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/denylisting-ip-addresses.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X PATCH -d '{\"10.0.0.4\":null}' -s 'http://www.example.com/api/6/http/keyvals/one'\n```\n\n----------------------------------------\n\nTITLE: Stop Controller Agent - CentOS/Red Hat\nDESCRIPTION: This snippet stops the NGINX Controller Agent service on CentOS/Red Hat Enterprise Linux systems using the `systemctl` command. This is a prerequisite for uninstalling the agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-agent.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsystemctl stop controller-agent\n```\n\n----------------------------------------\n\nTITLE: Docker Login\nDESCRIPTION: This command logs into a private Docker registry using the Docker CLI. Replace `<my-docker-registry:port>` with the address and port of your private Docker registry.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/deploy-api-connectivity-manager.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ndocker login <my-docker-registry:port>\n```\n\n----------------------------------------\n\nTITLE: Defining Match Block for UDP Health Checks - NGINX\nDESCRIPTION: Defines a `match` block named `udp_test` for custom UDP health check tests. This block is referenced from the `health_check` directive using the `match` parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    match  udp_test {\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Shell Command to Restart NGINX Agent\nDESCRIPTION: This shell command restarts the NGINX Agent service using `systemctl`. This is required after modifying the NGINX Agent configuration file to apply the changes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Plus package using yum\nDESCRIPTION: This shell command installs the nginx-plus package using the yum package manager. It is assumed that yum is configured and has access to the NGINX Plus repository. Any previous NGINX Plus installation will be replaced.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/install-nginx-plus-package-yum.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install nginx-plus\n```\n\n----------------------------------------\n\nTITLE: Install NGINXaaS Azure CLI Extension\nDESCRIPTION: This command installs the `nginx` extension for the Azure CLI. This extension is required to manage NGINXaaS deployments. The `--allow-preview` flag allows the installation of preview versions of the extension.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/client-tools/cli.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\naz extension add --name nginx --allow-preview true\n```\n\n----------------------------------------\n\nTITLE: OpenAPI security requirement example\nDESCRIPTION: Example showing an OpenAPI security requirement block with an empty `security` object that can cause API Connectivity Manager to crash when uploading the specification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\n\"security\": [{}]\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Amplify Agent on CentOS/Red Hat\nDESCRIPTION: This command uninstalls the NGINX Amplify Agent from CentOS or Red Hat based systems using the yum package manager. The command removes the package and its configuration files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/uninstalling-amplify-agent.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nyum remove nginx-amplify-agent\n```\n\n----------------------------------------\n\nTITLE: Renewing kubeadm certificates\nDESCRIPTION: This command renews all Kubernetes certificates using kubeadm. It is a crucial step in resolving kubelet certificate expiration issues.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nsudo kubeadm alpha certs renew all\n```\n\n----------------------------------------\n\nTITLE: Boolean Field JSON Schema Example\nDESCRIPTION: This JSON schema snippet defines a boolean field named 'isDevelopment'. It uses the 'boolean' type, allowing for true or false values within the configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/reference/json-schema-reference.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"isDevelopment\": {\n      \"type\": \"boolean\"\n    }\n  }\n```\n\n----------------------------------------\n\nTITLE: App Protect Configuration Load Failure Error Shell\nDESCRIPTION: This shell code represents the error message that is displayed when the policy configuration fails to load in App Protect. This indicates that the policy compilation has failed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-references.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nAPP_PROTECT { \"event\": \"configuration_load_failure\" ...\n```\n\n----------------------------------------\n\nTITLE: Set Default Command\nDESCRIPTION: This sets the default command to start Nginx in the foreground, ensuring the container remains running. The `daemon off;` directive prevents Nginx from daemonizing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-ubuntu.md#_snippet_3\n\nLANGUAGE: dockerfile\nCODE:\n```\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Copy NGINX Repository Files - Bash\nDESCRIPTION: Copies the NGINX repository certificate and key files to the `/etc/ssl/nginx/` directory. This is a prerequisite for installing NGINX Plus and njs packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-devportal-offline.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo cp nginx-repo.crt /etc/ssl/nginx/\nsudo cp nginx-repo.key /etc/ssl/nginx/\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Plus Version\nDESCRIPTION: This command checks the installed version of NGINX Plus to ensure it meets the minimum requirement (Release 34 or later) for using the OpenID Connect module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/cognito.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nnginx -v\n```\n\n----------------------------------------\n\nTITLE: Example Output of NGINX Configuration Test\nDESCRIPTION: This shows the expected output after running `nginx -t` if the configuration is valid. It confirms the syntax is correct and the file is successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/rtmp.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Extract NGINX Controller Installer Package (tar)\nDESCRIPTION: This command extracts the NGINX Controller installer package from a tar.gz archive.  The <version> placeholder should be replaced with the actual version number of the controller installer package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ntar xzf controller-installer-<version>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Reloading NGINX Configuration (Shell)\nDESCRIPTION: This command reloads the NGINX configuration file without interrupting existing connections. This is necessary to activate the OpenTelemetry module after it has been loaded in the configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Restore NGINX Controller Cluster Config and Encryption Keys\nDESCRIPTION: This command restores the NGINX Controller cluster configuration and encryption keys from a specified `.tgz` archive.  The `<filename>` should be the path to the backup file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh cluster-config load <filename>\n```\n\n----------------------------------------\n\nTITLE: Generating RSA Key\nDESCRIPTION: Generates a new RSA private key with a key size of 2048 bits and saves it to the specified file. Requires openssl to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl genrsa -out ~/example.com.key 2048\n```\n\n----------------------------------------\n\nTITLE: Unmount NFS Share (Bash)\nDESCRIPTION: This command unmounts the NFS share from `/mnt/local_pgdata`, detaching the NFS volume from the local filesystem.  `sudo` is required.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-embedded-config-db.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nsudo umount /mnt/local_pgdata\n```\n\n----------------------------------------\n\nTITLE: Stop and Start NGINX Controller - Bash\nDESCRIPTION: These commands stop and start the NGINX Controller using `helper.sh`.  They are required after renewing the kubelet server certificate.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nsudo helper.sh controller stop\nsudo helper.sh controller start\n```\n\n----------------------------------------\n\nTITLE: Restarting NGINX App Protect on CentOS/RHEL\nDESCRIPTION: This snippet demonstrates how to restart NGINX App Protect on CentOS and RHEL systems using systemctl. This applies the updates after installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/admin-guide/upgrade-nap-waf.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx-app-protect\n```\n\n----------------------------------------\n\nTITLE: Reloading BIND DNS Service\nDESCRIPTION: This shell script demonstrates how to reload the BIND DNS service after updating the zone file. Reloading the service ensures that the changes are applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl reload bind9\n```\n\n----------------------------------------\n\nTITLE: Adding Exchange Servers to Upstream Group in NGINX\nDESCRIPTION: This snippet adds Microsoft Exchange servers to the upstream group. It also enables the `zone` directive and `ntlm` authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_21\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    upstream exchange {\n        zone exchange 64k;\n        ntlm;\n        server exchange1.example.com;\n        server exchange2.example.com;\n        # ...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Start NGINX service - Debian and Ubuntu\nDESCRIPTION: This command starts the NGINX service. `sudo systemctl start nginx` initiates the Nginx web server process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_25\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl start nginx\n```\n\n----------------------------------------\n\nTITLE: Restarting NGINX Amplify Agent (Bash)\nDESCRIPTION: This command restarts the NGINX Amplify Agent service. This is needed to apply the changes made to the agent configuration file, particularly after enabling the PHP-FPM extension.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/other-metrics.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nservice amplify-agent restart\n```\n\n----------------------------------------\n\nTITLE: Save NGINX Controller Cluster Configuration\nDESCRIPTION: This command saves the NGINX Controller cluster configuration and encryption keys. These are required if you need to restore the config database on top of a new installation of NGINX Controller. The saved configuration is essential for disaster recovery.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh cluster-config save\n```\n\n----------------------------------------\n\nTITLE: Install GNU Make (Ubuntu)\nDESCRIPTION: Installs the GNU Make package on Ubuntu using the Advanced Packaging Tool (APT). GNU Make is a build automation tool used to build the NGINX Agent container images.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt install make\n```\n\n----------------------------------------\n\nTITLE: Stopping the Controller Agent Service - Ubuntu/Debian\nDESCRIPTION: This command stops the NGINX Controller Agent service on Ubuntu or Debian systems. This step is necessary before uninstalling the agent or deleting the associated NGINX instance from NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-instances.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nservice controller-agent stop\n```\n\n----------------------------------------\n\nTITLE: Introspect User Access Token\nDESCRIPTION: This command introspects a user access token using the Keycloak token introspection endpoint. It requires providing the access token.  Keycloak must be configured to accept basic auth credentials from the client (CLIENT_ID:CLIENT_SECRET), which must be base64 url encoded and passed in the Authorization header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ncurl -L -X POST 'http://{HOST/IP_ADDRESS}:{PORT}/realms/{REALM}/protocol/openid-connect/token/introspect' \\\n   -H \"Authorization: Bearer <access token>\" \\\n   -H \"Accept: application/json\" \\\n   -H \"Content-Type: application/x-www-form-urlencoded\" \\\n   --data-urlencode 'token=<ACCESS_TOKEN>' \\\n   | jq\n```\n\n----------------------------------------\n\nTITLE: Install NLK controller as AKS Extension using Azure CLI\nDESCRIPTION: This snippet installs the NLK controller as an AKS extension using the Azure CLI.  It requires customizing the AKS cluster name and resource group. It sets the extension type, scope, cluster details, and configuration parameters, including the data plane API key and the NGINX hosts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/loadbalancer-kubernetes.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\n## Customize this to provide the details about my already created AKS cluster\naksName=myCluster\naksGroup=myClusterGroup\naz k8s-extension create \\\n  --name nlk \\\n  --extension-type \"nginxinc.nginxaas-aks-extension\" \\\n  --scope cluster \\\n  --cluster-name ${aksName} \\\n  --resource-group ${aksGroup} \\\n  --cluster-type managedClusters \\\n  --plan-name f5-nginx-for-azure-aks-extension \\\n  --plan-product f5-nginx-for-azure-aks-extension \\\n  --plan-publisher f5-networks \\\n  --release-namespace nlk \\\n  --config nlk.dataplaneApiKey=${keyValue} \\\n  --config nlk.config.nginxHosts=${dataplaneAPIEndpoint}nplus\n```\n\n----------------------------------------\n\nTITLE: Referring to a match block in Nginx health_check\nDESCRIPTION: This snippet shows how to refer to a previously defined `match` block within the `health_check` directive. The `match` parameter is set to the name of the `match` block (`tcp_test`) to specify which health check tests should be applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    server {\n        listen       12345;\n        health_check match=tcp_test;\n        proxy_pass   stream_backend;\n    }\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Backing up Kubernetes configuration\nDESCRIPTION: This command moves the existing Kubernetes configuration file to a backup location.  This is done to replace it with a new, valid configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nmv .kube/config .kube/config.old\n```\n\n----------------------------------------\n\nTITLE: Upstream Status Code Metrics\nDESCRIPTION: Describes the 'plus.upstream.status.1xx', 'plus.upstream.status.2xx', 'plus.upstream.status.3xx', 'plus.upstream.status.4xx', and 'plus.upstream.status.5xx' metrics, which are counters tracking the number of responses from the upstream servers with corresponding status codes. These metrics offer insight into the success/failure rates of upstream requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_10\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Number of responses from the upstream servers with status codes 1xx, 2xx,\n               3xx, 4xx, and 5xx.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Configure NFS Volume Drivers (YAML)\nDESCRIPTION: Defines Docker volumes with NFS driver options for persistent storage. This allows the containers to use NFS shares for data storage. Replace `<<nfs-ip>>` with the actual IP address of the NFS server, and ensure the specified NFS shares are accessible.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_13\n\nLANGUAGE: yaml\nCODE:\n```\nvolumes:\n  # By default docker compose will create a named volume\n  # Refer to https://docs.docker.com/reference/compose-file/volumes/ for additional storage options such as NFS\n  nim-data:\n    driver: local\n    driver_opts:\n      type: \"nfs\"\n      o: \"addr=<<nfs-ip>>,rw\"\n      device: \":/mnt/nfs_share/data\"\n  clickhouse-data:\n    driver: local\n    driver_opts:\n      type: \"nfs\"\n      o: \"addr=<<nfs-ip>>,rw\"\n      device: \":/mnt/nfs_share/clickhouse\"\n```\n\n----------------------------------------\n\nTITLE: Description of system.disk.free metric\nDESCRIPTION: Provides the type and description for the system.disk.free metric which is a gauge in bytes that tracks System disk usage statistics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, bytes\nDescription: System disk usage statistics.\n```\n\n----------------------------------------\n\nTITLE: Running the gRPC server\nDESCRIPTION: Instruction to run the gRPC server implemented in Python. This command executes the `server.py` script which starts the gRPC server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/services/publish-gRPC-proxy.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\npython server.py\n```\n\n----------------------------------------\n\nTITLE: Downloading Enhanced Load Balancing Configuration\nDESCRIPTION: Downloads the complete configuration file for enhanced load balancing from the specified URL and saves it to the jboss-enhanced.conf file in the /etc/nginx/conf.d directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_7\n\nLANGUAGE: none\nCODE:\n```\nroot# cd /etc/nginx/conf.d\nroot# curl https://www.nginx.com/resource/conf/jboss-enhanced.conf > jboss-enhanced.conf\n```\n\n----------------------------------------\n\nTITLE: Edit NGINX Agent Repo File - Shell\nDESCRIPTION: Opens the nginx-agent.repo file in the /etc/yum.repos.d/ directory using the vi editor. This allows manual configuration of the Nginx Agent repository settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo vi /etc/yum.repos.d/nginx-agent.repo\n```\n\n----------------------------------------\n\nTITLE: OpenTelemetry Collector Configuration Example\nDESCRIPTION: This is an example configuration for OpenTelemetry Collector that receives OTLP data on HTTP, HTTPS, gRPC, and gRPC+TLS endpoints and forwards it to DataDog. It defines the receivers, exporters, and the service pipeline to process metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/integrations/otlp-integration.md#_snippet_0\n\nLANGUAGE: YAML\nCODE:\n```\nreceivers:\n  otlp/https:\n    protocols:\n      http:\n        endpoint: \"0.0.0.0:4318\"\n        tls_settings:\n          cert_file: /etc/otel/server.crt\n          key_file: /etc/otel/server.key\n  otlp/http:\n    protocols:\n      http:\n        endpoint: \"0.0.0.0:4319\"\n  otlp/grpc_tls:\n    protocols:\n      grpc:\n        endpoint: \"0.0.0.0:4418\"\n        tls_settings:\n          cert_file: /etc/otel/server.crt\n          key_file: /etc/otel/server.key\n  otlp/grpc:\n    protocols:\n      grpc:\n        endpoint: \"0.0.0.0:4419\"\nexporters:\n    datadog:\n        api:\n          key: key\nservice:\n  pipelines:\n    metrics/1:\n      receivers: [otlp/http, otlp/https, otlp/grpc_tls, otlp/grpc]\n      exporters: [datadog]\n```\n\n----------------------------------------\n\nTITLE: Define Stop Signal in Dockerfile\nDESCRIPTION: This snippet defines the stop signal for the Docker container as SIGQUIT. This is used when stopping the container to gracefully shut down Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-plus/build-debian.md#_snippet_2\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n```\n\n----------------------------------------\n\nTITLE: Getting Nginx Ingress Controller Pods\nDESCRIPTION: This command retrieves a list of pods running in the `nginx-ingress` namespace, helping to identify the NGINX Ingress Controller pod name for further inspection. It uses `kubectl get pods` with the `-n` flag to specify the namespace.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_10\n\nLANGUAGE: Shell\nCODE:\n```\nkubectl get pods -n nginx-ingress\n```\n\n----------------------------------------\n\nTITLE: Adding Status Zone Directive to Server Block\nDESCRIPTION: This snippet adds the `status_zone` directive to the `server` block for HTTPS traffic.  This directive associates the server block with the shared memory zone created for the upstream group, enabling collection of statistics for the server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/wildfly.md#_snippet_34\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nstatus_zone jboss;\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX service\nDESCRIPTION: Restarts the Nginx service to apply the changes made to the Nginx configuration file.  This command ensures that the updated worker connection and file descriptor settings are loaded and used by Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-gateway.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Creating certificate directory and copying certificates\nDESCRIPTION: This set of commands creates a directory for storing SSL certificates for the NGINX Container Registry and copies the Nginx repository certificate and key files to that directory. This is required for Docker to trust the registry.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nmkdir -p /etc/docker/certs.d/private-registry.nginx.com\ncp <path-to-your-nginx-repo.crt> /etc/docker/certs.d/private-registry.nginx.com/client.cert\ncp <path-to-your-nginx-repo.key> /etc/docker/certs.d/private-registry.nginx.com/client.key\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Open Source (Ubuntu 20.04)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Open Source package from Ubuntu 20.04. It uses the `apt-get remove` command to remove the `app-protect-module-oss` package. Requires root privileges and the apt package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_66\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get remove app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Deleting Resources Using Kubectl\nDESCRIPTION: This command deletes all resources defined in the specified YAML files (bursty-client.yaml, ratelimit-burst.yaml, and destination.yaml) from the Kubernetes cluster, cleaning up the environment after the rate limiting experiment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_24\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete -f bursty-client.yaml -f ratelimit-burst.yaml -f destination.yaml\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Plus Package\nDESCRIPTION: Installs the nginx-plus package using the APT package manager. The -y flag automatically confirms the installation, and any older NGINX Plus packages are replaced.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt install -y nginx-plus\n```\n\n----------------------------------------\n\nTITLE: Create Nginx SSL Directory\nDESCRIPTION: This command creates the `/etc/ssl/nginx/` directory on the host where NGINX Instance Manager is being installed. This directory is used to store the SSL certificate and private key required for adding the official repository during installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo mkdir -p /etc/ssl/nginx\n```\n\n----------------------------------------\n\nTITLE: Example of Error Status in NGINX Controller REST API Response\nDESCRIPTION: This JSON snippet shows an example of an error message within the `currentStatus.state.conditions` object returned by the NGINX Controller REST API when querying data forwarders. The message indicates an issue with an Integration reference.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-forwarders.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"currentStatus\": {\n        \"integrationRef\": {\n            \"ref\": \"/platform/integrations/splunk\"\n        },\n        \"state\": {\n            \"conditions\": [\n                {\n                    \"message\": \"error code: 440001, Integration with reference '/platform/integrations/splunk_events' cannot be found. Please check if the Integration reference is correct.\",\n                    \"type\": \"error\"\n                }\n            ],\n        ...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Querying NS1 API for Data Feed Status (up)\nDESCRIPTION: This code snippet queries the NS1 API to verify the status of a data feed, ensuring that NS1 also perceives the upstream group as 'up'. It uses `curl` to send a GET request to the NS1 API, including an API key. The output is then parsed with `python -m json.tool` to make it human-readable.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\n$ curl -X GET -H 'X-NSONE-Key: <NS1-API-key>' https://api.nsone.net/v1/data/feeds/<NS1-data-source-ID> | python -m json.tool\n[\n  ...\n  {\n    \"destinations\": [\n      {\n        \"destid\": \"<Answer-ID>\",\n        \"desttype\": \"answer\",\n        \"record\": \"<Record-ID>\"\n      }\n    ],\n    \"id\": \"<Feed-ID>\",\n    \"data\": {\n      \"up\": \"true\"\n    },\n    \"config\": {\n      \"label\": \"us-nginxgslb-datafeed\"\n    },\n    \"name\": \"us-nginxgslb-datafeed\"\n  },\n  ...\n]\n```\n\n----------------------------------------\n\nTITLE: Stop Kubelet Service - Bash\nDESCRIPTION: This command stops the kubelet service using `systemctl`. This is a preliminary step in the workaround for expired Kubernetes kubelet certificates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl stop kubelet\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Service Mesh Chart from GitHub\nDESCRIPTION: Downloads the NGINX Service Mesh chart from GitHub, which is necessary for installing the chart from its sources or upgrading CRDs.  Requires git to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install-with-helm.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ngit clone https://github.com/nginxinc/nginx-service-mesh\ncd nginx-service-mesh/helm-chart\ngit checkout v2.0.0\n```\n\n----------------------------------------\n\nTITLE: Restart Controller Agent (systemctl)\nDESCRIPTION: This snippet shows how to restart the NGINX Controller Agent using the systemctl command. This is required after modifying the agent's configuration file. Restarting ensures that the agent picks up the new settings and applies them.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_39\n\nLANGUAGE: bash\nCODE:\n```\nsystemctl restart controller-agent\n```\n\n----------------------------------------\n\nTITLE: App Protect Resource Exception Log Event JSON\nDESCRIPTION: This JSON object represents a resource (e.g., CPU) exceeding defined limits. The 'resource' and 'threshold' attributes provide details about the specific resource and threshold exceeded. The log level is Warning.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/operation-logs.md#_snippet_3\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"event\": \"waf_resource_exception\",\n    \"bd_thread_id\": 3,\n    \"worker_pid\": 4928,\n    \"mode\": \"failure\",\n    \"mode_changed\": true,\n    \"resource\": \"cpu\",\n    \"value\": 98,\n    \"threshold\": 95\n}\n```\n\n----------------------------------------\n\nTITLE: ClientSettingsPolicy status example\nDESCRIPTION: This snippet shows the expected output of describing the ClientSettingsPolicy, confirming that the policy has been accepted and displays ancestor information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_10\n\nLANGUAGE: text\nCODE:\n```\nStatus:\n  Ancestors:\n    Ancestor Ref:\n      Group:      gateway.networking.k8s.io\n      Kind:       Gateway\n      Name:       gateway\n      Namespace:  default\n    Conditions:\n      Last Transition Time:  2024-05-30T19:57:18Z\n      Message:               Policy is accepted\n      Observed Generation:   1\n      Reason:                Accepted\n      Status:                True\n      Type:                  Accepted\n    Controller Name:         gateway.nginx.org/nginx-gateway-controller\nEvents:                      <none>\n```\n\n----------------------------------------\n\nTITLE: Enabling precompiled publication for App Protect policies in nginx-agent.conf\nDESCRIPTION: This code snippet shows how to enable the `precompiled_publication` parameter in the `nginx-agent.conf` file to continue publishing security policies with Instance Manager after upgrading from version 2.7 or earlier. Setting this parameter to `true` is necessary because the default value changed to `false` in version 2.8.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/release-notes.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\nnginx_app_protect:\n   precompiled_publication: true\n```\n\n----------------------------------------\n\nTITLE: Create NGINXaaS Deployment with Private IP (Dynamic Allocation) (Azure CLI)\nDESCRIPTION: This example creates an NGINXaaS deployment configured with a private IP address using dynamic allocation. It sets the name, resource group, location, and SKU. The `network-profile` parameter configures the front-end IP with a specified subnet ID and a dynamic private IP allocation. An existing virtual network/subnet is required.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/create-deployment/deploy-azure-cli.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment create --name myDeployment --resource-group \\\n      myResourceGroup --location eastus2 --sku \\\n      name=\"standardv2_Monthly\" --network-profile \\\n      front-end-ip-configuration=\"{private-ip-addresses:[{private-ip-allocation-method:Dynamic,subnet-id:/subscriptions/mySubscription/resourceGroups/myResourceGroup/providers/Microsoft.Network/virtualNetworks/myVNet/subnets/mySubnet,private-ip-address:10.0.0.2}]}\" \\\n      network-interface-configuration=\"{subnet-id:/subscriptions/mySubscription/resourceGroups/myResourceGroup/providers/Microsoft.Network/virtualNetworks/myVNet/subnets/mySubnet}\"\n```\n\n----------------------------------------\n\nTITLE: Renew Kubernetes Certificates - Bash\nDESCRIPTION: This command renews all Kubernetes certificates using the `kubeadm` tool. It's a key step in the workaround for expired Kubernetes kubelet certificates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo kubeadm alpha certs renew all\n```\n\n----------------------------------------\n\nTITLE: Restart Nginx Controller Agent (sudo)\nDESCRIPTION: This command restarts the Nginx Controller Agent service, using sudo for elevated privileges. This is necessary if the user does not have sufficient permissions to restart the service directly. Requires sudo privileges and the controller-agent service to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-controller.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart controller-agent\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Plus OpenTelemetry Module on Debian and Ubuntu (Shell)\nDESCRIPTION: This command updates the package repositories and installs the `nginx-plus-module-otel` package on Debian and Ubuntu systems.  This installs the OpenTelemetry module for NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update  && \\\nsudo apt install nginx-plus-module-otel\n```\n\n----------------------------------------\n\nTITLE: Stop Docker Service\nDESCRIPTION: This snippet demonstrates stopping the Docker service using `systemctl`.  This is a step in the workaround for an issue encountered during NGINX Controller installation on CentOS 7.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_40\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl stop docker\n```\n\n----------------------------------------\n\nTITLE: HTML Structure for NGINXaaS Cost Calculator\nDESCRIPTION: This HTML snippet defines the structure of the cost calculator, including input fields for connection estimates, bandwidth, region selection, NCU count, usage hours, listen ports, and WAF usage. It also includes elements for displaying calculated NCU needs, estimated costs, and detailed calculations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/billing/usage-and-cost-estimator.md#_snippet_0\n\nLANGUAGE: HTML\nCODE:\n```\n<link rel=\"stylesheet\" href=\"/nginxaas-azure/css/cost-calculator_v2.css\">\n<div id=\"calculator\">\n    <h3 id=\"calculator-section-heading\">\n            Cost Estimation for Standard V2 Plan\n            <button id=\"printButton\">Print Estimate</button>\n        </h3>\n    <div class=\"section\">\n        <div class=\"form-section\">\n            <div class=\"form-section-content\">\n                <h4>1. Estimate NCU Usage </h4>\n                <div>\n                    <div class=\"form-field\">\n                        <label for=\"avgNewConnsPerSec\">\n                            Average New Connections per Second\n                        </label>\n                        <input id=\"avgNewConnsPerSec\" type=\"number\" />\n                    </div>\n                    <div class=\"form-field avg-conn-duration-container\">\n                        <label for=\"avgConnDuration\">\n                            Average Connection Duration\n                        </label>\n                        <input id=\"avgConnDuration\" type=\"number\" />\n                    </div>\n                    <div class=\"form-field bandwidth-input-container\">\n                        <label for=\"totalBandwidth\">\n                            Total Processed Data\n                        </label>\n                        <input id=\"totalBandwidth\" type=\"number\" />\n                    </div>\n                </div>\n            </div>\n            <div class=\"form-section-content\">\n                <div class=form-section-footer>\n                    <div class=\"totals\">\n                        <span>NGINX Capacity Units Needed</span>\n                        <span id=\"ncuEstimateValue\">--</span>\n                        <span> Sold in bundles of 10, with a minimum of 10</span>\n                    </div>\n                    <details id=\"ncu-usage-details\">\n                        <summary>Show calculations</summary>\n                        <div id=\"ncuEstimateDetails\">\n                        <div class=\"math\">\n                            <var id=\"ncuEstConnRate\">x</var> new connections per second *\n                            <var id=\"ncuEstConnDuration\">y</var> average connection duration seconds =\n                            <var id=\"ncuEstAvgConn\">z</var> average concurrent connections\n                        </div>\n                        <pre class=\"math\">\nMax(\n    <var id=\"ncuEstAvgConn2\">x</var> concurrent connections / <span id=\"ncuEstConnsPerNcu\"></span> Conns per NCU,\n    <var id=\"ncuEstConnRate2\">y</var> connections per second / <span id=\"ncuEstConnsPerSecondPerNcu\"></span> conns per second per NCU,\n    <var id=\"ncuEstDataRate\">z</var> Mbps / <span id=\"ncuEstMbpsPerNcu\"></span>Mbps per NCU\n) = <var id=\"ncuEstMin1\"></var> NCUs\n</pre>\n                        <div class=\"math\">\n                            Usage needs at least <var id=\"ncuEstMin\">x</var> NCUs, rounded to the nearest 10, with a minimum of 10 = <var id=\"ncuEstTotal\">total</var> NCUs\n                        </div>\n                        </div>\n                    </details>\n                </div>\n            </div>\n        </div>\n        <div class=\"form-section\">\n        <div class=form-section-content>\n            <h4 id=\"calculator-section-heading\">\n               2. Estimate Monthly Cost\n            </h4>\n            <div class=\"form-field\">\n                <label for=\"region\">\n                    Region\n                </label>\n                <select id=\"region\">\n                <!-- options appended from tiers data -->\n                </select>\n            </div>\n            <div class=\"form-field\">\n                <label for=\"numNcus\">\n                    NCUs <span class=\"label-details\">- value from usage estimate: <span id=\"numNcusEstVal\"> - </span></span>\n                </label>\n                <input id=\"numNcus\" type=\"number\" step=\"10\" min=\"10\" />\n                <span id=\"ncuValidation\"></span>\n            </div>\n            <div class=\"form-field\">\n                <label for=\"numHours\">\n                    Hours <span class=\"label-details\">- used in a month</span>\n                </label>\n                <input id=\"numHours\" type=\"number\"/>\n            </div>\n            <div class=\"form-field\">\n                <label for=\"numListenPorts\">\n                    Listen Ports <span class=\"label-details\">- first 5 are included</span>\n                </label>\n                <input id=\"numListenPorts\" type=\"number\"/>\n            </div>\n            <div class=\"form-field\">\n                <label for=\"isWAF\">\n                    Utilize WAF <span class=\"label-details\"></span>\n                </label>\n                <input type=\"checkbox\" id=\"isWAF\" />\n            </div>\n            </div>\n            <div class=form-section-content>\n                <div id=\"totals-section\">\n                    <span class=\"total-text\">Total Monthly Payment</span>\n                    <span id=\"total-value\" class=\"total-text\">--</span>\n                    <div class=\"subtitle\">\n                        The standard Azure networking and bandwidth charges apply to NGINX deployments.\n                    </div>\n                    <details id=\"total-cost-details\">\n                        <summary>Show calculations</summary>\n                        <div class=\"details-content\">\n                            <div class=\"details-section\">\n                                <p class=\"math\">\n                                    <var id=\"cost-detail-hours\"></var> hours * ((<var id=\"cost-detail-ncus\"></var> NCUs * <var id=\"cost-detail-tier-cost\"></var> per NCU per hour) + <var id=\"cost-detail-listen-ports\"></var> additional listen ports * <var id=\"cost-detail-listen-ports-cost\"></var>) = <var id=\"cost-detail-total\"></var>\n                                    </br>\n                                </p>\n                            </div>\n                            <div class=\"details-section\">\n                                <table class=\"math\" id=\"tiers-costs-table\">\n                                    <tr>\n                                        <th>Region</th>\n                                        <th>Tier</th>\n                                        <th>Cost per NCU/hr</th>\n                                    </tr>\n                                    <!-- tier costs data appended here -->\n                                </table>\n                            </div>\n                        </div>\n                    </details>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n```\n\n----------------------------------------\n\nTITLE: Configure Swagger UI Location in NGINX\nDESCRIPTION: This code snippet configures a location block in NGINX for serving the Swagger UI. It uses the `root` directive to specify the directory containing the Swagger UI files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_24\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /swagger-ui {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Create Workspace using API - JSON Payload\nDESCRIPTION: This JSON payload is used to create a new Workspace via the API. It includes the workspace name, metadata description, and contact details for the workspace administrator. The `infraWorkspaceName` placeholder needs to be replaced with the actual workspace name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/infrastructure/manage-api-infrastructure.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"name\":  \"{{infraWorkspaceName}}\",\n    \"metadata\": {\n        \"description\": \"Petstore Team Workspace\"\n    },\n    \"contactDetails\": {\n        \"adminEmail\": \"admin@example.com\",\n        \"adminName\": \"I.M. Admin\",\n        \"adminPhone\": \"555 123 1234\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Perl Module (Debian/Ubuntu)\nDESCRIPTION: This shell script updates the package manager and installs the `nginx-plus-module-perl` package on Debian and Ubuntu systems. It uses the `apt` package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/perl.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-perl\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Service Mesh Helm Release\nDESCRIPTION: This command uninstalls the NGINX Service Mesh Helm release. It's an alternative to using `nginx-meshctl remove` when the mesh was installed via Helm.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nhelm uninstall nsm --namespace nginx-mesh\n```\n\n----------------------------------------\n\nTITLE: Starting NGINX Server\nDESCRIPTION: This command starts the NGINX web server. It requires NGINX to be installed on the system. After executing this command, Nginx should be running and serving web traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_45\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx\n```\n\n----------------------------------------\n\nTITLE: Shell Command Output Example\nDESCRIPTION: Illustrates the output of a single line shell command, potentially truncated and with sensitive information changed. This snippet always follows the single line shell command snippet.\nSOURCE: https://github.com/nginx/documentation/blob/main/archetypes/tutorial.md#_snippet_4\n\nLANGUAGE: text\nCODE:\n```\n<the output of that command, possibly truncated and with changed IPs or domains>\n```\n\n----------------------------------------\n\nTITLE: Disabling Telemetry using Helm\nDESCRIPTION: This command disables product telemetry during the installation of NGINX Gateway Fabric using Helm. It sets the `nginxGateway.productTelemetry.enable` flag to `false`, preventing the collection of telemetry data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/product-telemetry.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nhelm install ... --set nginxGateway.productTelemetry.enable=false\n```\n\n----------------------------------------\n\nTITLE: Expected Output of Nginx Configuration Test\nDESCRIPTION: This is the expected output after running `nginx -t` if the configuration file is valid. It confirms that the syntax is ok and the configuration is successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/xslt.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Restart Controller Agent\nDESCRIPTION: This code snippet shows how to restart the NGINX Controller Agent service. Restarting the agent is necessary for configuration changes to take effect. The command uses `service` to manage the `controller-agent` service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/config-agent/configure-the-agent.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\n# service controller-agent restart\n```\n\n----------------------------------------\n\nTITLE: Obtaining Nginx worker process PID\nDESCRIPTION: Retrieves the process ID (PID) of the Nginx worker process using `ps` and `grep`. This PID is needed to attach the GDB debugger to the running process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_28\n\nLANGUAGE: shell\nCODE:\n```\nps axu | grep nginx\n```\n\n----------------------------------------\n\nTITLE: Stopping NGINX Agent Service (rc-service)\nDESCRIPTION: This command stops the NGINX Agent service using rc-service, used in Alpine Linux distributions. It ensures the agent is not running before uninstall. Requires root privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/uninstall.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo rc-service nginx-agent stop\n```\n\n----------------------------------------\n\nTITLE: WAF Compiler Example Usage - Shell\nDESCRIPTION: This command shows example usage of the WAF compiler with a specific version. This also requires root privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_33\n\nLANGUAGE: shell\nCODE:\n```\nsudo /opt/nms-nap-compiler/app_protect-5.342.0/bin/apcompile -h\n```\n\n----------------------------------------\n\nTITLE: Pulling NGINX Plus Modules Image\nDESCRIPTION: This command pulls the NGINX Plus dynamic modules image from the private NGINX registry. The <version-tag> should be replaced with the specific version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\ndocker pull private-registry.nginx.com/nginx-plus/modules:<version-tag>\n```\n\n----------------------------------------\n\nTITLE: Define Stream Block NGINX\nDESCRIPTION: This code snippet creates a top-level `stream {}` block in the Nginx configuration file. This block is required for configuring TCP and UDP proxying and load balancing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-udp-load-balancer.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Shell: Reload NGINX Configuration\nDESCRIPTION: This command instructs NGINX to reload its configuration without interrupting existing connections. After modifying the Nginx configuration file (`nginx.conf`), this command applies the changes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/keycloak.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Reloading NGINX configuration\nDESCRIPTION: This command reloads the NGINX configuration without requiring a full restart. It ensures that any changes made to the configuration file are applied without interrupting service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/lua.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Download Bash script license_usage_offline.sh\nDESCRIPTION: This snippet provides instruction to download the bash script, which is used to add a license and submit the initial usage report in a disconnected environment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_2\n\nLANGUAGE: text\nCODE:\n```\n{{<fa \"download\">}}[Download license_usage_offline.sh](/scripts/license_usage_offline.sh).\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Agent (Bash)\nDESCRIPTION: This command restarts the NGINX Agent service. It's suggested to resolve issues deleting ACM objects after upgrading NGINX instances to R27.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/troubleshooting.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Coffee application response example\nDESCRIPTION: This snippet shows the expected response from the coffee application after a successful HTTP request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_5\n\nLANGUAGE: text\nCODE:\n```\nServer address: 10.244.0.9:8080\nServer name: coffee-76c7c85bbd-cf8nz\n```\n\n----------------------------------------\n\nTITLE: Testing NGINX configuration\nDESCRIPTION: This command checks the NGINX configuration file for syntax errors and ensures that it is valid before reloading or restarting the NGINX service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/passenger-open-source.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Cluster-Wide Config - JSON Request (Minimum)\nDESCRIPTION: This JSON request shows the minimum configuration required for the Cluster-Wide Config setting in NGINX. It specifies the 'cluster-wide-config' policy within the 'policies' section.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/cluster-wide-config.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policies\": {\n      \"cluster-wide-config\": [],\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Checking NGINX Configuration Syntax\nDESCRIPTION: This command checks the syntax of the Nginx configuration file to ensure it is valid before reloading or restarting the service, preventing potential errors and service disruptions.\nSOURCE: https://github.com/nginx/documentation/blob/main/templates/style-guide.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo nginx -t\n```\n\n----------------------------------------\n\nTITLE: Install SPNEGO Auth Module (Alpine)\nDESCRIPTION: Installs the `nginx-plus-module-auth-spnego` package using apk on Alpine Linux.  It directly adds the specified module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/spnego.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-auth-spnego\n```\n\n----------------------------------------\n\nTITLE: Send POST Traffic to Tea\nDESCRIPTION: Sends a POST request to the tea application using `curl`. This request is routed to the `tea-post` pod because the HTTP method is POST.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/tea -X POST\n```\n\n----------------------------------------\n\nTITLE: Uninstall Nginx Controller Bash\nDESCRIPTION: This command uninstalls NGINX Controller from a node before re-adding it to the cluster with a new IP address. This ensures a clean state before rejoining the node to the cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/maintenance/changing-ip-address.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/uninstall.sh\n```\n\n----------------------------------------\n\nTITLE: Installing nginx-sync on Ubuntu or Debian\nDESCRIPTION: This command installs the nginx-sync package on Ubuntu or Debian systems using the apt-get package manager. The sudo command is used to execute the command with administrative privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get install nginx-sync\n```\n\n----------------------------------------\n\nTITLE: Restarting NGINX web server\nDESCRIPTION: This command restarts the NGINX web server using `systemctl`. This is necessary to apply any configuration changes or updates related to NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_19\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Remove NGINX Service Mesh using nginx-meshctl\nDESCRIPTION: This command removes the existing NGINX Service Mesh installation. It's a step in the manual upgrade process and requires the user to have the existing version of `nginx-meshctl` installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl remove\n```\n\n----------------------------------------\n\nTITLE: Combining Dimensions and GroupBy\nDESCRIPTION: This code snippet demonstrates the usage of both `dimensions` and `groupBy` parameters together. The list of provided dimensions must be a subset of the list provided in `groupBy`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/metrics?names=SUM(nginx.http.request.count)&groupBy=nginx_id&dimensions=system_id&startTime=now-12h&resolution=5m\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Enable NGINX Perl Module\nDESCRIPTION: This NGINX configuration snippet enables the dynamic loading of the Perl module. It uses the `load_module` directive within the top-level context to load the module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/perl.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_perl_module.so;\n\n   http {\n       # ...\n   }\n```\n\n----------------------------------------\n\nTITLE: Configuring Health Check with Status and Body Condition in Nginx\nDESCRIPTION: This code configures a health check that verifies the HTTP status code is within the range of 200-399 and that the response body does not contain 'maintenance mode'. It then associates this check with a specific location using the `health_check` directive with the `match` parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-health-check.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    #...\n    match server_ok {\n        status 200-399;\n        body   !~ \"maintenance mode\";\n    }\n    server {\n        #...\n        location / {\n            proxy_pass   http://backend;\n            health_check match=server_ok;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Generate Traffic with Firefox User-Agent\nDESCRIPTION: This bash script generates traffic to the gateway Service with the `user-agent` header set to 'Firefox'. This allows for testing the A/B traffic shaping configuration where Firefox users are routed to a specific backend.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_24\n\nLANGUAGE: bash\nCODE:\n```\nfor i in $(seq 1 100); do curl $GATEWAY_IP -H \"user-agent:Firefox\"; sleep 1; done\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Service for NGINX App Protect\nDESCRIPTION: This YAML defines a Kubernetes service for exposing the NGINX App Protect deployment. It creates a NodePort service that forwards traffic to the NGINX pods.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx\nspec:\n  selector:\n    app: nap5\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 80\n  type: NodePort\n```\n\n----------------------------------------\n\nTITLE: SELinux: Add httpd_t to permissive list (Shell)\nDESCRIPTION: This command temporarily adds the `httpd_t` domain to the permissive list in SELinux. This is used to troubleshoot SELinux denials related to NGINX by allowing all operations associated with the `httpd_t` context, which NGINX is typically labeled with, temporarily. It is a troubleshooting step and should be removed after identifying the specific exceptions needed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/troubleshooting-guide/how-to-troubleshoot.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsemanage permissive -a httpd_t\n```\n\n----------------------------------------\n\nTITLE: Source IP Persistence on BIG-IP LTM\nDESCRIPTION: This snippet configures source IP address-based session persistence on BIG-IP LTM by modifying the virtual server to use the `source_addr` persistence profile.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_11\n\nLANGUAGE: none\nCODE:\n```\n# modify virtual test_virtual { persist replace-all-with {source_addr} }\n# save /sys config\n```\n\n----------------------------------------\n\nTITLE: Create Directory for SSL Certificates Shell\nDESCRIPTION: Creates the directory `/etc/ssl/nginx/` to store SSL certificates required for accessing the NGINX repository. The `-p` option ensures that parent directories are also created if they do not exist.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-dnf.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/ssl/nginx\n```\n\n----------------------------------------\n\nTITLE: Configuring Nginx Cache Splitting with Percentage in JSON\nDESCRIPTION: This JSON snippet defines the desired state for Nginx cache splitting based on percentage criteria. It sets up three different storage paths, defines one as the default, and configures the add_header directive to include the cache status in the response. It also sets a cache duration of 1 minute for all requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/about-caching.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"desiredState\": {\n        \"configSnippets\": {\n            \"uriSnippets\": [\n                {\n                    \"directives\": [\n                        {\n                            \"directive\": \"proxy_cache_valid\",\n                            \"args\": [\n                                \"any\",\n                                \"1m\"\n                            ]\n                        }\n                    ]\n                }\n            ]\n        },\n         \"programmability\": {\n            \"responseHeaderModifications\": [\n                {\n                    \"action\": \"ADD\",\n                    \"headerName\": \"X-Cache-Status\",\n                    \"headerValue\": \"$upstream_cache_status\"\n                }\n            ]\n        },\n        \"caching\": {\n            \"splitConfig\": {\n                \"criteriaType\": \"PERCENTAGE\",\n                \"key\": \"$request_uri\"\n            },\n            \"diskStores\": [\n                {\n                    \"inMemoryStoreSize\": \"100m\",\n                    \"inactiveTime\": \"1m\",\n                    \"isDefault\": false,\n                    \"maxSize\": \"5G\",\n                    \"minFree\": \"10k\",\n                    \"path\": \"/tmp/hdd1\",\n                    \"percentCriteria\": \"20%\"\n                },\n                {\n                    \"inMemoryStoreSize\": \"100m\",\n                    \"inactiveTime\": \"10s\",\n                    \"isDefault\": false,\n                    \"maxSize\": \"5g\",\n                    \"minFree\": \"10k\",\n                    \"path\": \"/tmp/hdd2\",\n                    \"percentCriteria\": \"50%\"\n                },\n                {\n                    \"inMemoryStoreSize\": \"100m\",\n                    \"inactiveTime\": \"15s\",\n                    \"isDefault\": true,\n                    \"maxSize\": \"2g\",\n                    \"minFree\": \"10k\",\n                    \"path\": \"/tmp/default\"\n                }\n            ]\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Defining Introspection Policy Configuration (YAML/JSON)\nDESCRIPTION: This snippet showcases the structure for configuring an OAuth2 Introspection policy. It defines parameters such as introspection endpoint, SNI settings, token forwarding, claim verification, DNS resolver configuration, error return conditions, and client credentials. The configuration is intended to be used within a YAML or JSON file for configuring the NGINX data plane.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/introspection.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"introspectionEndpoint\": \"https://idp.com/introspect\",\n   \"enableSNI\": false,\n   \"proxyTLSName\": \"test.oauth.com\",\n   \"introspectionResponse\": \"application/json\",\n   \"cacheIntrospectionResponse\": \"5m\",\n   \"clientTokenSuppliedIn\": \"HEADER\",\n   \"clientTokenName\": \"Authorization\",\n   \"authzServerTokenHint\": \"ACCESS_TOKEN\",\n   \"forwardToken\": true,\n   \"forwardedClaimsInProxyHeader\": [\n       \"scope\",\n       \"username\",\n       \"exp\"\n   ],\n   \"verifyClaims\": [\n       {\n           \"claim\": \"resource_access.account.roles\",\n           \"type\": \"STRING\",\n           \"delimiter\": \"SPACE\",\n           \"value\": \"test-user-1\"\n       }\n   ],\n   \"resolver\": {\n       \"valid\": \"30s\",\n       \"timeout\": \"30s\",\n       \"servers\": [\n           {\n               \"hostname\": \"example.com\"\n           },\n           {\n               \"hostname\": \"10.0.0.11\",\n               \"port\": 53\n           }\n       ]\n   },\n   \"errorReturnConditions\": {\n       \"noMatch\": {\n           \"returnCode\": 403\n       },\n       \"notSupplied\": {\n           \"returnCode\": 401\n       }\n   },\n   \"data\": [\n       {\n           \"clientAppID\": \"idp-client-app-id\",\n           \"clientSecret\": \"dbdaa3e1-f100-420x-bfd0-875bd8a77cd7\"\n       }\n   ]\n}\n```\n\n----------------------------------------\n\nTITLE: Loading the NGINX App Protect WAF v5 module\nDESCRIPTION: This snippet shows how to load the NGINX App Protect WAF v5 module in the main NGINX context. It uses the `load_module` directive to load the ngx_http_app_protect_module.so shared object.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_34\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\n```\n\n----------------------------------------\n\nTITLE: Getting Nginx version and configure parameters\nDESCRIPTION: Retrieves the Nginx version, compiler version, and configure parameters.  The output includes all the configuration options used when building Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_32\n\nLANGUAGE: shell\nCODE:\n```\nnginx -V\n```\n\n----------------------------------------\n\nTITLE: Restart Kubelet Service - Bash\nDESCRIPTION: This command restarts the kubelet service.  It's a required step after renewing the kubelet server certificate.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart kubelet\n```\n\n----------------------------------------\n\nTITLE: Send GET Traffic to Tea\nDESCRIPTION: Sends a GET request to the tea application using `curl`. This request is routed to the `tea` pod because the HTTP method is GET.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/tea\n```\n\n----------------------------------------\n\nTITLE: Creating Kubernetes Namespace\nDESCRIPTION: This command creates a new Kubernetes namespace called `nginx-gateway`.  Namespaces provide a way to divide cluster resources between multiple users or teams.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/nginx-plus/docker-registry-secret.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl create namespace nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Disabling NGINX Access Logs - Method 1\nDESCRIPTION: This snippet shows one way to explicitly disable NGINX access logs by setting the `access_log` directive to `off`.  This prevents any access logs from being written.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginxaas-azure/logging-config-access-logs.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n\taccess_log off;\n}\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration (nginx command)\nDESCRIPTION: Reloads the Nginx configuration using the `nginx -s reload` command. This applies the new configuration without restarting the server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_12\n\nLANGUAGE: none\nCODE:\n```\nroot# nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Download Dependencies Repository File Shell\nDESCRIPTION: Downloads the `dependencies.repo` file from the specified URL to the `/etc/yum.repos.d` directory. This file contains the configuration for the NGINX dependencies repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-dnf.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo\n```\n\n----------------------------------------\n\nTITLE: Query TCP Response Time with Prometheus\nDESCRIPTION: This Prometheus query retrieves the total response time for TCP connections to upstream servers. The query uses the `nginxplus_stream_upstream_server_response_time` metric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_7\n\nLANGUAGE: promQL\nCODE:\n```\nnginxplus_stream_upstream_server_response_time\n```\n\n----------------------------------------\n\nTITLE: Install XSLT Module on SLES\nDESCRIPTION: This shell command refreshes the package manager and installs the `nginx-plus-module-xslt` package on SLES systems. It uses `zypper` as the package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/xslt.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-xslt\n```\n\n----------------------------------------\n\nTITLE: Installing nginx-sync on SLES\nDESCRIPTION: This command installs the nginx-sync package on SLES systems using the zypper package manager. The sudo command is used to execute the command with administrative privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/configuration-sharing.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper install nginx-sync\n```\n\n----------------------------------------\n\nTITLE: API Request with Opaque Token\nDESCRIPTION: This snippet shows a request made to the API proxy using an opaque token. The `Authorization` header contains the opaque token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_61\n\nLANGUAGE: bash\nCODE:\n```\nPOST https://192.0.2.4/my/test/api\nHEADERS:\n  Authorization: 'Bearer <OAuth 2 token>'\n```\n\n----------------------------------------\n\nTITLE: Helm Pull Chart\nDESCRIPTION: Pulls the NGINX App Protect Helm chart from a private registry. Replace <release-version> with the desired version of the chart to download.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-helm.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nhelm pull oci://private-registry.nginx.com/nap/nginx-app-protect --version <release-version> --untar\n```\n\n----------------------------------------\n\nTITLE: Service Redeploy Failure Error Message During NGINX ADC Controller Upgrade\nDESCRIPTION: This snippet shows an error message that may appear during an NGINX ADC Controller upgrade regarding the failure to redeploy services objects to the Data Plane Manager automatically. The description explains that this error can be ignored and does not affect the overall success of the update, assuming a successful update message is also displayed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.21.md#_snippet_2\n\nLANGUAGE: text\nCODE:\n```\nFailed to re-deploy services objects to the Data Plne Manager automatically. You may need to redeploy your services objects manually.\n```\n\nLANGUAGE: text\nCODE:\n```\nSuccessfully updated NGINX Controller to 3.21.0 at the end of your update.\n```\n\n----------------------------------------\n\nTITLE: Querying Metrics API with Time Window\nDESCRIPTION: This curl command queries the Metrics API with a specified time window. It uses the `startTime` parameter to define the beginning of the time window.  The API returns all recorded metric values for the specified metric (`nginx.http.request.count`) within the last 12 hours, and requires a valid access token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/metrics?names=nginx.http.request.count&startTime=now-12h\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Configure HTTP Basic Authentication in Nginx\nDESCRIPTION: This snippet shows how to configure HTTP Basic authentication for securing access to the monitoring dashboard. It enables authentication and specifies the location of the user file containing credentials.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_55\n\nLANGUAGE: nginx\nCODE:\n```\nauth_basic on;\nauth_basic_user_file /etc/nginx/users;\n```\n\n----------------------------------------\n\nTITLE: Create BackendTLSPolicy (YAML)\nDESCRIPTION: This snippet creates a Kubernetes BackendTLSPolicy named `backend-tls` using the Gateway API. This policy configures TLS termination for the `secure-app` Service. It references the `backend-cert` ConfigMap created earlier for CA certificate validation and specifies `secure-app.example.com` as the hostname.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/securing-backend-traffic.md#_snippet_8\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1alpha3\nkind: BackendTLSPolicy\nmetadata:\n  name: backend-tls\nspec:\n  targetRefs:\n  - group: ''\n    kind: Service\n    name: secure-app\n  validation:\n    caCertificateRefs:\n    - name: backend-cert\n      group: ''\n      kind: ConfigMap\n    hostname: secure-app.example.com\nEOF\n```\n\n----------------------------------------\n\nTITLE: Uninstall Dynamic Module on SLES\nDESCRIPTION: This command uninstalls the specified dynamic module using the zypper package manager. It requires sudo privileges and the correct dynamic module name. The command removes the module package from the system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/uninstall.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper remove <dynamic_module_name>\n```\n\n----------------------------------------\n\nTITLE: Get Certificate Resource ID - Azure CLI\nDESCRIPTION: This snippet retrieves the resource ID of a certificate in key vault using the Azure CLI. Requires the `CERT_NAME` and `KV_NAME` environment variables.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_15\n\nLANGUAGE: bash\nCODE:\n```\ncertificate_id=$(az keyvault certificate show --name $CERT_NAME \\\n      --vault-name $KV_NAME \\\n      --query id --output tsv)\n```\n\n----------------------------------------\n\nTITLE: Edit gRPC configuration file\nDESCRIPTION: Opens the gRPC configuration file using nano text editor. This allows the user to modify the client_body_timeout parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-gateway.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo nano /etc/nginx/conf.d/nms-http.conf\n```\n\n----------------------------------------\n\nTITLE: Prometheus Query for P90 Latency (Excluding 301)\nDESCRIPTION: This Prometheus query calculates the p90 latency of requests, excluding 301 responses, sent from `productpage-v1` in the `prod` namespace to the `details` service, calculated over 30 seconds. It relies on `nginxplus_upstream_server_response_latency_ms_bucket`, filtering by namespace, deployment, destination service, and excluding 301 response codes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_11\n\nLANGUAGE: promQL\nCODE:\n```\nhistogram_quantile(0.90, sum(irate(nginxplus_upstream_server_response_latency_ms_bucket{namespace=\"prod\",deployment=\"productpage-v1\",dst_service=\"details\",code!=\"301\"}[30s])) by (le))\n```\n\n----------------------------------------\n\nTITLE: Defining Nginx Plus Connection Metrics\nDESCRIPTION: These lines define how server-wide metrics related to connections are derived from Nginx Plus metrics. It shows how accepted, active, current, dropped and idle connection metrics are calculated from the connections API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_3\n\nLANGUAGE: text\nCODE:\n```\nnginx.http.conn.accepted = connections.accepted\nnginx.http.conn.active = connections.active\nnginx.http.conn.current = connections.active + connections.idle\nnginx.http.conn.dropped = connections.dropped\nnginx.http.conn.idle = connections.idle\nnginx.http.request.count = requests.total\nnginx.http.request.current = requests.current\n```\n\n----------------------------------------\n\nTITLE: Displaying Directory Structure\nDESCRIPTION: This bash command displays the directory structure of the `nginx` directory. It shows the files and subdirectories contained within the nginx directory, providing a visual representation of the configuration file organization.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configuration-portal.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\n$ tree nginx\nnginx\n├── nginx.conf\n├── njs.js\n└── servers\n    ├── server1.conf\n    └── server2.conf\n\n1 directory, 4 files\n```\n\n----------------------------------------\n\nTITLE: Start NGINX Amplify Agent Service (Bash)\nDESCRIPTION: Starts the NGINX Amplify Agent service using the `service` command. It assumes the `amplify-agent` service is managed by systemd or a similar service manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_16\n\nLANGUAGE: bash\nCODE:\n```\nservice amplify-agent start\n```\n\n----------------------------------------\n\nTITLE: Copy NGINX SSL Certificates - Shell\nDESCRIPTION: Copies the NGINX Plus certificate and key files (nginx-repo.crt and nginx-repo.key) to the /etc/ssl/nginx/ directory.  These files are required for authentication when accessing the Nginx Agent repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo cp nginx-repo.crt nginx-repo.key /etc/ssl/nginx/\n```\n\n----------------------------------------\n\nTITLE: Creating NGINX App Protect WAF Repository File - None\nDESCRIPTION: Creates a repository configuration file for NGINX App Protect WAF v5. This configuration includes the repository name, base URL, SSL client certificate and key paths, GPG check status, and enablement status. The baseurl specifies the location of the app-protect-x-plus packages for Amazon Linux 2023 architecture.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-amazon.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\n[app-protect-x-plus]\nname=nginx-app-protect repo\nbaseurl=https://pkgs.nginx.com/app-protect-x-plus/amzn/2023/$basearch/\nsslclientcert=/etc/ssl/nginx/nginx-repo.crt\nsslclientkey=/etc/ssl/nginx/nginx-repo.key\ngpgcheck=0\nenabled=1\n```\n\n----------------------------------------\n\nTITLE: Complete Load Balancer Configuration BIG-IP LTM\nDESCRIPTION: This snippet shows a complete load balancer configuration on BIG-IP LTM.  It configures pools, virtual servers, SSL profiles, cookie persistence, oneconnect profile, and health monitors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_18\n\nLANGUAGE: none\nCODE:\n```\n # create pool test_pool members add { 10.10.10.10:80 10.10.10.20:80 }\n # create virtual test_virtual { destination 192.168.10.10:80 pool test_pool source-address-translation { type automap } ip-protocol tcp profiles add { http } }\n # create pool ssl_test_pool members add { 10.10.10.10:443 10.10.10.20:443 }\n # create virtual test_ssl_virtual { destination 192.168.10.10:443 pool ssl_test_pool source-address-translation { type automap } ip-protocol tcp profiles add { http } }\n # create profile client-ssl test_ssl_client_profile cert test.crt key test.key\n # modify virtual test_ssl_virtual profiles add { test_ssl_client_profile }\n # create profile server-ssl test_ssl_server_profile cert test.crt key test.key\n # modify virtual test_ssl_virtual profiles add { test_ssl_server_profile }\n # create persistence cookie test_bigip_cookie cookie-name BIGIP_COOKIE_PERSIST expiration 1:0:0\n # modify virtual test_virtual { persist replace-all-with { test_bigip_cookie } }\n # modify virtual test_ssl_virtual { persist replace-all-with { test_bigip_cookie } }\n # modify virtual test_virtual profiles add { oneconnect }\n # modify virtual test_ssl_virtual profiles add { oneconnect }\n # create monitor http test_monitor defaults-from http send \"GET /index.html HTTP/1.0\\r\\n\\r\\n\" interval 5 timeout 20\n # modify pool test_pool monitor test_monitor\n # create monitor https test_ssl_monitor defaults-from https send \"GET /index.html HTTP/1.0\\r\\n\\r\\n\" interval 5 timeout 20\n # modify pool ssl_test_pool monitor test_ssl_monitor\n # save /sys config\n\n```\n\n----------------------------------------\n\nTITLE: Resolving DNS name with nslookup\nDESCRIPTION: This command resolves a DNS name into an IP address using the `nslookup` utility. It is essential to verify the connectivity and resolution of the Ingress Controller's DNS. It takes the DNS name as a parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_9\n\nLANGUAGE: Shell\nCODE:\n```\nnslookup <dns-name>\n```\n\n----------------------------------------\n\nTITLE: Restart Nginx Agent (Shell)\nDESCRIPTION: This snippet restarts the Nginx Agent service to apply the configuration changes made to `/etc/nginx-agent/nginx-agent.conf`. It uses `sudo systemctl restart nginx-agent` to ensure the service is restarted with the necessary permissions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/set-up-app-protect-instances.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Upgrade API Connectivity Manager on RPM-based systems (CentOS, RHEL)\nDESCRIPTION: This command upgrades the API Connectivity Manager to the latest version on CentOS or RHEL using the yum package manager.  The -y flag automatically confirms any prompts during the update process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum update -y nms-api-connectivity-manager\n```\n\n----------------------------------------\n\nTITLE: Start Nginx service\nDESCRIPTION: This command starts the Nginx service using systemctl.  It is executed if the Nginx service is not already running.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/getting-started.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl start nginx\n```\n\n----------------------------------------\n\nTITLE: Deploying NGINX Service Mesh in OpenShift\nDESCRIPTION: This command deploys NGINX Service Mesh in an OpenShift environment.  The `--environment openshift` flag configures the mesh to utilize the CSI Driver and sets up the necessary security context constraints.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/openshift.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --environment openshift\"\n```\n\n----------------------------------------\n\nTITLE: Manual Failover using touch command (Shell)\nDESCRIPTION: This command creates a file that is monitored by a Keepalived script. The script lowers the priority of the primary node when the file exists, causing a failover.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ntouch /var/run/keepalived-manual-failover\n```\n\n----------------------------------------\n\nTITLE: Add license - Web Interface\nDESCRIPTION: This snippet indicates that the steps to add a license can be found at the indicated link in the `add-license-webui.md` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_14\n\nLANGUAGE: text\nCODE:\n```\n{{< include \"nim/admin-guide/license/add-license-webui.md\" >}}\n```\n\n----------------------------------------\n\nTITLE: View Kubernetes Pod Logs (Bash)\nDESCRIPTION: This command streams the logs from the `egress-driver` container within a specified Pod.  It's used to verify that the `egress-driver` application is attempting to send requests to the `target` service and to observe any connection errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nkubectl logs -f -c egress-driver <EGRESS_DRIVER_POD>\n```\n\n----------------------------------------\n\nTITLE: Test RC4-MD5 Cipher (Shell)\nDESCRIPTION: This command tests compliance with FIPS 140-2 by attempting an SSL/TLS connection with the RC4-MD5 cipher. Since RC4-MD5 is insecure and disabled by default in NGINX Plus, the SSL handshake should always fail.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/fips-compliance-nginx-plus.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\n(echo \"GET /\" ; sleep 1) | openssl s_client -connect <NGINX-Plus-address>:443 -cipher RC4-MD5\n```\n\n----------------------------------------\n\nTITLE: Checking Agent on Ubuntu/Debian\nDESCRIPTION: This shows how to use dpkg to check if nginx-amplify-agent is installed on Ubuntu/Debian systems. The `dpkg -s` command retrieves the status of the specified package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/faq/nginx-amplify-agent.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ndpkg -s nginx-amplify-agent\n```\n\n----------------------------------------\n\nTITLE: List Instances (Shell)\nDESCRIPTION: This `curl` command retrieves a list of all instances from the NGINX Instance Manager REST API, which includes their unique identifiers (UIDs). Requires a valid access token and systemUID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_24\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET https://{{NMS_FQDN}}/api/platform/v1/systems/{systemUID}/instances \\\n -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: SELinux setrlimit command\nDESCRIPTION: This code snippet shows the command to increase the limit for file descriptors if the `setrlimit ... failed (Permission denied)` error message occurs. This command must be executed as the root user.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/troubleshooting-guide/troubleshooting.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\nsetsebool -P httpd_setrlimit 1;\n```\n\n----------------------------------------\n\nTITLE: Apply Kubernetes manifest for Gateway resource\nDESCRIPTION: This snippet applies a Kubernetes manifest to create a Gateway resource using kubectl. It fetches the manifest from a remote GitHub URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_2\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/examples/client-settings-policy/gateway.yaml\n```\n\n----------------------------------------\n\nTITLE: Setting Client Max Body Size in NGINX Service Mesh\nDESCRIPTION: This command sets the client max body size to 5m during NGINX Service Mesh deployment.  This configures the maximum allowed size of a client request body.  Requires `nginx-meshctl` to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/configuration.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy ... --client-max-body-size 5m\n```\n\n----------------------------------------\n\nTITLE: Poll license status - NGINX Instance Manager REST API (curl)\nDESCRIPTION: This `curl` command polls the license status from NGINX Instance Manager via its REST API. The command includes headers for accepting JSON and authorization (using base64-encoded credentials).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\ncurl -k \"https://<NIM-FQDN>/api/platform/v1/license\" \\\n--header \"accept: application/json\" \\\n--header \"authorization: Basic <base64-encoded-credentials>\" \\\n--header \"referer: https://<NIM-FQDN>/ui/settings/license\"\n```\n\n----------------------------------------\n\nTITLE: Querying Security Violation Events by Attack Type\nDESCRIPTION: This example demonstrates how to retrieve events that triggered a specific attack type, using the NGINX Controller REST API. A substring search using wildcards or ‘IN’ operand should be used. The startTime is set to 0 and endTime to now.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/view-app-security-analytics.md#_snippet_11\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            waf.attack_types='*Non-browser Client, Abuse of Functionality*' and\n            app='shopping' and\n            environment='prod' and\n            component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Moving nginx-meshctl executable to PATH on macOS\nDESCRIPTION: This command moves the extracted nginx-meshctl executable to the /usr/local/bin directory, which is typically included in the system's PATH. This makes the command accessible from any directory in the terminal.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo mv nginx-meshctl /usr/local/bin/nginx-meshctl\n```\n\n----------------------------------------\n\nTITLE: OpenAPI Specification for File Reference (JSON)\nDESCRIPTION: This JSON snippet presents an OpenAPI Specification file designed for use with local file references. The API definition specifies an endpoint `/query` that accepts a boolean parameter `query_bool`. The specification defines the structure and data types expected by the API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-openapi-references.md#_snippet_5\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"openapi\": \"3.0.1\",\n    \"info\": {\n        \"title\": \"Primitive data types2\",\n        \"description\": \"Primitive data types.\",\n        \"version\": \"2.5.1\"\n    },\n    \"servers\": [\n        {\n            \"url\": \"http://localhost\"\n        }\n    ],\n    \"paths\": {\n        \"/query\": {\n            \"get\": {\n                \"tags\": [\n                    \"query_bool\"\n                ],\n                \"description\": \"query_bool\",\n                \"operationId\": \"query_bool\",\n                \"parameters\": [\n                    {\n                        \"name\": \"query_bool\",\n                        \"in\": \"query\",\n                        \"required\": false,\n                        \"schema\": {\n                            \"type\": \"boolean\"\n                        }\n                    }\n                ],\n                \"responses\": {\n                    \"200\": {\n                        \"description\": \"OK\"\n                    },\n                    \"404\": {\n                        \"description\": \"NotFound\"\n                    }\n                }\n            }\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: HTTP 400 Response from Nginx\nDESCRIPTION: This is an example of the HTML response when sending an unencrypted HTTP request to an Nginx server configured to only accept HTTPS traffic. The response indicates that the client sent a plain HTTP request to the secure port, resulting in a 400 Bad Request error.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/securing-backend-traffic.md#_snippet_5\n\nLANGUAGE: text\nCODE:\n```\n<html>\n<head><title>400 The plain HTTP request was sent to HTTPS port</title></head>\n<body>\n<center><h1>400 Bad Request</h1></center>\n<center>The plain HTTP request was sent to HTTPS port</center>\n<hr><center>nginx/1.25.3</center>\n</body>\n</html>\n```\n\n----------------------------------------\n\nTITLE: Add license to NGINX Instance Manager - REST API (curl)\nDESCRIPTION: This `curl` command adds the JWT license to the NGINX Instance Manager via the REST API.  It includes headers for origin, referrer, content type, and authorization (base64 encoded credentials), and sends a JSON payload containing the license content.  The `-k` flag is used to skip SSL certificate validation, and <NIM-FQDN> and <base64-encoded-credentials> and <JSON-web-token> are placeholders for the actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\ncurl -k --location 'https://<NIM-FQDN>/api/platform/v1/license?telemetry=true' \\\n--header 'Origin: https://<NIM-FQDN>' \\\n--header 'Referer: https://<NIM-FQDN>/ui/settings/license' \\\n--header 'Content-Type: application/json' \\\n--header 'Authorization: Basic <base64-encoded-credentials>' \\\n--data '{\n  \"metadata\": {\n    \"name\": \"license\"\n  },\n  \"desiredState\": {\n    \"content\": \"<JSON-web-token>\"\n  }\n}'\n```\n\n----------------------------------------\n\nTITLE: Start NGINX Agent Service - Shell\nDESCRIPTION: This command starts the NGINX Agent service on systemd systems. It requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/getting-started.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl start nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent securely using wget\nDESCRIPTION: This snippet shows how to install NGINX Agent securely using wget and enforcing secure connection with `--skip-verify false`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/agent/installation/install-agent-api.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nwget https://<NIM_FQDN>/install/nginx-agent -O - | sudo sh -s --skip-verify false\n```\n\n----------------------------------------\n\nTITLE: Restart Nginx Web Server - Bash\nDESCRIPTION: Restarts the Nginx web server using `systemctl`. This is required after installing NGINX Instance Manager to ensure the changes take effect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide-deprecated.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Backup NGINX Controller Cluster Config and Encryption Keys\nDESCRIPTION: This command backs up the NGINX Controller cluster configuration and encryption keys to a `.tgz` archive. The backup file is saved to `/opt/nginx-controller/cluster-config.tgz`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh cluster-config save\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX App Protect WAF v5 package on Ubuntu\nDESCRIPTION: This snippet installs the NGINX App Protect WAF v5 package on Ubuntu. It updates the package index and then installs the app-protect-module-plus package using apt-get.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_33\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get update\nsudo apt-get install app-protect-module-plus\n```\n\n----------------------------------------\n\nTITLE: Test Nginx Configuration\nDESCRIPTION: This shell command tests the Nginx configuration file for syntax errors. It ensures that the configuration is valid before reloading or restarting Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentracing.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Install Nginx on Debian\nDESCRIPTION: This command updates the apt package list and then installs Nginx from the configured repositories. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update\nsudo apt install nginx\n```\n\n----------------------------------------\n\nTITLE: Update NGINX Controller (bash)\nDESCRIPTION: This script updates NGINX Controller to a newer version. It should be run on each node in the cluster sequentially, after extracting the installer package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/manage-cluster.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./update.sh\n```\n\n----------------------------------------\n\nTITLE: Single Line Shell Command Example\nDESCRIPTION: Illustrates how to display a single line shell command and its output in separate code blocks. The command should be copyable, and the output truncated if needed.\nSOURCE: https://github.com/nginx/documentation/blob/main/archetypes/tutorial.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\n<a copyable, single line command>\n```\n\n----------------------------------------\n\nTITLE: Install ca_root_nss package on FreeBSD\nDESCRIPTION: This snippet updates the package manager and installs the ca_root_nss package on FreeBSD. It is a prerequisite for installing NGINX Plus on FreeBSD.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_12\n\nLANGUAGE: Shell\nCODE:\n```\nsudo pkg update\nsudo pkg install ca_root_nss\n```\n\n----------------------------------------\n\nTITLE: Stopping kubelet service\nDESCRIPTION: This command stops the kubelet service on the system. It is used as a prerequisite for renewing certificates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl stop kubelet\n```\n\n----------------------------------------\n\nTITLE: Verify NFS Mount Points\nDESCRIPTION: This snippet uses `df -h` to verify that the NFS mount points are accessible and mounted correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\ndf -h\n```\n\n----------------------------------------\n\nTITLE: Testing Nginx configuration\nDESCRIPTION: This shell command tests the Nginx configuration file for syntax errors.  It verifies that the configuration file is valid before reloading Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/encrypted-session.md#_snippet_7\n\nLANGUAGE: Shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Change Directory\nDESCRIPTION: Changes the current working directory to the nginx-app-protect directory, which is typically created after unpacking the Helm chart.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-helm.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ncd nginx-app-protect\n```\n\n----------------------------------------\n\nTITLE: Testing NGINX configuration\nDESCRIPTION: This shell command tests the Nginx configuration file for syntax errors. The expected output indicates whether the configuration file is valid.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/fips.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Navigating to user's home directory\nDESCRIPTION: This command changes the current directory to the home directory of the user who installed NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\ncd\n```\n\n----------------------------------------\n\nTITLE: Configuration Load Failure Log Event JSON\nDESCRIPTION: This JSON snippet represents a configuration load failure event in NGINX App Protect DoS. It specifies the event type as 'configuration_load_failure' and includes the error message detailing the reason for the failure, such as a file not found or a parsing error, along with the line number where the error was detected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/operation-log.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"event\": \"configuration_load_failure\",\n    \"error_message\": \"Failed to load Policy '/etc/app_protect_dos/BADOSDefaultPolicy.json' : Fail parse JSON Policy: malformed JSON string, neither tag, array, object, number, string or atom, at character offset 0 (before \\\"xxxx\\\\nhdjk\\\\n\\\\n555\\\\n\\\") \\n.\\n\",\n    \"error_line_number\": 58\n}\n```\n\n----------------------------------------\n\nTITLE: Custom GraphQL Blocking Response Page\nDESCRIPTION: This code snippet shows an example of a customized GraphQL blocking response page.  It defines a 'graphql' response page type with a 'default' response action type. The 'responseContent' contains a JSON object with an 'errors' array, which includes a custom error message and the support ID using <%TS.request.ID()%>. The JSON structure must be preserved for the page to display correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/graphql-response-pages.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\n\"response-pages\": [\n        {\n            \"responsePageType\": \"graphql\",\n            \"responseActionType\": \"default\",\n            \"responseContent\": \"{\\\"errors\\\": [{\\\"message\\\": \\\"This is a custom GraphQL blocking response page. Code: BRP. Your support ID is: <%TS.request.ID()%>\\\"}]}\"\n        }\n    ]\n```\n\n----------------------------------------\n\nTITLE: String Select Field JSON Schema Example\nDESCRIPTION: This JSON schema defines a string select field named 'method' with enumerated values. It allows users to select one of the predefined values (GET, POST, PUT, DELETE) from a dropdown menu.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/reference/json-schema-reference.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"method\": {\n      \"type\": \"string\",\n      \"enum\": [\"GET\", \"POST\", \"PUT\", \"DELETE\"]\n    }\n  }\n```\n\n----------------------------------------\n\nTITLE: Install ClickHouse server and client (Debian, Ubuntu)\nDESCRIPTION: Installs the ClickHouse server and client packages using apt-get. This installs the components for the ClickHouse database.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get install -y clickhouse-server clickhouse-client\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX service\nDESCRIPTION: Restarts the Nginx service to apply the changes made to the Nginx configuration file. This command ensures that the updated client_body_timeout setting is loaded and used by Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-gateway.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Adding CNAME Record to DNS Zone File\nDESCRIPTION: This example shows the CNAME record configuration that needs to be added to the DNS zone file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_11\n\nLANGUAGE: none\nCODE:\n```\nhealthcheck    IN    CNAME    healthy.svcs.example.com.\n```\n\n----------------------------------------\n\nTITLE: Example HTTP Redirect Response with Query Parameters for soda with pepsi (Text)\nDESCRIPTION: This is an example HTTP response showing a 302 redirect for the query `http://cafe.example.com/soda/pepsi?test=v1`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_18\n\nLANGUAGE: text\nCODE:\n```\nHTTP/1.1 302 Moved Temporarily\n..\nLocation: http://cafe.example.com:8080/flavors?test=v1\n```\n\n----------------------------------------\n\nTITLE: Update Proxy Configuration with Custom Error Codes (bash)\nDESCRIPTION: This snippet shows how to use a PUT request to update the API proxy configuration with custom error return codes for the Introspection policy. It uses the `https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy` endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_53\n\nLANGUAGE: bash\nCODE:\n```\nPUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy\n```\n\n----------------------------------------\n\nTITLE: Exposing Port 80\nDESCRIPTION: This snippet exposes port 80, which is the standard HTTP port, making it accessible from outside the container.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-oracle.md#_snippet_1\n\nLANGUAGE: dockerfile\nCODE:\n```\nEXPOSE 80\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Plus Version (Shell)\nDESCRIPTION: This command verifies that the installed NGINX Plus version is Release 34 or later, which is required for the native OIDC module. It outputs the NGINX version string.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/ping-identity.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nnginx -v\n```\n\n----------------------------------------\n\nTITLE: Checking supported distributions for install-nim-bundle.sh\nDESCRIPTION: This bash command uses `grep` to extract the supported distributions list from the `install-nim-bundle.sh` script. This allows the user to determine the correct distribution option to pass to the install script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide.md#_snippet_1\n\nLANGUAGE: Bash\nCODE:\n```\ngrep '\\-d distribution' install-nim-bundle.sh\n```\n\n----------------------------------------\n\nTITLE: Running Chef Client to Synchronize Nginx Configuration\nDESCRIPTION: This command runs the Chef client on the specified node to synchronize its configuration based on the defined cookbooks and roles. This is done to ensure the keepalived configuration is updated with the peer node information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\nsudo chef-client\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect Enable Directive\nDESCRIPTION: This is the minimum required directive to enable NGINX App Protect.  It must be added to the Nginx config file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_27\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_enable on;\n```\n\n----------------------------------------\n\nTITLE: Using CLI Flags\nDESCRIPTION: This demonstrates the usage of CLI flags when executing the `nginx-agent` command. It shows the general syntax for passing flags to the command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_9\n\nLANGUAGE: sh\nCODE:\n```\nnginx-agent [flags]\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent insecurely using curl\nDESCRIPTION: This snippet demonstrates how to install NGINX Agent insecurely using curl, bypassing TLS certificate verification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/agent/installation/install-agent-api.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ncurl --insecure https://<NIM_FQDN>/install/nginx-agent | sudo sh\n```\n\n----------------------------------------\n\nTITLE: Slab Zone Pages Percent Used Metric\nDESCRIPTION: Describes the 'plus.slab.pages.pct_used' metric, which is a gauge representing the percentage of free pages in the slab zone.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_36\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, percentage\nDescription: Percentage of free pages.\n```\n\n----------------------------------------\n\nTITLE: Kubectl Get Pods\nDESCRIPTION: Retrieves a list of pods within a given Kubernetes namespace. Replace <namespace> with the actual Kubernetes namespace.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-helm.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get pods -n <namespace>\n```\n\n----------------------------------------\n\nTITLE: Update and install module (Alpine Linux)\nDESCRIPTION: Updates the package index and installs a specified NGINX module using apk.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_31\n\nLANGUAGE: Shell\nCODE:\n```\nsudo apk update\nsudo apk add <MODULE-NAME>\n```\n\n----------------------------------------\n\nTITLE: Installing Passenger module on Alpine\nDESCRIPTION: This code snippet demonstrates installing the `nginx-plus-module-passenger` package on Alpine Linux using the apk package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/passenger-open-source.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-passenger\n```\n\n----------------------------------------\n\nTITLE: Restarting Amplify Agent\nDESCRIPTION: Shows the command to restart the NGINX Amplify Agent service after modifying the configuration file. This ensures that the changes are applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/configuring-amplify-agent.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nservice amplify-agent restart\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Controller\nDESCRIPTION: This command uninstalls NGINX Controller by running the `uninstall.sh` script. It is located in the `/opt/nginx-controller/` directory and removes the NGINX Controller software.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/uninstall.sh\n```\n\n----------------------------------------\n\nTITLE: Testing NGINX configuration\nDESCRIPTION: This command tests the NGINX configuration file for syntax errors.  It requires NGINX to be installed and the configuration file to be present at `/etc/nginx/nginx.conf`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/lua.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Create NGINX SSL directory\nDESCRIPTION: Creates the `/etc/ssl/nginx/` directory. This directory is used to store SSL certificates and keys related to NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-ubuntu.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/ssl/nginx\n```\n\n----------------------------------------\n\nTITLE: Install Set-Misc Module on Alpine\nDESCRIPTION: This snippet provides the command to install the nginx-plus-module-set-misc package on Alpine Linux using the apk package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/set-misc.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-set-misc\n```\n\n----------------------------------------\n\nTITLE: Install NGINX RTMP Module on SLES\nDESCRIPTION: This shell script refreshes the package repositories and installs the nginx-plus-module-rtmp package using zypper.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/rtmp.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-rtmp\n```\n\n----------------------------------------\n\nTITLE: Install NGINX JavaScript Module (Debian/Ubuntu)\nDESCRIPTION: This command installs the NGINX JavaScript module (njs) on Debian or Ubuntu systems. The module is necessary for handling interactions between NGINX Plus and Microsoft Entra (IdP).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/microsoft-entra-setup.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt install nginx-plus-module-njs\n```\n\n----------------------------------------\n\nTITLE: Removing App Protect RPM package - SELinux failure message\nDESCRIPTION: Demonstrates a known issue where removing the app-protect RPM package results in SELinux-related failure messages.  This is a cosmetic issue. The code snippet shows the output from the `yum remove app-protect` command, illustrating the benign error messages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/releases/about-1.3.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nyum remove app-protect\n\nErasing : app-protect-22+3.90.2-1.el7.ngx.x86_64 1/5\nlibsemanage.semanage_direct_remove_key: Removing last app-protect module (no other app-protect module exists at another priority).\nrestorecon: lstat(/usr/lib64/systemd/system/nginx-app-protect-compiler.service) failed: No such file or directory\nrestorecon: lstat(/usr/lib64/systemd/system/nginx-app-protect.service) failed: No such file or directory\n```\n\n----------------------------------------\n\nTITLE: Retrieve metric namespaces via Azure Monitor API (Bash)\nDESCRIPTION: This `curl` command retrieves all metric namespaces associated with an NGINXaaS deployment using the Azure Monitor API. It requires an authorization token and the subscription ID, resource group, and deployment name of the NGINXaaS instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/monitoring/enable-monitoring.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ncurl --request GET --header \"Authorization: Bearer $TOKEN\" \"https://management.azure.com/subscriptions/12345678-abcd-98765432-abcdef012345/resourceGroups/my-nginx-rg/providers/NGINX.NGINXPLUS/nginxDeployments/my-nginx-dep/providers/microsoft.insights/metricNamespaces?api-version=2024-02-01\"\n```\n\n----------------------------------------\n\nTITLE: Metrics API Query Template\nDESCRIPTION: This snippet demonstrates the template used by NGINX Controller to query the Metrics API for data defined in alert rules.  It shows how metric names, aggregation functions, time periods, and additional parameters are combined to form the API request.  This is critical for understanding how alert rules are evaluated against collected metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/alerts/about-alerts.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\n?names=<agg-function>(<metric-name>)&startTime=now-<period>&endTime=now<&additional-alert-rule-parameters>\"\n```\n\n----------------------------------------\n\nTITLE: Fetch nginx-plus.conf on FreeBSD\nDESCRIPTION: This command fetches the nginx-plus.conf file from the NGINX website and saves it to the /etc/pkg/ directory. This configuration file is required for the NGINX Plus package installation on FreeBSD.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_13\n\nLANGUAGE: Shell\nCODE:\n```\nsudo fetch -o /etc/pkg/nginx-plus.conf http://cs.nginx.com/static/files/nginx-plus.conf\n```\n\n----------------------------------------\n\nTITLE: Remove Namespace and CRDs\nDESCRIPTION: These shell commands remove the `nginx-gateway` namespace and its associated Custom Resource Definitions (CRDs) from the Kubernetes cluster.  The CRDs are deleted using a manifest fetched from the NGINX Gateway Fabric GitHub repository. This command ensures complete removal of the NGINX Gateway Fabric's custom resources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/helm.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nkubectl delete ns nginx-gateway\nkubectl delete -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/deploy/crds.yaml\n```\n\n----------------------------------------\n\nTITLE: Querying GeoIP2 Database using mmdblookup\nDESCRIPTION: Example usage of the mmdblookup utility to query a GeoIP2 database for all available geodata for a given IP address. Requires the libmaxminddb package to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nmmdblookup --file /usr/local/etc/geoip2/GeoLite2-Country.mmdb --ip 8.8.8.8\n```\n\n----------------------------------------\n\nTITLE: Example Response from Events API (JSON)\nDESCRIPTION: This is an example JSON response from the Events API, showing the structure of the returned data. It includes metadata for pagination and an array of event items, each with details like category, dimensions, ID, level, message, status, and timestamp.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n\t\"Metadata\": {\n\t\t\"pagination\": {\n\t\t\t\"links\": {\n\t\t\t\t\"next\": {},\n\t\t\t\t\"prev\": {}\n\t\t\t},\n\t\t\t\"pageToken\": \"1639453182\"\n\t\t}\n\t},\n\t\"items\": [{\n\t\t\"category\": \"agent status\",\n\t\t\"dimensions\": {\n\t\t\t\"alias\": \"alias\",\n\t\t\t\"hostname\": \"hostname\",\n\t\t\t\"instance\": \"instance\",\n\t\t\t\"nginx_id\": \"nginx_id\",\n\t\t\t\"system_id\": \"system_id\",\n\t\t},\n\t\t\"id\": \"uuid\",\n\t\t\"level\": \"INFO\",\n\t\t\"message\": \"successfully applied config on <instance>\",\n\t\t\"status\": \"Config Apply Success\",\n\t\t\"timestamp\": \"2021-12-14T01:03:11Z\"\n\t}, {\n\t\t\"category\": \"agent status\",\n\t\t\"dimensions\": {\n\t\t\t\"alias\": \"alias\",\n\t\t\t\"hostname\": \"hostname\",\n\t\t\t\"instance\": \"instance\",\n\t\t\t\"nginx_id\": \"nginx_id\",\n\t\t\t\"system_id\": \"system_id\",\n\t\t},\n\t\t\"error\": \"Config apply failed (write): Error running nginx -t exit status 1\",\n\t\t\"id\": \"uuid\",\n\t\t\"level\": \"INFO\",\n\t\t\"message\": \"failed to apply nginx config on <instance>\",\n\t\t\"status\": \"Config Apply Failure\",\n\t\t\"timestamp\": \"2021-12-14T00:57:48Z\"\n\t},{\n\t\t\"category\": \"agent status\",\n\t\t\"dimensions\": {\n\t\t\t\"alias\": \"alias\",\n\t\t\t\"hostname\": \"hostname\",\n\t\t\t\"instance\": \"instance\",\n\t\t\t\"nginx_id\": \"nginx_id\",\n\t\t\t\"system_id\": \"system_id\"\n\t\t},\n\t\t\"id\": \"uuid\",\n\t\t\"level\": \"INFO\",\n\t\t\"message\": \"nginx-agent v2.1.6 stopped on <instance>\",\n\t\t\"status\": \"Agent Stop\",\n\t\t\"timestamp\": \"2021-12-13T20:08:49Z\"\n\t}, {\n\t\t\"category\": \"agent status\",\n\t\t\"dimensions\": {\n\t\t\t\"alias\": \"alias\",\n\t\t\t\"hostname\": \"hostname\",\n\t\t\t\"instance\": \"instance\",\n\t\t\t\"nginx_id\": \"nginx_id\",\n\t\t\t\"system_id\": \"system_id\",\n\t\t},\n\t\t\"id\": \"uuid\",\n\t\t\"level\": \"INFO\",\n\t\t\"message\": \"nginx-agent v2.1.6 started on <instance>\",\n\t\t\"status\": \"Agent Start\",\n\t\t\"timestamp\": \"2021-12-13T03:20:00Z\"\n\t}]\n}\n```\n\n----------------------------------------\n\nTITLE: Command-line Argument Parsing - Bash\nDESCRIPTION: This section parses command-line arguments using `getopts`.  It extracts the JWT file path, IP address, username, password, output file, and step from the arguments passed to the script.  The values are stored in corresponding variables for later use.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nwhile getopts \":j:i:u:p:o:s:\" opt; do\n  case $opt in\n    j) jwt_file=\"$OPTARG\" ;;\n    i) ip_address=\"$OPTARG\" ;;\n    u) username=\"$OPTARG\" ;;\n    p) password=\"$OPTARG\" ;;\n    o) output_file=\"$OPTARG\" ;;\n    s) step=\"$OPTARG\" ;;\n    \\?) echo \"Invalid option -$OPTARG\" >&2 ;;\n  esac\ndone\n```\n\n----------------------------------------\n\nTITLE: Modifying NGINX configuration for offline access\nDESCRIPTION: This Nginx configuration snippet shows how to remove the `offline_access` scope from the list of requested scopes when configuring Nginx Plus as an OpenID Connect relying party with Cognito. Cognito doesn't natively support the offline_access scope. This modification ensures compatibility.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/cognito.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nreturn 302 \"$oidc_authz_endpoint?response_type=code&scope=openid+profile+email&client_id=$oidc_clientaws...;\"\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration with App Protect and JS\nDESCRIPTION: This NGINX configuration loads the App Protect and JavaScript modules. It defines two HTTP servers: one that acts as a proxy with App Protect enabled for the root location, forwarding requests to the second server, which serves content using the JavaScript 'foo' handler.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/configure-njs.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_app_protect_module.so;\nload_module modules/ngx_http_js_module.so;\n\nhttp {\n    js_include service.js\n\n    server {\n        listen       127.0.0.1:8080;\n        server_name  localhost;\n\n        location / {\n            app_protect_enable on;\n            proxy_pass    http://127.0.0.1:8081$request_uri;\n        }\n    }\n\n    server {\n        listen       127.0.0.1:8081;\n        server_name  localhost;\n\n        location / {\n            js_content foo;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Install SQLite on RHEL and RPM-based distributions\nDESCRIPTION: Installs SQLite on RHEL and other RPM-based Linux distributions using the yum package manager. This command is suitable for systems excluding CentOS 7, Amazon Linux 2, and Oracle Linux 7.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/sqlite-installation.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum install -y sqlite\n```\n\n----------------------------------------\n\nTITLE: Configure AWS SecretsManager Upstream Authority in YAML\nDESCRIPTION: This YAML configuration configures SPIRE to load CA credentials from AWS SecretsManager as the upstream authority. The region, certificate ARN, and key ARN must be defined.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/secure-traffic-mtls.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: \"v1\"\nupstreamAuthority: \"awssecret\"\nconfig:\n    region: \"us-west-2\"\n    cert_file_arn: \"arn:aws:acm-pca::123456789012:certificate-authority/test\"\n    key_file_arn: \"arn:aws:acm-pca::123456789012:certificate-authority/test-key\"\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent on FreeBSD\nDESCRIPTION: This command installs the NGINX Agent package on FreeBSD using the `pkg` package manager. Root privileges are needed to install the package. The `<agent-version>` placeholder should be replaced with the actual version of the downloaded package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-github.md#_snippet_4\n\nLANGUAGE: Shell\nCODE:\n```\nsudo pkg add nginx-agent-<agent-version>.pkg\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration\nDESCRIPTION: This command reloads the NGINX configuration without downtime. It requires Nginx to be running and the user to have appropriate permissions. This command applies configuration changes after uninstalling the dynamic module and removing related directives.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/uninstall.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Injecting the Sidecar Proxy Manually using nginx-meshctl\nDESCRIPTION: This command manually injects the NGINX Service Mesh sidecar proxy into a Kubernetes Deployment manifest file. It uses `nginx-meshctl inject` to modify the YAML file and then pipes the output to `kubectl apply` to deploy the modified configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/deploy-example-app.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl inject < examples/bookinfo.yaml | kubectl apply -f -\n```\n\n----------------------------------------\n\nTITLE: Setting Default MIME Type - Nginx\nDESCRIPTION: This Nginx configuration sets the default MIME type to `text/html`. It includes the standard MIME types configuration file and then sets the default type. This ensures that if the server does not specify a MIME type, `text/html` is used.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_20\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'http' block\ninclude /etc/nginx/mime.types;\ndefault_type text/html;\n```\n\n----------------------------------------\n\nTITLE: HTTPRoute ClientSettingsPolicy status example\nDESCRIPTION: This snippet demonstrates the status output for the ClientSettingsPolicy applied to the HTTPRoute showing that the policy is accepted and lists HTTPRoute as the ancestor reference.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_17\n\nLANGUAGE: text\nCODE:\n```\nStatus:\n  Ancestors:\n    Ancestor Ref:\n      Group:      gateway.networking.k8s.io\n      Kind:       HTTPRoute\n      Name:       tea\n      Namespace:  default\n    Conditions:\n      Last Transition Time:  2024-05-30T19:57:18Z\n      Message:               Policy is accepted\n      Observed Generation:   1\n      Reason:                Accepted\n      Status:                True\n      Type:                  Accepted\n    Controller Name:         gateway.nginx.org/nginx-gateway-controller\nEvents:                      <none>\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration (Proxy)\nDESCRIPTION: This command reloads the Nginx configuration after the reverse proxy configuration (proxy.conf) has been created or modified.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_10\n\nLANGUAGE: none\nCODE:\n```\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Build NGINX Plus Image (Debian, Older Agent)\nDESCRIPTION: Builds an NGINX Plus image with Debian as the base operating system and a specific older version of the NGINX Agent. The `OS_RELEASE` and `OS_VERSION` variables define the Debian distribution, and `NGINX_AGENT_VERSION` specifies the agent version. A license is required to use NGINX Agent with NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/container-environments/docker-images.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\nIMAGE_BUILD_TARGET=install-agent-repo NGINX_AGENT_VERSION=2.37.0~bullseye OS_RELEASE=debian OS_VERSION=bullseye-slim make image\n```\n\n----------------------------------------\n\nTITLE: Creating a Support Package (Bash)\nDESCRIPTION: This command uses the `helper.sh` script to create a support package for diagnosing issues with NGINX Controller. It can optionally save the package to a specific file, skip the database dump, and specify the timeseries data included. The default behavior is to create a package with a database dump and 12 hours of timeseries data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh supportpkg [-o|--output <file name>] [-s|--skip-db-dump] [-t|--timeseries-dump <hours>]\n```\n\n----------------------------------------\n\nTITLE: Curl Output for Secure App Traffic\nDESCRIPTION: This is the expected output from the `curl` command when sending traffic to the `secure-app`. It showcases the TLS handshake, certificate details, and the HTTP response from the application, confirming that the TLS connection was terminated by the `secure-app` itself.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/tls-passthrough.md#_snippet_6\n\nLANGUAGE: text\nCODE:\n```\nAdded app.example.com:8443:127.0.0.1 to DNS cache\n* Hostname app.example.com was found in DNS cache\n*   Trying 127.0.0.1:8443...\n* Connected to app.example.com (127.0.0.1) port 8443\n* ALPN: curl offers h2,http/1.1\n* (304) (OUT), TLS handshake, Client hello (1):\n* (304) (IN), TLS handshake, Server hello (2):\n* (304) (IN), TLS handshake, Unknown (8):\n* (304) (IN), TLS handshake, Certificate (11):\n* (304) (IN), TLS handshake, CERT verify (15):\n* (304) (IN), TLS handshake, Finished (20):\n* (304) (OUT), TLS handshake, Finished (20):\n* SSL connection using TLSv1.3 / AEAD-AES256-GCM-SHA384 / [blank] / UNDEF\n* ALPN: server accepted http/1.1\n* Server certificate:\n*  subject: C=US; ST=CA; L=San Francisco; CN=app.example.com\n*  start date: Mar 23 23:20:43 2020 GMT\n*  expire date: Mar 23 23:20:43 2023 GMT\n*  issuer: C=US; ST=CA; L=San Francisco; CN=app.example.com\n*  SSL certificate verify result: self signed certificate (18), continuing anyway.\n* using HTTP/1.x\n> GET / HTTP/1.1\n> Host: app.example.com:8443\n> User-Agent: curl/8.6.0\n> Accept: */*\n>\n< HTTP/1.1 200 OK\n< Server: nginx/1.27.0\n< Date: Wed, 14 Aug 2024 20:41:21 GMT\n< Content-Type: text/plain\n< Content-Length: 43\n< Connection: keep-alive\n<\nhello from pod secure-app-575785644-kzqf6\n```\n\n----------------------------------------\n\nTITLE: Nginx ConfigMap Configuration for Nginx Instance Manager certificates\nDESCRIPTION: Adds configuration lines to the `mgmt` block of the `nginx-includes-bootstrap` ConfigMap to configure the SSL certificates for NGINX Instance Manager reporting. It specifies the CA certificate, client certificate, and client certificate key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/nginx-plus-jwt.md#_snippet_6\n\nLANGUAGE: text\nCODE:\n```\nssl_trusted_certificate /etc/nginx/certs-bootstrap/ca.crt;\nssl_certificate        /etc/nginx/certs-bootstrap/tls.crt;\nssl_certificate_key    /etc/nginx/certs-bootstrap/tls.key;\n```\n\n----------------------------------------\n\nTITLE: Start bd_agent process for NAP\nDESCRIPTION: This command manually starts the bd_agent process for NGINX App Protect (NAP) when it's not found after installing NAP 3.6. It uses su to execute the command as the nginx user, then restarts the Nginx service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/apim/apim-release-notes-3.19.2.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n/bin/su -s /bin/bash -c '/opt/app_protect/bin/bd_agent &' nginx.\n```\n\n----------------------------------------\n\nTITLE: Changing Instance's Config Sync Group\nDESCRIPTION: Changes the config sync group membership of an NGINX instance by modifying the `agent-dynamic.conf` file and restarting the NGINX Agent. This operation allows moving an instance from one config sync group to another, enabling it to inherit the configuration of the new group.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/nginx-configs/manage-config-sync-groups.md#_snippet_3\n\nLANGUAGE: text\nCODE:\n```\ninstance_group: <new_config_sync_group>\n```\n\n----------------------------------------\n\nTITLE: Generating Signature Report (preset fields)\nDESCRIPTION: This example demonstrates how to generate a signature report with a specific set of fields (name, signatureId) using the `get-signatures` tool. The `--fields` option is used to specify the desired fields, resulting in a smaller, more focused report.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_25\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker run --rm \\\n -v $(pwd):$(pwd) \\\n --entrypoint=/opt/app_protect/bin/get-signatures \\\n waf-compiler-<version-tag>:custom \\\n -o $(pwd)/signature-report.json --fields=name,signatureId\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Instance Manager (Shell)\nDESCRIPTION: This command restarts the NGINX Instance Manager service. This is necessary to apply any changes made to the `nms.conf` configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-forward-proxy.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nms\n```\n\n----------------------------------------\n\nTITLE: Configuring Syslog\nDESCRIPTION: Shows how to configure the NGINX Amplify Agent for syslog in the agent.conf file. This allows the agent to collect Nginx log files via syslog, which is useful when logs are not kept on disk or in container environments. Requires a restart of the agent after configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/configuring-amplify-agent.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\n[listeners]\nkeys = syslog-default\n\n[listener_syslog-default]\naddress = 127.0.0.1:12000\n```\n\n----------------------------------------\n\nTITLE: Tagging the Docker Image - Shell\nDESCRIPTION: This shell snippet shows how to tag the docker image. This is run to specify the repository and version tag of the image, making it ready for pushing to your private registry.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/frequently-used-helm-configs.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ndocker tag apigw-plus <my-docker-registry>/nms-apigw-plus:<version>\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX Plus Repository - Shell\nDESCRIPTION: This shell command adds the NGINX Plus repository to the `/etc/apk/repositories` file. It dynamically determines the Alpine Linux version from `/etc/alpine-release` and constructs the correct repository URL, appending it to the repositories file using `sudo tee -a`. Requires `egrep` and `sudo`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-plus-alpine.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\nprintf \"https://pkgs.nginx.com/plus/alpine/v`egrep -o '^[0-9]+\\.[0-9]+' /etc/alpine-release`/main\\n\" | sudo tee -a /etc/apk/repositories\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Instance Manager (CentOS, RHEL)\nDESCRIPTION: Installs the latest version of the NGINX Instance Manager package using yum. This command deploys the Instance Manager platform.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum install -y nms-instance-manager\n```\n\n----------------------------------------\n\nTITLE: NGINX API Gateway Entrypoint Script\nDESCRIPTION: This bash script serves as the entrypoint for the NGINX Plus API Gateway container. It handles TERM signals, starts Nginx and Nginx-Agent, and waits for the agent to stop before exiting. The script requires CONTROL_PLANE_IP and INSTANCE_GROUP environment variables to be set.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/devportal-helm-chart.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\n#!/bin/bash\n\nset -euxo pipefail\n\nhandle_term()\n{\n    echo \"received TERM signal\"\n    echo \"stopping nginx-agent ...\"\n    kill -TERM \"${agent_pid}\" 2>/dev/null\n    echo \"stopping nginx ...\"\n    kill -TERM \"${nginx_pid}\" 2>/dev/null\n}\n\ntrap 'handle_term' TERM\n\nif [ -z \"${CONTROL_PLANE_IP}\" ]; then\n    echo \"ERROR CONTROL_PLANE_IP environment variable needs to be set.\"\n    exit 1\nfi\n\nif [ -z \"${INSTANCE_GROUP}\" ]; then\n    echo \"ERROR INSTANCE_GROUP environment variable needs to be set.\"\n    exit 1\nfi\n\n# Launch nginx\necho \"starting nginx ...\"\nnginx -g \"daemon off;\" &\n\nnginx_pid=$!\n\n# start nginx-agent, pass args\necho \"starting nginx-agent ...\"\nnginx-agent --instance-group \"${INSTANCE_GROUP}\" --server-host \"${CONTROL_PLANE_IP}\" &\n\nagent_pid=$!\n\nwait_term()\n{\n    wait ${agent_pid}\n    trap - TERM\n    kill -QUIT \"${nginx_pid}\" 2>/dev/null\n    echo \"waiting for nginx to stop...\"\n    wait ${nginx_pid}\n}\n\nwait_term\n\necho \"nginx-agent process has stopped, exiting.\"\n```\n\n----------------------------------------\n\nTITLE: Uploading Acknowledgement Report to NGINX Instance Manager\nDESCRIPTION: Uploads the acknowledgement report to NGINX Instance Manager using `curl`. The command utilizes the `$ip_address`, `$basic_auth` and `$report_save_path` variables.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\ncurl --insecure --location \"https://$ip_address/api/platform/v1/report/upload\" \\\n--header \"Authorization: Basic $basic_auth\" \\\n--form \"file=@\\\"$report_save_path\\\"\" \\\n--silent --output /dev/null\n```\n\n----------------------------------------\n\nTITLE: Create Kind Cluster\nDESCRIPTION: This command creates a Kubernetes cluster using kind, based on the configuration provided in the cluster-config.yaml file. It ensures a node image, prepares nodes, writes configuration, starts the control-plane, installs CNI, and installs a StorageClass.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkind create cluster --config cluster-config.yaml\n```\n\n----------------------------------------\n\nTITLE: Start/Stop Helper Container (Shell)\nDESCRIPTION: These shell commands start and stop the helper container named mynginx4_files, respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_27\n\nLANGUAGE: shell\nCODE:\n```\ndocker start mynginx4_files\ndocker stop mynginx4_files\n```\n\n----------------------------------------\n\nTITLE: Install XSLT Module on Alpine\nDESCRIPTION: This shell command installs the `nginx-plus-module-xslt` package on Alpine systems. It uses `apk` as the package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/xslt.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-xslt\n```\n\n----------------------------------------\n\nTITLE: Testing Nginx configuration\nDESCRIPTION: This snippet shows the command to test the Nginx configuration for syntax errors before reloading the configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginx-waf.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Creating SSL Directory\nDESCRIPTION: Creates the `/etc/ssl/nginx/` directory which will be used to store SSL certificates and keys for Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-debian.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/ssl/nginx\n```\n\n----------------------------------------\n\nTITLE: Show Error Logs - Bash\nDESCRIPTION: This command displays the contents of the Nginx data host error log file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_44\n\nLANGUAGE: bash\nCODE:\n```\nsudo cat /var/log/nginx/data-host-error.log\n```\n\n----------------------------------------\n\nTITLE: NGINX Plus repository URL for Debian\nDESCRIPTION: Shows the repository URL for Debian to pin NGINX Plus to a specific version (R33). It needs to be updated in `/etc/apt/sources.list.d/nginx-plus.list`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/pin-to-version/pin-debian-ubuntu-R32.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nhttps://pkgs.nginx.com/plus/R33/debian\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX from yum Repository on Amazon Linux\nDESCRIPTION: This command utilizes the yum package manager to install the NGINX web server from the configured repository. It prompts for GPG key verification before proceeding with the installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_47\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install nginx\n```\n\n----------------------------------------\n\nTITLE: Uninstall AVRD - Debian/Ubuntu\nDESCRIPTION: This snippet uninstalls the Analytics, Visibility, and Reporting Daemon (AVRD) and related modules on Debian/Ubuntu systems using apt-get. It purges the avrd, nginx-plus-module-metrics, and avrd-libs packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-agent.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get purge avrd nginx-plus-module-metrics avrd-libs\n```\n\n----------------------------------------\n\nTITLE: Setting Transparent Enforcement Mode in Policy JSON\nDESCRIPTION: This JSON snippet sets the enforcement mode to 'transparent' for a given policy. When `enforcementMode` is set to 'transparent', any illegal or suspicious requests are logged but not blocked. It requires defining a policy name and referencing the base template.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/policy-authoring-and-tuning.md#_snippet_3\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"policy_name\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"transparent\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Change Directory\nDESCRIPTION: Changes the current directory to the location where the Docker images were downloaded.  This is necessary to run the `docker load` command in the next step.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/devportal-helm-chart.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ncd <directory name>\n```\n\n----------------------------------------\n\nTITLE: Inject Kubernetes resources through CLI\nDESCRIPTION: Command to inject Kubernetes resources with the NSM sidecar through the CLI using the `nginx-meshctl` tool. This is a workaround for the issue where injecting through the API returns unformatted text. The command utilizes the `-f` flag to specify the resource definition file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.5.0.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n./nginx-meshctl inject -f <your-resource-definition-file>\n```\n\n----------------------------------------\n\nTITLE: Check Nginx Status Shell\nDESCRIPTION: This command checks the status of the NGINX Plus server by logging into the virtual machine (VM) and executing the `/etc/init.d/nginx status` command. This allows you to verify if NGINX Plus is running properly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus-google-cloud-platform.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\n/etc/init.d/nginx status\n```\n\n----------------------------------------\n\nTITLE: Download Nginx Agent Installation Script (Bash)\nDESCRIPTION: This command downloads the NGINX Agent installation script from a specified NMS_FQDN.  This is a prerequisite step for installing the NGINX Agent with command-line options to assign the instance to an instance group. Requires `curl` to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/manage-instance-groups.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncurl https://<NMS_FQDN>/install/nginx-agent > install.sh\n```\n\n----------------------------------------\n\nTITLE: Modify RateLimit to use v2-only match\nDESCRIPTION: This YAML configuration updates the RateLimit resource 'ratelimit-v1' to use only the 'v2-only' match from the 'hrg' HTTPRouteGroup. This restricts the rate limit to only GET requests with the 'x-demo:true' header and the path '/configuration-v2'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_15\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi.nginx.com/v1alpha2\nkind: RateLimit\nmetadata:\n   name: ratelimit-v1\n   namespace: default\nspec:\n   destination:\n     kind: Service\n     name: dest-svc\n     namespace: default\n   sources:\n   - kind: Deployment\n     name: client-v1\n     namespace: default\n   - kind: Deployment\n     name: client-v2\n     namespace: default\n   name: 10rm\n   rate: 10r/m\n   rules:\n   - kind: HTTPRouteGroup\n     name: hrg\n     matches:\n     - v2-only\n```\n\n----------------------------------------\n\nTITLE: Defining Rate Limit with Burst in YAML\nDESCRIPTION: This YAML configuration defines a RateLimit resource named 'ratelimit-burst' that applies to traffic from the 'bursty-client' Deployment to the 'dest-svc' Service. It sets a rate of 1 request per second (1r/s) and allows a burst of 2 additional requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_22\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: specs.smi.nginx.com/v1alpha2\nkind: RateLimit\nmetadata:\n  name: ratelimit-burst\n  namespace: default\nspec:\n  destination:\n    kind: Service\n    name: dest-svc\n    namespace: default\n  sources:\n  - kind: Deployment\n    name: bursty-client\n    namespace: default\n  name: ratelimit-burst\n  rate: 1r/s\n  burst: 2\n```\n\n----------------------------------------\n\nTITLE: Configuring Status Zone Directive in Nginx Server Block\nDESCRIPTION: This snippet configures the `status_zone` directive within a server block for HTTPS traffic.  The `status_zone` directive associates the server block with a shared memory zone. This enables Nginx to collect and expose performance statistics for the server, which are then available through the Nginx Plus API and dashboard.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_33\n\nLANGUAGE: nginx\nCODE:\n```\n# In the 'server' block for HTTPS traffic\nstatus_zone nodejs_server;\n```\n\n----------------------------------------\n\nTITLE: Editing a Rate Limit Policy using Kubectl\nDESCRIPTION: This command opens the `ratelimit-v1` resource in a text editor, allowing modification of the rate limit policy. The changes are then applied to the Kubernetes cluster upon saving and exiting the editor.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nkubectl edit ratelimit ratelimit-v1\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Controller Support Package\nDESCRIPTION: This command downloads a support package from the NGINX Controller host to a local machine. It uses `scp` to securely copy the file, requiring the username, controller host IP, and timestamp. Ensure the local path exists and is accessible.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-controller.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nscp <username>@<controller-host-ip>:/var/tmp/supportpkg-<timestamp>.tar.gz /local/path\n```\n\n----------------------------------------\n\nTITLE: Retrieving Possible/Likely Threat Events (curl)\nDESCRIPTION: This query retrieves security violation events flagged by App Security’s violation rating algorithm as a possible or likely threat for specific application components.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/view-app-security-analytics.md#_snippet_8\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            request_outcome_reason = 'SECURITY_WAF_FLAGGED' and\n            waf.violation_rating in ('POSSIBLE_ATTACK','MOST_LIKELY_ATTACK') and\n            app='shopping' and\n            environment='prod' and\n            component='app-component')\n```\n\n----------------------------------------\n\nTITLE: Default Policy Configuration in JSON\nDESCRIPTION: This JSON snippet represents the default policy configuration for NGINX App Protect. It defines the policy name and specifies the base template to be used. The policy enforces violations based on the Violation Rating.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/concept/basic-config-default-policy.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\" : {\n        \"name\": \"app_protect_default_policy\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring NATS Storage in NGINX Instance Manager\nDESCRIPTION: This YAML snippet configures the NATS storage for NGINX Instance Manager. It includes settings for the storage name, an optional existing persistent volume claim, storage size, and the access mode. This configuration contributes to the `nms-hybrid.core.persistence.claims` setting within the Helm chart.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/helm-config-settings.md#_snippet_3\n\nLANGUAGE: YAML\nCODE:\n```\n  - name: nats-streaming\n    existingClaim:\n    size: 1Gi\n    accessMode: ReadWriteOnce\n```\n\n----------------------------------------\n\nTITLE: Configure PostgreSQL HBA (Debian, Ubuntu, Deb-based)\nDESCRIPTION: Configures the PostgreSQL host-based authentication (HBA) file on Debian, Ubuntu, or Deb-based systems. It uses `cat` and `tee` to write the configuration to `/etc/postgresql/<pg_version>/main/pg_hba.conf`, allowing local connections and IPv4/IPv6 connections with md5 authentication. `<pg_version>` should be replaced with the PostgreSQL version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ncat << EOF | sudo tee /etc/postgresql/<pg_version>/main/pg_hba.conf\n\n# TYPE DATABASE USER ADDRESS METHOD\n\nlocal all postgres peer\nlocal all all md5\n# IPv4 local connections:\nhost all all 127.0.0.1/32 md5\n# IPv6 local connections:\nhost all all ::1/128 md5\nEOF\n```\n\n----------------------------------------\n\nTITLE: Running the NGINX Diagnostic Package Script\nDESCRIPTION: This command executes the `nginx-supportpkg.sh` script with root privileges. The script collects various diagnostic information about the NGINX installation and creates a `.tar.gz` archive containing the collected data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/diagnostic-package.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo ./nginx-supportpkg.sh\n```\n\n----------------------------------------\n\nTITLE: Delete NGINXaaS Deployment (Azure CLI)\nDESCRIPTION: This command deletes an NGINXaaS deployment using the Azure CLI's NGINX extension. It requires specifying the deployment name and resource group.  The `--yes` flag skips the confirmation prompt, and `--no-wait` enables asynchronous deletion.  The specified deployment must exist for this command to succeed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/create-deployment/deploy-azure-cli.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment delete [--deployment-name]\n                           [--ids]\n                           [--no-wait {0, 1, f, false, n, no, t, true, y, yes}]\n                           [--resource-group]\n                           [--subscription]\n                           [--yes]\n```\n\n----------------------------------------\n\nTITLE: Deploy Configuration to Instance (Shell)\nDESCRIPTION: This `curl` command sends a POST request to the NGINX Instance Manager REST API to deploy an updated NGINX configuration to a specific instance. It requires a valid access token, systemUID, nginxUID, and the base64-encoded configuration content.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_26\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X POST https://{{NMS_FQDN}}/api/platform/v1/security/{systemUID}/instances/{nginxUID}/config \\\n-H \"Authorization: Bearer <access token>\" \\\n--header \"Content-Type: application/json\" \\\n-d '{\n\"configFiles\": {\n  \"rootDir\": \"/etc/nginx\",\n  \"files\": [\n    {\n      \"name\": \"nginx.conf\",\n      \"contents\": \"<base64-encoded-content>\"\n    }\n  ]\n},\n\"validateConfig\": true\n}'\n```\n\n----------------------------------------\n\nTITLE: Modify CRS Rules for XSS Blocking\nDESCRIPTION: Shows how to modify the CRS rules (941160 and 941320) to include `REQUEST_URI` in the variables list. This enables the CRS to block requests with XSS attempts in the URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nSecRule REQUEST_URI|REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/ ...\n```\n\n----------------------------------------\n\nTITLE: Adding Ingress Label to Nginx Ingress Controller Pod Spec (YAML)\nDESCRIPTION: Adds the `nsm.nginx.com/enable-ingress: \"true\"` label to the Ingress Controller's Pod spec. This label instructs NGINX Service Mesh to configure the Ingress Controller Pod for proper integration with the mesh, enabling ingress traffic management.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nlabels:\n  nsm.nginx.com/enable-ingress: \"true\"\n  ...\n```\n\n----------------------------------------\n\nTITLE: Example NMS HTTP Configuration (nms-http.conf)\nDESCRIPTION: This example configuration shows how to integrate OpenID Connect (OIDC) into the NGINX Instance Manager's HTTP configuration. It sets headers for user information (email, groups, external ID) and includes the `openid_connect.conf` file to handle authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/microsoft-entra-setup.md#_snippet_4\n\nLANGUAGE: yaml\nCODE:\n```\n# NGINX Instance Manager - Instance Manager configuration\n# Created for v. 2.0\n# (c) NGINX, Inc. 2021\n\n# OIDC: use email as a unique identifier\nproxy_set_header Nginx-Management-Suite-User $user_email;\nproxy_set_header Nginx-Management-Suite-Groups $groups_claim;\nproxy_set_header Nginx-Management-Suite-ExternalId $jwt_claim_sub;\n\n# OIDC authentication\ninclude /etc/nms/nginx/oidc/openid_connect.conf;\n```\n\n----------------------------------------\n\nTITLE: Pushing NGINX Ingress Controller Image to AWS ECR\nDESCRIPTION: This command pushes the tagged NGINX Plus Ingress Controller image to the specified AWS ECR repository. It requires the AWS account ID, region code, and ECR repository name. This step deploys the built image to AWS for use in the EKS cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_4\n\nLANGUAGE: Shell\nCODE:\n```\ndocker push <aws_account_id>.dkr.ecr.<aws_region_code>.amazonaws.com/<ecr_repo>:edge\n```\n\n----------------------------------------\n\nTITLE: Adding Instance to Config Sync Group\nDESCRIPTION: Adds an existing NGINX instance to a config sync group by modifying the `agent-dynamic.conf` file and restarting the NGINX Agent. This configuration change associates the instance with the specified config sync group, ensuring it receives the group's configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/nginx-configs/manage-config-sync-groups.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\ninstance_group: <config_sync_group>\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX on SUSE\nDESCRIPTION: This command installs the NGINX web server package using the zypper package manager. It downloads and installs the package along with its dependencies.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_36\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper install nginx\n```\n\n----------------------------------------\n\nTITLE: Pulling NGINX Plus Image from Private Registry\nDESCRIPTION: This command pulls the specified NGINX Plus image from the private registry. Replace `VERSION_TAG` with the desired version tag. This example uses the `agent` image, which includes the NGINX Agent for communication with NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-plus-and-agent-docker.md#_snippet_2\n\nLANGUAGE: Shell\nCODE:\n```\nsudo docker pull private-registry.nginx.com/nginx-plus/agent:VERSION_TAG\n```\n\n----------------------------------------\n\nTITLE: Install NDK Module on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This shell command updates the package manager and installs the nginx-plus-module-ndk package on Amazon Linux 2, CentOS, Oracle Linux, and RHEL systems. It ensures that the system has the latest package information before attempting to install the NDK module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/ndk.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-ndk\n```\n\n----------------------------------------\n\nTITLE: Tea application response example\nDESCRIPTION: This snippet shows the expected response from the tea application after a successful HTTP request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_7\n\nLANGUAGE: text\nCODE:\n```\nServer address: 10.244.0.9:8080\nServer name: tea-76c7c85bbd-cf8nz\n```\n\n----------------------------------------\n\nTITLE: Change Directory (Bash)\nDESCRIPTION: Change the current working directory to `/opt/nginx-controller`. This is a prerequisite for running subsequent commands related to NGINX Controller's helper script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-embedded-config-db.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncd /opt/nginx-controller\n```\n\n----------------------------------------\n\nTITLE: SELinux: Delete httpd_t from permissive list (Shell)\nDESCRIPTION: This command removes the `httpd_t` domain from the permissive list in SELinux. It is the final step in the SELinux troubleshooting process and restores SELinux to its enforcing state after identifying and applying the necessary exceptions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/troubleshooting-guide/how-to-troubleshoot.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsemanage permissive -d httpd_t\n```\n\n----------------------------------------\n\nTITLE: Configuring Parameter Location Restriction in Nginx App Protect\nDESCRIPTION: This JSON snippet demonstrates how to configure a parameter named \"headerparam\" to only be valid when located in the header.  If the parameter appears in any other location, the VIOL_PARAMETER_LOCATION violation is triggered.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/do-nothing-and-user-defined-parameters.md#_snippet_4\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"user_defined_parameters_misc_test\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_PARAMETER_NUMERIC_VALUE\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_VALUE_LENGTH\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_STATIC_VALUE\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_DATA_TYPE\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_PARAMETER_LOCATION\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"parameters\": [\n            {\n                \"name\": \"headerparam\",\n                \"type\": \"explicit\",\n                \"parameterLocation\": \"header\",\n                \"mandatory\": false,\n                \"allowEmptyValue\": false,\n                \"allowRepeatedParameterName\": false,\n                \"sensitiveParameter\": false,\n                \"valueType\": \"user-input\",\n                \"dataType\": \"alpha-numeric\",\n                \"checkMinValueLength\": false,\n                \"checkMaxValueLength\": false\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Reboot the System - Bash\nDESCRIPTION: This command reboots the system. This is the final step of the main workaround for expired Kubernetes certificates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo shutdown now -r\n```\n\n----------------------------------------\n\nTITLE: Proxy Set Header for Nested JWT - Nginx Configuration\nDESCRIPTION: This snippet configures Nginx Plus to pass the decrypted payload of a nested JWT to the backend application as the Bearer token value in the `Authorization` header. The `$jwt_payload` contains the JWS payload after JWE decryption.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-jwt-authentication.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\nproxy_set_header Authorization \"Bearer $jwt_payload\";\n```\n\n----------------------------------------\n\nTITLE: Add SSL settings to pkg.conf on FreeBSD\nDESCRIPTION: This configuration snippet adds SSL-related environment variables to the /usr/local/etc/pkg.conf file. This allows the FreeBSD package manager to use the client certificate and key for accessing the NGINX Plus repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_14\n\nLANGUAGE: None\nCODE:\n```\nPKG_ENV: { SSL_NO_VERIFY_PEER: \"1\",\nSSL_CLIENT_CERT_FILE: \"/etc/ssl/nginx/nginx-repo.crt\",\nSSL_CLIENT_KEY_FILE: \"/etc/ssl/nginx/nginx-repo.key\" }\n```\n\n----------------------------------------\n\nTITLE: Install prerequisite packages\nDESCRIPTION: Installs necessary packages required for setting up the NGINX repository and managing HTTPS connections. These include apt-transport-https, lsb-release, ca-certificates, wget, gnupg2, and ubuntu-keyring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-ubuntu.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get update && sudo apt-get install apt-transport-https lsb-release ca-certificates wget gnupg2 ubuntu-keyring\n```\n\n----------------------------------------\n\nTITLE: Updating NGINX Instance Manager on RPM-based systems\nDESCRIPTION: This command updates the NGINX Instance Manager package on CentOS, RHEL, and other RPM-based systems using the `yum` package manager. The `-y` flag automatically answers yes to any prompts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_16\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum update -y nms-instance-manager\n```\n\n----------------------------------------\n\nTITLE: Install specific version of nginx-plus-module-metrics (CentOS 7)\nDESCRIPTION: This snippet illustrates how to install a specific version (1.19) of the `nginx-plus-module-metrics` module on CentOS 7, as part of a workaround. `yum install` is used with a wildcard to match the 1.19 version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_32\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum install -y nginx-plus-module-metrics-1.19*\n```\n\n----------------------------------------\n\nTITLE: Deploy Coffee Applications\nDESCRIPTION: Deploys the `coffee-v1` and `coffee-v2` applications using `kubectl apply`. This command fetches the application definitions from a remote YAML file and creates the necessary Kubernetes resources.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/advanced-routing.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/examples/advanced-routing/coffee.yaml\n```\n\n----------------------------------------\n\nTITLE: Example: User Defined Signatures JSON Content\nDESCRIPTION: Example content of the generated JSON file.  It contains an array of signatures, each with various attributes such as attackType, name, rule, description, revision, systems, accuracy, signatureId, signatureType and risk.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_21\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"signatures\": [\n        {\n            \"attackType\": {\n                \"name\": \"Buffer Overflow\"\n            },\n            \"name\": \"my_first_sig\",\n            \"lastUpdateMicros\": 1606014750000000,\n            \"rule\": \"content:\\\"first_sig\\\"; nocase;\",\n            \"description\": \"This is the first user defined signature\",\n            \"revision\": \"1\",\n            \"systems\": [\n                {\n                    \"name\": \"Microsoft Windows\"\n                }\n            ],\n            \"accuracy\": \"low\",\n            \"signatureId\": \"300000002\",\n            \"signatureType\": \"request\",\n            \"risk\": \"low\"\n        },\n        {\n            \"attackType\": {\n                \"name\": \"Command Execution\"\n            },\n            \"name\": \"my_second_sig\",\n            \"lastUpdateMicros\": 1606014818000000,\n            \"rule\": \"uricontent:\\\"second_sig\\\"; nocase; objonly;\",\n            \"description\": \"Short description of the signature\",\n            \"revision\": \"1\",\n            \"systems\": [\n                {\n                    \"name\": \"Unix/Linux\"\n                }\n            ],\n            \"accuracy\": \"medium\",\n            \"signatureId\": \"300000003\",\n            \"signatureType\": \"request\",\n            \"risk\": \"medium\"\n        }\n    ],\n    \"tag\": \"user-defined-signatures\"\n}\n```\n\n----------------------------------------\n\nTITLE: Describe Kubernetes VirtualServer Resource (Bash)\nDESCRIPTION: This command retrieves detailed information about a Kubernetes VirtualServer resource named `target-vs-internal-route` in the `legacy` namespace. It is used to verify the VirtualServer configuration after creation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nkubectl -n legacy describe virtualserver target-vs-internal-route\n```\n\n----------------------------------------\n\nTITLE: Refresh Subscription Manager\nDESCRIPTION: This command refreshes the subscription manager. This can resolve the issue where the Nginx controller cannot install or update due to a status code 403 error.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nsudo subscription-manager refresh\n```\n\n----------------------------------------\n\nTITLE: Installing Lua module on SLES\nDESCRIPTION: These commands refresh the package repositories and install the `nginx-plus-module-lua` package using `zypper`. This assumes that the nginx-plus repository is configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/lua.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-lua\n```\n\n----------------------------------------\n\nTITLE: Setting TLS parameters via NGINX Controller REST API\nDESCRIPTION: This code snippet shows how to configure TLS settings for health checks using the NGINX Controller REST API. It enables Server Name Indication (SNI) by setting the `isServerNameEnabled` property to true and the name to `$host` in the TLS object. This allows data plane traffic to have SNI information where multiple virtual hosts exist per workload group member, and health checking inherits these settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n\"tls\":{\"isServerNameEnabled\": true, \"name\": \"$host\"}\n```\n\n----------------------------------------\n\nTITLE: Send traffic to Headers application (Response) - Shell\nDESCRIPTION: Sends a curl request to the headers application and includes the response headers in the output using the `-i` flag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ncurl -i --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/headers\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Signing Key - Shell\nDESCRIPTION: Downloads the official NGINX signing key from nginx.org. This key is used to verify the authenticity of the NGINX Agent packages before installation on SLES systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\ncurl -o /tmp/nginx_signing.key https://nginx.org/keys/nginx_signing.key\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX FIPS module on Debian and Ubuntu\nDESCRIPTION: This shell command sequence updates the package list and installs the nginx-plus-module-fips-check package using the apt package manager on Debian and Ubuntu.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/fips.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-fips-check\n```\n\n----------------------------------------\n\nTITLE: Compiling and Installing NGINX\nDESCRIPTION: These commands compile the NGINX source code and install the compiled binary.  This should be run after configuring NGINX with the desired options, including debugging support.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo make\nsudo make install\n```\n\n----------------------------------------\n\nTITLE: Example Backend Application Configuration\nDESCRIPTION: This snippet configures a simple backend application that listens on port 8080 and returns a response containing the authenticated user's full name, email, and AD FS subject identifier. It expects the `name`, `email`, and `sub` headers to be set by Nginx. This is just an example for test purposes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/active-directory-federation-services.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\nserver {\n    listen 8080;\n\n    location / {\n        return 200 \"Hello, $http_name!\\nEmail: $http_email\\nAD FS sub: $http_sub\\n\";\n        default_type text/plain;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create Key Vault Access Policy - Azure CLI\nDESCRIPTION: This snippet creates an access policy for a key vault using the Azure CLI. Requires `KV_NAME`, `KV_RESOURCE_GROUP`, and `mi_principal_id` variables, granting 'get' permission for secrets.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\naz keyvault set-policy --name $KV_NAME \\\n      --resource-group $KV_RESOURCE_GROUP \\\n      --object-id $mi_principal_id \\\n      --secret-permissions get\n```\n\n----------------------------------------\n\nTITLE: Enabling Auto-Injection via Labeling a Namespace\nDESCRIPTION: This command enables automatic sidecar injection for all Pods within a specific namespace by applying the `injector.nsm.nginx.com/auto-inject=enabled` label. This ensures that all subsequently deployed pods in the namespace will automatically have the NGINX Service Mesh sidecar injected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/deploy-example-app.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubectl label namespaces default injector.nsm.nginx.com/auto-inject=enabled\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration (service command)\nDESCRIPTION: Reloads the Nginx configuration using the `service nginx reload` command. This applies the new configuration without restarting the server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_13\n\nLANGUAGE: none\nCODE:\n```\nroot# service nginx reload\n```\n\n----------------------------------------\n\nTITLE: Successful Backend Request - Bash\nDESCRIPTION: This snippet shows the output from a successful backend request, including the HTTP method, path, host, and headers.  The Authorization header is stripped by the policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_28\n\nLANGUAGE: bash\nCODE:\n```\nRequest served by echo-host\n\n   HTTP/1.0 POST /my/test/api\n\n   Host: default_http_a4334620-226b-491d-8503-e0724bdf5521\n   Accept: */*\n   Accept-Encoding: gzip, deflate, br\n   Cache-Control: no-cache\n   Connection: close\n   Content-Length: 30\n   Content-Type: application/json\n   X-Correlation-Id: ffc5dc656e220a20fa57835e0653f19f\n   X-Token-Exp: 1666003414\n   X-Token-Scope: openid email profile\n   X-Token-Username: nginx-user\n```\n\n----------------------------------------\n\nTITLE: List Backup Files (Bash)\nDESCRIPTION: This command lists the files in the `/mnt/local_pgdata/` directory, which is where the NFS share is mounted.  This allows the user to identify the desired backup file by its timestamp.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-embedded-config-db.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nls /mnt/local_pgdata/\n```\n\n----------------------------------------\n\nTITLE: Retrieving Security Violation Events by Support ID (curl)\nDESCRIPTION: This query retrieves security violation events based on a specific Support ID. It's useful for investigating specific incidents identified on the request blocking page.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/view-app-security-analytics.md#_snippet_3\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            waf.support_id='1880765231147185611')\n```\n\n----------------------------------------\n\nTITLE: Get OpenShift Network Policies\nDESCRIPTION: This command retrieves the OpenShift network policies in the `nms` namespace. It is used to verify that the network policies have been created and configured as expected, controlling network traffic to and from the NGINX Instance Manager pods within an OpenShift environment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\noc get netpol -n nms\n```\n\n----------------------------------------\n\nTITLE: Default NGINX server block\nDESCRIPTION: This is a basic NGINX server block that listens on port 80 and returns a 404 error. It serves as the default configuration when no specific Services or HTTPRoutes are defined.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    listen 80 default_server;\n\n    default_type text/html;\n    return 404;\n}\n```\n\n----------------------------------------\n\nTITLE: Setting Up Stable NGINX Repository on Alpine\nDESCRIPTION: This command adds the official NGINX stable repository to the apk package manager's list of repositories. It constructs the repository URL using the Alpine version from /etc/alpine-release and appends it to /etc/apk/repositories.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_38\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"%s%s%s\\n\" \\\n    \"http://nginx.org/packages/alpine/v\" \\\n    `egrep -o '^[0-9]+\\.[0-9]+' /etc/alpine-release` \\\n    \"/main\" \\\n    | sudo tee -a /etc/apk/repositories\n```\n\n----------------------------------------\n\nTITLE: Run NGINX Controller Support Package Utility\nDESCRIPTION: This command executes the helper script to create a support package. The default output location is `/var/tmp/supportpkg-<timestamp>.tar.gz`. No parameters are required to generate the basic support package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_15\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh supportpkg\n```\n\n----------------------------------------\n\nTITLE: JavaScript Module for NGINXaaS Cost Calculator\nDESCRIPTION: This JavaScript module is responsible for the dynamic behavior of the cost calculator. It likely handles user input, performs calculations for NCU estimation and monthly cost, updates the UI with the calculated values, and interacts with external data sources for region-specific pricing tiers. The script also handles the print functionality.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/billing/usage-and-cost-estimator.md#_snippet_1\n\nLANGUAGE: JavaScript\nCODE:\n```\n<script type=\"module\" src=\"/nginxaas-azure/js/cost-calculator_v2.js\"></script>\n```\n\n----------------------------------------\n\nTITLE: Change Directory\nDESCRIPTION: Changes the current directory to /etc/nginx/conf.d using the cd command. This is a prerequisite to modifying the nginx configuration files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/route-53-global-server-load-balancing.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ncd /etc/nginx/conf.d\n```\n\n----------------------------------------\n\nTITLE: Setting Default Command\nDESCRIPTION: This snippet sets the default command to start Nginx in the foreground. The `daemon off;` directive ensures that Nginx runs in the foreground, which is necessary for Docker to manage the process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-oss/build-oracle.md#_snippet_3\n\nLANGUAGE: dockerfile\nCODE:\n```\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Setting System Timezone to UTC using datetimectl\nDESCRIPTION: This command sets the system timezone to UTC. It is used to ensure that the timestamps in the NGINX and NGINX App Protect WAF log messages are presented in UTC time. Requires sudo privileges and `datetimectl` command to be available.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/releases/about-1.0.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo datetimectl set-timezone Etc/UTC\n```\n\n----------------------------------------\n\nTITLE: Install Metrics Module Insecurely - Bash\nDESCRIPTION: This command downloads and installs the NGINX Plus metrics module from NGINX Management Suite using `curl` over HTTPS, but disables certificate verification with the `--insecure` flag. It pipes the output to `sudo sh` to execute the installation script.  This is not recommended for production environments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-plus-advanced-metrics.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\ncurl --insecure https://<NMS_FQDN>/install/nginx-plus-module-metrics | sudo sh\n```\n\n----------------------------------------\n\nTITLE: Stream Upstream Active Connections Metric\nDESCRIPTION: Describes the 'plus.stream.upstream.conn.active' metric, which is a gauge representing the current number of connections to upstream servers. It shows the active connections for TCP/UDP based upstream servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_24\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, integer\nDescription: Current number of connections.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Create New Revision of Security Log Profile (POST) - Shell\nDESCRIPTION: This code snippet shows how to create a new revision of a security log profile using a POST request to the NGINX Instance Manager API. It uses `curl` to send the request with the `isNewRevision=true` parameter. The `-d` flag specifies the JSON payload to be sent from the `update-default-log.json` file. Requires `curl` and a valid access token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_18\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X POST https://{{NIM_FQDN}}/api/platform/v1/security/logprofiles?isNewRevision=true \\\n    -H \"Authorization: Bearer <access token>\" \\\n    -d @update-default-log.json\n```\n\n----------------------------------------\n\nTITLE: Deploy NGINX Gateway Fabric (Default)\nDESCRIPTION: This command deploys NGINX Gateway Fabric with NGINX OSS, utilizing a default deployment manifest from the nginx-gateway-fabric repository. It is crucial to have the CRDs applied beforehand. This command uses `kubectl apply` to apply the configurations specified in the remote YAML file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nkubectl apply -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/deploy/default/deploy.yaml\n```\n\n----------------------------------------\n\nTITLE: Enabling Data Guard with Blocking in NGINX App Protect WAF\nDESCRIPTION: This JSON snippet demonstrates how to enable the data guard violation in blocking mode within NGINX App Protect WAF. This configuration enables enforcement of data guard, protecting against information leakage of credit card numbers and US Social Security numbers. Blocking is enabled, so data masking will have no effect.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/signature-sets.md#_snippet_10\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"dataguard_blocking\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_DATA_GUARD\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ],\n\t\t\t\"urlExceptions\": []\n        },\n        \"data-guard\": {\n            \"enabled\": true,\n            \"maskData\": true,\n            \"creditCardNumbers\": true,\n            \"usSocialSecurityNumbers\": true,\n            \"enforcementMode\": \"ignore-urls-in-list\",\n            \"enforcementUrls\": []\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Check NGINX Controller status using helper script\nDESCRIPTION: This command is used to check the status of the NGINX Controller services using the provided helper script. It verifies if the services have stopped correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh controller status\n```\n\n----------------------------------------\n\nTITLE: Install Developer Portal (Debian, Ubuntu, Deb-based)\nDESCRIPTION: Installs the `nginx-devportal` and `nginx-devportal-ui` packages on Debian, Ubuntu, or Deb-based systems using `apt-get`. It first updates the package lists.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get update\nsudo apt-get -y install nginx-devportal nginx-devportal-ui\n```\n\n----------------------------------------\n\nTITLE: Verify Nginx installation on RHEL/CentOS\nDESCRIPTION: This command checks the installed version of Nginx, confirming successful installation. It executes the nginx command with the -v flag to display the version information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx -v\n```\n\n----------------------------------------\n\nTITLE: Backup Configuration Files - Linux\nDESCRIPTION: Backs up the NGINX configuration and log files on Linux systems before upgrading NGINX Plus. It copies the contents of /etc/nginx and /var/log/nginx to /etc/nginx-plus-backup and /var/log/nginx-plus-backup, respectively.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_52\n\nLANGUAGE: shell\nCODE:\n```\nsudo cp -a /etc/nginx /etc/nginx-plus-backup\nsudo cp -a /var/log/nginx /var/log/nginx-plus-backup\n```\n\n----------------------------------------\n\nTITLE: Copy Signature Report to NGINX Instance Manager (bash)\nDESCRIPTION: This command copies the `signature-report.json` file from the local machine to the `/usr/share/nms/sigdb/` directory on the NGINX Instance Manager control plane.  It uses `scp` to securely transfer the file over SSH. Requires SSH access to both machines and appropriate permissions to write to the destination directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/security-monitoring/update-signatures.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo scp /path/to/signature-report.json {user}@{host}:/usr/share/nms/sigdb/signature-report.json\n```\n\n----------------------------------------\n\nTITLE: Install XSLT Module on FreeBSD\nDESCRIPTION: This shell command updates the package manager and installs the `nginx-plus-module-xslt` package on FreeBSD systems. It uses `pkg` as the package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/xslt.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-xslt\n```\n\n----------------------------------------\n\nTITLE: Creating SSL Directory\nDESCRIPTION: Creates the /etc/ssl/nginx directory, which will store the SSL certificates required for secure communication. The -p flag ensures that parent directories are created if they don't exist.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_27\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/ssl/nginx\n```\n\n----------------------------------------\n\nTITLE: Example NGINX Logs for ACME Challenge Content (Text)\nDESCRIPTION: This example log output shows NGINX successfully serving the ACME challenge files.  These files are required by Let's Encrypt to verify ownership of the domain before issuing a certificate. The `GET` requests to `/.well-known/acme-challenge/` are from the cert-manager and Let's Encrypt validation servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/integrating-cert-manager.md#_snippet_9\n\nLANGUAGE: text\nCODE:\n```\n52.208.162.19 - - [15/Aug/2023:13:18:12 +0000] \"GET /.well-known/acme-challenge/bXQn27Lenax2AJKmOOS523T-MWOKeFhL0bvrouNkUc4 HTTP/1.1\" 200 87 \"-\" \"cert-manager-challenges/v1.12.0 (linux/amd64) cert-manager/bd192c4f76dd883f9ee908035b894ffb49002384\"\n52.208.162.19 - - [15/Aug/2023:13:18:14 +0000] \"GET /.well-known/acme-challenge/bXQn27Lenax2AJKmOOS523T-MWOKeFhL0bvrouNkUc4 HTTP/1.1\" 200 87 \"-\" \"cert-manager-challenges/v1.12.0 (linux/amd64) cert-manager/bd192c4f76dd883f9ee908035b894ffb49002384\"\n52.208.162.19 - - [15/Aug/2023:13:18:16 +0000] \"GET /.well-known/acme-challenge/bXQn27Lenax2AJKmOOS523T-MWOKeFhL0bvrouNkUc4 HTTP/1.1\" 200 87 \"-\" \"cert-manager-challenges/v1.12.0 (linux/amd64) cert-manager/bd192c4f76dd883f9ee908035b894ffb49002384\"\n52.208.162.19 - - [15/Aug/2023:13:18:18 +0000] \"GET /.well-known/acme-challenge/bXQn27Lenax2AJKmOOS523T-MWOKeFhL0bvrouNkUc4 HTTP/1.1\" 200 87 \"-\" \"cert-manager-challenges/v1.12.0 (linux/amd64) cert-manager/bd192c4f76dd883f9ee908035b894ffb49002384\"\n52.208.162.19 - - [15/Aug/2023:13:18:20 +0000] \"GET /.well-known/acme-challenge/bXQn27Lenax2AJKmOOS523T-MWOKeFhL0bvrouNkUc4 HTTP/1.1\" 200 87 \"-\" \"cert-manager-challenges/v1.12.0 (linux/amd64) cert-manager/bd192c4f76dd883f9ee908035b894ffb49002384\"\n3.128.204.81 - - [15/Aug/2023:13:18:22 +0000] \"GET /.well-known/acme-challenge/bXQn27Lenax2AJKmOOS523T-MWOKeFhL0bvrouNkUc4 HTTP/1.1\" 200 87 \"-\" \"Mozilla/5.0 (compatible; Let's Encrypt validation server; +https://www.letsencrypt.org)\"\n23.178.112.204 - - [15/Aug/2023:13:18:22 +0000] \"GET /.well-known/acme-challenge/bXQn27Lenax2AJKmOOS523T-MWOKeFhL0bvrouNkUc4 HTTP/1.1\" 200 87 \"-\" \"Mozilla/5.0 (compatible; Let's Encrypt validation server; +https://www.letsencrypt.org)\"\n35.166.192.222 - - [15/Aug/2023:13:18:22 +0000] \"GET /.well-known/acme-challenge/bXQn27Lenax2AJKmOOS523T-MWOKeFhL0bvrouNkUc4 HTTP/1.1\" 200 87 \"-\" \"Mozilla/5.0 (compatible; Let's Encrypt validation server; +https://www.letsencrypt.org)\"\n```\n\n----------------------------------------\n\nTITLE: Define gRPC Service in Proto File\nDESCRIPTION: Defines a gRPC service `photo_album` with two RPC methods: `upload_photo` and `get_photos`. It also defines the `Photo` and `PhotoResult` message types. The `OperationResult` and `Condition` messages are assumed to be defined in `common/messages.proto`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/grpc-content-profiles.md#_snippet_0\n\nLANGUAGE: protobuf\nCODE:\n```\nsyntax = \"proto3\";\n\npackage myorg.services;\n\nimport \"common/messages.proto\";\n\nservice photo_album {\n  rpc upload_photo (Photo) returns (OperationResult) {};\n  rpc get_photos (Condition) returns (PhotoResult) {};\n}\n\nmessage Photo {\n  string name = 1;\n  bytes image = 2;\n}\n\nmessage PhotoResult {\n  repeated Photo photos = 1;\n  OperationResult res = 2;\n}\n```\n\n----------------------------------------\n\nTITLE: Description of system.disk.in_use metric\nDESCRIPTION: Provides the type and description for the system.disk.in_use metric which is a gauge in percent that tracks System disk usage statistics, percentage.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, percent\nDescription: System disk usage statistics, percentage.\n```\n\n----------------------------------------\n\nTITLE: Mermaid Diagram - Multiple AKS clusters\nDESCRIPTION: Mermaid diagram showing the flow of traffic from users to NGINXaaS and then to separate Kubernetes clusters based on the requested service (tea or coffee).  Each AKS cluster has its own NLK controller updating NGINXaaS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/loadbalancer-kubernetes.md#_snippet_9\n\nLANGUAGE: mermaid\nCODE:\n```\nflowchart TB\n\n   TeaUsers[웃 Users] -.-> |GET /tea | NGINXaaS{NGINXaaS}\n   CoffeeUsers[웃 Users] -.-> |GET /coffee | NGINXaaS\n   NGINXaaS -.-> |GET /tea| E\n   H --> |Update upstream 'tea'| NGINXaaS\n   NGINXaaS -.-> |GET /coffee| K\n   M --> |Update upstream 'coffee'| NGINXaaS\n\n   subgraph SG2[Azure Kubernetes Cluster 2]\n      k8sapi2[K8s API] --> |watch| M(NLK controller)\n      I{Coffee svc} -.-> J(Pod)\n      I -.-> K(Pod)\n   end\n\n   subgraph SG1[Azure Kubernetes Cluster 1]\n      k8sapi1[K8s API] --> |watch| H(NLK controller)\n      D{Tea svc} -.-> E(Pod)\n      D -.-> F(Pod)\n   end\n\n\n   style TeaUsers color:red,stroke:red,fill:#faefd9\n   linkStyle 0,2 color:red,stroke:red\n   style CoffeeUsers color:orange,stroke:orange,fill:#faefd9\n   linkStyle 1,4 color:orange,stroke:orange\n   style NGINXaaS color:green,stroke:green,stroke-width:4px,fill:#d9fade\n   linkStyle 3,5 color:green,stroke:green\n   style SG1 fill:#9bb1de,color:#\n   style SG2 fill:#9bb1de,color:#\n   style k8sapi1 color:#3075ff,stroke:#3075ff,stroke-width:4px\n   style k8sapi2 color:#3075ff,stroke:#3075ff,stroke-width:4px\n   linkStyle 6,9 color:#3075ff,stroke:#3075ff\n   style H color:green,stroke:green,stroke-width:4px,fill:#d9fade\n   style M color:green,stroke:green,stroke-width:4px,fill:#d9fade\n\n   accDescr:A diagram showing NGINXaaS directing separate user GET requests for `/tea` and `/coffee` to respective Kubernetes-based services \"TeaSvc\" and \"CoffeeSvc\" that are running in separate Azure Kubernetes Clusters. An NLK controller in each cluster is independently updating the NGINXaaS with dynamic upstream configuration.\n```\n\n----------------------------------------\n\nTITLE: Persist NFS Mounts in /etc/fstab\nDESCRIPTION: This snippet adds lines to `/etc/fstab` to ensure that the NFS mounts persist after a reboot. The NFS server IP needs to be correctly set. The `defaults` mount option is used.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\n<NFS_SERVER_IP>:/mnt/nfs_share/clickhouse /var/lib/clickhouse nfs defaults 0 0\n<NFS_SERVER_IP>:/mnt/nfs_share/nms /var/lib/nms nfs defaults 0 0\n```\n\n----------------------------------------\n\nTITLE: Deploying NGINX Service Mesh with Private Registry (CLI)\nDESCRIPTION: This command shows how to deploy NGINX Service Mesh using a private registry, specifying the registry server, and disabling public images. It ensures that all images are pulled from the configured private registry. The registry server parameter specifies the hostname and optionally the port of the registry.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/private-registry.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl deploy --registry-server your-registry --disable-public-images ...\n```\n\n----------------------------------------\n\nTITLE: Update Repository Information - Shell\nDESCRIPTION: This command updates the repository information using the `dnf` package manager. It's necessary after modifying the repository configuration file to ensure that the system is aware of the changes and can install the correct version of NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/pin-to-version/pin-rhel8-R32.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update\n```\n\n----------------------------------------\n\nTITLE: Checking Kubernetes API Access (kubectl) - Shell\nDESCRIPTION: This command uses `kubectl` to check if the root user has access to the Kubernetes API. It retrieves the list of pods in the `nms` namespace.  It requires `kubectl` and access to a Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nsudo kubectl -n nms get pods\n```\n\n----------------------------------------\n\nTITLE: Reloading NGINX configuration\nDESCRIPTION: This shell command reloads the Nginx configuration, applying any changes made to the configuration file without restarting the server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/fips.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: App Protect Resource Reverted Log Event JSON\nDESCRIPTION: This JSON object indicates that a resource has returned to its normal range. The 'resource' attribute specifies the resource that reverted. The log level is Warning.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/operation-logs.md#_snippet_4\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"event\": \"waf_resource_revert\",\n    \"bd_thread_id\": 3,\n    \"worker_pid\": 4928,\n    \"mode\": \"operational\",\n    \"mode_changed\": true,\n    \"resource\": \"cpu\",\n    \"value\": 88,\n    \"threshold\": 90\n}\n```\n\n----------------------------------------\n\nTITLE: Configure ClickHouse connection details in nms.conf (YAML)\nDESCRIPTION: This snippet shows how to configure ClickHouse address, username, and password within the `/etc/nms/nms.conf` file. Replace `<INSERT USERNAME HERE>` and `<INSERT PASSWORD HERE>` with your actual ClickHouse credentials. This configuration is required for NGINX Instance Manager to connect to ClickHouse using custom credentials.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-clickhouse.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nclickhouse:\n  address: tcp://localhost:9000\n  username: <INSERT USERNAME HERE>\n  password: <INSERT PASSWORD HERE>\n```\n\n----------------------------------------\n\nTITLE: Description of system.io.kbs_r and system.io.kbs_w metrics\nDESCRIPTION: Provides the type and description for the system.io.kbs_r and system.io.kbs_w metrics which is a counter in kilobytes representing Number of kilobytes read or written.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, kilobytes\nDescription: Number of kilobytes read or written.\n```\n\n----------------------------------------\n\nTITLE: Move and rename certificate and key files\nDESCRIPTION: Moves the downloaded NGINX Instance Manager certificate (.crt) and key (.key) files to the /etc/ssl/nginx/ directory and renames them to nginx-repo.crt and nginx-repo.key, respectively. These files are used for secure repository access when installing NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo mv <nginx-mgmt-suite-trial.crt> /etc/ssl/nginx/nginx-repo.crt\nsudo mv <nginx-mgmt-suite-trial.key> /etc/ssl/nginx/nginx-repo.key\n```\n\n----------------------------------------\n\nTITLE: Installing Lua module on Alpine\nDESCRIPTION: This command installs the `nginx-plus-module-lua` package using `apk`. This assumes that the nginx-plus repository is configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/lua.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-lua\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Dry-Run Warning Message\nDESCRIPTION: This snippet shows a warning message displayed during NGINX Controller installation on RHEL 8 while checking Kubernetes. This message can be safely ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.5.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nW0304 00:13:38.871876 1594252 helpers.go:553] --dry-run is deprecated and can be replaced with --dry-run=client.\n```\n\n----------------------------------------\n\nTITLE: Collect Logs (Docker Compose)\nDESCRIPTION: This command collects logs from all services defined in the docker-compose.yaml file for the past 24 hours and saves them to a file named `my-logs-<date>.txt`. This is helpful for debugging issues.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\ndocker-compose logs --since 24h > my-logs-$(date +%Y-%m-%d).txt\n```\n\n----------------------------------------\n\nTITLE: Override Health Check Port\nDESCRIPTION: Overrides the default port used for health checks with the `port` parameter of the `health_check` directive. This is helpful when monitoring multiple services on the same host.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    server {\n        listen               12345;\n        proxy_pass           stream_backend;\n        health_check         port=12346;\n        health_check_timeout 5s;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Creating Prometheus Metrics Location in NGINX\nDESCRIPTION: This configures a location block for serving Prometheus metrics.  The js_content directive calls the prometheus.metrics function from the imported prometheus.js file when this location is accessed, generating the Prometheus metrics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nlocation = /metrics {\n    js_content prometheus.metrics;\n}\n```\n\n----------------------------------------\n\nTITLE: Generate a random data plane API key\nDESCRIPTION: This snippet generates a random UUIDv4 string and assigns it to the `keyValue` variable. This key will be used as the data plane API key for the NGINXaaS deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/loadbalancer-kubernetes.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n# Generate a new random key or specify a value for it.\nkeyName=myKey\nkeyValue=$(uuidgen --random)\n```\n\n----------------------------------------\n\nTITLE: Stopping NGINX Service - Bash\nDESCRIPTION: This command stops the NGINX service on a Linux system using `systemctl`.  It is part of a workaround for a TCP/UDP traffic misreporting issue after upgrading NGINX Controller.  The command requires root or sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsystemctl stop nginx\n```\n\n----------------------------------------\n\nTITLE: Invalid Service Configuration Example\nDESCRIPTION: This example demonstrates an invalid Kubernetes Service configuration where multiple ports have the same `targetPort` value. NGINX Service Mesh disregards duplicate `targetPort` configurations, honoring only one for traffic forwarding, authentication, and encryption.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.0.0.md#_snippet_0\n\nLANGUAGE: plaintext\nCODE:\n```\napiVersion: v1\nkind: Service\nspec:\n  ports:\n  - port: 8080\n    protocol: TCP\n    targetPort: 55555\n  - port: 9090\n    protocol: TCP\n    targetPort: 55555\n```\n\n----------------------------------------\n\nTITLE: Inject Command Error Message Example\nDESCRIPTION: Example error message produced by the inject command with nginx-meshctl, which may indicate invalid YAML, control plane downtime, installation issues or unexpected namespace.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.4.0.md#_snippet_1\n\nLANGUAGE: plaintext\nCODE:\n```\n./build/nginx-meshctl inject < example.yaml\nCannot inject NGINX Service Mesh sidecar.\nError: error formatting response string: invalid syntax\n```\n\n----------------------------------------\n\nTITLE: Clone Nginx Gateway Fabric repository\nDESCRIPTION: This command clones the Nginx Gateway Fabric repository from Github and changes the current directory to the newly cloned directory. It requires Git to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/building-the-images.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ngit clone https://github.com/nginx/nginx-gateway-fabric.git --branch v{{< version-ngf >}}\ncd nginx-gateway-fabric\n```\n\n----------------------------------------\n\nTITLE: Making nginx-meshctl executable on Linux\nDESCRIPTION: This command sets the execute permission on the nginx-meshctl binary, allowing it to be run as a program. This is required for the system to recognize and execute the command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo chmod +x /usr/local/bin/nginx-meshctl\n```\n\n----------------------------------------\n\nTITLE: Testing nginx-meshctl installation on Linux\nDESCRIPTION: This command runs the nginx-meshctl command without any arguments, verifying that it is correctly installed and accessible from the terminal. It expects the command to output help information or an error message indicating missing arguments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl\n```\n\n----------------------------------------\n\nTITLE: Download JWT license from MyF5\nDESCRIPTION: This includes a placeholder for instructions on how to download the JWT license from the MyF5 portal.  The details of this process are presumably contained within the included markdown file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_1\n\nLANGUAGE: text\nCODE:\n```\n{{< include \"licensing-and-reporting/download-jwt-from-myf5.md\" >}}\n```\n\n----------------------------------------\n\nTITLE: Enable NGINX Service at Boot (systemctl)\nDESCRIPTION: This command enables the NGINX service to automatically start when the system boots. It utilizes the `systemctl` command, which is part of the systemd init system. The command requires sudo privileges to modify system service configurations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/enable-nginx-service-at-boot.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl enable nginx.service\n```\n\n----------------------------------------\n\nTITLE: Check if nginx-agent-selinux is installed (CentOS, RHEL, RPM)\nDESCRIPTION: This command checks if the `nginx-agent-selinux` package is installed on RPM-based systems. It uses `rpm -qa` to list all installed packages and pipes the output to `grep nginx_agent_selinux` to filter for the `nginx-agent-selinux` package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nrpm -qa | grep nginx_agent_selinux\n```\n\n----------------------------------------\n\nTITLE: Example HTTP Redirect Response for soda with pepsi(Text)\nDESCRIPTION: This is an example HTTP response demonstrating a 302 redirect for `http://cafe.example.com/soda/pepsi` to `http://cafe.example.com:8080/flavors`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_16\n\nLANGUAGE: text\nCODE:\n```\nHTTP/1.1 302 Moved Temporarily\n..\nLocation: http://cafe.example.com:8080/flavors\n```\n\n----------------------------------------\n\nTITLE: Verify nginx-agent Directory Ownership\nDESCRIPTION: This command uses `ls -l` to check the ownership of the `/var/run/nginx-agent` directory. It helps confirm that the `nginx-agent` group has the correct permissions for the directory, which is crucial for the NGINX Agent to function correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configure-nginx-agent-group.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nls -l /var/run/nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Shared Memory Connected Log Event JSON\nDESCRIPTION: This JSON snippet represents a shared memory connected event in NGINX App Protect DoS.  It indicates that a worker process successfully connected to shared memory. The event includes the worker PID, the current mode (operational), and a flag indicating whether the mode has changed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/operation-log.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"event\": \"shared_memory_connected\",\n    \"worker_pid\": 4928,\n    \"mode\": \"operational\",\n    \"mode_changed\": true\n}\n```\n\n----------------------------------------\n\nTITLE: Get NGINX Gateway Service Details (GCP/Azure)\nDESCRIPTION: This command retrieves information about the `nginx-gateway` service in the `nginx-gateway` namespace. This is primarily used to find the external IP address assigned to the LoadBalancer on GCP or Azure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/expose-nginx-gateway-fabric.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get svc nginx-gateway -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Nginx Agent configuration\nDESCRIPTION: This is the configuration file for Nginx Agent.  It contains the data plane key, host, and port information. The `token` field should be replaced with the actual data plane key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/getting-started.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\nserver:\n  token: \"<YOUR_DATA_PLANE_KEY>\"\n  host: agent.connect.nginx.com\n  grpcPort: 443\n\ntls:\n  enable: True\n  skip_verify: False\n```\n\n----------------------------------------\n\nTITLE: Stop NGINX Instance Manager (Docker Compose)\nDESCRIPTION: Stops the NGINX Instance Manager services defined in the docker-compose.yaml file.  It halts the running containers without removing them.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ndocker compose stop\n```\n\n----------------------------------------\n\nTITLE: Query Metric with Defined Time Window\nDESCRIPTION: This cURL command queries the Metrics API for `http.request.count` with a fully defined time window. The `startTime` is set to five hours ago (`now-5h`), and the `endTime` is set to July 1, 2020, at 09:00:00 UTC. The API returns metrics recorded between these two timestamps.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/metrics/metrics-api.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\ncurl -X GET --cookie \"session=<session cookie>\" --url \"{controller-IP}/api/v1/analytics/metrics?names=http.request.count&startTime=now-5h&endTime=2020-07-01T09:00:00Z\"\n```\n\n----------------------------------------\n\nTITLE: Describe Coffee HTTPRoute - Kubernetes Shell\nDESCRIPTION: This snippet uses kubectl to describe the 'coffee' HTTPRoute resource. This command is used to verify that the HTTPRoute has been configured correctly, particularly to check the conditions related to the resource acceptance and reference resolution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe httproutes.gateway.networking.k8s.io coffee\n```\n\n----------------------------------------\n\nTITLE: Disabling mTLS for a specific resource in Kubernetes\nDESCRIPTION: This YAML snippet illustrates how to disable mTLS for a specific resource in Kubernetes by adding an annotation to the resource's PodTemplateSpec. The annotation `config.nsm.nginx.com/mtls-mode` is set to `off` to disable mTLS for that resource.  This is beneficial when certain services are not yet ready for mTLS or need to communicate with non-meshed services.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/secure-traffic-mtls.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\nconfig.nsm.nginx.com/mtls-mode: \"off\"\n```\n\n----------------------------------------\n\nTITLE: IPv6 VRRP Instance Configuration (None)\nDESCRIPTION: This configuration shows how to create a separate VRRP instance for IPv6 addresses. This is necessary when using Keepalived versions that do not support mixing IPv4 and IPv6 addresses in a single VRRP instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_15\n\nLANGUAGE: none\nCODE:\n```\nvrrp_instance VI_2 {\n    interface         eth0\n    priority          101\n    virtual_router_id 51\n    advert_int        1\n    accept\n    unicast_src_ip    1234:5678:9abc:def::3\n\n    unicast_peer {\n        1234:5678:9abc:def::2\n    }\n\n    virtual_ipaddress {\n        1234:5678:9abc:def::1\n    }\n\n    track_script {\n        chk_nginx_service\n        chk_manual_failover\n    }\n\n    notify \"/usr/libexec/keepalived/nginx-ha-notify\"\n}\n```\n\n----------------------------------------\n\nTITLE: Start NGINX Agent on Alpine Linux\nDESCRIPTION: Starts the NGINX Agent service on Alpine Linux. Uses either the `rc-service` command or the `/etc/init.d/nginx-agent` script. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-unprivileged.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo rc-service nginx-agent start\n```\n\nLANGUAGE: bash\nCODE:\n```\nsudo /etc/init.d/nginx-agent start\n```\n\n----------------------------------------\n\nTITLE: Create Mount Point (Bash)\nDESCRIPTION: This command creates a directory called `/mnt/local_pgdata` which will be used as the mount point for the NFS share. The `-p` flag ensures that parent directories are created if they don't already exist.  `sudo` is used to ensure proper permissions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-embedded-config-db.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo mkdir -p /mnt/local_pgdata\n```\n\n----------------------------------------\n\nTITLE: Retrieve API Gateway Service Information using kubectl\nDESCRIPTION: This command retrieves information about the 'apigw' service within the 'nms' namespace. It is used to find the external IP address of the API Gateway, which is needed to access the NGINX Instance Manager web interface. The output includes details such as the service type, cluster IP, and exposed ports.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/kubernetes/access-webui-helm.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubectl -n nms get svc apigw\n```\n\n----------------------------------------\n\nTITLE: Migrate Secrets to Local Storage\nDESCRIPTION: This command uses `nms-core` to migrate secrets from Vault to local storage. It's executed before switching the secrets driver to 'local'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-vault.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo nms-core secret migrate-secrets-to-local\n```\n\n----------------------------------------\n\nTITLE: Extracting the support package\nDESCRIPTION: This command shows how to extract the generated support package (a tar.gz archive) using the `tar` command. This allows you to access the individual files and directories containing the collected information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/support/support-package.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ntar -xvf support-pkg-<timestamp>.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Verifying Kubernetes Deployments\nDESCRIPTION: These commands are used to verify the status of Kubernetes deployments, pods, and services. `kubectl get deployments` shows the status of the deployments, `kubectl get pods` shows the status of the pods, and `kubectl get services` shows the status of the services.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_26\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get deployments\n```\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get pods\n```\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get services\n```\n\n----------------------------------------\n\nTITLE: Updating Proxy Configuration with PUT Request (bash)\nDESCRIPTION: This snippet shows how to update the proxy configuration using a PUT request to the API Connectivity Manager.  It requires the API endpoint to be available and assumes the user has the necessary permissions. The request updates the introspection policy to include claim verification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_51\n\nLANGUAGE: bash\nCODE:\n```\nPUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy\n```\n\n----------------------------------------\n\nTITLE: NGINX Bind Error Message\nDESCRIPTION: This text shows an example of an error log entry indicating that NGINX is unable to bind to a specified port (80 in this case). This usually happens if another process is already using that port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/troubleshooting.md#_snippet_7\n\nLANGUAGE: text\nCODE:\n```\n022/05/12 16:11:23 [emerg] 69688#69688: still could not bind()\n22022/05/12 16:18:34 [emerg] 70092#70092: bind() to 0.0.0.0:80 failed (98: Address already in use)\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Perl Module (Amazon Linux 2, CentOS, Oracle Linux, RHEL)\nDESCRIPTION: This shell script updates the package manager and installs the `nginx-plus-module-perl` package on Amazon Linux 2, CentOS, Oracle Linux, and RHEL systems. It uses the `yum` package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/perl.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-perl\n```\n\n----------------------------------------\n\nTITLE: Description of system.swap.pct_free metric\nDESCRIPTION: Provides the type and description for the system.swap.pct_free metric which is a gauge in percent representing System swap memory statistics, percentage.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_14\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, percent\nDescription: System swap memory statistics, percentage.\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration Test Failure Error\nDESCRIPTION: This snippet shows an error message when creating a BIG-IP Component, indicating a failure in testing the NGINX configuration due to a bind error. It points to an issue with assigning the requested address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.5.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\nFailed testing config before applying: nginx:\nthe configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: [emerg] bind() to <IP>:20001 failed (99: Cannot assign requested address)\nnginx: configuration file /etc/nginx/nginx.conf test failed\n```\n\n----------------------------------------\n\nTITLE: Login Page Policy Configuration in JSON\nDESCRIPTION: This JSON snippet defines a login page policy for NGINX App Protect WAF. It specifies the login URL, username and password parameters, and validation criteria for successful login attempts.  It uses the `responseContains` field to check for 'Success' in the HTTP response.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/configuration-guide/configuration.md#_snippet_18\n\nLANGUAGE: json\nCODE:\n```\n{\n\t    \"login-pages\": [\n            {\n               \"accessValidation\" : {\n                  \"responseContains\": \"Success\"\n               },\n               \"authenticationType\": \"form\",\n               \"url\" : {\n                  \"method\" : \"*\",\n                  \"name\" : \"/html_login\",\n                  \"protocol\" : \"http\",\n                  \"type\" : \"explicit\"\n               },\n               \"usernameParameterName\": \"username\",\n               \"passwordParameterName\": \"password\"\n            }\n        ]\n\t}\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisites on Amazon Linux 2\nDESCRIPTION: This command installs the necessary prerequisites for installing NGINX Agent on Amazon Linux 2. It installs yum-utils and procps using the yum package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_32\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install yum-utils procps\n```\n\n----------------------------------------\n\nTITLE: Example HTTP Redirect Response with Query Parameters for tea with type (Text)\nDESCRIPTION: Example HTTP response for `http://cafe.example.com/tea/type?test=v1`, showing a 302 Moved Temporarily response with the new location and preserved query parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_12\n\nLANGUAGE: text\nCODE:\n```\nHTTP/1.1 302 Moved Temporarily\n..\nLocation: http://cafe.example.com:8080/organic/type?test=v1\n```\n\n----------------------------------------\n\nTITLE: Download initial usage report - NGINX Instance Manager REST API (curl)\nDESCRIPTION: This `curl` command downloads the initial usage report from NGINX Instance Manager as a zip file.  It requires authorization using base64-encoded credentials. The `-k` flag skips SSL verification, and <NIM-FQDN> and <base64-encoded-credentials> are placeholders for the actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/add-license-disconnected-deployment.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\ncurl -k --location 'https://<NIM-FQDN>/api/platform/v1/report/download?format=zip&reportType=initial' \\\n--header 'accept: */*' \\\n--header 'Authorization: Basic <base64-encoded-credentials>' \\\n--output report.zip\n```\n\n----------------------------------------\n\nTITLE: Check Nginx Controller Agent Version (RHEL/CentOS)\nDESCRIPTION: This command retrieves and displays the installed version of the NGINX Controller Agent on Red Hat Enterprise Linux (RHEL) or CentOS systems.  It uses the `yum` package manager to list installed packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_24\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum list installed nginx-controller-agent\n```\n\n----------------------------------------\n\nTITLE: Changing Directory in Shell\nDESCRIPTION: Changes the current working directory to the NGINX configuration directory. This is a prerequisite for subsequent configuration steps involving file creation and modification.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/setting-up-nginx-demo-environment.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ncd /etc/nginx/conf.d\n```\n\n----------------------------------------\n\nTITLE: Disable App Protect for DoS API Location in Nginx\nDESCRIPTION: This configuration snippet disables the standard app protect for the specified location and enables the DoS API. This is important when using NGINX App Protect WAF alongside App Protect DoS to avoid conflicts in monitoring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-3.0.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /api {\n    app_protect_enable off;\n    app_protect_dos_api;\n}\n```\n\n----------------------------------------\n\nTITLE: JSON Schema for OIDC Input Validation\nDESCRIPTION: This JSON schema validates user inputs for the main.tmpl template, ensuring that the oidc object's enabled property is correctly defined. It enforces the structure for dynamic web forms, specifying that templateInput is required and oidc.enabled must be a boolean value. The schema provides metadata and examples for the oidc.enabled property.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/concepts/template-resources.md#_snippet_1\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"type\": \"object\",\n  \"title\": \"Main inputs\",\n  \"properties\": {\n\t\"templateInput\": {\n\t  \"type\": [\n\t\t\"object\",\n\t\t\"null\"\n\t  ],\n\t  \"properties\": {\n\t\t\"oidc\": {\n\t\t  \"type\": \"object\",\n\t\t  \"title\": \"OIDC Setting\",\n\t\t  \"description\": \"Adds OIDC settings to main, http, http-server and location blocks. Use OIDC to enable single sign-on (SSO) to authenticate to your app.\",\n\t\t  \"__docs\": [\n\t\t\t{\n\t\t\t  \"title\": \"OIDC specification\",\n\t\t\t  \"link\": \"https://openid.net/specs/openid-connect-core-1_0.html\"\n\t\t\t}\n\t\t  ],\n\t\t  \"properties\": {\n\t\t\t\"enabled\": {\n\t\t\t  \"title\": \"OIDC authentication enabled\",\n\t\t\t  \"type\": \"boolean\",\n\t\t\t  \"description\": \"Set this value to be true, if location(s) can be accessed only after authentication by the OIDC provider configured at the gateway. If no authentication is needed set this value to be false.\",\n\t\t\t  \"examples\": [\n\t\t\t\ttrue\n\t\t\t  ]\n\t\t\t}\n\t\t  },\n\t\t  \"required\": [\n\t\t\t\"enabled\"\n\t\t  ]\n\t\t}\n\t  }\n      }\n  },\n  \"required\": []\n}\n\n```\n\n----------------------------------------\n\nTITLE: Installing Lua module on Amazon Linux 2, CentOS, Oracle Linux, RHEL\nDESCRIPTION: These commands update the system and install the `nginx-plus-module-lua` package using `yum`. This assumes that the nginx-plus repository is configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/lua.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-lua\n```\n\n----------------------------------------\n\nTITLE: Shell Command Example\nDESCRIPTION: This code snippet shows an example of how to display shell commands in the documentation. Two code blocks are used, one for the command itself and the other to show the expected output. Ellipses are used to truncate the output if necessary.\nSOURCE: https://github.com/nginx/documentation/blob/main/archetypes/tutorial.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\n# We typically show examples of commands or code in one code block, which can be easily copied by a reader using a button connected to the block.\n```\n\n----------------------------------------\n\nTITLE: Loading Encrypted Session Nginx Module\nDESCRIPTION: This Nginx configuration snippet shows how to load the NDK and encrypted session modules within the main context of the `nginx.conf` file.  This enables the module for use in the http context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/encrypted-session.md#_snippet_6\n\nLANGUAGE: Nginx\nCODE:\n```\nload_module modules/ndk_http_module.so;\nload_module modules/ngx_http_encrypted_session_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Example kubectl Pod Status Output\nDESCRIPTION: This output from `kubectl get pods` shows the status of various pods in the `nginx-mesh` namespace. Key information includes the pod's name, ready status, current status (e.g., Running, Init:ImagePullBackOff, ErrImagePull), number of restarts, and age. The 'STATUS' column is crucial for identifying pods with issues like failing to pull images.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.1.0.md#_snippet_6\n\nLANGUAGE: plaintext\nCODE:\n```\nNAME                                  READY   STATUS                  RESTARTS   AGE\ngrafana-5647fdf464-hx9s4              1/1     Running                 0          64s\njaeger-6fcf7cd97b-cgrt9               1/1     Running                 0          64s\nnats-server-6bc4f9bbc8-jxzct          0/2     Init:ImagePullBackOff   0          2m9s\nnginx-mesh-api-84898cbc67-tdwdw       0/1     ImagePullBackOff        0          68s\nnginx-mesh-metrics-55fd89954c-mbb25   0/1     ErrImagePull            0          66s\nprometheus-8d5fb5879-fgdbh            1/1     Running                 0          65s\nspire-agent-47t2w                     1/1     Running                 1          2m49s\nspire-agent-8pnch                     1/1     Running                 1          2m49s\nspire-agent-qtntx                     1/1     Running                 0          2m49s\nspire-server-0                        2/2     Running                 0          2m50s\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX Agent on Amazon Linux 2023\nDESCRIPTION: This command removes the NGINX Agent package using the dnf package manager, common on Amazon Linux 2023.  It requires root privileges to execute. This removes the installed nginx-agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/uninstall.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo dnf remove nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Policy Converter Usage\nDESCRIPTION: This snippet demonstrates the basic usage of the `convert-policy` tool without any arguments, which will trigger the help message.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/convert-policy\n```\n\n----------------------------------------\n\nTITLE: Create a Kubernetes namespace (Bash)\nDESCRIPTION: This command creates a new Kubernetes namespace named `legacy`.  This namespace will house the `target` application, which will reside outside the NGINX Service Mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl create namespace legacy\n```\n\n----------------------------------------\n\nTITLE: Configuring Passive UDP Health Checks - NGINX\nDESCRIPTION: Configures passive health checks by setting the `fail_timeout` parameter for upstream servers. In this configuration, if a server fails to respond within 60 seconds, it is marked as unavailable for 60 seconds. This method uses connection attempt failures to monitor server health.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nupstream dns_upstream {\n    server 192.168.136.130:53 fail_timeout=60s;\n    server 192.168.136.131:53 fail_timeout=60s;\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Plus Usage Data JSON Example\nDESCRIPTION: This JSON snippet illustrates the format of the usage data that NGINX Plus sends to F5. It includes metrics related to HTTP and Stream traffic, as well as general information about the NGINX instance, such as its version, UUID, uptime, number of worker processes, and reload count. The data is sent as a `POST` request every hour by default.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/licensing-and-reporting/reported-usage-data.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"version\": \"<nginx_version>\",\n    \"uuid\": \"<nginx_uuid>\",\n    \"nap\": \"<active/inactive>\", // status of NGINX App Protect\n    \"http\": {\n        \"client\": {\n            \"received\": 0, // bytes received\n            \"sent\": 0, // bytes sent\n            \"requests\": 0 // number of HTTP requests processed\n        },\n        \"upstream\": {\n            \"received\": 0, // bytes received\n            \"sent\": 0 // bytes sent\n        }\n    },\n    \"stream\": {\n        \"client\": {\n            \"received\": 0, // bytes received\n            \"sent\": 0 // bytes sent\n        },\n        \"upstream\": {\n            \"received\": 0, // bytes received\n            \"sent\": 0 // bytes sent\n        }\n    },\n    \"workers\": 0, // number of worker processes running\n    \"uptime\": 0, // number of seconds the instance has been running\n    \"reloads\": 0, // number of times the instance has been reloaded\n    \"start_time\": \"epoch\", // start time of data collection for the report\n    \"end_time\": \"epoch\" // end time of data collection for the report\n}\n```\n\n----------------------------------------\n\nTITLE: Modify TCP Ports in NGINX Instance Manager SELinux Context\nDESCRIPTION: Modifies existing TCP ports in the `nms_port_t` SELinux context, ensuring that they are correctly labeled for NGINX Instance Manager. This is useful when the port is already defined with a different label. Requires `semanage` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-selinux.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo semanage port -m -t nms_port_t -p tcp 10000\nsudo semanage port -m -t nms_port_t -p tcp 11000\n```\n\n----------------------------------------\n\nTITLE: Including HTTP Configuration Files with Wildcard (Nginx)\nDESCRIPTION: This configuration snippet includes all configuration files ending with `-http.conf` from the `conf.d` directory within the `http` context.  This provides a flexible way to manage multiple HTTP configurations by organizing them into separate files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_9\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    include conf.d/*-http.conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Timeout error during NGINX Controller cluster upgrade\nDESCRIPTION: This snippet represents a timeout error message that may appear during an NGINX Controller cluster upgrade when waiting for services to scale up.  The error indicates that a service (e.g., nats-streaming-cluster) did not scale up within the expected time, but it is generally safe to ignore as the services will continue scaling up in the background.  It is shown as an example of a warning that can be ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.1.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\nWhile waiting for nats-streaming-cluster to scale up, the operation did not complete before timing out.\n```\n\n----------------------------------------\n\nTITLE: Successful tea application response (HTTPRoute)\nDESCRIPTION: This snippet represents a successful response from the tea application after sending a POST request that is within the HTTPRoute-specific client_max_body_size limit.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_19\n\nLANGUAGE: text\nCODE:\n```\nServer address: 10.244.0.7:8080\nServer name: tea-596697966f-bf6tw\n```\n\n----------------------------------------\n\nTITLE: Update Proxy to Disable Token Cache - JSON\nDESCRIPTION: This JSON payload defines the proxy configuration with an Introspection policy. It sets the `cacheIntrospectionResponse` value to \"0s\", disabling token caching.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_41\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"name\": \"test-proxy\",\n   \"version\": \"v1\",\n   \"proxyConfig\": {\n      \"hostname\": \"data-host\",\n      \"ingress\": {\n         \"basePath\": \"/\",\n         \"basePathVersionAppendRule\": \"NONE\"\n      },\n      \"backends\": [\n         {\n            \"serviceName\": \"backend-echo-svc\",\n            \"serviceTargets\": [\n               {\n                  \"hostname\": \"192.0.2.4\",\n                  \"listener\": {\n                     \"enableTLS\": false,\n                     \"port\": 10000,\n                     \"transportProtocol\": \"HTTP\"\n                  }\n               }\n            ]\n         }\n      ],\n      \"policies\": {\n         \"oauth2-introspection\": [\n            {\n               \"action\": {\n                  \"introspectionEndpoint\": \"http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect\",\n                        \"cacheIntrospectionResponse\": \"0s\"\n\n               },\n               \"data\": [\n                  {\n                     \"clientAppID\": \"nginx-plus\",\n                     \"clientSecret\": \"<client secret>\"\n                  }\n               ]\n            }\n         ]\n      }\n   }\n}\n```\n\n----------------------------------------\n\nTITLE: Start Nginx Open Source\nDESCRIPTION: This command starts the Nginx Open Source service, making it accessible for handling web requests. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx\n```\n\n----------------------------------------\n\nTITLE: Enabling ModSecurity Debug Logging\nDESCRIPTION: These lines enable debug logging for ModSecurity, writing debug information to `/tmp/modsec_debug.log` at the highest debug level (9). This should only be used for troubleshooting purposes in non-production environments due to its performance impact.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_22\n\nLANGUAGE: nginx\nCODE:\n```\nSecDebugLog /tmp/modsec_debug.log\n```\n\nLANGUAGE: nginx\nCODE:\n```\nSecDebugLogLevel 9\n```\n\n----------------------------------------\n\nTITLE: Active Directory Group Search Filter (All Groups)\nDESCRIPTION: This code snippet demonstrates a group search filter used to return all groups under the base domain in Active Directory. This filter is used to retrieve the list of available groups when setting up the Active Directory authentication provider within NGINX Controller. It's enclosed in parentheses.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_5\n\nLANGUAGE: none\nCODE:\n```\n(objectClass=group)\n```\n\n----------------------------------------\n\nTITLE: Change Metrics Port - Update Prometheus Annotation\nDESCRIPTION: This YAML snippet shows how to update the Prometheus port annotation in the Pod template to match the new metrics port. `<new-port>` should be replaced with the desired port number.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/prometheus.md#_snippet_8\n\nLANGUAGE: yaml\nCODE:\n```\nannotations:\n    <...>\n    prometheus.io/port: \"<new-port>\"\n    <...>\n```\n\n----------------------------------------\n\nTITLE: Define Pod Security Policy for RKE with Nginx Mesh\nDESCRIPTION: Defines a Pod Security Policy (PSP) tailored for RKE to allow Nginx Service Mesh control plane to work correctly. This policy is based on the default `restricted-psp` but adds exceptions to allow necessary functionalities. It configures allowed capabilities, fsGroup, and runAsUser.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/rke.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: policy/v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  annotations:\n    serviceaccount.cluster.cattle.io/pod-security: restricted\n    serviceaccount.cluster.cattle.io/pod-security-version: \"1696\"\n  labels:\n    cattle.io/creator: norman\n  name: restricted-psp-nginx-mesh\nspec:\n  allowPrivilegeEscalation: false\n  fsGroup:\n    ranges:\n    - max: 65535\n      min: 1\n    rule: MustRunAs\n  requiredDropCapabilities:\n  - ALL\n  runAsUser:\n    rule: RunAsAny\n  seLinux:\n    rule: RunAsAny\n  supplementalGroups:\n    ranges:\n    - max: 65535\n      min: 1\n    rule: MustRunAs\n  hostNetwork: true\n  hostPID: true\n  volumes:\n  - configMap\n  - emptyDir\n  - projected\n  - secret\n  - downwardAPI\n  - persistentVolumeClaim\n  - hostPath\n```\n\n----------------------------------------\n\nTITLE: Terraform Certificate Dependency Configuration\nDESCRIPTION: This Terraform configuration demonstrates how to add dependencies between Nginx certificate resources to avoid deployment conflicts when attaching multiple certificates. It uses the `depends_on` meta-argument to ensure that `cert2` is created after `cert1`.  This prevents concurrent updates to the deployment resource. Requires the `azurerm` provider.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/known-issues.md#_snippet_3\n\nLANGUAGE: hcl\nCODE:\n```\nresource \"azurerm_nginx_certificate\" \"cert1\" {\n  name                     = \"examplecert\"\n  nginx_deployment_id      = azurerm_nginx_deployment.test.id\n  key_virtual_path         = \"/src/cert/soservermekey.key\"\n  certificate_virtual_path = \"/src/cert/server.cert\"\n  key_vault_secret_id      = azurerm_key_vault_certificate.test.secret_id\n}\n\nresource \"azurerm_nginx_certificate\" \"cert2\" {\n  name                     = \"examplecert\"\n  nginx_deployment_id      = azurerm_nginx_deployment.test.id\n  key_virtual_path         = \"/src/cert/soservermekey.key\"\n  certificate_virtual_path = \"/src/cert/server.cert\"\n  key_vault_secret_id      = azurerm_key_vault_certificate.test.secret_id\n\n  depends_on               = [azurerm_nginx_certificate.cert1]\n}\n```\n\n----------------------------------------\n\nTITLE: Grepping NMS Core Logs (Bash)\nDESCRIPTION: Filters the `nms.log` file to display only entries related to the `nms-core` process using `grep`. This is one example to demonstrate how to filter specific nms processes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/support/support-package.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ncat nms.log | grep 'COR'\n```\n\n----------------------------------------\n\nTITLE: Starting NGINX Management Suite Services (systemctl) - Shell\nDESCRIPTION: This command starts the NGINX Management Suite (nms) services using `systemctl`, a systemd utility for controlling the systemd system and service manager. It ensures that the NGINX Management Suite services are running before performing backup or restore operations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl start nms\n```\n\n----------------------------------------\n\nTITLE: Reload Nginx Configuration (ModSecurity)\nDESCRIPTION: This command reloads the Nginx configuration after the ModSecurity settings have been added to the proxy configuration (proxy.conf).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_17\n\nLANGUAGE: none\nCODE:\n```\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Successful NGINX Configuration Test Output\nDESCRIPTION: These shell commands are the expected output from `nginx -t` command if the Nginx configuration is valid.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/http-substitutions-filter.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Enabling NGINX Mainline Repository on Amazon Linux\nDESCRIPTION: This command uses the yum-config-manager utility to enable the nginx-mainline repository, allowing access to the latest mainline NGINX packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_46\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum-config-manager --enable nginx-mainline\n```\n\n----------------------------------------\n\nTITLE: Run NGINX Controller Installation Script\nDESCRIPTION: These commands navigate to the extracted installer directory and execute the `install.sh` script to begin the NGINX Controller installation process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./install.sh\n```\n\n----------------------------------------\n\nTITLE: Example Tagging NGINX Ingress Controller Image\nDESCRIPTION: A concrete example of the docker tag command with placeholder values replaced by concrete ones. This command tags the NGINX Ingress Controller image with the specified AWS account ID, region code, ECR repository, and tag (`edge`).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_3\n\nLANGUAGE: Shell\nCODE:\n```\ndocker tag nginx/nginx-plus-ingress:edge <aws_account_id>.dkr.ecr.<aws_region_code>.amazonaws.com/nginx-plus-ic:edge\n```\n\n----------------------------------------\n\nTITLE: Installing HTTP Substitutions Filter on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This shell command updates the package repositories and installs the `nginx-plus-module-subs-filter` package using the `dnf` package manager. This is for Amazon Linux 2023, AlmaLinux, Rocky Linux distributions. It requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/http-substitutions-filter.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-subs-filter\n```\n\n----------------------------------------\n\nTITLE: Listing Available Modules Output - Shell\nDESCRIPTION: This is example output from the `apt-cache search nginx-plus-module` command, listing available Nginx Plus dynamic modules such as geoip, headers-more and image-filter, along with their debugging symbols packages. It provides an overview of the modules that can be installed to enhance Nginx functionality.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/dynamic-modules.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nnginx-plus-module-geoip - NGINX Plus, provided by NGINX, Inc. (GeoIP dynamic modules)\nnginx-plus-module-geoip-dbg - Debugging symbols for the nginx-plus-module-geoip\nnginx-plus-module-geoip2 - NGINX Plus, provided by NGINX, Inc. (3rd-party GeoIP2 dynamic modules)\nnginx-plus-module-geoip2-dbg - Debugging symbols for the nginx-plus-module-geoip2\nnginx-plus-module-headers-more - NGINX Plus, provided by NGINX, Inc. (3rd-party headers-more dynamic module)\nnginx-plus-module-headers-more-dbg - Debugging symbols for the nginx-plus-module-headers-more\nnginx-plus-module-image-filter - NGINX Plus, provided by NGINX, Inc. (image filter dynamic module)\nnginx-plus-module-image-filter-dbg - Debugging symbols for the nginx-plus-module-image-filter\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Amplify Agent Repository Config (CentOS/RHEL - Bash)\nDESCRIPTION: Verifies the content of the repository configuration file for NGINX Amplify Agent.  It uses the `cat` command to display the content of `/etc/yum.repos.d/nginx-amplify.repo`. This snippet serves as an example of the expected output from the repository config.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\ncat /etc/yum.repos.d/nginx-amplify.repo\n[nginx-amplify]\nname=nginx repo\nbaseurl=https://packages.amplify.nginx.com/centos/9/$basearch\ngpgcheck=1\nenabled=1\n```\n\n----------------------------------------\n\nTITLE: Checking for SSL/TLS Support\nDESCRIPTION: This shell command checks if Nginx is configured with SSL/TLS support by examining the output of `nginx -V` for the `with--mail_ssl_module` line.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/mail-proxy/mail-proxy.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\n$ nginx -V\nconfigure arguments: ... with--mail_ssl_module\n```\n\n----------------------------------------\n\nTITLE: Joining a Node to the NGINX Controller Cluster\nDESCRIPTION: This bash command runs the install script with the provided join-key to add a node to the NGINX Controller cluster. The `join-key` is generated by the NGINX Controller web interface and is required for authenticating the new node during the joining process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/manage-cluster.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./install.sh --join-key <long-value>\n```\n\n----------------------------------------\n\nTITLE: Adding SSL Certificates to Stream\nDESCRIPTION: This snippet shows how to configure SSL certificates for the TCP stream.  It uses the `ssl_certificate` directive to specify the path to the certificate file and the `ssl_certificate_key` directive to specify the path to the private key file. The certificate must be in PEM format.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-tcp.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    #...\n    ssl_certificate        /etc/ssl/certs/server.crt;\n    ssl_certificate_key    /etc/ssl/certs/server.key;\n}\n```\n\n----------------------------------------\n\nTITLE: Update NGINX Plus Repository Base URL - Shell\nDESCRIPTION: Updates the base URL in the `/etc/yum.repos.d/nginx-plus-8.repo` file to point to a specific NGINX Plus version (e.g., R33). This ensures that subsequent updates will only come from the specified version's repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/pin-to-version/pin-rhel8-R32.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nbaseurl=https://pkgs.nginx.com/plus/R33/centos/8/$basearch/\n```\n\n----------------------------------------\n\nTITLE: Verifying NGINX Signing Key Fingerprint on Alpine\nDESCRIPTION: This command displays the public key details of the downloaded NGINX signing key, allowing you to verify its authenticity. It uses the openssl rsa command to print the modulus and exponent of the key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_41\n\nLANGUAGE: shell\nCODE:\n```\nopenssl rsa -pubin -in /tmp/nginx_signing.rsa.pub -text -noout\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Plus Dependencies - Bash\nDESCRIPTION: Downloads NGINX Plus and njs dependencies using a provided shell script. The script takes the Linux distribution, certificate, and key file locations as arguments to create a `tar.gz` archive containing the necessary packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-devportal-offline.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo bash fetch-external-acm-dataplane-dependencies.sh <linux distribution> /etc/ssl/nginx/nginx-repo.crt /etc/ssl/nginx/nginx-repo.key\n```\n\n----------------------------------------\n\nTITLE: Configuration Load Success Log Event JSON\nDESCRIPTION: This JSON object indicates the successful loading of the WAF configuration.  It includes versions of components and attack signatures packages. The log level is Notice. This event is also generated on initial configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/operation-logs.md#_snippet_8\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"completed_successfully\": true,\n    \"event\": \"configuration_load_success\",\n    \"attack_signatures_package\": {\n        \"version\": \"2022.11.16\",\n        \"revision_datetime\": \"2022-11-16T11:22:27Z\"\n    },\n    \"threat_campaigns_package\": {\n        \"version\": \"2022.11.15\",\n        \"revision_datetime\": \"2022-11-15T10:01:20Z\"\n    },\n    \"softwareVersion\": \"4.0.0\",\n    \"componentVersions\": {\n        \"wafEngineVersion\": \"10.179.0\",\n        \"wafNginxVersion\": \"4.2.0\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Update NGINX Certificate - Azure CLI\nDESCRIPTION: This command updates an existing NGINX certificate in a deployment. The command requires specification of the certificate name and deployment name. It can be used to modify certificate paths, key paths, and the key vault secret ID.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-azure-cli.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\naz nginx deployment certificate update [--add]\n                                       [--certificate-name]\n                                       [--certificate-path]\n                                       [--deployment-name]\n                                       [--force-string {0, 1, f, false, n, no, t, true, y, yes}]\n                                       [--ids]\n                                       [--key-path]\n                                       [--key-vault-secret-id]\n                                       [--location]\n                                       [--no-wait {0, 1, f, false, n, no, t, true, y, yes}]\n                                       [--remove]\n                                       [--resource-group]\n                                       [--set]\n                                       [--subscription]\n```\n\n----------------------------------------\n\nTITLE: Pulling NGINX Plus rootless with NGINX Agent image\nDESCRIPTION: This command pulls the NGINX Plus image bundled with the NGINX Agent and configured for rootless execution from the private NGINX registry.  The <version-tag> should be replaced with the specific version of NGINX Plus to be pulled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\ndocker pull private-registry.nginx.com/nginx-plus/rootless-agent:<version-tag>\n```\n\n----------------------------------------\n\nTITLE: Invalid Service Configuration Example\nDESCRIPTION: This code snippet demonstrates an invalid Service configuration in Kubernetes, where multiple port configurations duplicate the `.spec.ports[].targetPort` value. NGINX Service Mesh disregards these duplicates, honoring only one for traffic forwarding, authentication, and encryption.  A workaround requires unique targetPort values or routing all traffic through the same Service port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.8.0.md#_snippet_1\n\nLANGUAGE: plaintext\nCODE:\n```\napiVersion: v1\nkind: Service\nspec:\n  ports:\n  - port: 8080\n    protocol: TCP\n    targetPort: 55555\n  - port: 9090\n    protocol: TCP\n    targetPort: 55555\n```\n\n----------------------------------------\n\nTITLE: Generating RSA Private Key with OpenSSL\nDESCRIPTION: This command generates an RSA private key using OpenSSL. The -des3 option encrypts the key, prompting the user for a passphrase. The key is saved to the specified file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl genrsa -des3 -out ~/private-key.pem 2048\nGenerating RSA private key ...\nEnter pass phrase for private-key.pem:\n```\n\n----------------------------------------\n\nTITLE: Bash Code Snippet to Determine Codename\nDESCRIPTION: This is a multi-line bash snippet to dynamically determine the codename of the OS and assign to a variable. Part of the workaround for the Ubuntu 22.04 LTS agent installation issue.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\ncodename=$(cat /etc/*-release | grep '^DISTRIB_CODENAME' |\nsed 's/^[^=]*=\\([^=]*\\)/\\1/' |\ntr '[:upper:]' '[:lower:]')\n```\n\n----------------------------------------\n\nTITLE: Add NGINX Instance Manager Repository (CentOS/RHEL)\nDESCRIPTION: Downloads the NGINX Instance Manager repository configuration file for CentOS/RHEL using wget and places it in the /etc/yum.repos.d directory. This allows the system to find and install NGINX Instance Manager packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/installation/add-nms-repo.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nms.repo\n```\n\n----------------------------------------\n\nTITLE: Traffic Target YAML Definition\nDESCRIPTION: This YAML defines a TrafficTarget resource. It specifies that traffic is allowed from the 'source-allowed-sa' ServiceAccount to the 'destination-sa' ServiceAccount, and that traffic must match the 'destination-traffic' rules defined in the HTTPRouteGroup.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_12\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: access.smi-spec.io/v1alpha2\nkind: TrafficTarget\nmetadata:\n  name: traffic-target\nspec:\n  destination:\n    kind: ServiceAccount\n    name: destination-sa\n  rules:\n  - kind: HTTPRouteGroup\n    name: route-group\n    matches:\n    - destination-traffic\n  sources:\n  - kind: ServiceAccount\n    name: source-allowed-sa\n```\n\n----------------------------------------\n\nTITLE: Creating a core dump directory\nDESCRIPTION: Creates a directory `/tmp/cores` where core dump files will be stored. This directory needs to be writable by the NGINX worker process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\nmkdir /tmp/cores\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Open Source packages on Debian/Ubuntu\nDESCRIPTION: This snippet downloads NGINX Open Source packages, including dependencies, on Debian and Ubuntu systems. It creates a directory, updates the package index, and uses apt-cache depends to recursively find and download dependencies for the app-protect-module-plus package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_29\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/packages/\ncd /etc/packages/\nsudo apt-get update\nsudo bash -c 'for i in $(apt-cache depends --recurse --no-recommends --no-suggests --no-conflicts --no-breaks --no-replaces --no-enhances app-protect-module-plus | grep \"^\\w\" | sort -u); do apt-get download $i; done 2>>/etc/packages/errors.txt'\n```\n\n----------------------------------------\n\nTITLE: Installing the NGINX Developer Portal Helm Chart\nDESCRIPTION: This bash command installs the NGINX Developer Portal Helm chart with a specified release name, namespace, and values file.  The `--create-namespace` flag allows Helm to create the namespace if it doesn't exist. The `-f` flag specifies the path to the `values.yaml` file for configuration overrides.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/devportal-helm-chart.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nhelm install devportal nginx-stable/nginx-devportal --namespace devportal --create-namespace -f <path-to-your-values.yaml> [--version <desired-version>] --wait\n```\n\n----------------------------------------\n\nTITLE: Installing yum-utils on RHEL 9\nDESCRIPTION: This command installs the yum-utils package on RHEL 9. This package provides various utilities for managing yum repositories and packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_23\n\nLANGUAGE: script\nCODE:\n```\nsudo dnf install yum-utils\n```\n\n----------------------------------------\n\nTITLE: Install ACM Data Plane Dependencies (Debian)\nDESCRIPTION: These commands extract the `acm-dataplane-dependencies-<linux-distribution>.tar.gz` archive and install the Debian packages within it. The `tar` command's `-k` option ensures existing files are not overwritten. Replace `<linux-distribution>` with the target distribution.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm-offline.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\ntar -kzxvf acm-dataplane-dependencies-<linux-distribution>.tar.gz\nsudo dpkg -i ./*.deb\n```\n\n----------------------------------------\n\nTITLE: Uninstall nginx-plus-module-metrics (CentOS 7)\nDESCRIPTION: This snippet demonstrates how to uninstall the `nginx-plus-module-metrics` module on CentOS 7 as part of a workaround for a package error when installing `nginx-plus-module-njs`. The command uses `yum remove` to uninstall the specified package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_30\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum remove -y nginx-plus-module-metrics\n```\n\n----------------------------------------\n\nTITLE: Define IAM Role for Single-Node AWS Installation (JSON)\nDESCRIPTION: Defines an IAM role with specific permissions required for a single-node NGINX Controller installation on AWS, focusing on autoscaling, EC2, IAM, and KMS actions. This role grants the necessary access for managing EC2 instances, volumes, and security groups. It is crucial for enabling NGINX Controller to provision and manage resources within the AWS environment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/nginx-controller-tech-specs.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"autoscaling:DescribeAutoScalingGroups\",\n        \"autoscaling:DescribeLaunchConfigurations\",\n        \"autoscaling:DescribeTags\",\n        \"ec2:DescribeInstances\",\n        \"ec2:DescribeRegions\",\n        \"ec2:DescribeRouteTables\",\n        \"ec2:DescribeSecurityGroups\",\n        \"ec2:DescribeSubnets\",\n        \"ec2:DescribeVolumes\",\n        \"ec2:CreateSecurityGroup\",\n        \"ec2:CreateTags\",\n        \"ec2:CreateVolume\",\n        \"ec2:ModifyInstanceAttribute\",\n        \"ec2:ModifyVolume\",\n        \"ec2:AttachVolume\",\n        \"ec2:AuthorizeSecurityGroupIngress\",\n        \"ec2:CreateRoute\",\n        \"ec2:DeleteRoute\",\n        \"ec2:DeleteSecurityGroup\",\n        \"ec2:DeleteVolume\",\n        \"ec2:DetachVolume\",\n        \"ec2:RevokeSecurityGroupIngress\",\n        \"ec2:DescribeVpcs\",\n        \"iam:CreateServiceLinkedRole\",\n        \"kms:DescribeKey\"\n      ],\n      \"Resource\": [\n        \"*\"\n      ]\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Test Nginx configuration\nDESCRIPTION: This snippet demonstrates how to test the Nginx configuration using the `nginx -t` command. This command checks the syntax of the configuration file and reports any errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginscript.md#_snippet_7\n\nLANGUAGE: Shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Create Diagnostic Settings for NGINX Logs to Storage Account - Azure CLI\nDESCRIPTION: This command creates Azure Monitor diagnostic settings to export NGINX logs to a storage account.  It requires the NGINXaaS resource ID, a diagnostic setting name, and the storage account name.  The logs category is set to 'NginxLogs', and retention policy is disabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/monitoring/enable-logging/logging-using-cli.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\naz monitor diagnostic-settings create --resource <nginxaas_resource_id> --logs \"[{category:NginxLogs,enabled:true,retention-policy:{enabled:false,days:0}}]\" --name <diagnostic_setting_name> --storage-account <storage_account_name>\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX Agent on Alpine Linux\nDESCRIPTION: This command removes the NGINX Agent package using the apk package manager on Alpine Linux. It requires root privileges to execute. This removes the installed nginx-agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/uninstall.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo apk del nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Start NGINX Service (Shell)\nDESCRIPTION: This command starts the NGINX service using `systemctl`. This makes NGINX available to serve web traffic.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl start nginx\n```\n\n----------------------------------------\n\nTITLE: Build NGINX Plus image\nDESCRIPTION: This command builds only the NGINX Plus image using make.  It requires GNU Make, Docker, and a valid Nginx Plus license.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/building-the-images.md#_snippet_5\n\nLANGUAGE: makefile\nCODE:\n```\nmake PREFIX=myregistry.example.com/nginx-gateway-fabric/nginx-plus build-prod-nginx-plus-image\n```\n\n----------------------------------------\n\nTITLE: Change nginx-agent Directory Ownership\nDESCRIPTION: This command changes the group ownership of the `/var/run/nginx-agent` directory to `nginx-agent` using `chown`.  It uses `sudo` for elevated privileges. This ensures the NGINX Agent group has the necessary access to the directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configure-nginx-agent-group.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo chown :nginx-agent /var/run/nginx-agent\n```\n\n----------------------------------------\n\nTITLE: JWT Claims Example JSON\nDESCRIPTION: This JSON structure demonstrates how JWT claims are structured. It shows a sample JWT payload with claims for scope, roles, subject, and address. The 'claims' attribute maps JSON paths to their respective values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_5\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"scope\": \"top-level:read\",\n    \"roles\": [\n        \"inventory-manager\",\n        \"price-editor\"\n    ],\n    \"sub\": \"joe@doe.com\"\n    \"address\": {\n        \"country\": \"US\",\n        \"state\": \"NY\",\n        \"city\": \"New York\",\n        \"street\": \"888 38th W\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Implement gRPC Server in Python\nDESCRIPTION: Implements a gRPC server in Python using the generated protobuf code. This includes defining a GreeterServicer class that handles the SayHello and SayGoodbye RPC calls, and setting up the server to listen for incoming requests on port 50051.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/services/publish-gRPC-proxy.md#_snippet_7\n\nLANGUAGE: python\nCODE:\n```\nimport grpc\nimport helloworld_pb2\nimport helloworld_pb2_grpc\nfrom concurrent import futures\n\nclass GreeterServicer(helloworld_pb2_grpc.GreeterServicer):\n    def SayHello(self, request, context):\n        response = helloworld_pb2.HelloReply(message='Hello, ' + request.name)\n        return response\n\n    def SayGoodbye(self, request, context):\n        response = helloworld_pb2.GoodbyeReply(message='Goodbye, ' + request.name)\n        return response\n\ndef serve():\n    server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))\n    helloworld_pb2_grpc.add_GreeterServicer_to_server(GreeterServicer(), server)\n    server.add_insecure_port('[::]:50051')\n    server.start()\n    server.wait_for_termination()\n\nif __name__ == '__main__':\n    serve()\n```\n\n----------------------------------------\n\nTITLE: Get Gateway External IP\nDESCRIPTION: This command retrieves the external IP address of the gateway service. The IP address is needed to send traffic to the application through the gateway.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get svc gateway-svc\n```\n\n----------------------------------------\n\nTITLE: Loading NGINX JavaScript module\nDESCRIPTION: This directive is placed in the top-level configuration context of /etc/nginx/nginx.conf to load the NGINX JavaScript module. This module is necessary for handling the OpenID Connect interaction with Keycloak.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/keycloak.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent (Amazon Linux 2)\nDESCRIPTION: Installs the nginx-agent package on Amazon Linux 2 using the yum package manager. This command installs the NGINX Agent software on the system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_34\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Build NGINX Gateway Fabric and NGINX Plus images\nDESCRIPTION: This command uses make to build both the NGINX Gateway Fabric and NGINX Plus images. The PREFIX variable is used to define the registry. Requires GNU Make, Docker, and valid NGINX Plus license.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/building-the-images.md#_snippet_2\n\nLANGUAGE: makefile\nCODE:\n```\nmake PREFIX=myregistry.example.com/nginx-gateway-fabric build-prod-images-with-plus\n```\n\n----------------------------------------\n\nTITLE: Defining API Server Block Nginx\nDESCRIPTION: This snippet defines a server block within the http context to handle API requests.  It acts as a placeholder for API configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    server {\n        # your api configuration will be here\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Kubernetes dry-run warning during NGINX Controller Installation\nDESCRIPTION: This snippet shows a warning message that may appear during NGINX Controller installation on RHEL 8 while checking Kubernetes. The warning indicates that the `--dry-run` flag is deprecated and can be replaced with `--dry-run=client`. It can be safely ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.7.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\nW0304 00:13:38.871876 1594252 helpers.go:553] --dry-run is deprecated and can be replaced with --dry-run=client.\n```\n\n----------------------------------------\n\nTITLE: Generate Python Code from protobuf\nDESCRIPTION: Generates Python code from the protobuf definition using the grpc_tools.protoc compiler. This step creates the necessary Python classes and stubs for interacting with the gRPC service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/services/publish-gRPC-proxy.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\npython -m grpc_tools.protoc -I. --python_out=. --grpc_python_out=. helloworld.proto\n```\n\n----------------------------------------\n\nTITLE: Generate Traffic to Gateway Service\nDESCRIPTION: This bash script generates continuous traffic to the gateway Service using curl.  It is used to test the traffic splitting configuration and observe the responses from different backends.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_22\n\nLANGUAGE: bash\nCODE:\n```\nfor i in $(seq 1 300); do curl $GATEWAY_IP; sleep 1; done\n```\n\n----------------------------------------\n\nTITLE: Run Setup Script\nDESCRIPTION: This snippet executes the `setup.sh` script after making it executable. The script handles the provisioning and configuration of the NGINX instances. This script relies on Packer and Terraform to be configured correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-network-load-balancer.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nchmod +x setup.sh\n./setup.sh\n```\n\n----------------------------------------\n\nTITLE: Deleting Nginx Mesh Namespace\nDESCRIPTION: This command deletes the nginx-mesh namespace. This is a workaround to resolve issues where the `remove` command fails. Note that the command may appear to stall initially.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.6.0.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete namespace nginx-mesh\n```\n\n----------------------------------------\n\nTITLE: Restricting Access to NGINX Plus API\nDESCRIPTION: This snippet restricts access to the NGINX Plus API location. It uses `limit_except` to require authentication for all methods except GET, and `allow` and `deny` directives to restrict access by IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\n# ...\n    server {\n        listen 80;\n        server_name www.example.com;\n\n        location /api {\n            limit_except GET {\n                auth_basic \"NGINX Plus API\";\n                auth_basic_user_file /path/to/passwd/file;\n            }\n\n            api   write=on;\n\n            allow 127.0.0.1;\n            deny  all;\n        }\n    }\n```\n\n----------------------------------------\n\nTITLE: AWS ECR Login Command\nDESCRIPTION: This AWS CLI command retrieves an authentication token for your AWS ECR registry and pipes it into the `docker login` command, enabling AWS ECR to authenticate and authorize Docker requests. It requires the `aws_region_code` and `aws_account_id` as parameters. This step is essential for pushing Docker images to a private AWS ECR repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\naws ecr get-login-password --region <aws_region_code> | docker login --username AWS --password-stdin <aws_account_id>.dkr.ecr.<aws_region_code>.amazonaws.com\n```\n\n----------------------------------------\n\nTITLE: Restart Nginx Agent Service\nDESCRIPTION: This command restarts the Nginx Agent service to apply changes made to the agent configuration file. This ensures that the agent uses the updated proxy settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/proxy-setup/set-up-nginx-proxy-for-nginx-one.md#_snippet_3\n\nLANGUAGE: sh\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX Management Suite\nDESCRIPTION: Restarts the NGINX Management Suite service to resolve issues such as disabled features after license updates. The command uses `systemctl` to restart the `nms` service, requiring `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/known-issues.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo systemctl restart nms\n```\n\n----------------------------------------\n\nTITLE: Rename default.conf Shell\nDESCRIPTION: This command renames the default.conf file to default.conf.bak. This prevents Nginx from using the default configuration, allowing a new configuration file to take effect. The backup file can be used to revert to the original configuration if needed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/setting-up-nginx-demo-environment.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nmv default.conf default.conf.bak\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Error Message During NGINX Controller Startup\nDESCRIPTION: This snippet shows the Kubernetes error message displayed during NGINX Controller startup on RHEL 8. The error indicates an unknown flag is being used with kubectl apply. The documentation states that this message can be safely ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.2.md#_snippet_4\n\nLANGUAGE: none\nCODE:\n```\nError: unknown flag: --server-dry-run\nSee 'kubectl apply --help' for usage.\nDetected an invalid patch for the analytics database. Resolving conflicts and restarting the analytics database before running the update.\nstatefulset.apps/clickhouse patched\n```\n\n----------------------------------------\n\nTITLE: Removing Sensitive Data from Support Logs (Bash)\nDESCRIPTION: This snippet demonstrates how to remove confidential information from the generated support log archive before sending it to F5. This is accomplished by first decompressing the archive, deleting specific files, and then recompressing the archive. Users should ensure they replace the example file paths with the correct paths to their sensitive data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/support/contact-support.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ngzip -d /tmp/nginx-manager-log.tar.gz\ntar -f /tmp/nginx-manager-log.tar.gz --delete /etc/nginx-manager/example.key --delete /etc/nginx-manager/example.crt\ngzip -9 /tmp/nginx-manager-log.tar.gz\n```\n\n----------------------------------------\n\nTITLE: Query Total Number of TCP/UDP Connections with Prometheus\nDESCRIPTION: This Prometheus query retrieves the total number of connections made to upstream servers for TCP/UDP traffic. The query uses the `nginxplus_stream_upstream_server_connections` metric.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_4\n\nLANGUAGE: promQL\nCODE:\n```\nnginxplus_stream_upstream_server_connections\n```\n\n----------------------------------------\n\nTITLE: Associate Key Vault with Network Security Perimeter - Azure CLI\nDESCRIPTION: This snippet associates a key vault with a network security perimeter using the Azure CLI. It requires the `NSP_NAME`, `NSP_RESOURCE_GROUP`, `key_vault_id`, and `nsp_profile_id` variables to be defined.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\naz network perimeter association create --name key-vault-association \\\n      --perimeter-name $NSP_NAME \\\n      --resource-group $NSP_RESOURCE_GROUP \\\n      --private-link-resource \"{id:$key_vault_id}\" \\\n      --profile \"{id:$nsp_profile_id}\"\n```\n\n----------------------------------------\n\nTITLE: Changing the API Key\nDESCRIPTION: Shows how to change the API key in the agent.conf file.  The API key is used to authenticate the agent with the NGINX Amplify backend. Editing this requires knowledge of the correct API key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/configuring-amplify-agent.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\n[credentials]\napi_key = YOUR_API_KEY\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration with Multiple Listen IPs and Wildcard IP\nDESCRIPTION: This configuration demonstrates a known issue in NGINX where using multiple specific listen IPs alongside a wildcard IP on the same port can lead to traffic misrouting due to reuseport behavior.  The issue occurs because traffic intended for IP:port pairs using `reuseport` is incorrectly forwarded to the server block with the wildcard IP. The first IP:port pair does not get affected. A workaround is to use a unique port for each HTTP URI when both listenIP and wildcard IP are used on the same instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/apim/apim-release-notes-3.19.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nserver {\n  listen ip1:port;\n  listen ip2:port reuseport;\n  listen ip3:port reuseport;\n}\nserver {\n  listen port reuseport;  <-- wildcard IP\n}\n```\n\n----------------------------------------\n\nTITLE: Example Nginx Version Output (Shell)\nDESCRIPTION: This is the expected output of the `nginx -v` command. It indicates the nginx version and confirms that it is an NGINX Plus version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nnginx version: nginx/1.27.4 (nginx-plus-r34)\n```\n\n----------------------------------------\n\nTITLE: Test API Proxy - Expected Result\nDESCRIPTION: The expected result from testing the API Proxy. Verifies the headers are correctly proxied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_22\n\nLANGUAGE: bash\nCODE:\n```\nRequest served by echo-host\n\nHTTP/1.0 POST /my/test/api\n\nHost: 192.0.2.4\nAccept: */*\nCache-Control: no-cache\nContent-Length: 30\nContent-Type: application/json\nX-Correlation-Id: c241b72519e71cf7bce9262910ffbe40\nX-Real-Ip: 192.0.2.1\nX-NGINX-Test: true\n\n{\"testKey\": \"testValue\"}\n```\n\n----------------------------------------\n\nTITLE: Define GitLab CI/CD Pipeline Stages (YAML)\nDESCRIPTION: This YAML configuration defines a GitLab CI/CD pipeline stage named 'publish'. It specifies the Docker image to use, the script to execute, and the rule that triggers the stage based on changes in the 'instance' directory. The 'needs: []' indicates that this stage does not depend on any previous stages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/publish-configs-version-control.md#_snippet_1\n\nLANGUAGE: YAML\nCODE:\n```\nstages:\n  - publish\n\npublish-config-to-instance:\n  image: ${BUILD_IMAGE}\n  stage: publish\n  script:\n    # Run the script that prepares the payload with config changes and required variables\n    # ./prepare-payload.sh ${CTRL_IP} ${AUTH_TOKEN} ${SYSTEM_UID} ${NGINX_UID}\n  only:\n    <<: *_run_only_when_change_in_instance_directory\n  needs: []\n```\n\n----------------------------------------\n\nTITLE: Start NGINX Controller Agent Service (Bash)\nDESCRIPTION: This command starts the NGINX Controller Agent service. It uses the `service` command to manage the agent.  This is typically executed on the NGINX Plus system where the agent is installed. Requires root or sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/agent-restart.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nservice controller-agent start\n```\n\n----------------------------------------\n\nTITLE: Rerun NGINX Controller Update Script (bash)\nDESCRIPTION: This script changes the directory to the controller-installer directory and then executes the update.sh script. This is commonly used as a workaround to retry an update process after addressing an underlying issue.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_16\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./update.sh\n```\n\n----------------------------------------\n\nTITLE: Start Debian NGINX Plus Container (Docker)\nDESCRIPTION: This command starts a Docker container for NGINX Plus with the `debian` tag, connecting it to NGINX One.  It configures environment variables such as the JWT license, agent server host and port, and data plane key. Replace `YOUR_JWT_HERE` with your JWT and `YOUR_NGINX_ONE_DATA_PLANE_KEY_HERE` with your NGINX One data plane key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/containers/connect-nginx-plus-container-images-to-nginx-one.md#_snippet_4\n\nLANGUAGE: sh\nCODE:\n```\nsudo docker run \\\n--env=NGINX_LICENSE_JWT=\"YOUR_JWT_HERE\" \\\n--env=NGINX_AGENT_SERVER_GRPCPORT=443 \\\n--env=NGINX_AGENT_SERVER_HOST=agent.connect.nginx.com \\\n--env=NGINX_AGENT_SERVER_TOKEN=\"YOUR_NGINX_ONE_DATA_PLANE_KEY_HERE\" \\\n--env=NGINX_AGENT_TLS_ENABLE=true \\\n--restart=always \\\n--runtime=runc \\\n-d private-registry.nginx.com/nginx-plus/agent:debian\n```\n\n----------------------------------------\n\nTITLE: Mounting SPIRE Agent Socket in Kubernetes\nDESCRIPTION: This YAML snippet defines a volume that mounts the SPIRE agent socket in Kubernetes by using a hostPath. The 'path' specifies the location of the SPIRE agent socket on the host, and 'type' creates the directory if it does not exist. The volume is then mounted into the Ingress Controller's container spec, making the socket accessible within the container.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_16\n\nLANGUAGE: YAML\nCODE:\n```\nvolumes:\n- hostPath:\n    path: /run/spire/sockets\n    type: DirectoryOrCreate\n  name: spire-agent-socket\n```\n\nLANGUAGE: YAML\nCODE:\n```\nvolumeMounts:\n- mountPath: /run/spire/sockets\n  name: spire-agent-socket\n```\n\n----------------------------------------\n\nTITLE: OpenAPI File Reference List (JSON)\nDESCRIPTION: This JSON snippet represents the content of the `ref.txt` file, which is an array of OpenAPI file references. In this case, it contains a single reference to an OpenAPI specification file using a URL.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/types-of-openapi-references.md#_snippet_3\n\nLANGUAGE: JSON\nCODE:\n```\n[\n    {\n        \"link\": \"http://127.0.0.1:8088/myapi.yaml\"\n    }\n]\n```\n\n----------------------------------------\n\nTITLE: Dynamic NGINX Agent Configuration\nDESCRIPTION: This example shows the `agent-dynamic.conf` file in YAML format. This file is used to dynamically configure the NGINX Agent using the API and agent install script. It contains settings for `instance_group` and `tags`, which can be modified through API calls. The file's location varies depending on the operating system (Linux or FreeBSD).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/configuration/configuration-overview.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\n# Dynamic configuration file for NGINX Agent.\n#\n# The purpose of this file is to track agent configuration\n# values that can be dynamically changed via the API and the agent install script.\n# You may edit this file, but API calls that modify the tags on this system will\n# overwrite the tag values in this file.\n#\n# The agent configuration values that API calls can modify are as follows:\n# tags:\n#   - dev\n#   - qa\n#\n# The agent configuration value that the agent install script can modify are as follows:\n# instance_group: my-instance-group\n\ninstance_group: my-instance-group\ntags:\n  - dev\n  - qa\n```\n\n----------------------------------------\n\nTITLE: Install NGINX Controller Prereqs Individually - Bash\nDESCRIPTION: This command runs the `helper.sh` script with the `prereqs` option followed by either base, docker, or nfs to install the required system packages individually.  It is used after NGINX controller has been installed and you want to install only certain prerequisites.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh prereqs [base|docker|nfs]\n```\n\n----------------------------------------\n\nTITLE: Successful Operation Output (JSON)\nDESCRIPTION: This example demonstrates the standard successful output format, which provides metadata about the created files, after running either the signature conversion or report generation tool.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_28\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"file_size\": 1003,\n    \"filename\": \"/path/to/signatures.json\",\n    \"completed_successfully\": true\n}\n```\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"file_size\": 1868596,\n    \"filename\": \"/path/to/signature-report.json\",\n    \"completed_successfully\": true\n}\n```\n\n----------------------------------------\n\nTITLE: Deploy Gateway Resource - Kubernetes YAML\nDESCRIPTION: This Kubernetes YAML deploys a Gateway resource for the applications, defining a single HTTP listener on port 80 that matches all hostnames, using the nginx gateway class. It's typically deployed by a Cluster Operator.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/redirects-and-rewrites.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nmetadata:\n  name: gateway\nspec:\n  gatewayClassName: nginx\n  listeners:\n  - name: http\n    port: 80\n    protocol: HTTP\nEOF\n```\n\n----------------------------------------\n\nTITLE: Bad Actor Expired Shell Example\nDESCRIPTION: This snippet illustrates a 'Bad actor expired' event report from NGINX App Protect DoS. The report shows details about bad actors whose status has expired, including their source IP and the impact RPS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/security-log.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ndate_time=\"Apr 29 2021 14:05:29\",\nproduct=\"app-protect-dos\",\nproduct_version=\"23+1.54.1-1.el7.ngx\",\nunit_hostname=\"localhost.localdomain\",\ninstance_id=\"d9a6d8\",\nvs_name=\"example.com/\",\ndos_attack_id=\"0\",\nattack_event=\"Bad actor expired\",\nsource_ip=\"5.5.5.10\",\nimpact_rps=\"12\"\n```\n\n----------------------------------------\n\nTITLE: Download NGINX signing key (insecure)\nDESCRIPTION: This command insecurely downloads the NGINX signing key from the NGINX Management Suite host and adds it to the system's keyring. This is a less secure alternative for environments where SSL verification is not possible, but still resolves \"Public Key Not Available\" errors.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/troubleshooting.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\ncurl --insecure https://<NMS_FQDN>/packages-repository/nginx-signing.key | gpg --dearmor | sudo tee /usr/share/keyrings/nginx-signing.gpg >/dev/null\n```\n\n----------------------------------------\n\nTITLE: Change to NGINX Agent Source Directory (Bash)\nDESCRIPTION: This command changes the current directory to the NGINX Agent source directory. Replace `<path_to_development_directory>` with the actual path to your development directory where you cloned the NGINX Agent repository. This is a prerequisite for subsequent build and installation steps.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/contribute/dev-environment-setup.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\ncd <path_to_development_directory>/agent\n```\n\n----------------------------------------\n\nTITLE: Generating Self-Signed Certificate\nDESCRIPTION: This command generates a self-signed certificate using the private key.  The `-days` parameter specifies the validity period of the certificate. It interacts with the user to retrieve certificate details.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl req -new -x509 -key ~/private-key.pem -out ~/self-cert.pem -days 10950\n```\n\n----------------------------------------\n\nTITLE: Copy JWT License File - FreeBSD\nDESCRIPTION: Copies the JWT license file to the /usr/local/etc/nginx directory on FreeBSD systems. The <downloaded-file-name> placeholder should be replaced with the actual name of the downloaded JWT file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_57\n\nLANGUAGE: shell\nCODE:\n```\nsudo cp <downloaded-file-name>.jwt /usr/local/etc/nginx/license.jwt\n```\n\n----------------------------------------\n\nTITLE: Install Grafana using Helm\nDESCRIPTION: This snippet installs Grafana using Helm. It adds the Grafana Helm repository, updates the repository, and installs Grafana into the monitoring namespace.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/prometheus.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nhelm repo add grafana https://grafana.github.io/helm-charts\nhelm repo update\nhelm install grafana grafana/grafana -n monitoring --create-namespace\n```\n\n----------------------------------------\n\nTITLE: SELinux Policy Module Installation\nDESCRIPTION: This bash command installs the SELinux policy module created from the audit log analysis. It applies the necessary permissions to allow the Nginx instance to submit statistics to the Nginx Controller.  It requires root privileges and that the previous command for audit log analysis be run first.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_36\n\nLANGUAGE: bash\nCODE:\n```\n# semodule -i nginx.pp\n```\n\n----------------------------------------\n\nTITLE: Audit Log Analysis for SELinux\nDESCRIPTION: This bash command extracts relevant entries from the audit log related to Nginx and converts them into SELinux policy modules. It helps identify missing permissions that might be preventing Nginx from submitting statistics to the Nginx Controller due to SELinux restrictions.  It requires root privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_35\n\nLANGUAGE: bash\nCODE:\n```\n# grep nginx /var/log/audit/audit.log | audit2allow -M nginx`\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX with non-default modules\nDESCRIPTION: This example shows how to configure NGINX with specific non-default modules. It includes options for specifying paths, PCRE, Zlib, SSL, stream, and mail modules. These options need to be specified during the configure step of the NGINX build process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_55\n\nLANGUAGE: shell\nCODE:\n```\n./configure\n--sbin-path=/usr/local/nginx/nginx\n--conf-path=/usr/local/nginx/nginx.conf\n--pid-path=/usr/local/nginx/nginx.pid\n--with-pcre=../pcre2-10.43\n--with-zlib=../zlib-1.3.1\n--with-http_ssl_module\n--with-stream\n--with-mail\n```\n\n----------------------------------------\n\nTITLE: Zone Size Policy Status Example (Text)\nDESCRIPTION: This is an example of the expected output from the `kubectl describe` command.  It indicates that the `UpstreamSettingsPolicy` is accepted and lists the conditions and ancestor (Gateway) information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_11\n\nLANGUAGE: text\nCODE:\n```\nStatus:\n  Ancestors:\n    Ancestor Ref:\n      Group:      gateway.networking.k8s.io\n      Kind:       Gateway\n      Name:       gateway\n      Namespace:  default\n    Conditions:\n      Last Transition Time:  2025-01-07T20:06:55Z\n      Message:               Policy is accepted\n      Observed Generation:   1\n      Reason:                Accepted\n      Status:                True\n      Type:                  Accepted\n    Controller Name:         gateway.nginx.org/nginx-gateway-controller\nEvents:                      <none>\n```\n\n----------------------------------------\n\nTITLE: Copy Nginx Repository Certificates\nDESCRIPTION: These commands copy the `nginx-repo.crt` and `nginx-repo.key` files to the `/etc/ssl/nginx/` directory. These files are required for accessing the Nginx Plus repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm-offline.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsudo cp nginx-repo.crt /etc/ssl/nginx/\nsudo cp nginx-repo.key /etc/ssl/nginx/\n```\n\n----------------------------------------\n\nTITLE: Add NGINX App Protect WAF Repo (Shell)\nDESCRIPTION: This command downloads the `app-protect-7.repo` file from the specified URL and saves it to the `/etc/yum.repos.d` directory. This file contains the repository configuration required for accessing NGINX App Protect WAF packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-7.repo\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX Signing Key on SUSE\nDESCRIPTION: This command downloads the official NGINX signing key from the nginx.org website and saves it to the /tmp/nginx_signing.key file. This key is used to verify the authenticity of NGINX packages before installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_33\n\nLANGUAGE: shell\nCODE:\n```\ncurl -o /tmp/nginx_signing.key https://nginx.org/keys/nginx_signing.key\n```\n\n----------------------------------------\n\nTITLE: Get Container Logs (Shell)\nDESCRIPTION: This shell command retrieves the logs of a Docker container named container-name from the command line.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_30\n\nLANGUAGE: shell\nCODE:\n```\ndocker logs container-name\n```\n\n----------------------------------------\n\nTITLE: Define Protocol Buffer (protobuf)\nDESCRIPTION: Defines the structure of the gRPC service and messages using protobuf. This definition specifies the Greeter service with SayHello and SayGoodbye RPCs, along with their request and response message types.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/services/publish-gRPC-proxy.md#_snippet_5\n\nLANGUAGE: protobuf\nCODE:\n```\nsyntax = \"proto3\";\n\npackage helloworld;\n\nservice Greeter {\n    rpc SayHello (HelloRequest) returns (HelloReply) {}\n    rpc SayGoodbye (GoodbyeRequest) returns (GoodbyeReply) {}\n}\n\nmessage HelloRequest {\n    string name = 1;\n}\n\nmessage HelloReply {\n    string message = 1;\n}\n\nmessage GoodbyeRequest {\n    string name = 1;\n}\n\nmessage GoodbyeReply {\n    string message = 1;\n}\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Plus Certificates as GZIP\nDESCRIPTION: This curl command downloads the NGINX Plus certificate and key bundle as a gzip file using the NGINX Controller API. Replace `192.0.2.0` with the actual controller IP address.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\ncurl -b cookie.txt -c cookie.txt -X GET --url 'https://192.0.2.0/api/v1/platform/licenses/nginx-plus-licenses/controller-provided' --output nginx-plus-certs.gz\n```\n\n----------------------------------------\n\nTITLE: Restarting NGINX Agent on Debian/Ubuntu\nDESCRIPTION: This snippet shows how to restart the NGINX Agent on Debian and Ubuntu systems using systemctl. This completes the upgrade process.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/admin-guide/upgrade-nap-waf.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Enabling DoS Dashboard in Nginx\nDESCRIPTION: This snippet demonstrates how to enable the DoS Dashboard by defining the /dashboard-dos.html location, typically in the root directory.  This provides a visual interface for monitoring DoS activity.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/live-activity-monitoring.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    server {\n        listen 192.168.1.23;\n        # ...\n        location /api {\n            limit_except GET {\n                auth_basic \"NGINX Plus API\";\n                auth_basic_user_file /path/to/passwd/file;\n            }\n            app_protect_dos_api;\n            allow 192.168.1.0/24;\n            deny  all;\n        }\n        location = /dashboard-dos.html {\n            root   /usr/share/nginx/html;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Create CSR OpenSSL\nDESCRIPTION: This command creates a Certificate Signing Request (CSR) file using OpenSSL. The CSR is used to request a certificate from a Certificate Authority (CA).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md#_snippet_12\n\nLANGUAGE: Shell\nCODE:\n```\nroot# openssl req -new -sha256 -key ~/company.com.key -out ~/company.com.csr\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Gateway Fabric (CRDs)\nDESCRIPTION: This command removes the NGINX Gateway Fabric Custom Resource Definitions (CRDs) from the cluster.  It's crucial to delete these resources to ensure a clean uninstall. This operation is performed using `kubectl delete` and points to the CRD manifest file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\nkubectl delete -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/deploy/crds.yaml\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Instance Manager on Debian-based systems\nDESCRIPTION: These commands upgrade NGINX Instance Manager to the latest version using the apt package manager on Debian, Ubuntu, and other Debian-based systems.  `apt-get update` refreshes the package lists, and `apt-get install` with `--only-upgrade` ensures only the specified package is upgraded.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get update\nsudo apt-get install -y --only-upgrade nms-instance-manager\n```\n\n----------------------------------------\n\nTITLE: Nikto Vulnerable File Detection\nDESCRIPTION: Shows an example of Nikto identifying a potentially vulnerable file. It highlights how Nikto interprets the 200 status code, even if the file doesn't actually exist, as a potential vulnerability.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_8\n\nLANGUAGE: none\nCODE:\n```\n$ perl program/nikto.pl -h localhost\n...\n+ /site.tar: Potentially interesting archive/cert file found.\n...\n+ 7531 requests: 0 error(s) and 116 item(s) reported on remote host\n```\n\n----------------------------------------\n\nTITLE: Delete Headers application - Shell\nDESCRIPTION: Deletes the example headers application.  This command is used to clean up resources before proceeding to the next example.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nkubectl delete -f https://raw.githubusercontent.com/nginx/nginx-gateway-fabric/v{{< version-ngf >}}/examples/http-request-header-filter/headers.yaml\n```\n\n----------------------------------------\n\nTITLE: Create SSL Directory (Shell)\nDESCRIPTION: Creates the `/etc/ssl/nginx/` directory to store SSL certificates and keys required for secure communication with the NGINX repository.  This command uses `sudo` to ensure the user has the necessary permissions to create the directory. The `-p` flag ensures that parent directories are also created if they don't exist.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-rhel-cen-74.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/ssl/nginx\n```\n\n----------------------------------------\n\nTITLE: Generating Signature Report (Preset Fields)\nDESCRIPTION: Generates a JSON report file with a specific set of fields (name, signatureId) using the Attack Signature Report tool. It uses the `-o` switch to specify the output file and the `--fields` switch to list the desired fields.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_28\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/get-signatures -o /path/to/signature-report.json --fields=name,signatureId\n```\n\n----------------------------------------\n\nTITLE: Disabling App Protect for DoS API Location in Nginx\nDESCRIPTION: This snippet demonstrates how to disable NGINX App Protect WAF for the location of the NGINX App Protect DoS Live Activity Monitoring API and enable the DoS API. This is necessary when both App Protect WAF and DoS are installed to avoid conflicts.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/releases/about-2.4.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /api {\n    app_protect_enable off;\n    app_protect_dos_api;\n}\n```\n\n----------------------------------------\n\nTITLE: Enable NGINX Developer Portal Service - Bash\nDESCRIPTION: Enables the `nginx-devportal.service` using `systemctl`. This ensures that the Developer Portal service starts automatically on boot.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-devportal-offline.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl enable nginx-devportal.service\n```\n\n----------------------------------------\n\nTITLE: Configure Content Types (JSON/XML/Form-Data) for URL - JSON\nDESCRIPTION: This example configures JSON, XML, and form-data content types for a specific user-defined URL (/first*). It utilizes `urlContentProfiles` to associate different content profiles with the URL based on the Content-Type header.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/parameters-and-user-defined-urls.md#_snippet_6\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"/Common/user_defined_URL\",\n        \"template\": {\n            \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n        },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"blocking-settings\": {\n            \"violations\": [\n                {\n                    \"name\": \"VIOL_URL\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_METHOD\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_JSON_MALFORMED\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_JSON_FORMAT\",\n                    \"alarm\": true,\n                    \"block\": true\n                },\n                {\n                    \"name\": \"VIOL_XML_FORMAT\",\n                    \"alarm\": true,\n                    \"block\": true\n                }\n            ]\n        },\n        \"json-profiles\": [\n            {\n                \"name\": \"Default\",\n                \"handleJsonValuesAsParameters\": false,\n                \"defenseAttributes\": {\n                    \"maximumTotalLengthOfJSONData\": \"any\",\n                    \"maximumArrayLength\": \"any\",\n                    \"maximumStructureDepth\": \"any\",\n                    \"maximumValueLength\": \"any\"\n                }\n            }\n        ],\n        \"xml-profiles\": [\n            {\n                \"name\": \"Default\",\n                \"defenseAttributes\": {\n                    \"maximumAttributesPerElement\": \"any\",\n                    \"maximumDocumentDepth\": \"any\",\n                    \"maximumAttributeValueLength\": \"any\",\n                    \"maximumChildrenPerElement\": \"any\",\n                    \"maximumDocumentSize\": \"any\",\n                    \"maximumElements\": \"any\",\n                    \"maximumNameLength\": \"any\",\n                    \"maximumNSDeclarations\": \"any\",\n                    \"maximumNamespaceLength\": \"any\",\n                    \"tolerateLeadingWhiteSpace\": true,\n                    \"tolerateCloseTagShorthand\": true,\n                    \"allowCDATA\": true,\n                    \"allowExternalReferences\": true,\n                    \"allowProcessingInstructions\": true\n                }\n            }\n        ],\n        \"urls\": [\n            {\n                \"method\": \"*\",\n                \"name\": \"/first*\",\n                \"protocol\": \"http\",\n                \"type\": \"wildcard\",\n                \"wildcardOrder\": 1,\n                \"urlContentProfiles\": [\n                    {\n                        \"headerValue\": \"*\",\n                        \"headerName\": \"*\",\n                        \"headerOrder\": \"3\",\n                        \"type\": \"form-data\"\n                    },\n                    {\n                        \"contentProfile\": {\n                            \"name\": \"Default\"\n                        },\n                        \"headerValue\": \"*xml*\",\n                        \"headerName\": \"Content-Type\",\n                        \"headerOrder\": \"2\",\n                        \"type\": \"xml\"\n                    },\n                    {\n                        \"contentProfile\": {\n                            \"name\": \"Default\"\n                        },\n                        \"headerValue\": \"*json*\",\n                        \"headerName\": \"Content-Type\",\n                        \"headerOrder\": \"1\",\n                        \"type\": \"json\"\n                    }\n                ]\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Describe Kubernetes Pod\nDESCRIPTION: This command retrieves detailed information about a specific Kubernetes Pod, including its status, events, and configuration. It is useful for diagnosing issues related to pod startup, readiness, and resource allocation. Replace <ngf-pod-name> with the actual name of the NGINX Gateway Fabric pod.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/troubleshooting.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nkubectl describe pod <ngf-pod-name> -n nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Downloading Load Balancer Nginx Configuration via Curl\nDESCRIPTION: This shell script navigates to the Nginx configuration directory and uses the curl command to download a specific Nginx configuration file (gce-all-active-lb.conf) for the load balancer from a remote GitHub repository. The downloaded configuration file is then saved locally with the same name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\ncd /etc/nginx/conf.d/\ncurl -o gce-all-active-lb.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-lb.conf\n```\n\n----------------------------------------\n\nTITLE: Check Kubernetes Certificate Expiration - Bash\nDESCRIPTION: This command checks the expiration date of Kubernetes certificates using the `kubeadm` tool. It helps identify if the kubelet certificate has expired, which can prevent NGINX Controller from starting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.20.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubeadm alpha certs check-expiration\n```\n\n----------------------------------------\n\nTITLE: Setting up PKG Repository (FreeBSD)\nDESCRIPTION: Creates the /etc/pkg/nginx-agent.conf file with the specified content to configure the pkg repository for nginx-agent packages on FreeBSD. This enables the pkg package manager to discover and install the nginx-agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_36\n\nLANGUAGE: none\nCODE:\n```\nnginx-agent: {\nURL: pkg+https://pkgs.nginx.com/nginx-agent/freebsd/${ABI}/latest\nENABLED: yes\nMIRROR_TYPE: SRV\n}\n```\n\n----------------------------------------\n\nTITLE: Security Log Configuration in JSON\nDESCRIPTION: This JSON snippet represents the configuration file for the security log. It defines filters for traffic mitigation statistics, bad actors, and attack signatures.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_13\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"filter\": {\n        \"traffic-mitigation-stats\": \"all\",\n        \"bad-actors\": \"top 10\",\n        \"attack-signatures\": \"top 10\"\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Restarting PHP-FPM Service (Bash)\nDESCRIPTION: This command restarts the PHP-FPM service. It's required after enabling the PHP-FPM status path. This ensures that the changes take effect and the service is running with the updated configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/other-metrics.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nservice php7.0-fpm restart\n```\n\n----------------------------------------\n\nTITLE: Restarting NGINX Amplify Agent\nDESCRIPTION: This snippet demonstrates how to restart the NGINX Amplify Agent service. It uses the `service` command to restart the `amplify-agent` service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/faq/nginx-amplify-agent.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\n# service amplify-agent restart\n```\n\n----------------------------------------\n\nTITLE: APT Configuration Line (Focal)\nDESCRIPTION: This is a configuration line used in `/etc/apt/sources.list` to configure package repository for APT package manager. This line specifically uses 'focal' as the codename.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_15\n\nLANGUAGE: text\nCODE:\n```\ndeb ${PACKAGES_URL}/deb/${os}/ focal agent\n```\n\n----------------------------------------\n\nTITLE: Install apt utils - Ubuntu\nDESCRIPTION: This command installs necessary apt utilities for managing packages over HTTPS and handling dependencies. `sudo apt-get install apt-transport-https lsb-release ca-certificates wget` installs the `apt-transport-https` package for secure HTTPS transport, `lsb-release` to identify the Linux distribution, `ca-certificates` to verify SSL certificates, and `wget` to download files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_31\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get install apt-transport-https lsb-release ca-certificates wget\n```\n\n----------------------------------------\n\nTITLE: Fixing URL encoding in Dev Portal Code Snippet (Bash)\nDESCRIPTION: The code snippet shows how to fix URL encoding issues in example code snippets found in the Dev Portal. The Dev Portal might incorrectly URL encode path parameters in generated code examples. This snippet provides the corrected URL, removing the URL encoding for the 'driverId' parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_28\n\nLANGUAGE: bash\nCODE:\n```\ncurl --request GET --url http://sportsapp.example.com/api/f1/drivers/%7BdriverId%7D\n```\n\n----------------------------------------\n\nTITLE: Delete HTTPRoute resource - Shell\nDESCRIPTION: Deletes the HTTPRoute resource named 'headers'. This command is used to clean up resources before proceeding to the next example.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/request-response-headers.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nkubectl delete httproutes.gateway.networking.k8s.io headers\n```\n\n----------------------------------------\n\nTITLE: Displaying the Listen Queue\nDESCRIPTION: This snippet shows how to display the current listen queue using the `netstat` command. The output shows the number of unaccepted connections against the configured maximum of queued connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/serving-static-content.md#_snippet_10\n\nLANGUAGE: none\nCODE:\n```\nnetstat -Lan\n```\n\n----------------------------------------\n\nTITLE: Update Chef Node from File\nDESCRIPTION: This command updates the node definition on the Chef server with the contents of the specified JSON file. It applies the changes made to the local copy of the node definition.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/nginx-plus-high-availability-chef.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nroot@chef-server:~/chef-zero/playground# knife node from file nodes/chef-test-1.json\n```\n\n----------------------------------------\n\nTITLE: Disable Swagger UI in Nginx\nDESCRIPTION: This snippet disables access to the Swagger UI by returning a 404 status code for any requests to the `/swagger-ui` location.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_28\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /swagger-ui {\n    return 404;\n}\n```\n\n----------------------------------------\n\nTITLE: Change Directory to Nginx Configuration Directory Shell\nDESCRIPTION: This command changes the current directory to the Nginx configuration directory, which is typically /etc/nginx/conf.d. This directory is used to store Nginx configuration files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/setting-up-nginx-demo-environment.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ncd /etc/nginx/conf.d\n```\n\n----------------------------------------\n\nTITLE: Restart Kubernetes Resources for NGINX Service Mesh\nDESCRIPTION: This snippet restarts a Kubernetes resource to apply changes after the upgrade.  `<resource type>` and `<resource name>` need to be replaced with the actual resource type (e.g., deployment, statefulset) and name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade-with-helm.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nkubectl rollout restart <resource type>/<resource name>\n```\n\n----------------------------------------\n\nTITLE: Verify Services Deployment Status\nDESCRIPTION: This command uses `kubectl` to verify that the gateway and target application services have been deployed successfully. It shows the type, cluster IP, external IP, ports, and age of each service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/trafficsplit-deployments.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\n$ kubectl get svc\nNAME          TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE\ngateway-svc   LoadBalancer   10.0.0.2        1.2.3.4         80:30975/TCP   2m\ntarget-svc    ClusterIP      10.0.0.3        <none>          80/TCP         2m\ntarget-v1-0   ClusterIP      10.0.0.4        <none>          80/TCP         2m\n```\n\n----------------------------------------\n\nTITLE: Error message regarding gateway input\nDESCRIPTION: This JSON snippet shows an example error message received when a Splunk Data Forwarder is in an Error state after an upgrade to NGINX Controller version 3.13. The message indicates an issue with gateway input due to deprecated output format\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/support/troubleshooting-forwarders.md#_snippet_4\n\nLANGUAGE: JSON\nCODE:\n```\n{\n\"conditions\": [\n    {\n        \"message\": \"obtaining gateway input: creating gateway: no constructor found for gateway type SPLUNK_HEC\",\n        \"type\": \"error\"\n    }\n],\n}\n```\n\n----------------------------------------\n\nTITLE: Running Kubernetes Backup Script (./k8s-backup.sh)\nDESCRIPTION: This command executes the `k8s-backup.sh` script to back up NGINX Instance Manager in a Kubernetes environment. The script creates a backup archive named `k8s-backup-<timestamp>.tar.gz`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\n./k8s-backup.sh\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Agent is running\nDESCRIPTION: This command verifies that the NGINX Agent process is running by listing all processes and filtering for those containing 'nginx-agent'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nps aux | grep nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Backup Kubernetes Custom Resources\nDESCRIPTION: These commands back up various Kubernetes Custom Resources (TrafficSplits, TrafficTargets, RateLimits, etc.) to YAML files before a manual upgrade. This ensures that these resources can be restored after the mesh is redeployed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get trafficsplits.split.smi-spec.io -A -o yaml > trafficsplits.yaml\nkubectl get traffictargets.access.smi-spec.io -A -o yaml > traffictargets.yaml\nkubectl get httproutegroups.specs.smi-spec.io -A -o yaml > httproutegroups.yaml\nkubectl get tcproutes.specs.smi-spec.io -A -o yaml > tcproutes.yaml\nkubectl get ratelimits.specs.smi.nginx.com -A -o yaml > ratelimits.yaml\nkubectl get circuitbreakers.specs.smi.nginx.com -A -o yaml > circuitbreakers.yaml\n```\n\n----------------------------------------\n\nTITLE: Keepalive Directive in NGINX Configuration (Text)\nDESCRIPTION: This snippet shows the NGINX configuration for the `coffee` upstream.  It confirms that the `keepalive` directive is set to `32`, as specified in the `UpstreamSettingsPolicy`. The tea upstream doesn't contain this directive because the policy only targeted coffee.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/upstream-settings.md#_snippet_18\n\nLANGUAGE: text\nCODE:\n```\nupstream default_coffee_80 {\n    random two least_conn;\n    zone default_coffee_80 1m;\n\n    server 10.244.0.14:8080;\n    keepalive 32;\n}\n```\n\nLANGUAGE: text\nCODE:\n```\nupstream default_tea_80 {\n    random two least_conn;\n    zone default_tea_80 1m;\n\n    server 10.244.0.15:8080;\n}\n```\n\n----------------------------------------\n\nTITLE: Update Proxy with DNS Resolver - Bash\nDESCRIPTION: This command updates the proxy configuration to include DNS resolvers for the Introspection policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_45\n\nLANGUAGE: bash\nCODE:\n```\nPUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy\n```\n\n----------------------------------------\n\nTITLE: Warning message example in NGINX Service Mesh logs\nDESCRIPTION: This code snippet shows an example of a warning message that might appear in the nginx-mesh-sidecar logs after configuring traffic access policies. This warning is harmless and can be ignored. It doesn't indicate any operational issues.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.8.0.md#_snippet_0\n\nLANGUAGE: plaintext\nCODE:\n```\n2020/09/24 01:03:14 could not parse syslog message: nginx could not connect to upstream\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Plus Package using DNF\nDESCRIPTION: Installs the nginx-plus package using the dnf package manager. This command is executed with sudo privileges to ensure proper installation and replacement of any older versions of NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/install-nginx-plus-package-dnf.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf install nginx-plus\n```\n\n----------------------------------------\n\nTITLE: Creating and Navigating to public_html Directory on Backend Servers\nDESCRIPTION: These shell commands create a directory named 'public_html' and then change the current directory to it. This directory will serve as the document root for the web server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/route-53-global-server-load-balancing.md#_snippet_4\n\nLANGUAGE: Shell\nCODE:\n```\nmkdir public_html\ncd public_html\n```\n\n----------------------------------------\n\nTITLE: Successful Request Example\nDESCRIPTION: Example output from a successful request to the destination service, showing the HTTP headers and response body.  This indicates the driver is able to communicate with the service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\n*   Trying 10.100.5.18:8080...\n* Connected to dest-svc (10.100.5.18) port 8080 (#0)\n> GET /echo HTTP/1.1\n> Host: dest-svc:8080\n> User-Agent: curl/7.72.0-DEV\n> Accept: */*\n> x-demo-1:demo-1\n> x-demo-2:demo-2\n> x-demo-3:demo-3\n>\n* Mark bundle as not supporting multiuse\n< HTTP/1.1 200 OK\n< Server: nginx/1.19.0\n< Date: Wed, 23 Sep 2020 23:51:31 GMT\n< Content-Type: text/plain\n< Content-Length: 20\n< Connection: keep-alive\n< X-Mesh-Request-ID: 45d9b1ffc53bde6aa5478a0d688894d5\n<\n{ [20 bytes data]\n* Connection #0 to host dest-svc left intact\ndestination service\n```\n\n----------------------------------------\n\nTITLE: Send Multiple Requests to Coffee Endpoint - Shell\nDESCRIPTION: This snippet uses a for loop in shell to send multiple requests to the coffee endpoint.  The purpose is to test the rate limiting configuration by exceeding the set limit. It's expected that requests will be spaced apart due to rate limiting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\nfor i in `seq 1 10`; do curl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee; done\n```\n\n----------------------------------------\n\nTITLE: Create Nginx yum repository file\nDESCRIPTION: This command opens the nginx.repo file in the /etc/yum.repos.d/ directory using the vi text editor, allowing users to configure the yum repository for Nginx. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo vi /etc/yum.repos.d/nginx.repo\n```\n\n----------------------------------------\n\nTITLE: Send a request to tea app using curl\nDESCRIPTION: This command sends an HTTP request to the tea application through NGINX Gateway Fabric using `curl`. The `--resolve` flag maps `cafe.example.com` to the specified IP address and port. The command uses shell variables `$GW_PORT` and `$GW_IP` for the port and IP address of the gateway.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_4\n\nLANGUAGE: Shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/tea\n```\n\n----------------------------------------\n\nTITLE: Verify the gRPC server is running\nDESCRIPTION: Command to confirm that the server is active and listening on port 50051 using the `netstat` utility. This command checks for established connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/services/publish-gRPC-proxy.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnetstat -tulpn | grep 50051\n```\n\n----------------------------------------\n\nTITLE: API Proxy Response Example (bash)\nDESCRIPTION: This is an example response from the Echo Server after a successful API proxy request. It shows the headers and the body of the received request, verifying that the proxy is correctly forwarding requests to the backend service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/enable-metrics.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nRequest served by echo-host\n\nHTTP/1.0 POST /my/test/api\n\nHost: 192.0.2.4\nAccept: */*\nCache-Control: no-cache\nContent-Length: 30\nContent-Type: application/json\nX-Correlation-Id: c241b72519e71cf7bce9262910ffbe40\nX-Real-Ip: 192.0.2.1\nX-NGINX-Test: true\n\n{\"testKey\": \"testValue\"}\n```\n\n----------------------------------------\n\nTITLE: Nginx match block for POP3 quit command\nDESCRIPTION: This snippet shows a `match` block configuration that sends a `QUIT` command to the server.  The health check will pass if the connection is established successfully and the command is sent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/tcp-health-check.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nmatch pop_quit {\n    send QUIT;\n}\n```\n\n----------------------------------------\n\nTITLE: Generating a Self-Signed Certificate OpenSSL\nDESCRIPTION: This snippet generates a private-public key pair and a self-signed server certificate in PEM format using OpenSSL. It encrypts the private key and sets the validity period of the certificate. The `-des3` option encrypts the private key using DES3 algorithm. The `-days` parameter sets the validity period.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl genrsa -des3 -out ~/private-key.pem 2048\nGenerating RSA private key  ...\nEnter pass phrase for private-key.pem:\n```\n\n----------------------------------------\n\nTITLE: Get OpenID Connect Discovery URL with curl\nDESCRIPTION: This command retrieves the OpenID Connect configuration metadata from the AD FS server using curl. The jq command is used to format the JSON output for easier readability.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/active-directory-federation-services.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\ncurl https://adfs-server-address/adfs/.well-known/openid-configuration | jq .\n```\n\n----------------------------------------\n\nTITLE: Create Nginx JWT License Directory - Shell\nDESCRIPTION: This shell command creates the /etc/nginx/ directory if it does not already exist. The -p option ensures that parent directories are also created as needed. This directory is typically used to store JWT license files for Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/create-dir-for-jwt.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/nginx/\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX App Protect WAF v5 Repository (Shell)\nDESCRIPTION: This command adds the NGINX App Protect WAF v5 repository to the system's package sources. It constructs a deb line with the repository URL, distribution codename and repository name and pipes it to the tee command to write it to the nginx-app-protect.list file. Requires sudo privileges to modify the /etc/apt/sources.list.d directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-ubuntu.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\nhttps://pkgs.nginx.com/app-protect-x-oss/ubuntu `lsb_release -cs` nginx-plus\\n\" | \\\nsudo tee /etc/apt/sources.list.d/nginx-app-protect.list\n```\n\n----------------------------------------\n\nTITLE: Referencing Match Block in Health Check - NGINX\nDESCRIPTION: References the `udp_test` match block in the `health_check` directive using the `match` parameter. This associates the custom health check tests defined in the `udp_test` block with the upstream server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/udp-health-check.md#_snippet_7\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n    #...\n    server {\n        listen       53 udp;\n        proxy_pass   dns_upstream;\n        health_check match=udp_test udp;\n    }\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstall Helm Release\nDESCRIPTION: This command uninstalls a specific Helm release from the Kubernetes cluster. Replace `<release-name>` with the actual name of the release to be uninstalled. This action removes all resources deployed by the Helm chart associated with the given release name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-helm.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nhelm uninstall <release-name>\n```\n\n----------------------------------------\n\nTITLE: Active Directory Connection URI (LDAP)\nDESCRIPTION: This code snippet presents an example of a connection URI for establishing an unencrypted LDAP connection to an Active Directory server. It's crucial to understand the security implications of using unencrypted connections, especially in production environments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/platform/access-management/manage-active-directory-auth-provider.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\nldap://dc1.mydomain.com\n```\n\n----------------------------------------\n\nTITLE: Get Keycloak Configuration\nDESCRIPTION: This command retrieves the Keycloak server's OpenID Connect configuration, including endpoint URLs for authorization, token retrieval, and token introspection. The output is formatted using `jq` for readability. Requires `curl` and `jq` to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\ncurl -L -X GET http://{HOST/IP_ADDRESS}:{PORT}/realms/{REALM}/.well-known/openid-configuration\n```\n\n----------------------------------------\n\nTITLE: Update and install module (Amazon Linux 2023, AlmaLinux, Rocky Linux)\nDESCRIPTION: Updates the package index and installs a specified NGINX module using dnf.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_27\n\nLANGUAGE: Shell\nCODE:\n```\ndnf update\ndnf install <MODULE-NAME>\n```\n\n----------------------------------------\n\nTITLE: Nginx Policy Configuration Example\nDESCRIPTION: This shell code represents an example Nginx policy configuration. It serves as a demonstration of policy override rules based on matching conditions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/first-match-principle.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\n{\n  \"policy\": {\n    \"name\": \"override_rules_example2\",\n    \"template\": {\n      \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"override-rules\": [\n      {\n        \"name\": \"this_rule_will_match\",\n        \"condition\": \"uri.contains('api')\",\n        \"actionType\": \"replace-policy\",\n        \"override\": {\n          \"$ref\": \"file:///NginxStrictPolicy.json\"\n        }\n      },\n      {\n        \"name\": \"non_matching_rule\",\n        \"condition\": \"uri.contains('api') and not clientIp == '192.168.0.10'\",\n        \"actionType\": \"extend-policy\",\n        \"override\": {\n          \"policy\": {\n            \"enforcementMode\": \"transparent\"\n          }\n        }\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Configure NGINX Mainline Repository\nDESCRIPTION: This snippet configures the NGINX mainline repository on CentOS. It defines the repository name, base URL, GPG key, and enables the repository for package installation. This configuration is placed in the `/etc/yum.repos.d/nginx.repo` file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-centos.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\n[nginx-mainline]\nname=nginx mainline repo\nbaseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n```\n\n----------------------------------------\n\nTITLE: Download NGINX Plus and njs Dependencies\nDESCRIPTION: This command executes the `fetch-external-acm-dataplane-dependencies.sh` script to download necessary NGINX Plus and njs packages. It requires specifying the Linux distribution and the locations of the `nginx-repo.crt` and `nginx-repo.key` files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/install-acm-offline.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nsudo bash fetch-external-acm-dataplane-dependencies.sh <linux distribution> /etc/ssl/nginx/nginx-repo.crt /etc/ssl/nginx/nginx-repo.key\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Developer Portal (Deb-Based) - Bash\nDESCRIPTION: Upgrades the NGINX Developer Portal and UI packages on Debian-based systems (Ubuntu) using `apt-get install -f`.  The `-f` option is used to fix broken dependencies if necessary during the upgrade.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-devportal-offline.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get -y install -f /home/user/nginx-devportal_<version>_amd64.deb\nsudo apt-get -y install -f /home/user/nginx-devportal-ui_<version>_amd64.deb\n```\n\n----------------------------------------\n\nTITLE: Retrieve Security Policy UID via REST API using GET\nDESCRIPTION: This snippet shows how to retrieve the unique identifier (UID) of a security policy using a `GET` request to the NGINX Instance Manager REST API. This UID is required for updating or deleting a specific policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_5\n\nLANGUAGE: Shell\nCODE:\n```\ncurl -X GET https://{{NIM_FQDN}}/api/platform/v1/security/policies \\\n    -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Test Nginx Configuration\nDESCRIPTION: This command tests the Nginx configuration file (/etc/nginx/nginx.conf) for syntax errors.  It ensures that the configuration is valid before reloading or restarting Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_5\n\nLANGUAGE: none\nCODE:\n```\n$ sudo nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n```\n\n----------------------------------------\n\nTITLE: Query a Single Event by UUID (curl)\nDESCRIPTION: This example demonstrates querying a single event using its UUID.  It uses a GET request to the `/api/platform/v1/analytics/events/{uuid}` endpoint. Replace `<NMS_FQDN>`, `<access token>`, and the event UUID accordingly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"https://<NMS_FQDN>/api/platform/v1/analytics/events/7cb91de6-49ae-4ddc-a8b3-3255e00b9346\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Moving NGINX Signing Key on Alpine\nDESCRIPTION: This command moves the downloaded NGINX signing key to the apk trusted keys storage directory. This allows apk to use the key to verify the authenticity of NGINX packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_42\n\nLANGUAGE: shell\nCODE:\n```\nsudo mv /tmp/nginx_signing.rsa.pub /etc/apk/keys/\n```\n\n----------------------------------------\n\nTITLE: Define Ping Identity OIDC Provider (Nginx)\nDESCRIPTION: This snippet defines the Ping Identity OIDC provider named `ping` within the `http` context.  It includes the `issuer`, `client_id`, and `client_secret` directives, which are obtained from the PingOne or PingFederate configuration. Replace placeholders with actual values.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/ping-identity.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    resolver 10.0.0.1 ipv4=on valid=300s;\n\n    oidc_provider ping {\n        issuer        https://auth.pingone.com/<environment_id>/as;\n        client_id     <client_id>;\n        client_secret <client_secret>;\n    }\n\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Upstream Peer Count Metric\nDESCRIPTION: Describes the 'plus.upstream.peer.count' metric, which is a gauge representing the current number of live upstream servers in an upstream group. It provides real-time information about the number of available upstream servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_4\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, integer\nDescription: Current number of live (\"up\") upstream servers in an upstream group. If\n               graphed/monitored without specifying an upstream, it's the current\n               number of all live upstream servers in all upstream groups.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: EC Private Key Example\nDESCRIPTION: This snippet shows the format for ECDSA private keys in PEM format. The PEM headers should contain -----BEGIN EC PRIVATE KEY----- and -----END EC PRIVATE KEY-----, with the base64 encoded key between them. This ensures the NGINX One Console can correctly parse and use the key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx-one/how-to/certificates/manage-certificates.md#_snippet_0\n\nLANGUAGE: plaintext\nCODE:\n```\n-----BEGIN EC PRIVATE KEY-----\\n<BASE64 ENCODED KEY>\\n-----END EC PRIVATE KEY-----\n```\n\n----------------------------------------\n\nTITLE: Example OpenShift Network Policies Output\nDESCRIPTION: This output shows an example of the NetworkPolicy resources deployed in the `nms` namespace within an OpenShift cluster. Each entry describes a specific policy targeting a component of NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_17\n\nLANGUAGE: text\nCODE:\n```\nNAME           POD-SELECTOR                          AGE\napigw          app.kubernetes.io/name=apigw          4m47s\nclickhouse     app.kubernetes.io/name=clickhouse     4m47s\ncore           app.kubernetes.io/name=core           4m47s\ndpm            app.kubernetes.io/name=dpm            4m47s\ningestion      app.kubernetes.io/name=ingestion      4m47s\nintegrations   app.kubernetes.io/name=integrations   4m47s\nsecmon         app.kubernetes.io/name=secmon         4m47s\nutility        app.kubernetes.io/name=integrations   4m47s\n```\n\n----------------------------------------\n\nTITLE: Mermaid Diagram Example\nDESCRIPTION: This is a placeholder for a Mermaid diagram, used to visually represent a concept or process. The diagram should be placed within a code block with the 'mermaid' language specified. Refer to the Mermaid documentation (https://mermaid.js.org/intro/) for syntax and usage.\nSOURCE: https://github.com/nginx/documentation/blob/main/archetypes/concept.md#_snippet_0\n\nLANGUAGE: mermaid\nCODE:\n```\n# You can use Mermaid to draw diagrams in a codeblock with mermaid as the language.\n# Read their documentation for usage: https://mermaid.js.org/intro/\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Warning Message During NGINX Controller Installation\nDESCRIPTION: This snippet shows the Kubernetes warning message displayed during NGINX Controller installation on RHEL 8.  The warning relates to deprecated flags used by kubectl. The documentation states that this message can be safely ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.2.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\nW0304 00:13:38.871876 1594252 helpers.go:553] --dry-run is deprecated and can be replaced with --dry-run=client.\n```\n\n----------------------------------------\n\nTITLE: Configuring Security Logging to File in NGINX\nDESCRIPTION: This snippet demonstrates configuring the security log destination to a file using the `app_protect_dos_security_log` directive. This directive specifies the configuration file path and the absolute file path for security events.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/directives-and-policy/learn-about-directives-and-policy.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_dos_security_log \"/etc/app_protect_dos/log-default.json\" /shared/logger.log;\n```\n\n----------------------------------------\n\nTITLE: Updating NginxProxy Configuration using kubectl\nDESCRIPTION: This command opens the NginxProxy resource named 'ngf-proxy-config' in your default editor, allowing you to modify its configuration. Changes made and saved to the configuration are automatically applied to the NGINX data plane.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/data-plane-configuration.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nkubectl edit nginxproxies ngf-proxy-config\n```\n\n----------------------------------------\n\nTITLE: Download dependencies.repo File (Shell)\nDESCRIPTION: Downloads the `dependencies.repo` file from the specified URL using `wget` and saves it to the `/etc/yum.repos.d` directory. Requires `sudo` privileges and `wget` to be installed. The `-P` option specifies the destination directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-amazon.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.amazonlinux2023.repo\n```\n\n----------------------------------------\n\nTITLE: Launching GDB Debugger\nDESCRIPTION: This command launches the GDB debugger and attaches it to the specified Nginx worker process, allowing you to inspect the process's state and extract debug information.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nsudo gdb -p <nginx PID obtained at the previous step>\n```\n\n----------------------------------------\n\nTITLE: Restart Nginx Service (Linux Bash)\nDESCRIPTION: Restarts the Nginx service on a Linux system. This command is used as a workaround for statistics not updating correctly after upgrading to NGINX Controller 3.8.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_25\n\nLANGUAGE: bash\nCODE:\n```\nservice nginx restart\n```\n\n----------------------------------------\n\nTITLE: Create ClusterRoleBinding for Nginx Mesh PSP\nDESCRIPTION: Creates a ClusterRoleBinding `nginx-mesh-psp-binding` that binds the `nginx-mesh-psp-role` to the `system:serviceaccounts:nginx-mesh` group, which corresponds to the default Nginx Service Mesh control plane namespace. This allows the control plane service accounts to use the specified Pod Security Policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/rke.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: nginx-mesh-psp-binding\nroleRef:\n  kind: ClusterRole\n  name: nginx-mesh-psp-role\n  apiGroup: rbac.authorization.k8s.io\nsubjects:\n- kind: Group\n  apiGroup: rbac.authorization.k8s.io\n  name: system:serviceaccounts:nginx-mesh\n```\n\n----------------------------------------\n\nTITLE: Upgrade Developer Portal (CentOS, RHEL, RPM-based)\nDESCRIPTION: Upgrades the `nginx-devportal` and `nginx-devportal-ui` packages on CentOS, RHEL, or RPM-based systems using `yum update`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum update -y nginx-devportal nginx-devportal-ui\n```\n\n----------------------------------------\n\nTITLE: Disabling Nginx Error Logs\nDESCRIPTION: This configuration snippet shows how to completely disable error logging in Nginx by directing the error log output to `/dev/null`. This prevents any error messages from being written to a log file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginxaas-azure/logging-config-error-logs.md#_snippet_1\n\nLANGUAGE: nginx\nCODE:\n```\nerror_log /dev/null;\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Certificate Error Message (bash)\nDESCRIPTION: This is an example of an error message that may occur during an NGINX Controller update if the Kubernetes Certificate Authority (CA) certificate does not have the proper permissions. It indicates a permission denied error when attempting to open the certificate file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_20\n\nLANGUAGE: bash\nCODE:\n```\nError opening Certificate /etc/kubernetes/pki/ca.crt\n139998249641872:error:0200100D:system library:fopen:Permission denied:bss_file.c:402:fopen('/etc/kubernetes/pki/ca.crt','r')\n139998249641872:error:20074002:BIO routines:FILE_CTRL:system lib:bss_file.c:404:\nunable to load certificate\nError: Kubernetes control plane is not ready after updating cloud provider configuration\n```\n\n----------------------------------------\n\nTITLE: Change Directory\nDESCRIPTION: This command changes the current directory in the shell to the specified directory where the downloaded Docker image is located. Replace `<directory name>` with the actual directory path.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/deploy-api-connectivity-manager.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ncd <directory name>\n```\n\n----------------------------------------\n\nTITLE: Set Custom Credential File Secret (YAML)\nDESCRIPTION: Configures a Docker secret to use a custom .htpasswd file for authentication. The `file` parameter indicates the location of the credential file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/docker/deploy-nginx-instance-manager-docker-compose.md#_snippet_6\n\nLANGUAGE: yaml\nCODE:\n```\n  nim_credential_file:\n    file: nim_creds.txt\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Agent using yum on RHEL\nDESCRIPTION: This command installs the Nginx Agent package using the yum package manager on RHEL-based systems.  It utilizes the configured repository to retrieve and install the agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Starting kubelet service\nDESCRIPTION: This command starts the kubelet service after manually setting the system time.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_22\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start kubelet\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Amplify Agent Repository Config (Ubuntu/Debian - Bash)\nDESCRIPTION: Verifies the contents of the repository configuration file for NGINX Amplify Agent.  It uses the `cat` command to display the contents of `/etc/apt/sources.list.d/nginx-amplify.list`. This snippet serves as an example of the expected output from the previous repository config.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\ncat /etc/apt/sources.list.d/nginx-amplify.list\ndeb https://packages.amplify.nginx.com/py3/ubuntu jammy amplify-agent\n```\n\n----------------------------------------\n\nTITLE: Stream Disallowed Driver Logs\nDESCRIPTION: This command streams the logs from the newly deployed 'disallowed' driver, allowing observation of request activity and any resulting errors (e.g., 403 Forbidden).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nkubectl logs -l app=driver-disallowed -f -c driver\n```\n\n----------------------------------------\n\nTITLE: Installing Prerequisite Packages on Alpine Linux\nDESCRIPTION: This command installs the `openssl` and `ca-certificates` packages, which are required for secure communication and certificate validation when accessing the NGINX repository. The `apk add` command is the package manager for Alpine Linux. These packages are essential for verifying the authenticity of the NGINX repository and downloaded packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/common-steps-with-alpine.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo apk add openssl ca-certificates\n```\n\n----------------------------------------\n\nTITLE: Load Nginx JavaScript Module\nDESCRIPTION: This directive loads the NGINX JavaScript module in the top-level (\"main\") configuration context within the /etc/nginx/nginx.conf file. It enables the use of njs scripting within the Nginx configuration.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/cognito.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\n```\n\n----------------------------------------\n\nTITLE: Send a request to coffee app using curl\nDESCRIPTION: This command sends an HTTP request to the coffee application through NGINX Gateway Fabric using `curl`. The `--resolve` flag maps `cafe.example.com` to the specified IP address and port. The command uses shell variables `$GW_PORT` and `$GW_IP` for the port and IP address of the gateway.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/snippets.md#_snippet_3\n\nLANGUAGE: Shell\nCODE:\n```\ncurl --resolve cafe.example.com:$GW_PORT:$GW_IP http://cafe.example.com:$GW_PORT/coffee\n```\n\n----------------------------------------\n\nTITLE: Testing NGINX Configuration\nDESCRIPTION: This shell command tests the Nginx configuration file for syntax errors. It is used to verify that the configuration file is valid before reloading Nginx. Requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/http-substitutions-filter.md#_snippet_6\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Including Configuration Files in Nginx\nDESCRIPTION: This Nginx configuration block includes either the basic or enhanced Node.js configuration file within the `http` block of the main `nginx.conf` file. It allows Nginx to load the specific configuration for load balancing Node.js applications. The `include` directive references files in the `conf.d` directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/node-js.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    include conf.d/nodejs-(basic|enhanced).conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Stop NGINX Controller using helper script\nDESCRIPTION: This command is used to stop the NGINX Controller services using the provided helper script. It's a part of the workaround to restore functionality after a failed upgrade.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh controller stop\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Open Source on RHEL/CentOS\nDESCRIPTION: This command installs the Nginx Open Source package from the configured yum repositories. It assumes that the EPEL repository has been enabled if installing from the OS repository. Requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install nginx\n```\n\n----------------------------------------\n\nTITLE: Text Output Example\nDESCRIPTION: This code snippet is used alongside a shell command example to illustrate the expected output. It is important to truncate unnecessary output and change IPs or domains for security and clarity.\nSOURCE: https://github.com/nginx/documentation/blob/main/archetypes/tutorial.md#_snippet_2\n\nLANGUAGE: text\nCODE:\n```\n# A second code block is used underneath the first to show what kind of example output to expect from the command. Truncate unnecessary output with ellipses (...).\n```\n\n----------------------------------------\n\nTITLE: Resetting iptables Rules\nDESCRIPTION: This command flushes all iptables rules, effectively returning the NGINX Plus Load Balancer instance to its normal working state after simulating a failure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\niptables -F\n```\n\n----------------------------------------\n\nTITLE: Terraform Destroy Deployment\nDESCRIPTION: This snippet destroys a Terraform deployment, removing all resources associated with the NGINXaaS configuration on Azure. The `--auto-approve` flag automatically approves the destruction plan.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configurations-terraform.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nterraform destroy --auto-approve\n```\n\n----------------------------------------\n\nTITLE: Copy license.jwt on FreeBSD\nDESCRIPTION: This command copies the license.jwt file to the /usr/local/etc/nginx directory.  This file is required for NGINX Plus to function correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_16\n\nLANGUAGE: Shell\nCODE:\n```\nsudo cp license.jwt /usr/local/etc/nginx\n```\n\n----------------------------------------\n\nTITLE: SNI Compatibility Warning - Text\nDESCRIPTION: This is a warning message that NGINX displays if it was built with SNI support but is dynamically linked to an OpenSSL library without TLS extension support, making SNI unavailable. This indicates a runtime dependency issue.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-http.md#_snippet_14\n\nLANGUAGE: none\nCODE:\n```\nNGINX was built with SNI support, however, now it is linked\ndynamically to an OpenSSL library which has no tlsext support,\ntherefore SNI is not available\n```\n\n----------------------------------------\n\nTITLE: Install OpenTracing Module on Alpine\nDESCRIPTION: This shell script installs the `nginx-plus-module-opentracing` package using apk. This enables the OpenTracing module within Nginx Plus. It is compatible with Alpine Linux.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentracing.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-opentracing\n```\n\n----------------------------------------\n\nTITLE: Disabling request body and setting Content-Length\nDESCRIPTION: This configuration snippet disables the request body for the authentication subrequest using `proxy_pass_request_body off`. It also sets the `Content-Length` header to an empty string. This is required because the request body is discarded for authentication subrequests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-subrequest-authentication.md#_snippet_3\n\nLANGUAGE: nginx\nCODE:\n```\nlocation = /auth {\n    internal;\n    proxy_pass              http://auth-server;\n    proxy_pass_request_body off;\n    proxy_set_header        Content-Length \"\";\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Updating and Installing Packages on FreeBSD (Shell)\nDESCRIPTION: This command updates the package repositories and installs the `ca_root_nss` package on FreeBSD systems. This package provides the root certificates needed to verify SSL/TLS connections.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update  && \\\nsudo pkg install ca_root_nss\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect WAF Logging Directive\nDESCRIPTION: This Nginx configuration snippet enables the NGINX App Protect security log and directs output to a syslog server.  This value should not be changed if using Security Monitoring.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_22\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log \"/etc/nms/secops_dashboard.tgz\" syslog:server=127.0.0.1:514;\n```\n\n----------------------------------------\n\nTITLE: Updating Trusted Certificates on RHEL/CentOS\nDESCRIPTION: This command updates the system's trusted certificates on RHEL or CentOS systems. It requires sudo privileges and updates the trust store based on the contents of /etc/pki/ca-trust.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/system-configuration/trust-proxy-ca-certificates.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo update-ca-trust\n```\n\n----------------------------------------\n\nTITLE: Install dependencies and set up ClickHouse repository (Debian, Ubuntu)\nDESCRIPTION: Installs required dependencies and sets up the ClickHouse repository on Debian and Ubuntu systems.  This involves installing apt-transport-https, ca-certificates, dirmngr, adding the ClickHouse key, and adding the repository to the apt sources list.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get install -y apt-transport-https ca-certificates dirmngr\nGNUPGHOME=$(mktemp -d)\nsudo GNUPGHOME=\"$GNUPGHOME\" gpg --no-default-keyring --keyring /usr/share/keyrings/clickhouse-keyring.gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 8919F6BD2B48D754\nsudo rm -r \"$GNUPGHOME\"\nsudo chmod +r /usr/share/keyrings/clickhouse-keyring.gpg\n\necho \"deb [signed-by=/usr/share/keyrings/clickhouse-keyring.gpg] https://packages.clickhouse.com/deb lts main\" | sudo tee /etc/apt/sources.list.d/clickhouse.list\nsudo apt-get update\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Plus OpenTelemetry Module on FreeBSD (Shell)\nDESCRIPTION: This command updates the package repositories and installs the `nginx-plus-module-otel` package on FreeBSD systems. This installs the OpenTelemetry module for NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update  && \\\nsudo pkg install nginx-plus-module-otel\n```\n\n----------------------------------------\n\nTITLE: Querying Request Outcome Metrics with REST API (curl)\nDESCRIPTION: This query retrieves metrics for requests that App Security has either rejected or allowed. It uses the `http.request.count` metric and groups the results by `request_outcome`, providing insights into the overall effectiveness of the App Security module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/analytics/view-app-security-analytics.md#_snippet_0\n\nLANGUAGE: curl\nCODE:\n```\nhttps://{{host}}/api/v1/analytics/metrics?\n    startTime=0&\n    endTime=now&\n    names=sum(http.request.count)&\n    groupBy=request_outcome&\n    resolution=30m\n```\n\n----------------------------------------\n\nTITLE: Workaround for Peer Count Alert Configuration\nDESCRIPTION: This workaround addresses an issue where the peer count alert needs to be configured with a multiplier of the reporting period. The `plus.upstream.peer.count` metric reports the total number of healthy upstream hosts, and the alert incorrectly uses a `SUM` aggregation method.  The threshold value must be configured with a multiplier of the number of minutes in the reporting period.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_0\n\n\n\n----------------------------------------\n\nTITLE: Login to NGINX Controller API\nDESCRIPTION: Logs in to the NGINX Controller REST API using `curl` to obtain a session cookie for subsequent authenticated requests. Requires a valid username, password, and the target Controller's IP address. The cookie is saved to `cookie.txt`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller-app-sec.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncurl -c cookie.txt -X POST --url 'https://<ip address>/api/v1/platform/login' --header 'Content-Type: application/json' --data '{\"credentials\": {\"type\": \"BASIC\",\"username\": \"<username>\",\"password\": \"<password>\"}}'\n```\n\n----------------------------------------\n\nTITLE: Combined Configuration: Connection and Bandwidth Limiting in NGINX\nDESCRIPTION: This example shows a combined configuration for limiting both the number of connections and the bandwidth. It allows a maximum of 5 connections per client IP globally and limits the `/download/` location to 1 connection, applying a rate limit of 50k after 1MB has been transferred.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-proxied-http.md#_snippet_12\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    limit_conn_zone $binary_remote_address zone=addr:10m;\n\n    server {\n        root /www/data;\n        limit_conn addr 5;\n\n        location / {\n        }\n\n        location /download/ {\n            limit_conn       addr 1;\n            limit_rate_after 1m;\n            limit_rate       50k;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: List Installed Packages (Alpine Linux)\nDESCRIPTION: Lists installed Nginx and App Protect packages on Alpine Linux systems. The output is saved to a text file for documentation when opening a support ticket.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/troubleshooting-guide/troubleshooting.md#_snippet_4\n\nLANGUAGE: Shell\nCODE:\n```\napk info -vv | grep -E 'nginx|app-protect' > package_versions.txt\n```\n\n----------------------------------------\n\nTITLE: Verify Nginx signing key on Debian\nDESCRIPTION: This command verifies the integrity of the Nginx signing key that was downloaded, by checking its fingerprint. It confirms that the key is the correct one before adding the Nginx repository on Debian.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-oss.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\ngpg --dry-run --quiet --no-keyring \\\n  --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg\n```\n\n----------------------------------------\n\nTITLE: Renaming the Default NGINX Configuration File\nDESCRIPTION: This shell command renames the default Nginx configuration file (default.conf) to default.conf.bak. This prevents Nginx from loading the default configuration, allowing a custom configuration to be used instead.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/route-53-global-server-load-balancing.md#_snippet_7\n\nLANGUAGE: Shell\nCODE:\n```\nmv default.conf default.conf.bak\n```\n\n----------------------------------------\n\nTITLE: Configuring a Location Block with a Regular Expression\nDESCRIPTION: This snippet demonstrates how to configure a `location` block with a regular expression for case-insensitive matching of URIs containing .html or .htm.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/web-server/web-server.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nlocation ~* \\.html? {\n    #...\n}\n```\n\n----------------------------------------\n\nTITLE: Creating a basic NginxProxy Configuration (LogLevel)\nDESCRIPTION: This command creates a basic NginxProxy configuration that sets the data plane log level to `warn` using `kubectl apply`. This can be used to increase or decrease the verbosity of the NGINX data plane logs.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/data-plane-configuration.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: gateway.nginx.org/v1alpha1\nkind: NginxProxy\nmetadata:\n  name: ngf-proxy-config\nspec:\n  logging:\n    errorLevel: warn\nEOF\n```\n\n----------------------------------------\n\nTITLE: Example Output of cat (MASTER)\nDESCRIPTION: Example output of the `cat` command showing the node is in MASTER state.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\nSTATE=MASTER\n```\n\n----------------------------------------\n\nTITLE: Adding Nginx Open Source Repository (Shell)\nDESCRIPTION: Adds the official Nginx Open Source repository to the system's APT sources. This allows the system to install and update Nginx packages directly from Nginx.org. The command constructs the repository URL, signing information, and distribution name, and then appends it to the Nginx APT source list file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-debian.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\necho \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\\nhttp://nginx.org/packages/mainline/debian `lsb_release -cs` nginx\" | \\\nsudo tee /etc/apt/sources.list.d/nginx.list\n```\n\n----------------------------------------\n\nTITLE: Restore NGINX Controller Cluster Configuration Bash\nDESCRIPTION: This command restores the NGINX Controller cluster configuration and encryption keys from a specified backup file. The `<filename>` argument represents the path to the backup file. It relies on the `helper.sh` script located in `/opt/nginx-controller/`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-cluster-config.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh cluster-config load <filename>\n```\n\n----------------------------------------\n\nTITLE: Stream Upstream Peers Metric\nDESCRIPTION: Describes the 'plus.stream.upstream.peers' metric, which is a gauge representing the current number of live (\"up\") upstream servers in an upstream group. This reflects the availability of upstream stream servers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_23\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, integer\nDescription: Current number of live (\"up\") upstream servers in an upstream group.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Getting a backtrace with GDB\nDESCRIPTION: Executes the `backtrace` command within the GDB debugger to obtain a stack trace from the core dump file.  The stack trace provides information about the function calls leading to the crash.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_26\n\nLANGUAGE: nginx\nCODE:\n```\n(gdb) backtrace\n```\n\n----------------------------------------\n\nTITLE: Forbidden Response - JSON\nDESCRIPTION: This snippet represents the JSON response expected when accessing the API endpoint with an inactive or invalid access token. The server returns a 403 Forbidden status code.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_29\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"message\": \"Forbidden\",\n    \"status\": \"403\"\n}\n```\n\n----------------------------------------\n\nTITLE: Cyclic Override Rule Error Message (JSON)\nDESCRIPTION: This JSON snippet shows the error message that will be displayed when a cyclic override rule is detected. This occurs when an inline or externally referenced policy contains an override rule that refers back to itself.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/override-rules-errors-warnings.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"error_message\": \"Failed to import an override policy: Cyclic override-rules detected.\"\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring SSL Environment (FreeBSD)\nDESCRIPTION: Adds lines to /usr/local/etc/pkg.conf to configure SSL settings. Specifically, it disables peer verification and defines the paths to the client certificate and key files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_37\n\nLANGUAGE: none\nCODE:\n```\nPKG_ENV: { SSL_NO_VERIFY_PEER: \"1\",\nSSL_CLIENT_CERT_FILE: \"/etc/ssl/nginx/nginx-repo.crt\",\nSSL_CLIENT_KEY_FILE: \"/etc/ssl/nginx/nginx-repo.key\" }\n```\n\n----------------------------------------\n\nTITLE: Changing Directory to Scripts - Shell\nDESCRIPTION: This command changes the current directory to `/etc/nms/scripts` using the `cd` command. This directory contains the backup and restore scripts for NGINX Management Suite.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ncd /etc/nms/scripts\n```\n\n----------------------------------------\n\nTITLE: Check ClickHouse server status (Debian, Ubuntu)\nDESCRIPTION: Checks the status of the ClickHouse server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl status clickhouse-server\n```\n\n----------------------------------------\n\nTITLE: Testing nginx-meshctl installation on Windows\nDESCRIPTION: This command runs the nginx-meshctl command without any arguments, verifying that it is correctly installed and accessible from the terminal. It expects the command to output help information or an error message indicating missing arguments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/install.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl\n```\n\n----------------------------------------\n\nTITLE: Generating User Defined Signatures JSON (Default Tag)\nDESCRIPTION: Generates a JSON file from a User Defined Signatures XML file, using the default tag.  It uses the `-i` and `-o` switches to specify the input XML file and the output JSON file, and pipes the output to `jq` for formatting.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/convert-signatures -i /path/to/signatures.xml -o /path/to/signatures.json | jq\n```\n\n----------------------------------------\n\nTITLE: Adding NGINX App Protect WAF v5 repository on Ubuntu\nDESCRIPTION: This snippet adds the NGINX App Protect WAF v5 repository to the apt sources list on Ubuntu. It uses printf and tee to write the repository configuration to a new file in the sources.list.d directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_32\n\nLANGUAGE: shell\nCODE:\n```\nprintf \"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect-x-plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-app-protect.list\n```\n\n----------------------------------------\n\nTITLE: Start NGINX Instance Manager\nDESCRIPTION: This command starts the NGINX Instance Manager service (`nms`). This command is run after configuration changes are made such as changing the secret storage method.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-vault.md#_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start nms\n```\n\n----------------------------------------\n\nTITLE: Stop leftover containers (workaround)\nDESCRIPTION: These commands stop specific Docker containers (clickhouse, stan-proxy, nats) related to NGINX Controller. It's a more targeted workaround compared to restarting the entire Docker service for resolving issues caused by leftover containers on a node with a stopped `kubelet`.  It uses `docker stop` combined with `docker container ls`, `grep`, and `awk` to identify and stop the relevant containers. Requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_7\n\nLANGUAGE: yaml\nCODE:\n```\n`sudo docker stop $(sudo docker container ls | grep \"k8s_clickhouse\" | awk '{print $1}')`\n`sudo docker stop $(sudo docker container ls | grep \"k8s_stan-proxy\" | awk '{print $1}')`\n`sudo docker stop $(sudo docker container ls | grep \"k8s_nats_nats\" | awk '{print $1}')`\n```\n\n----------------------------------------\n\nTITLE: NGINX Controller API Resource Properties JSON Example\nDESCRIPTION: This JSON snippet represents the structure of NGINX Controller API resources, containing `metadata`, `desiredState`, and `currentStatus` properties. The `desiredState` reflects the desired configuration, while `currentStatus` represents the current state of the system (read-only).\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/api/overview.md#_snippet_2\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"metadata\": {\n  },\n  \"desiredState\": {\n  },\n  \"currentStatus\": {\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Configuring Dqlite Persistent Volume Claim (PVC) - YAML\nDESCRIPTION: This YAML snippet shows an example configuration for a Dqlite persistent volume claim.  It defines the name, specifies that an existing claim is not being used, requests a size of 500Mi, and sets the access mode to ReadWriteOnce.  This is part of the broader configuration of API Connectivity Manager using Helm.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/deploy-api-connectivity-manager.md#_snippet_9\n\nLANGUAGE: yaml\nCODE:\n```\n  - name: dqlite\n    existingClaim:\n    size: 500Mi\n    accessMode: ReadWriteOnce\n```\n\n----------------------------------------\n\nTITLE: TrafficTarget YAML Configuration\nDESCRIPTION: This YAML configuration explicitly sets the destination and source namespaces in a TrafficTarget resource to avoid defaulting to the `default` namespace and applying access control to unexpected resources. It ensures that access control is applied to the intended resources within the specified namespaces.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.6.0.md#_snippet_3\n\nLANGUAGE: yaml\nCODE:\n```\nkind: TrafficTarget\nmetadata:\n  name: example-traffictarget\n  namespace: example-namespace\nspec:\n  destination:\n    kind: ServiceAccount\n    name: example-destination-sa\n    namespace: example-namespace\n  sources:\n  - kind: ServiceAccount\n    name: example-source-sa\n    namespace: example-namespace\n```\n\n----------------------------------------\n\nTITLE: Installing EPEL Release on Amazon Linux 2 LTS\nDESCRIPTION: This command installs the Extra Packages for Enterprise Linux (EPEL) repository on Amazon Linux 2 LTS. EPEL provides additional packages that are not available in the default repositories and is a prerequisite for installing the Brotli module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/brotli.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo amazon-linux-extras install epel -y\n```\n\n----------------------------------------\n\nTITLE: Display traffic statistics for a specific Deployment\nDESCRIPTION: This command displays traffic statistics for a specific Deployment named 'my-app'. It enables targeted monitoring and troubleshooting of individual deployments managed by the NGINX Service Mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_15\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl top deployments/my-app\n```\n\n----------------------------------------\n\nTITLE: Get Kubernetes pods and services (Bash)\nDESCRIPTION: This command retrieves a list of pods and services within the `legacy` namespace.  It's used to verify that the `target` application is running and that the pods are not injected with the sidecar proxy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nkubectl -n legacy get pods,svc\n\nNAME                               READY   STATUS    RESTARTS   AGE\npod/target-v1-0-5985d8544d-sgkxg   1/1     Running   0          12s\n\nNAME                  TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE\nservice/target-v1-0   ClusterIP   10.0.0.0       <none>        80/TCP    11s\n```\n\n----------------------------------------\n\nTITLE: Hugo Shortcode: Add Image\nDESCRIPTION: This snippet demonstrates how to use the `img` shortcode to add images to documentation pages.  The image file should be placed in the `/static/img` directory, and the `src` attribute should specify the relative path to the image without a leading forward slash.\nSOURCE: https://github.com/nginx/documentation/blob/main/CONTRIBUTING_DOCS.md#_snippet_7\n\nLANGUAGE: Markdown\nCODE:\n```\n{{< img src=\"<img-file.png>\" alt=\"<Alternative text>\">}}\n```\n\n----------------------------------------\n\nTITLE: Checking NGINX App Protect Version\nDESCRIPTION: This snippet provides a command to check the 'build' version of NGINX App Protect. This helps verify that the upgrade was successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/admin-guide/upgrade-nap-waf.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nsudo more /etc/nms/app_protect_metadata.json\n```\n\n----------------------------------------\n\nTITLE: Apply Kubernetes manifest (Bash)\nDESCRIPTION: This command applies a Kubernetes manifest file (`target-v1.0.yaml`) to create the `target` application within the `legacy` namespace.  The `target` application is a basic NGINX server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/egress-walkthrough.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nkubectl -n legacy apply -f target-v1.0.yaml\n```\n\n----------------------------------------\n\nTITLE: Make Script Executable (Shell)\nDESCRIPTION: Makes the k8s-restore.sh script executable. This is required before the script can be run.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\nchmod +x k8s-restore.sh\n```\n\n----------------------------------------\n\nTITLE: Running the onboarding command to add the Developer Cluster\nDESCRIPTION: Command to run the onboarding process to add the Developer Cluster to the NGINX Management Suite. Replace `<NMS-FQDN>` with the fully qualified domain name of your NGINX Management Suite, and `<cluster>` with the name of the Developer Cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\ncurl -k https://<NMS-FQDN>/install/nginx-agent > install.sh && sudo sh install.sh -g <cluster> -m precompiled-publication --nap-monitoring true && sudo systemctl start nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Request to Echo Server with Query Parameter - Bash\nDESCRIPTION: This bash snippet demonstrates sending a request to the echo server with the access token embedded in the query parameter `queryAuthz`. It showcases how to format the request URI to include the access token in the specified query parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_36\n\nLANGUAGE: bash\nCODE:\n```\nPOST https://192.0.2.4/my/test/api?queryAuthz=<JWT_token>\n```\n\n----------------------------------------\n\nTITLE: Get Specific NGINX Statistics with Fields Argument\nDESCRIPTION: This snippet shows how to use the `fields` parameter in the curl request to filter the fields that are returned from the NGINX Plus API. It retrieves only the version and build information. It assumes API version 9 and depends on `curl` and `json_pp`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\ncurl -s 'https://demo.nginx.com/api/9/nginx?fields=version,build' | json_pp\n```\n\n----------------------------------------\n\nTITLE: Create Environment (ACM) - JSON\nDESCRIPTION: The JSON payload for creating an Environment in API Connectivity Manager.  `proxyClusterName` is the name of the Instance Group. The `hostnames` array should contain the hostname of the data plane host.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_15\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"name\": \"demo-env\",\n  \"proxies\": [\n    {\n      \"proxyClusterName\": \"test-ig\",\n      \"hostnames\": [\n        \"data-host\"\n      ]\n    }\n  ]\n}\n```\n\n----------------------------------------\n\nTITLE: Update Package Manager on RHEL/CentOS\nDESCRIPTION: This command updates the package manager's view of the NGINX Plus repository on Red Hat Enterprise Linux (RHEL) and CentOS systems. It clears the yum cache.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-installation-logging.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nsudo yum clean expire-cache\n```\n\n----------------------------------------\n\nTITLE: Verify NGINX Plus Version\nDESCRIPTION: Verifies the NGINX Plus version after an installation or upgrade.  It outputs the version of NGINX installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_62\n\nLANGUAGE: shell\nCODE:\n```\nnginx -v\n```\n\n----------------------------------------\n\nTITLE: Keepalived Log Entries Example (None)\nDESCRIPTION: Example log entries from Keepalived showing the startup process and state transitions. These logs are helpful for troubleshooting issues.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/ha-keepalived.md#_snippet_16\n\nLANGUAGE: none\nCODE:\n```\nFeb 27 14:42:04 centos7-1 systemd: Starting LVS and VRRP High Availability Monitor...\nFeb 27 14:42:04 Keepalived [19242]: Starting Keepalived v1.2.15 (02/26,2015)\nFeb 27 14:42:04 Keepalived [19243]: Starting VRRP child process, pid=19244\nFeb 27 14:42:04 Keepalived_vrrp [19244]: Registering Kernel netlink reflector\nFeb 27 14:42:04 Keepalived_vrrp [19244]: Registering Kernel netlink command channel\nFeb 27 14:42:04 Keepalived_vrrp [19244]: Registering gratuitous ARP shared channel\nFeb 27 14:42:05 systemd: Started LVS and VRRP High Availability Monitor.\nFeb 27 14:42:05 Keepalived_vrrp [19244]: Opening file '/etc/keepalived/keepalived.conf '.\nFeb 27 14:42:05 Keepalived_vrrp [19244]: Truncating auth_pass to 8 characters\nFeb 27 14:42:05 Keepalived_vrrp [19244]: Configuration is using: 64631 Bytes\nFeb 27 14:42:05 Keepalived_vrrp [19244]: Using LinkWatch kernel netlink reflector...\nFeb 27 14:42:05 Keepalived_vrrp [19244]: VRRP_Instance(VI_1) Entering BACKUP STATE\nFeb 27 14:42:05 Keepalived_vrrp [19244]: VRRP sockpool: [ifindex(2), proto(112), unicast(1), fd(14,15)]\nFeb 27 14:42:05 nginx-ha-keepalived: Transition to state 'BACKUP ' on VRRP instance 'VI_1 '.\nFeb 27 14:42:05 Keepalived_vrrp [19244]: VRRP_Script(chk_nginx_service) succeeded\nFeb 27 14:42:06 Keepalived_vrrp [19244]: VRRP_Instance(VI_1) forcing a new MASTER election\nFeb 27 14:42:06 Keepalived_vrrp [19244]: VRRP_Instance(VI_1) forcing a new MASTER election\nFeb 27 14:42:07 Keepalived_vrrp [19244]: VRRP_Instance(VI_1) Transition to MASTER STATE\nFeb 27 14:42:08 Keepalived_vrrp [19244]: VRRP_Instance(VI_1) Entering MASTER STATE\nFeb 27 14:42:08 Keepalived_vrrp [19244]: VRRP_Instance(VI_1) setting protocol VIPs.\nFeb 27 14:42:08 Keepalived_vrrp [19244]: VRRP_Instance(VI_1) Sending gratuitous ARPs on eth0 for 192.168.100.150\nFeb 27 14:42:08 nginx-ha-keepalived: Transition to state 'MASTER ' on VRRP instance 'VI_1 '.\nFeb 27 14:42:13 Keepalived_vrrp [19244]: VRRP_Instance(VI_1) Sending gratuitous ARPs on eth0 for 192.168.100.150\n```\n\n----------------------------------------\n\nTITLE: Configure $prom_keyval_stream in Nginx\nDESCRIPTION: This snippet demonstrates how to configure the `$prom_keyval_stream` variable in the `http` and `stream` blocks to perform dynamic replacements in the stream context. The `keyval_zone` directive is defined in the `stream` context, and the `$prom_keyval_stream` variable is set within the `/metrics` location block in the `http` context. This configuration is used for exporting metrics to Prometheus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_13\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n\n    # the contents of the 'http' block is the same as for the $prom_keyval example\n    # except the 'location /metrics' block:\n    # ...\n\n        location = /metrics {\n            set $prom_keyval        \"http_upstream_keyval\";\n            set $prom_keyval_stream \"stream_upstream_keyval\";\n            js_content              prometheus.metrics;\n        }\n    }\n}\n\nstream {\n\n    keyval_zone zone=stream_keyval:32k;\n\n    upstream stream_backend {\n        zone   stream_backend 64k;\n        server backend1.example.com:12345;\n        server backend2.example.com:12345;\n    }\n\n    server {\n        listen 12345;\n\n        proxy_pass  stream_backend;\n        status_zone backend_stream_zone;\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Restart Developer Portal Service (Upgrade)\nDESCRIPTION: Restarts the `nginx-devportal.service` using `systemctl` after upgrading.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/install-dev-portal.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx-devportal.service\n```\n\n----------------------------------------\n\nTITLE: Get Container ID (Shell)\nDESCRIPTION: This shell command retrieves the long-form ID of a Docker container. It uses docker inspect with a format string to extract the Id field.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_29\n\nLANGUAGE: shell\nCODE:\n```\ndocker inspect --format '{{ .Id }}' container-name\n```\n\n----------------------------------------\n\nTITLE: Ignoring Harmless errors reported when joining a node\nDESCRIPTION: These code snippets show error messages that may be displayed when joining a control plane node to a multi-node resilient cluster. The errors include `Error from server (NotFound): pods \"kube-controller-manager-<host>\" not found` and `Error from server (NotFound): pods \"kube-scheduler-<host>\" not found`. They do not prevent the node from joining the cluster and can be safely ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nError from server (NotFound): pods \"kube-controller-manager-<host>\" not found\n```\n\nLANGUAGE: bash\nCODE:\n```\nError from server (NotFound): pods \"kube-scheduler-<host>\" not found\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration Example\nDESCRIPTION: This NGINX configuration demonstrates a basic setup with an upstream server and a server block that includes location-based augment templates for proxying requests. The configuration uses templates for easier management and modification. The `upstream` block defines the backend server, and the `location` block defines the path for which the proxy will be active.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/tutorials/round-robin-reverse-proxy.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\n# /******************************** !! IMPORTANT !! ********************************/\n#   This is a Template generated configuration. Updates should done through the Template\n#   Submissions workflow. Manual changes to this configuration can/will be overwritten.\n# __templateTag={\"uid\":\"3c4f0137-058f-4275-a8e2-1a1077ae8e8c\",\"file\":\"base.tmpl\",\"name\":\"rr_base_template\"}\nevents {\n\tworker_connections 1024;\n}\nhttp {\n\tupsream users_backend {\n\t\tserver 192.0.0.1:80;\n\t}\n\tserver {\n\t\tserver_name example.com;\n\t\tlocation /users {\n\n# <<< BEGIN DO-NOT-EDIT location augment templates >>>\n\n\t\t\t# __templateTag={\"uid\":\"8c903bd1-c11f-4820-8f0b-d12418a41bad\",\"file\":\"location.tmpl\",\"name\":\"rr_aug_loc_proxy\"}\n\t\t\tinclude /etc/nginx/augments/location/base_http-server1_loc1_3c4f0137_8c903bd1-c11f-4820-8f0b-d12418a41bad.conf;\n\n# <<< END DO-NOT-EDIT location augment templates >>>\n\n\t\t}\n\t}\n}\n```\n\n----------------------------------------\n\nTITLE: Enable NGINX 1.20 Module (RHEL 8)\nDESCRIPTION: Disables the default NGINX 1.14 module and enables the NGINX 1.20 module on RHEL 8 systems. This is necessary to use the newer version of NGINX (1.20) with NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/installation/add-nms-repo.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo yum module disable nginx:1.14\nsudo yum module enable nginx:1.20\n```\n\n----------------------------------------\n\nTITLE: Checking NGINX Version (Shell)\nDESCRIPTION: This command checks the currently installed version of NGINX. It is used to verify that the NGINX Plus instance is up to date before installing the OpenTelemetry module. The expected output shows the nginx version and whether it is a Plus version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nnginx -v\n```\n\n----------------------------------------\n\nTITLE: Get Kubernetes Secret Details\nDESCRIPTION: Retrieves the details of the 'regcred' secret in YAML format from the 'nms' namespace in Kubernetes.  This is used to verify that the secret was created correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/kubernetes/deploy-using-helm.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get secret regcred --output=yaml -n nms\n```\n\n----------------------------------------\n\nTITLE: Listing files in kubelet PKI directory\nDESCRIPTION: This command lists the files in the /var/lib/kubelet/pki directory. This is done to monitor the creation of new certificate files after setting the system time.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_23\n\nLANGUAGE: bash\nCODE:\n```\ncd /var/lib/kubelet/pki; ls -l\n```\n\n----------------------------------------\n\nTITLE: Check ClickHouse server status (CentOS, RHEL)\nDESCRIPTION: Checks the status of the ClickHouse server. This verifies that the ClickHouse service is running and functioning correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl status clickhouse-server\n```\n\n----------------------------------------\n\nTITLE: Creating Nginx Repository File on Amazon Linux 2\nDESCRIPTION: This code creates a yum repository configuration file for Nginx mainline on Amazon Linux 2. It specifies the repository name, base URL, GPG key, and other settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_13\n\nLANGUAGE: none\nCODE:\n```\n[nginx-mainline]\nname=nginx mainline repo\nbaseurl=http://nginx.org/packages/mainline/amzn2/$releasever/$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n```\n\n----------------------------------------\n\nTITLE: Configure Network Settings for Kubernetes\nDESCRIPTION: This command creates a configuration file (`/etc/sysctl.d/k8s.conf`) that sets specific network parameters required for Kubernetes. These parameters enable IP forwarding and allow bridged traffic to be processed by iptables.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-nginx-controller-rhel-8.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\ncat <<EOF | sudo tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF\n```\n\n----------------------------------------\n\nTITLE: ARM Template Certificate Dependency Configuration\nDESCRIPTION: This ARM template snippet shows how to create dependencies between Nginx certificates for sequential deployment. The `dependsOn` property in the `cert2` resource ensures that it is created only after `cert1` is successfully deployed. Prevents deployment conflicts caused by concurrent updates to the Nginx deployment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/known-issues.md#_snippet_4\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"type\": \"NGINX.NGINXPLUS/nginxDeployments/certificates\",\n    \"apiVersion\": \"2021-05-01-preview\",\n    \"name\": \"[concat(parameters('nginxDeploymentName'), '/', 'cert1')]\",\n    \"properties\": {\n        \"certificateVirtualPath\": \"[parameters('certificateVirtualPath')]\",\n        \"keyVirtualPath\": \"[parameters('keyVirtualPath')]\",\n        \"keyVaultSecretId\": \"[parameters('keyVaultSecretId')]\"\n     }\n}\n\n{\n    \"type\": \"NGINX.NGINXPLUS/nginxDeployments/certificates\",\n    \"apiVersion\": \"2021-05-01-preview\",\n    \"name\": \"[concat(parameters('nginxDeploymentName'), '/', 'cert2')]\",\n    \"properties\": {\n        \"certificateVirtualPath\": \"[parameters('certificateVirtualPath')]\",\n        \"keyVirtualPath\": \"[parameters('keyVirtualPath')]\",\n        \"keyVaultSecretId\": \"[parameters('keyVaultSecretId')]\"\n     }\n    \"dependsOn\": [\"cert1\"]\n}\n```\n\n----------------------------------------\n\nTITLE: Enable SSL Verification NGINX\nDESCRIPTION: Enables SSL connections and certificate verification between cluster servers using `zone_sync_ssl`, `zone_sync_ssl_verify`, and `zone_sync_ssl_trusted_certificate` directives.  `zone_sync_ssl_verify` enables certificate verification. `zone_sync_ssl_trusted_certificate` specifies the path to the trusted CA certificate, allowing the server to verify the identity of other cluster members.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/high-availability/zone_sync.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nstream {\n\n    resolver 10.0.0.53 valid=20s;\n\n    server {\n        listen 10.0.0.1:9000 ssl;\n\n        ssl_certificate        /etc/ssl/nginx-1.example.com.server_cert.pem;\n        ssl_certificate_key    /etc/ssl/nginx-1.example.com.key.pem;\n\n        zone_sync;\n        zone_sync_server    nginx-cluster.example.com:9000 resolve;\n\n        zone_sync_ssl                     on;\n        zone_sync_ssl_verify              on;\n        zone_sync_ssl_trusted_certificate /etc/ssl/server_ca.pem;\n        #...\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Shell Command Example\nDESCRIPTION: This code snippet shows an example of a shell command that can be included in a how-to guide. It demonstrates the use of code blocks for providing easily copyable commands to the reader.\nSOURCE: https://github.com/nginx/documentation/blob/main/archetypes/default.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\n# We typically show examples of commands or code in one code block, which can be easily copied by a reader using a button connected to the block.\n```\n\n----------------------------------------\n\nTITLE: Reset Kubernetes Configuration\nDESCRIPTION: This snippet shows how to reset the Kubernetes configuration using `kubeadm`. This step is part of a workaround for resolving issues during NGINX Controller installation on CentOS 7. It effectively clears the existing Kubernetes setup, allowing for a clean re-initialization.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_42\n\nLANGUAGE: bash\nCODE:\n```\nsudo kubeadm reset -f\n```\n\n----------------------------------------\n\nTITLE: Query UDP/TCP Client Throughput with Prometheus\nDESCRIPTION: This Prometheus query calculates the current throughput of clients sending data to upstreams over UDP or TCP.  It uses `irate` to determine the rate of increase of the `nginxplus_stream_upstream_server_sent` counter over 30 seconds.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/prometheus-metrics.md#_snippet_3\n\nLANGUAGE: promQL\nCODE:\n```\nirate(nginxplus_stream_upstream_server_sent[30s])\n```\n\n----------------------------------------\n\nTITLE: Installing PHP 5 and FastCGI on Ubuntu\nDESCRIPTION: This command installs PHP 5 and FastCGI (php5-fpm) on an Ubuntu system. It's a prerequisite for configuring PHP applications to work with NGINX Plus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\napt-get install php5-fpm\n```\n\n----------------------------------------\n\nTITLE: Include HTTP Config Files\nDESCRIPTION: This Nginx configuration snippet includes all HTTP configuration files in the conf.d directory ending with `-http.conf`. The http block is required.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    include conf.d/*-http.conf;\n}\n```\n\n----------------------------------------\n\nTITLE: Request Structure\nDESCRIPTION: This shows the structure of the HTTP requests being sent by the driver applications, with the path and custom headers.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/accesscontrol-walkthrough.md#_snippet_16\n\nLANGUAGE: txt\nCODE:\n```\nGET HTTP/1.1 /echo\nHost: dest-svc:8080\nx-demo-1:demo-1\nx-demo-2:demo-2\nx-demo-3:demo-3\n```\n\n----------------------------------------\n\nTITLE: Installing CA Certificates with yum\nDESCRIPTION: This snippet demonstrates how to install the ca-certificates package on systems using the yum package manager. It first updates the yum package list and then installs the ca-certificates package. It assumes the user has sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/install-ca-certificates-dependency-yum.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update\nsudo yum install ca-certificates\n```\n\n----------------------------------------\n\nTITLE: Start Kubelet process (workaround)\nDESCRIPTION: This command starts the `kubelet` process on a node where it has been stopped. It's a workaround to clean up containers that were re-assigned to other nodes in a multi-node NGINX Controller setup when one node becomes unavailable. Requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start kubelet\n```\n\n----------------------------------------\n\nTITLE: Configuring SSL Session Ticket Keys\nDESCRIPTION: This snippet configures the SSL session ticket keys.  When using session tickets with an upstream group, each server must be initialized with the same session key. This shows how to define the location of the current and previous ticket keys, and it is recommended to rotate these frequently.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/terminating-ssl-tcp.md#_snippet_8\n\nLANGUAGE: nginx\nCODE:\n```\nserver {\n    #...\n    ssl_session_tickets on;\n    ssl_session_ticket_key /etc/ssl/session_ticket_keys/current.key;\n    ssl_session_ticket_key /etc/ssl/session_ticket_keys/previous.key;\n}\n```\n\n----------------------------------------\n\nTITLE: Description of system.net.packets_in.error and system.net.packets_out.error metrics\nDESCRIPTION: Provides the type and description for the system.net.packets_in.error and system.net.packets_out.error metrics which is a counter in integer representing Network I/O statistics. Total number of errors while receiving or sending, per network interface.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_11\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Network I/O statistics. Total number of errors while receiving or sending,\n               per network interface.\n```\n\n----------------------------------------\n\nTITLE: Creating Azure Instance Template (Marketplace Image) in JSON\nDESCRIPTION: This JSON configuration creates an Instance Template in NGINX Controller for an Azure Marketplace image. It defines parameters for creating an NGINX instance, including the image publisher, offer, SKU, version, instance type, admin user, public key, and network interface details. The `type` is set to `AZURE_INSTANCE_TEMPLATE` and `AZURE_IMAGE_REFERENCE`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/add-azure-instance.md#_snippet_2\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"metadata\": {\n      \"name\": \"us-west-azure\"\n    },\n    \"desiredState\": {\n      \"type\": \"AZURE_INSTANCE_TEMPLATE\",\n      \"image\": {\n        \"type\": \"AZURE_IMAGE_REFERENCE\",\n        \"publisher\": \"nginxinc\",\n        \"offer\": \"nginx-plus-v1\",\n        \"sku\": \"nginx-plus-ub1804\",\n        \"version\": \"latest\"\n      },\n      \"instanceType\": \"Standard_A1\",\n      \"adminUser\": \"azureuser\",\n      \"publicKey\": \"<the complete ssh-rsa string>\",\n      \"networkInterface\": {\n        \"type\": \"AZURE_NIC_CONFIG\",\n        \"name\": \"\",\n        \"virtualNetwork\": \"\",\n        \"subnet\": \"default\",\n        \"securityGroup\": \"\",\n        \"publicIpName\": \"\"\n      }\n    }\n  }\n```\n\n----------------------------------------\n\nTITLE: Enable OIDC in NGINX with Go Template\nDESCRIPTION: This Go template snippet checks if OIDC is enabled based on user input. If enabled, it loads the ngx_http_js_module.so module, which is required for OIDC functionality in NGINX.  The template accesses nested properties within the input data to determine the OIDC status.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-configs/config-templates/concepts/template-resources.md#_snippet_0\n\nLANGUAGE: Go\nCODE:\n```\n{{$input := .}}\n{{$baseData := .Data.V1}}\n{{$oidcEnabled := false}}\n\n{{if $baseData.main}}\n    {{if $baseData.main.templateInput}}\n        {{$oidc := index $baseData.main.templateInput \"oidc\"}}\n        {{if $oidc}}\n            {{$oidcEnabled = index $oidc \"enabled\"}}\n        {{end}}\n    {{end}}\n\n    {{if eq $oidcEnabled true}}\n        load_module modules/ngx_http_js_module.so;\n    {{end}}\n{{end}}\n\n```\n\n----------------------------------------\n\nTITLE: Example JSON Response for Instances API\nDESCRIPTION: This JSON response shows the format of the data returned by the `/api/platform/v1/instances` endpoint. It includes a count of instances and indicates how many instances have NGINX App Protect WAF installed. This endpoint is used to verify that NGINX Instance Manager is correctly detecting NGINX App Protect WAF instances.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_13\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"count\": 3,\n  \"items\": [\n    [...]\n  ],\n  \"nginxAppProtectWAFCount\": 2,\n  \"nginxPlusCount\": 3\n}\n```\n\n----------------------------------------\n\nTITLE: Installing yum-utils on RHEL 8.1+\nDESCRIPTION: This command installs the yum-utils package on RHEL 8.1+. This package provides various utilities for managing yum repositories and packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_21\n\nLANGUAGE: script\nCODE:\n```\nsudo dnf install yum-utils\n```\n\n----------------------------------------\n\nTITLE: Restart NMS DPM service - Bash\nDESCRIPTION: This snippet provides commands to remove the existing NATS working directory and restart the NMS Data Plane Manager (nms-dpm) service. This is a workaround for the 'Deployment Not Found' error when publishing NGINX configs to a NATS server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/known-issues.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nrm -rf /var/lib/nms/streaming\nsystemctl restart nms-dpm\n```\n\n----------------------------------------\n\nTITLE: Create MySQL User for NGINX Amplify Agent\nDESCRIPTION: This snippet creates a MySQL user ('amplify-agent'@'localhost') with a specified password. This user will be used by the NGINX Amplify Agent to connect to the MySQL database and collect metrics. The password 'xxxxxx' should be replaced with a strong, unique password.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/other-metrics.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\n$ mysql -u root -p\n[..]\nmysql> CREATE USER 'amplify-agent'@'localhost' IDENTIFIED BY 'xxxxxx';\nQuery OK, 0 rows affected (0.01 sec)\n```\n\n----------------------------------------\n\nTITLE: Timeout Error Message During NATS Streaming Cluster Scale Up\nDESCRIPTION: This snippet displays a timeout error message that can occur during the upgrade of an NGINX Controller cluster. The message indicates that the `nats-streaming-cluster` service did not scale up within the expected timeframe.  The text clarifies that these warnings are safe to ignore.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.21.md#_snippet_1\n\nLANGUAGE: text\nCODE:\n```\nWhile waiting for nats-streaming-cluster to scale up, the operation did not complete before timing out.\n```\n\n----------------------------------------\n\nTITLE: Bookinfo Ingress Definition\nDESCRIPTION: Defines a Kubernetes Ingress resource for the Bookinfo application.  It routes requests to `bookinfo.example.com` to the `productpage` service on port 9080. It includes an optional `ingressClassName` for Kubernetes versions 1.18.0 and greater.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-walkthrough.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: bookinfo-ingress\nspec:\n  ingressClassName: nginx # use only with k8s version >= 1.18.0\n  tls:\n  rules:\n  - host: bookinfo.example.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: productpage\n            port:\n              number: 9080\n```\n\n----------------------------------------\n\nTITLE: Launch Swagger UI - Shell\nDESCRIPTION: This command launches the Swagger UI for the REST interface. It assumes that `goswagger` is installed. See [instructions for installing goswagger](https://goswagger.io/go-swagger/install/) for additional help.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/getting-started.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\nmake launch-swagger-ui\n```\n\n----------------------------------------\n\nTITLE: Bash Snippet to Set Codename to Focal\nDESCRIPTION: This is a bash snippet to statically set the codename of the OS to \"focal\". Part of the workaround for the Ubuntu 22.04 LTS agent installation issue.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\ncodename=focal\n```\n\n----------------------------------------\n\nTITLE: Running Attack Signature Report Tool\nDESCRIPTION: Executes the Attack Signature Report tool without arguments. This displays the help message and usage instructions, because required arguments are missing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_23\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/get-signatures\n```\n\n----------------------------------------\n\nTITLE: Increasing Subrequest Output Buffer Size in Nginx\nDESCRIPTION: This configures the subrequest output buffer size, increasing the buffer available for storing the response body of a subrequest. This might be necessary to avoid \"too big subrequest response\" errors, as the prometheus module utilizes subrequests for API calls.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_10\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    subrequest_output_buffer_size 32k;\n}\n```\n\n----------------------------------------\n\nTITLE: Install Headers-More Module on Debian and Ubuntu\nDESCRIPTION: This shell script updates the package repositories and installs the `nginx-plus-module-headers-more` package using apt. It is specific to Debian and Ubuntu operating systems. It assumes that the user has sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/headers-more.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update && \\\nsudo apt install nginx-plus-module-headers-more\n```\n\n----------------------------------------\n\nTITLE: Warning Message When Deploying Without Persistent Storage\nDESCRIPTION: This is a warning message displayed during the installation of NGINX Service Mesh if no default StorageClass is set up. It indicates that deploying without persistent storage is not suitable for production environments and recommends ensuring a default StorageClass is configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/platform-setup/persistent-storage.md#_snippet_1\n\nLANGUAGE: text\nCODE:\n```\nWarning: Deploying without persistent storage, not suitable for production environments.\n         For production environments ensure a default StorageClass is set.\n```\n\n----------------------------------------\n\nTITLE: ObservabilityPolicy Status Output - Text\nDESCRIPTION: This text block represents the expected output of the `kubectl describe` command on the ObservabilityPolicy. It includes information such as the acceptance status, associated HTTPRoute, and the controller managing the policy. This output shows the policy's health and connection to the target HTTPRoute.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/tracing.md#_snippet_15\n\nLANGUAGE: text\nCODE:\n```\nStatus:\n  Ancestors:\n    Ancestor Ref:\n      Group:      gateway.networking.k8s.io\n      Kind:       HTTPRoute\n      Name:       coffee\n      Namespace:  default\n    Conditions:\n      Last Transition Time:  2024-05-23T18:13:03Z\n      Message:               Policy is accepted\n      Observed Generation:   1\n      Reason:                Accepted\n      Status:                True\n      Type:                  Accepted\n    Controller Name:         gateway.nginx.org/nginx-gateway-controller\n```\n\n----------------------------------------\n\nTITLE: Example Keepalived Log Output (bash)\nDESCRIPTION: This snippet provides an example of the `keepalived` log output, specifically showing a state transition to 'MASTER'. It's included as a reference for understanding the output of the `journalctl` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/ha-data-plane.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nNov 23 12:44:52 testenv-d206eaca-data-1 Keepalived_vrrp[798]: (VI_1) Entering MASTER STATE                                 │Nov 23 12:36:53 testenv-d206eaca-data-2 Keepalived_vrrp[1098]: WARNING - default user 'keepalived_script' for script execu\nNov 23 12:44:52 testenv-d206eaca-data-1 Keepalived_vrrp[798]: (VI_1) using locally configured advertisement interval (1000 │tion does not exist - please create.\nmilli-sec)                                                                                                                 │Nov 23 12:36:53 testenv-d206eaca-data-2 Keepalived_vrrp[1098]: SECURITY VIOLATION - scripts are being executed but script_\nNov 23 12:44:52 testenv-d206eaca-data-1 nginx-ha-keepalived[1338]: Transition to state 'MASTER' on VRRP instance 'VI_1'.\n```\n\n----------------------------------------\n\nTITLE: Define shell variables\nDESCRIPTION: This shell script defines the GW_IP and GW_TLS_PORT variables to be the external IP address and TLS port for the NGINX Gateway Fabric, respectively. This allows for simpler configuration and reuse throughout the documentation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/tls-passthrough.md#_snippet_4\n\nLANGUAGE: text\nCODE:\n```\nGW_IP=XXX.YYY.ZZZ.III\nGW_TLS_PORT=<port number>\n```\n\n----------------------------------------\n\nTITLE: Exporting OIDC Environment Variables (Keycloak >= 18.x)\nDESCRIPTION: This snippet exports environment variables required for OIDC configuration with Keycloak versions 18.x and later. It uses `curl` and `jq` to fetch OIDC endpoints. Ensure placeholders are replaced with correct values for your Keycloak and NGINX Instance Manager instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/keycloak-setup.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\n# Either the FQDN or the IP address is suitable for these environment variables.\nexport KEYCLOAK_IP=\"<insert-keycloak-IP>\"\nexport NIM_IP=\"<insert-NIM-IP>\"\nexport KEYCLOAK_CLIENT_ID=\"<insert-keycloak-client-id>\"\nexport KEYCLOAK_CLIENT_SECRET=\"<insert-kecloak-client-secret>\"\n\n# Choose an appropriate Hash-Based Message Authentication Code (HMAC)\nexport HMAC_KEY=\"<insert-HMAC>\"\n\nexport KEYCLOAK_AUTH_ENDPOINT=$(curl -k \\\n  \"https://$KEYCLOAK_IP:8443/realms/<realm-name>/.well-known/openid-configuration\" | \\\n  jq -r \".authorization_endpoint\")\n\nexport KEYCLOAK_TOKEN_ENDPOINT=$(curl -k \\\n  \"https://$KEYCLOAK_IP:8443/realms/<realm-name>/.well-known/openid-configuration\" | \\\n  jq -r \".token_endpoint\")\n\nexport KEYCLOAK_KEYS_ENDPOINT=$(curl -k \\\n  \"https://$KEYCLOAK_IP:8443/realms/<realm-name>/.well-known/openid-configuration\" | \\\n  jq -r \".jwks_uri\")\n```\n\n----------------------------------------\n\nTITLE: Update NGINX Plus Repository URL\nDESCRIPTION: This snippet shows how to update the base URL in the `/etc/yum.repos.d/plus-9.repo` file to point to a specific NGINX Plus version. This allows pinning the installation or update to a particular release.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginx-plus/install/pin-to-version/pin-rhel9-R32.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nbaseurl=https://pkgs.nginx.com/plus/R33/centos/9/$basearch/\n```\n\n----------------------------------------\n\nTITLE: Viewing Content of Password File\nDESCRIPTION: This snippet displays the contents of the password file, which contains usernames and their corresponding hashed passwords. It's useful for verifying that users have been added correctly, but the passwords are not human-readable.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/configuring-http-basic-authentication.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\n$ cat /etc/apache2/.htpasswd\nuser1:$apr1$/woC1jnP$KAh0SsVn5qeSMjTtn0E9Q0\nuser2:$apr1$QdR8fNLT$vbCEEzDj7LyqCMyNpSoBh/\nuser3:$apr1$Mr5A0e.U$0j39Hp5FfxRkneklXaMrr/\n```\n\n----------------------------------------\n\nTITLE: Pulling NGINX App Protect Images\nDESCRIPTION: These commands are used to pull the `waf-enforcer` and `waf-config-mgr` Docker images from a private registry, which are components of the NGINX App Protect module. Replace `5.2.0` with the specific release version being deployed. This step is necessary to obtain the necessary components for the NGINX App Protect WAF functionality.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_15\n\nLANGUAGE: shell\nCODE:\n```\ndocker pull private-registry.nginx.com/nap/waf-enforcer:5.2.0\ndocker pull private-registry.nginx.com/nap/waf-config-mgr:5.2.0\n```\n\n----------------------------------------\n\nTITLE: Install Set-Misc Module on SLES\nDESCRIPTION: This snippet shows how to install the nginx-plus-module-set-misc package on SUSE Linux Enterprise Server (SLES) using the zypper package manager. The repositories are refreshed before the module is installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/set-misc.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-set-misc\n```\n\n----------------------------------------\n\nTITLE: OAS Server Configuration (JSON)\nDESCRIPTION: This JSON configuration details server URL templating within an Open API Specification (OAS) for use with NGINX Management Suite API Connectivity Manager. It uses variables for server and version to dynamically construct the URL. The x-acm-* extensions configure backend services, including upstreams with properties like maxFails and failTimeout.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/getting-started/publish-api-proxy.md#_snippet_3\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"url\": \"https://{server}.example.com/api/{version}\",\n    \"variables\": {\n      \"version\": {\n        \"default\": \"v1\"\n      },\n      \"server\": {\n        \"default\": \"staging\"\n      }\n    },\n    \"x-acm-append-rule\": \"NONE\",\n    \"x-acm-strip-basepath\": false,\n    \"x-acm-backends\": [\n      {\n        \"serviceName\": \"pets-backend\",\n        \"serviceVersion\": \"pets-backend-v1\",\n        \"serviceLabel\": \"default\",\n        \"contextRoot\": \"/dev\",\n        \"upstreams\": [\n          {\n            \"url\": \"https://gecho1.null.ie\",\n            \"maxFails\": 10,\n            \"maxConnections\": 5,\n            \"failTimeout\": \"5s\",\n            \"slowStart\": \"10s\"\n          },\n          {\n            \"url\": \"https://gecho2.null.ie\",\n            \"maxFails\": 5,\n            \"maxConnections\": 8,\n            \"failTimeout\": \"15s\",\n            \"slowStart\": \"3s\"\n          },\n          {\n            \"url\": \"https://gecho3.null.ie\",\n            \"maxFails\": 7,\n            \"maxConnections\": 33,\n            \"failTimeout\": \"35s\",\n            \"slowStart\": \"1s\"\n          }\n        ]\n      }\n    ]\n  }\n```\n\n----------------------------------------\n\nTITLE: Running NGINX Plus (Unprivileged)\nDESCRIPTION: This command starts NGINX Plus after an unprivileged installation. Replace `<path>` with the installation path. The `-p` parameter specifies the path to the nginx files, and the `-c` parameter sets a path to an alternative NGINX configuration file. NGINX Plus must listen on ports above 1024.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_45\n\nLANGUAGE: shell\nCODE:\n```\n<path>/usr/sbin/nginx -p <path>/etc/nginx -c <path>/etc/nginx/conf.d\n```\n\n----------------------------------------\n\nTITLE: Installing libmaxminddb-devel on SLES\nDESCRIPTION: Installs the libmaxminddb-devel package using zypper. This package provides the necessary libraries and headers for working with MaxMind databases.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/security-controls/controlling-access-by-geoip.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nzypper install libmaxminddb-devel\n```\n\n----------------------------------------\n\nTITLE: Running NGINX Agent Support Script (Bash)\nDESCRIPTION: This snippet demonstrates how to run the support script on a data plane instance running the NGINX Agent. This script collects system details, NGINX configurations, logs, and Agent specific data which is crucial for identifying and resolving data plane instance issues. The script needs to be run via SSH connection to the data plane instance.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/support/contact-support.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n/usr/share/nginx-agent/support.sh\n```\n\n----------------------------------------\n\nTITLE: Start ClickHouse server (Debian, Ubuntu)\nDESCRIPTION: Starts the ClickHouse server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start clickhouse-server\n```\n\n----------------------------------------\n\nTITLE: API Endpoint for Deleting Environment\nDESCRIPTION: This text represents the API endpoint used to delete an environment in the API Connectivity Manager (ACM). It includes placeholders for the NMS FQDN, infrastructure workspace name, and environment name.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_10\n\nLANGUAGE: text\nCODE:\n```\nhttps://<NMS-FQDN>/api/acm/v1/infrastructure/workspaces/<infra-workspace-name>/environments/<environmentname>\n```\n\n----------------------------------------\n\nTITLE: Copying NGINX Certificates (Amazon Linux)\nDESCRIPTION: Copies the nginx-repo.crt and nginx-repo.key files to the /etc/ssl/nginx/ directory on Amazon Linux. This step is essential for setting up the repository for NGINX Agent installation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_28\n\nLANGUAGE: shell\nCODE:\n```\nsudo cp nginx-repo.crt nginx-repo.key /etc/ssl/nginx/\n```\n\n----------------------------------------\n\nTITLE: Checking Out and Branching from Internal Remote in Git\nDESCRIPTION: This snippet demonstrates how to check out the `main` branch from the internal remote and create a new feature branch prefixed with `internal/`. The branch prefix `internal/` is critical for identifying work intended for the closed repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/CLOSED_CONTRIBUTIONS.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ngit checkout internal/main\ngit checkout -b internal/feature\n```\n\n----------------------------------------\n\nTITLE: Error Log Configuration in NGINXaaS\nDESCRIPTION: This snippet references the NGINX documentation on configuring error logs for NGINXaaS. Error logs are used to capture, troubleshoot, and identify issues that may occur during server operations.  More information can be found in the Core functionality documentation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/faq.md#_snippet_3\n\nLANGUAGE: text\nCODE:\n```\nCore functionality (https://nginx.org/en/docs/ngx_core_module.html?&_ga=2.8347062.545098740.1677716889-256521444.1670450998#error_log)\n```\n\n----------------------------------------\n\nTITLE: Enable and Start NGINX Instance Manager Services - Bash\nDESCRIPTION: Enables and starts the NGINX Instance Manager services using `systemctl`. The `--now` flag starts the services immediately after enabling them.  The services included are nms, nms-core, nms-dpm, nms-ingestion, and nms-integrations.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/disconnected/offline-install-guide-deprecated.md#_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl enable nms nms-core nms-dpm nms-ingestion nms-integrations --now\n```\n\n----------------------------------------\n\nTITLE: Defining Extended NGINX Log Format\nDESCRIPTION: This code snippet defines a custom log format named `main_ext` for NGINX access logs.  It includes various NGINX variables to provide detailed information about requests, such as remote address, request time, upstream status, and cache status.  This extended log format is required to collect additional metrics using NGINX Amplify Agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nlog_format  main_ext  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                        '$status $body_bytes_sent \"$http_referer\" '\n                        '\"$http_user_agent\" \"$http_x_forwarded_for\" '\n                        '\"$host\" sn=\"$server_name\" '\n                        'rt=$request_time '\n                        'ua=\"$upstream_addr\" us=\"$upstream_status\" '\n                        'ut=\"$upstream_response_time\" ul=\"$upstream_response_length\" '\n                        'cs=$upstream_cache_status' ;\n```\n\n----------------------------------------\n\nTITLE: Deleting NGINX Service Mesh namespace using kubectl\nDESCRIPTION: This command deletes the specified namespace in Kubernetes, typically used to remove a faulty or outdated NGINX Service Mesh deployment. Replace `<namespace>` with the name of the namespace where NGINX Service Mesh is deployed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.7.0.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete namespace <namespace>\n```\n\n----------------------------------------\n\nTITLE: Exclude aggregated dimension - None\nDESCRIPTION: This snippet demonstrates how to exclude data for an aggregated dimension when querying the Metrics API to prevent overcounting. It is a workaround for an issue where metrics may report additional data due to aggregation across all dimensions.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/known-issues.md#_snippet_8\n\nLANGUAGE: none\nCODE:\n```\nfilterBy=<dimension-name>!= ''\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX User ID\nDESCRIPTION: Allows explicitly setting the user ID that NGINX Amplify Agent should use for its effective user ID. Specifies the user and the location of the NGINX configuration file for detecting the user ID. Requires the agent.conf file to be accessible.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/configuring-amplify-agent.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\n[nginx]\nuser =\nconfigfile = /etc/nginx/nginx.conf\n```\n\n----------------------------------------\n\nTITLE: keepalived.conf Template for Active-Passive HA\nDESCRIPTION: This is a template for the keepalived.conf file, used for configuring keepalived for active-passive high availability. It includes settings for health checks, instance priority, IP addresses, and authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-keepalived.md#_snippet_5\n\nLANGUAGE: nginx\nCODE:\n```\nvrrp_script chk_nginx_service {\n    script \"<path-to-health-check-script>\"\n    interval 3\n    weight 50\n}\nvrrp_instance VI_1 {\n    interface eth0\n    priority <priority>\n    virtual_router_id 51\n    advert_int 1\n    unicast_src_ip <internal-ip-address-of-instance>\n    unicast_peer {\n        <internal-ip-address-of-other-instance>\n    }\n    authentication {\n        auth_type PASS\n        auth_pass <password>\n    }\n    track_script {\n        chk_nginx_service\n    }\n    notify \"<path-to-notify-script>\"\n}\n```\n\n----------------------------------------\n\nTITLE: Enabling App Protect DoS\nDESCRIPTION: These commands enable Nginx App Protect DoS within an http/server/location context in the nginx.conf file. It activates the DoS protection and configures the policy and monitoring parameters. Requires the App Protect DoS module to be loaded and a valid DoS policy file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_12\n\nLANGUAGE: shell\nCODE:\n```\napp_protect_dos_enable on;\napp_protect_dos_name \"App1\";\napp_protect_dos_policy_file \"/etc/app_protect_dos/BADOSDefaultPolicy.json\";\napp_protect_dos_monitor uri=serv:80/; # Assuming server_name \"serv\" on port 80, with the root path \"/\"\n```\n\n----------------------------------------\n\nTITLE: Setting Backup Path (Bash)\nDESCRIPTION: This snippet sets a local environment variable for the backup path of the PostgreSQL database. The variable is `BACKUP_PATH` and it is assigned the value of the backup directory, which follows the format `~/pgbackup_<timestamp>`. This variable is used in the subsequent restore script.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/backup-restore/backup-restore-external-config-db.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nBACKUP_PATH=~/pgbackup_<timestamp>\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Gateway Fabric (Namespace and Roles)\nDESCRIPTION: These commands remove the NGINX Gateway Fabric namespace, clusterrole, and clusterrolebinding, effectively uninstalling the core components of NGINX Gateway Fabric. This operation is performed using `kubectl delete`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/installing-ngf/manifests.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\nkubectl delete namespace nginx-gateway\nkubectl delete cluterrole nginx-gateway\nkubectl delete clusterrolebinding nginx-gateway\n```\n\n----------------------------------------\n\nTITLE: Check Kubernetes Services\nDESCRIPTION: This shell command retrieves a list of services in the Kubernetes cluster and displays their status. It allows you to verify that the services are running and configured as expected.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md#_snippet_11\n\nLANGUAGE: shell\nCODE:\n```\nkubectl get services\n```\n\n----------------------------------------\n\nTITLE: Example invalid Service configuration\nDESCRIPTION: This example demonstrates an invalid Kubernetes Service configuration with duplicate `targetPort` values. NGINX Service Mesh disregards duplicate `targetPort` configurations, honoring only one for traffic forwarding, authentication, and encryption. The workaround involves using unique `targetPort` values or routing all traffic through the same Service port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.2.0.md#_snippet_0\n\nLANGUAGE: plaintext\nCODE:\n```\napiVersion: v1\nkind: Service\nspec:\n  ports:\n  - port: 8080\n    protocol: TCP\n    targetPort: 55555\n  - port: 9090\n    protocol: TCP\n    targetPort: 55555\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Open Source (Debian 12)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Open Source package from Debian 12. It uses the `apt-get remove` command to remove the `app-protect-module-oss` package. Requires root privileges and the apt package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_56\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get remove app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Building NGINX Plus API Gateway Dockerfile\nDESCRIPTION: This Dockerfile builds an NGINX Plus-based API Gateway image with NGINX Agent. It installs necessary dependencies, configures APT repositories, and installs NGINX Plus and the agent. The Dockerfile uses multi-stage builds to minimize the final image size. It requires secrets for the NGINX Plus repository certificate and key.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/devportals/installation/devportal-helm-chart.md#_snippet_2\n\nLANGUAGE: Dockerfile\nCODE:\n```\nFROM ubuntu:focal\n\n# NGINX Plus release e.g 27\nARG NGINX_PLUS_VERSION\n\n# DEVPORTAL release e.g 1.3.0\nARG DEVPORTAL_UI_VERSION\n\nARG CONTROL_PLANE_IP\n\n# Install NGINX Plus\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\nset -ex \\\n&& apt-get update \\\n&& apt-get upgrade -y \\\n&& apt-get install --no-install-recommends --no-install-suggests -y \\\n    curl \\\n    gnupg \\\n    ca-certificates \\\n    apt-transport-https \\\n    lsb-release \\\n    procps \\\n&& \\\nNGINX_GPGKEY=573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62; \\\nfor server in \\\n    hkp://keyserver.ubuntu.com:80 \\\n    pgp.mit.edu; do \\\n    echo \"Fetching GPG key $NGINX_GPGKEY from $server\"; \\\n    gpg --keyserver \"$server\" \\\n        --recv-keys \"$NGINX_GPGKEY\" \\\n        && break; \\\ndone\n# Configure APT repos\n&& gpg --export \"$NGINX_GPGKEY\" > /etc/apt/trusted.gpg.d/nginx.gpg \\\n&& printf \"Acquire::https::pkgs.nginx.com::SslCert \\\"/etc/ssl/nginx/nginx-repo.crt\\\";\\n\" >> /etc/apt/apt.conf.d/90pkgs-nginx \\\n&& printf \"Acquire::https::pkgs.nginx.com::SslKey  \\\"/etc/ssl/nginx/nginx-repo.key\\\";\\n\" >> /etc/apt/apt.conf.d/90pkgs-nginx \\\n&& printf \"deb https://pkgs.nginx.com/plus/$(lsb_release -is | tr '[:upper:]' '[:lower:]') $(lsb_release -cs) nginx-plus\\n\" > /etc/apt/sources.list.d/nginx-plus.list \\\n&& printf \"deb https://pkgs.nginx.com/nms/$(lsb_release -is | tr '[:upper:]' '[:lower:]') $(lsb_release -cs) nginx-plus\\n\" > /etc/apt/sources.list.d/nms.list \\\n&& apt-get update \\\n# Install NGINX Plus & agent\\\n&& apt-get install -y \\\n        nginx-plus=${NGINX_PLUS_VERSION}* \\\n        nginx-plus-module-njs=${NGINX_PLUS_VERSION}* \\\n        nginx-devportal-ui=${DEVPORTAL_UI_VERSION}* \\\n&& curl --insecure https://$CONTROL_PLANE_IP/install/nginx-agent | PACKAGE_HOST=${CONTROL_PLANE_IP} sh \\\n# Forward request and error logs to docker log collector \\\n&& ln -sf /dev/stdout /var/log/nginx/access.log \\\n&& ln -sf /dev/stderr /var/log/nginx/error.log \\\n# Cleanup \\\n&& apt-get autoremove --purge -y \\\n    curl \\\n    gnupg \\\n    apt-transport-https \\\n    lsb-release \\\n&& rm -rf /root/.gnupg \\\n&& rm -rf /etc/apt/sources.list.d/nginx-plus.list /etc/apt/sources.list.d/nms.list /etc/apt/apt.conf.d/90pkgs-nginx \\\n&& rm -rf /var/lib/apt/lists/*\n\nCOPY /entrypoint.sh /\n\nSTOPSIGNAL SIGTERM\n\nCMD bash /entrypoint.sh\n```\n\n----------------------------------------\n\nTITLE: Get a Location using NGINX Controller API\nDESCRIPTION: This snippet shows how to retrieve information about a specific location resource using the NGINX Controller API. It requires the locationName as a path parameter, which is a string representing the name of the location you wish to view.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_45\n\nLANGUAGE: bash\nCODE:\n```\nGET <FQDN>/api/v2/infrastructure/locations/{locationName}\n```\n\n----------------------------------------\n\nTITLE: Nikto Scan Output After XSS Blocking\nDESCRIPTION: Shows the further reduced output from a Nikto scan after configuring the CRS to block XSS attempts. This demonstrates the improved protection provided by the CRS.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/modsec-waf/admin-guide/nginx-plus-modsecurity-waf-owasp-crs.md#_snippet_14\n\nLANGUAGE: none\nCODE:\n```\n$ perl program/nikto.pl -h localhost\n+ The anti-clickjacking X-Frame-Options header is not present.\n+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS\n+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type\n+ No CGI Directories found (use '-C all' to force check all possible dirs)\n+ /smg_Smxcfg30.exe?vcc=3560121183d3: This may be a Trend Micro Officescan 'backdoor'.\n+ 7435 requests: 0 error(s) and 4 item(s) reported on remote host\n```\n\n----------------------------------------\n\nTITLE: Restarting NGINX Instance Manager platform services\nDESCRIPTION: This command restarts the NGINX Instance Manager platform services using `systemctl`. This ensures that the updated version of the Instance Manager is running.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_18\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nms\n```\n\n----------------------------------------\n\nTITLE: Markdown example for Prerequisites\nDESCRIPTION: This snippet shows an example of how to format a 'Before you begin' section in Markdown to list prerequisites for a how-to guide. It includes both conceptual understanding and software requirements.\nSOURCE: https://github.com/nginx/documentation/blob/main/templates/how-to/guide-how-to.md#_snippet_1\n\nLANGUAGE: markdown\nCODE:\n```\nBefore you begin, ensure you have:\n\n- A conceptual understanding of RESTful APIs.\n\nBefore you begin, ensure you have:\n\n- API credentials for the v3.5 API.\n- Access to the Postman application.\n- (Optional) A development environment (IDE) that displays API responses formatted for readability.\n```\n\n----------------------------------------\n\nTITLE: Verifying Nginx App Protect WAF Version\nDESCRIPTION: These commands are used to verify that the latest version of Nginx App Protect WAF is installed on the EC2 machine. It compares the installed version with the latest release available on the Nginx website. Requires the `cat` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\ncat /opt/app_protect/VERSION /opt/app_protect/RELEASE\n```\n\n----------------------------------------\n\nTITLE: Keepalive Connections BIG-IP LTM\nDESCRIPTION: This snippet configures keepalive connections on BIG-IP LTM using the `oneconnect` profile. It adds the `oneconnect` profile to virtual servers named `test_virtual` and `test_ssl_virtual`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration.md#_snippet_14\n\nLANGUAGE: none\nCODE:\n```\n# modify virtual test_virtual profiles add { oneconnect }\n# modify virtual test_ssl_virtual profiles add { oneconnect }\n# save /sys config\n```\n\n----------------------------------------\n\nTITLE: Querying Security Violation Events by Request Outcome\nDESCRIPTION: This example shows how to get all security violation events where the request was rejected by WAF using the NGINX Controller REST API.  The startTime is set to 0 and endTime to now.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/view-app-security-analytics.md#_snippet_4\n\nLANGUAGE: curl\nCODE:\n```\nGET https://{{host}}/api/v1/analytics/events?\n        startTime=0&\n        endTime=now&\n        filter=(\n            category='security violation' and\n            request_outcome='REJECTED')\n```\n\n----------------------------------------\n\nTITLE: Proxying Requests to Upstream Group - Nginx\nDESCRIPTION: This snippet configures two location blocks within a server block for HTTPS traffic. The first location block proxies requests with the '/tomcat-app/' path to the 'tomcat' upstream group. The second location redirects all traffic to the first location block.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_16\n\nLANGUAGE: nginx\nCODE:\n```\nlocation /tomcat-app/ {\n    proxy_pass http://tomcat;\n}\n\nlocation = / {\n    return 302 /tomcat-app/;\n}\n```\n\n----------------------------------------\n\nTITLE: Build NGINX image\nDESCRIPTION: This command builds only the NGINX image using make. It requires GNU Make and Docker to be installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/installation/building-the-images.md#_snippet_4\n\nLANGUAGE: makefile\nCODE:\n```\nmake PREFIX=myregistry.example.com/nginx-gateway-fabric build-prod-nginx-image\n```\n\n----------------------------------------\n\nTITLE: Check NGINX Version (Shell)\nDESCRIPTION: This command displays the NGINX version to ensure that NGINX Plus is installed correctly. The `-v` option instructs NGINX to print the version number and exit.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nsudo nginx -v\n```\n\n----------------------------------------\n\nTITLE: Generating RSA Key Pair with Encryption (OpenSSL)\nDESCRIPTION: This command generates an RSA private key, encrypting it using the DES3 algorithm.  It prompts the user for a passphrase to protect the key. This is a crucial step for securing the private key used for certificate generation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/apache-tomcat.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nroot# openssl genrsa -des3 -out ~/private-key.pem 2048\nGenerating RSA private key ...\nEnter pass phrase for private-key.pem:\n```\n\n----------------------------------------\n\nTITLE: Ansible Playbook for NGINX Installation\nDESCRIPTION: This is an Ansible playbook that uses the nginxinc.nginx role to install NGINX on the localhost.  It sets become to true, which enables privilege escalation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/microsoft-azure/virtual-machines-for-nginx.md#_snippet_3\n\nLANGUAGE: none\nCODE:\n```\n---\n- hosts: localhost\n  become: true\n  roles:\n    - role: nginxinc.nginx\n```\n\n----------------------------------------\n\nTITLE: Enabling Internal Routes Argument\nDESCRIPTION: This YAML snippet demonstrates the addition of the `-enable-internal-routes` argument to the Ingress Controller's container args. This argument is included only when egress is enabled, and it configures the Ingress Controller to handle internal routes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_19\n\nLANGUAGE: YAML\nCODE:\n```\nargs:\n  - -enable-internal-routes\n  ...\n```\n\n----------------------------------------\n\nTITLE: Enable NDK Module in Nginx Configuration\nDESCRIPTION: This Nginx configuration snippet demonstrates how to enable dynamic loading of the NDK module using the `load_module` directive. The module is loaded from the specified path, and the configuration is placed within the `http` context.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/ndk.md#_snippet_6\n\nLANGUAGE: nginx\nCODE:\n```\nload_module modules/ndk_http_module.so;\n\nhttp {\n    # ...\n}\n```\n\n----------------------------------------\n\nTITLE: Copying NGINX Module\nDESCRIPTION: This command copies the compiled dynamic module to the current directory and renames it to include the NGINX Open Source version. This helps in managing multiple versions of the dynamic module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_38\n\nLANGUAGE: shell\nCODE:\n```\ncp objs/ngx_http_hello_world.so ./ngx_http_hello_world_1.27.4.so\n```\n\n----------------------------------------\n\nTITLE: Configure Disk Upstream Authority in YAML\nDESCRIPTION: This YAML configuration configures SPIRE to use a root CA stored on disk as the upstream authority for issuing certificates. It specifies the paths to the certificate and private key files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/secure-traffic-mtls.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: v1\nupstreamAuthority: disk\nconfig:\n    cert_file_path: /path/to/rootCA.crt\n    key_file_path: /path/to/rootCA.key\n```\n\n----------------------------------------\n\nTITLE: Creating coffee application deployment and service\nDESCRIPTION: This YAML configuration creates a Kubernetes Deployment and Service for a sample \"coffee\" application. The Deployment defines a single replica running a container based on the `nginxdemos/nginx-hello:plain-text` image, exposing port 8080. The Service exposes the Deployment on port 80, routing traffic to the container's port 8080.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/https-termination.md#_snippet_0\n\nLANGUAGE: yaml\nCODE:\n```\nkubectl apply -f - <<EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: coffee\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: coffee\n  template:\n    metadata:\n      labels:\n        app: coffee\n    spec:\n      containers:\n      - name: coffee\n        image: nginxdemos/nginx-hello:plain-text\n        ports:\n        - containerPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: coffee\nspec:\n  ports:\n  - port: 80\n    targetPort: 8080\n    protocol: TCP\n    name: http\n  selector:\n    app: coffee\nEOF\n```\n\n----------------------------------------\n\nTITLE: Check NGINX Plus Version - Bash\nDESCRIPTION: This command checks the running version of NGINX Plus on the instance by using `ps aux` to list processes and `grep` to filter for nginx processes. The output will show the NGINX Plus version if it's running.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-plus-advanced-metrics.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nps aux | grep nginx\n```\n\n----------------------------------------\n\nTITLE: Example metric values response (JSON)\nDESCRIPTION: This JSON represents a sample response from the Azure Monitor API when retrieving metric values. It includes information like `cost`, `timespan`, `interval`, `value`, `namespace`, and `resourceregion`, along with the actual metric data points.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/monitoring/enable-monitoring.md#_snippet_5\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"cost\": 9,\n  \"timespan\": \"2024-03-27T20:00:00Z/2024-03-27T20:10:00Z\",\n  \"interval\": \"PT5M\",\n  \"value\": [\n    {\n      \"id\": \"/subscriptions/12345678-abcd-98765432-abcdef012345/resourceGroups/my-nginx-rg/providers/NGINX.NGINXPLUS/nginxDeployments/my-nginx-dep/providers/Microsoft.Insights/metrics/nginx.conn.current\",\n      \"type\": \"Microsoft.Insights/metrics\",\n      \"name\": {\n        \"value\": \"nginx.conn.current\",\n        \"localizedValue\": \"nginx.conn.current\"\n      },\n      \"unit\": \"Unspecified\",\n      \"timeseries\": [\n        {\n          \"metadatavalues\": [],\n          \"data\": [\n            {\n              \"timeStamp\": \"2024-03-27T20:00:00Z\",\n              \"average\": 4\n            },\n            {\n              \"timeStamp\": \"2024-03-27T20:05:00Z\",\n              \"average\": 4\n            }\n          ]\n        }\n      ],\n      \"errorCode\": \"Success\"\n    }\n  ],\n  \"namespace\": \"nginx connections statistics\",\n  \"resourceregion\": \"eastus2\"\n}\n```\n\n----------------------------------------\n\nTITLE: Example output of Kubernetes resources status\nDESCRIPTION: This text block is example output from the `kubectl get pods,svc` command, showing the status of the 'coffee' pod and service. It indicates that the pod is running and the service is available on a ClusterIP.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/https-termination.md#_snippet_2\n\nLANGUAGE: text\nCODE:\n```\nNAME                          READY   STATUS      RESTARTS   AGE\npod/coffee-6b8b6d6486-7fc78   1/1     Running   0          40s\n\n\nNAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE\nservice/coffee       ClusterIP   10.96.189.37   <none>        80/TCP    40s\n```\n\n----------------------------------------\n\nTITLE: Allow Egress Traffic Annotation\nDESCRIPTION: Configures a Pod to route all egress traffic through the NGINX Ingress Controller by adding the `config.nsm.nginx.com/default-egress-allowed` annotation to the Pod spec.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/deploy-with-kic.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\nconfig.nsm.nginx.com/default-egress-allowed: \"true\"\n```\n\n----------------------------------------\n\nTITLE: Getting NGINX Configuration Arguments\nDESCRIPTION: This command retrieves the arguments used to configure the currently installed NGINX instance. This is useful when recompiling NGINX with debugging enabled to maintain existing configuration settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/debugging.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nnginx -V 2>&1 | grep arguments\n```\n\n----------------------------------------\n\nTITLE: Kubernetes Dry-run Warning Message\nDESCRIPTION: This code snippet shows a warning message displayed during NGINX Controller installation on Red Hat Enterprise Linux 8. This message can be safely ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.3.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\nW0304 00:13:38.871876 1594252 helpers.go:553] --dry-run is deprecated and can be replaced with --dry-run=client.\n```\n\n----------------------------------------\n\nTITLE: Extract GZIP Archive\nDESCRIPTION: This command extracts the downloaded GZIP archive (`nginx-plus-certs.gz`) to obtain the certificate and key pair. It uses the `gunzip` utility.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/get-n-plus-cert-and-key.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\ngunzip nginx-plus-certs.gz\n```\n\n----------------------------------------\n\nTITLE: Deleting a RateLimit\nDESCRIPTION: Shows how to delete a RateLimit object using `kubectl`. This is a workaround for removing invalid RateLimits that cause issues with the NGINX Service Mesh control plane.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-1.6.0.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nkubectl delete ratelimit <ratelimit-name>\n```\n\n----------------------------------------\n\nTITLE: Committing and Pushing Changes to Internal Git Repository\nDESCRIPTION: This snippet demonstrates how to add, commit, and push changes to the internal repository. After committing locally, the code is pushed to the `internal` remote. Requires that the internal repository is configured as a remote.\nSOURCE: https://github.com/nginx/documentation/blob/main/CLOSED_CONTRIBUTIONS.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\ngit add .\ngit commit\ngit push internal\n```\n\n----------------------------------------\n\nTITLE: Create Nginx Config Directory - FreeBSD\nDESCRIPTION: Creates the /usr/local/etc/nginx directory on FreeBSD systems. This directory is used to store the NGINX configuration files, including the license.jwt file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_55\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /usr/local/etc/nginx\n```\n\n----------------------------------------\n\nTITLE: Testing NGINX Configuration (Shell)\nDESCRIPTION: This command tests the NGINX configuration file for syntax errors. It ensures that the configuration file is valid before reloading NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/opentelemetry.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\nnginx -t\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX Agent on FreeBSD\nDESCRIPTION: This command removes the NGINX Agent package using the pkg package manager on FreeBSD.  It requires root privileges to execute. This removes the installed nginx-agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/uninstall.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nsudo pkg delete nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Setting up YUM Repository (Amazon Linux 2)\nDESCRIPTION: Creates the /etc/yum.repos.d/nginx-agent.repo file with the specified contents to configure the yum repository for nginx-agent packages. This allows the yum package manager to find and install the nginx-agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_33\n\nLANGUAGE: none\nCODE:\n```\n[nginx-agent]\nname=nginx-agent repo\nbaseurl=https://pkgs.nginx.com/nginx-agent/amzn/2023/$releasever/$basearch\nsslclientcert=/etc/ssl/nginx/nginx-repo.crt\nsslclientkey=/etc/ssl/nginx/nginx-repo.key\ngpgcheck=0\nenabled=1\n```\n\n----------------------------------------\n\nTITLE: Installing Prometheus Module on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This command installs the nginx-plus-module-prometheus package using the yum package manager. It is designed for systems like Amazon Linux 2, CentOS, Oracle Linux, and RHEL. The command requires sudo privileges to install software packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/prometheus-njs.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install nginx-plus-module-prometheus\n```\n\n----------------------------------------\n\nTITLE: Get NGINX Ingress Controller Service IP\nDESCRIPTION: Retrieves the public IP address of the NGINX Ingress Controller service running in the `nginx-ingress` namespace. This IP is used to access applications exposed through the Ingress Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-walkthrough.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubectl get svc -n nginx-ingress\nNAME            TYPE           CLUSTER-IP    EXTERNAL-IP     PORT(S)                      AGE\nnginx-ingress   LoadBalancer   10.76.7.165   34.94.247.235   80:31287/TCP,443:31923/TCP   66s\n```\n\n----------------------------------------\n\nTITLE: Get System Assigned Managed Identity ID - Azure CLI\nDESCRIPTION: This snippet retrieves the principal ID of a system-assigned managed identity using the Azure CLI. It requires the `DEP_NAME` and `DEP_RESOURCE_GROUP` environment variables to be set. Specifically for System Assigned Identity.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/ssl-tls-certificates/overview.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nmi_principal_id=$(az nginx deployment show --name $DEP_NAME \\\n         --resource-group $DEP_RESOURCE_GROUP \\\n         --query identity.principalId --output tsv)\n```\n\n----------------------------------------\n\nTITLE: Copying the k8s-restore.sh Script - Shell\nDESCRIPTION: This command copies the `k8s-restore.sh` script from the extracted NGINX Management Suite Helm chart to the current working directory. This script is used to restore NGINX Management Suite deployed in a Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_13\n\nLANGUAGE: shell\nCODE:\n```\ncp nms-<version>/nms/charts/nms-hybrid/backup-restore/k8s-restore.sh .\n```\n\n----------------------------------------\n\nTITLE: Create Azure Private Endpoint - Azure CLI\nDESCRIPTION: Creates a private endpoint in a specified resource group and subnet, connecting to a Private Link service.  It automatically approves the connection request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/quickstart/security-controls/private-link-to-upstreams.md#_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\n$ az network private-endpoint create \\\n    --connection-name connection-1 \\\n    --name private-endpoint \\\n    --private-connection-resource-id $PRIVATE_LINK_SERVICE_ID \\\n    --resource-group $DEP_RESOURCE_GROUP \\\n    --subnet subnet-priv-endpoint \\\n    --manual-request false \\\n    --vnet-name $DEP_VNET_NAME\n```\n\n----------------------------------------\n\nTITLE: Successful NGINX Configuration Test Output\nDESCRIPTION: This is the expected output after running `nginx -t` if the configuration is valid.  It indicates that the syntax is ok and the configuration file is successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/perl.md#_snippet_8\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Printing NGINX Controller Logs (Bash)\nDESCRIPTION: This command uses the `helper.sh` script to print the NGINX Controller logs. It executes the script with the `logs` argument, which instructs the script to retrieve and display the logs from NGINX Controller.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/using-helper-script.md#_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh logs\n```\n\n----------------------------------------\n\nTITLE: Deploy Observability Components with Kubectl\nDESCRIPTION: This command applies the YAML configurations for Prometheus, Grafana, OpenTelemetry Collector, and Jaeger to a Kubernetes cluster. It creates the `nsm-monitoring` namespace and deploys the components within it, excluding sidecar injection for these deployments.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/observability.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f prometheus.yaml -f grafana.yaml -f otel-collector.yaml -f jaeger.yaml\n```\n\n----------------------------------------\n\nTITLE: Display traffic statistics for all Deployments\nDESCRIPTION: This command displays traffic statistics for all Deployments within the current or specified namespace, providing insight into request volume and performance.  It relies on the NGINX Service Mesh sidecar proxy to collect and report these statistics.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl top\n```\n\n----------------------------------------\n\nTITLE: Example of curl redirect response\nDESCRIPTION: This text block displays an example HTTP response from the curl command testing the HTTPS redirect. The `HTTP/1.1 302 Moved Temporarily` status code and the `Location` header (https://cafe.example.com/coffee) confirm that the request was successfully redirected to the HTTPS endpoint.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/https-termination.md#_snippet_8\n\nLANGUAGE: text\nCODE:\n```\nHTTP/1.1 302 Moved Temporarily\n...\nLocation: https://cafe.example.com/coffee\n...\n```\n\n----------------------------------------\n\nTITLE: Tag Docker Image\nDESCRIPTION: This command tags a Docker image with a new name and tag, typically used for pushing to a private registry. Replace `<my-docker-registry:port>` with the address and port of your private Docker registry and `<version>` with the version tag.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/deploy-api-connectivity-manager.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ndocker tag nms-acm:<version> <my-docker-registry:port>/nms-acm:<version>\n```\n\n----------------------------------------\n\nTITLE: Download apt configuration - Debian and Ubuntu\nDESCRIPTION: This command downloads the apt configuration file `90pkgs-nginx` from the NGINX website and saves it to the `/etc/apt/apt.conf.d` directory. This configuration file likely contains settings that influence how apt package management tool interacts with the NGINX repositories.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_21\n\nLANGUAGE: shell\nCODE:\n```\nsudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx\n```\n\n----------------------------------------\n\nTITLE: Expected output of Nginx Configuration Test\nDESCRIPTION: This shell output displays the expected result after testing the Nginx configuration file. This confirms that the `nginx.conf` file syntax is valid and the configuration is successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/image-filter.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Configuring precompiled_publication - Nginx Agent Configuration\nDESCRIPTION: This configuration changes the `precompiled_publication` setting to `false` in the `/etc/nginx-agent/nginx-agent.conf` file. This workaround addresses an issue where NGINX Agent sends an empty App Protect metadata structure to NGINX Instance Manager if App Protect is not yet installed. It prevents instance registration failure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/known-issues.md#_snippet_2\n\nLANGUAGE: text\nCODE:\n```\nprecompiled_publication = \"false\"\n```\n\n----------------------------------------\n\nTITLE: KQL Query for Blocked Requests by IP\nDESCRIPTION: This KQL query retrieves blocked requests by IP address from NGINX security logs in Azure Log Analytics. It extracts the client IP and summarizes the count of requests by IP and time.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/enable-logging.md#_snippet_6\n\nLANGUAGE: kql\nCODE:\n```\nNGXSecurityLogs\n| extend JSONLog = extract(@\"json_log\\s*=\\s*\\\"({.*?})\\\"\", 1, Message)\n| extend Log = parse_json(replace_string(JSONLog, '\"\"', '\"'))\n| where Log.enforcementAction == \"block\"\n| project ClientIP = tostring(Log.clientIp), TimeGenerated\n| summarize count() by ClientIP, bin(TimeGenerated, 1m)\n| render timechart\n```\n\n----------------------------------------\n\nTITLE: Uninstall NGINX Service Mesh Control Plane (nginx-meshctl)\nDESCRIPTION: This command uninstalls the NGINX Service Mesh control plane and its components from the Kubernetes cluster. It prompts for confirmation unless the `-y` flag is provided to skip the prompt.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/uninstall/uninstall.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl remove\n```\n\n----------------------------------------\n\nTITLE: Disabling NGINX Access Logs - Method 2\nDESCRIPTION: This snippet illustrates an alternative method to disable NGINX access logs by directing the log output to `/dev/null`.  This effectively discards all access log data.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nginxaas-azure/logging-config-access-logs.md#_snippet_2\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n\taccess_log /dev/null;\n}\n```\n\n----------------------------------------\n\nTITLE: Stop processes using ports 80 and 443\nDESCRIPTION: These commands stop any processes currently using ports 80 (HTTP) and 443 (HTTPS). This is often necessary to resolve conflicts that prevent the NGINX service from starting after an upgrade, ensuring NGINX can bind to the required ports.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/troubleshooting.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo fuser -k 80/tcp\n```\n\nLANGUAGE: bash\nCODE:\n```\nsudo fuser -k 443/tcp\n```\n\n----------------------------------------\n\nTITLE: Dockerfile for NGINX Plus with App Protect\nDESCRIPTION: This Dockerfile builds an NGINX Plus image with the App Protect WAF module. It uses CentOS 7 as the base image, installs necessary packages, configures NGINX repositories, installs the app-protect-module-plus package, configures logging, exposes port 80, and sets the default command to start Nginx.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/build-nginx-image-plus/build-centos.md#_snippet_0\n\nLANGUAGE: Dockerfile\nCODE:\n```\n# syntax=docker/dockerfile:1\n\n# Base image\nFROM centos:7\n\n# Install NGINX Plus and NGINX App Protect WAF v5 module\nRUN --mount=type=secret,id=nginx-crt,dst=/etc/ssl/nginx/nginx-repo.crt,mode=0644 \\\n    --mount=type=secret,id=nginx-key,dst=/etc/ssl/nginx/nginx-repo.key,mode=0644 \\\n    yum -y install wget ca-certificates epel-release \\\n    && wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo \\\n    && echo \"[app-protect-x-plus]\" > /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && echo \"name=nginx-app-protect repo\" >> /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && echo \"baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/7/$basearch/\" >> /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && echo \"sslclientcert=/etc/ssl/nginx/nginx-repo.crt\" >> /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && echo \"sslclientkey=/etc/ssl/nginx/nginx-repo.key\" >> /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && echo \"gpgcheck=0\" >> /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && echo \"enabled=1\" >> /etc/yum.repos.d/app-protect-7-x-plus.repo \\\n    && yum -y install app-protect-module-plus \\\n    && ln -sf /dev/stdout /var/log/nginx/access.log \\\n    && ln -sf /dev/stderr /var/log/nginx/error.log \\\n    && yum clean all \\\n    && rm -rf /var/cache/yum\n\n# Expose port\nEXPOSE 80\n\n# Define stop signal\nSTOPSIGNAL SIGQUIT\n\n# Set default command\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n----------------------------------------\n\nTITLE: Display traffic statistics for all Pods\nDESCRIPTION: This command displays traffic statistics for all Pods within the current or specified namespace. It provides detailed information about the incoming and outgoing traffic for each pod managed by NGINX Service Mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl top pods\n```\n\n----------------------------------------\n\nTITLE: Kubernetes server-dry-run error during NGINX Controller startup\nDESCRIPTION: This snippet shows an error message that may appear when starting NGINX Controller. The error indicates an unknown flag `--server-dry-run`. It also indicates an invalid patch for the analytics database, which the system attempts to resolve by restarting the analytics database. This error can be safely ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.7.md#_snippet_1\n\nLANGUAGE: text\nCODE:\n```\nError: unknown flag: --server-dry-run\nSee 'kubectl apply --help' for usage.\nDetected an invalid patch for the analytics database. Resolving conflicts and restarting the analytics database before running the update.\nstatefulset.apps/clickhouse patched\n```\n\n----------------------------------------\n\nTITLE: Installing NGINX ModSecurity WAF on SLES\nDESCRIPTION: This snippet shows how to install the NGINX ModSecurity WAF module package on SLES using the `zypper` package manager. It first refreshes the package list and then installs the specified module.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/nginx-waf.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper refresh && \\\nsudo zypper install nginx-plus-module-modsecurity\n```\n\n----------------------------------------\n\nTITLE: Install NGINX RTMP Module on Amazon Linux 2023, AlmaLinux, Rocky Linux\nDESCRIPTION: This shell script updates the system and installs the nginx-plus-module-rtmp package using dnf.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/rtmp.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nsudo dnf update && \\\nsudo dnf install nginx-plus-module-rtmp\n```\n\n----------------------------------------\n\nTITLE: Configure Custom Health Check - Citrix ADC\nDESCRIPTION: This configures a custom HTTP health check in Citrix ADC.  It adds a load balancing monitor named 'httphealth-ecv' which sends a GET request to the root path ('/') and expects the response body to contain the text 'Welcome to nginx!'. It then binds this monitor to the 'myapp' service group, enabling the custom health check.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration.md#_snippet_10\n\nLANGUAGE: none\nCODE:\n```\nadd lb monitor httphealth-ecv HTTP-ECV -send \"GET /\" -recv \"Welcome to nginx!\"\nbind serviceGroup myapp -monitorName httphealth-ecv\n```\n\n----------------------------------------\n\nTITLE: Run Kubernetes Support Package Script (Bash)\nDESCRIPTION: This command executes the `k8s-support-package.sh` script, which collects system and service information and packages it into a tar archive. The script is located within the downloaded NGINX Management Suite Helm chart directory. Requires `bash` 4.0 or higher.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/support/k8s-support-package.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nbash ./nms/charts/nms-hybrid/support-package/k8s-support-package.sh\n```\n\n----------------------------------------\n\nTITLE: Logging into a private Docker registry\nDESCRIPTION: This command logs into a private Docker registry. Replace <my-docker-registry> with the actual path to your private registry.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\ndocker login <my-docker-registry>\n```\n\n----------------------------------------\n\nTITLE: Output: Attack Signature Report Generation Success\nDESCRIPTION: Example JSON output showing the successful completion of the signature report generation. It includes file size, filename, and a boolean indicating success.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_26\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"file_size\": 1868596,\n    \"filename\": \"/path/to/signature-report.json\",\n    \"completed_successfully\": true\n}\n```\n\n----------------------------------------\n\nTITLE: Installing Gateway API Experimental Resources (kubectl)\nDESCRIPTION: This command uses kubectl to install Gateway API resources from the experimental channel on a Kubernetes cluster. It retrieves the resource definitions from a specified GitHub repository URL using kustomize and applies them to the cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/install-gateway-api-experimental-features.md#_snippet_0\n\nLANGUAGE: Shell\nCODE:\n```\nkubectl kustomize \"https://github.com/nginx/nginx-gateway-fabric/config/crd/gateway-api/experimental?ref=v{{< version-ngf >}}\" | kubectl apply -f -\n```\n\n----------------------------------------\n\nTITLE: Terraform Initialization and Apply\nDESCRIPTION: This snippet initializes a Terraform project, creates a plan, and applies the changes automatically. It's used to deploy and configure NGINXaaS on Azure.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configurations-terraform.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nterraform init\nterraform plan\nterraform apply --auto-approve\n```\n\n----------------------------------------\n\nTITLE: Use Page Token for Consistent Queries (curl)\nDESCRIPTION: This example demonstrates using a `pageToken` to ensure consistency across requests. Replace `<NMS_FQDN>`, `<access token>`, and the page token accordingly. The page token is obtained from the previous request's metadata.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_10\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"https://<NMS_FQDN>/api/platform/v1/analytics/events?pageToken=1573653786\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: NGINX App Protect Default Policy Directives\nDESCRIPTION: These directives reference the default NGINX App Protect WAF policies, either the default or strict policy.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/setup-waf-config-management.md#_snippet_28\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_policy_file /etc/nms/NginxDefaultPolicy.tgz;\n```\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_policy_file /etc/nms/NginxStrictPolicy.tgz;\n```\n\n----------------------------------------\n\nTITLE: Listing Archive Contents\nDESCRIPTION: This bash command lists the contents of the gzipped tar archive `nginx.tar.gz`, showing the directory structure and files within the archive.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/getting-started/nginx-configuration/nginx-configuration-portal.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n$ tar -tzf nginx.tar.gz\nnginx/\nnginx/nginx.conf\nnginx/njs.js\nnginx/servers\nnginx/servers/\nnginx/servers/server1.conf\nnginx/servers/server2.conf\n```\n\n----------------------------------------\n\nTITLE: Upstream Response Time Metrics\nDESCRIPTION: Describes the 'plus.upstream.response.time', 'plus.upstream.response.time.count', 'plus.upstream.response.time.max', 'plus.upstream.response.time.median', and 'plus.upstream.response.time.pctl95' metrics, which are gauges representing the average time to get the full response from the upstream servers. These metrics are useful for monitoring overall response latency.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_12\n\nLANGUAGE: none\nCODE:\n```\nType:        gauge, seconds.milliseconds\nDescription: Average time to get the full response from the upstream servers.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Description of system.io.iops_r and system.io.iops_w metrics\nDESCRIPTION: Provides the type and description for the system.io.iops_r and system.io.iops_w metrics which is a counter in integer representing Number of reads or writes per sampling window.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/os-metrics.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Number of reads or writes per sampling window.\n```\n\n----------------------------------------\n\nTITLE: Check Nginx Controller Agent Version (Ubuntu/Debian)\nDESCRIPTION: This command retrieves and displays the installed version of the NGINX Controller Agent on Ubuntu or Debian-based systems. It leverages the `dpkg` package manager to list installed packages.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_23\n\nLANGUAGE: bash\nCODE:\n```\ndpkg --list nginx-controller-agent\n```\n\n----------------------------------------\n\nTITLE: Hugo Command: Create New Content\nDESCRIPTION: This command uses the Hugo CLI to create a new content page with a specified filename and path. It defaults to the `default` archetype unless a different archetype is specified using the `-k` parameter.\nSOURCE: https://github.com/nginx/documentation/blob/main/CONTRIBUTING_DOCS.md#_snippet_1\n\nLANGUAGE: Bash\nCODE:\n```\n`hugo new content <product/folder/filename.md>`\n```\n\nLANGUAGE: Bash\nCODE:\n```\n`hugo new content <product/folder/filename.md> -k <archetype>`\n```\n\n----------------------------------------\n\nTITLE: APT Configuration Line\nDESCRIPTION: This is a configuration line used in `/etc/apt/sources.list` to configure package repository for APT package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_14\n\nLANGUAGE: text\nCODE:\n```\ndeb ${PACKAGES_URL}/deb/${os}/ ${codename} agent\n```\n\n----------------------------------------\n\nTITLE: Enable and start NGINX Instance Manager services\nDESCRIPTION: Enables and starts the NGINX Instance Manager platform services (nms, nms-core, nms-dpm, nms-ingestion, nms-integrations). This ensures that the services are running and will start automatically on boot.  The `--now` option starts the services immediately.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl enable nms nms-core nms-dpm nms-ingestion nms-integrations --now\n```\n\n----------------------------------------\n\nTITLE: Markdown example for Pull Request Creation\nDESCRIPTION: This snippet illustrates the Markdown structure for describing the creation of a pull request in a how-to guide, including the purpose of pull requests and step-by-step instructions with substeps.\nSOURCE: https://github.com/nginx/documentation/blob/main/templates/how-to/guide-how-to.md#_snippet_3\n\nLANGUAGE: markdown\nCODE:\n```\nCreate pull request\n\nPull requests are used to inform others of changes you have pushed to a branch in a repository. Once a pull request is opened, you can collaborate with reviewers and make changes before merging into the base branch.\n\n1. To create a pull request, do the following:\n\n   1.1. Navigate to the main page of your repository.\n\n   1.2. Under your repository name, click **Pull requests**. By default, all open pull requests are displayed.\n```\n\n----------------------------------------\n\nTITLE: Adding Internal Remote Repository using Git\nDESCRIPTION: This snippet shows how to add a closed (internal) repository as a remote to the local documentation repository, enabling the fetching of branches from the closed repository. It requires a valid git remote URL and the user should have access to the internal repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/CLOSED_CONTRIBUTIONS.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\ncd documentation\ngit remote add internal git@github.com:<closed-url>.git\ngit fetch\n```\n\n----------------------------------------\n\nTITLE: Create Nginx Config Directory - Linux\nDESCRIPTION: Creates the /etc/nginx directory on Linux systems. This directory is used to store the NGINX configuration files, including the license.jwt file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_54\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /etc/nginx\n```\n\n----------------------------------------\n\nTITLE: Nginx Policy Override with JSON\nDESCRIPTION: This JSON configuration defines a policy named \"override_rules_example2\" that uses override rules.  The \"this_rule_will_match\" rule is triggered if the URI contains \"api\".  When this rule matches, the policy is replaced by the external \"NginxStrictPolicy.json\" policy. The \"non_matching_rule\" contains an additional condition which prevents it from being matched.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/first-match-principle.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n  \"policy\": {\n    \"name\": \"override_rules_example2\",\n    \"template\": {\n      \"name\": \"POLICY_TEMPLATE_NGINX_BASE\"\n    },\n    \"override-rules\": [\n      {\n        \"name\": \"this_rule_will_match\",\n        \"condition\": \"uri.contains('api')\",\n        \"actionType\": \"replace-policy\",\n        \"override\": {\n          \"$ref\": \"file:///NginxStrictPolicy.json\"\n        }\n      },\n      {\n        \"name\": \"non_matching_rule\",\n        \"condition\": \"uri.contains('api') and not clientIp == '192.168.0.10'\",\n        \"actionType\": \"extend-policy\",\n        \"override\": {\n          \"policy\": {\n            \"enforcementMode\": \"transparent\"\n          }\n        }\n      }\n    ]\n  }\n}\n```\n\n----------------------------------------\n\nTITLE: Virtual Environment Setup and Package Installation\nDESCRIPTION: Sets up a virtual environment and installs necessary packages for gRPC development including grpcio, protobuf, and grpcio-tools. The virtual environment isolates dependencies for the project.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/services/publish-gRPC-proxy.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nvirtualenv echo-servers\nsource echo-servers/bin/activate\npip install grpcio protobuf grpcio-tools\n```\n\n----------------------------------------\n\nTITLE: Backing Up Private Key OpenSSL\nDESCRIPTION: This snippet creates a backup of the private key file to prevent data loss. It is crucial to backup the private key, as the certificate becomes unusable if the key is lost.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nroot# cp ~/private-key.pem secure-dir/private-key.pem.backup\n```\n\n----------------------------------------\n\nTITLE: Navigate to Nginx Configuration Directory\nDESCRIPTION: Changes the current directory to the Nginx configuration directory. This is required before downloading the config file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\nroot# cd /etc/nginx/conf.d\n```\n\n----------------------------------------\n\nTITLE: Load njs Module\nDESCRIPTION: This directive loads the NGINX JavaScript module (njs) within the top-level configuration context of NGINX Plus. It enables the handling of interactions between NGINX Plus and Okta.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/oidc-njs/okta.md#_snippet_0\n\nLANGUAGE: Nginx configuration file\nCODE:\n```\nload_module modules/ngx_http_js_module.so;\n```\n\n----------------------------------------\n\nTITLE: Backing up NGINX Management Suite (backup.sh) - Shell\nDESCRIPTION: This command executes the `backup.sh` script as a superuser, which backs up the NGINX Management Suite configuration files, secrets, and databases.  It assumes the user is already in the `/etc/nms/scripts` directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\ncd /etc/nms/scripts\nsudo ./backup.sh\n```\n\n----------------------------------------\n\nTITLE: Mermaid Diagram Example\nDESCRIPTION: This code snippet demonstrates how to include a Mermaid diagram within the documentation. Mermaid allows for the creation of visual diagrams using a code-based syntax, improving the clarity and understanding of complex systems or processes.\nSOURCE: https://github.com/nginx/documentation/blob/main/archetypes/tutorial.md#_snippet_0\n\nLANGUAGE: mermaid\nCODE:\n```\n# You can use Mermaid to draw diagrams in a codeblock with mermaid as the language.\n# Read their documentation for usage: https://mermaid.js.org/intro/\n```\n\n----------------------------------------\n\nTITLE: JSON Response for Filtered NGINX Statistics\nDESCRIPTION: This JSON snippet shows the structure and example values returned by the NGINX Plus API when querying the `/nginx` endpoint with the `fields` parameter to filter the response to include only version and build information.  It returns a JSON object with the specified fields.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_18\n\nLANGUAGE: json\nCODE:\n```\n{\n   \"version\" : \"1.27.4\",\n   \"build\" : \"nginx-plus-r34\"\n}\n```\n\n----------------------------------------\n\nTITLE: Kubernetes dry-run warning\nDESCRIPTION: Warning message displayed during NGINX Controller installation on RHEL 8 while checking Kubernetes. It indicates that `--dry-run` is deprecated. This message can be safely ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.6.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nW0304 00:13:38.871876 1594252 helpers.go:553] --dry-run is deprecated and can be replaced with --dry-run=client.\n```\n\n----------------------------------------\n\nTITLE: Run NGINX Controller Installation Script\nDESCRIPTION: Navigates to the extracted installer directory and executes the `install.sh` script to begin the NGINX Controller installation.  This script handles the configuration and setup of NGINX Controller. Requires the installer files to be extracted first.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/try-nginx-controller-app-sec.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./install.sh\n```\n\n----------------------------------------\n\nTITLE: Restart NGINX web server\nDESCRIPTION: Restarts the NGINX web server. This ensures that any configuration changes related to NGINX Instance Manager are applied.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_15\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart nginx\n```\n\n----------------------------------------\n\nTITLE: Installing Image-Filter Module on FreeBSD\nDESCRIPTION: This shell script updates the pkg package manager and installs the `nginx-plus-module-image-filter` package. This installs the image filter module for NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/image-filter.md#_snippet_5\n\nLANGUAGE: shell\nCODE:\n```\nsudo pkg update && \\\nsudo pkg install nginx-plus-module-image-filter\n```\n\n----------------------------------------\n\nTITLE: Specifying Dimensions in Nginx Metrics\nDESCRIPTION: This code snippet demonstrates how to specify which dimensions to include in the API response using the `dimensions` parameter. It retrieves the sum of `nginx.http.request.count` and includes only the `nginx_id` dimension.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/metrics-api.md#_snippet_14\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X GET --url \"<NMS_FQDN>/api/platform/v1/analytics/metrics?names=SUM(nginx.http.request.count)&dimensions=nginx_id&startTime=now-12h\" -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: JWT Example\nDESCRIPTION: This is an example of a JSON Web Token (JWT).  It consists of three parts separated by periods: header, payload, and signature. Line breaks have been added for readability; the actual JWT is a single string.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/policies/jwt-assertion.md#_snippet_0\n\nLANGUAGE: jwt\nCODE:\n```\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.\neyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.\nSflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\n```\n\n----------------------------------------\n\nTITLE: Install Prometheus using Helm\nDESCRIPTION: This snippet installs Prometheus using Helm. It adds the prometheus-community Helm repository, updates the repository, and then installs Prometheus into the monitoring namespace with a scrape interval of 15 seconds.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/monitoring/prometheus.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update\nhelm install prometheus prometheus-community/prometheus -n monitoring --create-namespace --set server.global.scrape_interval=15s\n```\n\n----------------------------------------\n\nTITLE: Editing Mesh Configuration with kubectl - Bash\nDESCRIPTION: This command allows you to edit the `meshconfig` resource, which contains the global mesh configuration, in the `nginx-mesh` namespace. It opens the default text editor to make changes to the resource. Requires `kubectl` to be installed and configured to connect to the Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/api-usage.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubectl edit meshconfig nginx-mesh-config -n nginx-mesh\n```\n\n----------------------------------------\n\nTITLE: Install Echo Server with Go\nDESCRIPTION: This shell script installs and starts the Echo Server using Go. It first disables the GO111MODULE, then uses `go get` to download and install the Echo Server. Finally, it sets environment variables and runs the Echo Server application. Requires Go to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_1\n\nLANGUAGE: Shell\nCODE:\n```\ngo env -w GO111MODULE=off\ngo get -u github.com/jmalloc/echo-server/...\nPORT=10000 LOG_HTTP_BODY=true LOG_HTTP_HEADERS=true echo-server\n```\n\n----------------------------------------\n\nTITLE: Reverting SELinux Permissions\nDESCRIPTION: This command reverts the SELinux permissions that were installed when the NGINX Controller Agent was initially installed on CentOS or Red Hat Enterprise Linux systems. This is a necessary step when uninstalling the agent and removing related files.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/manage-instances.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nsudo semodule -r nginx\n```\n\n----------------------------------------\n\nTITLE: Missing Policy Name Error Message (JSON)\nDESCRIPTION: This JSON snippet shows the error message that will be displayed when a policy 'name' is missing in the override rule. The error message specifies the policy that failed to import and the specific override rule where the 'name' is missing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/override-rules-errors-warnings.md#_snippet_1\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"error_message\": \"Failed to import Policy 'policy1' from '/etc/app_protect/conf/test.json': Missing policy 'name' in the override rule 'example-rule'.\"\n}\n```\n\n----------------------------------------\n\nTITLE: Workaround for Missing Components API Section\nDESCRIPTION: Provides a workaround for the missing `workloadGroup` section in the NGINX Controller REST API guide by referencing the OpenAPI Specification for the `workloadGroup`. It defines the structure and properties of WebWorkloadGroup, TcpUdpWorkloadGroup, WorkloadGroupCommon and WorkloadUri.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.21.md#_snippet_0\n\nLANGUAGE: text\nCODE:\n```\nWebWorkloadGroup:\n    description: Group of servers hosting a part of a Web application represented by a Component.\n    allOf:\n      - $ref: '#/components/schemas/WorkloadGroupCommon' # Settings common to Web and TCP/UDP workloadGroups.\n      - type: object\n        properties:\n          proxy:\n            $ref: '#/components/schemas/WebProxy' # Proxy retry and timeout settings applicable to servers in a Web workloadGroup.\n          sessionPersistence:\n            $ref: '#/components/schemas/SessionPersistence' # SessionPersistence settings in a Web workloadGroup.\n          uris:\n            type: object\n            description: |\n              The URI for a server hosting a part of a Web application.\n              It must conform to the format `schema://address[:port]`\n              where schema is chosen from http or https, address is IP or hostname,\n              schema and address must be provided.\n              For example:\n              - `http://192.0.2.247`\n              - `https://192.0.2.247:8443`\n              - `https://www.f5workload.com`\n            additionalProperties:\n              $ref: '#/components/schemas/WorkloadUri'\nTcpUdpWorkloadGroup:\n    description: Group of servers hosting a part of a TCP/UDP application represented by a Component.\n    allOf:\n      - $ref: '#/components/schemas/WorkloadGroupCommon' # Settings common to Web and TCP/UDP workloadGroups.\n      - type: object\n        properties:\n          proxy:\n            $ref: '#/components/schemas/TcpUdpProxy' # Proxy retry and timeout settings applicable to servers in a TcpUdp workloadGroup.\n          uris:\n            type: object\n            description: |\n              The URI for a server hosting a part of a TCP/UDP application.\n              The URI must conform to the format `schema://address:port`\n              where schema is chosen from tcp, udp, or tcp+tls, address is IP or hostname.\n              All three of schema, address, and port must be provided.\n              For example:\n              - `tcp://192.0.2.247:8443`\n              - `tcp+tls://192.0.2.247:8449`\n              - `udp://www.f5workload.com:989`\n            additionalProperties:\n              $ref: '#/components/schemas/WorkloadUri'\nWorkloadGroupCommon:\n    description: Settings common to Web and TCP/UDP workloadGroups.\n    type: object\n    properties:\n      locationRefs:\n        type: array\n        items:\n          $ref: 'https://gitlab.com/f5/nginx/controller/product/api-common/raw/master/schema/resource-common.yaml#/components/schemas/ResourceRef'\n      loadBalancingMethod:\n        $ref: '#/components/schemas/LoadBalancingMethod'\n      dnsServiceDiscovery:\n        $ref: '#/components/schemas/DNSServiceDiscovery'\n  WorkloadUri:\n    type: object\n    properties:\n      weight:\n        type: integer\n        minimum: 1\n        default: 1\n      maxConns:\n        type: integer\n        minimum: 0\n        default: 0\n      maxFails:\n        type: integer\n        minimum: 0\n        default: 1\n      failTimeout:\n        x-f5-experimental: true\n        type: string\n        default: 10s\n        pattern: '^[0-9]+[h|m|s]{1}$'\n      isBackup:\n        type: boolean\n        default: false\n      isDown:\n        type: boolean\n        default: false\n      route:\n        x-f5-experimental: true\n        type: string\n      srvService:\n        type: string\n      slowStart:\n        x-f5-experimental: true\n        type: integer\n        minimum: 0\n        default: 0\n      isDrain:\n        type: boolean\n        default: false\n```\n\n----------------------------------------\n\nTITLE: NS1 Agent YAML Configuration for NGINX Plus\nDESCRIPTION: This YAML configuration file configures the NS1 agent to collect metrics from NGINX Plus and send them to NS1. It defines the collection interval, retry time, NGINX Plus API endpoint, NS1 API key and source ID, and the services to monitor. Replace `<NS1-API-key>` and `<NS1-data-source-ID>` with the actual values obtained from the NS1 portal. The `feed_name` should match the data feed label created in NS1.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_0\n\nLANGUAGE: none\nCODE:\n```\nagent:\n  interval: 10\n  retry_time: 5\nnginx_plus:\n  hosts:\n    - host: \"127.0.0.1:8000\"\n      resolve: false\n      host_header: \"127.0.0.1:8000\"\n  api_endpoint: \"/api\"\n  client_timeout: 10\nnsone:\n  api_key: \"<NS1-API-key>\"\n  client_timeout: 10\n  source_id: \"<NS1-data-source-ID>\"\nservices:\n  method: \"upstream_groups\"\n  threshold: 2\n  sampling_type: \"count\"\n  feeds:\n    - name: \"my_backend\"\n    feed_name: \"<xx>-nginxgslb-datafeed\"\n```\n\n----------------------------------------\n\nTITLE: JWT Claims Example\nDESCRIPTION: This JSON snippet shows an example of the claims part of a JWT.  The 'claims' section contains key-value pairs with information like subject, name, issue timestamp, not-before time, and expiration time. These claims are used to verify the authenticity and validity of the token.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/json-web-token-overview.md#_snippet_0\n\nLANGUAGE: json\nCODE:\n```\n{\n  \"sub\": \"1234567890\",\n  \"name\": \"John Doe\",\n  \"iat\": 1654591231,\n  \"nbf\": 1654607591,\n  \"exp\": 1654608348\n}\n```\n\n----------------------------------------\n\nTITLE: Kubernetes NginxGateway Update Failed Event\nDESCRIPTION: An example event log showing that the NginxGateway failed to update due to an invalid configuration. The `Message` field provides details about the validation failure, specifically related to an unsupported logging level.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/overview/resource-validation.md#_snippet_11\n\nLANGUAGE: text\nCODE:\n```\nWarning  UpdateFailed  1s (x2 over 1s)  nginx-gateway-fabric-nginx  Failed to update control plane configuration: logging.level: Unsupported value: \"some-level\": supported values: \"info\", \"debug\", \"error\"\n```\n\n----------------------------------------\n\nTITLE: Deploy Destination Server using kubectl\nDESCRIPTION: This command deploys a destination server, which includes a Deployment, ConfigMap, and a Service, using the `destination.yaml` file. It relies on kubectl being configured and connected to the target Kubernetes cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/ratelimit-walkthrough.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f destination.yaml\n```\n\n----------------------------------------\n\nTITLE: NGINX Service Mesh CLI Config Usage\nDESCRIPTION: Provides information on how to use the `nginx-meshctl config` command, which displays the NGINX Service Mesh configuration. It includes the command's flags and global flags.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/reference/nginx-meshctl.md#_snippet_2\n\nLANGUAGE: txt\nCODE:\n```\nUsage:\n  nginx-meshctl config [flags]\n\nFlags:\n  -h, --help   help for config\n\nGlobal Flags:\n  -k, --kubeconfig string   path to kubectl config file (default \"/Users/<user>/.kube/config\")\n  -n, --namespace string    NGINX Service Mesh control plane namespace (default \"nginx-mesh\")\n  -t, --timeout duration    timeout when communicating with NGINX Service Mesh (default 5s)\n```\n\n----------------------------------------\n\nTITLE: Upstream Bytes Sent and Received Metrics\nDESCRIPTION: Describes the 'plus.upstream.bytes_rcvd' and 'plus.upstream.bytes_sent' metrics, which are counters that track the number of bytes received from and sent to the upstream servers, respectively. These metrics are useful for monitoring data transfer volumes.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/metrics-metadata/nginx-metrics.md#_snippet_9\n\nLANGUAGE: none\nCODE:\n```\nType:        counter, integer\nDescription: Number of bytes received from the upstream servers, and bytes sent.\nSource:      NGINX Plus status API\n```\n\n----------------------------------------\n\nTITLE: Defining Writable Volumes for NGINX in Kubernetes (YAML)\nDESCRIPTION: This snippet configures writable volumes for specific directories required by NGINX and App Protect when running with a read-only root filesystem. It mounts volumes to directories like `/tmp` and `/var/log/nginx`, which are essential for logs and temporary files. It also defines the volumes using `emptyDir` and `persistentVolumeClaim`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/nap-k8s-readonly-context.md#_snippet_1\n\nLANGUAGE: yaml\nCODE:\n```\ncontainers:\n    - name: nginx\n      ...\n      volumeMounts:\n           - name: app-protect-bd-config\n             mountPath: /opt/app_protect/bd_config\n           - name: app-protect-config\n             mountPath: /opt/app_protect/config\n           - name: tmp-volume\n             mountPath: /tmp\n           - name: nginx-log\n             mountPath: /var/log/nginx\n           - name: app-protect-bundles\n             mountPath: /etc/app_protect/bundles\n...\n\nvolumes:\n        - name: app-protect-bd-config\n          emptyDir: {}\n        - name: app-protect-config\n          emptyDir: {}\n        - name: nginx-log\n          emptyDir: {}\n        - name: tmp-volume\n          emptyDir: {}\n        - name: app-protect-bundles\n          persistentVolumeClaim:\n            claimName: nap5-bundles-pvc \n```\n\n----------------------------------------\n\nTITLE: Installing NGINX Agent (Alpine Linux)\nDESCRIPTION: Installs the nginx-agent package on Alpine Linux using the apk package manager. This command installs the NGINX Agent software on the system.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_25\n\nLANGUAGE: shell\nCODE:\n```\nsudo apk add nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Verifying NS1 Traffic Redistribution with nslookup\nDESCRIPTION: This command uses `nslookup` to query the DNS record for `nginxgslb.cf` and determine the IP address returned by NS1.  It's used to verify that NS1 is correctly routing traffic based on the availability and proximity of NGINX Plus instances.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\n$ nslookup nginxgslb.cf\n\nServer:     10.10.100.102\nAddress:    10.10.100.102#53\n\nNon-authoritative answer:\nName:\tnginxgslb.cf\nAddress: 10.10.10.1\n```\n\n----------------------------------------\n\nTITLE: Generating a Support Package\nDESCRIPTION: This command generates a comprehensive support package containing logs, component yaml files, events, Pod descriptions, and more, which can be used for debugging and troubleshooting NGINX Service Mesh deployments. The generated tar file provides a snapshot of the system's state.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/support/contact-support.md#_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\nnginx-meshctl supportpkg\n```\n\n----------------------------------------\n\nTITLE: Downloading NGINX App Protect WAF Files\nDESCRIPTION: These are the file names needed to be downloaded from My F5 for configuring the NGINX App Protect WAF subscription.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/download-certificates.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nnginx-repo.key\nnginx-repo.crt\n```\n\n----------------------------------------\n\nTITLE: Fetching NGINX Signing Key\nDESCRIPTION: Downloads the official NGINX signing key from nginx.org and saves it to /tmp/nginx_signing.rsa.pub. This key is used to verify the authenticity of the nginx-agent package.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/installation-plus.md#_snippet_22\n\nLANGUAGE: shell\nCODE:\n```\ncurl -o /tmp/nginx_signing.rsa.pub https://nginx.org/keys/nginx_signing.rsa.pub\n```\n\n----------------------------------------\n\nTITLE: Running User Defined Signatures Converter\nDESCRIPTION: Executes the User Defined Signatures Converter tool without arguments. This displays the help message and usage instructions, because required arguments are missing.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/configuration-guide/configuration.md#_snippet_17\n\nLANGUAGE: shell\nCODE:\n```\n/opt/app_protect/bin/convert-signatures\n```\n\n----------------------------------------\n\nTITLE: Updating NGINX Instance Manager on Debian-based systems\nDESCRIPTION: These commands update the NGINX Instance Manager package on Debian, Ubuntu, and other Debian-based systems using the `apt-get` package manager. The `apt-get update` command updates the package lists, and `apt-get install` installs the latest version of the package, upgrading only the specified package due to `--only-upgrade` option.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/deploy/vm-bare-metal/install-nim-deprecated.md#_snippet_17\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get update\nsudo apt-get install -y --only-upgrade nms-instance-manager\n```\n\n----------------------------------------\n\nTITLE: Deploying NGINX Service Mesh with Openshift Environment - Bash\nDESCRIPTION: This bash command demonstrates how to deploy the NGINX Service Mesh in an Openshift environment using the `--environment` flag. This flag specifies the platform the mesh is being deployed on and configures the deployment appropriately. Openshift requires specific configurations detailed in the linked documentation.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/install/configuration.md#_snippet_7\n\nLANGUAGE: Bash\nCODE:\n```\nnginx-meshctl deploy ... --environment \"openshift\"\n```\n\n----------------------------------------\n\nTITLE: Restart Controller Agent Service (Linux Bash)\nDESCRIPTION: Restarts the NGINX Controller Agent service on a Linux system. This command is used in conjunction with restarting the nginx service to resolve issues with statistics updates after upgrading to NGINX Controller 3.8.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_26\n\nLANGUAGE: bash\nCODE:\n```\nservice controller-agent restart\n```\n\n----------------------------------------\n\nTITLE: Setting Environment Variables\nDESCRIPTION: This code snippet sets two environment variables in the shell: GW_IP, which represents the public IP address of the NGINX Gateway Fabric, and GW_PORT, which specifies the port number of the gateway. These variables are used later in commands to access the gateway.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-security/securing-backend-traffic.md#_snippet_6\n\nLANGUAGE: text\nCODE:\n```\nGW_IP=XXX.YYY.ZZZ.III\nGW_PORT=<port number>\n```\n\n----------------------------------------\n\nTITLE: Create Kind Cluster (Make)\nDESCRIPTION: This command creates a Kubernetes cluster using kind, using a make command. This is an alternative to using the kind command directly, provided that the NGINX Gateway Fabric repository has been cloned. This command is executed from the root folder of the repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/get-started.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nmake create-kind-cluster\n```\n\n----------------------------------------\n\nTITLE: Upgrade NGINX Plus - Debian\nDESCRIPTION: Upgrades the NGINX Plus package using apt on Debian and Ubuntu systems.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_59\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt update\nsudo apt install nginx-plus\n```\n\n----------------------------------------\n\nTITLE: Configuring NGINX App Protect Repository\nDESCRIPTION: This snippet shows the configuration file for the NGINX App Protect WAF repository.  It defines the repository name, base URL, SSL client certificate and key paths for authentication, disables GPG check, and enables the repository. The `$basearch` variable is replaced by the system's architecture.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/v5/host-based-nginx-instructions/nginx-oss-amazon.md#_snippet_1\n\nLANGUAGE: none\nCODE:\n```\n[app-protect-x-oss]\nname=nginx-app-protect repo\nbaseurl=https://pkgs.nginx.com/app-protect-x-oss/amzn/2023/$basearch/\nsslclientcert=/etc/ssl/nginx/nginx-repo.crt\nsslclientkey=/etc/ssl/nginx/nginx-repo.key\ngpgcheck=0\nenabled=1\n```\n\n----------------------------------------\n\nTITLE: Example Response for Single Event Query (JSON)\nDESCRIPTION: This example shows the JSON response when querying a single event by its UUID. It contains the details of the event, such as category, dimensions, ID, level, message, status, and timestamp.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/monitoring/view-events-metrics.md#_snippet_13\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"category\": \"agent status\",\n    \"dimensions\": {\n        \"alias\": \"devenv-agent\",\n        \"hostname\": \"devenv-agent\",\n        \"instance\": \"3d54a8fe-7c90-374f-9cad-fa2b8fccb0cd\",\n        \"nginx_id\": \"3d54a8fe-7c90-374f-9cad-fa2b8fccb0cd\",\n        \"system_id\": \"3d54a8fe-7c90-374f-9cad-fa2b8fccb0cd\"\n    },\n    \"id\": \"7cb91de6-49ae-4ddc-a8b3-3255e00b9346\",\n    \"level\": \"INFO\",\n    \"message\": \"nginx-agent v2.11.0 started on devenv-agent\",\n    \"status\": \"Agent Start\",\n    \"timestamp\": \"2022-03-21T14:33:37Z\"\n}\n```\n\n----------------------------------------\n\nTITLE: Starting Controller Agent Service - Bash\nDESCRIPTION: This command starts the `controller-agent` service on a Linux system, using `systemctl`. It is run after upgrading to NGINX Controller v3.15 to address issues related to TCP/UDP traffic misreporting. Root or sudo access is required.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nsystemctl start controller-agent\n```\n\n----------------------------------------\n\nTITLE: List Supported Log Categories for NGINXaaS - Azure CLI\nDESCRIPTION: This command retrieves the supported log categories for an NGINX as a Service for Azure resource using the Azure CLI.  It requires the NGINXaaS resource ID as input.  The command output will list the available log categories that can be configured for diagnostic settings.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/monitoring/enable-logging/logging-using-cli.md#_snippet_2\n\nLANGUAGE: Shell\nCODE:\n```\naz monitor diagnostic-settings list --resource <nginxaas_resource_id>\n```\n\n----------------------------------------\n\nTITLE: OpenSSL MD5 Hash Verification (Shell)\nDESCRIPTION: This command verifies that OpenSSL is running in FIPS mode by attempting to compute the MD5 hash of /dev/null.  MD5 is not a permitted hash algorithm in FIPS mode, so a failure indicates FIPS mode is enabled.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/fips-compliance-nginx-plus.md#_snippet_2\n\nLANGUAGE: shell\nCODE:\n```\nopenssl md5 /dev/null\nError setting digest md5\n140647163811744:error:060800A3:digital envelope routines:EVP_DigestInit _ex:disabled for fips:digest.c:251:\n```\n\n----------------------------------------\n\nTITLE: Start Docker Service\nDESCRIPTION: This snippet demonstrates starting the Docker service using `systemctl`.  This is a step in the workaround for an issue encountered during NGINX Controller installation on CentOS 7.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_41\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start docker\n```\n\n----------------------------------------\n\nTITLE: NGINX Server Configuration for API Base Path\nDESCRIPTION: This snippet configures the server section in the NGINX configuration file to define the base path for the API. This is required when using an API doc with a proxy and helps in resolving issues related to incorrect API paths. The `Servers` directive specifies the URL for the API.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_4\n\nLANGUAGE: nginx\nCODE:\n```\nServers:\n- url: https://(API-address)/api/v3\n```\n\n----------------------------------------\n\nTITLE: Start NGINX Controller using helper script\nDESCRIPTION: This command is used to start the NGINX Controller services using the provided helper script. It's a part of the workaround to restore functionality after a failed upgrade.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_15\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/helper.sh controller start\n```\n\n----------------------------------------\n\nTITLE: Enabling the Nginx Plus Dashboard Nginx\nDESCRIPTION: This snippet enables the Nginx Plus Dashboard by specifying a location block for `/dashboard.html`. The `root` directive specifies the directory where the dashboard files are located.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/monitoring/live-activity-monitoring.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    # ...\n    server {\n        listen 192.168.1.23;\n        # ...\n        location /api {\n            limit_except GET {\n                auth_basic \"NGINX Plus API\";\n                auth_basic_user_file /path/to/passwd/file;\n            }\n            api   write=on;\n            allow 192.168.1.0/24;\n            deny  all;\n        }\n        location = /dashboard.html {\n            root   /usr/share/nginx/html;\n        }\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Saving the waf-config-mgr Docker image to a tar file\nDESCRIPTION: This snippet saves the `waf-config-mgr` Docker image to a tar file for transferring to an offline machine. Replace `5.2.0` with the actual release version.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_41\n\nLANGUAGE: shell\nCODE:\n```\ndocker save -o waf-config-mgr.tar waf-config-mgr:5.2.0\n```\n\n----------------------------------------\n\nTITLE: Apply Bookinfo Ingress\nDESCRIPTION: Applies the `bookinfo-ingress.yaml` file to create an Ingress resource. This resource exposes the Bookinfo application using the specified host and paths.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-walkthrough.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nkubectl apply -f bookinfo-ingress.yaml\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Open Source (Alpine Linux)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Open Source package from Alpine Linux. It uses the `apk del` command to remove the `app-protect-module-oss` package. Requires root privileges and the apk package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_48\n\nLANGUAGE: shell\nCODE:\n```\nsudo apk del app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Modify File Permissions for CA Certificate (bash)\nDESCRIPTION: This command uses `sudo` to modify the permissions of the CA certificate file located at `/etc/kubernetes/pki/ca.crt`. It sets the permissions to 644, allowing the owner to read and write, and the group and others to read the file. This is used as a workaround to resolve permission denied errors during NGINX Controller updates.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_17\n\nLANGUAGE: bash\nCODE:\n```\nsudo chmod 644 /etc/kubernetes/pki/ca.crt\n```\n\n----------------------------------------\n\nTITLE: Verify NFS Mounts\nDESCRIPTION: These commands are used to verify the NFS mounts.  They include mounting all filesystems from `/etc/fstab`, checking disk space, listing directory contents, testing network connectivity and checking the NFS server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/system-configuration/configure-high-availability.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nsudo mount -a\ndf -h\nls -lart /mnt/nfs_share/clickhouse\nls -lart /var/lib/nms\nsudo ls -lart /var/lib/clickhouse\ntelnet <NFS_SERVER_IP> 2049\nrpcinfo -p <NFS_SERVER_IP>\nsudo showmount -e <NFS_SERVER_IP>\ndmesg | grep nfs\n```\n\n----------------------------------------\n\nTITLE: Stop NGINX Amplify Agent Service (Bash)\nDESCRIPTION: Stops the NGINX Amplify Agent service using the `service` command. It assumes the `amplify-agent` service is managed by systemd or a similar service manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/installing-amplify-agent.md#_snippet_17\n\nLANGUAGE: bash\nCODE:\n```\nservice amplify-agent stop\n```\n\n----------------------------------------\n\nTITLE: Running Custom Signature Report Image\nDESCRIPTION: This example shows how to run a custom Docker image (tagged as `waf-sig-reporter-<version-tag>:custom`) that uses the `get-signatures` tool as its entrypoint. It generates a signature report with the specified fields. This command assumes that the Dockerfile sets the entrypoint to `/opt/app_protect/bin/get-signatures`\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_27\n\nLANGUAGE: shell\nCODE:\n```\nsudo docker run --rm \\\n -v $(pwd):$(pwd) \\\n waf-sig-reporter-<version-tag>:custom \\\n -o $(pwd)/signature-report.json --fields=name,signatureId\n```\n\n----------------------------------------\n\nTITLE: Logging into Docker Registry with SSL Certificates\nDESCRIPTION: This command logs into the Docker registry using SSL certificates. The certificates need to be properly configured in the /etc/docker/certs.d/private-registry.nginx.com directory before running this command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-docker.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\ndocker login private-registry.nginx.com\n```\n\n----------------------------------------\n\nTITLE: Uninstalling NGINX App Protect WAF Open Source (Ubuntu 24.04)\nDESCRIPTION: This command uninstalls the NGINX App Protect WAF Open Source package from Ubuntu 24.04. It uses the `apt-get remove` command to remove the `app-protect-module-oss` package. Requires root privileges and the apt package manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/install.md#_snippet_70\n\nLANGUAGE: shell\nCODE:\n```\nsudo apt-get remove app-protect-module-oss\n```\n\n----------------------------------------\n\nTITLE: Installing Xerces-C on RHEL 8\nDESCRIPTION: This code snippet provides a workaround for an issue where the NGINX Controller Agent fails to install on Red Hat Enterprise Linux 8 due to a missing Xerces-C library package. It involves downloading and installing the Xerces-C RPM package from the EPEL Fedora repository. This resolves a dependency issue preventing the metrics module from installing correctly.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nwget https://download-ib01.fedoraproject.org/pub/epel/8/Everything/x86_64/Packages/x/xerces-c-3.2.2-3.el8.x86_64.rpm\nsudo rpm -Uvh xerces-c-3.2.2-3.el8.x86_64.rpm\n```\n\n----------------------------------------\n\nTITLE: Check if NGINX Agent is running\nDESCRIPTION: This command checks if a previous version of NGINX Agent is running. It lists all processes and filters for those containing 'nginx-agent'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/nginx-agent/install-nginx-agent.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nps aux | grep nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Remove nginx package on Alpine\nDESCRIPTION: This command removes the community-supported NGINX package and any associated modules from Alpine Linux.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_24\n\nLANGUAGE: Shell\nCODE:\n```\nsudo apk del -r nginx\n```\n\n----------------------------------------\n\nTITLE: Send UDP Message with netcat\nDESCRIPTION: This command sends a UDP message to the `udp-listener` application using `netcat`. It echoes the message \"UDP Datagram Message\" and pipes it to `nc` (netcat) which sends it as a UDP packet to the specified IP address and port.  The IP and port should be the worker node IP and the exposed UDP port from the Nginx Ingress Controller service.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-udp-walkthrough.md#_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\necho \"UDP Datagram Message\" | nc -u 12.115.30.1 31839\n```\n\n----------------------------------------\n\nTITLE: Defining API server block in Nginx\nDESCRIPTION: This code snippet demonstrates how to define a server block within the http context in your Nginx configuration to handle the App Protect DoS REST API. This block acts as the entry point for API requests.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/live-activity-monitoring.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\nhttp {\n    server {\n        # insert your API configuration here\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: Setting Up Mainline NGINX Repository on SUSE\nDESCRIPTION: This command adds the official NGINX mainline repository to the zypper package manager on SUSE, enabling the system to install and update NGINX packages from the official mainline source. It specifies gpgcheck, type yum, refresh, and check options for the repository.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-open-source.md#_snippet_32\n\nLANGUAGE: shell\nCODE:\n```\nsudo zypper addrepo --gpgcheck --type yum --refresh --check \\\n        'http://nginx.org/packages/mainline/sles/$releasever_major' nginx-mainline\n```\n\n----------------------------------------\n\nTITLE: JQ Dependency Check - Bash\nDESCRIPTION: This snippet checks if `jq` is installed. If it's not, it prints an error message and exits. `jq` is a command-line JSON processor required for parsing the API responses from NGINX Instance Manager.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nim/disconnected/license-usage-offline-script.md#_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nif ! command -v jq &> /dev/null; then\n\techo -e \"\\nPlease install jq (https://jqlang.github.io/jq/) as it is required to run the script\\n\"\n\texit 1\nfi\n```\n\n----------------------------------------\n\nTITLE: Expected output when testing Nginx configuration\nDESCRIPTION: These shell commands represents the expected output after running the `nginx -t` command. This output indicates that the configuration file is syntactically correct and that the test was successful.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/ndk.md#_snippet_9\n\nLANGUAGE: shell\nCODE:\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf is successful\n```\n\n----------------------------------------\n\nTITLE: Start Keycloak in Development Mode\nDESCRIPTION: This shell script navigates to the Keycloak directory and starts Keycloak in development mode.  Development mode is suitable for testing and experimentation but is not recommended for production environments.  Requires Keycloak to be extracted in the current directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/tutorials/introspection-keycloak.md#_snippet_5\n\nLANGUAGE: Shell\nCODE:\n```\ncd keycloak-${KEYCLOAK_VERSION}/\nbin/kc.sh start-dev\n```\n\n----------------------------------------\n\nTITLE: Stopping the NGINX Agent\nDESCRIPTION: Command to stop the NGINX Agent on the Developer Portal as part of a workaround for an environment transitioning to a Failed status when WAF is enabled and a Developer Portal cluster is added.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/releases/known-issues.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl stop nginx-agent\n```\n\n----------------------------------------\n\nTITLE: Create Agent Dynamic Configuration - FreeBSD\nDESCRIPTION: This command creates the `agent-dynamic.conf` file in FreeBSD environments, which is required for NGINX Agent to run. It requires `sudo` privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/agent/installation-upgrade/getting-started.md#_snippet_3\n\nLANGUAGE: shell\nCODE:\n```\nsudo touch /var/db/nginx-agent/agent-dynamic.conf\n```\n\n----------------------------------------\n\nTITLE: Create Custom Resources for Nginx Service Mesh via Kubectl\nDESCRIPTION: This command recreates the custom resources from the previously backed up YAML files. It's executed after the mesh is reinstalled in a manual upgrade.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/upgrade/upgrade-with-helm.md#_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\nkubectl create -f trafficsplits.yaml -f traffictargets.yaml -f httproutegroups.yaml -f tcproutes.yaml -f ratelimits.yaml -f circuitbreakers.yaml\n```\n\n----------------------------------------\n\nTITLE: Example Restart Deployment\nDESCRIPTION: This is an example of restarting a deployment named 'frontend' to remove the sidecar injected by the NGINX Service Mesh. This is a specific application of the `kubectl rollout restart` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/get-started/uninstall/uninstall-with-helm.md#_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\nkubectl rollout restart deployment/frontend\n```\n\n----------------------------------------\n\nTITLE: Successful coffee application response\nDESCRIPTION: This snippet demonstrates the expected response from the coffee application after sending a POST request that is within the configured client_max_body_size limit.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/ngf/how-to/traffic-management/client-settings.md#_snippet_14\n\nLANGUAGE: text\nCODE:\n```\nServer address: 10.244.0.6:8080\nServer name: coffee-56b44d4c55-7ldjc\n```\n\n----------------------------------------\n\nTITLE: Making Kubernetes Restore Script Executable (chmod)\nDESCRIPTION: This command makes the `k8s-restore.sh` script executable. This is a necessary step before running the script. It depends on the `chmod` utility being available.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/maintenance/backup-and-recovery.md#_snippet_16\n\nLANGUAGE: shell\nCODE:\n```\nchmod +x k8s-restore.sh\n```\n\n----------------------------------------\n\nTITLE: Install NGINX RTMP Module on Alpine\nDESCRIPTION: This shell script installs the nginx-plus-module-rtmp package using apk.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/rtmp.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\napk add nginx-plus-module-rtmp\n```\n\n----------------------------------------\n\nTITLE: Sample Keepalived Configuration (Ubuntu)\nDESCRIPTION: This is a sample `keepalived.conf` file for Ubuntu, showing the global definitions, VRRP scripts, and VRRP instance configuration.  It includes markers for NGINX Controller HA configurations. The interface and IP addresses need to be modified to match the deployment environment.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/infrastructure/instances/ha-data-plane.md#_snippet_3\n\nLANGUAGE: plaintext\nCODE:\n```\nglobal_defs {\n        vrrp_version 3\n}\n\nvrrp_script chk_manual_failover {\n        script \"/usr/lib/keepalived/nginx-ha-manual-failover\"\n        interval 10\n        weight 50\n}\n\nvrrp_script chk_nginx_service {\n        script \"/usr/lib/keepalived/nginx-ha-check\"\n        interval 3\n        weight 50\n}\n\nvrrp_instance VI_1 {\n        interface ens32\n        priority 101\n        virtual_router_id 51\n        advert_int 1\n        accept\n        garp_master_refresh 5\n        garp_master_refresh_repeat 1\n        unicast_src_ip 192.168.100.100\n        unicast_peer {\n                192.168.100.101\n        }\n        virtual_ipaddress {\n#NGINX_CONTROLLER_HA_BEGIN\n#NGINX_CONTROLLER_HA_END\n        }\n        track_script {\n                chk_nginx_service\n                chk_manual_failover\n        }\n        notify \"/usr/lib/keepalived/nginx-ha-notify\"\n}\n```\n\n----------------------------------------\n\nTITLE: Uninstall Nginx Controller\nDESCRIPTION: This command is used to uninstall NGINX Controller. It is typically run on the server where NGINX Controller is installed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_21\n\nLANGUAGE: bash\nCODE:\n```\n/opt/nginx-controller/uninstall.sh\n```\n\n----------------------------------------\n\nTITLE: Start NMS Service (bash)\nDESCRIPTION: This command starts the `nms` (NGINX Management Suite) service after rotating encryption keys. It requires sudo privileges.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-instances/manage-certificates.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl start nms\n```\n\n----------------------------------------\n\nTITLE: Installing Image-Filter Module on Amazon Linux 2, CentOS, Oracle Linux, and RHEL\nDESCRIPTION: This shell script updates the yum package manager and installs the `nginx-plus-module-image-filter` package. This will install the image filter module for NGINX.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/dynamic-modules/image-filter.md#_snippet_0\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum update && \\\nsudo yum install nginx-plus-module-image-filter\n```\n\n----------------------------------------\n\nTITLE: Granting Permissions on App Components - NGINX Config\nDESCRIPTION: This NGINX configuration snippet demonstrates granting `WRITE` permission to an app component and `READ` permission to the referenced gateway and location. This allows the app component to be modified while ensuring the gateway and location can be viewed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/app-delivery/security/tutorials/using-rbac-with-app-security.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\n{\n   \"path\": \"/services/environments/env-name/apps/app-name/components/component-name\",\n   \"access\": \"WRITE\"\n},\n{\n   \"path\": \"/services/environments/env-name/gateways/gateway-name\",\n   \"access\": \"READ\"\n},\n{\n   \"path\": \"/infrastructure/locations/location-name/\",\n   \"access\": \"READ\"\n}\n```\n\n----------------------------------------\n\nTITLE: Install Nginx Controller\nDESCRIPTION: This command is used to install NGINX Controller.  It is executed from the directory containing the installer files after navigating into it using `cd controller-installer`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_22\n\nLANGUAGE: bash\nCODE:\n```\ncd controller-installer\n./install.sh\n```\n\n----------------------------------------\n\nTITLE: Enabling Server Technology and Minimum Accuracy - JSON\nDESCRIPTION: This snippet enables the 'Apache/NCSA HTTP Server' server technology and sets the minimum accuracy for automatically added signatures to 'low'. This includes low, medium, and high accuracy signatures specific to the Apache server.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/nap-waf/config/common/signature-sets.md#_snippet_8\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"policy\": {\n        \"name\": \"policy_name\",\n        \"template\": { \"name\": \"POLICY_TEMPLATE_NGINX_BASE\" },\n        \"applicationLanguage\": \"utf-8\",\n        \"enforcementMode\": \"blocking\",\n        \"signature-settings\": {\n            \"minimumAccuracyForAutoAddedSignatures\": \"low\"\n        },\n        \"server-technologies\": [\n            {\n                \"serverTechnologyName\": \"Apache/NCSA HTTP Server\"\n            }\n        ]\n    }\n}\n```\n\n----------------------------------------\n\nTITLE: eBPF Failure Log Event JSON\nDESCRIPTION: This JSON snippet represents an eBPF failure event in NGINX App Protect DoS. It indicates that a worker process failed to connect to eBPF maps. The event includes the worker PID, the current mode (failure), and a flag indicating whether the mode has changed.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-dos/monitoring/operation-log.md#_snippet_5\n\nLANGUAGE: json\nCODE:\n```\n{\n    \"event\": \"ebpf_failure\",\n    \"worker_pid\": 4928,\n    \"mode\": \"failure\",\n    \"mode_changed\": true\n}\n```\n\n----------------------------------------\n\nTITLE: NGINX Version Output\nDESCRIPTION: Example of the output after executing the command to verify NGINX Plus Version. Shows the NGINX version and NGINX Plus release.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_63\n\nLANGUAGE: shell\nCODE:\n```\nnginx version: nginx/1.27.4 (nginx-plus-r34)\n```\n\n----------------------------------------\n\nTITLE: Enable Security Logs in NGINX Configuration\nDESCRIPTION: This snippet demonstrates how to enable NGINX App Protect security logs within an NGINX configuration file.  It enables security logging and directs logs to a specified destination.  Ensure the app_protect_security_log_enable directive is set to `on`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginxaas-azure/app-protect/enable-logging.md#_snippet_0\n\nLANGUAGE: nginx\nCODE:\n```\napp_protect_security_log_enable on;\n```\n\n----------------------------------------\n\nTITLE: Check Nginx Version with Stub Status Module (Bash)\nDESCRIPTION: This command checks the Nginx version and verifies if the `stub_status` module is included in the Nginx build. Although the correction states the NGINX Controller Agent gathers metrics via the Nginx Plus API, the command is shown as an example of a check.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_27\n\nLANGUAGE: bash\nCODE:\n```\nnginx -V\n```\n\n----------------------------------------\n\nTITLE: OpenAPI Specification for workloadGroup\nDESCRIPTION: This OpenAPI specification defines the structure and properties of `WebWorkloadGroup`, `TcpUdpWorkloadGroup`, `WorkloadGroupCommon`, and `WorkloadUri` for the NGINX Controller REST API. It describes the schema for defining groups of servers hosting parts of web or TCP/UDP applications, including settings for proxy, session persistence, URIs, load balancing methods, and DNS service discovery.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/release-notes.md#_snippet_2\n\nLANGUAGE: text\nCODE:\n```\nWebWorkloadGroup:\n        description: Group of servers hosting a part of a Web application represented by a Component.\n        allOf:\n          - $ref: '#/components/schemas/WorkloadGroupCommon' # Settings common to Web and TCP/UDP workloadGroups.\n          - type: object\n            properties:\n              proxy:\n                $ref: '#/components/schemas/WebProxy' # Proxy retry and timeout settings applicable to servers in a Web workloadGroup.\n              sessionPersistence:\n                $ref: '#/components/schemas/SessionPersistence' # SessionPersistence settings in a Web workloadGroup.\n              uris:\n                type: object\n                description: |\n                  The URI for a server hosting a part of a Web application.\n                  It must conform to the format `schema://address[:port]`\n                  where schema is chosen from http or https, address is IP or hostname,\n                  schema and address must be provided.\n                  For example:\n                  - `http://192.0.2.247`\n                  - `https://192.0.2.247:8443`\n                  - `https://www.f5workload.com`\n                additionalProperties:\n                  $ref: '#/components/schemas/WorkloadUri'\n  TcpUdpWorkloadGroup:\n        description: Group of servers hosting a part of a TCP/UDP application represented by a Component.\n        allOf:\n          - $ref: '#/components/schemas/WorkloadGroupCommon' # Settings common to Web and TCP/UDP workloadGroups.\n          - type: object\n            properties:\n              proxy:\n                $ref: '#/components/schemas/TcpUdpProxy' # Proxy retry and timeout settings applicable to servers in a TcpUdp workloadGroup.\n              uris:\n                type: object\n                description: |\n                  The URI for a server hosting a part of a TCP/UDP application.\n                  The URI must conform to the format `schema://address:port`\n                  where schema is chosen from tcp, udp, or tcp+tls, address is IP or hostname.\n                  All three of schema, address, and port must be provided.\n                  For example:\n                  - `tcp://192.0.2.247:8443`\n                  - `tcp+tls://192.0.2.247:8449`\n                  - `udp://www.f5workload.com:989`\n                additionalProperties:\n                  $ref: '#/components/schemas/WorkloadUri'\n      WorkloadGroupCommon:\n        description: Settings common to Web and TCP/UDP workloadGroups.\n        type: object\n        properties:\n          locationRefs:\n            type: array\n            items:\n              $ref: 'https://gitlab.com/f5/nginx/controller/product/api-common/raw/master/schema/resource-common.yaml#/components/schemas/ResourceRef'\n          loadBalancingMethod:\n            $ref: '#/components/schemas/LoadBalancingMethod'\n          dnsServiceDiscovery:\n            $ref: '#/components/schemas/DNSServiceDiscovery'\n      WorkloadUri:\n        type: object\n        properties:\n          weight:\n            type: integer\n            minimum: 1\n            default: 1\n          maxConns:\n            type: integer\n            minimum: 0\n            default: 0\n          maxFails:\n            type: integer\n            minimum: 0\n            default: 1\n          failTimeout:\n            x-f5-experimental: true\n            type: string\n            default: 10s\n            pattern: '^[0-9]+[h|m|s]{1}$'\n          isBackup:\n            type: boolean\n            default: false\n          isDown:\n            type: boolean\n            default: false\n          route:\n            x-f5-experimental: true\n            type: string\n          srvService:\n            type: string\n          slowStart:\n            x-f5-experimental: true\n            type: integer\n            minimum: 0\n            default: 0\n          isDrain:\n            type: boolean\n            default: false\n```\n\n----------------------------------------\n\nTITLE: App Protect Connected Log Event JSON\nDESCRIPTION: This JSON object represents a successful connection of a worker to the NGINX App Protect WAF Enforcer. The 'mode' attribute indicates the operational status. The log level is Notice.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v4/logging-overview/operation-logs.md#_snippet_0\n\nLANGUAGE: JSON\nCODE:\n```\n{\n    \"event\": \"waf_connected\",\n    \"bd_thread_id\": 3,\n    \"worker_pid\": 4928,\n    \"mode\": \"operational\",\n    \"mode_changed\": true\n}\n```\n\n----------------------------------------\n\nTITLE: Creating a directory for HA scripts on CentOS\nDESCRIPTION: This command creates a directory for the NGINX Plus HA scripts on CentOS systems. The scripts are later downloaded into this directory.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/amazon-web-services/high-availability-keepalived.md#_snippet_4\n\nLANGUAGE: shell\nCODE:\n```\nsudo mkdir -p /usr/libexec/keepalived\n```\n\n----------------------------------------\n\nTITLE: NGINX Plus Sticky Learn with Zone Sync\nDESCRIPTION: This snippet extends the `sticky learn` method with the `sync` parameter, enabling synchronization of the shared memory zone between multiple NGINX instances in a cluster. This ensures consistent session persistence across the cluster.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/load-balancer/http-load-balancer.md#_snippet_15\n\nLANGUAGE: nginx\nCODE:\n```\nsticky learn\n    create=$upstream_cookie_examplecookie\n    lookup=$cookie_examplecookie\n    zone=client_sessions:1m\n    timeout=1h\n    sync;\n}\n```\n\n----------------------------------------\n\nTITLE: Traffic Metrics Overview using nginx-meshctl\nDESCRIPTION: Displays traffic metrics at a glance, showing success rates and request counts for each deployment in the mesh. It leverages the `nginx-meshctl top` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/guides/smi-traffic-metrics.md#_snippet_0\n\nLANGUAGE: txt\nCODE:\n```\n$ nginx-meshctl top\n\nDeployment      Incoming Success  Outgoing Success  NumRequests\nproductpage-v1  100.00%           100.00%           221\nreviews-v2      100.00%           100.00%           112\nreviews-v3      100.00%           100.00%           110\nreviews-v1      100.00%                             54\ndetails-v1      100.00%                             165\nratings-v1      100.00%                             54\n```\n\n----------------------------------------\n\nTITLE: GlobalConfiguration YAML\nDESCRIPTION: This YAML configuration defines a GlobalConfiguration resource that configures a listener named `accept-udp` to listen for UDP datagrams on port 8900 within the `nginx-ingress` namespace. This configuration tells the Nginx Ingress Controller to listen for UDP traffic on this port.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-udp-walkthrough.md#_snippet_5\n\nLANGUAGE: yaml\nCODE:\n```\napiVersion: k8s.nginx.org/v1alpha1\nkind: GlobalConfiguration\nmetadata:\n  name: nginx-configuration\n  namespace: nginx-ingress\nspec:\n  listeners:\n  - name: accept-udp\n    port: 8900\n    protocol: UDP\n```\n\n----------------------------------------\n\nTITLE: Dockerfile for Policy Converter Image\nDESCRIPTION: Example Dockerfile to create a custom image for the Policy Converter by using the WAF Compiler image as a base and overriding the default entrypoint. This allows running the converter directly without specifying the entrypoint in the `docker run` command.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nap-waf/v5/admin-guide/compiler.md#_snippet_18\n\nLANGUAGE: Dockerfile\nCODE:\n```\nENTRYPOINT /opt/app_protect/bin/convert-policy\n```\n\n----------------------------------------\n\nTITLE: Listing SPIFFEID resources\nDESCRIPTION: This command lists all `spiffeid` resources within a given namespace and sets the output as a variable.  The namespace must be specified in place of `<namespace>`. It is a necessary step in removing finalizers, enabling the clean removal of the NGINX Service Mesh.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.6.0.md#_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nSPIFFEIDS=$(kubectl -n <namespace> get spiffeids | grep -v NAME | awk '{print $1}')\n```\n\n----------------------------------------\n\nTITLE: Update and install module (FreeBSD)\nDESCRIPTION: Updates the package index and installs a specified NGINX module using pkg.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_29\n\nLANGUAGE: Shell\nCODE:\n```\npkg update\npkg install <MODULE-NAME>\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration\nDESCRIPTION: This command reloads the NGINX configuration without downtime. This is used to apply the changes made to the NGINX configuration file.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/deployment-guides/single-sign-on/active-directory-federation-services.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\nnginx -s reload\n```\n\n----------------------------------------\n\nTITLE: Reload NGINX Configuration\nDESCRIPTION: This command reloads the NGINX configuration, applying any changes made to the configuration files without requiring a full restart of the NGINX service. This minimizes downtime.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/admin-guide/authentication/oidc/microsoft-entra-setup.md#_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo nginx -s reload\n```\n\n----------------------------------------\n\nTITLE: NGINX Configuration Test Failure\nDESCRIPTION: Error message displayed when creating a BIG-IP Component. It indicates that the NGINX configuration test failed due to a binding issue, specifically 'Cannot assign requested address'.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/releases/adc/adc-release-notes-3.22.6.md#_snippet_2\n\nLANGUAGE: none\nCODE:\n```\nFailed testing config before applying: nginx:\nthe configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: [emerg] bind() to <IP>:20001 failed (99: Cannot assign requested address)\nnginx: configuration file /etc/nginx/nginx.conf test failed\n```\n\n----------------------------------------\n\nTITLE: Ingestion Service Warning Message\nDESCRIPTION: Displays a warning message related to the NGINX Management Suite Ingestion service during an upgrade to version 2.10. This message indicates a mismatch in migration versions for ClickHouse, which can be safely ignored.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/releases/known-issues.md#_snippet_6\n\nLANGUAGE: none\nCODE:\n```\n[WARN] #011/usr/bin/nms-ingestion               #011start/start.go:497                 #011error checking migrations Mismatched migration version for ClickHouse, expected 39 migrations to be applied, currently have only 44 migrations applied.\n```\n\n----------------------------------------\n\nTITLE: Add nginx-plus repo for SLES 12\nDESCRIPTION: This command adds the NGINX Plus repository for SLES 12 to the zypper package manager. It specifies the path to the certificate bundle for authentication.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nginx/admin-guide/installing-nginx/installing-nginx-plus.md#_snippet_19\n\nLANGUAGE: Shell\nCODE:\n```\nzypper addrepo -G -t yum -c \\\n\"https://pkgs.nginx.com/plus/sles/12?ssl_clientcert=/etc/ssl/nginx/nginx-repo-bundle.crt&ssl_verify=peer\" \\\nnginx-plus\n```\n\n----------------------------------------\n\nTITLE: Pull Latest Edge Version of NGINX Gateway Fabric Chart with Helm\nDESCRIPTION: This shell script pulls the latest version from the main branch of the NGINX Gateway Fabric chart using Helm. It utilizes the `--version 0.0.0-edge` flag. Requires Helm to be installed and configured.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/includes/ngf/installation/helm/pulling-the-chart.md#_snippet_1\n\nLANGUAGE: shell\nCODE:\n```\nhelm pull oci://ghcr.io/nginx/charts/nginx-gateway-fabric --untar --version 0.0.0-edge\n```\n\n----------------------------------------\n\nTITLE: Configuring Agent Logging\nDESCRIPTION: Shows how to change the logging level for the NGINX Amplify Agent in the agent.conf file. Changing the level to DEBUG can help when debugging the agent, but the log file size can grow quickly. Requires a restart of the agent.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/amplify/nginx-amplify-agent/install/configuring-amplify-agent.md#_snippet_11\n\nLANGUAGE: nginx\nCODE:\n```\n[logger_agent-default]\nlevel = DEBUG\n..\n\n[handler_agent-default]\nclass = logging.handlers.WatchedFileHandler\nlevel = DEBUG\n..\n```\n\n----------------------------------------\n\nTITLE: Restore User Passwords (Shell)\nDESCRIPTION: Applies the nms-auth.json file containing user password secrets and restarts the apigw pod to apply the changes.  This restores user passwords from the backup.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nms/acm/how-to/backup-recovery.md#_snippet_19\n\nLANGUAGE: shell\nCODE:\n```\ncd k8s-backup-<version>/secrets\nkubectl -n nms apply -f nms-auth.json\nkubectl -n nms delete pod apigw-<hash>\n```\n\n----------------------------------------\n\nTITLE: Delete Security Log Profile (DELETE) - Shell\nDESCRIPTION: This code snippet shows how to delete a security log profile using a DELETE request to the NGINX Instance Manager API. It requires the log profile's UID to be included in the URL. Requires `curl`, a valid access token, and the log profile's UID. Before deleting, the profile's UID must be retrieved using a GET request.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/nim/nginx-app-protect/manage-waf-security-policies.md#_snippet_20\n\nLANGUAGE: shell\nCODE:\n```\ncurl -X DELETE https://{{NIM_FQDN}}/api/platform/v1/security/logprofiles/<log-profile-uid> \\\n        -H \"Authorization: Bearer <access token>\"\n```\n\n----------------------------------------\n\nTITLE: Install NGINX App Protect WAF (Shell)\nDESCRIPTION: This command installs the latest NGINX App Protect WAF package using the `yum` package manager. You can also install a specific version by replacing `app-protect` with the target version, for example `app-protect-25+3.671.0`.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/controller/admin-guides/install/install-for-controller.md#_snippet_7\n\nLANGUAGE: shell\nCODE:\n```\nsudo yum install app-protect\n```\n\n----------------------------------------\n\nTITLE: NGINX Meshctl Top Command Output\nDESCRIPTION: Shows sample output from the `nginx-meshctl top` command. This command displays traffic metrics for deployments in the specified namespace, including incoming/outgoing success rates and number of requests.  It requires NGINX Service Mesh to be configured to export metrics to Prometheus.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/tutorials/kic/ingress-walkthrough.md#_snippet_7\n\nLANGUAGE: txt\nCODE:\n```\n$ nginx-meshctl top\n\nDeployment      Incoming Success  Outgoing Success  NumRequests\nproductpage-v1                    100.00%           6\nreviews-v2      100.00%           100.00%           4\nreviews-v3      100.00%                             2\ndetails-v1      100.00%                             6\nratings-v1      100.00%                             2\nreviews-v1      100.00%                             3\n```\n\n----------------------------------------\n\nTITLE: Invalid Service configuration with duplicate targetPorts\nDESCRIPTION: This code snippet shows an example of an invalid Kubernetes Service configuration. It demonstrates a scenario where multiple port configurations within the Service spec duplicate the `targetPort` value.  NGINX Service Mesh will disregard these duplicates, honoring only one port configuration for traffic forwarding, authentication, and encryption. The example clarifies a specific misconfiguration that can lead to unexpected behavior.\nSOURCE: https://github.com/nginx/documentation/blob/main/content/mesh/releases/release-notes-0.9.0.md#_snippet_1\n\nLANGUAGE: plaintext\nCODE:\n```\napiVersion: v1\nkind: Service\nspec:\n  ports:\n  - port: 8080\n    protocol: TCP\n    targetPort: 55555\n  - port: 9090\n    protocol: TCP\n    targetPort: 55555\n```"
  }
]