[
  {
    "owner": "bluesky-social",
    "repo": "ozone",
    "content": "TITLE: Querying Ozone Moderation Statuses\nDESCRIPTION: This API endpoint is used to query and build moderation queues for moderators. It allows filtering and sorting of subjects based on various parameters, excluding muted subjects by default.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/docs/api.md#2025-04-23_snippet_0\n\nLANGUAGE: plaintext\nCODE:\n```\ntools.ozone.moderation.queryStatuses\n```\n\n----------------------------------------\n\nTITLE: Emitting Ozone Moderation Events\nDESCRIPTION: This API endpoint is called when a moderator takes an action, creating a new moderation event. It requires appropriate user roles for access control.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/docs/api.md#2025-04-23_snippet_1\n\nLANGUAGE: plaintext\nCODE:\n```\ntools.ozone.moderation.emitEvent\n```\n\n----------------------------------------\n\nTITLE: Querying Ozone Moderation Events\nDESCRIPTION: This API endpoint allows querying of historical moderation events with various filters. It can retrieve all events for a user's content, providing context for moderators when reviewing reports.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/docs/api.md#2025-04-23_snippet_2\n\nLANGUAGE: plaintext\nCODE:\n```\ntools.ozone.moderation.queryEvents\n```\n\n----------------------------------------\n\nTITLE: Starting Ozone Development Server\nDESCRIPTION: Commands to run the Ozone development server locally using npm or yarn. This starts the application for local development and testing.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/README.md#2025-04-23_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nnpm run dev\n# or\nyarn dev\n```\n\n----------------------------------------\n\nTITLE: Building and Running Ozone with Docker\nDESCRIPTION: Commands to build and run the Ozone application using Docker. This creates a containerized instance of Ozone and exposes it on port 3000.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/README.md#2025-04-23_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n# build image\ndocker build -t ozone .\n\n# run the image\ndocker run -p 3000:3000 ozone\n```\n\n----------------------------------------\n\nTITLE: Ozone Environment Configuration\nDESCRIPTION: Commands to create Ozone environment configuration with service account and security settings\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_9\n\nLANGUAGE: bash\nCODE:\n```\nOZONE_HOSTNAME=\"ozone.example.com\"\nOZONE_SERVICE_ACCOUNT_HANDLE=\"mylabeler.bsky.social\"\nOZONE_SERVER_DID=\"$(curl --fail --silent --show-error \"https://api.bsky.app/xrpc/com.atproto.identity.resolveHandle?handle=${OZONE_SERVICE_ACCOUNT_HANDLE}\" | jq --raw-output .did)\"\nOZONE_ADMIN_PASSWORD=\"$(openssl rand --hex 16)\"\nOZONE_SIGNING_KEY_HEX=\"$(openssl ecparam --name secp256k1 --genkey --noout --outform DER | tail --bytes=+8 | head --bytes=32 | xxd --plain --cols 32)\"\n\ncat <<OZONE_CONFIG | sudo tee /ozone/ozone.env\nOZONE_SERVER_DID=${OZONE_SERVER_DID}\nOZONE_PUBLIC_URL=https://${OZONE_HOSTNAME}\nOZONE_ADMIN_DIDS=${OZONE_SERVER_DID}\nOZONE_ADMIN_PASSWORD=${OZONE_ADMIN_PASSWORD}\nOZONE_SIGNING_KEY_HEX=${OZONE_SIGNING_KEY_HEX}\nOZONE_DB_POSTGRES_URL=postgresql://postgres:${POSTGRES_PASSWORD}@localhost:5432/ozone\nOZONE_DB_MIGRATE=1\nOZONE_DID_PLC_URL=https://plc.directory\nOZONE_APPVIEW_URL=https://api.bsky.app\nOZONE_APPVIEW_DID=did:web:api.bsky.app\nLOG_ENABLED=1\nOZONE_CONFIG\n```\n\n----------------------------------------\n\nTITLE: Verifying Ozone Server Health Check\nDESCRIPTION: Command to verify if the Ozone server is online by making a request to the healthcheck endpoint.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_13\n\nLANGUAGE: bash\nCODE:\n```\ncurl https://ozone.EXAMPLE.COM/xrpc/_health\n```\n\n----------------------------------------\n\nTITLE: Testing Ozone WebSocket Label Stream\nDESCRIPTION: Command to verify the WebSocket label stream functionality. Note that this may not produce output until labels are created in Ozone.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_14\n\nLANGUAGE: bash\nCODE:\n```\nwsdump \"wss://ozone.EXAMPLE.COM/xrpc/com.atproto.label.subscribeLabels?cursor=0\"\n```\n\n----------------------------------------\n\nTITLE: Updating Ozone Docker Image\nDESCRIPTION: Command to pull the latest Ozone container image from the GitHub Container Registry.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_15\n\nLANGUAGE: bash\nCODE:\n```\nsudo docker pull ghcr.io/bluesky-social/ozone:latest\n```\n\n----------------------------------------\n\nTITLE: Restarting Ozone Service\nDESCRIPTION: Command to restart the Ozone service after updating the container image.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_16\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl restart ozone\n```\n\n----------------------------------------\n\nTITLE: Linking Local ATProto API Package in Ozone's package.json\nDESCRIPTION: Shows the necessary package.json changes to link a local build of @atproto/api instead of using the published version.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HACKING.md#2025-04-23_snippet_3\n\nLANGUAGE: diff\nCODE:\n```\n   \"dependencies\": {\n-    \"@atproto/api\": \"^0.0.3\",\n+    \"@atproto/api\": \"link:../atproto/packages/api/dist\",\n     \"@headlessui/react\": \"^1.7.7\",\n```\n\n----------------------------------------\n\nTITLE: Building ATProto API Package Locally\nDESCRIPTION: Shows the command to build the @atproto/api package from source in the atproto repository.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HACKING.md#2025-04-23_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\n~/Documents/bluesky/atproto\n❯ yarn\n```\n\n----------------------------------------\n\nTITLE: Postgres Environment Configuration\nDESCRIPTION: Commands to create Postgres environment configuration with secure random password\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_8\n\nLANGUAGE: bash\nCODE:\n```\nPOSTGRES_PASSWORD=\"$(openssl rand --hex 16)\"\n\ncat <<POSTGRES_CONFIG | sudo tee /ozone/postgres.env\nPOSTGRES_USER=postgres\nPOSTGRES_PASSWORD=${POSTGRES_PASSWORD}\nPOSTGRES_DB=ozone\nPOSTGRES_CONFIG\n```\n\n----------------------------------------\n\nTITLE: Systemd Service Configuration\nDESCRIPTION: Commands to create and configure the systemd service for Ozone\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_11\n\nLANGUAGE: bash\nCODE:\n```\ncat <<SYSTEMD_UNIT_FILE | sudo tee /etc/systemd/system/ozone.service\n[Unit]\nDescription=Bluesky Ozone Service\nDocumentation=https://github.com/bluesky-social/ozone\nRequires=docker.service\nAfter=docker.service\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nWorkingDirectory=/ozone\nExecStart=/usr/bin/docker compose --file /ozone/compose.yaml up --detach\nExecStop=/usr/bin/docker compose --file /ozone/compose.yaml down\n\n[Install]\nWantedBy=default.target\nSYSTEMD_UNIT_FILE\n```\n\n----------------------------------------\n\nTITLE: Systemd Service Activation\nDESCRIPTION: Commands to enable and start the Ozone service using systemd\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_12\n\nLANGUAGE: bash\nCODE:\n```\nsudo systemctl daemon-reload\nsudo systemctl enable ozone\nsudo systemctl start ozone\nsudo systemctl status ozone\nsudo docker ps\n```\n\n----------------------------------------\n\nTITLE: Docker Engine Installation\nDESCRIPTION: Commands to install Docker Engine and related components\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get update\nsudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n```\n\n----------------------------------------\n\nTITLE: Ozone Directory Setup\nDESCRIPTION: Commands to create required directories for Ozone service\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_6\n\nLANGUAGE: bash\nCODE:\n```\nsudo mkdir /ozone\nsudo mkdir /ozone/postgres\nsudo mkdir --parents /ozone/caddy/data\nsudo mkdir --parents /ozone/caddy/etc/caddy\n```\n\n----------------------------------------\n\nTITLE: Caddy Configuration Creation\nDESCRIPTION: Command to create Caddy reverse proxy configuration file\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_7\n\nLANGUAGE: bash\nCODE:\n```\ncat <<CADDYFILE | sudo tee /ozone/caddy/etc/caddy/Caddyfile\nozone.example.com {\n  tls ozone@example.com\n  reverse_proxy http://localhost:3000\n}\nCADDYFILE\n```\n\n----------------------------------------\n\nTITLE: Reinstalling Dependencies with Local API Link\nDESCRIPTION: Shows the command to reinstall dependencies in the Ozone project after linking to a local @atproto/api build.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HACKING.md#2025-04-23_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\n~/Documents/bluesky/ozone\n❯ yarn\n```\n\n----------------------------------------\n\nTITLE: Resetting Package Changes After Development\nDESCRIPTION: Demonstrates how to revert temporary package.json and yarn.lock changes after finishing development with the local ATProto API.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HACKING.md#2025-04-23_snippet_5\n\nLANGUAGE: bash\nCODE:\n```\n~/Documents/bluesky/ozone\n❯ git checkout package.json yarn.lock && yarn\n```\n\n----------------------------------------\n\nTITLE: Docker Dependencies Installation\nDESCRIPTION: Commands to install required packages for Docker installation\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_2\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get update\nsudo apt-get install \\\n    ca-certificates \\\n    curl \\\n    jq \\\n    openssl \\\n    xxd \\\n    gnupg\n```\n\n----------------------------------------\n\nTITLE: Docker GPG Key Setup\nDESCRIPTION: Commands to set up Docker's GPG key for package verification\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_3\n\nLANGUAGE: bash\nCODE:\n```\nsudo install -m 0755 -d /etc/apt/keyrings\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg\nsudo chmod a+r /etc/apt/keyrings/docker.gpg\n```\n\n----------------------------------------\n\nTITLE: Docker Repository Configuration\nDESCRIPTION: Command to add Docker repository to APT sources\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_4\n\nLANGUAGE: bash\nCODE:\n```\necho \\\n  \"deb [arch=\\\"$(dpkg --print-architecture)\\\" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\\n  \\\"$(. /etc/os-release && echo \\\"$VERSION_CODENAME\\\")\\\" stable\" | \\\n  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n```\n\n----------------------------------------\n\nTITLE: Docker Compose Download\nDESCRIPTION: Command to download the Docker compose configuration file for Ozone\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_10\n\nLANGUAGE: bash\nCODE:\n```\ncurl https://raw.githubusercontent.com/bluesky-social/ozone/main/service/compose.yaml | sudo tee /ozone/compose.yaml\n```\n\n----------------------------------------\n\nTITLE: Directory Structure for Bluesky Projects\nDESCRIPTION: Shows the typical file system structure where atproto and ozone projects exist as sibling directories.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HACKING.md#2025-04-23_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n~/Documents/bluesky\n❯ ls -l\ntotal 19856\ndrwxr-xr-x  22 user  group  704 Jan 19 15:51 atproto\ndrwxr-xr-x  24 user  group  768 Jan 24 19:17 ozone\n```\n\n----------------------------------------\n\nTITLE: Git Checkout Command for ATProto Repository\nDESCRIPTION: Demonstrates how to navigate to the atproto directory and checkout the main branch for development.\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HACKING.md#2025-04-23_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\n~/Documents/bluesky\n❯ cd atproto\n~/Documents/bluesky/atproto\n❯ git checkout main\n```\n\n----------------------------------------\n\nTITLE: Opening Linux Firewall Ports\nDESCRIPTION: Commands to allow HTTP and HTTPS traffic through the UFW firewall on Ubuntu\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_0\n\nLANGUAGE: bash\nCODE:\n```\n$ sudo ufw allow 80/tcp\n$ sudo ufw allow 443/tcp\n```\n\n----------------------------------------\n\nTITLE: Docker Uninstallation\nDESCRIPTION: Command to remove old Docker installations before fresh setup\nSOURCE: https://github.com/bluesky-social/ozone/blob/main/HOSTING.md#2025-04-23_snippet_1\n\nLANGUAGE: bash\nCODE:\n```\nsudo apt-get remove docker docker-engine docker.io containerd runc\n```"
  }
]